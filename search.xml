<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>STC52å•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬(å·²éªŒè¯)</title>
      <link href="/2024/03/STC-STC52%E5%8D%95%E7%89%87%E6%9C%BA%E7%AE%80%E5%8D%95%E6%8E%A7%E5%88%B6%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%AD%A3%E5%8F%8D%E8%BD%AC%E5%B7%B2%E9%AA%8C%E8%AF%81/"/>
      <url>/2024/03/STC-STC52%E5%8D%95%E7%89%87%E6%9C%BA%E7%AE%80%E5%8D%95%E6%8E%A7%E5%88%B6%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%AD%A3%E5%8F%8D%E8%BD%AC%E5%B7%B2%E9%AA%8C%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC52å•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬-å·²éªŒè¯"><a href="#STC52å•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬-å·²éªŒè¯" class="headerlink" title="STC52å•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬(å·²éªŒè¯)"></a>STC52å•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬(å·²éªŒè¯)</h1><h5 id="STC52å•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬-å·²éªŒè¯-1"><a href="#STC52å•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬-å·²éªŒè¯-1" class="headerlink" title="STC52å•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬(å·²éªŒè¯)"></a>STC52å•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬(å·²éªŒè¯)</h5><p>æœ¬å®éªŒæºç æ¥æºäºï¼šå›å‹-ä¹¦ç›²ã€ŠSTCå•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬ã€‹</p><p><a href="https://blog.csdn.net/XiaoCaiDaYong/article/details/82354311?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162238513616780366598380%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=162238513616780366598380&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-9-82354311.nonecase&utm_term=51%E6%8E%A7%E5%88%B6%E7%94%B5%E6%9C%BA%E6%AD%A3%E5%8F%8D%E8%BD%AC&spm=1018.2226.3001.4450">STCå•ç‰‡æœºç®€å•æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬</a></p><ul><li>å¼€å‘ç¯å¢ƒï¼šKeil</li><li>STCå‹å·STC89C52RC</li><li>æºä»£ç ï¼š</li></ul><p>å¼€å‘ç¯å¢ƒï¼šKeil</p><p>STCå‹å·STC89C52RC</p><p><img src="https://img-blog.csdnimg.cn/20210530231048450.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mjg4MDA4Mg==,size_16,color_FFFFFF,t_70" alt="*"></p><p>æºä»£ç ï¼š</p><p>main.c</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg51.h&gt;</span><br><span class="line"> </span><br><span class="line">sbit EN  = P1^0;  //    ç”µæœºè¾“å…¥è¾“å‡º1,2</span><br><span class="line">sbit IN1 = P1^1;  //    è¾“å…¥1</span><br><span class="line">sbit IN2 = P1^2;  //    è¾“å…¥2</span><br><span class="line">sbit key1=P3^5;</span><br><span class="line">sbit key2=P3^4;</span><br><span class="line"> </span><br><span class="line">void delay();</span><br><span class="line"> </span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    EN=1;</span><br><span class="line">    IN1=0;</span><br><span class="line">    IN2=0;</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;     </span><br><span class="line">        if(key1==0)</span><br><span class="line">        &#123;</span><br><span class="line">            delay();</span><br><span class="line">            &#123;</span><br><span class="line">                if(key1==0)</span><br><span class="line">                &#123;</span><br><span class="line">                    IN1=1;</span><br><span class="line">                    IN2=0;</span><br><span class="line">                &#125;</span><br><span class="line">                while(key1==0);</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">        if(key2==0)</span><br><span class="line">        &#123;</span><br><span class="line">            delay();</span><br><span class="line">            &#123;</span><br><span class="line">                if(key2==0)</span><br><span class="line">                &#123;</span><br><span class="line">                    IN1=0;</span><br><span class="line">                    IN2=1;</span><br><span class="line">                &#125;</span><br><span class="line">                while(key2==0);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">void delay()</span><br><span class="line">&#123;</span><br><span class="line">    int i,j;</span><br><span class="line">    for(i=0;i&lt;10;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        for(j=0;j&lt;100;j++);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg51.h&gt;</p><p>sbit EN  &#x3D; P1^0;  &#x2F;&#x2F;    ç”µæœºè¾“å…¥è¾“å‡º1,2<br>sbit IN1 &#x3D; P1^1;  &#x2F;&#x2F;    è¾“å…¥1<br>sbit IN2 &#x3D; P1^2;  &#x2F;&#x2F;    è¾“å…¥2<br>sbit key1&#x3D;P3^5;<br>sbit key2&#x3D;P3^4;</p><p>void delay();</p><p>void main()<br>{<br>    EN&#x3D;1;<br>    IN1&#x3D;0;<br>    IN2&#x3D;0;<br>    while(1)<br>    {<br>        if(key1&#x3D;&#x3D;0)<br>        {<br>            delay();<br>            {<br>                if(key1&#x3D;&#x3D;0)<br>                {<br>                    IN1&#x3D;1;<br>                    IN2&#x3D;0;<br>                }<br>                while(key1&#x3D;&#x3D;0);<br>            }</p><pre><code>    &#125;    if(key2==0)    &#123;        delay();        &#123;            if(key2==0)            &#123;                IN1=0;                IN2=1;            &#125;            while(key2==0);        &#125;    &#125;&#125;</code></pre><p>}</p><p>void delay()<br>{<br>    int i,j;<br>    for(i&#x3D;0;i&lt;10;i++)<br>    {<br>        for(j&#x3D;0;j&lt;100;j++);<br>    }<br>}&#96;</p><ul><li>Proteusä»¿çœŸå›¾ï¼š</li><li>ç¨‹åºæºç å’Œä»¿çœŸæ–‡ä»¶ä¸‹è½½åœ°å€ï¼š ç™¾åº¦ç½‘ç›˜</li></ul><p><img src="https://img-blog.csdnimg.cn/20210530230415620.png#pic_center" alt="*"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1LR0egCSgEVZBkdeIBwiMaQ </span><br><span class="line">æå–ç ï¼šgkor</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1LR0egCSgEVZBkdeIBwiMaQ  æå–ç ï¼šgkor</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>AT89C52åˆ©ç”¨å®šæ—¶å™¨æ§åˆ¶å•ä¸ªledç¯é—ªçƒ</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-51%E5%8D%95%E7%89%87%E6%9C%BA%E5%88%A9%E7%94%A8%E5%AE%9A%E6%97%B6%E5%99%A8%E6%8E%A7%E5%88%B6%E5%8D%95%E4%B8%AAled%E7%81%AF%E9%97%AA%E7%83%81/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-51%E5%8D%95%E7%89%87%E6%9C%BA%E5%88%A9%E7%94%A8%E5%AE%9A%E6%97%B6%E5%99%A8%E6%8E%A7%E5%88%B6%E5%8D%95%E4%B8%AAled%E7%81%AF%E9%97%AA%E7%83%81/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="AT89C52åˆ©ç”¨å®šæ—¶å™¨æ§åˆ¶å•ä¸ªledç¯é—ªçƒ"><a href="#AT89C52åˆ©ç”¨å®šæ—¶å™¨æ§åˆ¶å•ä¸ªledç¯é—ªçƒ" class="headerlink" title="AT89C52åˆ©ç”¨å®šæ—¶å™¨æ§åˆ¶å•ä¸ªledç¯é—ªçƒ"></a>AT89C52åˆ©ç”¨å®šæ—¶å™¨æ§åˆ¶å•ä¸ªledç¯é—ªçƒ</h1><h3 id="AT89C52åˆ©ç”¨å®šæ—¶å™¨æ§åˆ¶å•ä¸ªledç¯é—ªçƒ-1"><a href="#AT89C52åˆ©ç”¨å®šæ—¶å™¨æ§åˆ¶å•ä¸ªledç¯é—ªçƒ-1" class="headerlink" title="AT89C52åˆ©ç”¨å®šæ—¶å™¨æ§åˆ¶å•ä¸ªledç¯é—ªçƒ"></a>AT89C52åˆ©ç”¨å®šæ—¶å™¨æ§åˆ¶å•ä¸ªledç¯é—ªçƒ</h3><h6 id="keilèŠ¯ç‰‡é€‰æ‹©AT89C52"><a href="#keilèŠ¯ç‰‡é€‰æ‹©AT89C52" class="headerlink" title="keilèŠ¯ç‰‡é€‰æ‹©AT89C52"></a>keilèŠ¯ç‰‡é€‰æ‹©AT89C52</h6><p><img src="https://img-blog.csdnimg.cn/20210322215041887.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20210322215159540.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>æ–°å»ºä¸€ä¸ª.cæ–‡ä»¶ï¼Œå°†ä»£ç æ‹·è´è¿›å»,ç„¶åä¿å­˜ã€‚</li><li>ç„¶åå°†ä¿å­˜çš„.cæ–‡ä»¶åŠ è½½åˆ°å·¥ç¨‹é¡¹ç›®é‡Œé¢å»ã€‚</li><li>è®¾ç½®å¥½ç”Ÿäº§hexæ–‡ä»¶ï¼Œå°±å¯ä»¥ç¼–è¯‘äº†ã€‚</li><li>main.cç¨‹åºæºç ï¼š</li></ul><p>æ–°å»ºä¸€ä¸ª.cæ–‡ä»¶ï¼Œå°†ä»£ç æ‹·è´è¿›å»,ç„¶åä¿å­˜ã€‚</p><p>ç„¶åå°†ä¿å­˜çš„.cæ–‡ä»¶åŠ è½½åˆ°å·¥ç¨‹é¡¹ç›®é‡Œé¢å»ã€‚</p><p>è®¾ç½®å¥½ç”Ÿäº§hexæ–‡ä»¶ï¼Œå°±å¯ä»¥ç¼–è¯‘äº†ã€‚</p><p><img src="https://img-blog.csdnimg.cn/2021032221553428.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>main.cç¨‹åºæºç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#define  uchar unsigned char</span><br><span class="line">#define  uint unsigned int</span><br><span class="line"></span><br><span class="line">sbit led = P0 ^ 0;</span><br><span class="line">uchar Cout = 0;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">     TMOD = 0X00; //0000 0000 å®šæ—¶å™¨0ï¼Œå·¥ä½œæ–¹å¼0</span><br><span class="line">EA=1;</span><br><span class="line">    TH0 = (8192 - 5000) / 32; //5mså®šæ—¶</span><br><span class="line">    TL0 = (8192 - 5000) % 32;</span><br><span class="line">    IE = 0X82; //1111 1101 T0ä¸­æ–­å…è®¸ä½</span><br><span class="line">    TR0 = 1; //å¯åŠ¨å®šæ—¶å™¨</span><br><span class="line">    while (1);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">void led_flash() interrupt 1 //T0ä¸­æ–­å·ä¸º1</span><br><span class="line">&#123;</span><br><span class="line">    TH0 = (8192 - 5000) / 32; //æ¢å¤åˆå€¼</span><br><span class="line">    TL0 = (8192 - 5000) % 32;</span><br><span class="line">    if (++Cout == 100) //0.5ç§’å¼€å…³ä¸€æ¬¡ï¼Œ0.5S =5ms*100</span><br><span class="line">    &#123;</span><br><span class="line">        led = !led; //å–å</span><br><span class="line">        Cout = 0;//æ¢å¤åˆå§‹å€¼</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#define  uchar unsigned char<br>#define  uint unsigned int</p><p>sbit led &#x3D; P0 ^ 0;<br>uchar Cout &#x3D; 0;</p><p>void main()<br>{<br>     TMOD &#x3D; 0X00; &#x2F;&#x2F;0000 0000 å®šæ—¶å™¨0ï¼Œå·¥ä½œæ–¹å¼0<br>            EA&#x3D;1;<br>    TH0 &#x3D; (8192 - 5000) &#x2F; 32; &#x2F;&#x2F;5mså®šæ—¶<br>    TL0 &#x3D; (8192 - 5000) % 32;<br>    IE &#x3D; 0X82; &#x2F;&#x2F;1111 1101 T0ä¸­æ–­å…è®¸ä½<br>    TR0 &#x3D; 1; &#x2F;&#x2F;å¯åŠ¨å®šæ—¶å™¨<br>    while (1);</p><pre><code>&#125;</code></pre><p>void led_flash() interrupt 1 &#x2F;&#x2F;T0ä¸­æ–­å·ä¸º1<br>{<br>    TH0 &#x3D; (8192 - 5000) &#x2F; 32; &#x2F;&#x2F;æ¢å¤åˆå€¼<br>    TL0 &#x3D; (8192 - 5000) % 32;<br>    if (++Cout &#x3D;&#x3D; 100) &#x2F;&#x2F;0.5ç§’å¼€å…³ä¸€æ¬¡ï¼Œ0.5S &#x3D;5ms*100<br>    {<br>        led &#x3D; !led; &#x2F;&#x2F;å–å<br>        Cout &#x3D; 0;&#x2F;&#x2F;æ¢å¤åˆå§‹å€¼<br>    }<br>}&#96;</p><ul><li>proteusä»¿çœŸ</li><li>å°†ç¼–è¯‘è¾“å‡ºçš„hexæ–‡ä»¶åŠ è½½åˆ°proteusé‡Œé¢ï¼Œè¿›è¡Œä»¿çœŸ</li></ul><p>proteusä»¿çœŸ</p><p><img src="https://img-blog.csdnimg.cn/20210322215953188.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å°†ç¼–è¯‘è¾“å‡ºçš„hexæ–‡ä»¶åŠ è½½åˆ°proteusé‡Œé¢ï¼Œè¿›è¡Œä»¿çœŸ</p><p><img src="https://img-blog.csdnimg.cn/20210322215619387.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨74HC138è¯‘ç å™¨å®ç°æ•°ç ç®¡æ˜¾ç¤º</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E5%88%A9%E7%94%A874HC138%E8%AF%91%E7%A0%81%E5%99%A8%E5%AE%9E%E7%8E%B0%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E5%88%A9%E7%94%A874HC138%E8%AF%91%E7%A0%81%E5%99%A8%E5%AE%9E%E7%8E%B0%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="åˆ©ç”¨74HC138è¯‘ç å™¨å®ç°æ•°ç ç®¡æ˜¾ç¤º"><a href="#åˆ©ç”¨74HC138è¯‘ç å™¨å®ç°æ•°ç ç®¡æ˜¾ç¤º" class="headerlink" title="åˆ©ç”¨74HC138è¯‘ç å™¨å®ç°æ•°ç ç®¡æ˜¾ç¤º"></a>åˆ©ç”¨74HC138è¯‘ç å™¨å®ç°æ•°ç ç®¡æ˜¾ç¤º</h1><h4 id="åˆ©ç”¨74HC138è¯‘ç å™¨å®ç°æ•°ç ç®¡æ˜¾ç¤º-1"><a href="#åˆ©ç”¨74HC138è¯‘ç å™¨å®ç°æ•°ç ç®¡æ˜¾ç¤º-1" class="headerlink" title="åˆ©ç”¨74HC138è¯‘ç å™¨å®ç°æ•°ç ç®¡æ˜¾ç¤º"></a>åˆ©ç”¨74HC138è¯‘ç å™¨å®ç°æ•°ç ç®¡æ˜¾ç¤º</h4><ul><li>74HC138çœŸå€¼è¡¨</li><li>ä»¿çœŸå›¾</li><li>ç¨‹åºæºç </li></ul><p>74HC138çœŸå€¼è¡¨</p><p><img src="https://img-blog.csdnimg.cn/20210622213016411.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä»¿çœŸå›¾</p><p><img src="https://img-blog.csdnimg.cn/20210622213457781.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç¨‹åºæºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;reg51.h&quot;</span><br><span class="line"></span><br><span class="line">typedef unsigned char u8;</span><br><span class="line">typedef unsigned int u16;</span><br><span class="line"></span><br><span class="line"> unsigned char code Seg_Tab[]  = &#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71&#125;;</span><br><span class="line">  //å…±é˜´0-Fæ®µç ï¼ŒåŠ codeæ˜¯å­˜åœ¨romé‡Œé¢</span><br><span class="line"></span><br><span class="line">void delay(u16 k);</span><br><span class="line">void Seg_display(unsigned int val);</span><br><span class="line"></span><br><span class="line">void main()&#123;</span><br><span class="line">while(1)&#123;</span><br><span class="line">Seg_display(9527);//æ˜¾ç¤ºå†…å®¹</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void Seg_display(unsigned int val)&#123;</span><br><span class="line"> unsigned char i,dia_data;</span><br><span class="line">for(i=0;i&lt;4;i++)&#123;</span><br><span class="line">dia_data = val % 10;</span><br><span class="line">val =val/10 ;</span><br><span class="line">P0 = Seg_Tab[dia_data];</span><br><span class="line">P1 = i;</span><br><span class="line">delay(5);</span><br><span class="line">P0=0;//æ¶ˆéšä½œç”¨</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å»¶æ—¶næ¯«ç§’</span><br><span class="line">void delay(unsigned int n)//@12MHzæ™¶æŒ¯</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int i=0,j=0;</span><br><span class="line">    for(i=0;i&lt;n;i++)</span><br><span class="line">        for(j=0;j&lt;123;j++);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œreg51.hâ€</p><p>typedef unsigned char u8;<br>typedef unsigned int u16;</p><p> unsigned char code Seg_Tab[]  &#x3D; {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};<br>                      &#x2F;&#x2F;å…±é˜´0-Fæ®µç ï¼ŒåŠ codeæ˜¯å­˜åœ¨romé‡Œé¢</p><p>void delay(u16 k);<br>void Seg_display(unsigned int val);</p><p>void main(){<br>    while(1){<br>    Seg_display(9527);&#x2F;&#x2F;æ˜¾ç¤ºå†…å®¹<br>    }</p><p>}</p><p>void Seg_display(unsigned int val){<br> unsigned char i,dia_data;<br>    for(i&#x3D;0;i&lt;4;i++){<br>    dia_data &#x3D; val % 10;<br>        val &#x3D;val&#x2F;10 ;<br>        P0 &#x3D; Seg_Tab[dia_data];<br>        P1 &#x3D; i;<br>delay(5);<br>        P0&#x3D;0;&#x2F;&#x2F;æ¶ˆéšä½œç”¨<br>    }<br>}</p><p>&#x2F;&#x2F;å»¶æ—¶næ¯«ç§’<br>void delay(unsigned int n)&#x2F;&#x2F;@12MHzæ™¶æŒ¯<br>{<br>    unsigned int i&#x3D;0,j&#x3D;0;<br>    for(i&#x3D;0;i&lt;n;i++)<br>        for(j&#x3D;0;j&lt;123;j++);<br>}&#96;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1gHqetaE8yc7v-0TPuQtoJw </span><br><span class="line">æå–ç ï¼š3zzm</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1gHqetaE8yc7v-0TPuQtoJw  æå–ç ï¼š3zzm</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ ‡å‡†åº“intrins.hä¸­çš„å¾ªç¯æŒ‡ä»¤åœ¨å¤šç§æµæ°´ç¯æ–¹å¼ä¸Šçš„åº”ç”¨</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E6%A0%87%E5%87%86%E5%BA%93intrinsh%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E6%8C%87%E4%BB%A4%E5%9C%A8%E5%A4%9A%E7%A7%8D%E6%B5%81%E6%B0%B4%E7%81%AF%E6%96%B9%E5%BC%8F%E4%B8%8A%E7%9A%84%E5%BA%94%E7%94%A8/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E6%A0%87%E5%87%86%E5%BA%93intrinsh%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E6%8C%87%E4%BB%A4%E5%9C%A8%E5%A4%9A%E7%A7%8D%E6%B5%81%E6%B0%B4%E7%81%AF%E6%96%B9%E5%BC%8F%E4%B8%8A%E7%9A%84%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="æ ‡å‡†åº“intrins-hä¸­çš„å¾ªç¯æŒ‡ä»¤åœ¨å¤šç§æµæ°´ç¯æ–¹å¼ä¸Šçš„åº”ç”¨"><a href="#æ ‡å‡†åº“intrins-hä¸­çš„å¾ªç¯æŒ‡ä»¤åœ¨å¤šç§æµæ°´ç¯æ–¹å¼ä¸Šçš„åº”ç”¨" class="headerlink" title="æ ‡å‡†åº“intrins.hä¸­çš„å¾ªç¯æŒ‡ä»¤åœ¨å¤šç§æµæ°´ç¯æ–¹å¼ä¸Šçš„åº”ç”¨"></a>æ ‡å‡†åº“intrins.hä¸­çš„å¾ªç¯æŒ‡ä»¤åœ¨å¤šç§æµæ°´ç¯æ–¹å¼ä¸Šçš„åº”ç”¨</h1><h3 id="æ ‡å‡†åº“intrins-hä¸­çš„å¾ªç¯æŒ‡ä»¤åœ¨å¤šç§æµæ°´ç¯æ–¹å¼ä¸Šçš„åº”ç”¨-1"><a href="#æ ‡å‡†åº“intrins-hä¸­çš„å¾ªç¯æŒ‡ä»¤åœ¨å¤šç§æµæ°´ç¯æ–¹å¼ä¸Šçš„åº”ç”¨-1" class="headerlink" title="æ ‡å‡†åº“intrins.hä¸­çš„å¾ªç¯æŒ‡ä»¤åœ¨å¤šç§æµæ°´ç¯æ–¹å¼ä¸Šçš„åº”ç”¨"></a>æ ‡å‡†åº“intrins.hä¸­çš„å¾ªç¯æŒ‡ä»¤åœ¨å¤šç§æµæ°´ç¯æ–¹å¼ä¸Šçš„åº”ç”¨</h3><p>å†…éƒ¨å‡½æ•° æè¿°ï¼š ã€€ã€€crol å­—ç¬¦å¾ªç¯å·¦ç§» ã€€ã€€cror å­—ç¬¦å¾ªç¯å³ç§» ã€€ã€€irol æ•´æ•°å¾ªç¯å·¦ç§» ã€€ã€€iror æ•´æ•°å¾ªç¯å³ç§» ã€€ã€€lrol é•¿æ•´æ•°å¾ªç¯å·¦ç§» ã€€ã€€lror é•¿æ•´æ•°å¾ªç¯å³ç§» ã€€ã€€nop ç©ºæ“ä½œ8051 NOP æŒ‡ä»¤ æµæ°´ç¯å¸¸ç”¨åˆ°çš„ä¸¤ä¸ªæŒ‡ä»¤å°±æ˜¯ï¼š<em>crol</em> å­—ç¬¦å¾ªç¯å·¦ç§»ï¼› ã€€ã€€<em>cror</em> å­—ç¬¦å¾ªç¯å³ç§»ï¼›</p><p><code>_crol_ å­—ç¬¦å¾ªç¯å·¦ç§»ï¼› ã€€ã€€_cror_ å­—ç¬¦å¾ªç¯å³ç§»ï¼›</code></p><p><img src="https://img-blog.csdnimg.cn/20210202104229131.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç”¨_crol_å‡½æ•°å®ç°LEDæµæ°´ç¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;reg52.h&quot;</span><br><span class="line">#include &quot;intrins.h&quot;</span><br><span class="line">typedef unsigned int u16;</span><br><span class="line">typedef unsigned char u8;</span><br><span class="line">#define led P2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void delay(u16 i)</span><br><span class="line">&#123;</span><br><span class="line">    while(i--)</span><br><span class="line">    &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">        while(1)</span><br><span class="line">    &#123;</span><br><span class="line">       led=0xfe;                //D1äº® ï¼Œå…¶å®ƒç¯ä¸äº®</span><br><span class="line">       delay(60000);</span><br><span class="line">       </span><br><span class="line">       led=_crol_(led,1);        //0xFD  D2äº®,å…¶å®ƒä¸äº® </span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_crol_(led,1);       //D3äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_crol_(led,1);       //D4äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_crol_(led,1);       //D5äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_crol_(led,1);       //D6äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_crol_(led,1);       //D7äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_crol_(led,1);       //D8äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       //è®©D7å¼€å§‹äº® ä¸€ç›´åˆ°D1</span><br><span class="line"></span><br><span class="line">       led=_cror_(led,1);      //D7äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_cror_(led,1);      //D6äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_cror_(led,1);      //D5äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_cror_(led,1);      //D4äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_cror_(led,1);      //D3äº®</span><br><span class="line">       delay(60000);</span><br><span class="line"></span><br><span class="line">       led=_cror_(led,1);      //D2äº®</span><br><span class="line">       delay(60000);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œreg52.hâ€<br>#include â€œintrins.hâ€<br>typedef unsigned int u16;<br>typedef unsigned char u8;<br>#define led P2</p><p>void delay(u16 i)<br>{<br>    while(iâ€“)<br>    {};<br>}</p><p>void main(void)<br>{</p><pre><code>    while(1)&#123;   led=0xfe;                //D1äº® ï¼Œå…¶å®ƒç¯ä¸äº®   delay(60000);      led=_crol_(led,1);        //0xFD  D2äº®,å…¶å®ƒä¸äº®    delay(60000);   led=_crol_(led,1);       //D3äº®   delay(60000);   led=_crol_(led,1);       //D4äº®   delay(60000);   led=_crol_(led,1);       //D5äº®   delay(60000);   led=_crol_(led,1);       //D6äº®   delay(60000);   led=_crol_(led,1);       //D7äº®   delay(60000);   led=_crol_(led,1);       //D8äº®   delay(60000);   //è®©D7å¼€å§‹äº® ä¸€ç›´åˆ°D1   led=_cror_(led,1);      //D7äº®   delay(60000);   led=_cror_(led,1);      //D6äº®   delay(60000);   led=_cror_(led,1);      //D5äº®   delay(60000);   led=_cror_(led,1);      //D4äº®   delay(60000);   led=_cror_(led,1);      //D3äº®   delay(60000);   led=_cror_(led,1);      //D2äº®   delay(60000);&#125;</code></pre><p>}&#96;</p><p>ç®€æ´ä¸€ç‚¹çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">typedef unsigned int uint;</span><br><span class="line">typedef unsigned char uchar;</span><br><span class="line">#define led P2</span><br><span class="line">uchar temp;</span><br><span class="line"></span><br><span class="line">void delay(uint z)//å»¶æ—¶å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">uint x,y;</span><br><span class="line">for(x = z;x&gt;0;x--)</span><br><span class="line">for(y=114;y&gt;0;y--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"> temp = 0xfe;</span><br><span class="line">led = temp;</span><br><span class="line"> delay(1000);</span><br><span class="line"></span><br><span class="line">        while(1)</span><br><span class="line">    &#123;</span><br><span class="line">       temp = _crol_(temp,1);        //tempå˜é‡è‡ªèº«å·¦ç§»ç§»ä½</span><br><span class="line">led = temp;</span><br><span class="line">       delay(1000);</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;<br>typedef unsigned int uint;<br>typedef unsigned char uchar;<br>#define led P2<br>uchar temp;</p><p>void delay(uint z)&#x2F;&#x2F;å»¶æ—¶å‡½æ•°<br>{<br>    uint x,y;<br>    for(x &#x3D; z;x&gt;0;xâ€“)<br>        for(y&#x3D;114;y&gt;0;yâ€“);<br>}</p><p>void main(void)<br>{<br>     temp &#x3D; 0xfe;<br>    led &#x3D; temp;<br>     delay(1000);</p><pre><code>    while(1)&#123;   temp = _crol_(temp,1);        //tempå˜é‡è‡ªèº«å·¦ç§»ç§»ä½            led = temp;   delay(1000);&#125;</code></pre><p>}&#96;</p><p>ç”¨æ•°ç»„å®ç°æµæ°´ç¯æ•ˆæœä»£ç ;</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;reg52.h&gt;</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">uchar i;</span><br><span class="line">uchar  table[]=&#123;0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f&#125;;</span><br><span class="line"></span><br><span class="line">void delay(uint z)</span><br><span class="line">&#123;</span><br><span class="line">uint x,y;</span><br><span class="line">for(x=100;x&gt;0;x--)</span><br><span class="line">for(y=z;y&gt;0;y--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;  </span><br><span class="line"></span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">&#123;</span><br><span class="line">P2=table[i];</span><br><span class="line">delay(3000);</span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include&lt;reg52.h&gt;<br>#include&lt;intrins.h&gt;<br>#define uint unsigned int<br>#define uchar unsigned char<br>uchar i;<br>uchar  table[]&#x3D;{0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};</p><p>void delay(uint z)<br>{<br>    uint x,y;<br>    for(x&#x3D;100;x&gt;0;xâ€“)<br>        for(y&#x3D;z;y&gt;0;yâ€“);<br>}</p><p>void main()<br>{  </p><pre><code>while(1)&#123;    for(i=0;i&lt;8;i++)    &#123;        P2=table[i];        delay(3000);    &#125;      &#125;</code></pre><p>}&#96;</p><p>forå¾ªç¯å®ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;reg52.h&quot;</span><br><span class="line">#include &quot;intrins.h&quot;</span><br><span class="line">typedef unsigned int u16;</span><br><span class="line">typedef unsigned char u8;</span><br><span class="line">#define led P2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void delay(u16 z)</span><br><span class="line">&#123;</span><br><span class="line">u16 x,y;</span><br><span class="line">for(x=100;x&gt;0;x--)</span><br><span class="line">for(y=z;y&gt;0;y--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">u8 i;</span><br><span class="line">while (1)</span><br><span class="line">&#123;</span><br><span class="line">u8 aa;</span><br><span class="line">aa=0xfe;</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">&#123;</span><br><span class="line">P2=aa;</span><br><span class="line">delay(1000);</span><br><span class="line">aa=_crol_(aa,1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">aa=0x7f;</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">&#123;</span><br><span class="line">P2=aa;</span><br><span class="line">delay(1000);</span><br><span class="line">aa=_cror_(aa,1);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œreg52.hâ€<br>#include â€œintrins.hâ€<br>typedef unsigned int u16;<br>typedef unsigned char u8;<br>#define led P2</p><p>void delay(u16 z)<br>{<br>    u16 x,y;<br>    for(x&#x3D;100;x&gt;0;xâ€“)<br>        for(y&#x3D;z;y&gt;0;yâ€“);<br>}</p><p>void main(void)<br>{</p><pre><code>u8 i;while (1)&#123;    u8 aa;    aa=0xfe;    for(i=0;i&lt;8;i++)    &#123;        P2=aa;        delay(1000);        aa=_crol_(aa,1);    &#125;        aa=0x7f;    for(i=0;i&lt;8;i++)    &#123;        P2=aa;        delay(1000);        aa=_cror_(aa,1);    &#125;&#125;    </code></pre><p>}&#96;</p><p>å·¦ç§»æŒ‡ä»¤æ•ˆæœï¼š</p><p><img src="https://img-blog.csdnimg.cn/20210202144812855.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">typedef unsigned int uint;</span><br><span class="line">typedef unsigned char uchar;</span><br><span class="line">#define led P2</span><br><span class="line">uchar temp;</span><br><span class="line">uchar i;</span><br><span class="line">void delay(uint z)</span><br><span class="line">&#123;</span><br><span class="line">uint x,y;</span><br><span class="line">for(x = z;x&gt;0;x--)</span><br><span class="line">for(y=114;y&gt;0;y--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"> temp = 0x01;</span><br><span class="line">led = temp;</span><br><span class="line"> delay(1000);</span><br><span class="line"></span><br><span class="line">  for(i=0;i&lt;8;i++)&#123;</span><br><span class="line">    //   temp = _crol_(temp,1);        //å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚</span><br><span class="line">temp =temp&lt;&lt;1 ;</span><br><span class="line">led = temp;</span><br><span class="line">       delay(1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ï¼Œåè¿‡æ¥é˜¶æ¢¯ç­ï¼Œäº®</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;<br>typedef unsigned int uint;<br>typedef unsigned char uchar;<br>#define led P2<br>uchar temp;<br>uchar i;<br>void delay(uint z)<br>{<br>    uint x,y;<br>    for(x &#x3D; z;x&gt;0;xâ€“)<br>        for(y&#x3D;114;y&gt;0;yâ€“);<br>}</p><p>void main(void)<br>{<br>     temp &#x3D; 0x01;<br>    led &#x3D; temp;<br>     delay(1000);</p><p>  for(i&#x3D;0;i&lt;8;i++){<br>    &#x2F;&#x2F;   temp &#x3D; <em>crol</em>(temp,1);        &#x2F;&#x2F;å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚<br>        temp &#x3D;temp&lt;&lt;1 ;<br>                led &#x3D; temp;<br>       delay(1000);<br>    }</p><p>}</p><p>å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ï¼Œåè¿‡æ¥é˜¶æ¢¯ç­ï¼Œäº®&#96;</p><p>#include &lt;reg52.h&gt; #include &lt;intrins.h&gt; typedef unsigned int uint; typedef unsigned char uchar; #define led P2 uchar temp; uchar i; void delay(uint z) { uint x,y; for(x &#x3D; z;x&gt;0;xâ€“) for(y&#x3D;114;y&gt;0;yâ€“); }</p><p>void main(void) { temp &#x3D; 0x01; led &#x3D; temp; delay(1000);</p><p>for(i&#x3D;0;i&lt;8;i++){ &#x2F;&#x2F; temp &#x3D; crol(temp,1); &#x2F;&#x2F;å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">temp =temp&lt;&lt;1 ;</span><br><span class="line">led = temp;</span><br><span class="line">   delay(1000);</span><br><span class="line">&#125;</span><br><span class="line">temp = 0x80;</span><br></pre></td></tr></table></figure><p><code>temp =temp&lt;&lt;1 ;             led = temp;    delay(1000); &#125; temp = 0x80;</code></p><p>for(i&#x3D;0;i&lt;8;i++){ &#x2F;&#x2F; temp &#x3D; crol(temp,1); &#x2F;&#x2F;å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚ temp &#x3D;temp&gt;&gt;1 ; led &#x3D; temp;  delay(1000); } }</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—+MP3-TF-16Pæ¨¡å—å®ç°è¯­éŸ³äº¤äº’åŠŸèƒ½</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-LD3320%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E6%A8%A1%E5%9D%97MP3TF16P%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E8%AF%AD%E9%9F%B3%E4%BA%A4%E4%BA%92%E5%8A%9F%E8%83%BD/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-LD3320%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E6%A8%A1%E5%9D%97MP3TF16P%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E8%AF%AD%E9%9F%B3%E4%BA%A4%E4%BA%92%E5%8A%9F%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—-MP3-TF-16Pæ¨¡å—å®ç°è¯­éŸ³äº¤äº’åŠŸèƒ½"><a href="#LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—-MP3-TF-16Pæ¨¡å—å®ç°è¯­éŸ³äº¤äº’åŠŸèƒ½" class="headerlink" title="LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—+MP3-TF-16Pæ¨¡å—å®ç°è¯­éŸ³äº¤äº’åŠŸèƒ½"></a>LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—+MP3-TF-16Pæ¨¡å—å®ç°è¯­éŸ³äº¤äº’åŠŸèƒ½</h1><h3 id="LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—-MP3-TF-16Pæ¨¡å—å®ç°è¯­éŸ³äº¤äº’åŠŸèƒ½-1"><a href="#LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—-MP3-TF-16Pæ¨¡å—å®ç°è¯­éŸ³äº¤äº’åŠŸèƒ½-1" class="headerlink" title="LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—+MP3-TF-16Pæ¨¡å—å®ç°è¯­éŸ³äº¤äº’åŠŸèƒ½"></a>LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—+MP3-TF-16Pæ¨¡å—å®ç°è¯­éŸ³äº¤äº’åŠŸèƒ½</h3><h5 id="ğŸ”–åˆ©ç”¨LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—å¯ä»¥å®ç°éç‰¹å®šäººå£°è¯­éŸ³æ§åˆ¶å•ç‰‡æœºioå£åŠ¨ä½œï¼Œè€ŒåŠ å…¥MP3-TF-16Pè¯­éŸ³æ’­æ”¾æ¨¡å—ï¼Œå¯ä»¥è®©è¯­éŸ³å®ç°äº¤äº’åŠŸèƒ½ã€‚"><a href="#ğŸ”–åˆ©ç”¨LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—å¯ä»¥å®ç°éç‰¹å®šäººå£°è¯­éŸ³æ§åˆ¶å•ç‰‡æœºioå£åŠ¨ä½œï¼Œè€ŒåŠ å…¥MP3-TF-16Pè¯­éŸ³æ’­æ”¾æ¨¡å—ï¼Œå¯ä»¥è®©è¯­éŸ³å®ç°äº¤äº’åŠŸèƒ½ã€‚" class="headerlink" title="ğŸ”–åˆ©ç”¨LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—å¯ä»¥å®ç°éç‰¹å®šäººå£°è¯­éŸ³æ§åˆ¶å•ç‰‡æœºioå£åŠ¨ä½œï¼Œè€ŒåŠ å…¥MP3-TF-16Pè¯­éŸ³æ’­æ”¾æ¨¡å—ï¼Œå¯ä»¥è®©è¯­éŸ³å®ç°äº¤äº’åŠŸèƒ½ã€‚"></a>ğŸ”–åˆ©ç”¨LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—å¯ä»¥å®ç°éç‰¹å®šäººå£°è¯­éŸ³æ§åˆ¶å•ç‰‡æœºioå£åŠ¨ä½œï¼Œè€ŒåŠ å…¥MP3-TF-16Pè¯­éŸ³æ’­æ”¾æ¨¡å—ï¼Œå¯ä»¥è®©è¯­éŸ³å®ç°äº¤äº’åŠŸèƒ½ã€‚</h5><ul><li><p>ğŸ“‹åŸç†å°±æ˜¯åˆ©ç”¨ä¸¤ä¸ªæ¨¡å—è¿›è¡Œä¸²å£æ”¶å‘æ•°æ®ï¼Œå®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ã€‚</p></li><li><p>MP3-TF-16Pæ¨¡å—:</p></li><li><p>LD3320è¯­éŸ³è¯†åˆ«æ¨¡å—:</p></li></ul><p><img src="https://img-blog.csdnimg.cn/20200720230033702.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80Mjg4MDA4Mg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20200720230314395.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>åˆ©ç”¨æ‰€ç»™å•†å®¶èµ„æ–™ï¼Œè¿›è¡Œè¿›è¡Œä¸ªæ€§åŒ–éœ€æ±‚è°ƒæ•´ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/20200720230751184.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>man.cé‡Œé¢çš„ä»£ç </li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><span class="line">/******************************************************</span><br><span class="line">**  å·¥ç¨‹åç§°ï¼šUNV-01è¯­éŸ³è¯†åˆ«æ¨¡å—é©±åŠ¨ç¨‹åº</span><br><span class="line">**CPU: STC11L08XE</span><br><span class="line">**æ™¶æŒ¯ï¼š22.1184MHZ</span><br><span class="line">**æ³¢ç‰¹ç‡ï¼š9600 bit/S</span><br><span class="line">**é…å¥—äº§å“ä¿¡æ¯ï¼šUNV-LD3320+STC11è¯­éŸ³è¯†åˆ«å¼€å‘æ¿</span><br><span class="line">**  ä¿®æ”¹æ—¥æœŸï¼š2018.5.13</span><br><span class="line">**  è¯´æ˜ï¼šå£ä»¤æ¨¡å¼ï¼š å³æ¯æ¬¡è¯†åˆ«æ—¶éƒ½éœ€è¦è¯´â€œå°é¹°â€è¿™ä¸ªå£ä»¤ ï¼Œæ‰èƒ½å¤Ÿè¿›è¡Œä¸‹ä¸€çº§çš„è¯†åˆ«</span><br><span class="line">***************************/</span><br><span class="line">#include &quot;config.h&quot;</span><br><span class="line">/************************************************************************************/</span><br><span class="line">//nAsrStatus ç”¨æ¥åœ¨mainä¸»ç¨‹åºä¸­è¡¨ç¤ºç¨‹åºè¿è¡Œçš„çŠ¶æ€ï¼Œä¸æ˜¯LD3320èŠ¯ç‰‡å†…éƒ¨çš„çŠ¶æ€å¯„å­˜å™¨</span><br><span class="line">//LD_ASR_NONE:è¡¨ç¤ºæ²¡æœ‰åœ¨ä½œASRè¯†åˆ«</span><br><span class="line">//LD_ASR_RUNINGï¼šè¡¨ç¤ºLD3320æ­£åœ¨ä½œASRè¯†åˆ«ä¸­</span><br><span class="line">//LD_ASR_FOUNDOK:è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ç»“æŸåï¼Œæœ‰ä¸€ä¸ªè¯†åˆ«ç»“æœ</span><br><span class="line">//LD_ASR_FOUNDZERO:è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ç»“æŸåï¼Œæ²¡æœ‰è¯†åˆ«ç»“æœ</span><br><span class="line">//LD_ASR_ERROR:è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ä¸­LD3320èŠ¯ç‰‡å†…éƒ¨å‡ºç°ä¸æ­£ç¡®çš„çŠ¶æ€</span><br><span class="line">/***********************************************************************************/</span><br><span class="line">uint8 idata nAsrStatus=0;</span><br><span class="line">void MCU_init(); </span><br><span class="line">void ProcessInt0(); //è¯†åˆ«å¤„ç†å‡½æ•°</span><br><span class="line">void delay(unsigned long uldata);</span><br><span class="line">void User_handle(uint8 dat);//ç”¨æˆ·æ‰§è¡Œæ“ä½œå‡½æ•°</span><br><span class="line">void Uart_SendCMD(int CMD ,int feedback , int dat);</span><br><span class="line">void Delay200ms();</span><br><span class="line">void Led_test(void);//å•ç‰‡æœºå·¥ä½œæŒ‡ç¤º</span><br><span class="line">uint8_t G0_flag=DISABLE;//è¿è¡Œæ ‡å¿—ï¼ŒENABLE:è¿è¡Œã€‚DISABLE:ç¦æ­¢è¿è¡Œ</span><br><span class="line"></span><br><span class="line">sbit LED=P4^2;//ä¿¡å·æŒ‡ç¤ºç¯</span><br><span class="line"></span><br><span class="line">//åº”ç”¨IOå£å®šä¹‰ ï¼ˆæ¨¡å—æ ‡æ³¨ P2ï¼‰</span><br><span class="line">sbit PA1=P1^0; //å¯¹åº”æ¿ä¸Šæ ‡å· P1.0</span><br><span class="line">sbit PA2=P1^1;  //å¯¹åº”æ¿ä¸Šæ ‡å· P1.1</span><br><span class="line">sbit PA3=P1^2;  //.....</span><br><span class="line">sbit PA4=P1^3;  //.....</span><br><span class="line">sbit PA5=P1^4;  //.....</span><br><span class="line">sbit PA6=P1^5;  //.....</span><br><span class="line">sbit PA7=P1^6;  //å¯¹åº”æ¿ä¸Šæ ‡å· P1.6</span><br><span class="line">sbit PA8=P1^7;  //å¯¹åº”æ¿ä¸Šæ ‡å· P1.7</span><br><span class="line">sbit PA9=P4^1;  //å¯¹åº”æ¿ä¸Šæ ‡å· P4.1</span><br><span class="line">sbit PA10=P4^7;  //å¯¹åº”æ¿ä¸Šæ ‡å· P2.7</span><br><span class="line">sbit PA11=P2^6;  //å¯¹åº”æ¿ä¸Šæ ‡å· P2.6</span><br><span class="line">sbit PA12=P2^5;  //å¯¹åº”æ¿ä¸Šæ ‡å· P2.5</span><br><span class="line">sbit PA13=P2^4;  //å¯¹åº”æ¿ä¸Šæ ‡å· P2.4</span><br><span class="line">sbit PA14=P2^3;  //å¯¹åº”æ¿ä¸Šæ ‡å· P2.3</span><br><span class="line">sbit PA15=P3^3;  //å¯¹åº”æ¿ä¸Šæ ‡å· P3.3</span><br><span class="line">sbit PA16=P3^4;  //å¯¹åº”æ¿ä¸Šæ ‡å· P3.4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/***********************************************************</span><br><span class="line">* å    ç§°ï¼š void  main(void)</span><br><span class="line">* åŠŸ    èƒ½ï¼š ä¸»å‡½æ•°ç¨‹åºå…¥å£</span><br><span class="line">* å…¥å£å‚æ•°ï¼š  </span><br><span class="line">* å‡ºå£å‚æ•°ï¼š</span><br><span class="line">* è¯´    æ˜ï¼š  </span><br><span class="line">* è°ƒç”¨æ–¹æ³•ï¼š </span><br><span class="line">**********************************************************/ </span><br><span class="line">void  main(void)</span><br><span class="line">&#123;</span><br><span class="line">uint8 idata nAsrRes;</span><br><span class="line">uint8 i=0;</span><br><span class="line">Led_test();</span><br><span class="line">MCU_init();</span><br><span class="line">LD_Reset();</span><br><span class="line">UartIni(); /*ä¸²å£åˆå§‹åŒ–*/</span><br><span class="line">nAsrStatus = LD_ASR_NONE;//åˆå§‹çŠ¶æ€ï¼šæ²¡æœ‰åœ¨ä½œASR</span><br><span class="line"></span><br><span class="line">//å¤ä½æ‰€æœ‰ioä¸ºä½ç”µå¹³</span><br><span class="line">PA1 &amp;=0x00; </span><br><span class="line">PA2 &amp;=0x00; </span><br><span class="line">PA3 &amp;=0x00; </span><br><span class="line">PA4 &amp;=0x00; </span><br><span class="line">PA5 &amp;=0x00; </span><br><span class="line">PA6 &amp;=0x00; </span><br><span class="line">PA7 &amp;=0x00; </span><br><span class="line">PA8 &amp;=0x00; </span><br><span class="line">PA9 &amp;=0x00; </span><br><span class="line">PA10 &amp;=0x00; </span><br><span class="line">PA11 &amp;=0x00; </span><br><span class="line">PA12 &amp;=0x00; </span><br><span class="line">PA13 &amp;=0x00; </span><br><span class="line">PA14 &amp;=0x00; </span><br><span class="line">PA15 &amp;=0x00; </span><br><span class="line">PA16 &amp;=0x00; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">switch(nAsrStatus)</span><br><span class="line">&#123;</span><br><span class="line">case LD_ASR_RUNING:</span><br><span class="line">case LD_ASR_ERROR:</span><br><span class="line">break;</span><br><span class="line">case LD_ASR_NONE:</span><br><span class="line">&#123;</span><br><span class="line">nAsrStatus=LD_ASR_RUNING;</span><br><span class="line">if (RunASR()==0)/*å¯åŠ¨ä¸€æ¬¡ASRè¯†åˆ«æµç¨‹ï¼šASRåˆå§‹åŒ–ï¼ŒASRæ·»åŠ å…³é”®è¯è¯­ï¼Œå¯åŠ¨ASRè¿ç®—*/</span><br><span class="line">&#123;</span><br><span class="line">nAsrStatus = LD_ASR_ERROR;</span><br><span class="line">&#125;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">case LD_ASR_FOUNDOK: /*ä¸€æ¬¡ASRè¯†åˆ«æµç¨‹ç»“æŸï¼Œå»å–ASRè¯†åˆ«ç»“æœ*/</span><br><span class="line">&#123;</span><br><span class="line">nAsrRes = LD_GetResult();/*è·å–ç»“æœ*/</span><br><span class="line">User_handle(nAsrRes);//ç”¨æˆ·æ‰§è¡Œå‡½æ•° </span><br><span class="line">nAsrStatus = LD_ASR_NONE;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">case LD_ASR_FOUNDZERO:</span><br><span class="line">default:</span><br><span class="line">&#123;</span><br><span class="line">nAsrStatus = LD_ASR_NONE;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;// switch </span><br><span class="line">&#125;// while</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/***********************************************************</span><br><span class="line">* å    ç§°ï¼š  LEDç¯æµ‹è¯•</span><br><span class="line">* åŠŸ    èƒ½ï¼š å•ç‰‡æœºæ˜¯å¦å·¥ä½œæŒ‡ç¤º</span><br><span class="line">* å…¥å£å‚æ•°ï¼š æ—  </span><br><span class="line">* å‡ºå£å‚æ•°ï¼šæ— </span><br><span class="line">* è¯´    æ˜ï¼š  </span><br><span class="line">**********************************************************/</span><br><span class="line">void Led_test(void)</span><br><span class="line">&#123;</span><br><span class="line">LED=~ LED;</span><br><span class="line">Delay200ms();;</span><br><span class="line">LED=~ LED;</span><br><span class="line">Delay200ms();;</span><br><span class="line">LED=~ LED;</span><br><span class="line">Delay200ms();;</span><br><span class="line">LED=~ LED;</span><br><span class="line">&#125;</span><br><span class="line">/***********************************************************</span><br><span class="line">* å    ç§°ï¼š void MCU_init()</span><br><span class="line">* åŠŸ    èƒ½ï¼š </span><br><span class="line">* å…¥å£å‚æ•°ï¼š  </span><br><span class="line">* å‡ºå£å‚æ•°ï¼š</span><br><span class="line">* è¯´    æ˜ï¼š  </span><br><span class="line">* è°ƒç”¨æ–¹æ³•ï¼š </span><br><span class="line">**********************************************************/ </span><br><span class="line">void MCU_init()</span><br><span class="line">&#123;</span><br><span class="line">P0 = 0xff;</span><br><span class="line">P1 = 0xff;</span><br><span class="line">P2 = 0xff;</span><br><span class="line">P3 = 0xff;</span><br><span class="line">P4 = 0xff;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LD_MODE = 0;//è®¾ç½®MDç®¡è„šä¸ºä½ï¼Œå¹¶è¡Œæ¨¡å¼è¯»å†™</span><br><span class="line">IE0=1;</span><br><span class="line">EX0=1;</span><br><span class="line">EA=1;</span><br><span class="line">&#125;</span><br><span class="line">/***********************************************************</span><br><span class="line">* å    ç§°ï¼šå»¶æ—¶å‡½æ•°</span><br><span class="line">* åŠŸ    èƒ½ï¼š</span><br><span class="line">* å…¥å£å‚æ•°ï¼š  </span><br><span class="line">* å‡ºå£å‚æ•°ï¼š</span><br><span class="line">* è¯´    æ˜ï¼š  </span><br><span class="line">* è°ƒç”¨æ–¹æ³•ï¼š </span><br><span class="line">**********************************************************/ </span><br><span class="line">void Delay200us()//@22.1184MHz</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i, j;</span><br><span class="line">_nop_();</span><br><span class="line">_nop_();</span><br><span class="line">i = 5;</span><br><span class="line">j = 73;</span><br><span class="line">do</span><br><span class="line">&#123;</span><br><span class="line">while (--j);</span><br><span class="line">&#125; while (--i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void  delay(unsigned long uldata)</span><br><span class="line">&#123;</span><br><span class="line">unsigned int j  =  0;</span><br><span class="line">unsigned int g  =  0;</span><br><span class="line">while(uldata--)</span><br><span class="line">Delay200us();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Delay200ms()//@22.1184MHz</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i, j, k;</span><br><span class="line"></span><br><span class="line">i = 17;</span><br><span class="line">j = 208;</span><br><span class="line">k = 27;</span><br><span class="line">do</span><br><span class="line">&#123;</span><br><span class="line">do</span><br><span class="line">&#123;</span><br><span class="line">while (--k);</span><br><span class="line">&#125; while (--j);</span><br><span class="line">&#125; while (--i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/***********************************************************</span><br><span class="line">* å    ç§°ï¼š ä¸­æ–­å¤„ç†å‡½æ•°</span><br><span class="line">* åŠŸ    èƒ½ï¼š</span><br><span class="line">* å…¥å£å‚æ•°ï¼š  </span><br><span class="line">* å‡ºå£å‚æ•°ï¼š</span><br><span class="line">* è¯´    æ˜ï¼š  </span><br><span class="line">* è°ƒç”¨æ–¹æ³•ï¼š </span><br><span class="line">**********************************************************/ </span><br><span class="line">void ExtInt0Handler(void) interrupt 0  </span><br><span class="line">&#123; </span><br><span class="line">ProcessInt0();</span><br><span class="line">&#125;</span><br><span class="line">/***********************************************************</span><br><span class="line">* å    ç§°ï¼šç”¨æˆ·æ‰§è¡Œå‡½æ•° </span><br><span class="line">* åŠŸ    èƒ½ï¼šè¯†åˆ«æˆåŠŸåï¼Œæ‰§è¡ŒåŠ¨ä½œå¯åœ¨æ­¤è¿›è¡Œä¿®æ”¹ </span><br><span class="line">* å…¥å£å‚æ•°ï¼š æ—  </span><br><span class="line">* å‡ºå£å‚æ•°ï¼šæ— </span><br><span class="line">* è¯´    æ˜ï¼š  </span><br><span class="line">**********************************************************/</span><br><span class="line">void User_handle(uint8 dat)</span><br><span class="line">&#123;</span><br><span class="line">     //UARTSendByte(dat);//ä¸²å£è¯†åˆ«ç ï¼ˆåå…­è¿›åˆ¶ï¼‰</span><br><span class="line"> if(0==dat)  //åˆ¤æ–­æ˜¯å¦è¯†åˆ«ä¸€çº§å£ä»¤</span><br><span class="line"> &#123;</span><br><span class="line">  G0_flag=ENABLE;</span><br><span class="line">LED = 0;</span><br><span class="line">delay(10);</span><br><span class="line">Uart_SendCMD(0x03 , 0, 0x01);  //æ’­æ”¾ç¬¬ä¸€é¦–</span><br><span class="line">delay(10);</span><br><span class="line"> &#125;</span><br><span class="line"> else if(ENABLE==G0_flag)</span><br><span class="line"> &#123;</span><br><span class="line"> G0_flag=DISABLE;</span><br><span class="line">LED=1;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"> switch(dat)   </span><br><span class="line">  &#123;</span><br><span class="line">  case CODE_KFBYZ:/*å‘½ä»¤â€œå¼€å‘æ¿éªŒè¯â€*/</span><br><span class="line"> PA1 &amp;=0x01; </span><br><span class="line">                 delay(50);</span><br><span class="line">  Uart_SendCMD(0x03,0,0x02); //æ’­æ”¾ç¬¬17é¦–</span><br><span class="line">               delay(50);</span><br><span class="line"> break;</span><br><span class="line">case CODE_DKJDQ:    /*å‘½ä»¤â€œæ‰“å¼€ç»§ç”µå™¨â€*/</span><br><span class="line"> PA2 &amp;=0x01; </span><br><span class="line">               delay(50);</span><br><span class="line"> Uart_SendCMD(0x03,0,0x03);  //æ’­æ”¾ç¬¬3é¦–</span><br><span class="line">       Delay200ms();</span><br><span class="line"> break;</span><br><span class="line">case CODE_GBJDQ:   /*å‘½ä»¤â€œå…³é—­ç»§ç”µå™¨â€*/</span><br><span class="line">PA2 &amp;=0x00;</span><br><span class="line">                 delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x04); //æ’­æ”¾ç¬¬4é¦–</span><br><span class="line">      delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_KD:   /*å‘½ä»¤â€œå¼€ç¯â€*/</span><br><span class="line">PA3 &amp;=0x01;</span><br><span class="line">                 delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x08);  //æ’­æ”¾ç¬¬8é¦–</span><br><span class="line">                 delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_GD:      /*å‘½ä»¤â€œå…³ç¯â€*/</span><br><span class="line">            PA3 &amp;=0x00; </span><br><span class="line">delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x07);//æ’­æ”¾ç¬¬7é¦–</span><br><span class="line">          delay(50);</span><br><span class="line">break;</span><br><span class="line">          case CODE_DKFS:     /*å‘½ä»¤â€œæ‰“å¼€é£æ‰‡â€*/</span><br><span class="line">          PA4 &amp;=0x01; </span><br><span class="line">                 delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x05);//æ’­æ”¾ç¬¬5é¦–</span><br><span class="line">                 delay(50);</span><br><span class="line">break;</span><br><span class="line">          case CODE_GBFS:     /*å‘½ä»¤â€œå…³é—­é£æ‰‡â€*/</span><br><span class="line">          PA4 &amp;=0x00; </span><br><span class="line">                delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x06);//æ’­æ”¾ç¬¬6é¦–</span><br><span class="line">                delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_BB:     /*å‘½ä»¤â€œæ‹œæ‹œâ€*/</span><br><span class="line">          PA5 &amp;=0x01; </span><br><span class="line">                delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x09);//æ’­æ”¾ç¬¬9é¦–</span><br><span class="line">                 delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_BFYY:     /*å‘½ä»¤â€œæ’­æ”¾æ­Œæ›²â€*/</span><br><span class="line">          PA6 &amp;=0x01; </span><br><span class="line">                 delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x0a);//æ’­æ”¾ç¬¬9é¦–</span><br><span class="line">                 delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_XYS:     /*å‘½ä»¤â€œä¸‹ä¸€æ›²â€*/</span><br><span class="line">          PA7 &amp;=0x01; </span><br><span class="line">                 delay(50);</span><br><span class="line">Uart_SendCMD(0x17,0,0x01);//å¾ªç¯æ’­æ”¾01æ–‡ä»¶å¤¹ä¸‹çš„æ›²ç›®</span><br><span class="line">               delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_PFZL:     /*å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€*/</span><br><span class="line">          PA8 &amp;=0x01; </span><br><span class="line">                 delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x0c);//æ’­æ”¾å¹³å‡¡ä¹‹è·¯</span><br><span class="line">                delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_MZ:     /*å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€*/</span><br><span class="line">          PA9 &amp;=0x01; </span><br><span class="line">                delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x10);//æ’­æ”¾èŠ’ç§</span><br><span class="line">                 delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_SN:     /*å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€*/</span><br><span class="line">          PA9 &amp;=0x01; </span><br><span class="line">                delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x0d);//æ’­æ”¾å°‘å¹´</span><br><span class="line">                delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_NDDA:     /*å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€*/</span><br><span class="line">          PA9 &amp;=0x01; </span><br><span class="line">               delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x0e);//æ’­æ”¾ä½ çš„ç­”æ¡ˆ</span><br><span class="line">                 delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_JL:     /*å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€*/</span><br><span class="line">          PA9 &amp;=0x01; </span><br><span class="line">                delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x0f);//æ’­æ”¾æƒŠé›·</span><br><span class="line">                 delay(50);</span><br><span class="line">break;</span><br><span class="line">case CODE_QYS:     /*å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€*/</span><br><span class="line">          PA1 &amp;=0x01; </span><br><span class="line">                delay(50);</span><br><span class="line">Uart_SendCMD(0x03,0,0x11);//æ’­æ”¾ä¸ƒæœˆä¸Š</span><br><span class="line">                 delay(50);</span><br><span class="line">break;</span><br><span class="line">default:</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;******************************************************<br>**  å·¥ç¨‹åç§°ï¼šUNV-01è¯­éŸ³è¯†åˆ«æ¨¡å—é©±åŠ¨ç¨‹åº<br>**CPU: STC11L08XE<br>**æ™¶æŒ¯ï¼š22.1184MHZ<br>**æ³¢ç‰¹ç‡ï¼š9600 bit&#x2F;S<br>**é…å¥—äº§å“ä¿¡æ¯ï¼šUNV-LD3320+STC11è¯­éŸ³è¯†åˆ«å¼€å‘æ¿<br>**  ä¿®æ”¹æ—¥æœŸï¼š2018.5.13<br>**  è¯´æ˜ï¼šå£ä»¤æ¨¡å¼ï¼š å³æ¯æ¬¡è¯†åˆ«æ—¶éƒ½éœ€è¦è¯´â€œå°é¹°â€è¿™ä¸ªå£ä»¤ ï¼Œæ‰èƒ½å¤Ÿè¿›è¡Œä¸‹ä¸€çº§çš„è¯†åˆ«<br><em><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>&#x2F;<br>#include â€œconfig.hâ€<br>&#x2F;</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em><em><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>&#x2F;<br>&#x2F;&#x2F;nAsrStatus ç”¨æ¥åœ¨mainä¸»ç¨‹åºä¸­è¡¨ç¤ºç¨‹åºè¿è¡Œçš„çŠ¶æ€ï¼Œä¸æ˜¯LD3320èŠ¯ç‰‡å†…éƒ¨çš„çŠ¶æ€å¯„å­˜å™¨<br>&#x2F;&#x2F;LD_ASR_NONE:è¡¨ç¤ºæ²¡æœ‰åœ¨ä½œASRè¯†åˆ«<br>&#x2F;&#x2F;LD_ASR_RUNINGï¼šè¡¨ç¤ºLD3320æ­£åœ¨ä½œASRè¯†åˆ«ä¸­<br>&#x2F;&#x2F;LD_ASR_FOUNDOK:è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ç»“æŸåï¼Œæœ‰ä¸€ä¸ªè¯†åˆ«ç»“æœ<br>&#x2F;&#x2F;LD_ASR_FOUNDZERO:è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ç»“æŸåï¼Œæ²¡æœ‰è¯†åˆ«ç»“æœ<br>&#x2F;&#x2F;LD_ASR_ERROR:è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ä¸­LD3320èŠ¯ç‰‡å†…éƒ¨å‡ºç°ä¸æ­£ç¡®çš„çŠ¶æ€<br>&#x2F;</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em>**************************&#x2F;<br>uint8 idata nAsrStatus&#x3D;0;<br>void MCU_init();<br>void ProcessInt0(); &#x2F;&#x2F;è¯†åˆ«å¤„ç†å‡½æ•°<br>void delay(unsigned long uldata);<br>void User_handle(uint8 dat);&#x2F;&#x2F;ç”¨æˆ·æ‰§è¡Œæ“ä½œå‡½æ•°<br>void Uart_SendCMD(int CMD ,int feedback , int dat);<br>void Delay200ms();<br>void Led_test(void);&#x2F;&#x2F;å•ç‰‡æœºå·¥ä½œæŒ‡ç¤º<br>uint8_t G0_flag&#x3D;DISABLE;&#x2F;&#x2F;è¿è¡Œæ ‡å¿—ï¼ŒENABLE:è¿è¡Œã€‚DISABLE:ç¦æ­¢è¿è¡Œ</p><p>sbit LED&#x3D;P4^2;&#x2F;&#x2F;ä¿¡å·æŒ‡ç¤ºç¯</p><p>&#x2F;&#x2F;åº”ç”¨IOå£å®šä¹‰ ï¼ˆæ¨¡å—æ ‡æ³¨ P2ï¼‰<br>sbit PA1&#x3D;P1^0; &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P1.0<br>sbit PA2&#x3D;P1^1;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P1.1<br>sbit PA3&#x3D;P1^2;  &#x2F;&#x2F;â€¦..<br>sbit PA4&#x3D;P1^3;  &#x2F;&#x2F;â€¦..<br>sbit PA5&#x3D;P1^4;  &#x2F;&#x2F;â€¦..<br>sbit PA6&#x3D;P1^5;  &#x2F;&#x2F;â€¦..<br>sbit PA7&#x3D;P1^6;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P1.6<br>sbit PA8&#x3D;P1^7;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P1.7<br>sbit PA9&#x3D;P4^1;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P4.1<br>sbit PA10&#x3D;P4^7;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P2.7<br>sbit PA11&#x3D;P2^6;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P2.6<br>sbit PA12&#x3D;P2^5;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P2.5<br>sbit PA13&#x3D;P2^4;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P2.4<br>sbit PA14&#x3D;P2^3;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P2.3<br>sbit PA15&#x3D;P3^3;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P3.3<br>sbit PA16&#x3D;P3^4;  &#x2F;&#x2F;å¯¹åº”æ¿ä¸Šæ ‡å· P3.4</p><p>&#x2F;***********************************************************</p><ul><li><p>å    ç§°ï¼š void  main(void)</p></li><li><p>åŠŸ    èƒ½ï¼š ä¸»å‡½æ•°ç¨‹åºå…¥å£</p></li><li><p>å…¥å£å‚æ•°ï¼š  </p></li><li><p>å‡ºå£å‚æ•°ï¼š</p></li><li><p>è¯´    æ˜ï¼š  </p></li><li><p>è°ƒç”¨æ–¹æ³•ï¼š<br>**********************************************************&#x2F;<br>void  main(void)<br>{<br>  uint8 idata nAsrRes;<br>  uint8 i&#x3D;0;<br>  Led_test();<br>  MCU_init();<br>  LD_Reset();<br>  UartIni(); &#x2F;<em>ä¸²å£åˆå§‹åŒ–</em>&#x2F;<br>  nAsrStatus &#x3D; LD_ASR_NONE;&#x2F;&#x2F;åˆå§‹çŠ¶æ€ï¼šæ²¡æœ‰åœ¨ä½œASR</p><p>  &#x2F;&#x2F;å¤ä½æ‰€æœ‰ioä¸ºä½ç”µå¹³</p></li></ul><p>PA1 &amp;&#x3D;0x00;<br>PA2 &amp;&#x3D;0x00;<br>PA3 &amp;&#x3D;0x00;<br>PA4 &amp;&#x3D;0x00;<br>PA5 &amp;&#x3D;0x00;<br>PA6 &amp;&#x3D;0x00;<br>PA7 &amp;&#x3D;0x00;<br>PA8 &amp;&#x3D;0x00;<br>PA9 &amp;&#x3D;0x00;<br>PA10 &amp;&#x3D;0x00;<br>PA11 &amp;&#x3D;0x00;<br>PA12 &amp;&#x3D;0x00;<br>PA13 &amp;&#x3D;0x00;<br>PA14 &amp;&#x3D;0x00;<br>PA15 &amp;&#x3D;0x00;<br>PA16 &amp;&#x3D;0x00; </p><pre><code>while(1)&#123;    switch(nAsrStatus)    &#123;        case LD_ASR_RUNING:        case LD_ASR_ERROR:            break;        case LD_ASR_NONE:        &#123;            nAsrStatus=LD_ASR_RUNING;            if (RunASR()==0)/*å¯åŠ¨ä¸€æ¬¡ASRè¯†åˆ«æµç¨‹ï¼šASRåˆå§‹åŒ–ï¼ŒASRæ·»åŠ å…³é”®è¯è¯­ï¼Œå¯åŠ¨ASRè¿ç®—*/            &#123;                nAsrStatus = LD_ASR_ERROR;            &#125;            break;        &#125;        case LD_ASR_FOUNDOK: /*ä¸€æ¬¡ASRè¯†åˆ«æµç¨‹ç»“æŸï¼Œå»å–ASRè¯†åˆ«ç»“æœ*/        &#123;            nAsrRes = LD_GetResult();/*è·å–ç»“æœ*/            User_handle(nAsrRes);//ç”¨æˆ·æ‰§è¡Œå‡½æ•°             nAsrStatus = LD_ASR_NONE;            break;        &#125;        case LD_ASR_FOUNDZERO:        default:        &#123;            nAsrStatus = LD_ASR_NONE;            break;        &#125;    &#125;// switch &#125;// while</code></pre><p>}<br>&#x2F;***********************************************************</p><ul><li><p>å    ç§°ï¼š  LEDç¯æµ‹è¯•</p></li><li><p>åŠŸ    èƒ½ï¼š å•ç‰‡æœºæ˜¯å¦å·¥ä½œæŒ‡ç¤º</p></li><li><p>å…¥å£å‚æ•°ï¼š æ—  </p></li><li><p>å‡ºå£å‚æ•°ï¼šæ— </p></li><li><p>è¯´    æ˜ï¼š <br><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>&#x2F;<br>void Led_test(void)<br>{<br>  LED&#x3D;~ LED;<br>  Delay200ms();;<br>  LED&#x3D;~ LED;<br>  Delay200ms();;<br>  LED&#x3D;~ LED;<br>  Delay200ms();;<br>  LED&#x3D;~ LED;<br>}<br>&#x2F;</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>*</p></li><li><p>å    ç§°ï¼š void MCU_init()</p></li><li><p>åŠŸ    èƒ½ï¼š </p></li><li><p>å…¥å£å‚æ•°ï¼š  </p></li><li><p>å‡ºå£å‚æ•°ï¼š</p></li><li><p>è¯´    æ˜ï¼š  </p></li><li><p>è°ƒç”¨æ–¹æ³•ï¼š<br>**********************************************************&#x2F;<br>void MCU_init()<br>{<br>  P0 &#x3D; 0xff;<br>  P1 &#x3D; 0xff;<br>  P2 &#x3D; 0xff;<br>  P3 &#x3D; 0xff;<br>  P4 &#x3D; 0xff;</p><p>  LD_MODE &#x3D; 0;&#x2F;&#x2F;è®¾ç½®MDç®¡è„šä¸ºä½ï¼Œå¹¶è¡Œæ¨¡å¼è¯»å†™<br>  IE0&#x3D;1;<br>  EX0&#x3D;1;<br>  EA&#x3D;1;</p></li></ul><p>}<br>&#x2F;***********************************************************</p><ul><li>å    ç§°ï¼šå»¶æ—¶å‡½æ•°</li><li>åŠŸ    èƒ½ï¼š</li><li>å…¥å£å‚æ•°ï¼š  </li><li>å‡ºå£å‚æ•°ï¼š</li><li>è¯´    æ˜ï¼š  </li><li>è°ƒç”¨æ–¹æ³•ï¼š<br>**********************************************************&#x2F;<br>void Delay200us()&#x2F;&#x2F;@22.1184MHz<br>{<br>  unsigned char i, j;<br>  <em>nop</em>();<br>  <em>nop</em>();<br>  i &#x3D; 5;<br>  j &#x3D; 73;<br>  do<br>  {<br>  while (â€“j);<br>  } while (â€“i);<br>}</li></ul><p>void  delay(unsigned long uldata)<br>{<br>    unsigned int j  &#x3D;  0;<br>    unsigned int g  &#x3D;  0;<br>    while(uldataâ€“)<br>    Delay200us();<br>}</p><p>void Delay200ms()&#x2F;&#x2F;@22.1184MHz<br>{<br>    unsigned char i, j, k;</p><pre><code>i = 17;j = 208;k = 27;do&#123;    do    &#123;        while (--k);    &#125; while (--j);&#125; while (--i);</code></pre><p>}</p><p>&#x2F;***********************************************************</p><ul><li>å    ç§°ï¼š ä¸­æ–­å¤„ç†å‡½æ•°</li><li>åŠŸ    èƒ½ï¼š</li><li>å…¥å£å‚æ•°ï¼š  </li><li>å‡ºå£å‚æ•°ï¼š</li><li>è¯´    æ˜ï¼š  </li><li>è°ƒç”¨æ–¹æ³•ï¼š<br><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>&#x2F;<br>void ExtInt0Handler(void) interrupt 0<br>{ <br>  ProcessInt0();<br>}<br>&#x2F;</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>*</li><li>å    ç§°ï¼šç”¨æˆ·æ‰§è¡Œå‡½æ•° </li><li>åŠŸ    èƒ½ï¼šè¯†åˆ«æˆåŠŸåï¼Œæ‰§è¡ŒåŠ¨ä½œå¯åœ¨æ­¤è¿›è¡Œä¿®æ”¹ </li><li>å…¥å£å‚æ•°ï¼š æ—  </li><li>å‡ºå£å‚æ•°ï¼šæ— </li><li>è¯´    æ˜ï¼š <br>**********************************************************&#x2F;<br>void User_handle(uint8 dat)<br>{<br>   &#x2F;&#x2F;UARTSendByte(dat);&#x2F;&#x2F;ä¸²å£è¯†åˆ«ç ï¼ˆåå…­è¿›åˆ¶ï¼‰<br>   if(0&#x3D;&#x3D;dat)  &#x2F;&#x2F;åˆ¤æ–­æ˜¯å¦è¯†åˆ«ä¸€çº§å£ä»¤<br>   {<br>    G0_flag&#x3D;ENABLE;<br>      LED &#x3D; 0;<br>      delay(10);<br>      Uart_SendCMD(0x03 , 0, 0x01);  &#x2F;&#x2F;æ’­æ”¾ç¬¬ä¸€é¦–<br>  delay(10);<br>   }<br>   else if(ENABLE&#x3D;&#x3D;G0_flag)<br>   {<br>           G0_flag&#x3D;DISABLE;<br>          LED&#x3D;1;<br><br><br><br>           switch(dat)<br>        {<br>            case CODE_KFBYZ:&#x2F;<em>å‘½ä»¤â€œå¼€å‘æ¿éªŒè¯â€</em>&#x2F;<br>                                               PA1 &amp;&#x3D;0x01;<br>                               delay(50);<br>                                                Uart_SendCMD(0x03,0,0x02); &#x2F;&#x2F;æ’­æ”¾ç¬¬17é¦–<br>                                 delay(50);<br>                                               break;<br>              case CODE_DKJDQ:    &#x2F;<em>å‘½ä»¤â€œæ‰“å¼€ç»§ç”µå™¨â€</em>&#x2F;<br>                                               PA2 &amp;&#x3D;0x01;<br>                                 delay(50);<br>                                               Uart_SendCMD(0x03,0,0x03);  &#x2F;&#x2F;æ’­æ”¾ç¬¬3é¦–<br>                                         Delay200ms();<br>                                               break;<br>              case CODE_GBJDQ:   &#x2F;<em>å‘½ä»¤â€œå…³é—­ç»§ç”µå™¨â€</em>&#x2F;<br>                                              PA2 &amp;&#x3D;0x00;<br>                               delay(50);<br>                                              Uart_SendCMD(0x03,0,0x04); &#x2F;&#x2F;æ’­æ”¾ç¬¬4é¦–<br>                                        delay(50);<br>                                              break;<br>              case CODE_KD:   &#x2F;<em>å‘½ä»¤â€œå¼€ç¯â€</em>&#x2F;<br>                                              PA3 &amp;&#x3D;0x01;<br>                                                   delay(50);<br>                                              Uart_SendCMD(0x03,0,0x08);  &#x2F;&#x2F;æ’­æ”¾ç¬¬8é¦–<br>                                                   delay(50);<br>                                              break;<br>              case CODE_GD:      &#x2F;<em>å‘½ä»¤â€œå…³ç¯â€</em>&#x2F;<br>                                  PA3 &amp;&#x3D;0x00;<br>              delay(50);<br>                                              Uart_SendCMD(0x03,0,0x07);&#x2F;&#x2F;æ’­æ”¾ç¬¬7é¦–<br>    delay(50);<br>                                              break;<br>    case CODE_DKFS:     &#x2F;<em>å‘½ä»¤â€œæ‰“å¼€é£æ‰‡â€</em>&#x2F;<br>                                    PA4 &amp;&#x3D;0x01;<br>                                                   delay(50);<br>                                              Uart_SendCMD(0x03,0,0x05);&#x2F;&#x2F;æ’­æ”¾ç¬¬5é¦–<br>                                                   delay(50);<br>                                              break;<br>    case CODE_GBFS:     &#x2F;<em>å‘½ä»¤â€œå…³é—­é£æ‰‡â€</em>&#x2F;<br>                                    PA4 &amp;&#x3D;0x00;<br>                              delay(50);<br>                                              Uart_SendCMD(0x03,0,0x06);&#x2F;&#x2F;æ’­æ”¾ç¬¬6é¦–<br>                                                  delay(50);<br>                                              break;<br>              case CODE_BB:     &#x2F;<em>å‘½ä»¤â€œæ‹œæ‹œâ€</em>&#x2F;<br>                                    PA5 &amp;&#x3D;0x01; <br>                              delay(50);<br>                                              Uart_SendCMD(0x03,0,0x09);&#x2F;&#x2F;æ’­æ”¾ç¬¬9é¦–<br>                                                   delay(50);<br>                                              break;<br>              case CODE_BFYY:     &#x2F;<em>å‘½ä»¤â€œæ’­æ”¾æ­Œæ›²â€</em>&#x2F;<br>                                    PA6 &amp;&#x3D;0x01; <br>                               delay(50);<br>                                              Uart_SendCMD(0x03,0,0x0a);&#x2F;&#x2F;æ’­æ”¾ç¬¬9é¦–<br>                                                   delay(50);<br>                                              break;<br>              case CODE_XYS:     &#x2F;<em>å‘½ä»¤â€œä¸‹ä¸€æ›²â€</em>&#x2F;<br>                                    PA7 &amp;&#x3D;0x01; <br>                               delay(50);<br>              Uart_SendCMD(0x17,0,0x01);&#x2F;&#x2F;å¾ªç¯æ’­æ”¾01æ–‡ä»¶å¤¹ä¸‹çš„æ›²ç›®<br>                                                 delay(50);<br>                                              break;<br>              case CODE_PFZL:     &#x2F;<em>å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€</em>&#x2F;<br>                                    PA8 &amp;&#x3D;0x01; <br>                               delay(50);<br>                                              Uart_SendCMD(0x03,0,0x0c);&#x2F;&#x2F;æ’­æ”¾å¹³å‡¡ä¹‹è·¯<br>                                                  delay(50);<br>                                              break;<br>              case CODE_MZ:     &#x2F;<em>å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€</em>&#x2F;<br>                                    PA9 &amp;&#x3D;0x01; <br>                              delay(50);<br>                                              Uart_SendCMD(0x03,0,0x10);&#x2F;&#x2F;æ’­æ”¾èŠ’ç§<br>                                                   delay(50);<br>                                              break;<br>              case CODE_SN:     &#x2F;<em>å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€</em>&#x2F;<br>                                    PA9 &amp;&#x3D;0x01; <br>                              delay(50);<br>                                              Uart_SendCMD(0x03,0,0x0d);&#x2F;&#x2F;æ’­æ”¾å°‘å¹´<br>                                                  delay(50);<br>                                              break;<br>              case CODE_NDDA:     &#x2F;<em>å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€</em>&#x2F;<br>                                    PA9 &amp;&#x3D;0x01; <br>                             delay(50);<br>                                              Uart_SendCMD(0x03,0,0x0e);&#x2F;&#x2F;æ’­æ”¾ä½ çš„ç­”æ¡ˆ<br>                                                   delay(50);<br>                                              break;<br>              case CODE_JL:     &#x2F;<em>å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€</em>&#x2F;<br>                                    PA9 &amp;&#x3D;0x01; <br>                              delay(50);<br>                                              Uart_SendCMD(0x03,0,0x0f);&#x2F;&#x2F;æ’­æ”¾æƒŠé›·<br>                                                   delay(50);<br>                                              break;<br>              case CODE_QYS:     &#x2F;<em>å‘½ä»¤â€œæ’­æ”¾æ›²ç›®â€</em>&#x2F;<br>                                    PA1 &amp;&#x3D;0x01; <br>                              delay(50);<br>                                              Uart_SendCMD(0x03,0,0x11);&#x2F;&#x2F;æ’­æ”¾ä¸ƒæœˆä¸Š<br>                                                   delay(50);<br>                                              break;<br>                      default:<br>                          break;<br>          }<br>      }<br>      else <br>      {<br><br>      }</li></ul><p>}&#96;</p><p>æœ€ä¸»è¦çš„åŠŸèƒ½ï¼Œå®ç°ä¸²å£ä¹‹é—´æ•°æ®æ”¶å‘çš„æ˜¯usart.cæ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;config.h&quot;</span><br><span class="line">#define FOSC 22118400L       //System frequency</span><br><span class="line">uint32_t baud=9600;           //UART baudrate</span><br><span class="line"></span><br><span class="line">static int Send_buf[10] = &#123;0&#125; ;</span><br><span class="line">/************************************************************************</span><br><span class="line">å‡½ æ•° åï¼š ä¸²å£åˆå§‹åŒ–</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š STC10L08XE å•ç‰‡æœºä¸²å£åˆå§‹åŒ–å‡½æ•°</span><br><span class="line">è¿”å›å‡½æ•°ï¼š none</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼š none</span><br><span class="line">**************************************************************************/</span><br><span class="line">void UartIni(void)</span><br><span class="line">&#123;</span><br><span class="line">    SCON = 0x50;              //8-bit variable UART</span><br><span class="line">    TMOD = 0x20;             //Set Timer1 as 8-bit auto reload mode</span><br><span class="line">    TH1 = TL1 = -(FOSC/12/32/baud); //Set auto-reload vaule</span><br><span class="line">    TR1 = 1;                //Timer1 start run</span><br><span class="line">    ES = 1;                 //Enable UART interrupt</span><br><span class="line">    EA = 1;                 //Open master interrupt switch</span><br><span class="line">&#125;</span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š ä¸²å£å‘é€ä¸€å­—èŠ‚æ•°æ®</span><br><span class="line">å…¥å£å‚æ•°ï¼šDAT:å¸¦å‘é€çš„æ•°æ®</span><br><span class="line">è¿” å› å€¼ï¼š none</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼šnone</span><br><span class="line">**************************************************************************/</span><br><span class="line">void UARTSendByte(uint8_t DAT)</span><br><span class="line">&#123;</span><br><span class="line">ES  =  0;</span><br><span class="line">TI = 0;</span><br><span class="line">SBUF = DAT;</span><br><span class="line">while(TI==0);</span><br><span class="line">TI=0;</span><br><span class="line">ES = 1;</span><br><span class="line">&#125;</span><br><span class="line">/*****************************************************************************************************</span><br><span class="line"> - åŠŸèƒ½æè¿°ï¼š ä¸²å£å‘é€ä¸€å¸§æ•°æ®</span><br><span class="line"> - éš¶å±æ¨¡å—ï¼š å†…éƒ¨ </span><br><span class="line"> - å‚æ•°è¯´æ˜ï¼š </span><br><span class="line"> - è¿”å›è¯´æ˜ï¼š </span><br><span class="line"> - æ³¨ï¼šæ—      </span><br><span class="line">*****************************************************************************************************/</span><br><span class="line">void SendCmd(int len)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 0 ;</span><br><span class="line"></span><br><span class="line">    UARTSendByte(0x7E); //èµ·å§‹</span><br><span class="line"></span><br><span class="line">    for(i=0; i&lt;len; i++)//æ•°æ®</span><br><span class="line">    &#123;</span><br><span class="line">UARTSendByte(Send_buf[i]) ;</span><br><span class="line">    &#125;</span><br><span class="line">    UARTSendByte(0xEF) ;//ç»“æŸ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/********************************************************************************************</span><br><span class="line"> - åŠŸèƒ½æè¿°ï¼šæ±‚å’Œæ ¡éªŒ</span><br><span class="line"> - éš¶å±æ¨¡å—ï¼š</span><br><span class="line"> - å‚æ•°è¯´æ˜ï¼š</span><br><span class="line"> - è¿”å›è¯´æ˜ï¼š</span><br><span class="line"> - æ³¨ï¼š      å’Œæ ¡éªŒçš„æ€è·¯å¦‚ä¸‹</span><br><span class="line">             å‘é€çš„æŒ‡ä»¤ï¼Œå»æ‰èµ·å§‹å’Œç»“æŸã€‚å°†ä¸­é—´çš„6ä¸ªå­—èŠ‚è¿›è¡Œç´¯åŠ ï¼Œæœ€åå–åç </span><br><span class="line">             æ¥æ”¶ç«¯å°±å°†æ¥æ”¶åˆ°çš„ä¸€å¸§æ•°æ®ï¼Œå»æ‰èµ·å§‹å’Œç»“æŸã€‚å°†ä¸­é—´çš„æ•°æ®ç´¯åŠ ï¼Œå†åŠ ä¸Šæ¥æ”¶åˆ°çš„æ ¡éªŒ</span><br><span class="line">             å­—èŠ‚ã€‚åˆšå¥½ä¸º0.è¿™æ ·å°±ä»£è¡¨æ¥æ”¶åˆ°çš„æ•°æ®å®Œå…¨æ­£ç¡®ã€‚</span><br><span class="line">********************************************************************************************/</span><br><span class="line">void DoSum( int *Str, int len)</span><br><span class="line">&#123;</span><br><span class="line">    int xorsum = 0;</span><br><span class="line">    int i;</span><br><span class="line"></span><br><span class="line">    for(i=0; i&lt;len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        xorsum  = xorsum + Str[i];</span><br><span class="line">    &#125;</span><br><span class="line">xorsum     = 0 -xorsum;</span><br><span class="line">*(Str+i)   = (int)(xorsum &gt;&gt;8);</span><br><span class="line">*(Str+i+1) = (int)(xorsum &amp; 0x00ff);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/********************************************************************************************</span><br><span class="line"> - åŠŸèƒ½æè¿°ï¼š ä¸²å£å‘å¤–å‘é€å‘½ä»¤[åŒ…æ‹¬æ§åˆ¶å’ŒæŸ¥è¯¢]</span><br><span class="line"> - éš¶å±æ¨¡å—ï¼š å¤–éƒ¨</span><br><span class="line"> - å‚æ•°è¯´æ˜ï¼š CMD:è¡¨ç¤ºæ§åˆ¶æŒ‡ä»¤ï¼Œè¯·æŸ¥é˜…æŒ‡ä»¤è¡¨ï¼Œè¿˜åŒ…æ‹¬æŸ¥è¯¢çš„ç›¸å…³æŒ‡ä»¤</span><br><span class="line">              feedback:æ˜¯å¦éœ€è¦åº”ç­”[0:ä¸éœ€è¦åº”ç­”ï¼Œ1:éœ€è¦åº”ç­”]</span><br><span class="line">              data:ä¼ é€çš„å‚æ•°</span><br><span class="line"> - è¿”å›è¯´æ˜ï¼š</span><br><span class="line"> - æ³¨ï¼š       </span><br><span class="line">********************************************************************************************/</span><br><span class="line">void Uart_SendCMD(int CMD ,int feedback , int dat)</span><br><span class="line">&#123;</span><br><span class="line">    Send_buf[0] = 0xff;    //ä¿ç•™å­—èŠ‚ </span><br><span class="line">    Send_buf[1] = 0x06;    //é•¿åº¦</span><br><span class="line">    Send_buf[2] = CMD;     //æ§åˆ¶æŒ‡ä»¤</span><br><span class="line">    Send_buf[3] = feedback;//æ˜¯å¦éœ€è¦åé¦ˆ</span><br><span class="line">    Send_buf[4] = (int)(dat &gt;&gt; 8);//datah</span><br><span class="line">    Send_buf[5] = (int)(dat);     //datal</span><br><span class="line">    DoSum(&amp;Send_buf[0],6);        //æ ¡éªŒ</span><br><span class="line">    SendCmd(8);       //å‘é€æ­¤å¸§æ•°æ®</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line"></span><br><span class="line">LDCChip.c:</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line">/***************************é£éŸ³äº‘ç”µå­****************************</span><br><span class="line">**  å·¥ç¨‹åç§°ï¼šYS-V0.7è¯­éŸ³è¯†åˆ«æ¨¡å—é©±åŠ¨ç¨‹åº</span><br><span class="line">**CPU: STC11L08XE</span><br><span class="line">**æ™¶æŒ¯ï¼š22.1184MHZ</span><br><span class="line">**æ³¢ç‰¹ç‡ï¼š9600 bit/S</span><br><span class="line">**é…å¥—äº§å“ä¿¡æ¯ï¼šYS-V0.7è¯­éŸ³è¯†åˆ«å¼€å‘æ¿</span><br><span class="line">**                http://yuesheng001.taobao.com</span><br><span class="line">**  ä½œè€…ï¼šzdings</span><br><span class="line">**  è”ç³»ï¼š751956552@qq.com</span><br><span class="line">**  ä¿®æ”¹æ—¥æœŸï¼š2013.9.13</span><br><span class="line">**  è¯´æ˜ï¼šå£ä»¤æ¨¡å¼ï¼š å³æ¯æ¬¡è¯†åˆ«æ—¶éƒ½éœ€è¦è¯´â€œå°æ°â€è¿™ä¸ªå£ä»¤ ï¼Œæ‰èƒ½å¤Ÿè¿›è¡Œä¸‹ä¸€çº§çš„è¯†åˆ«</span><br><span class="line">/***************************é£éŸ³äº‘ç”µå­******************************/</span><br><span class="line">//#include &lt;REG51.H&gt;</span><br><span class="line">#include &quot;config.h&quot;</span><br><span class="line"></span><br><span class="line">extern void  delay(unsigned long uldata);</span><br><span class="line"></span><br><span class="line">uint8 idata ucRegVal;</span><br><span class="line">extern uint8 idata nAsrStatus;</span><br><span class="line"></span><br><span class="line">void ProcessInt0(void);</span><br><span class="line"></span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š  å¤ä½LDæ¨¡å—</span><br><span class="line">å…¥å£å‚æ•°ï¼š none</span><br><span class="line">è¿” å› å€¼ï¼š  none</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼š none</span><br><span class="line">**************************************************************************/</span><br><span class="line">void LD_Reset()</span><br><span class="line">&#123;</span><br><span class="line">RSTB=1;</span><br><span class="line">delay(1);</span><br><span class="line">RSTB=0;</span><br><span class="line">delay(1);</span><br><span class="line">RSTB=1;</span><br><span class="line"></span><br><span class="line">delay(1);</span><br><span class="line">CSB=0;</span><br><span class="line">delay(1);</span><br><span class="line">CSB=1;</span><br><span class="line">delay(1);</span><br><span class="line">&#125;</span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š LDæ¨¡å—å‘½ä»¤åˆå§‹åŒ–</span><br><span class="line">å…¥å£å‚æ•°ï¼š none</span><br><span class="line">è¿” å› å€¼ï¼š none</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼š è¯¥å‡½æ•°ä¸ºå‡ºå‚é…ç½®ï¼Œä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼›</span><br><span class="line"> æœ‰å…´è¶£çš„å®¢æˆ·å¯å¯¹ç…§å¼€å‘æ‰‹å†Œæ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹ã€‚</span><br><span class="line">**************************************************************************/</span><br><span class="line">void LD_Init_Common()</span><br><span class="line">&#123;</span><br><span class="line">LD_ReadReg(0x06);  </span><br><span class="line">LD_WriteReg(0x17, 0x35); </span><br><span class="line">delay(10);</span><br><span class="line">LD_ReadReg(0x06);  </span><br><span class="line"></span><br><span class="line">LD_WriteReg(0x89, 0x03);  </span><br><span class="line">delay(5);</span><br><span class="line">LD_WriteReg(0xCF, 0x43);   </span><br><span class="line">delay(5);</span><br><span class="line">LD_WriteReg(0xCB, 0x02);</span><br><span class="line"></span><br><span class="line">/*PLL setting*/</span><br><span class="line">LD_WriteReg(0x11, LD_PLL_11);       </span><br><span class="line"></span><br><span class="line">LD_WriteReg(0x1E,0x00);</span><br><span class="line">LD_WriteReg(0x19, LD_PLL_ASR_19); </span><br><span class="line">LD_WriteReg(0x1B, LD_PLL_ASR_1B);</span><br><span class="line">  LD_WriteReg(0x1D, LD_PLL_ASR_1D);</span><br><span class="line">delay(10);</span><br><span class="line"></span><br><span class="line">    LD_WriteReg(0xCD, 0x04);</span><br><span class="line">//LD_WriteReg(0x17, 0x4c); </span><br><span class="line">delay(5);</span><br><span class="line">LD_WriteReg(0xB9, 0x00);</span><br><span class="line">LD_WriteReg(0xCF, 0x4F); </span><br><span class="line">LD_WriteReg(0x6F, 0xFF); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š  LDæ¨¡å— ASRåŠŸèƒ½åˆå§‹åŒ–</span><br><span class="line">å…¥å£å‚æ•°ï¼š none</span><br><span class="line">è¿” å› å€¼ï¼š  none</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼š è¯¥å‡½æ•°ä¸ºå‡ºå‚é…ç½®ï¼Œä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼›</span><br><span class="line"> æœ‰å…´è¶£çš„å®¢æˆ·å¯å¯¹ç…§å¼€å‘æ‰‹å†Œæ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹ã€‚</span><br><span class="line">**************************************************************************/</span><br><span class="line">void LD_Init_ASR()</span><br><span class="line">&#123;</span><br><span class="line">LD_Init_Common();</span><br><span class="line">LD_WriteReg(0xBD, 0x00);</span><br><span class="line">LD_WriteReg(0x17, 0x48);</span><br><span class="line">delay( 10 );</span><br><span class="line">LD_WriteReg(0x3C, 0x80);    </span><br><span class="line">LD_WriteReg(0x3E, 0x07);</span><br><span class="line">LD_WriteReg(0x38, 0xff);    </span><br><span class="line">LD_WriteReg(0x3A, 0x07);</span><br><span class="line">  LD_WriteReg(0x40, 0);          </span><br><span class="line">LD_WriteReg(0x42, 8);</span><br><span class="line">LD_WriteReg(0x44, 0);    </span><br><span class="line">LD_WriteReg(0x46, 8); </span><br><span class="line">delay( 1 );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š ä¸­æ–­å¤„ç†å‡½æ•°</span><br><span class="line">å…¥å£å‚æ•°ï¼š none</span><br><span class="line">è¿” å› å€¼ï¼š  none</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼šå½“LDæ¨¡å—æ¥æ”¶åˆ°éŸ³é¢‘ä¿¡å·æ—¶ï¼Œå°†è¿›å…¥è¯¥å‡½æ•°ï¼Œ</span><br><span class="line">åˆ¤æ–­è¯†åˆ«æ˜¯å¦æœ‰ç»“æœï¼Œå¦‚æœæ²¡æœ‰ä»æ–°é…ç½®å¯„</span><br><span class="line">            å­˜å™¨å‡†å¤‡ä¸‹ä¸€æ¬¡çš„è¯†åˆ«ã€‚</span><br><span class="line">**************************************************************************/</span><br><span class="line">void ProcessInt0(void)</span><br><span class="line">&#123;</span><br><span class="line">uint8 nAsrResCount=0;</span><br><span class="line"></span><br><span class="line">EX0=0;</span><br><span class="line">ucRegVal = LD_ReadReg(0x2B);</span><br><span class="line">LD_WriteReg(0x29,0) ;</span><br><span class="line">LD_WriteReg(0x02,0) ;</span><br><span class="line">if((ucRegVal &amp; 0x10) &amp;&amp;</span><br><span class="line">LD_ReadReg(0xb2)==0x21 &amp;&amp; </span><br><span class="line">LD_ReadReg(0xbf)==0x35)/*è¯†åˆ«æˆåŠŸ*/</span><br><span class="line">&#123;</span><br><span class="line">nAsrResCount = LD_ReadReg(0xba);</span><br><span class="line">if(nAsrResCount&gt;0 &amp;&amp; nAsrResCount&lt;=4) </span><br><span class="line">&#123;</span><br><span class="line">nAsrStatus=LD_ASR_FOUNDOK;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">    &#123;</span><br><span class="line">nAsrStatus=LD_ASR_FOUNDZERO;</span><br><span class="line">&#125;</span><br><span class="line">&#125; /*æ²¡æœ‰è¯†åˆ«ç»“æœ*/</span><br><span class="line">else</span><br><span class="line">&#123; </span><br><span class="line">nAsrStatus=LD_ASR_FOUNDZERO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  LD_WriteReg(0x2b, 0);</span><br><span class="line">  LD_WriteReg(0x1C,0);/*å†™0:ADCä¸å¯ç”¨*/</span><br><span class="line"></span><br><span class="line">LD_WriteReg(0x29,0) ;</span><br><span class="line">LD_WriteReg(0x02,0) ;</span><br><span class="line">LD_WriteReg(0x2B,  0);</span><br><span class="line">LD_WriteReg(0xBA, 0);</span><br><span class="line">LD_WriteReg(0xBC,0);</span><br><span class="line">LD_WriteReg(0x08,1); /*æ¸…é™¤FIFO_DATA*/</span><br><span class="line">LD_WriteReg(0x08,0);/*æ¸…é™¤FIFO_DATAå å†æ¬¡å†™0*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EX0=1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š è¿è¡ŒASRè¯†åˆ«æµç¨‹</span><br><span class="line">å…¥å£å‚æ•°ï¼šnone</span><br><span class="line">è¿” å› å€¼ï¼š  asrflagï¼š1-&gt;å¯åŠ¨æˆåŠŸï¼Œ 0â€”&gt;å¯åŠ¨å¤±è´¥</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼šè¯†åˆ«é¡ºåºå¦‚ä¸‹:</span><br><span class="line">1ã€RunASR()å‡½æ•°å®ç°äº†ä¸€æ¬¡å®Œæ•´çš„ASRè¯­éŸ³è¯†åˆ«æµç¨‹</span><br><span class="line">2ã€LD_AsrStart() å‡½æ•°å®ç°äº†ASRåˆå§‹åŒ–</span><br><span class="line">3ã€LD_AsrAddFixed() å‡½æ•°å®ç°äº†æ·»åŠ å…³é”®è¯è¯­åˆ°LD3320èŠ¯ç‰‡ä¸­</span><br><span class="line">4ã€LD_AsrRun()å‡½æ•°å¯åŠ¨äº†ä¸€æ¬¡ASRè¯­éŸ³è¯†åˆ«æµç¨‹</span><br><span class="line">ä»»ä½•ä¸€æ¬¡ASRè¯†åˆ«æµç¨‹ï¼Œéƒ½éœ€è¦æŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œä»åˆå§‹åŒ–å¼€å§‹î‰£</span><br><span class="line">**************************************************************************/</span><br><span class="line">uint8 RunASR(void)</span><br><span class="line">&#123;</span><br><span class="line">uint8 i=0;</span><br><span class="line">uint8 asrflag=0;</span><br><span class="line">for (i=0; i&lt;5; i++)//é˜²æ­¢ç”±äºç¡¬ä»¶åŸå› å¯¼è‡´LD3320èŠ¯ç‰‡å·¥ä½œä¸æ­£å¸¸ï¼Œæ‰€ä»¥ä¸€å…±å°è¯•5æ¬¡å¯åŠ¨ASRè¯†åˆ«æµç¨‹</span><br><span class="line">&#123;</span><br><span class="line">LD_AsrStart();</span><br><span class="line">delay(50);</span><br><span class="line">if (LD_AsrAddFixed()==0)</span><br><span class="line">&#123;</span><br><span class="line">LD_Reset();//LD3320èŠ¯ç‰‡å†…éƒ¨å‡ºç°ä¸æ­£å¸¸ï¼Œç«‹å³é‡å¯LD3320èŠ¯ç‰‡</span><br><span class="line">delay(50);//å¹¶ä»åˆå§‹åŒ–å¼€å§‹é‡æ–°ASRè¯†åˆ«æµç¨‹</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">delay(10);</span><br><span class="line">if (LD_AsrRun() == 0)</span><br><span class="line">&#123;</span><br><span class="line">LD_Reset();//LD3320èŠ¯ç‰‡å†…éƒ¨å‡ºç°ä¸æ­£å¸¸ï¼Œç«‹å³é‡å¯LD3320èŠ¯ç‰‡</span><br><span class="line">delay(50);//å¹¶ä»åˆå§‹åŒ–å¼€å§‹é‡æ–°ASRè¯†åˆ«æµç¨‹</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">asrflag=1;</span><br><span class="line">break;//ASRæµç¨‹å¯åŠ¨æˆåŠŸï¼Œé€€å‡ºå½“å‰forå¾ªç¯ã€‚å¼€å§‹ç­‰å¾…LD3320é€å‡ºçš„ä¸­æ–­ä¿¡å·</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return asrflag;</span><br><span class="line">&#125;</span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š  æ£€æµ‹LDæ¨¡å—æ˜¯å¦ç©ºé—²</span><br><span class="line">å…¥å£å‚æ•°ï¼šnone</span><br><span class="line">è¿” å› å€¼ï¼š flagï¼š1-&gt; ç©ºé—²</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼šnone</span><br><span class="line">**************************************************************************/</span><br><span class="line">uint8 LD_Check_ASRBusyFlag_b2()</span><br><span class="line">&#123;</span><br><span class="line">uint8 j;</span><br><span class="line">uint8 flag = 0;</span><br><span class="line">for (j=0; j&lt;10; j++)</span><br><span class="line">&#123;</span><br><span class="line">if (LD_ReadReg(0xb2) == 0x21)</span><br><span class="line">&#123;</span><br><span class="line">flag = 1;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">delay(10);</span><br><span class="line">&#125;</span><br><span class="line">return flag;</span><br><span class="line">&#125;</span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š å¯åŠ¨ASR</span><br><span class="line">å…¥å£å‚æ•°ï¼šnone</span><br><span class="line">è¿” å› å€¼ï¼š none</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼šnone</span><br><span class="line">**************************************************************************/</span><br><span class="line">void LD_AsrStart()</span><br><span class="line">&#123;</span><br><span class="line">LD_Init_ASR();</span><br><span class="line">&#125;</span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š è¿è¡ŒASR</span><br><span class="line">å…¥å£å‚æ•°ï¼šnone</span><br><span class="line">è¿” å› å€¼ï¼š 1ï¼šå¯åŠ¨æˆåŠŸ</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼šnone</span><br><span class="line">**************************************************************************/</span><br><span class="line">uint8 LD_AsrRun()</span><br><span class="line">&#123;</span><br><span class="line">EX0=0;</span><br><span class="line">LD_WriteReg(0x35, MIC_VOL);</span><br><span class="line">LD_WriteReg(0x1C, 0x09);</span><br><span class="line">LD_WriteReg(0xBD, 0x20);</span><br><span class="line">LD_WriteReg(0x08, 0x01);</span><br><span class="line">delay( 10 );</span><br><span class="line">LD_WriteReg(0x08, 0x00);</span><br><span class="line">delay( 10 );</span><br><span class="line"></span><br><span class="line">if(LD_Check_ASRBusyFlag_b2() == 0)</span><br><span class="line">&#123;</span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br><span class="line">//LD_WriteReg(0xB6, 0xa); //è¯†åˆ«æ—¶é—´ 1S</span><br><span class="line">//LD_WriteReg(0xB5, 0x1E); //èƒŒæ™¯éŸ³æ®µæ—¶é—´ 300ms</span><br><span class="line">//LD_WriteReg(0xB8, 10); //ç»“æŸæ—¶é—´</span><br><span class="line"></span><br><span class="line">//LD_WriteReg(0x1C, 0x07); //é…ç½®åŒé€šé“éŸ³é¢‘ä¿¡å·åšä¸ºè¾“å…¥ä¿¡å·</span><br><span class="line">LD_WriteReg(0x1C, 0x0b); //é…ç½®éº¦å…‹é£åšä¸ºè¾“å…¥ä¿¡å·</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LD_WriteReg(0xB2, 0xff);</span><br><span class="line">delay( 10);</span><br><span class="line">LD_WriteReg(0x37, 0x06);</span><br><span class="line">delay( 10 );</span><br><span class="line">    LD_WriteReg(0x37, 0x06);</span><br><span class="line">delay( 5 );</span><br><span class="line">LD_WriteReg(0x29, 0x10);</span><br><span class="line"></span><br><span class="line">LD_WriteReg(0xBD, 0x00);</span><br><span class="line">EX0=1;</span><br><span class="line">return 1;</span><br><span class="line">&#125;</span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š å‘LDæ¨¡å—æ·»åŠ å…³é”®è¯</span><br><span class="line">å…¥å£å‚æ•°ï¼š none</span><br><span class="line">è¿” å› å€¼ï¼š flagï¼š1-&gt;æ·»åŠ æˆåŠŸ</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼š ç”¨æˆ·ä¿®æ”¹.</span><br><span class="line"> 1ã€æ ¹æ®å¦‚ä¸‹æ ¼å¼æ·»åŠ æ‹¼éŸ³å…³é”®è¯ï¼ŒåŒæ—¶æ³¨æ„ä¿®æ”¹sRecog å’ŒpCode æ•°ç»„çš„é•¿åº¦</span><br><span class="line"> å’Œå¯¹åº”å˜äº†kçš„å¾ªç¯ç½®ã€‚æ‹¼éŸ³ä¸²å’Œè¯†åˆ«ç æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚</span><br><span class="line"> 2ã€å¼€å‘è€…å¯ä»¥å­¦ä¹ &quot;è¯­éŸ³è¯†åˆ«èŠ¯ç‰‡LD3320é«˜é˜¶ç§˜ç±.pdf&quot;ä¸­</span><br><span class="line">           å…³äºåƒåœ¾è¯è¯­å¸æ”¶é”™è¯¯çš„ç”¨æ³•ï¼Œæ¥æä¾›è¯†åˆ«æ•ˆæœã€‚</span><br><span class="line"> 3ã€â€xiao jie â€œ ä¸ºå£ä»¤ï¼Œæ•…åœ¨æ¯æ¬¡è¯†åˆ«æ—¶ï¼Œå¿…é¡»å…ˆå‘ä¸€çº§å£ä»¤â€œå°æ·â€</span><br><span class="line">**************************************************************************/</span><br><span class="line">uint8 LD_AsrAddFixed()</span><br><span class="line">&#123;</span><br><span class="line">uint8 k, flag;</span><br><span class="line">uint8 nAsrAddLength;</span><br><span class="line">#define DATE_A 18   /*æ•°ç»„äºŒç»´æ•°å€¼*/</span><br><span class="line">#define DATE_B 20/*æ•°ç»„ä¸€ç»´æ•°å€¼*/</span><br><span class="line">uint8 code sRecog[DATE_A][DATE_B] = &#123;</span><br><span class="line">&quot;xiao xin&quot;,\</span><br><span class="line">&quot;kai fa ban yan zheng&quot;,\</span><br><span class="line">&quot;da kai ji dian qi&quot;,\</span><br><span class="line">&quot;guan bi ji dian qi&quot;,\</span><br><span class="line">&quot;kai deng&quot;,\</span><br><span class="line">&quot;guan deng&quot;,\</span><br><span class="line">&quot;zai jian&quot;,\</span><br><span class="line">&quot;bo fang yin yue&quot;,\</span><br><span class="line">&quot;da kai feng shan&quot;,\</span><br><span class="line">                                    &quot;guan bi feng shan&quot;,\</span><br><span class="line">                                      &quot;bai bai&quot;,\</span><br><span class="line">                                     &quot;xia yi shou&quot;,\</span><br><span class="line">                                    &quot;ping fan zhi lu&quot;,\</span><br><span class="line"> &quot;mang zhong&quot;,\</span><br><span class="line"> &quot;shao nian&quot;,\</span><br><span class="line"> &quot;ni de da an&quot;,\</span><br><span class="line"> &quot;jing lei&quot;,\</span><br><span class="line">&quot;qi yue shang&quot;,\</span><br><span class="line">&#125;;  /*æ·»åŠ å…³é”®è¯ï¼Œç”¨æˆ·ä¿®æ”¹*/</span><br><span class="line">uint8 code pCode[DATE_A] = &#123;</span><br><span class="line">CODE_CMD,\   </span><br><span class="line">CODE_KFBYZ,\  </span><br><span class="line">CODE_DKJDQ,\  </span><br><span class="line">CODE_GBJDQ,\</span><br><span class="line">CODE_KD,\</span><br><span class="line">CODE_GD,\</span><br><span class="line">CODE_ZJ,\</span><br><span class="line">CODE_BFYY,\</span><br><span class="line">                          CODE_DKFS,\</span><br><span class="line">                          CODE_GBFS,\</span><br><span class="line">                          CODE_BB,\</span><br><span class="line">                          CODE_XYS,\</span><br><span class="line">                          CODE_PFZL,\</span><br><span class="line">                           CODE_MZ,\</span><br><span class="line">                            CODE_SN,\</span><br><span class="line">                            CODE_NDDA,\</span><br><span class="line">                           CODE_JL,\</span><br><span class="line">                          CODE_QYS,\</span><br><span class="line"></span><br><span class="line"> &#125;;</span><br><span class="line">/*æ·»åŠ è¯†åˆ«ç ï¼Œç”¨æˆ·ä¿®æ”¹*/</span><br><span class="line"> </span><br><span class="line">flag = 1;</span><br><span class="line">for (k=0; k&lt;DATE_A; k++)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">if(LD_Check_ASRBusyFlag_b2() == 0)</span><br><span class="line">&#123;</span><br><span class="line">flag = 0;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LD_WriteReg(0xc1, pCode[k] );</span><br><span class="line">LD_WriteReg(0xc3, 0 );</span><br><span class="line">LD_WriteReg(0x08, 0x04);</span><br><span class="line">delay(10);</span><br><span class="line">LD_WriteReg(0x08, 0x00);</span><br><span class="line">delay(10);</span><br><span class="line"></span><br><span class="line">for (nAsrAddLength=0; nAsrAddLength&lt;DATE_B; nAsrAddLength++)</span><br><span class="line">&#123;</span><br><span class="line">if (sRecog[k][nAsrAddLength] == 0)</span><br><span class="line">break;</span><br><span class="line">LD_WriteReg(0x5, sRecog[k][nAsrAddLength]);</span><br><span class="line">&#125;</span><br><span class="line">LD_WriteReg(0xb9, nAsrAddLength);</span><br><span class="line">LD_WriteReg(0xb2, 0xff);</span><br><span class="line">LD_WriteReg(0x37, 0x04);</span><br><span class="line">&#125;</span><br><span class="line">    return flag;</span><br><span class="line">&#125;</span><br><span class="line">/************************************************************************</span><br><span class="line">åŠŸèƒ½æè¿°ï¼š è·å–è¯†åˆ«ç»“æœ</span><br><span class="line">å…¥å£å‚æ•°ï¼šnone</span><br><span class="line">è¿” å› å€¼ï¼š LD_ReadReg(0xc5 )ï¼›  è¯»å–å†…éƒ¨å¯„å­˜å™¨è¿”å›è¯†åˆ«ç ã€‚</span><br><span class="line">å…¶ä»–è¯´æ˜ï¼šnone</span><br><span class="line">**************************************************************************/</span><br><span class="line">uint8 LD_GetResult()</span><br><span class="line">&#123;</span><br><span class="line">return LD_ReadReg(0xc5 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œconfig.hâ€<br>#define FOSC 22118400L       &#x2F;&#x2F;System frequency<br>uint32_t baud&#x3D;9600;           &#x2F;&#x2F;UART baudrate</p><p>static int Send_buf[10] &#x3D; {0} ;<br>&#x2F;************************************************************************<br>å‡½ æ•° åï¼š ä¸²å£åˆå§‹åŒ–<br>åŠŸèƒ½æè¿°ï¼š STC10L08XE å•ç‰‡æœºä¸²å£åˆå§‹åŒ–å‡½æ•°<br>è¿”å›å‡½æ•°ï¼š none<br>å…¶ä»–è¯´æ˜ï¼š none<br><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>&#x2F;<br>void UartIni(void)<br>{<br>    SCON &#x3D; 0x50;              &#x2F;&#x2F;8-bit variable UART<br>    TMOD &#x3D; 0x20;             &#x2F;&#x2F;Set Timer1 as 8-bit auto reload mode<br>    TH1 &#x3D; TL1 &#x3D; -(FOSC&#x2F;12&#x2F;32&#x2F;baud); &#x2F;&#x2F;Set auto-reload vaule<br>    TR1 &#x3D; 1;                &#x2F;&#x2F;Timer1 start run<br>    ES &#x3D; 1;                 &#x2F;&#x2F;Enable UART interrupt<br>    EA &#x3D; 1;                 &#x2F;&#x2F;Open master interrupt switch<br>}<br>&#x2F;</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><br>åŠŸèƒ½æè¿°ï¼š ä¸²å£å‘é€ä¸€å­—èŠ‚æ•°æ®<br>å…¥å£å‚æ•°ï¼šDAT:å¸¦å‘é€çš„æ•°æ®<br>è¿” å› å€¼ï¼š none<br>å…¶ä»–è¯´æ˜ï¼šnone<br><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>&#x2F;<br>void UARTSendByte(uint8_t DAT)<br>{<br>    ES  &#x3D;  0;<br>    TI &#x3D; 0;<br>    SBUF &#x3D; DAT;<br>    while(TI&#x3D;&#x3D;0);<br>    TI&#x3D;0;<br>    ES &#x3D; 1;<br>}<br>&#x2F;</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>*************************</p><ul><li><p>åŠŸèƒ½æè¿°ï¼š ä¸²å£å‘é€ä¸€å¸§æ•°æ®</p></li><li><p>éš¶å±æ¨¡å—ï¼š å†…éƒ¨ </p></li><li><p>å‚æ•°è¯´æ˜ï¼š </p></li><li><p>è¿”å›è¯´æ˜ï¼š </p></li><li><p>æ³¨ï¼šæ— <br>*****************************************************************************************************&#x2F;<br>void SendCmd(int len)<br>{<br> int i &#x3D; 0 ;</p><p> UARTSendByte(0x7E); &#x2F;&#x2F;èµ·å§‹</p><p> for(i&#x3D;0; i&lt;len; i++)&#x2F;&#x2F;æ•°æ®<br> {<br>     UARTSendByte(Send_buf[i]) ;<br> }<br> UARTSendByte(0xEF) ;&#x2F;&#x2F;ç»“æŸ</p></li></ul><p>}</p><p>&#x2F;********************************************************************************************</p><ul><li>åŠŸèƒ½æè¿°ï¼šæ±‚å’Œæ ¡éªŒ</li><li>éš¶å±æ¨¡å—ï¼š</li><li>å‚æ•°è¯´æ˜ï¼š</li><li>è¿”å›è¯´æ˜ï¼š</li><li>æ³¨ï¼š      å’Œæ ¡éªŒçš„æ€è·¯å¦‚ä¸‹<br>      å‘é€çš„æŒ‡ä»¤ï¼Œå»æ‰èµ·å§‹å’Œç»“æŸã€‚å°†ä¸­é—´çš„6ä¸ªå­—èŠ‚è¿›è¡Œç´¯åŠ ï¼Œæœ€åå–åç <br>      æ¥æ”¶ç«¯å°±å°†æ¥æ”¶åˆ°çš„ä¸€å¸§æ•°æ®ï¼Œå»æ‰èµ·å§‹å’Œç»“æŸã€‚å°†ä¸­é—´çš„æ•°æ®ç´¯åŠ ï¼Œå†åŠ ä¸Šæ¥æ”¶åˆ°çš„æ ¡éªŒ<br>      å­—èŠ‚ã€‚åˆšå¥½ä¸º0.è¿™æ ·å°±ä»£è¡¨æ¥æ”¶åˆ°çš„æ•°æ®å®Œå…¨æ­£ç¡®ã€‚</li></ul><p>********************************************************************************************&#x2F;<br>void DoSum( int *Str, int len)<br>{<br>    int xorsum &#x3D; 0;<br>    int i;</p><pre><code>for(i=0; i&lt;len; i++)&#123;    xorsum  = xorsum + Str[i];&#125;xorsum     = 0 -xorsum;*(Str+i)   = (int)(xorsum &gt;&gt;8);*(Str+i+1) = (int)(xorsum &amp; 0x00ff);</code></pre><p>}</p><p>&#x2F;********************************************************************************************</p><ul><li>åŠŸèƒ½æè¿°ï¼š ä¸²å£å‘å¤–å‘é€å‘½ä»¤[åŒ…æ‹¬æ§åˆ¶å’ŒæŸ¥è¯¢]</li><li>éš¶å±æ¨¡å—ï¼š å¤–éƒ¨</li><li>å‚æ•°è¯´æ˜ï¼š CMD:è¡¨ç¤ºæ§åˆ¶æŒ‡ä»¤ï¼Œè¯·æŸ¥é˜…æŒ‡ä»¤è¡¨ï¼Œè¿˜åŒ…æ‹¬æŸ¥è¯¢çš„ç›¸å…³æŒ‡ä»¤<br>       feedback:æ˜¯å¦éœ€è¦åº”ç­”[0:ä¸éœ€è¦åº”ç­”ï¼Œ1:éœ€è¦åº”ç­”]<br>       data:ä¼ é€çš„å‚æ•°</li><li>è¿”å›è¯´æ˜ï¼š</li><li>æ³¨ï¼š<br>********************************************************************************************&#x2F;<br>void Uart_SendCMD(int CMD ,int feedback , int dat)<br>{<br> Send_buf[0] &#x3D; 0xff;    &#x2F;&#x2F;ä¿ç•™å­—èŠ‚<br> Send_buf[1] &#x3D; 0x06;    &#x2F;&#x2F;é•¿åº¦<br> Send_buf[2] &#x3D; CMD;     &#x2F;&#x2F;æ§åˆ¶æŒ‡ä»¤<br> Send_buf[3] &#x3D; feedback;&#x2F;&#x2F;æ˜¯å¦éœ€è¦åé¦ˆ<br> Send_buf[4] &#x3D; (int)(dat &gt;&gt; 8);&#x2F;&#x2F;datah<br> Send_buf[5] &#x3D; (int)(dat);     &#x2F;&#x2F;datal<br> DoSum(&amp;Send_buf[0],6);        &#x2F;&#x2F;æ ¡éªŒ<br> SendCmd(8);       &#x2F;&#x2F;å‘é€æ­¤å¸§æ•°æ®<br>}</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">LDCChip.c:</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line"><span class="comment">/***************************é£éŸ³äº‘ç”µå­****************************</span></span><br><span class="line"><span class="comment">**  å·¥ç¨‹åç§°ï¼šYS-V0.7è¯­éŸ³è¯†åˆ«æ¨¡å—é©±åŠ¨ç¨‹åº</span></span><br><span class="line"><span class="comment">**CPU: STC11L08XE</span></span><br><span class="line"><span class="comment">**æ™¶æŒ¯ï¼š22.1184MHZ</span></span><br><span class="line"><span class="comment">**æ³¢ç‰¹ç‡ï¼š9600 bit/S</span></span><br><span class="line"><span class="comment">**é…å¥—äº§å“ä¿¡æ¯ï¼šYS-V0.7è¯­éŸ³è¯†åˆ«å¼€å‘æ¿</span></span><br><span class="line"><span class="comment">**                http://yuesheng001.taobao.com</span></span><br><span class="line"><span class="comment">**  ä½œè€…ï¼šzdings</span></span><br><span class="line"><span class="comment">**  è”ç³»ï¼š751956552@qq.com</span></span><br><span class="line"><span class="comment">**  ä¿®æ”¹æ—¥æœŸï¼š2013.9.13</span></span><br><span class="line"><span class="comment">**  è¯´æ˜ï¼šå£ä»¤æ¨¡å¼ï¼š å³æ¯æ¬¡è¯†åˆ«æ—¶éƒ½éœ€è¦è¯´â€œå°æ°â€è¿™ä¸ªå£ä»¤ ï¼Œæ‰èƒ½å¤Ÿè¿›è¡Œä¸‹ä¸€çº§çš„è¯†åˆ«</span></span><br><span class="line"><span class="comment">/***************************é£éŸ³äº‘ç”µå­******************************/</span></span><br><span class="line"><span class="comment">//#include &lt;REG51.H&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;config.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span>  <span class="title function_">delay</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> uldata)</span>;</span><br><span class="line"></span><br><span class="line">uint8 idata ucRegVal;</span><br><span class="line"><span class="keyword">extern</span> uint8 idata nAsrStatus;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ProcessInt0</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š  å¤ä½LDæ¨¡å—</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼š none</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š  none</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼š none</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LD_Reset</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">RSTB=<span class="number">1</span>;</span><br><span class="line">delay(<span class="number">1</span>);</span><br><span class="line">RSTB=<span class="number">0</span>;</span><br><span class="line">delay(<span class="number">1</span>);</span><br><span class="line">RSTB=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">delay(<span class="number">1</span>);</span><br><span class="line">CSB=<span class="number">0</span>;</span><br><span class="line">delay(<span class="number">1</span>);</span><br><span class="line">CSB=<span class="number">1</span>;</span><br><span class="line">delay(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š LDæ¨¡å—å‘½ä»¤åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼š none</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š none</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼š è¯¥å‡½æ•°ä¸ºå‡ºå‚é…ç½®ï¼Œä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼›</span></span><br><span class="line"><span class="comment"> æœ‰å…´è¶£çš„å®¢æˆ·å¯å¯¹ç…§å¼€å‘æ‰‹å†Œæ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹ã€‚</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LD_Init_Common</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">LD_ReadReg(<span class="number">0x06</span>);  </span><br><span class="line">LD_WriteReg(<span class="number">0x17</span>, <span class="number">0x35</span>); </span><br><span class="line">delay(<span class="number">10</span>);</span><br><span class="line">LD_ReadReg(<span class="number">0x06</span>);  </span><br><span class="line"></span><br><span class="line">LD_WriteReg(<span class="number">0x89</span>, <span class="number">0x03</span>);  </span><br><span class="line">delay(<span class="number">5</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0xCF</span>, <span class="number">0x43</span>);   </span><br><span class="line">delay(<span class="number">5</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0xCB</span>, <span class="number">0x02</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*PLL setting*/</span></span><br><span class="line">LD_WriteReg(<span class="number">0x11</span>, LD_PLL_11);       </span><br><span class="line"></span><br><span class="line">LD_WriteReg(<span class="number">0x1E</span>,<span class="number">0x00</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x19</span>, LD_PLL_ASR_19); </span><br><span class="line">LD_WriteReg(<span class="number">0x1B</span>, LD_PLL_ASR_1B);</span><br><span class="line">  LD_WriteReg(<span class="number">0x1D</span>, LD_PLL_ASR_1D);</span><br><span class="line">delay(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    LD_WriteReg(<span class="number">0xCD</span>, <span class="number">0x04</span>);</span><br><span class="line"><span class="comment">//LD_WriteReg(0x17, 0x4c); </span></span><br><span class="line">delay(<span class="number">5</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0xB9</span>, <span class="number">0x00</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0xCF</span>, <span class="number">0x4F</span>); </span><br><span class="line">LD_WriteReg(<span class="number">0x6F</span>, <span class="number">0xFF</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š  LDæ¨¡å— ASRåŠŸèƒ½åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼š none</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š  none</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼š è¯¥å‡½æ•°ä¸ºå‡ºå‚é…ç½®ï¼Œä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼›</span></span><br><span class="line"><span class="comment"> æœ‰å…´è¶£çš„å®¢æˆ·å¯å¯¹ç…§å¼€å‘æ‰‹å†Œæ ¹æ®éœ€è¦è‡ªè¡Œä¿®æ”¹ã€‚</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LD_Init_ASR</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">LD_Init_Common();</span><br><span class="line">LD_WriteReg(<span class="number">0xBD</span>, <span class="number">0x00</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x17</span>, <span class="number">0x48</span>);</span><br><span class="line">delay( <span class="number">10</span> );</span><br><span class="line">LD_WriteReg(<span class="number">0x3C</span>, <span class="number">0x80</span>);    </span><br><span class="line">LD_WriteReg(<span class="number">0x3E</span>, <span class="number">0x07</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x38</span>, <span class="number">0xff</span>);    </span><br><span class="line">LD_WriteReg(<span class="number">0x3A</span>, <span class="number">0x07</span>);</span><br><span class="line">  LD_WriteReg(<span class="number">0x40</span>, <span class="number">0</span>);          </span><br><span class="line">LD_WriteReg(<span class="number">0x42</span>, <span class="number">8</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x44</span>, <span class="number">0</span>);    </span><br><span class="line">LD_WriteReg(<span class="number">0x46</span>, <span class="number">8</span>); </span><br><span class="line">delay( <span class="number">1</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š ä¸­æ–­å¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼š none</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š  none</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼šå½“LDæ¨¡å—æ¥æ”¶åˆ°éŸ³é¢‘ä¿¡å·æ—¶ï¼Œå°†è¿›å…¥è¯¥å‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment">åˆ¤æ–­è¯†åˆ«æ˜¯å¦æœ‰ç»“æœï¼Œå¦‚æœæ²¡æœ‰ä»æ–°é…ç½®å¯„</span></span><br><span class="line"><span class="comment">            å­˜å™¨å‡†å¤‡ä¸‹ä¸€æ¬¡çš„è¯†åˆ«ã€‚</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">ProcessInt0</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">uint8 nAsrResCount=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">EX0=<span class="number">0</span>;</span><br><span class="line">ucRegVal = LD_ReadReg(<span class="number">0x2B</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x29</span>,<span class="number">0</span>) ;</span><br><span class="line">LD_WriteReg(<span class="number">0x02</span>,<span class="number">0</span>) ;</span><br><span class="line"><span class="keyword">if</span>((ucRegVal &amp; <span class="number">0x10</span>) &amp;&amp;</span><br><span class="line">LD_ReadReg(<span class="number">0xb2</span>)==<span class="number">0x21</span> &amp;&amp; </span><br><span class="line">LD_ReadReg(<span class="number">0xbf</span>)==<span class="number">0x35</span>)<span class="comment">/*è¯†åˆ«æˆåŠŸ*/</span></span><br><span class="line">&#123;</span><br><span class="line">nAsrResCount = LD_ReadReg(<span class="number">0xba</span>);</span><br><span class="line"><span class="keyword">if</span>(nAsrResCount&gt;<span class="number">0</span> &amp;&amp; nAsrResCount&lt;=<span class="number">4</span>) </span><br><span class="line">&#123;</span><br><span class="line">nAsrStatus=LD_ASR_FOUNDOK;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">nAsrStatus=LD_ASR_FOUNDZERO;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="comment">/*æ²¡æœ‰è¯†åˆ«ç»“æœ*/</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123; </span><br><span class="line">nAsrStatus=LD_ASR_FOUNDZERO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  LD_WriteReg(<span class="number">0x2b</span>, <span class="number">0</span>);</span><br><span class="line">  LD_WriteReg(<span class="number">0x1C</span>,<span class="number">0</span>);<span class="comment">/*å†™0:ADCä¸å¯ç”¨*/</span></span><br><span class="line"></span><br><span class="line">LD_WriteReg(<span class="number">0x29</span>,<span class="number">0</span>) ;</span><br><span class="line">LD_WriteReg(<span class="number">0x02</span>,<span class="number">0</span>) ;</span><br><span class="line">LD_WriteReg(<span class="number">0x2B</span>,  <span class="number">0</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0xBA</span>, <span class="number">0</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0xBC</span>,<span class="number">0</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x08</span>,<span class="number">1</span>); <span class="comment">/*æ¸…é™¤FIFO_DATA*/</span></span><br><span class="line">LD_WriteReg(<span class="number">0x08</span>,<span class="number">0</span>);<span class="comment">/*æ¸…é™¤FIFO_DATAå å†æ¬¡å†™0*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EX0=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š è¿è¡ŒASRè¯†åˆ«æµç¨‹</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼šnone</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š  asrflagï¼š1-&gt;å¯åŠ¨æˆåŠŸï¼Œ 0â€”&gt;å¯åŠ¨å¤±è´¥</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼šè¯†åˆ«é¡ºåºå¦‚ä¸‹:</span></span><br><span class="line"><span class="comment">1ã€RunASR()å‡½æ•°å®ç°äº†ä¸€æ¬¡å®Œæ•´çš„ASRè¯­éŸ³è¯†åˆ«æµç¨‹</span></span><br><span class="line"><span class="comment">2ã€LD_AsrStart() å‡½æ•°å®ç°äº†ASRåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">3ã€LD_AsrAddFixed() å‡½æ•°å®ç°äº†æ·»åŠ å…³é”®è¯è¯­åˆ°LD3320èŠ¯ç‰‡ä¸­</span></span><br><span class="line"><span class="comment">4ã€LD_AsrRun()å‡½æ•°å¯åŠ¨äº†ä¸€æ¬¡ASRè¯­éŸ³è¯†åˆ«æµç¨‹</span></span><br><span class="line"><span class="comment">ä»»ä½•ä¸€æ¬¡ASRè¯†åˆ«æµç¨‹ï¼Œéƒ½éœ€è¦æŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œä»åˆå§‹åŒ–å¼€å§‹î‰£</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line">uint8 <span class="title function_">RunASR</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">uint8 i=<span class="number">0</span>;</span><br><span class="line">uint8 asrflag=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)<span class="comment">//é˜²æ­¢ç”±äºç¡¬ä»¶åŸå› å¯¼è‡´LD3320èŠ¯ç‰‡å·¥ä½œä¸æ­£å¸¸ï¼Œæ‰€ä»¥ä¸€å…±å°è¯•5æ¬¡å¯åŠ¨ASRè¯†åˆ«æµç¨‹</span></span><br><span class="line">&#123;</span><br><span class="line">LD_AsrStart();</span><br><span class="line">delay(<span class="number">50</span>);</span><br><span class="line"><span class="keyword">if</span> (LD_AsrAddFixed()==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">LD_Reset();<span class="comment">//LD3320èŠ¯ç‰‡å†…éƒ¨å‡ºç°ä¸æ­£å¸¸ï¼Œç«‹å³é‡å¯LD3320èŠ¯ç‰‡</span></span><br><span class="line">delay(<span class="number">50</span>);<span class="comment">//å¹¶ä»åˆå§‹åŒ–å¼€å§‹é‡æ–°ASRè¯†åˆ«æµç¨‹</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">delay(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">if</span> (LD_AsrRun() == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">LD_Reset();<span class="comment">//LD3320èŠ¯ç‰‡å†…éƒ¨å‡ºç°ä¸æ­£å¸¸ï¼Œç«‹å³é‡å¯LD3320èŠ¯ç‰‡</span></span><br><span class="line">delay(<span class="number">50</span>);<span class="comment">//å¹¶ä»åˆå§‹åŒ–å¼€å§‹é‡æ–°ASRè¯†åˆ«æµç¨‹</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">asrflag=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">break</span>;<span class="comment">//ASRæµç¨‹å¯åŠ¨æˆåŠŸï¼Œé€€å‡ºå½“å‰forå¾ªç¯ã€‚å¼€å§‹ç­‰å¾…LD3320é€å‡ºçš„ä¸­æ–­ä¿¡å·</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> asrflag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š  æ£€æµ‹LDæ¨¡å—æ˜¯å¦ç©ºé—²</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼šnone</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š flagï¼š1-&gt; ç©ºé—²</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼šnone</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line">uint8 <span class="title function_">LD_Check_ASRBusyFlag_b2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">uint8 j;</span><br><span class="line">uint8 flag = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;<span class="number">10</span>; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (LD_ReadReg(<span class="number">0xb2</span>) == <span class="number">0x21</span>)</span><br><span class="line">&#123;</span><br><span class="line">flag = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">delay(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š å¯åŠ¨ASR</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼šnone</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š none</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼šnone</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">LD_AsrStart</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">LD_Init_ASR();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š è¿è¡ŒASR</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼šnone</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š 1ï¼šå¯åŠ¨æˆåŠŸ</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼šnone</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line">uint8 <span class="title function_">LD_AsrRun</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">EX0=<span class="number">0</span>;</span><br><span class="line">LD_WriteReg(<span class="number">0x35</span>, MIC_VOL);</span><br><span class="line">LD_WriteReg(<span class="number">0x1C</span>, <span class="number">0x09</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0xBD</span>, <span class="number">0x20</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x08</span>, <span class="number">0x01</span>);</span><br><span class="line">delay( <span class="number">10</span> );</span><br><span class="line">LD_WriteReg(<span class="number">0x08</span>, <span class="number">0x00</span>);</span><br><span class="line">delay( <span class="number">10</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(LD_Check_ASRBusyFlag_b2() == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//LD_WriteReg(0xB6, 0xa); //è¯†åˆ«æ—¶é—´ 1S</span></span><br><span class="line"><span class="comment">//LD_WriteReg(0xB5, 0x1E); //èƒŒæ™¯éŸ³æ®µæ—¶é—´ 300ms</span></span><br><span class="line"><span class="comment">//LD_WriteReg(0xB8, 10); //ç»“æŸæ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//LD_WriteReg(0x1C, 0x07); //é…ç½®åŒé€šé“éŸ³é¢‘ä¿¡å·åšä¸ºè¾“å…¥ä¿¡å·</span></span><br><span class="line">LD_WriteReg(<span class="number">0x1C</span>, <span class="number">0x0b</span>); <span class="comment">//é…ç½®éº¦å…‹é£åšä¸ºè¾“å…¥ä¿¡å·</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LD_WriteReg(<span class="number">0xB2</span>, <span class="number">0xff</span>);</span><br><span class="line">delay( <span class="number">10</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x37</span>, <span class="number">0x06</span>);</span><br><span class="line">delay( <span class="number">10</span> );</span><br><span class="line">    LD_WriteReg(<span class="number">0x37</span>, <span class="number">0x06</span>);</span><br><span class="line">delay( <span class="number">5</span> );</span><br><span class="line">LD_WriteReg(<span class="number">0x29</span>, <span class="number">0x10</span>);</span><br><span class="line"></span><br><span class="line">LD_WriteReg(<span class="number">0xBD</span>, <span class="number">0x00</span>);</span><br><span class="line">EX0=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š å‘LDæ¨¡å—æ·»åŠ å…³é”®è¯</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼š none</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š flagï¼š1-&gt;æ·»åŠ æˆåŠŸ</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼š ç”¨æˆ·ä¿®æ”¹.</span></span><br><span class="line"><span class="comment"> 1ã€æ ¹æ®å¦‚ä¸‹æ ¼å¼æ·»åŠ æ‹¼éŸ³å…³é”®è¯ï¼ŒåŒæ—¶æ³¨æ„ä¿®æ”¹sRecog å’ŒpCode æ•°ç»„çš„é•¿åº¦</span></span><br><span class="line"><span class="comment"> å’Œå¯¹åº”å˜äº†kçš„å¾ªç¯ç½®ã€‚æ‹¼éŸ³ä¸²å’Œè¯†åˆ«ç æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚</span></span><br><span class="line"><span class="comment"> 2ã€å¼€å‘è€…å¯ä»¥å­¦ä¹ &quot;è¯­éŸ³è¯†åˆ«èŠ¯ç‰‡LD3320é«˜é˜¶ç§˜ç±.pdf&quot;ä¸­</span></span><br><span class="line"><span class="comment">           å…³äºåƒåœ¾è¯è¯­å¸æ”¶é”™è¯¯çš„ç”¨æ³•ï¼Œæ¥æä¾›è¯†åˆ«æ•ˆæœã€‚</span></span><br><span class="line"><span class="comment"> 3ã€â€xiao jie â€œ ä¸ºå£ä»¤ï¼Œæ•…åœ¨æ¯æ¬¡è¯†åˆ«æ—¶ï¼Œå¿…é¡»å…ˆå‘ä¸€çº§å£ä»¤â€œå°æ·â€</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line">uint8 <span class="title function_">LD_AsrAddFixed</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">uint8 k, flag;</span><br><span class="line">uint8 nAsrAddLength;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DATE_A 18   <span class="comment">/*æ•°ç»„äºŒç»´æ•°å€¼*/</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DATE_B 20<span class="comment">/*æ•°ç»„ä¸€ç»´æ•°å€¼*/</span></span></span><br><span class="line">uint8 code sRecog[DATE_A][DATE_B] = &#123;</span><br><span class="line"><span class="string">&quot;xiao xin&quot;</span>,\</span><br><span class="line"><span class="string">&quot;kai fa ban yan zheng&quot;</span>,\</span><br><span class="line"><span class="string">&quot;da kai ji dian qi&quot;</span>,\</span><br><span class="line"><span class="string">&quot;guan bi ji dian qi&quot;</span>,\</span><br><span class="line"><span class="string">&quot;kai deng&quot;</span>,\</span><br><span class="line"><span class="string">&quot;guan deng&quot;</span>,\</span><br><span class="line"><span class="string">&quot;zai jian&quot;</span>,\</span><br><span class="line"><span class="string">&quot;bo fang yin yue&quot;</span>,\</span><br><span class="line"><span class="string">&quot;da kai feng shan&quot;</span>,\</span><br><span class="line">                                    <span class="string">&quot;guan bi feng shan&quot;</span>,\</span><br><span class="line">                                      <span class="string">&quot;bai bai&quot;</span>,\</span><br><span class="line">                                     <span class="string">&quot;xia yi shou&quot;</span>,\</span><br><span class="line">                                    <span class="string">&quot;ping fan zhi lu&quot;</span>,\</span><br><span class="line"> <span class="string">&quot;mang zhong&quot;</span>,\</span><br><span class="line"> <span class="string">&quot;shao nian&quot;</span>,\</span><br><span class="line"> <span class="string">&quot;ni de da an&quot;</span>,\</span><br><span class="line"> <span class="string">&quot;jing lei&quot;</span>,\</span><br><span class="line"><span class="string">&quot;qi yue shang&quot;</span>,\</span><br><span class="line">&#125;;  <span class="comment">/*æ·»åŠ å…³é”®è¯ï¼Œç”¨æˆ·ä¿®æ”¹*/</span></span><br><span class="line">uint8 code pCode[DATE_A] = &#123;</span><br><span class="line">CODE_CMD,\   </span><br><span class="line">CODE_KFBYZ,\  </span><br><span class="line">CODE_DKJDQ,\  </span><br><span class="line">CODE_GBJDQ,\</span><br><span class="line">CODE_KD,\</span><br><span class="line">CODE_GD,\</span><br><span class="line">CODE_ZJ,\</span><br><span class="line">CODE_BFYY,\</span><br><span class="line">                          CODE_DKFS,\</span><br><span class="line">                          CODE_GBFS,\</span><br><span class="line">                          CODE_BB,\</span><br><span class="line">                          CODE_XYS,\</span><br><span class="line">                          CODE_PFZL,\</span><br><span class="line">                           CODE_MZ,\</span><br><span class="line">                            CODE_SN,\</span><br><span class="line">                            CODE_NDDA,\</span><br><span class="line">                           CODE_JL,\</span><br><span class="line">                          CODE_QYS,\</span><br><span class="line"></span><br><span class="line"> &#125;;</span><br><span class="line"><span class="comment">/*æ·»åŠ è¯†åˆ«ç ï¼Œç”¨æˆ·ä¿®æ”¹*/</span></span><br><span class="line"> </span><br><span class="line">flag = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (k=<span class="number">0</span>; k&lt;DATE_A; k++)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(LD_Check_ASRBusyFlag_b2() == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">flag = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LD_WriteReg(<span class="number">0xc1</span>, pCode[k] );</span><br><span class="line">LD_WriteReg(<span class="number">0xc3</span>, <span class="number">0</span> );</span><br><span class="line">LD_WriteReg(<span class="number">0x08</span>, <span class="number">0x04</span>);</span><br><span class="line">delay(<span class="number">10</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x08</span>, <span class="number">0x00</span>);</span><br><span class="line">delay(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (nAsrAddLength=<span class="number">0</span>; nAsrAddLength&lt;DATE_B; nAsrAddLength++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (sRecog[k][nAsrAddLength] == <span class="number">0</span>)</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">LD_WriteReg(<span class="number">0x5</span>, sRecog[k][nAsrAddLength]);</span><br><span class="line">&#125;</span><br><span class="line">LD_WriteReg(<span class="number">0xb9</span>, nAsrAddLength);</span><br><span class="line">LD_WriteReg(<span class="number">0xb2</span>, <span class="number">0xff</span>);</span><br><span class="line">LD_WriteReg(<span class="number">0x37</span>, <span class="number">0x04</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/************************************************************************</span></span><br><span class="line"><span class="comment">åŠŸèƒ½æè¿°ï¼š è·å–è¯†åˆ«ç»“æœ</span></span><br><span class="line"><span class="comment">å…¥å£å‚æ•°ï¼šnone</span></span><br><span class="line"><span class="comment">è¿” å› å€¼ï¼š LD_ReadReg(0xc5 )ï¼›  è¯»å–å†…éƒ¨å¯„å­˜å™¨è¿”å›è¯†åˆ«ç ã€‚</span></span><br><span class="line"><span class="comment">å…¶ä»–è¯´æ˜ï¼šnone</span></span><br><span class="line"><span class="comment">**************************************************************************/</span></span><br><span class="line">uint8 <span class="title function_">LD_GetResult</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> LD_ReadReg(<span class="number">0xc5</span> );</span><br><span class="line">&#125;`</span><br><span class="line"></span><br><span class="line">LDChip.h:</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>#ifndef LD_CHIP_H<br>#define LD_CHIP_H</p><p>#define uint8 unsigned char<br>#define uint16 unsigned int<br>#define uint32 unsigned long</p><p>&#x2F;&#x2F;ä»¥ä¸‹äº”ä¸ªçŠ¶æ€å®šä¹‰ç”¨æ¥è®°å½•ç¨‹åºæ˜¯åœ¨è¿è¡ŒASRè¯†åˆ«è¿‡ç¨‹ä¸­çš„å“ªä¸ªçŠ¶æ€<br>#define LD_ASR_NONE0x00 &#x2F;*è¡¨ç¤ºæ²¡æœ‰åœ¨ä½œASRè¯†åˆ«*&#x2F;<br>#define LD_ASR_RUNING0x01&#x2F;*è¡¨ç¤ºLD3320æ­£åœ¨ä½œASRè¯†åˆ«ä¸­*&#x2F;<br>#define LD_ASR_FOUNDOK0x10&#x2F;<em>è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ç»“æŸåï¼Œæœ‰ä¸€ä¸ªè¯†åˆ«ç»“æœ</em>&#x2F;<br>#define LD_ASR_FOUNDZERO 0x11&#x2F;<em>è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ç»“æŸåï¼Œæ²¡æœ‰è¯†åˆ«ç»“æœ</em>&#x2F;<br>#define LD_ASR_ERROR 0x31&#x2F;<em>è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ä¸­LD3320èŠ¯ç‰‡å†…éƒ¨å‡ºç°ä¸æ­£ç¡®çš„çŠ¶æ€</em>&#x2F;</p><p>#define CLK_IN   22.1184&#x2F;* ç”¨æˆ·æ³¨æ„ä¿®æ”¹è¾“å…¥çš„æ™¶æŒ¯æ—¶é’Ÿå¤§å° <em>&#x2F;<br>#define LD_PLL_11(uint8)((CLK_IN&#x2F;2.0)-1)<br>#define LD_PLL_MP3_190x0f<br>#define LD_PLL_MP3_1B0x18<br>#define LD_PLL_MP3_1D   (uint8)(((90.0</em>((LD_PLL_11)+1))&#x2F;(CLK_IN))-1)</p><p>#define LD_PLL_ASR_19 (uint8)(CLK_IN*32.0&#x2F;(LD_PLL_11+1) - 0.51)<br>#define LD_PLL_ASR_1B 0x48<br>#define LD_PLL_ASR_1D 0x1f</p><p>&#x2F;&#x2F;å‡½æ•°å£°æ˜<br>void LD_Reset();<br>void LD_Init_Common();<br>void LD_Init_ASR();<br>uint8 RunASR(void);<br>void LD_AsrStart();<br>uint8 LD_AsrRun();<br>uint8 LD_AsrAddFixed();<br>uint8 LD_GetResult();</p><p>&#x2F;&#x2F;è¯†åˆ«ç å®¢æˆ·ä¿®æ”¹å¤„<br>#define CODE_CMD  0x00   &#x2F;&#x2F;è¯¥å‘½ä»¤ç 0x00ç”¨æˆ·ä¸å¯è¿›è¡Œä¿®æ”¹ã€‚<br>#define CODE_KFBYZ  0x01  &#x2F;&#x2F;å¼€å‘æ¿éªŒè¯<br>#defineCODE_DKJDQ   0x02  &#x2F;&#x2F;æ‰“å¼€ç»§ç”µå™¨<br>#defineCODE_GBJDQ  0x03  &#x2F;&#x2F;å…³é—­ç»§ç”µå™¨<br>#defineCODE_KD  0x04  &#x2F;&#x2F;å¼€ç¯<br>#defineCODE_GD  0x05  &#x2F;&#x2F;å…³ç¯<br>#define CODE_ZJ  0x09  &#x2F;&#x2F;å†è§<br>#defineCODE_BFYY  0x06  &#x2F;&#x2F;æ’­æ”¾æ­Œæ›²<br>#define CODE_DKFS  0x07  &#x2F;&#x2F;æ‰“å¼€é£æ‰‡<br>#define CODE_GBFS  0x08  &#x2F;&#x2F;å…³é—­é£æ‰‡<br>#define CODE_BB  0x09  &#x2F;&#x2F;æ‹œæ‹œ<br>#define CODE_XYS  0x10  &#x2F;&#x2F;å¾ªç¯æ’­æ”¾01æ–‡ä»¶å¤¹ä¸‹çš„æ›²ç›®<br>#define CODE_PFZL 0x0a &#x2F;&#x2F;å¹³å‡¡ä¹‹è·¯<br>#define CODE_SN 0x0b  &#x2F;&#x2F;æ›²ç›®å°‘å¹´<br>#define CODE_NDDA 0x0c &#x2F;&#x2F;æ›²ç›®ä½ çš„ç­”æ¡ˆ<br>#define CODE_MZ 0x0e  &#x2F;&#x2F;æ›²ç›®èŠ’ç§<br>#define CODE_JL 0x0f &#x2F;&#x2F;æ›²ç›®æƒŠé›·<br>#define CODE_QYS 0x11 &#x2F;&#x2F;æ›²ç›®ä¸ƒæœˆä¸Š</p><p>&#x2F;&#x2F;è°ƒèŠ‚è¯†åˆ«è·ç¦»ï¼Œæ•°å€¼è¶Šå¤§è¶Šè¿œï¼Œä½†è¯¯è¯†åˆ«æ¦‚ç‡è¶Šå¤§<br>#define MIC_VOL 0x42 &#x2F;&#x2F;å’ªå¤´å¢ç›Šï¼ˆçµæ•åº¦è°ƒèŠ‚ï¼‰èŒƒå›´ï¼š0X00-0X7f è¶Šå¤§è¶Šçµæ•ï¼Œ<br>#endif</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">`#ifndef LD_CHIP_H</span><br><span class="line">#define LD_CHIP_H</span><br><span class="line"></span><br><span class="line">#define uint8 unsigned char</span><br><span class="line">#define uint16 unsigned int</span><br><span class="line">#define uint32 unsigned long</span><br><span class="line"></span><br><span class="line">//ä»¥ä¸‹äº”ä¸ªçŠ¶æ€å®šä¹‰ç”¨æ¥è®°å½•ç¨‹åºæ˜¯åœ¨è¿è¡ŒASRè¯†åˆ«è¿‡ç¨‹ä¸­çš„å“ªä¸ªçŠ¶æ€</span><br><span class="line">#define LD_ASR_NONE0x00 /*è¡¨ç¤ºæ²¡æœ‰åœ¨ä½œASRè¯†åˆ«*/</span><br><span class="line">#define LD_ASR_RUNING0x01/*è¡¨ç¤ºLD3320æ­£åœ¨ä½œASRè¯†åˆ«ä¸­*/</span><br><span class="line">#define LD_ASR_FOUNDOK0x10/*è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ç»“æŸåï¼Œæœ‰ä¸€ä¸ªè¯†åˆ«ç»“æœ*/</span><br><span class="line">#define LD_ASR_FOUNDZERO 0x11/*è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ç»“æŸåï¼Œæ²¡æœ‰è¯†åˆ«ç»“æœ*/</span><br><span class="line">#define LD_ASR_ERROR 0x31/*è¡¨ç¤ºä¸€æ¬¡è¯†åˆ«æµç¨‹ä¸­LD3320èŠ¯ç‰‡å†…éƒ¨å‡ºç°ä¸æ­£ç¡®çš„çŠ¶æ€*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#define CLK_IN   22.1184/* ç”¨æˆ·æ³¨æ„ä¿®æ”¹è¾“å…¥çš„æ™¶æŒ¯æ—¶é’Ÿå¤§å° */</span><br><span class="line">#define LD_PLL_11(uint8)((CLK_IN/2.0)-1)</span><br><span class="line">#define LD_PLL_MP3_190x0f</span><br><span class="line">#define LD_PLL_MP3_1B0x18</span><br><span class="line">#define LD_PLL_MP3_1D   (uint8)(((90.0*((LD_PLL_11)+1))/(CLK_IN))-1)</span><br><span class="line"></span><br><span class="line">#define LD_PLL_ASR_19 (uint8)(CLK_IN*32.0/(LD_PLL_11+1) - 0.51)</span><br><span class="line">#define LD_PLL_ASR_1B 0x48</span><br><span class="line">#define LD_PLL_ASR_1D 0x1f</span><br><span class="line"></span><br><span class="line">//å‡½æ•°å£°æ˜</span><br><span class="line">void LD_Reset();</span><br><span class="line">void LD_Init_Common();</span><br><span class="line">void LD_Init_ASR();</span><br><span class="line">uint8 RunASR(void);</span><br><span class="line">void LD_AsrStart();</span><br><span class="line">uint8 LD_AsrRun();</span><br><span class="line">uint8 LD_AsrAddFixed();</span><br><span class="line">uint8 LD_GetResult();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//è¯†åˆ«ç å®¢æˆ·ä¿®æ”¹å¤„ </span><br><span class="line">#define CODE_CMD  0x00   //è¯¥å‘½ä»¤ç 0x00ç”¨æˆ·ä¸å¯è¿›è¡Œä¿®æ”¹ã€‚</span><br><span class="line">#define CODE_KFBYZ  0x01  //å¼€å‘æ¿éªŒè¯</span><br><span class="line">#defineCODE_DKJDQ   0x02  //æ‰“å¼€ç»§ç”µå™¨</span><br><span class="line">#defineCODE_GBJDQ  0x03  //å…³é—­ç»§ç”µå™¨</span><br><span class="line">#defineCODE_KD  0x04  //å¼€ç¯</span><br><span class="line">#defineCODE_GD  0x05  //å…³ç¯</span><br><span class="line">#define CODE_ZJ  0x09  //å†è§</span><br><span class="line">#defineCODE_BFYY  0x06  //æ’­æ”¾æ­Œæ›²</span><br><span class="line">#define CODE_DKFS  0x07  //æ‰“å¼€é£æ‰‡</span><br><span class="line">#define CODE_GBFS  0x08  //å…³é—­é£æ‰‡</span><br><span class="line">#define CODE_BB  0x09  //æ‹œæ‹œ</span><br><span class="line">#define CODE_XYS  0x10  //å¾ªç¯æ’­æ”¾01æ–‡ä»¶å¤¹ä¸‹çš„æ›²ç›®</span><br><span class="line">#define CODE_PFZL 0x0a //å¹³å‡¡ä¹‹è·¯</span><br><span class="line">#define CODE_SN 0x0b  //æ›²ç›®å°‘å¹´</span><br><span class="line">#define CODE_NDDA 0x0c //æ›²ç›®ä½ çš„ç­”æ¡ˆ</span><br><span class="line">#define CODE_MZ 0x0e  //æ›²ç›®èŠ’ç§</span><br><span class="line">#define CODE_JL 0x0f //æ›²ç›®æƒŠé›·</span><br><span class="line">#define CODE_QYS 0x11 //æ›²ç›®ä¸ƒæœˆä¸Š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//è°ƒèŠ‚è¯†åˆ«è·ç¦»ï¼Œæ•°å€¼è¶Šå¤§è¶Šè¿œï¼Œä½†è¯¯è¯†åˆ«æ¦‚ç‡è¶Šå¤§</span><br><span class="line">#define MIC_VOL 0x42 //å’ªå¤´å¢ç›Šï¼ˆçµæ•åº¦è°ƒèŠ‚ï¼‰èŒƒå›´ï¼š0X00-0X7f è¶Šå¤§è¶Šçµæ•ï¼Œ</span><br><span class="line">#endif`</span><br><span class="line"></span><br><span class="line">- ğŸ“šç™¾åº¦èµ„æºé“¾æ¥ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1NU_R5PitJGwI6C3svPpQwQ">https://pan.baidu.com/s/1NU_R5PitJGwI6C3svPpQwQ</a><br>æå–ç ï¼škffj</p><pre><code>`é“¾æ¥ï¼šhttps://pan.baidu.com/s/1NU_R5PitJGwI6C3svPpQwQ æå–ç ï¼škffj`#### ğŸ“æ€»ç»“##### å½“å‰å›½å†…è¯­éŸ³è¯†åˆ«ç›¸å…³æ¨¡å—é£é€Ÿå‘å±•ï¼Œå›½å†…ç›¸å…³çš„è¯­éŸ³è¯†åˆ«æ¨¡å—ï¼Œåœ¨è¯†åˆ«ç‡ä¸Šå¾ˆé«˜ï¼Œä¸ªäººä½¿ç”¨æ„Ÿè§‰ï¼Œåœ¨è¯†åˆ«ç‡æ–¹é¢è¿œè¶…æ­¤æ¨¡å—ï¼Œå›½å†…çš„è¯­éŸ³æ¨¡å—å¤§å¤šæ˜¯åœ¨æŠ½è±¡å±‚è¿›è¡Œè¿›è¡Œå¼€å‘ã€‚åƒæœºèŠ¯æ™ºèƒ½çš„è¯­éŸ³æ¨¡å—ï¼ŒåŸºäºäº‘å¹³å°ç¼–è¯‘ã€‚å¤©é—®è¯­éŸ³æ¨¡å—åŸºäºæ­ç§¯æœ¨æ–¹å¼ã€‚æµ·å‡Œç§‘éœ€è¦æ‰¹é‡æ‰èƒ½å®šåˆ¶ã€‚ä¼˜åŠ£å„æœ‰ã€‚</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>74HC595é©±åŠ¨2ä½æ•°ç ç®¡ä»£ç å®ç°å’Œæ³¨æ„äº‹é¡¹</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-74HC595%E9%A9%B1%E5%8A%A82%E4%BD%8D%E6%95%B0%E7%A0%81%E7%AE%A1%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-74HC595%E9%A9%B1%E5%8A%A82%E4%BD%8D%E6%95%B0%E7%A0%81%E7%AE%A1%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%92%8C%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="74HC595é©±åŠ¨2ä½æ•°ç ç®¡ä»£ç å®ç°å’Œæ³¨æ„äº‹é¡¹"><a href="#74HC595é©±åŠ¨2ä½æ•°ç ç®¡ä»£ç å®ç°å’Œæ³¨æ„äº‹é¡¹" class="headerlink" title="74HC595é©±åŠ¨2ä½æ•°ç ç®¡ä»£ç å®ç°å’Œæ³¨æ„äº‹é¡¹"></a>74HC595é©±åŠ¨2ä½æ•°ç ç®¡ä»£ç å®ç°å’Œæ³¨æ„äº‹é¡¹</h1><h4 id="74HC595é©±åŠ¨2ä½æ•°ç ç®¡"><a href="#74HC595é©±åŠ¨2ä½æ•°ç ç®¡" class="headerlink" title="74HC595é©±åŠ¨2ä½æ•°ç ç®¡"></a>74HC595é©±åŠ¨2ä½æ•°ç ç®¡</h4><p><img src="https://img-blog.csdnimg.cn/ecc4b2c0c1244c378c2c5f5f4800c4cf.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>ğŸ“Œç›¸å…³ç¯‡ã€Šã€Proteusä»¿çœŸã€‘51å•ç‰‡æœº+74HC595é©±åŠ¨æ•°ç ç®¡60ç§’å€’è®¡æ—¶ã€‹</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/130824754">ã€Proteusä»¿çœŸã€‘51å•ç‰‡æœº+74HC595é©±åŠ¨æ•°ç ç®¡60ç§’å€’è®¡æ—¶</a></p><ul><li>é©±åŠ¨èŠ¯ç‰‡ï¼š74HC595,74LS595ï¼Œ</li><li>å•ç‰‡æœºï¼šAT89C52ï¼Œæˆ–è€…STC89C52éƒ½å¯ä»¥</li></ul><p><code>74HC595</code></p><p><code>74LS595</code></p><p><code>STC89C52</code></p><h4 id="ğŸ“å®ä¾‹ä»£ç "><a href="#ğŸ“å®ä¾‹ä»£ç " class="headerlink" title="ğŸ“å®ä¾‹ä»£ç "></a>ğŸ“å®ä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;STC89C5xRC.H&gt;</span><br><span class="line">//#include&lt;reg52.h&gt;</span><br><span class="line">#include &quot;intrins.h&quot;</span><br><span class="line"></span><br><span class="line">sbit ST=P2^0;</span><br><span class="line">sbit SH=P2^2;</span><br><span class="line">sbit DS=P2^1;</span><br><span class="line"></span><br><span class="line">typedef unsigned int u16;  //å¯¹æ•°æ®ç±»å‹è¿›è¡Œå£°æ˜å®šä¹‰</span><br><span class="line">typedef unsigned char u8;</span><br><span class="line"></span><br><span class="line">#define duanxuan P0</span><br><span class="line">#define keyboard P1</span><br><span class="line">u8 code smgduan[10]=// &#123;0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8, 0x80, 0x90&#125;;//å…±é˜³æ•°ç ç®¡æ®µç </span><br><span class="line">&#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f&#125;; //å…±é˜´æ•°ç ç®¡æ®µç </span><br><span class="line">u8 duanZhi[]= &#123;0,0&#125;;//æ•°ç ç®¡æ˜¾ç¤ºä½æ•°çš„æ•°å€¼æ•°ç»„</span><br><span class="line">static u8 gewei, shiwei,num;</span><br><span class="line"></span><br><span class="line">void SendTo595(u8 byteData);</span><br><span class="line"></span><br><span class="line">void display();</span><br><span class="line">void delay(int s)</span><br><span class="line">&#123;</span><br><span class="line">    u16 i,j;</span><br><span class="line">    for(i=0; i&lt;s; i++)            //å»¶æ—¶å‡½æ•°</span><br><span class="line">        for(j=114; j&gt;0; j--);</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    P2=0xff;</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        display();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/***********************************************************</span><br><span class="line">*å‡½æ•°åï¼šSendTo595</span><br><span class="line">*åŠŸèƒ½:ä¸²è¡Œå‘é€8ä¸ªæ¯”ç‰¹ï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰çš„æ•°æ®ç»™595ï¼Œå†å¹¶è¡Œè¾“å‡º</span><br><span class="line">*å‚æ•°ï¼šbyteData</span><br><span class="line">************************************************************/</span><br><span class="line">void SendTo595(u8 byteData)</span><br><span class="line">&#123;</span><br><span class="line">    char i=0;</span><br><span class="line">//    P2=duanMa[n];</span><br><span class="line">    ST = 0;   //ST //å…ˆæ‹‰ä½ï¼Œä¸ºåé¢çš„ä¸Šå‡æ²¿åšå‡†å¤‡</span><br><span class="line">    for(i; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        //  SH = 0;//å…ˆæ‹‰ä½ï¼Œ</span><br><span class="line">//        if(byteData&amp;0x80)DS=1;</span><br><span class="line">//        else DS=0;</span><br><span class="line">        DS = (byteData&amp;0x80)?1:0;</span><br><span class="line">        byteData = byteData &lt;&lt;1;//è¯¥å­—èŠ‚å³ç§»ä¸€ä½</span><br><span class="line">        SH = 1;//ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        SH = 0;        //ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ</span><br><span class="line">    &#125;</span><br><span class="line">/*ä½ç§»å¯„å­˜å™¨æ•°æ®å‡†å¤‡å®Œæ¯•,è½¬ç§»åˆ°å­˜å‚¨å¯„å­˜å™¨*/</span><br><span class="line">    ST =1;//ä¸Šå‡æ²¿ï¼Œè®©å­˜å‚¨å¯„å­˜å™¨æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    ST = 0;</span><br><span class="line"></span><br><span class="line">    //    SH = 0; //å˜ä¸ºä½ç”µå¹³ï¼Œä¸ºä¸‹æ¬¡å‡†å¤‡</span><br><span class="line">    //   byteData=byteData &lt;&lt;1;</span><br><span class="line">&#125;</span><br><span class="line">void display()</span><br><span class="line">&#123;</span><br><span class="line">    gewei = 97%10;</span><br><span class="line">    shiwei = 97/10;</span><br><span class="line">    duanZhi[0]=smgduan[shiwei];</span><br><span class="line">    duanZhi[1]=smgduan[gewei];</span><br><span class="line"></span><br><span class="line">    P26=0x01;</span><br><span class="line">    P25=0x00;//å…ˆè®©åä½å…ˆæ˜¾ç¤º</span><br><span class="line">    SendTo595(duanZhi[0]);//å¦‚æœé‡‡ç”¨å…±é˜³å°±å–å</span><br><span class="line">    delay(20);//è¯¥å»¶æ—¶ä¸èƒ½å°‘ï¼Œæ ¹æ®å®é™…æ˜¾ç¤ºæ•ˆæœè°ƒæ•´ï¼Œå·²è°ƒå¥½ã€‚</span><br><span class="line"></span><br><span class="line">    P25=0x01;</span><br><span class="line">    P26=0x00;//æ˜¾ç¤ºä¸ªä½</span><br><span class="line">    SendTo595(duanZhi[1]); //é€æ®µç </span><br><span class="line">    delay(20);</span><br><span class="line">//æ¶ˆéš</span><br><span class="line">    P25=0x01;</span><br><span class="line">    P26=0x01;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;STC89C5xRC.H&gt;<br>&#x2F;&#x2F;#include&lt;reg52.h&gt;<br>#include â€œintrins.hâ€</p><p>sbit ST&#x3D;P2^0;<br>sbit SH&#x3D;P2^2;<br>sbit DS&#x3D;P2^1;</p><p>typedef unsigned int u16;  &#x2F;&#x2F;å¯¹æ•°æ®ç±»å‹è¿›è¡Œå£°æ˜å®šä¹‰<br>typedef unsigned char u8;</p><p>#define duanxuan P0<br>#define keyboard P1<br>u8 code smgduan[10]&#x3D;&#x2F;&#x2F; {0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8, 0x80, 0x90};&#x2F;&#x2F;å…±é˜³æ•°ç ç®¡æ®µç <br>{0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f}; &#x2F;&#x2F;å…±é˜´æ•°ç ç®¡æ®µç <br>u8 duanZhi[]&#x3D; {0,0};&#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºä½æ•°çš„æ•°å€¼æ•°ç»„<br>static u8 gewei, shiwei,num;</p><p>void SendTo595(u8 byteData);</p><p>void display();<br>void delay(int s)<br>{<br>    u16 i,j;<br>    for(i&#x3D;0; i&lt;s; i++)            &#x2F;&#x2F;å»¶æ—¶å‡½æ•°<br>        for(j&#x3D;114; j&gt;0; jâ€“);<br>}<br>void main()<br>{<br>    P2&#x3D;0xff;<br>    while(1)<br>    {<br>        display();<br>    }</p><p>}<br>&#x2F;***********************************************************<br>*å‡½æ•°åï¼šSendTo595<br>*åŠŸèƒ½:ä¸²è¡Œå‘é€8ä¸ªæ¯”ç‰¹ï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰çš„æ•°æ®ç»™595ï¼Œå†å¹¶è¡Œè¾“å‡º<br>*å‚æ•°ï¼šbyteData<br>************************************************************&#x2F;<br>void SendTo595(u8 byteData)<br>{<br>    char i&#x3D;0;<br>&#x2F;&#x2F;    P2&#x3D;duanMa[n];<br>    ST &#x3D; 0;   &#x2F;&#x2F;ST &#x2F;&#x2F;å…ˆæ‹‰ä½ï¼Œä¸ºåé¢çš„ä¸Šå‡æ²¿åšå‡†å¤‡<br>    for(i; i&lt;8; i++)<br>    {<br>        &#x2F;&#x2F;  SH &#x3D; 0;&#x2F;&#x2F;å…ˆæ‹‰ä½ï¼Œ<br>&#x2F;&#x2F;        if(byteData&amp;0x80)DS&#x3D;1;<br>&#x2F;&#x2F;        else DS&#x3D;0;<br>        DS &#x3D; (byteData&amp;0x80)?1:0;<br>        byteData &#x3D; byteData &lt;&lt;1;&#x2F;&#x2F;è¯¥å­—èŠ‚å³ç§»ä¸€ä½<br>        SH &#x3D; 1;&#x2F;&#x2F;ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        SH &#x3D; 0;        &#x2F;&#x2F;ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ<br>    }<br>        &#x2F;<em>ä½ç§»å¯„å­˜å™¨æ•°æ®å‡†å¤‡å®Œæ¯•,è½¬ç§»åˆ°å­˜å‚¨å¯„å­˜å™¨</em>&#x2F;<br>    ST &#x3D;1;&#x2F;&#x2F;ä¸Šå‡æ²¿ï¼Œè®©å­˜å‚¨å¯„å­˜å™¨æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    ST &#x3D; 0;</p><pre><code>//    SH = 0; //å˜ä¸ºä½ç”µå¹³ï¼Œä¸ºä¸‹æ¬¡å‡†å¤‡//   byteData=byteData &lt;&lt;1;</code></pre><p>}<br>void display()<br>{<br>    gewei &#x3D; 97%10;<br>    shiwei &#x3D; 97&#x2F;10;<br>    duanZhi[0]&#x3D;smgduan[shiwei];<br>    duanZhi[1]&#x3D;smgduan[gewei];</p><pre><code>P26=0x01;P25=0x00;//å…ˆè®©åä½å…ˆæ˜¾ç¤ºSendTo595(duanZhi[0]);//å¦‚æœé‡‡ç”¨å…±é˜³å°±å–ådelay(20);//è¯¥å»¶æ—¶ä¸èƒ½å°‘ï¼Œæ ¹æ®å®é™…æ˜¾ç¤ºæ•ˆæœè°ƒæ•´ï¼Œå·²è°ƒå¥½ã€‚P25=0x01;P26=0x00;//æ˜¾ç¤ºä¸ªä½SendTo595(duanZhi[1]); //é€æ®µç delay(20);</code></pre><p>&#x2F;&#x2F;æ¶ˆéš<br>    P25&#x3D;0x01;<br>    P26&#x3D;0x01;</p><p>}&#96;</p><h4 id="åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­å®¹æ˜“è¿›å…¥äº†ä¸€ä¸ªè¯¯åŒºï¼Œæ•°ç ç®¡é—ªå±ç°è±¡ï¼Œåœ¨å‡½æ•°SendTo595-åœ¨å¤šä½æ•°ç ç®¡æ˜¾ç¤ºçš„æ—¶å€™ï¼Œæ³¨æ„è°ƒæ•´ï¼Œä½ä¸ä½åˆ‡æ¢æ˜¾ç¤ºçš„æ—¶é—´é—´éš”ã€‚å¦‚æœæ˜¾ç¤ºä¸æ­£å¸¸ï¼Œå…¶å®æ˜¯ç”±äºé—´éš”æ—¶é—´æ²¡æœ‰è°ƒæ•´å¥½ï¼Œçœ‹åˆ°çš„è§†è§‰æ•ˆæœå°±æ˜¯å­—ç¬¦æ˜¾ç¤ºä¸å…¨ï¼Œéœ€è¦åœ¨æ¯ä¸ªä½å‘é€å®Œä¹‹åï¼Œæ·»åŠ ä¸€å®šçš„å»¶æ—¶æ—¶é—´ï¼Œæ•°ç ç®¡é—ªçƒçš„å¦å¤–ä¸€ä¸ªåŸå› æ˜¯ç”±äºæ˜¾ç¤ºçš„å‡½æ•°æ”¾ç½®çš„ä½ç½®ä¸åˆç†å¯¼è‡´çš„ï¼Œåº”è¯¥é è¿‘è°ƒç”¨æ˜¾ç¤ºçš„åœ°æ–¹ï¼Œå› ä¸ºç¨‹åºæŒ‡ä»¤è¦æ‰§è¡Œä¸€å®šçš„å‘¨æœŸã€‚"><a href="#åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­å®¹æ˜“è¿›å…¥äº†ä¸€ä¸ªè¯¯åŒºï¼Œæ•°ç ç®¡é—ªå±ç°è±¡ï¼Œåœ¨å‡½æ•°SendTo595-åœ¨å¤šä½æ•°ç ç®¡æ˜¾ç¤ºçš„æ—¶å€™ï¼Œæ³¨æ„è°ƒæ•´ï¼Œä½ä¸ä½åˆ‡æ¢æ˜¾ç¤ºçš„æ—¶é—´é—´éš”ã€‚å¦‚æœæ˜¾ç¤ºä¸æ­£å¸¸ï¼Œå…¶å®æ˜¯ç”±äºé—´éš”æ—¶é—´æ²¡æœ‰è°ƒæ•´å¥½ï¼Œçœ‹åˆ°çš„è§†è§‰æ•ˆæœå°±æ˜¯å­—ç¬¦æ˜¾ç¤ºä¸å…¨ï¼Œéœ€è¦åœ¨æ¯ä¸ªä½å‘é€å®Œä¹‹åï¼Œæ·»åŠ ä¸€å®šçš„å»¶æ—¶æ—¶é—´ï¼Œæ•°ç ç®¡é—ªçƒçš„å¦å¤–ä¸€ä¸ªåŸå› æ˜¯ç”±äºæ˜¾ç¤ºçš„å‡½æ•°æ”¾ç½®çš„ä½ç½®ä¸åˆç†å¯¼è‡´çš„ï¼Œåº”è¯¥é è¿‘è°ƒç”¨æ˜¾ç¤ºçš„åœ°æ–¹ï¼Œå› ä¸ºç¨‹åºæŒ‡ä»¤è¦æ‰§è¡Œä¸€å®šçš„å‘¨æœŸã€‚" class="headerlink" title="åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­å®¹æ˜“è¿›å…¥äº†ä¸€ä¸ªè¯¯åŒºï¼Œæ•°ç ç®¡é—ªå±ç°è±¡ï¼Œåœ¨å‡½æ•°SendTo595()åœ¨å¤šä½æ•°ç ç®¡æ˜¾ç¤ºçš„æ—¶å€™ï¼Œæ³¨æ„è°ƒæ•´ï¼Œä½ä¸ä½åˆ‡æ¢æ˜¾ç¤ºçš„æ—¶é—´é—´éš”ã€‚å¦‚æœæ˜¾ç¤ºä¸æ­£å¸¸ï¼Œå…¶å®æ˜¯ç”±äºé—´éš”æ—¶é—´æ²¡æœ‰è°ƒæ•´å¥½ï¼Œçœ‹åˆ°çš„è§†è§‰æ•ˆæœå°±æ˜¯å­—ç¬¦æ˜¾ç¤ºä¸å…¨ï¼Œéœ€è¦åœ¨æ¯ä¸ªä½å‘é€å®Œä¹‹åï¼Œæ·»åŠ ä¸€å®šçš„å»¶æ—¶æ—¶é—´ï¼Œæ•°ç ç®¡é—ªçƒçš„å¦å¤–ä¸€ä¸ªåŸå› æ˜¯ç”±äºæ˜¾ç¤ºçš„å‡½æ•°æ”¾ç½®çš„ä½ç½®ä¸åˆç†å¯¼è‡´çš„ï¼Œåº”è¯¥é è¿‘è°ƒç”¨æ˜¾ç¤ºçš„åœ°æ–¹ï¼Œå› ä¸ºç¨‹åºæŒ‡ä»¤è¦æ‰§è¡Œä¸€å®šçš„å‘¨æœŸã€‚"></a>åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­å®¹æ˜“è¿›å…¥äº†ä¸€ä¸ªè¯¯åŒºï¼Œæ•°ç ç®¡é—ªå±ç°è±¡ï¼Œåœ¨å‡½æ•°SendTo595()åœ¨å¤šä½æ•°ç ç®¡æ˜¾ç¤ºçš„æ—¶å€™ï¼Œæ³¨æ„è°ƒæ•´ï¼Œä½ä¸ä½åˆ‡æ¢æ˜¾ç¤ºçš„æ—¶é—´é—´éš”ã€‚å¦‚æœæ˜¾ç¤ºä¸æ­£å¸¸ï¼Œå…¶å®æ˜¯ç”±äºé—´éš”æ—¶é—´æ²¡æœ‰è°ƒæ•´å¥½ï¼Œçœ‹åˆ°çš„è§†è§‰æ•ˆæœå°±æ˜¯å­—ç¬¦æ˜¾ç¤ºä¸å…¨ï¼Œéœ€è¦åœ¨æ¯ä¸ªä½å‘é€å®Œä¹‹åï¼Œæ·»åŠ ä¸€å®šçš„å»¶æ—¶æ—¶é—´ï¼Œæ•°ç ç®¡é—ªçƒçš„å¦å¤–ä¸€ä¸ªåŸå› æ˜¯ç”±äºæ˜¾ç¤ºçš„å‡½æ•°æ”¾ç½®çš„ä½ç½®ä¸åˆç†å¯¼è‡´çš„ï¼Œåº”è¯¥é è¿‘è°ƒç”¨æ˜¾ç¤ºçš„åœ°æ–¹ï¼Œå› ä¸ºç¨‹åºæŒ‡ä»¤è¦æ‰§è¡Œä¸€å®šçš„å‘¨æœŸã€‚</h4><p><code>SendTo595()</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SendTo595(duanZhi[1]); //å‘é€æ®µç æ˜¾ç¤º</span><br><span class="line"> delay(20);//å¯¹äºå¤šä½æ•°ç ç®¡æ˜¾ç¤ºï¼Œè¯¥å»¶æ—¶éœ€è¦è‡ªè¡Œè°ƒæ•´é•¿çŸ­ã€‚</span><br></pre></td></tr></table></figure><p><code>SendTo595(duanZhi[1]); //å‘é€æ®µç æ˜¾ç¤º  delay(20);//å¯¹äºå¤šä½æ•°ç ç®¡æ˜¾ç¤ºï¼Œè¯¥å»¶æ—¶éœ€è¦è‡ªè¡Œè°ƒæ•´é•¿çŸ­ã€‚</code></p><h4 id="ğŸ“‘ä¸»è¦æ˜¯å­¦ä¹ 74HC595ï¼Œ8ä½ç§»ä½å¯„å­˜å™¨çš„åŸç†å’Œä»£ç å®ç°æ–¹æ³•ã€‚"><a href="#ğŸ“‘ä¸»è¦æ˜¯å­¦ä¹ 74HC595ï¼Œ8ä½ç§»ä½å¯„å­˜å™¨çš„åŸç†å’Œä»£ç å®ç°æ–¹æ³•ã€‚" class="headerlink" title="ğŸ“‘ä¸»è¦æ˜¯å­¦ä¹ 74HC595ï¼Œ8ä½ç§»ä½å¯„å­˜å™¨çš„åŸç†å’Œä»£ç å®ç°æ–¹æ³•ã€‚"></a>ğŸ“‘ä¸»è¦æ˜¯å­¦ä¹ 74HC595ï¼Œ8ä½ç§»ä½å¯„å­˜å™¨çš„åŸç†å’Œä»£ç å®ç°æ–¹æ³•ã€‚</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/***********************************************************</span><br><span class="line">*å‡½æ•°åï¼šSendTo595</span><br><span class="line">*åŠŸèƒ½:ä¸²è¡Œå‘é€8ä¸ªæ¯”ç‰¹ï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰çš„æ•°æ®ç»™595ï¼Œå†å¹¶è¡Œè¾“å‡º</span><br><span class="line">*å‚æ•°ï¼šbyteData</span><br><span class="line">************************************************************/</span><br><span class="line">void SendTo595(u8 byteData)</span><br><span class="line">&#123;</span><br><span class="line">    char i=0;</span><br><span class="line">//    P2=duanMa[n];</span><br><span class="line">    ST = 0;   //ST //å…ˆæ‹‰ä½ï¼Œä¸ºåé¢çš„ä¸Šå‡æ²¿åšå‡†å¤‡</span><br><span class="line">    for(i; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        //  SH = 0;//å…ˆæ‹‰ä½ï¼Œ</span><br><span class="line">//        if(byteData&amp;0x80)DS=1;</span><br><span class="line">//        else DS=0;</span><br><span class="line">        DS = (byteData&amp;0x80)?1:0;</span><br><span class="line">        byteData = byteData &lt;&lt;1;//è¯¥å­—èŠ‚å³ç§»ä¸€ä½</span><br><span class="line">        SH = 1;//ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        SH = 0;        //ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ</span><br><span class="line">    &#125;</span><br><span class="line">/*ä½ç§»å¯„å­˜å™¨æ•°æ®å‡†å¤‡å®Œæ¯•,è½¬ç§»åˆ°å­˜å‚¨å¯„å­˜å™¨*/</span><br><span class="line">    ST =1;//ä¸Šå‡æ²¿ï¼Œè®©å­˜å‚¨å¯„å­˜å™¨æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    ST = 0;</span><br><span class="line"></span><br><span class="line">    //    SH = 0; //å˜ä¸ºä½ç”µå¹³ï¼Œä¸ºä¸‹æ¬¡å‡†å¤‡</span><br><span class="line">    //   byteData=byteData &lt;&lt;1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;***********************************************************<br>*å‡½æ•°åï¼šSendTo595<br>*åŠŸèƒ½:ä¸²è¡Œå‘é€8ä¸ªæ¯”ç‰¹ï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰çš„æ•°æ®ç»™595ï¼Œå†å¹¶è¡Œè¾“å‡º<br>*å‚æ•°ï¼šbyteData<br>************************************************************&#x2F;<br>void SendTo595(u8 byteData)<br>{<br>    char i&#x3D;0;<br>&#x2F;&#x2F;    P2&#x3D;duanMa[n];<br>    ST &#x3D; 0;   &#x2F;&#x2F;ST &#x2F;&#x2F;å…ˆæ‹‰ä½ï¼Œä¸ºåé¢çš„ä¸Šå‡æ²¿åšå‡†å¤‡<br>    for(i; i&lt;8; i++)<br>    {<br>        &#x2F;&#x2F;  SH &#x3D; 0;&#x2F;&#x2F;å…ˆæ‹‰ä½ï¼Œ<br>&#x2F;&#x2F;        if(byteData&amp;0x80)DS&#x3D;1;<br>&#x2F;&#x2F;        else DS&#x3D;0;<br>        DS &#x3D; (byteData&amp;0x80)?1:0;<br>        byteData &#x3D; byteData &lt;&lt;1;&#x2F;&#x2F;è¯¥å­—èŠ‚å³ç§»ä¸€ä½<br>        SH &#x3D; 1;&#x2F;&#x2F;ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        SH &#x3D; 0;        &#x2F;&#x2F;ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ<br>    }<br>        &#x2F;<em>ä½ç§»å¯„å­˜å™¨æ•°æ®å‡†å¤‡å®Œæ¯•,è½¬ç§»åˆ°å­˜å‚¨å¯„å­˜å™¨</em>&#x2F;<br>    ST &#x3D;1;&#x2F;&#x2F;ä¸Šå‡æ²¿ï¼Œè®©å­˜å‚¨å¯„å­˜å™¨æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    ST &#x3D; 0;</p><pre><code>//    SH = 0; //å˜ä¸ºä½ç”µå¹³ï¼Œä¸ºä¸‹æ¬¡å‡†å¤‡//   byteData=byteData &lt;&lt;1;</code></pre><p>}&#96;</p><h4 id="ğŸ“šä»¿çœŸèµ„æºå’Œç¨‹åºä»£ç "><a href="#ğŸ“šä»¿çœŸèµ„æºå’Œç¨‹åºä»£ç " class="headerlink" title="ğŸ“šä»¿çœŸèµ„æºå’Œç¨‹åºä»£ç "></a>ğŸ“šä»¿çœŸèµ„æºå’Œç¨‹åºä»£ç </h4><ul><li>ğŸ”–99å€’è®¡æ—¶</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥: https://pan.baidu.com/s/1Z6r1Wc4d_TRoOMPcHTDkJg</span><br><span class="line">æå–ç : wyqg</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥: https://pan.baidu.com/s/1Z6r1Wc4d_TRoOMPcHTDkJg æå–ç : wyqg</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-8%E4%B8%AAIO%E5%8F%A3%E6%A3%80%E6%B5%8B64%E4%B8%AA%E6%8C%89%E9%94%AE%E6%8C%89%E9%94%AE%E8%87%AA%E9%94%81%E6%8E%A7%E5%88%B6%E6%96%B9%E5%BC%8F/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-8%E4%B8%AAIO%E5%8F%A3%E6%A3%80%E6%B5%8B64%E4%B8%AA%E6%8C%89%E9%94%AE%E6%8C%89%E9%94%AE%E8%87%AA%E9%94%81%E6%8E%A7%E5%88%B6%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼"><a href="#8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼" class="headerlink" title="8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼"></a>8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼</h1><h3 id="8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼-1"><a href="#8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼-1" class="headerlink" title="8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼"></a>8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼</h3><p>ç›¸å…³ç¯‡ã€Š8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œæ•°ç ç®¡æ˜¾ç¤º(Proteusä»¿çœŸ)ã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120162356">8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œæ•°ç ç®¡æ˜¾ç¤º(Proteusä»¿çœŸ)</a></p><p>ã€Š8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£ã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120243836">8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£</a></p><p><img src="https://img-blog.csdnimg.cn/6518f4bfe2f14f2ba68e11f174a48110.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ¬ç¯‡å¸¦æ¥çš„æ§åˆ¶æ¨¡å¼ä¸å‰é¢ä¸åŒçš„æ˜¯ï¼Œé‡‡ç”¨è‡ªé”æŒ‰é”®æ¥æ§åˆ¶æ˜¾ç¤ºå†…å®¹çš„ã€‚</p><h4 id="å®ä¾‹ä»£ç "><a href="#å®ä¾‹ä»£ç " class="headerlink" title="å®ä¾‹ä»£ç "></a>å®ä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">/********************ç‚¹åŠ¨è‡ªé”ç‰ˆ*************/</span><br><span class="line">include &quot;reg51.h&quot;</span><br><span class="line">#include &quot;intrins.h&quot;</span><br><span class="line">#define u8 unsigned char</span><br><span class="line">sbit P36 = P3 ^ 6;</span><br><span class="line">sbit P37 = P3 ^ 7;</span><br><span class="line">sbit STCP = P3 ^ 0;//å®šä¹‰74HC595ç§»ä½å¯„å­˜å™¨</span><br><span class="line">sbit SHCP = P3 ^ 2;</span><br><span class="line">sbit DS = P3 ^ 1;</span><br><span class="line"></span><br><span class="line">u8 code table[16] = &#123;                //å…±é˜´æ•°ç ç®¡æ®µç 16è¿›åˆ¶</span><br><span class="line">    0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void delay() &#123;</span><br><span class="line">    u8 a,b;</span><br><span class="line">    for(b=19; b&gt;0; b--)</span><br><span class="line">        for(a=130; a&gt;0; a--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void txd595(u8 d) &#123;</span><br><span class="line">    u8 i;</span><br><span class="line">    for (i = 0; i &lt; 8; i++) &#123;</span><br><span class="line">        DS = d &amp; 0x80;</span><br><span class="line">        SHCP = 0;</span><br><span class="line">        d &lt;&lt;= 1;</span><br><span class="line">        SHCP = 1;</span><br><span class="line">    &#125;</span><br><span class="line">    STCP=0;</span><br><span class="line">    _nop_();</span><br><span class="line">    STCP=1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void display(u8 d) &#123;</span><br><span class="line">    P37 = 0;</span><br><span class="line">    txd595(table[d%10]);</span><br><span class="line">    delay();</span><br><span class="line">    P37 = 1;</span><br><span class="line">    _nop_();</span><br><span class="line">    P36 = 0;</span><br><span class="line">    txd595(table[d/10]);</span><br><span class="line">    delay();</span><br><span class="line">    P36 = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 b0(u8 dat) &#123;                //å–ä¸€ä¸ªå­—èŠ‚ä¸­æœ‰å¤šå°‘ä¸ªäºŒè¿›åˆ¶0 è¿”å›0~8</span><br><span class="line">    u8 i, j = 0;</span><br><span class="line">    for (i = 0; i &lt; 8; i++) &#123;</span><br><span class="line">        if (!(dat &amp; (1 &lt;&lt; i))) &#123;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 key_scan() &#123;                //æ— æŒ‰é”®è¿”å›0 æœ‰æŒ‰é”®è¿”å›1~64 (ç¦æ­¢å¤šä¸ªæŒ‰é”®åŒæ—¶æŒ‰ä¸‹,å‡ºé”™è¿”å›99)</span><br><span class="line">    u8 i, j, k, l, m;</span><br><span class="line">    P0 = 0xFF;</span><br><span class="line">    _nop_();</span><br><span class="line">    k = P0;</span><br><span class="line">    if (k != 0xFF) &#123;</span><br><span class="line">        if (b0(k) != 1) return 99;</span><br><span class="line">        for (i = 0; i &lt; 8; i++) &#123;//å…ˆæ‰«æåˆ¤æ–­P0å£è‡ªèº«æœ‰æ²¡æœ‰è¢«è§¦å‘æ‹‰ä½ã€‚</span><br><span class="line">            if (!(k &amp; (1 &lt;&lt; i))) &#123;//å¦‚æœæœ‰è§¦å‘</span><br><span class="line">                return 57 + i;//è¿”å›57+i</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (i = 0; i &lt; 8; i++) &#123;</span><br><span class="line">        j = ~(1 &lt;&lt; i);</span><br><span class="line">        P0 = j;</span><br><span class="line">        _nop_();</span><br><span class="line">        k= P0;</span><br><span class="line">        if (k != j) &#123;</span><br><span class="line">            if (k &amp; ~j || b0(k) != 2) return 99;</span><br><span class="line">            m = 0;</span><br><span class="line">            for (l = 0; l &lt; 8; l++) &#123;</span><br><span class="line">                if (i == l) continue;</span><br><span class="line">                m++;</span><br><span class="line">                if (!(k &amp; (1 &lt;&lt; l))) &#123;</span><br><span class="line">                    return i * 7 + m;//è¿”å›æ‰«æè¡Œiä¹˜ä»¥æ¯è¡Œçš„æ•°é‡7ï¼Œmä»£è¡¨æ˜¯iè¡Œçš„ç¬¬mä¸ªæ•°</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        display(key_scan());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;*******<em><strong><strong><strong><strong><strong><strong>ç‚¹åŠ¨è‡ªé”ç‰ˆ</strong></strong></strong></strong></strong></strong></em>&#x2F;<br>include â€œreg51.hâ€<br>#include â€œintrins.hâ€<br>#define u8 unsigned char<br>sbit P36 &#x3D; P3 ^ 6;<br>sbit P37 &#x3D; P3 ^ 7;<br>sbit STCP &#x3D; P3 ^ 0;&#x2F;&#x2F;å®šä¹‰74HC595ç§»ä½å¯„å­˜å™¨<br>sbit SHCP &#x3D; P3 ^ 2;<br>sbit DS &#x3D; P3 ^ 1;</p><p>u8 code table[16] &#x3D; {                &#x2F;&#x2F;å…±é˜´æ•°ç ç®¡æ®µç 16è¿›åˆ¶<br>    0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71<br>};</p><p>void delay() {<br>    u8 a,b;<br>    for(b&#x3D;19; b&gt;0; bâ€“)<br>        for(a&#x3D;130; a&gt;0; aâ€“);<br>}</p><p>void txd595(u8 d) {<br>    u8 i;<br>    for (i &#x3D; 0; i &lt; 8; i++) {<br>        DS &#x3D; d &amp; 0x80;<br>        SHCP &#x3D; 0;<br>        d &lt;&lt;&#x3D; 1;<br>        SHCP &#x3D; 1;<br>    }<br>    STCP&#x3D;0;<br>    <em>nop</em>();<br>    STCP&#x3D;1;<br>}</p><p>void display(u8 d) {<br>    P37 &#x3D; 0;<br>    txd595(table[d%10]);<br>    delay();<br>    P37 &#x3D; 1;<br>    <em>nop</em>();<br>    P36 &#x3D; 0;<br>    txd595(table[d&#x2F;10]);<br>    delay();<br>    P36 &#x3D; 1;<br>}</p><p>u8 b0(u8 dat) {                &#x2F;&#x2F;å–ä¸€ä¸ªå­—èŠ‚ä¸­æœ‰å¤šå°‘ä¸ªäºŒè¿›åˆ¶0 è¿”å›0~8<br>    u8 i, j &#x3D; 0;<br>    for (i &#x3D; 0; i &lt; 8; i++) {<br>        if (!(dat &amp; (1 &lt;&lt; i))) {<br>            j++;<br>        }<br>    }<br>    return j;<br>}</p><p>u8 key_scan() {                &#x2F;&#x2F;æ— æŒ‰é”®è¿”å›0 æœ‰æŒ‰é”®è¿”å›1~64 (ç¦æ­¢å¤šä¸ªæŒ‰é”®åŒæ—¶æŒ‰ä¸‹,å‡ºé”™è¿”å›99)<br>    u8 i, j, k, l, m;<br>    P0 &#x3D; 0xFF;<br>    <em>nop</em>();<br>    k &#x3D; P0;<br>    if (k !&#x3D; 0xFF) {<br>        if (b0(k) !&#x3D; 1) return 99;<br>        for (i &#x3D; 0; i &lt; 8; i++) {&#x2F;&#x2F;å…ˆæ‰«æåˆ¤æ–­P0å£è‡ªèº«æœ‰æ²¡æœ‰è¢«è§¦å‘æ‹‰ä½ã€‚<br>            if (!(k &amp; (1 &lt;&lt; i))) {&#x2F;&#x2F;å¦‚æœæœ‰è§¦å‘<br>                return 57 + i;&#x2F;&#x2F;è¿”å›57+i<br>            }<br>        }<br>    }</p><pre><code>for (i = 0; i &lt; 8; i++) &#123;    j = ~(1 &lt;&lt; i);    P0 = j;    _nop_();    k= P0;    if (k != j) &#123;        if (k &amp; ~j || b0(k) != 2) return 99;        m = 0;        for (l = 0; l &lt; 8; l++) &#123;            if (i == l) continue;            m++;            if (!(k &amp; (1 &lt;&lt; l))) &#123;                return i * 7 + m;//è¿”å›æ‰«æè¡Œiä¹˜ä»¥æ¯è¡Œçš„æ•°é‡7ï¼Œmä»£è¡¨æ˜¯iè¡Œçš„ç¬¬mä¸ªæ•°            &#125;        &#125;    &#125;&#125;return 0;</code></pre><p>}</p><p>void main() {<br>    while (1) {<br>        display(key_scan());<br>    }<br>}&#96;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>uln2003å’Œ2803ä¸¤ä¸ªæœ‰åˆ·ç›´æµç”µæœºæ§åˆ¶æ–¹æ¡ˆ</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-uln2003%E5%92%8C2803%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%88%B7%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%8E%A7%E5%88%B6%E6%96%B9%E6%A1%88/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-uln2003%E5%92%8C2803%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%88%B7%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%8E%A7%E5%88%B6%E6%96%B9%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="uln2003å’Œ2803ä¸¤ä¸ªæœ‰åˆ·ç›´æµç”µæœºæ§åˆ¶æ–¹æ¡ˆ"><a href="#uln2003å’Œ2803ä¸¤ä¸ªæœ‰åˆ·ç›´æµç”µæœºæ§åˆ¶æ–¹æ¡ˆ" class="headerlink" title="uln2003å’Œ2803ä¸¤ä¸ªæœ‰åˆ·ç›´æµç”µæœºæ§åˆ¶æ–¹æ¡ˆ"></a>uln2003å’Œ2803ä¸¤ä¸ªæœ‰åˆ·ç›´æµç”µæœºæ§åˆ¶æ–¹æ¡ˆ</h1><h4 id="uln2003æ§åˆ¶ä¸¤ä¸ªæœ‰åˆ·ç›´æµç”µæœºè½¬åŠ¨"><a href="#uln2003æ§åˆ¶ä¸¤ä¸ªæœ‰åˆ·ç›´æµç”µæœºè½¬åŠ¨" class="headerlink" title="uln2003æ§åˆ¶ä¸¤ä¸ªæœ‰åˆ·ç›´æµç”µæœºè½¬åŠ¨"></a>uln2003æ§åˆ¶ä¸¤ä¸ªæœ‰åˆ·ç›´æµç”µæœºè½¬åŠ¨</h4><p>*proteusä»¿çœŸå›¾</p><p><img src="https://img-blog.csdnimg.cn/20210620143940847.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>ä»¿çœŸæ–‡ä»¶ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1RDDLL5ezn7vzuTkWbxkDeA </span><br><span class="line">æå–ç ï¼šhxiw</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1RDDLL5ezn7vzuTkWbxkDeA  æå–ç ï¼šhxiw</code></p><ul><li>æ–°æ–¹æ¡ˆ</li></ul><p>2803+L9110</p><p><img src="https://img-blog.csdnimg.cn/2021062116523841.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å•ç²—æš´çš„æµæ°´ç¯ä»¿çœŸå’Œä»£ç </title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E7%AE%80%E5%8D%95%E7%B2%97%E6%9A%B4%E7%9A%84%E6%B5%81%E6%B0%B4%E7%81%AF%E4%BB%BF%E7%9C%9F%E5%92%8C%E4%BB%A3%E7%A0%81/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E7%AE%80%E5%8D%95%E7%B2%97%E6%9A%B4%E7%9A%84%E6%B5%81%E6%B0%B4%E7%81%AF%E4%BB%BF%E7%9C%9F%E5%92%8C%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ç®€å•ç²—æš´çš„æµæ°´ç¯ä»¿çœŸå’Œä»£ç "><a href="#ç®€å•ç²—æš´çš„æµæ°´ç¯ä»¿çœŸå’Œä»£ç " class="headerlink" title="ç®€å•ç²—æš´çš„æµæ°´ç¯ä»¿çœŸå’Œä»£ç "></a>ç®€å•ç²—æš´çš„æµæ°´ç¯ä»¿çœŸå’Œä»£ç </h1><h5 id="ç®€å•ç²—æš´çš„æµæ°´ç¯ä»¿çœŸå’Œä»£ç -1"><a href="#ç®€å•ç²—æš´çš„æµæ°´ç¯ä»¿çœŸå’Œä»£ç -1" class="headerlink" title="ç®€å•ç²—æš´çš„æµæ°´ç¯ä»¿çœŸå’Œä»£ç "></a>ç®€å•ç²—æš´çš„æµæ°´ç¯ä»¿çœŸå’Œä»£ç </h5><ul><li>ä»¿çœŸæ¼”ç¤º</li><li>ç¨‹åºä»£ç </li></ul><p>ä»¿çœŸæ¼”ç¤º</p><p><img src="https://img-blog.csdnimg.cn/20210625093124308.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç¨‹åºä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;// //crolå’Œcrorå‡½æ•°è°ƒç”¨å¤´æ–‡ä»¶ </span><br><span class="line">typedef unsigned int uint;</span><br><span class="line">typedef unsigned char uchar;</span><br><span class="line">#define led P2</span><br><span class="line">uchar temp;</span><br><span class="line">uchar i;</span><br><span class="line">void delay(uint z)</span><br><span class="line">&#123;</span><br><span class="line">uint x,y;</span><br><span class="line">for(x = z;x&gt;0;x--)</span><br><span class="line">for(y=114;y&gt;0;y--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"> temp = 0x01;</span><br><span class="line">led = temp;</span><br><span class="line"> delay(1000);</span><br><span class="line"></span><br><span class="line">  for(i=0;i&lt;8;i++)&#123;</span><br><span class="line">    //   temp = _crol_(temp,1);        //å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚</span><br><span class="line"></span><br><span class="line">temp =temp&lt;&lt;1 ;</span><br><span class="line">led = temp;</span><br><span class="line">       delay(1000);</span><br><span class="line">&#125;</span><br><span class="line">temp = 0x80;</span><br><span class="line">  for(i=0;i&lt;8;i++)&#123;</span><br><span class="line">    //   temp = _crol_(temp,1);        //å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚</span><br><span class="line">temp =temp&gt;&gt;1 ;</span><br><span class="line">led = temp;</span><br><span class="line">       delay(1000);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;&#x2F;&#x2F; &#x2F;&#x2F;crolå’Œcrorå‡½æ•°è°ƒç”¨å¤´æ–‡ä»¶<br>typedef unsigned int uint;<br>typedef unsigned char uchar;<br>#define led P2<br>uchar temp;<br>uchar i;<br>void delay(uint z)<br>{<br>    uint x,y;<br>    for(x &#x3D; z;x&gt;0;xâ€“)<br>        for(y&#x3D;114;y&gt;0;yâ€“);<br>}</p><p>void main(void)<br>{<br>     temp &#x3D; 0x01;<br>    led &#x3D; temp;<br>     delay(1000);</p><p>  for(i&#x3D;0;i&lt;8;i++){<br>    &#x2F;&#x2F;   temp &#x3D; <em>crol</em>(temp,1);        &#x2F;&#x2F;å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚</p><pre><code>    temp =temp&lt;&lt;1 ;            led = temp;   delay(1000);&#125;temp = 0x80;</code></pre><p>  for(i&#x3D;0;i&lt;8;i++){<br>    &#x2F;&#x2F;   temp &#x3D; _crol_(temp,1);        &#x2F;&#x2F;å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚<br>        temp &#x3D;temp&gt;&gt;1 ;<br>                led &#x3D; temp;<br>       delay(1000);<br>    }<br>}&#96;</p><ul><li>é€šè¿‡_crol_å’Œ_cror_å‡½æ•°å·¦ç§»å’Œå³ç§»ç¨‹åºä»£ç </li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;// //crolå’Œcrorå‡½æ•°è°ƒç”¨å¤´æ–‡ä»¶ </span><br><span class="line">typedef unsigned int uint;</span><br><span class="line">typedef unsigned char uchar;</span><br><span class="line">#define led P2</span><br><span class="line">uchar temp;</span><br><span class="line">uchar i;</span><br><span class="line">void delay(uint z)</span><br><span class="line">&#123;</span><br><span class="line">uint x,y;</span><br><span class="line">for(x = z;x&gt;0;x--)</span><br><span class="line">for(y=114;y&gt;0;y--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"> temp = 0x01;</span><br><span class="line">led = temp;</span><br><span class="line"> delay(1000);</span><br><span class="line"></span><br><span class="line"> for(i=0;i&lt;8;i++)&#123;</span><br><span class="line">   temp = _crol_(temp,1);        //å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚</span><br><span class="line"></span><br><span class="line">//temp =temp&lt;&lt;1 ;</span><br><span class="line">led = temp;</span><br><span class="line">       delay(1000);</span><br><span class="line">&#125;</span><br><span class="line">//temp = 0x80;</span><br><span class="line">  for(i=0;i&lt;8;i++)&#123;</span><br><span class="line">       temp = _cror_(temp,1);        //å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚</span><br><span class="line">//temp =temp&gt;&gt;1 ;</span><br><span class="line">led = temp;</span><br><span class="line">       delay(1000);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;&#x2F;&#x2F; &#x2F;&#x2F;crolå’Œcrorå‡½æ•°è°ƒç”¨å¤´æ–‡ä»¶<br>typedef unsigned int uint;<br>typedef unsigned char uchar;<br>#define led P2<br>uchar temp;<br>uchar i;<br>void delay(uint z)<br>{<br>    uint x,y;<br>    for(x &#x3D; z;x&gt;0;xâ€“)<br>        for(y&#x3D;114;y&gt;0;yâ€“);<br>}</p><p>void main(void)<br>{<br>     temp &#x3D; 0x01;<br>    led &#x3D; temp;<br>     delay(1000);</p><p> for(i&#x3D;0;i&lt;8;i++){<br>   temp &#x3D; <em>crol</em>(temp,1);        &#x2F;&#x2F;å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚</p><p>&#x2F;&#x2F;temp &#x3D;temp&lt;&lt;1 ;<br>                led &#x3D; temp;<br>       delay(1000);<br>    }<br>    &#x2F;&#x2F;temp &#x3D; 0x80;<br>  for(i&#x3D;0;i&lt;8;i++){<br>       temp &#x3D; _cror_(temp,1);        &#x2F;&#x2F;å…¨äº®ï¼Œé€ä¸€ç­ï¼Œäº®ã€‚<br>&#x2F;&#x2F;temp &#x3D;temp&gt;&gt;1 ;<br>                led &#x3D; temp;<br>       delay(1000);<br>}<br>}&#96;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E7%BB%8F%E5%85%B8%E6%8C%89%E9%94%AE%E6%89%AB%E6%8F%8F%E6%B6%88%E6%8A%96%E7%AE%97%E6%B3%95%E5%AE%9E%E4%BE%8B%E4%BB%BF%E7%9C%9F%E5%AF%B9%E6%AF%94/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E7%BB%8F%E5%85%B8%E6%8C%89%E9%94%AE%E6%89%AB%E6%8F%8F%E6%B6%88%E6%8A%96%E7%AE%97%E6%B3%95%E5%AE%9E%E4%BE%8B%E4%BB%BF%E7%9C%9F%E5%AF%B9%E6%AF%94/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”"><a href="#ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”" class="headerlink" title="ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”"></a>ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”</h1><h3 id="ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”-1"><a href="#ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”-1" class="headerlink" title="ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”"></a>ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”</h3><p>ã€Šç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼ã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/118991832">ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼</a></p><ul><li>Proteusä»¿çœŸæ•ˆæœå¯¹æ¯”</li></ul><p>è¿™ç§ç®—æ³•æ‘’å¼ƒäº†åŠ å»¶æ—¶çš„å¸¸è§„åšæ³•ï¼Œ</p><h4 id="ç®—æ³•å®ç°ä»£ç "><a href="#ç®—æ³•å®ç°ä»£ç " class="headerlink" title="ç®—æ³•å®ç°ä»£ç "></a>ç®—æ³•å®ç°ä»£ç </h4><p><img src="https://img-blog.csdnimg.cn/8db302959f714e4985bd642b38ffe775.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;REGX52.H&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">sbit KeyValue=P3^7;</span><br><span class="line">unsigned char code segment[]= &#123;0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90&#125;;</span><br><span class="line">//å®šä¹‰å…±é˜³æ•°ç ç®¡æ˜¾ç¤º0~9</span><br><span class="line">unsigned char Trg;</span><br><span class="line">unsigned char Cont;</span><br><span class="line">static char count=1;</span><br><span class="line">void KeyRead( void )</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char ReadData = KeyValue^0x01;   // </span><br><span class="line">    Trg = ReadData &amp; (ReadData ^ Cont);   // æŒ‰é”®è§¦å‘ä¸º1</span><br><span class="line">    Cont = ReadData;                     // é•¿æŒ‰è§¦å‘ä¸º1</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">P3=0XFF;</span><br><span class="line">    P0=segment[0]; //å¼€å§‹è¿è¡Œæ˜¾ç¤º0</span><br><span class="line">    while(1) &#123;</span><br><span class="line">KeyRead();</span><br><span class="line">        if(Trg==1) &#123;</span><br><span class="line">            P0=segment[count];</span><br><span class="line">            count++;</span><br><span class="line">            if(count&gt;=10) &#123;  //è¶…è¿‡0~9ï¼Œæ•°ç ç®¡æ˜¾ç¤ºå›åˆ°0</span><br><span class="line">                count=0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;REGX52.H&gt;<br>#include &lt;intrins.h&gt;<br>sbit KeyValue&#x3D;P3^7;<br>unsigned char code segment[]&#x3D; {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};<br>&#x2F;&#x2F;å®šä¹‰å…±é˜³æ•°ç ç®¡æ˜¾ç¤º0~9<br>unsigned char Trg;<br>unsigned char Cont;<br>static char count&#x3D;1;<br>void KeyRead( void )<br>{<br>    unsigned char ReadData &#x3D; KeyValue^0x01;   &#x2F;&#x2F;<br>    Trg &#x3D; ReadData &amp; (ReadData ^ Cont);   &#x2F;&#x2F; æŒ‰é”®è§¦å‘ä¸º1<br>    Cont &#x3D; ReadData;                     &#x2F;&#x2F; é•¿æŒ‰è§¦å‘ä¸º1</p><p>}</p><p>void main() {<br>        P3&#x3D;0XFF;<br>    P0&#x3D;segment[0]; &#x2F;&#x2F;å¼€å§‹è¿è¡Œæ˜¾ç¤º0<br>    while(1) {<br>            KeyRead();<br>        if(Trg&#x3D;&#x3D;1) {<br>            P0&#x3D;segment[count];<br>            count++;<br>            if(count&gt;&#x3D;10) {  &#x2F;&#x2F;è¶…è¿‡0~9ï¼Œæ•°ç ç®¡æ˜¾ç¤ºå›åˆ°0<br>                count&#x3D;0;<br>            }<br>        }<br>    }<br>}&#96;</p><h4 id="æ²¡æœ‰æ¶ˆæŠ–å¤„ç†ä»£ç "><a href="#æ²¡æœ‰æ¶ˆæŠ–å¤„ç†ä»£ç " class="headerlink" title="æ²¡æœ‰æ¶ˆæŠ–å¤„ç†ä»£ç "></a>æ²¡æœ‰æ¶ˆæŠ–å¤„ç†ä»£ç </h4><p><img src="https://img-blog.csdnimg.cn/d695806b02064360ac5a9b5f4fd12cea.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;REGX52.H&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">sbit KeyValue=P3^7;</span><br><span class="line">unsigned char code segment[]= &#123;0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90&#125;;</span><br><span class="line">//å®šä¹‰æ•°ç ç®¡æ˜¾ç¤º0~9</span><br><span class="line"></span><br><span class="line">unsigned char Trg;</span><br><span class="line">unsigned char Cont;</span><br><span class="line">    static char count=1;</span><br><span class="line">void main() &#123;</span><br><span class="line">P3=0XFF;</span><br><span class="line">    P0=segment[0]; //å¼€å§‹è¿è¡Œæ˜¾ç¤º0</span><br><span class="line">    while(1) &#123;</span><br><span class="line"></span><br><span class="line">        if(KeyValue==0) &#123;</span><br><span class="line">            P0=segment[count];</span><br><span class="line">            count++;</span><br><span class="line">            if(count&gt;=10) &#123;  //è¶…è¿‡0~9ï¼Œæ•°ç ç®¡æ˜¾ç¤ºå›åˆ°0</span><br><span class="line">                count=0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;REGX52.H&gt;<br>#include &lt;intrins.h&gt;<br>sbit KeyValue&#x3D;P3^7;<br>unsigned char code segment[]&#x3D; {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};<br>&#x2F;&#x2F;å®šä¹‰æ•°ç ç®¡æ˜¾ç¤º0~9</p><p>unsigned char Trg;<br>unsigned char Cont;<br>    static char count&#x3D;1;<br>void main() {<br>        P3&#x3D;0XFF;<br>    P0&#x3D;segment[0]; &#x2F;&#x2F;å¼€å§‹è¿è¡Œæ˜¾ç¤º0<br>    while(1) {</p><pre><code>    if(KeyValue==0) &#123;        P0=segment[count];        count++;        if(count&gt;=10) &#123;  //è¶…è¿‡0~9ï¼Œæ•°ç ç®¡æ˜¾ç¤ºå›åˆ°0            count=0;        &#125;    &#125;&#125;</code></pre><p>}&#96;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E7%BB%8F%E5%85%B8%E6%8C%89%E9%94%AE%E6%89%AB%E6%8F%8F%E7%A8%8B%E5%BA%8F%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E7%BB%8F%E5%85%B8%E6%8C%89%E9%94%AE%E6%89%AB%E6%8F%8F%E7%A8%8B%E5%BA%8F%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼"><a href="#ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼" class="headerlink" title="ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼"></a>ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼</h1><h3 id="ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼-1"><a href="#ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼-1" class="headerlink" title="ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼"></a>ç»å…¸æŒ‰é”®æ‰«æç¨‹åºç®—æ³•å®ç°æ–¹å¼</h3><ul><li>ç®—æ³•å®ç°å‡½æ•°ï¼ˆæ¥æºäºç½‘ç»œï¼‰</li></ul><p>ç›¸å…³ç¯‡ç›®ã€Šç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”ã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120219798">ç»å…¸æŒ‰é”®æ‰«ææ¶ˆæŠ–ç®—æ³•å®ä¾‹ä»¿çœŸå¯¹æ¯”</a></p><h4 id="ç®—æ³•è§£æ"><a href="#ç®—æ³•è§£æ" class="headerlink" title="ç®—æ³•è§£æ"></a>ç®—æ³•è§£æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">unsigned char Trg;</span><br><span class="line">unsigned char Cont;</span><br><span class="line"></span><br><span class="line">void KeyRead( void )</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char ReadData = P1^0xff;   // æ³¨è§£1</span><br><span class="line"></span><br><span class="line">    Trg = ReadData &amp; (ReadData ^ Cont);   // æ³¨è§£2</span><br><span class="line"></span><br><span class="line">    Cont = ReadData;                      // æ³¨è§£3</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;unsigned char Trg;<br>unsigned char Cont;</p><p>void KeyRead( void )<br>{<br>    unsigned char ReadData &#x3D; P1^0xff;   &#x2F;&#x2F; æ³¨è§£1</p><pre><code>Trg = ReadData &amp; (ReadData ^ Cont);   // æ³¨è§£2Cont = ReadData;                      // æ³¨è§£3</code></pre><p>}&#96;</p><p>Trgï¼ˆtrigerï¼‰ ä»£è¡¨çš„æ˜¯è§¦å‘ï¼ŒContï¼ˆcontinueï¼‰ä»£è¡¨çš„æ˜¯è¿ç»­æŒ‰ä¸‹ã€‚</p><p>æ³¨è§£1ï¼šè¯»P1çš„ç«¯å£æ•°æ®ï¼Œå–åï¼Œç„¶åé€åˆ°ReadData ä¸´æ—¶å˜é‡é‡Œé¢ä¿å­˜èµ·æ¥ã€‚</p><p>æ³¨è§£2ï¼šç”¨æ¥è®¡ç®—è§¦å‘å˜é‡çš„ã€‚ä¸€ä¸ªä½ä¸æ“ä½œï¼Œä¸€ä¸ªå¼‚æˆ–æ“ä½œï¼Œæˆ‘æƒ³å­¦è¿‡Cè¯­è¨€éƒ½åº”è¯¥æ‡‚å§ï¼ŸTrgä¸ºå…¨å±€å˜é‡ï¼Œå…¶å®ƒç¨‹åºå¯ä»¥ç›´æ¥å¼•ç”¨ã€‚</p><p>æ³¨è§£3ï¼šç”¨æ¥è®¡ç®—è¿ç»­å˜é‡ã€‚</p><ul><li>ä¸Šè¿°å®ç°ç®—æ³•ä¸ä»…é€‚ç”¨äºç«¯å£ä»¥æ€»çº¿æ–¹å¼æ¥è¯»å–åˆ¤æ–­ï¼Œä¹ŸåŒæ ·é€‚ç”¨äºç‹¬ç«‹IOå£ä¿¡å·çš„åˆ¤æ–­å’Œå¤„ç†ï¼Œå…·ä½“å®ç°å‡½æ•°å¦‚ä¸‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">unsigned char Trg;</span><br><span class="line">unsigned char Cont;</span><br><span class="line"></span><br><span class="line">void KeyRead( void )</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char ReadData = P10^0x01;   // æ³¨è§£1</span><br><span class="line">    Trg = ReadData &amp; (ReadData ^ Cont);   // æ³¨è§£2</span><br><span class="line">    Cont = ReadData;                     // æ³¨è§£3</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>&#96;unsigned char Trg;<br>unsigned char Cont;</p><p>void KeyRead( void )<br>{<br>    unsigned char ReadData &#x3D; P10^0x01;   &#x2F;&#x2F; æ³¨è§£1<br>    Trg &#x3D; ReadData &amp; (ReadData ^ Cont);   &#x2F;&#x2F; æ³¨è§£2<br>    Cont &#x3D; ReadData;                     &#x2F;&#x2F; æ³¨è§£3<br>    }&#96;</p><h6 id="1-æ²¡æœ‰æŒ‰é”®çš„æ—¶å€™"><a href="#1-æ²¡æœ‰æŒ‰é”®çš„æ—¶å€™" class="headerlink" title="1. æ²¡æœ‰æŒ‰é”®çš„æ—¶å€™"></a>1. æ²¡æœ‰æŒ‰é”®çš„æ—¶å€™</h6><ul><li>æ²¡æœ‰æŒ‰ä¸‹æ—¶ï¼ŒIOå£ä¸ºé«˜ç”µå¹³ï¼Œå°±æ˜¯P10ä¸º0x01ï¼ŒReadDataè¯»ç«¯å£å¹¶ä¸”å’Œ0x01è¿›è¡Œå–åï¼Œå¾ˆæ˜¾ç„¶ï¼ŒP10^0x01çš„å€¼å°±æ˜¯ 0x00</li><li>Trg &#x3D; ReadData &amp; (ReadData ^ Cont); ï¼ˆåˆå§‹çŠ¶æ€ä¸‹ï¼ŒContä¹Ÿæ˜¯ä¸º0çš„ï¼‰å¾ˆç®€å•çš„æ•°å­¦è®¡ç®—ï¼Œå› ä¸ºReadDataä¸º0ï¼Œåˆ™å®ƒå’Œä»»ä½•æ•°â€œç›¸ä¸â€ï¼Œç»“æœä¹Ÿæ˜¯ä¸º0</li><li>Cont &#x3D; ReadData; ä¿å­˜Cont å…¶å®å°±æ˜¯ç­‰äºReadDataä¸º0ï¼›</li></ul><p>æ²¡æœ‰æŒ‰ä¸‹æ—¶ï¼ŒIOå£ä¸ºé«˜ç”µå¹³ï¼Œå°±æ˜¯P10ä¸º0x01ï¼ŒReadDataè¯»ç«¯å£å¹¶ä¸”å’Œ0x01è¿›è¡Œå–åï¼Œå¾ˆæ˜¾ç„¶ï¼ŒP10^0x01çš„å€¼å°±æ˜¯ 0x00</p><p><code>IO</code></p><p><code>0x01</code></p><p><code>P10^0x01</code></p><p><code>0x00</code></p><p>Trg &#x3D; ReadData &amp; (ReadData ^ Cont); ï¼ˆåˆå§‹çŠ¶æ€ä¸‹ï¼ŒContä¹Ÿæ˜¯ä¸º0çš„ï¼‰å¾ˆç®€å•çš„æ•°å­¦è®¡ç®—ï¼Œå› ä¸ºReadDataä¸º0ï¼Œåˆ™å®ƒå’Œä»»ä½•æ•°â€œç›¸ä¸â€ï¼Œç»“æœä¹Ÿæ˜¯ä¸º0</p><p>Cont &#x3D; ReadData; ä¿å­˜Cont å…¶å®å°±æ˜¯ç­‰äºReadDataä¸º0ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ReadData ï¼ 0;</span><br><span class="line">Trg ï¼ 0;</span><br><span class="line">Cont ï¼ 0;</span><br></pre></td></tr></table></figure><p><code>ReadData ï¼ 0;     Trg ï¼ 0;     Cont ï¼ 0;</code></p><h6 id="2-ç¬¬ä¸€æ¬¡IOå£æŒ‰é”®æŒ‰ä¸‹çš„æƒ…å†µ"><a href="#2-ç¬¬ä¸€æ¬¡IOå£æŒ‰é”®æŒ‰ä¸‹çš„æƒ…å†µ" class="headerlink" title="2. ç¬¬ä¸€æ¬¡IOå£æŒ‰é”®æŒ‰ä¸‹çš„æƒ…å†µ"></a>2. ç¬¬ä¸€æ¬¡IOå£æŒ‰é”®æŒ‰ä¸‹çš„æƒ…å†µ</h6><p>ç«¯å£æ•°æ®ä¸º0xfeï¼ŒReadDataè¯»ç«¯å£å¹¶ä¸”å–åï¼Œå¾ˆæ˜¾ç„¶ï¼Œå°±æ˜¯ 0x01 ã€‚</p><ul><li>Trg &#x3D; ReadData &amp; (ReadData ^ Cont); å› ä¸ºè¿™æ˜¯ç¬¬ä¸€æ¬¡æŒ‰ä¸‹ï¼Œæ‰€ä»¥Contæ˜¯ä¸Šæ¬¡çš„å€¼ï¼Œæ‰€ä»¥ä¸º0ã€‚é‚£ä¹ˆè¿™ä¸ªå¼å­çš„å€¼ä¹Ÿä¸éš¾ç®—ï¼Œä¹Ÿå°±æ˜¯ Trg &#x3D; 0x01 &amp; (0x01^0x00) &#x3D; 0x01</li><li>Cont &#x3D; ReadData &#x3D; 0x01ï¼›</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ReadData ï¼ 0x01;</span><br><span class="line">Trg ï¼ 0x01;//Trgåªä¼šåœ¨è¿™ä¸ªæ—¶å€™å¯¹åº”ä½çš„å€¼ä¸º1ï¼Œå…¶å®ƒæ—¶å€™éƒ½ä¸º0</span><br><span class="line">Cont ï¼ 0x01;</span><br></pre></td></tr></table></figure><p><code>ReadData ï¼ 0x01; Trg ï¼ 0x01;//Trgåªä¼šåœ¨è¿™ä¸ªæ—¶å€™å¯¹åº”ä½çš„å€¼ä¸º1ï¼Œå…¶å®ƒæ—¶å€™éƒ½ä¸º0 Cont ï¼ 0x01;</code></p><h6 id="3-IOå£æŒ‰é”®æŒ‰ç€ä¸æ¾ï¼ˆé•¿æŒ‰é”®ï¼‰çš„æƒ…å†µ"><a href="#3-IOå£æŒ‰é”®æŒ‰ç€ä¸æ¾ï¼ˆé•¿æŒ‰é”®ï¼‰çš„æƒ…å†µ" class="headerlink" title="3. IOå£æŒ‰é”®æŒ‰ç€ä¸æ¾ï¼ˆé•¿æŒ‰é”®ï¼‰çš„æƒ…å†µ"></a>3. IOå£æŒ‰é”®æŒ‰ç€ä¸æ¾ï¼ˆé•¿æŒ‰é”®ï¼‰çš„æƒ…å†µ</h6><p>ç«¯å£æ•°æ®ä¸º0xfeï¼ŒReadDataè¯»ç«¯å£å¹¶ä¸”å–åæ˜¯ 0x01 ã€‚</p><ul><li>Trg &#x3D; ReadData &amp; (ReadData ^ Cont); å› ä¸ºè¿™æ˜¯è¿ç»­æŒ‰ä¸‹ï¼Œæ‰€ä»¥Contæ˜¯ä¸Šæ¬¡çš„å€¼ï¼Œæ‰€ä»¥ä¸º0x01ã€‚é‚£ä¹ˆè¿™ä¸ªå¼å­å°±å˜æˆäº† Trg &#x3D; 0x01 &amp; (0x01^0x01) &#x3D; 0x00</li><li>Cont &#x3D; ReadData &#x3D; 0x01ï¼›</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ReadData ï¼ 0x01;</span><br><span class="line">Trg ï¼ 0x00;</span><br><span class="line">Cont ï¼ 0x01;</span><br></pre></td></tr></table></figure><p><code>ReadData ï¼ 0x01;     Trg ï¼ 0x00;     Cont ï¼ 0x01;</code></p><p>å› ä¸ºç°åœ¨æŒ‰é”®æ˜¯é•¿æŒ‰ç€ï¼Œæ‰€ä»¥MCUä¼šæ¯ä¸ªä¸€å®šæ—¶é—´ï¼ˆ20mså·¦å³ï¼‰ä¸æ–­çš„æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆä¸‹æ¬¡æ‰§è¡Œçš„æ—¶å€™æƒ…å†µä¼šæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><ul><li>ReadData ï¼ 0x01ï¼›è¿™ä¸ªä¸ä¼šå˜ï¼Œå› ä¸ºæŒ‰é”®æ²¡æœ‰æ¾å¼€</li><li>Trg ï¼ ReadData &amp; (ReadData ^ Cont) ï¼ 0x01 &amp; (0x01 ^ 0x01) &#x3D; 0 ï¼Œåªè¦æŒ‰é”®æ²¡æœ‰æ¾å¼€ï¼Œè¿™ä¸ªTrgå€¼æ°¸è¿œä¸º 0</li><li>Cont ï¼ 0x01ï¼›åªè¦æŒ‰é”®æ²¡æœ‰æ¾å¼€ï¼Œè¿™ä¸ªå€¼æ°¸è¿œæ˜¯0x01</li></ul><h6 id="4-æŒ‰é”®æ¾å¼€çš„æƒ…å†µ"><a href="#4-æŒ‰é”®æ¾å¼€çš„æƒ…å†µ" class="headerlink" title="4. æŒ‰é”®æ¾å¼€çš„æƒ…å†µ"></a>4. æŒ‰é”®æ¾å¼€çš„æƒ…å†µ</h6><p>ç«¯å£æ•°æ®ä¸º0xffï¼ŒReadDataè¯»ç«¯å£å¹¶ä¸”å–åæ˜¯ 0x00 ã€‚</p><ul><li>Trg &#x3D; ReadData &amp; (ReadData ^ Cont) &#x3D; 0x00 &amp; (0x00^0x01) &#x3D; 0x00;</li><li>Cont &#x3D; ReadData &#x3D; 0x00ï¼›</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ReadData ï¼ 0x00;</span><br><span class="line">Trg ï¼ 0x00;</span><br><span class="line">Cont ï¼ 0x00;</span><br></pre></td></tr></table></figure><p><code>ReadData ï¼ 0x00;     Trg ï¼ 0x00;     Cont ï¼ 0x00;</code></p><p>.&gt; å›åˆ°äº†åˆå§‹çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æŒ‰é”®æŒ‰ä¸‹çš„çŠ¶æ€</p><h6 id="åº”ç”¨ä¸€ï¼šä¸€æ¬¡è§¦å‘çš„æŒ‰é”®å¤„ç†"><a href="#åº”ç”¨ä¸€ï¼šä¸€æ¬¡è§¦å‘çš„æŒ‰é”®å¤„ç†" class="headerlink" title="åº”ç”¨ä¸€ï¼šä¸€æ¬¡è§¦å‘çš„æŒ‰é”®å¤„ç†"></a>åº”ç”¨ä¸€ï¼šä¸€æ¬¡è§¦å‘çš„æŒ‰é”®å¤„ç†</h6><ul><li>å‡è®¾PB0ä¸ºèœ‚é¸£å™¨æŒ‰é”®ï¼ŒæŒ‰ä¸€ä¸‹ï¼Œèœ‚é¸£å™¨beepçš„å“ä¸€å£°ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#define KEY_BEEP 0x01</span><br><span class="line">void KeyProc(void)</span><br><span class="line">&#123;</span><br><span class="line">       if (Trg &amp; KEY_BEEP) // å¦‚æœæŒ‰ä¸‹çš„æ˜¯KEY_BEEP</span><br><span class="line">    &#123;</span><br><span class="line">         Beep();            // æ‰§è¡Œèœ‚é¸£å™¨å¤„ç†å‡½æ•°</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>#define KEY_BEEP 0x01 void KeyProc(void) &#123;        if (Trg &amp; KEY_BEEP) // å¦‚æœæŒ‰ä¸‹çš„æ˜¯KEY_BEEP     &#123;          Beep();            // æ‰§è¡Œèœ‚é¸£å™¨å¤„ç†å‡½æ•°     &#125; &#125;</code></p><h6 id="åº”ç”¨2ï¼šé•¿æŒ‰é”®çš„å¤„ç†"><a href="#åº”ç”¨2ï¼šé•¿æŒ‰é”®çš„å¤„ç†" class="headerlink" title="åº”ç”¨2ï¼šé•¿æŒ‰é”®çš„å¤„ç†"></a>åº”ç”¨2ï¼šé•¿æŒ‰é”®çš„å¤„ç†</h6><ul><li>é¡¹ç›®ä¸­ç»å¸¸ä¼šé‡åˆ°ä¸€äº›è¦æ±‚ï¼Œä¾‹å¦‚ï¼šä¸€ä¸ªæŒ‰é”®å¦‚æœçŸ­æŒ‰ä¸€ä¸‹æ‰§è¡ŒåŠŸèƒ½Aï¼Œå¦‚æœé•¿æŒ‰2ç§’ä¸æ”¾çš„è¯ä¼šæ‰§è¡ŒåŠŸèƒ½Bï¼Œåˆæˆ–è€…æ˜¯è¦æ±‚3ç§’æŒ‰ç€ä¸æ”¾ï¼Œè®¡æ•°è¿åŠ ä»€ä¹ˆä»€ä¹ˆçš„åŠŸèƒ½.</li></ul><p>ä¸ºäº†åªæ˜¯è¯´æ˜åŸç†ï¼ŒPB1æ˜¯æ¨¡å¼æŒ‰é”®ï¼ŒçŸ­æŒ‰åˆ™åˆ‡æ¢æ¨¡å¼ï¼ŒPB1å°±æ˜¯åŠ ï¼Œå¦‚æœé•¿æŒ‰çš„è¯åˆ™è¿åŠ .</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#define KEY_MODE 0x01    // æ¨¡å¼æŒ‰é”®</span><br><span class="line">#define KEY_PLUS 0x02     // åŠ </span><br><span class="line">void KeyProc(void)</span><br><span class="line">&#123;</span><br><span class="line">       if (Trg &amp; KEY_MODE) // å¦‚æœæŒ‰ä¸‹çš„æ˜¯KEY_MODEï¼Œè€Œä¸”ä½ å¸¸æŒ‰è¿™æŒ‰é”®ä¹Ÿæ²¡æœ‰ç”¨ï¼Œ</span><br><span class="line">    &#123;                    //å®ƒæ˜¯ä¸ä¼šæ‰§è¡Œç¬¬äºŒæ¬¡çš„å“¦ ï¼Œ å¿…é¡»å…ˆæ¾å¼€å†æŒ‰ä¸‹</span><br><span class="line">         Mode++;         // æ‰§è¡Œ+1</span><br><span class="line">                         // (æ‰§è¡Œçš„å…¶ä»–ä»£ç )</span><br><span class="line">    &#125;</span><br><span class="line">    if (Cont ^ KEY_PLUS) // å¦‚æœæŒ‰é”®ä¿æŒè¢«æŒ‰ç€ä¸æ”¾</span><br><span class="line">    &#123;</span><br><span class="line">         cnt_plus++;       // è®¡æ—¶ï¼Œè¿™é‡Œæœ€å¥½æ”¾ç½®å®šæ—¶å™¨ï¼Œå¯åŠ¨ï¼Œå¼€å§‹è®¡æ•°</span><br><span class="line">         if (cnt_plus &gt; 100) // 20ms*100 = 2S å¦‚æœæ—¶é—´åˆ°</span><br><span class="line">         &#123;</span><br><span class="line">              Func();      // ä½ éœ€è¦çš„æ‰§è¡Œçš„ç¨‹åº</span><br><span class="line">         &#125;          </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>#define KEY_MODE 0x01    // æ¨¡å¼æŒ‰é”® #define KEY_PLUS 0x02     // åŠ  void KeyProc(void) &#123;        if (Trg &amp; KEY_MODE) // å¦‚æœæŒ‰ä¸‹çš„æ˜¯KEY_MODEï¼Œè€Œä¸”ä½ å¸¸æŒ‰è¿™æŒ‰é”®ä¹Ÿæ²¡æœ‰ç”¨ï¼Œ     &#123;                    //å®ƒæ˜¯ä¸ä¼šæ‰§è¡Œç¬¬äºŒæ¬¡çš„å“¦ ï¼Œ å¿…é¡»å…ˆæ¾å¼€å†æŒ‰ä¸‹          Mode++;         // æ‰§è¡Œ+1                          // (æ‰§è¡Œçš„å…¶ä»–ä»£ç )     &#125;     if (Cont ^ KEY_PLUS) // å¦‚æœæŒ‰é”®ä¿æŒè¢«æŒ‰ç€ä¸æ”¾     &#123;          cnt_plus++;       // è®¡æ—¶ï¼Œè¿™é‡Œæœ€å¥½æ”¾ç½®å®šæ—¶å™¨ï¼Œå¯åŠ¨ï¼Œå¼€å§‹è®¡æ•°          if (cnt_plus &gt; 100) // 20ms*100 = 2S å¦‚æœæ—¶é—´åˆ°          &#123;               Func();      // ä½ éœ€è¦çš„æ‰§è¡Œçš„ç¨‹åº          &#125;               &#125; &#125;</code></p><h6 id="Trg-è¡¨ç¤ºçš„å°±æ˜¯è§¦å‘çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯è·³å˜ï¼Œåªè¦æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆç”µå¹³ä»1åˆ°0çš„è·³å˜ï¼‰ï¼Œé‚£ä¹ˆTrgåœ¨å¯¹åº”æŒ‰é”®çš„ä½ä¸Šé¢ä¼šç½®1ï¼Œæˆ‘ä»¬ç”¨äº†æŒ‰é”®Trgçš„å€¼ä¸º0x01ï¼Œç±»ä¼¼ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰é”®æŒ‰ä¸‹çš„è¯ï¼ŒTrg-çš„å€¼å°±åº”è¯¥ä¸º-0x01-ï¼Œæœ€å…³é”®çš„åœ°æ–¹ï¼ŒTrg-çš„å€¼æ¯æ¬¡æŒ‰ä¸‹åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œç„¶åç«‹åˆ»è¢«æ¸…é™¤ï¼Œå®Œå…¨ä¸éœ€è¦äººå·¥å»å¹²é¢„ã€‚æ‰€ä»¥æŒ‰é”®åŠŸèƒ½å¤„ç†ç¨‹åºä¸ä¼šé‡å¤æ‰§è¡Œï¼Œçœä¸‹äº†ä¸€å¤§å †çš„æ¡ä»¶åˆ¤æ–­ï¼ŒContä»£è¡¨çš„æ˜¯é•¿æŒ‰é”®ï¼Œå¦‚æœæŒ‰é”®æŒ‰ç€ä¸æ”¾ï¼Œé‚£ä¹ˆContçš„å€¼å°±ä¸º-0x01ï¼Œç›¸å¯¹åº”ï¼ŒæŒ‰é”®é•¿æŒ‰ä¸æ”¾ï¼Œé‚£ä¹ˆContçš„å€¼ä¸º0x01ï¼ŒåŒæ ·å¾ˆå¥½ç†è§£ã€‚"><a href="#Trg-è¡¨ç¤ºçš„å°±æ˜¯è§¦å‘çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯è·³å˜ï¼Œåªè¦æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆç”µå¹³ä»1åˆ°0çš„è·³å˜ï¼‰ï¼Œé‚£ä¹ˆTrgåœ¨å¯¹åº”æŒ‰é”®çš„ä½ä¸Šé¢ä¼šç½®1ï¼Œæˆ‘ä»¬ç”¨äº†æŒ‰é”®Trgçš„å€¼ä¸º0x01ï¼Œç±»ä¼¼ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰é”®æŒ‰ä¸‹çš„è¯ï¼ŒTrg-çš„å€¼å°±åº”è¯¥ä¸º-0x01-ï¼Œæœ€å…³é”®çš„åœ°æ–¹ï¼ŒTrg-çš„å€¼æ¯æ¬¡æŒ‰ä¸‹åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œç„¶åç«‹åˆ»è¢«æ¸…é™¤ï¼Œå®Œå…¨ä¸éœ€è¦äººå·¥å»å¹²é¢„ã€‚æ‰€ä»¥æŒ‰é”®åŠŸèƒ½å¤„ç†ç¨‹åºä¸ä¼šé‡å¤æ‰§è¡Œï¼Œçœä¸‹äº†ä¸€å¤§å †çš„æ¡ä»¶åˆ¤æ–­ï¼ŒContä»£è¡¨çš„æ˜¯é•¿æŒ‰é”®ï¼Œå¦‚æœæŒ‰é”®æŒ‰ç€ä¸æ”¾ï¼Œé‚£ä¹ˆContçš„å€¼å°±ä¸º-0x01ï¼Œç›¸å¯¹åº”ï¼ŒæŒ‰é”®é•¿æŒ‰ä¸æ”¾ï¼Œé‚£ä¹ˆContçš„å€¼ä¸º0x01ï¼ŒåŒæ ·å¾ˆå¥½ç†è§£ã€‚" class="headerlink" title="Trg è¡¨ç¤ºçš„å°±æ˜¯è§¦å‘çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯è·³å˜ï¼Œåªè¦æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆç”µå¹³ä»1åˆ°0çš„è·³å˜ï¼‰ï¼Œé‚£ä¹ˆTrgåœ¨å¯¹åº”æŒ‰é”®çš„ä½ä¸Šé¢ä¼šç½®1ï¼Œæˆ‘ä»¬ç”¨äº†æŒ‰é”®Trgçš„å€¼ä¸º0x01ï¼Œç±»ä¼¼ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰é”®æŒ‰ä¸‹çš„è¯ï¼ŒTrg çš„å€¼å°±åº”è¯¥ä¸º 0x01 ï¼Œæœ€å…³é”®çš„åœ°æ–¹ï¼ŒTrg çš„å€¼æ¯æ¬¡æŒ‰ä¸‹åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œç„¶åç«‹åˆ»è¢«æ¸…é™¤ï¼Œå®Œå…¨ä¸éœ€è¦äººå·¥å»å¹²é¢„ã€‚æ‰€ä»¥æŒ‰é”®åŠŸèƒ½å¤„ç†ç¨‹åºä¸ä¼šé‡å¤æ‰§è¡Œï¼Œçœä¸‹äº†ä¸€å¤§å †çš„æ¡ä»¶åˆ¤æ–­ï¼ŒContä»£è¡¨çš„æ˜¯é•¿æŒ‰é”®ï¼Œå¦‚æœæŒ‰é”®æŒ‰ç€ä¸æ”¾ï¼Œé‚£ä¹ˆContçš„å€¼å°±ä¸º 0x01ï¼Œç›¸å¯¹åº”ï¼ŒæŒ‰é”®é•¿æŒ‰ä¸æ”¾ï¼Œé‚£ä¹ˆContçš„å€¼ä¸º0x01ï¼ŒåŒæ ·å¾ˆå¥½ç†è§£ã€‚"></a>Trg è¡¨ç¤ºçš„å°±æ˜¯è§¦å‘çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯è·³å˜ï¼Œåªè¦æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ˆç”µå¹³ä»1åˆ°0çš„è·³å˜ï¼‰ï¼Œé‚£ä¹ˆTrgåœ¨å¯¹åº”æŒ‰é”®çš„ä½ä¸Šé¢ä¼šç½®1ï¼Œæˆ‘ä»¬ç”¨äº†æŒ‰é”®Trgçš„å€¼ä¸º0x01ï¼Œç±»ä¼¼ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰é”®æŒ‰ä¸‹çš„è¯ï¼ŒTrg çš„å€¼å°±åº”è¯¥ä¸º 0x01 ï¼Œæœ€å…³é”®çš„åœ°æ–¹ï¼ŒTrg çš„å€¼æ¯æ¬¡æŒ‰ä¸‹åªä¼šå‡ºç°ä¸€æ¬¡ï¼Œç„¶åç«‹åˆ»è¢«æ¸…é™¤ï¼Œå®Œå…¨ä¸éœ€è¦äººå·¥å»å¹²é¢„ã€‚æ‰€ä»¥æŒ‰é”®åŠŸèƒ½å¤„ç†ç¨‹åºä¸ä¼šé‡å¤æ‰§è¡Œï¼Œçœä¸‹äº†ä¸€å¤§å †çš„æ¡ä»¶åˆ¤æ–­ï¼ŒContä»£è¡¨çš„æ˜¯é•¿æŒ‰é”®ï¼Œå¦‚æœæŒ‰é”®æŒ‰ç€ä¸æ”¾ï¼Œé‚£ä¹ˆContçš„å€¼å°±ä¸º 0x01ï¼Œç›¸å¯¹åº”ï¼ŒæŒ‰é”®é•¿æŒ‰ä¸æ”¾ï¼Œé‚£ä¹ˆContçš„å€¼ä¸º0x01ï¼ŒåŒæ ·å¾ˆå¥½ç†è§£ã€‚</h6><p><code>Trg</code></p><p><code>1</code></p><p><code>Trg</code></p><p><code>0x01</code></p><p><code>Trg</code></p><p><code>0x01</code></p><p><code>Trg</code></p><p><code>Cont</code></p><p><code>Cont</code></p><p><code>0x01</code></p><p><code>Cont</code></p><p><code>0x01</code></p><ul><li>åŸæ–‡ï¼š<a href="https://link.csdn.net/?target=http://blog.ednchina.com/zp2009/983530/message.aspx">https://link.csdn.net/?target=http%3A%2F%2Fblog.ednchina.com%2Fzp2009%2F983530%2Fmessage.aspx</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡CD4019è®¾è®¡çš„ç”µå­æ—¶é’Ÿ</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E9%80%9A%E8%BF%87CD4019%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%94%B5%E5%AD%90%E6%97%B6%E9%92%9F/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-%E9%80%9A%E8%BF%87CD4019%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%94%B5%E5%AD%90%E6%97%B6%E9%92%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="é€šè¿‡CD4019è®¾è®¡çš„ç”µå­æ—¶é’Ÿ"><a href="#é€šè¿‡CD4019è®¾è®¡çš„ç”µå­æ—¶é’Ÿ" class="headerlink" title="é€šè¿‡CD4019è®¾è®¡çš„ç”µå­æ—¶é’Ÿ"></a>é€šè¿‡CD4019è®¾è®¡çš„ç”µå­æ—¶é’Ÿ</h1><h3 id="é€šè¿‡CD4019è®¾è®¡çš„ç”µå­æ—¶é’Ÿ-1"><a href="#é€šè¿‡CD4019è®¾è®¡çš„ç”µå­æ—¶é’Ÿ-1" class="headerlink" title="é€šè¿‡CD4019è®¾è®¡çš„ç”µå­æ—¶é’Ÿ"></a>é€šè¿‡CD4019è®¾è®¡çš„ç”µå­æ—¶é’Ÿ</h3><ul><li>proteusä»¿çœŸæ¼”ç¤º</li><li>ä»¿çœŸèµ„æ–™</li></ul><p><img src="https://img-blog.csdnimg.cn/20210628110408665.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1KeIPO_5zGpbFW10cA5jGCw </span><br><span class="line">æå–ç ï¼št151</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1KeIPO_5zGpbFW10cA5jGCw  æå–ç ï¼št151</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-8%E4%B8%AAIO%E5%8F%A3%E6%A3%80%E6%B5%8B64%E4%B8%AA%E6%8C%89%E9%94%AE%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E5%92%8C%E5%BF%83%E6%B3%95%E8%A6%81%E7%82%B9%E8%AE%B2%E8%A7%A3/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-8%E4%B8%AAIO%E5%8F%A3%E6%A3%80%E6%B5%8B64%E4%B8%AA%E6%8C%89%E9%94%AE%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0%E5%92%8C%E5%BF%83%E6%B3%95%E8%A6%81%E7%82%B9%E8%AE%B2%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£"><a href="#8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£" class="headerlink" title="8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£"></a>8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£</h1><h3 id="8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£-1"><a href="#8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£-1" class="headerlink" title="8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£"></a>8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œç®—æ³•å®ç°å’Œå¿ƒæ³•è¦ç‚¹è®²è§£</h3><p><img src="https://img-blog.csdnimg.cn/b06936679fd94a8198ae7fd9722cbde1.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨æ­¤ç¯‡åŸºç¡€ä¸Šã€Š8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œæ•°ç ç®¡æ˜¾ç¤º(Proteusä»¿çœŸ)ã€‹è¿›è¡Œäº†ç®—æ³•å®ç°åŸç†è®²è§£å’Œæ³¨æ„è¦é¢†ã€‚</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120162356">8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼Œæ•°ç ç®¡æ˜¾ç¤º(Proteusä»¿çœŸ)</a></p><p>ç•ªå¤–ç¯‡ã€Š8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼ã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120337930">8ä¸ªIOå£æ£€æµ‹64ä¸ªæŒ‰é”®ï¼ŒæŒ‰é”®è‡ªé”æ§åˆ¶æ–¹å¼</a></p><p><img src="https://img-blog.csdnimg.cn/f8623c241ce94d13b34b61cbb78d87d2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰«æåŸç†æƒ³é€šäº†å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡ä¸€ä¸ªIOæ‹‰ä½ï¼Œå…¶æ£€æµ‹è¿™ä¸€ç»„å…¶ä»–7ä¸ªIOå£çŠ¶æ€ï¼Œå¦‚æœæ£€æµ‹åˆ°æœ‰è¢«æ‹‰ä½äº†ï¼Œè¯´æ˜å°±æœ‰æŒ‰é”®æŒ‰ä¸‹äº†ï¼Œå› ä¸ºæ£€æµ‹åˆ°æ‹‰ä½çš„IOå£ï¼Œæ˜¯è¢«è¢«ç”¨æ¥æ£€æµ‹çš„IOå£æ‹‰ä½çš„ã€‚ç›¸å½“äºæˆ‘ç”¨ä¸€ä¸ªæ¥GNDçš„æ¢é’ˆå»ç¢°ä¸€ä¸ªé«˜ç”µå¹³çš„IOå£ï¼Œè‚¯å®šæ˜¯ä¼šæ‹‰ä½çš„ã€‚ç”µè·¯åŸç†çš„è¯ï¼Œåˆ©ç”¨äºŒæç®¡å•å‘å¯¼é€šç‰¹æ€§ï¼Œåœ¨æ£€æŸ¥è¿‡ç¨‹ä¸­ï¼Œå¦‚æœIOå£è¢«æ‹‰ä½ï¼Œåªèƒ½æ„æˆä¸€ä¸ªå›è·¯ã€‚</p><ul><li>çŸ¥é“äº†æŒ‰é”®æ‰«æåŸç†ç„¶åå»å®ç°çš„è¿‡ç¨‹å¹¶ä¸æ˜¯å¾ˆè‰°éš¾ï¼Œæˆ‘è§‰å¾—æœ€å›°éš¾çš„æ˜¯è°ƒè¯•è¿‡ç¨‹é‡åˆ°çš„å„ç§é—®é¢˜ã€‚æŒæ¡å…¶åŸç†å¹¶ä¸é‚£ä¹ˆå¤æ‚ï¼Œåœ¨å†™å®Œä¹‹åï¼Œä»£ç å¹¶ä¸æ˜¯å¾ˆé¡ºåˆ©æŒ‰ç…§è‡ªå·±çš„æ€è·¯å»è¿è¡Œçš„ï¼Œä¹Ÿè®¸å°±æ˜¯ä¸€ä¸ªé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚ä¸€ä¸ªDIYåˆ›æ„å¯èƒ½å¾ˆç®€å•ï¼ŒçœŸæ­£è®©å…¶æŒ‰ç…§è‡ªå·±çš„æƒ³æ³•è¿è¡Œè¿˜æ˜¯æœ‰å¾ˆå¤šç»†èŠ‚ç‚¹è¦æ‰“é€šçš„ã€‚</li><li>å°bugæŠ˜è…¾çš„æ—¶é—´æ¯”æ•´ä¸ªå†™ä»£ç çš„èŠ±è´¹çš„ç»å†å’Œæ—¶é—´å¤šå¾—å¤šï¼Œæƒ³æƒ³ä¸€ä¸ªç¨³å®šå¥½ç”¨çš„äº§å“éƒ½éœ€è¦å‡ ä¸ªç‰ˆæœ¬çš„è¿­ä»£ã€‚</li></ul><h4 id="æ€»ç»“è¦é¢†"><a href="#æ€»ç»“è¦é¢†" class="headerlink" title="æ€»ç»“è¦é¢†"></a>æ€»ç»“è¦é¢†</h4><ul><li>æœ€éš¾çš„åœ°æ–¹æ˜¯ï¼Œæ§åˆ¶56-64æœ€åä¸€æ’çš„æ•°ç ç®¡æ˜¾ç¤ºï¼Œå› ä¸ºï¼Œè¿™ä¸ªä½ æ˜¯å¯¹P0æ€»çº¿ç«¯å£è‡ªèº«çš„æ‰«æï¼Œæœ€å®¹æ˜“å‡ºé—®é¢˜çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å¡åœ¨è¿™ä¸ªåœ°æ–¹æœ€é•¿æ—¶é—´ã€‚ä¸€å®šè¦äº†è§£å…¶å•ç‰‡æœºè¿è¡Œå’ŒæŒ‰é”®æ‰«æåŸç†ã€‚åœ¨æ²¡æœ‰å»¶æ—¶æˆ–æ‰“æ–­çš„æƒ…å†µä¸‹ï¼ŒæŒ‰é”®åŠ¨ä½œçš„æ—¶é—´ä¸€å®šæ˜¯å¿«ä¸è¿‡å•ç‰‡æœºè¿è¡Œçš„é€Ÿåº¦ã€‚æ‰€ä»¥åœ¨å¤„ç†æœ€åä¸€æ’æŒ‰é”®æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œæ˜¾ç¤ºæ—¶è¦æ¯”å…¶ä»–è¡Œæ‰«æå¤„ç†çš„æ—¶é—´ç•™é•¿ä¸€ç‚¹ï¼Œä¸ç„¶å°±å¾ˆå®¹æ˜“è·³æ•°ï¼ŒæŒ‰ä¸‹çš„æŒ‰é”®ï¼Œå’Œæ˜¾ç¤ºçš„æ•°å€¼ä¸æ˜¯ä½ æƒ³è¦çš„ç»“æœï¼Œä¸‹é¢æˆ‘ä¼šå°†ç»éªŒä¸€ä¸€å†™ä¸‹æ¥ã€‚</li></ul><h5 id="åœ¨å¤„ç†æœ€åä¸€æ’æŒ‰é”®ï¼Œæˆ‘æœ‰æƒ³è¿‡ä¸¤ä¸ªåŠæ³•æ¥å¤„ç†é€»è¾‘åˆ¤æ–­é—®é¢˜ï¼š"><a href="#åœ¨å¤„ç†æœ€åä¸€æ’æŒ‰é”®ï¼Œæˆ‘æœ‰æƒ³è¿‡ä¸¤ä¸ªåŠæ³•æ¥å¤„ç†é€»è¾‘åˆ¤æ–­é—®é¢˜ï¼š" class="headerlink" title="åœ¨å¤„ç†æœ€åä¸€æ’æŒ‰é”®ï¼Œæˆ‘æœ‰æƒ³è¿‡ä¸¤ä¸ªåŠæ³•æ¥å¤„ç†é€»è¾‘åˆ¤æ–­é—®é¢˜ï¼š"></a>åœ¨å¤„ç†æœ€åä¸€æ’æŒ‰é”®ï¼Œæˆ‘æœ‰æƒ³è¿‡ä¸¤ä¸ªåŠæ³•æ¥å¤„ç†é€»è¾‘åˆ¤æ–­é—®é¢˜ï¼š</h5><ul><li>åˆ©ç”¨å¤åˆé€»è¾‘æ¥å†™ï¼Œå¾ˆç›´è§‚ï¼Œä½†æ˜¯ä»£ç é˜…è¯»å’Œå¯æ‰§è¡Œæ€§çœ‹èµ·æ¥ç›¸å¯¹å¾ˆè‡ƒè‚¿ä¸€æ ·ï¼Œå†™çš„æ—¶å€™å¾ˆçˆ½ï¼Œå•ç‰‡æœºå¤„ç†é€»è¾‘ï¼Œè¿è¡Œçš„æ—¶é—´ä¼šå¤šä¸€äº›ã€‚</li></ul><p>æœ€å…ˆæƒ³åˆ°çš„ç¬¬ä¸€ç§åŠæ³•ï¼Œå†™æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(P0==0x7f||P0==0xbf||P0==0xdf||P0==0xef||P0==0xf7||P0==0xfb||P0==0xfd||P0==0xfe)</span><br></pre></td></tr></table></figure><p><code>if(P0==0x7f||P0==0xbf||P0==0xdf||P0==0xef||P0==0xf7||P0==0xfb||P0==0xfd||P0==0xfe)</code></p><p>ç¬¬äºŒç§åŠæ³•ï¼Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼ï¼šï¼ˆä¸ºä»€ä¹ˆå¯ä»¥é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•æ¥å¿«é€Ÿç­›æŸ¥å¯¹è±¡ï¼Œæ˜¯æœ‰è®²ç©¶çš„ï¼‰ï¼šäºŒåˆ†æŸ¥æ‰¾çš„æ¡ä»¶å°±æ˜¯æ³¨æ„äº‹é¡¹ï¼Œå®šä¹‰çš„æ•°ç»„å¿…é¡»æ˜¯æœ‰åºåºåˆ—æ‰è¡Œã€‚æœ€ä¼˜æ–¹æ³•çœ‹ä¸æ‡‚ä¸è¦ç´§ï¼Œç›´æ¥æœç®—æ³•æ‹¿æ¥ç”¨å°±è¡Œï¼å†™æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">int Search(uchar arr[], int len, int flag)</span><br><span class="line">&#123;</span><br><span class="line">    int right = len - 1;</span><br><span class="line">    int left = 0;</span><br><span class="line">    while (left &lt;= right)</span><br><span class="line">    &#123;</span><br><span class="line">        int mid = (right + left) / 2;</span><br><span class="line">        if (arr[mid] &gt; flag)</span><br><span class="line">        &#123;</span><br><span class="line">            right = mid - 1;</span><br><span class="line">        &#125;</span><br><span class="line">        else if (arr[mid] &lt; flag)</span><br><span class="line">        &#123;</span><br><span class="line">            left = mid + 1;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            return arr[mid];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>int Search(uchar arr[], int len, int flag) &#123;     int right = len - 1;     int left = 0;     while (left &lt;= right)     &#123;         int mid = (right + left) / 2;         if (arr[mid] &gt; flag)         &#123;             right = mid - 1;         &#125;         else if (arr[mid] &lt; flag)         &#123;             left = mid + 1;         &#125;         else         &#123;             return arr[mid];         &#125;     &#125;     return 0; &#125;</code></p><p>ç¬¬ä¸‰ç§éå†æ–¹æ³•ï¼Œå°±ä¸éœ€è¦å‚ç…§äºŒåˆ†æŸ¥æ‰¾ç®—æ³•é‚£æ ·è€ƒè™‘ä»€ä¹ˆæ³¨æ„äº‹é¡¹äº†ï¼Œéšä¾¿å†™ä¸€ä¸ªç®€å•çš„éå†ç¨‹åºå³å¯ï¼Œæ‰§è¡Œæ•ˆç‡è™½ç„¶æ…¢ä¸€ç‚¹ï¼Œèµ·ç å®ç°èµ·æ¥ç®€å•ï¼Œä»£ç å¯æ•²æ€§å¼ºï¼Œæ¯”èµ·äºŒåˆ†æŸ¥æ‰¾ç®—æ³•å†™èµ·æ¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">uchar libian(uchar a[], int value, int n)</span><br><span class="line">&#123;</span><br><span class="line">int i;</span><br><span class="line">  for (i = 0; i &lt; n; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    if (value == a[i])</span><br><span class="line">    &#123;</span><br><span class="line">      return a[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>uchar libian(uchar a[], int value, int n) &#123;     int i;   for (i = 0; i &lt; n; i++)   &#123;     if (value == a[i])     &#123;       return a[i];     &#125;   &#125;   return 0; &#125;</code></p><ul><li>0-64ä¸ªæŒ‰é”®ï¼Œéœ€è¦è€ƒè™‘æ¶ˆæŠ–çš„åªæœ‰æœ€åä¸€æ’56-64çš„8ä¸ªæŒ‰é”®çš„å“åº”ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢?è¿™æ˜¯å› ä¸ºæŒ‰é”®ä»è®¾è®¡åŸç†å’Œå®ç°æ¥çœ‹çš„ã€‚0-56çš„æŒ‰é”®ä¸ç®¡ä½ æ€ä¹ˆé•¿æŒ‰è¿˜æ˜¯çŸ­æŒ‰ï¼Œå•ç‰‡æœºç»™ä½ çš„å“åº”æ•°å€¼éƒ½æ˜¯ä¸€æ ·çš„ä¸ä¼šå˜ï¼Œä½†æ˜¯åœ¨å¤„ç†56-64è¿™8ä¸ªæŒ‰é”®æ—¶ï¼Œæ˜¯åšäº†ç‰¹æ®Šå¤„ç†ï¼Œè¿æ¥çš„æ˜¯GNDï¼Œå¦‚æœæ•²ä»£ç æ²¡æ³¨æ„çš„è¯ï¼Œå°±å¾ˆå®¹æ˜“é€ æˆè·³æ•°å­—ï¼Œå•ç‰‡æœºæ‰«ææ˜¯é€šè¿‡æŒ‰ç…§è§„å®šå…ˆç»™æŒ‡å®šçš„IOå£æ‹‰ç‚¹ï¼Œå†å»æ£€æµ‹å…¶ä»–7ä¸ªIOçš„ç”µå¹³çŠ¶æ€ï¼Œæ‰€ä»¥åœ¨å¤„ç†ç¬¬56-64æŒ‰é”®æ—¶ï¼Œå¦‚æœä½ æ“ä½œçš„æŒ‰é”®æŒ‰ä¸‹æ—¶ï¼Œå•ç‰‡æœºæ‰«ææŒ‰é”®çš„é€Ÿåº¦å·²ç»ä»ä½ æŒ‰ä¸‹é‚£ä¸€åˆ°å¼¹èµ·å‰å·²ç»è¶…è¿‡äº†ä½ çš„é€Ÿåº¦ï¼Œé‚£ä¹ˆä¼šé€ æˆï¼Œå•ç‰‡æœºè¯»å–åˆ°é”™è¯¯çš„å“åº”æ•°æ®ï¼Œå¤„ç†æ–¹å¼å¦‚ä¸‹ï¼š</li></ul><p><code>0-64</code></p><p><code>56-64</code></p><p><code>0-56</code></p><p><code>56-64</code></p><p><code>GND</code></p><p><code>IO</code></p><p><code>IO</code></p><p><code>56-64</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/****************è‡ªèº«ç«¯å£è¯»å–*********************/</span><br><span class="line">P0=0xff;//æ‰«æç¬¬8è¡Œ</span><br><span class="line">//    delay(5);</span><br><span class="line">tmp=P0;</span><br><span class="line">    if (Search(arr, 8, tmp))</span><br><span class="line">    &#123;</span><br><span class="line">        //å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(Search(arr, 8, tmp))</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0xfe:</span><br><span class="line">            keynum=57;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xfd:</span><br><span class="line">            keynum=58;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xfb:</span><br><span class="line">            keynum=59;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xf7:</span><br><span class="line">            keynum=60;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xef:</span><br><span class="line">            keynum=61;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xdf:</span><br><span class="line">            keynum=62;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xbf:</span><br><span class="line">            keynum=63;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x7f:</span><br><span class="line">            keynum=64;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬8ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line">display();//è¿™é‡Œå¿…é¡»å•ç‹¬å¤„ç†P0çš„IOæ£€æµ‹å’Œæ˜¾ç¤ºï¼Œå¦åˆ™å®¹æ˜“è·³æ•°</span><br><span class="line">delay(80);//é˜»å¡æŒ‰é”®æ‰«æï¼Œé˜²æ­¢æ•°ç ç®¡è·³å˜ï¼Œå…¶ä»–è¡Œæ‰«æä¸éœ€è¦æ­¤å¤„çš„å»¶æ—¶ã€‚</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>/****************è‡ªèº«ç«¯å£è¯»å–*********************/         P0=0xff;//æ‰«æç¬¬8è¡Œ //    delay(5);         tmp=P0;     if (Search(arr, 8, tmp))     &#123;         //å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡         switch(Search(arr, 8, tmp))         &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢         case 0xfe:             keynum=57;             break;//ç¬¬1è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹         case 0xfd:             keynum=58;             break;//ç¬¬1è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹         case 0xfb:             keynum=59;             break;//ç¬¬1è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹         case 0xf7:             keynum=60;             break;//ç¬¬1è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹         case 0xef:             keynum=61;             break;//ç¬¬1è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹         case 0xdf:             keynum=62;             break;//ç¬¬1è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹         case 0xbf:             keynum=63;             break;//ç¬¬1è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹         case 0x7f:             keynum=64;             break;//ç¬¬1è¡Œç¬¬8ä¸ªæŒ‰é”®æŒ‰ä¸‹         &#125;             display();//è¿™é‡Œå¿…é¡»å•ç‹¬å¤„ç†P0çš„IOæ£€æµ‹å’Œæ˜¾ç¤ºï¼Œå¦åˆ™å®¹æ˜“è·³æ•°             delay(80);//é˜»å¡æŒ‰é”®æ‰«æï¼Œé˜²æ­¢æ•°ç ç®¡è·³å˜ï¼Œå…¶ä»–è¡Œæ‰«æä¸éœ€è¦æ­¤å¤„çš„å»¶æ—¶ã€‚     &#125;</code></p><h4 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line">//å…±é˜´ææ•°ç ç®¡0~9</span><br><span class="line">uchar code table[]= &#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f&#125;;//0-9å…±é˜´æ•°ç ç®¡</span><br><span class="line">uchar code arr[] = &#123;0x7f, 0xbf, 0xdf, 0xef, 0xf7, 0xfb, 0xfd, 0xfe&#125;;</span><br><span class="line"></span><br><span class="line">uchar duanZhi[]= &#123;0,0&#125;;//ä¿å­˜æ¯æ®µæ•°ç ç®¡æ˜¾ç¤ºä½æ•°çš„æ•°å€¼</span><br><span class="line">sbit P36=P3^6;//æ•°ç ç®¡æ—¶èƒ½ç«¯</span><br><span class="line">sbit P37=P3^7;</span><br><span class="line">sbit ST=P3^0;//å®šä¹‰74HC595ç§»ä½å¯„å­˜å™¨</span><br><span class="line">sbit SH=P3^2;</span><br><span class="line">sbit DS=P3^1;</span><br><span class="line">sbit P33=P3^3;</span><br><span class="line">sbit P34=P3^4;</span><br><span class="line">sbit P35=P3^5;</span><br><span class="line"></span><br><span class="line">uchar shi,ge;//æ•°ç ç®¡ä¸ªä½å’Œåä½æ˜¾ç¤º</span><br><span class="line">uchar tmp;//æš‚å­˜P0çš„å€¼</span><br><span class="line">static uchar keynum=0;//æŒ‰é”®å€¼</span><br><span class="line">unsigned char Trg;</span><br><span class="line">unsigned char Cont;</span><br><span class="line">static char count=1;</span><br><span class="line">//æ¯«ç§’çº§å»¶æ—¶</span><br><span class="line">void delay(uint z)</span><br><span class="line">&#123;</span><br><span class="line">    uint x,y;</span><br><span class="line">    for(x=z; x&gt;&gt;0; x--)</span><br><span class="line">        for(y=110; y&gt;&gt;0; y--);</span><br><span class="line">&#125;</span><br><span class="line">void SendTo595(uchar byteData);</span><br><span class="line">int Search(uchar arr[], int len, int flag)</span><br><span class="line">&#123;</span><br><span class="line">    int right = len - 1;</span><br><span class="line">    int left = 0;</span><br><span class="line">    while (left &lt;= right)</span><br><span class="line">    &#123;</span><br><span class="line">        int mid = (right + left) / 2;</span><br><span class="line">        if (arr[mid] &gt; flag)</span><br><span class="line">        &#123;</span><br><span class="line">            right = mid - 1;</span><br><span class="line">        &#125;</span><br><span class="line">        else if (arr[mid] &lt; flag)</span><br><span class="line">        &#123;</span><br><span class="line">            left = mid + 1;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            return arr[mid];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">/*----------------------------------------------------------------------------------</span><br><span class="line">                                æ˜¾ç¤º</span><br><span class="line"></span><br><span class="line">void display2()</span><br><span class="line">&#123;</span><br><span class="line">    ge = keynum%10;</span><br><span class="line">    shi = keynum/10;</span><br><span class="line">    duanZhi[0]=table[ge];</span><br><span class="line">    duanZhi[1]=table[shi];</span><br><span class="line">    P34=0x00;</span><br><span class="line">    SendTo595(duanZhi[0]); //</span><br><span class="line">    delay(5);</span><br><span class="line">    P34=0x01;//æ¶ˆéš</span><br><span class="line"></span><br><span class="line">    P33=0x00;</span><br><span class="line">    SendTo595(duanZhi[1]);//</span><br><span class="line">    delay(5);</span><br><span class="line">    P33=0x01;//æ¶ˆéš</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">----------------------------------------------------------------------------------*/</span><br><span class="line">void display()</span><br><span class="line">&#123;</span><br><span class="line">    ge = keynum%10;</span><br><span class="line">    shi = keynum/10;</span><br><span class="line">    duanZhi[0]=table[ge];</span><br><span class="line">    duanZhi[1]=table[shi];</span><br><span class="line">    //æ˜¾ç¤ºä¸ªä½</span><br><span class="line">    P37=0;</span><br><span class="line">    SendTo595(duanZhi[0]); //</span><br><span class="line">    delay(2);</span><br><span class="line">    P37=1;//æ¶ˆéš</span><br><span class="line">    //æ˜¾ç¤ºåä½</span><br><span class="line">    P36=0;</span><br><span class="line">    SendTo595(duanZhi[1]);//</span><br><span class="line">    delay(2);</span><br><span class="line">    P36=1;//æ¶ˆéš</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/***********************************************************</span><br><span class="line">*å‡½æ•°åï¼šSendTo595</span><br><span class="line">*åŠŸèƒ½:ä¸²è¡Œå‘é€8ä¸ªæ¯”ç‰¹ï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰çš„æ•°æ®ç»™595ï¼Œå†å¹¶è¡Œè¾“å‡º</span><br><span class="line">*å‚æ•°ï¼šbyteData</span><br><span class="line">************************************************************/</span><br><span class="line">void SendTo595(uchar byteData)</span><br><span class="line">&#123;</span><br><span class="line">    uchar i=0;</span><br><span class="line">    ST = 0;   //ST //å…ˆæ‹‰ä½ï¼Œä¸ºåé¢çš„ä¸Šå‡æ²¿åšå‡†å¤‡</span><br><span class="line">    for(i; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        SH = 0;//å…ˆæ‹‰ä½ï¼Œ</span><br><span class="line">        if(byteData&amp;0x80)DS=1;</span><br><span class="line">        else DS=0;</span><br><span class="line">//        DS = (byteData&amp;0x80)?1:0;</span><br><span class="line">        byteData = byteData &lt;&lt;1;//è¯¥å­—èŠ‚å³ç§»ä¸€ä½</span><br><span class="line"></span><br><span class="line">        SH = 1;//ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        SH = 0;        //ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ</span><br><span class="line">    &#125;</span><br><span class="line">    /*ä½ç§»å¯„å­˜å™¨æ•°æ®å‡†å¤‡å®Œæ¯•,è½¬ç§»åˆ°å­˜å‚¨å¯„å­˜å™¨*/</span><br><span class="line">    ST =1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    ST = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void key_scan()</span><br><span class="line">&#123;</span><br><span class="line">//    P0=0xff;</span><br><span class="line">//    delay(6);</span><br><span class="line">    </span><br><span class="line">    /********************ç¬¬1è¡Œæ‰«æ**************************/</span><br><span class="line"></span><br><span class="line">    P0=0x7F;//æ‰«æç¬¬1è¡Œ0111 1111</span><br><span class="line">    delay(5);</span><br><span class="line">    if (!Search(arr, 8, tmp))//æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">        tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(tmp)</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0x7e:</span><br><span class="line">            keynum=50;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x7d:</span><br><span class="line">            keynum=51;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x7b:</span><br><span class="line">            keynum=52;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x77:</span><br><span class="line">            keynum=53;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x6f:</span><br><span class="line">            keynum=54;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x5f:</span><br><span class="line">            keynum=55;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x3f:</span><br><span class="line">            keynum=56;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /********************ç¬¬2è¡Œæ‰«æ**************************/</span><br><span class="line">    P0=0xbf;//æ‰«æç¬¬2è¡Œ</span><br><span class="line">    delay(5);</span><br><span class="line">    if(P0!=0xbf)//æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">        tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(tmp)</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0xbe:</span><br><span class="line">            keynum=43;</span><br><span class="line">            break;//ç¬¬2è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xbd:</span><br><span class="line">            keynum=44;</span><br><span class="line">            break;//ç¬¬2è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xbb:</span><br><span class="line">            keynum=45;</span><br><span class="line">            break;//ç¬¬2è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xb7:</span><br><span class="line">            keynum=46;</span><br><span class="line">            break;//ç¬¬2è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xaf:</span><br><span class="line">            keynum=47;</span><br><span class="line">            break;//ç¬¬2è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x9f:</span><br><span class="line">            keynum=48;</span><br><span class="line">            break;//ç¬¬2è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x3f:</span><br><span class="line">            keynum=49;</span><br><span class="line">            break;//ç¬¬2è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /********************ç¬¬3è¡Œæ‰«æ**************************/</span><br><span class="line"></span><br><span class="line">    P0=0xdf;//æ‰«æç¬¬3è¡Œ</span><br><span class="line">    delay(5);</span><br><span class="line">     if(P0!=0xdf)//æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">        tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(tmp)</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0xde:</span><br><span class="line">            keynum=36;</span><br><span class="line">            break;//ç¬¬3è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xdd:</span><br><span class="line">            keynum=37;</span><br><span class="line">            break;//ç¬¬3è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xdb:</span><br><span class="line">            keynum=38;</span><br><span class="line">            break;//ç¬¬3è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xd7:</span><br><span class="line">            keynum=39;</span><br><span class="line">            break;//ç¬¬3è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xcf:</span><br><span class="line">            keynum=40;</span><br><span class="line">            break;//ç¬¬3è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x9f:</span><br><span class="line">            keynum=41;</span><br><span class="line">            break;//ç¬¬3è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x5f:</span><br><span class="line">            keynum=42;</span><br><span class="line">            break;//ç¬¬3è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    /********************ç¬¬4è¡Œæ‰«æ**************************/</span><br><span class="line"></span><br><span class="line">    P0=0xef;//æ‰«æç¬¬4è¡Œ</span><br><span class="line">    delay(5);</span><br><span class="line">    if(P0!=0xef)//æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">        tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(tmp)</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0xee:</span><br><span class="line">            keynum=29;</span><br><span class="line">            break;//ç¬¬4è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xed:</span><br><span class="line">            keynum=30;</span><br><span class="line">            break;//ç¬¬4è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xeb:</span><br><span class="line">            keynum=31;</span><br><span class="line">            break;//ç¬¬4è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xe7:</span><br><span class="line">            keynum=32;</span><br><span class="line">            break;//ç¬¬3è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xcf:</span><br><span class="line">            keynum=33;</span><br><span class="line">            break;//ç¬¬4è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xaf:</span><br><span class="line">            keynum=34;</span><br><span class="line">            break;//ç¬¬4è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x6f:</span><br><span class="line">            keynum=35;</span><br><span class="line">            break;//ç¬¬4è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /********************ç¬¬5è¡Œæ‰«æ**************************/</span><br><span class="line"></span><br><span class="line">    P0=0xf7;//æ‰«æç¬¬5è¡Œ</span><br><span class="line">    delay(5);</span><br><span class="line">    if(P0!=0xf7)//æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">        tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(tmp)</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0xf6:</span><br><span class="line">            keynum=22;</span><br><span class="line">            break;//ç¬¬5è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xf5:</span><br><span class="line">            keynum=23;</span><br><span class="line">            break;//ç¬¬5è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xf3:</span><br><span class="line">            keynum=24;</span><br><span class="line">            break;//ç¬¬5è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xe7:</span><br><span class="line">            keynum=25;</span><br><span class="line">            break;//ç¬¬5è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xd7:</span><br><span class="line">            keynum=26;</span><br><span class="line">            break;//ç¬¬5è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xb7:</span><br><span class="line">            keynum=27;</span><br><span class="line">            break;//ç¬¬5è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x77:</span><br><span class="line">            keynum=28;</span><br><span class="line">            break;//ç¬¬5è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /********************ç¬¬6è¡Œæ‰«æ**************************/</span><br><span class="line"></span><br><span class="line">    P0=0xfb;//æ‰«æç¬¬6è¡Œ</span><br><span class="line">    delay(5);</span><br><span class="line">    if(P0!=0xfb)//æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">        tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(tmp)</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0xfa:</span><br><span class="line">            keynum=15;</span><br><span class="line">            break;//ç¬¬6è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xf9:</span><br><span class="line">            keynum=16;</span><br><span class="line">            break;//ç¬¬6è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xf3:</span><br><span class="line">            keynum=17;</span><br><span class="line">            break;//ç¬¬6è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xeb:</span><br><span class="line">            keynum=18;</span><br><span class="line">            break;//ç¬¬6è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xdb:</span><br><span class="line">            keynum=19;</span><br><span class="line">            break;//ç¬¬6è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xbb:</span><br><span class="line">            keynum=20;</span><br><span class="line">            break;//ç¬¬6è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x7b:</span><br><span class="line">            keynum=21;</span><br><span class="line">            break;//ç¬¬6è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /********************ç¬¬7è¡Œæ‰«æ**************************/</span><br><span class="line">    P0=0xfd;//æ‰«æç¬¬7è¡Œ</span><br><span class="line">    delay(5);</span><br><span class="line">    if(P0!=0xfd)//æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">        tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(tmp)</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0xfc:</span><br><span class="line">            keynum=8;</span><br><span class="line">            break;//ç¬¬7è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xf9:</span><br><span class="line">            keynum=9;</span><br><span class="line">            break;//ç¬¬7è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xf5:</span><br><span class="line">            keynum=10;</span><br><span class="line">            break;//ç¬¬7è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xed:</span><br><span class="line">            keynum=11;</span><br><span class="line">            break;//ç¬¬7è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xdd:</span><br><span class="line">            keynum=12;</span><br><span class="line">            break;//ç¬¬7è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xbd:</span><br><span class="line">            keynum=13;</span><br><span class="line">            break;//ç¬¬7è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x7d:</span><br><span class="line">            keynum=14;</span><br><span class="line">            break;//ç¬¬7è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /********************ç¬¬8è¡Œæ‰«æ**************************/</span><br><span class="line"></span><br><span class="line">    P0=0xfe;//æ‰«æç¬¬8è¡Œ</span><br><span class="line">    delay(5);</span><br><span class="line">    if(P0!=0xfe)//æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">        tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(tmp)</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0xfc:</span><br><span class="line">            keynum=1;</span><br><span class="line">            break;//ç¬¬8è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xfa:</span><br><span class="line">            keynum=2;</span><br><span class="line">            break;//ç¬¬8è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xf6:</span><br><span class="line">            keynum=3;</span><br><span class="line">            break;//ç¬¬8è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xee:</span><br><span class="line">            keynum=4;</span><br><span class="line">            break;//ç¬¬8è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xde:</span><br><span class="line">            keynum=5;</span><br><span class="line">            break;//ç¬¬8è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xbe:</span><br><span class="line">            keynum=6;</span><br><span class="line">            break;//ç¬¬8è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x7e:</span><br><span class="line">            keynum=7;</span><br><span class="line">            break;//ç¬¬8è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">/****************è‡ªèº«ç«¯å£è¯»å–*********************/</span><br><span class="line">P0=0xff;//æ‰«æç¬¬8è¡Œ</span><br><span class="line">//    delay(5);</span><br><span class="line">tmp=P0;</span><br><span class="line">    if (Search(arr, 8, tmp))</span><br><span class="line">    &#123;</span><br><span class="line">        //å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡</span><br><span class="line">        switch(Search(arr, 8, tmp))</span><br><span class="line">        &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢</span><br><span class="line">        case 0xfe:</span><br><span class="line">            keynum=57;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xfd:</span><br><span class="line">            keynum=58;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xfb:</span><br><span class="line">            keynum=59;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xf7:</span><br><span class="line">            keynum=60;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xef:</span><br><span class="line">            keynum=61;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xdf:</span><br><span class="line">            keynum=62;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0xbf:</span><br><span class="line">            keynum=63;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        case 0x7f:</span><br><span class="line">            keynum=64;</span><br><span class="line">            break;//ç¬¬1è¡Œç¬¬8ä¸ªæŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">        &#125;</span><br><span class="line">display();//è¿™é‡Œå¿…é¡»å•ç‹¬å¤„ç†P0çš„IOæ£€æµ‹å’Œæ˜¾ç¤ºï¼Œå¦åˆ™å®¹æ˜“è·³æ•°</span><br><span class="line">delay(80);//é˜»å¡æŒ‰é”®æ‰«æï¼Œé˜²æ­¢æ•°ç ç®¡è·³å˜ï¼Œå…¶ä»–è¡Œæ‰«æä¸éœ€è¦æ­¤å¤„çš„å»¶æ—¶ã€‚</span><br><span class="line">    &#125;</span><br><span class="line">   display();//è¿™é‡Œçš„æ˜¾ç¤ºæ˜¯ä¿å­˜ä¸Šä¸€æ¬¡çš„æ˜¾ç¤ºå€¼ </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    keynum=0;</span><br><span class="line">    P0=0xff;</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        key_scan();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include&lt;intrins.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int<br>&#x2F;&#x2F;å…±é˜´ææ•°ç ç®¡0~9<br>uchar code table[]&#x3D; {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};&#x2F;&#x2F;0-9å…±é˜´æ•°ç ç®¡<br>uchar code arr[] &#x3D; {0x7f, 0xbf, 0xdf, 0xef, 0xf7, 0xfb, 0xfd, 0xfe};</p><p>uchar duanZhi[]&#x3D; {0,0};&#x2F;&#x2F;ä¿å­˜æ¯æ®µæ•°ç ç®¡æ˜¾ç¤ºä½æ•°çš„æ•°å€¼<br>sbit P36&#x3D;P3^6;&#x2F;&#x2F;æ•°ç ç®¡æ—¶èƒ½ç«¯<br>sbit P37&#x3D;P3^7;<br>sbit ST&#x3D;P3^0;&#x2F;&#x2F;å®šä¹‰74HC595ç§»ä½å¯„å­˜å™¨<br>sbit SH&#x3D;P3^2;<br>sbit DS&#x3D;P3^1;<br>sbit P33&#x3D;P3^3;<br>sbit P34&#x3D;P3^4;<br>sbit P35&#x3D;P3^5;</p><p>uchar shi,ge;&#x2F;&#x2F;æ•°ç ç®¡ä¸ªä½å’Œåä½æ˜¾ç¤º<br>uchar tmp;&#x2F;&#x2F;æš‚å­˜P0çš„å€¼<br>static uchar keynum&#x3D;0;&#x2F;&#x2F;æŒ‰é”®å€¼<br>unsigned char Trg;<br>unsigned char Cont;<br>static char count&#x3D;1;<br>&#x2F;&#x2F;æ¯«ç§’çº§å»¶æ—¶<br>void delay(uint z)<br>{<br>    uint x,y;<br>    for(x&#x3D;z; x&gt;&gt;0; xâ€“)<br>        for(y&#x3D;110; y&gt;&gt;0; yâ€“);<br>}<br>void SendTo595(uchar byteData);<br>int Search(uchar arr[], int len, int flag)<br>{<br>    int right &#x3D; len - 1;<br>    int left &#x3D; 0;<br>    while (left &lt;&#x3D; right)<br>    {<br>        int mid &#x3D; (right + left) &#x2F; 2;<br>        if (arr[mid] &gt; flag)<br>        {<br>            right &#x3D; mid - 1;<br>        }<br>        else if (arr[mid] &lt; flag)<br>        {<br>            left &#x3D; mid + 1;<br>        }<br>        else<br>        {<br>            return arr[mid];<br>        }<br>    }<br>    return 0;<br>}<br>&#x2F;*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-<br>                                æ˜¾ç¤º</p><p>void display2()<br>{<br>    ge &#x3D; keynum%10;<br>    shi &#x3D; keynum&#x2F;10;<br>    duanZhi[0]&#x3D;table[ge];<br>    duanZhi[1]&#x3D;table[shi];<br>    P34&#x3D;0x00;<br>    SendTo595(duanZhi[0]); &#x2F;&#x2F;<br>    delay(5);<br>    P34&#x3D;0x01;&#x2F;&#x2F;æ¶ˆéš</p><pre><code>P33=0x00;SendTo595(duanZhi[1]);//delay(5);P33=0x01;//æ¶ˆéš</code></pre><p>}<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-*&#x2F;<br>void display()<br>{<br>    ge &#x3D; keynum%10;<br>    shi &#x3D; keynum&#x2F;10;<br>    duanZhi[0]&#x3D;table[ge];<br>    duanZhi[1]&#x3D;table[shi];<br>    &#x2F;&#x2F;æ˜¾ç¤ºä¸ªä½<br>    P37&#x3D;0;<br>    SendTo595(duanZhi[0]); &#x2F;&#x2F;<br>    delay(2);<br>    P37&#x3D;1;&#x2F;&#x2F;æ¶ˆéš<br>    &#x2F;&#x2F;æ˜¾ç¤ºåä½<br>    P36&#x3D;0;<br>    SendTo595(duanZhi[1]);&#x2F;&#x2F;<br>    delay(2);<br>    P36&#x3D;1;&#x2F;&#x2F;æ¶ˆéš</p><p>}<br>&#x2F;***********************************************************<br>*å‡½æ•°åï¼šSendTo595<br>*åŠŸèƒ½:ä¸²è¡Œå‘é€8ä¸ªæ¯”ç‰¹ï¼ˆä¸€ä¸ªå­—èŠ‚ï¼‰çš„æ•°æ®ç»™595ï¼Œå†å¹¶è¡Œè¾“å‡º<br>*å‚æ•°ï¼šbyteData<br>************************************************************&#x2F;<br>void SendTo595(uchar byteData)<br>{<br>    uchar i&#x3D;0;<br>    ST &#x3D; 0;   &#x2F;&#x2F;ST &#x2F;&#x2F;å…ˆæ‹‰ä½ï¼Œä¸ºåé¢çš„ä¸Šå‡æ²¿åšå‡†å¤‡<br>    for(i; i&lt;8; i++)<br>    {<br>        SH &#x3D; 0;&#x2F;&#x2F;å…ˆæ‹‰ä½ï¼Œ<br>        if(byteData&amp;0x80)DS&#x3D;1;<br>        else DS&#x3D;0;<br>&#x2F;&#x2F;        DS &#x3D; (byteData&amp;0x80)?1:0;<br>        byteData &#x3D; byteData &lt;&lt;1;&#x2F;&#x2F;è¯¥å­—èŠ‚å³ç§»ä¸€ä½</p><pre><code>    SH = 1;//ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ    _nop_();    _nop_();    SH = 0;        //ä¸Šå‡æ²¿ï¼Œè®©ä¸²è¡Œè¾“å…¥æ—¶é’Ÿå˜ä¸ºé«˜ç”µå¹³ï¼Œå¹¶å»¶æ—¶2ä¸ªæ—¶é’Ÿå‘¨æœŸ&#125;/*ä½ç§»å¯„å­˜å™¨æ•°æ®å‡†å¤‡å®Œæ¯•,è½¬ç§»åˆ°å­˜å‚¨å¯„å­˜å™¨*/ST =1;_nop_();_nop_();ST = 0;</code></pre><p>}</p><p>void key_scan()<br>{<br>&#x2F;&#x2F;    P0&#x3D;0xff;<br>&#x2F;&#x2F;    delay(6);</p><pre><code>/********************ç¬¬1è¡Œæ‰«æ**************************/P0=0x7F;//æ‰«æç¬¬1è¡Œ0111 1111delay(5);if (!Search(arr, 8, tmp))//æœ‰æŒ‰é”®æŒ‰ä¸‹&#123;    tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡    switch(tmp)    &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢    case 0x7e:        keynum=50;        break;//ç¬¬1è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x7d:        keynum=51;        break;//ç¬¬1è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x7b:        keynum=52;        break;//ç¬¬1è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x77:        keynum=53;        break;//ç¬¬1è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x6f:        keynum=54;        break;//ç¬¬1è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x5f:        keynum=55;        break;//ç¬¬1è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x3f:        keynum=56;        break;//ç¬¬1è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹    &#125;&#125;/********************ç¬¬2è¡Œæ‰«æ**************************/P0=0xbf;//æ‰«æç¬¬2è¡Œdelay(5);if(P0!=0xbf)//æœ‰æŒ‰é”®æŒ‰ä¸‹&#123;    tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡    switch(tmp)    &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢    case 0xbe:        keynum=43;        break;//ç¬¬2è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xbd:        keynum=44;        break;//ç¬¬2è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xbb:        keynum=45;        break;//ç¬¬2è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xb7:        keynum=46;        break;//ç¬¬2è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xaf:        keynum=47;        break;//ç¬¬2è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x9f:        keynum=48;        break;//ç¬¬2è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x3f:        keynum=49;        break;//ç¬¬2è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹    &#125;&#125;/********************ç¬¬3è¡Œæ‰«æ**************************/P0=0xdf;//æ‰«æç¬¬3è¡Œdelay(5); if(P0!=0xdf)//æœ‰æŒ‰é”®æŒ‰ä¸‹&#123;    tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡    switch(tmp)    &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢    case 0xde:        keynum=36;        break;//ç¬¬3è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xdd:        keynum=37;        break;//ç¬¬3è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xdb:        keynum=38;        break;//ç¬¬3è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xd7:        keynum=39;        break;//ç¬¬3è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xcf:        keynum=40;        break;//ç¬¬3è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x9f:        keynum=41;        break;//ç¬¬3è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x5f:        keynum=42;        break;//ç¬¬3è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹    &#125;&#125;/********************ç¬¬4è¡Œæ‰«æ**************************/P0=0xef;//æ‰«æç¬¬4è¡Œdelay(5);if(P0!=0xef)//æœ‰æŒ‰é”®æŒ‰ä¸‹&#123;    tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡    switch(tmp)    &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢    case 0xee:        keynum=29;        break;//ç¬¬4è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xed:        keynum=30;        break;//ç¬¬4è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xeb:        keynum=31;        break;//ç¬¬4è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xe7:        keynum=32;        break;//ç¬¬3è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xcf:        keynum=33;        break;//ç¬¬4è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xaf:        keynum=34;        break;//ç¬¬4è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x6f:        keynum=35;        break;//ç¬¬4è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹    &#125;&#125;/********************ç¬¬5è¡Œæ‰«æ**************************/P0=0xf7;//æ‰«æç¬¬5è¡Œdelay(5);if(P0!=0xf7)//æœ‰æŒ‰é”®æŒ‰ä¸‹&#123;    tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡    switch(tmp)    &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢    case 0xf6:        keynum=22;        break;//ç¬¬5è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xf5:        keynum=23;        break;//ç¬¬5è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xf3:        keynum=24;        break;//ç¬¬5è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xe7:        keynum=25;        break;//ç¬¬5è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xd7:        keynum=26;        break;//ç¬¬5è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xb7:        keynum=27;        break;//ç¬¬5è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x77:        keynum=28;        break;//ç¬¬5è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹    &#125;&#125;/********************ç¬¬6è¡Œæ‰«æ**************************/P0=0xfb;//æ‰«æç¬¬6è¡Œdelay(5);if(P0!=0xfb)//æœ‰æŒ‰é”®æŒ‰ä¸‹&#123;    tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡    switch(tmp)    &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢    case 0xfa:        keynum=15;        break;//ç¬¬6è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xf9:        keynum=16;        break;//ç¬¬6è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xf3:        keynum=17;        break;//ç¬¬6è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xeb:        keynum=18;        break;//ç¬¬6è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xdb:        keynum=19;        break;//ç¬¬6è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xbb:        keynum=20;        break;//ç¬¬6è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x7b:        keynum=21;        break;//ç¬¬6è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹    &#125;&#125;/********************ç¬¬7è¡Œæ‰«æ**************************/P0=0xfd;//æ‰«æç¬¬7è¡Œdelay(5);if(P0!=0xfd)//æœ‰æŒ‰é”®æŒ‰ä¸‹&#123;    tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡    switch(tmp)    &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢    case 0xfc:        keynum=8;        break;//ç¬¬7è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xf9:        keynum=9;        break;//ç¬¬7è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xf5:        keynum=10;        break;//ç¬¬7è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xed:        keynum=11;        break;//ç¬¬7è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xdd:        keynum=12;        break;//ç¬¬7è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xbd:        keynum=13;        break;//ç¬¬7è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x7d:        keynum=14;        break;//ç¬¬7è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹    &#125;&#125;/********************ç¬¬8è¡Œæ‰«æ**************************/P0=0xfe;//æ‰«æç¬¬8è¡Œdelay(5);if(P0!=0xfe)//æœ‰æŒ‰é”®æŒ‰ä¸‹&#123;    tmp=P0;//å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡    switch(tmp)    &#123;   //ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢    case 0xfc:        keynum=1;        break;//ç¬¬8è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xfa:        keynum=2;        break;//ç¬¬8è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xf6:        keynum=3;        break;//ç¬¬8è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xee:        keynum=4;        break;//ç¬¬8è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xde:        keynum=5;        break;//ç¬¬8è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0xbe:        keynum=6;        break;//ç¬¬8è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹    case 0x7e:        keynum=7;        break;//ç¬¬8è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹    &#125;&#125;</code></pre><p>&#x2F;<strong><strong><strong><strong><strong><strong><strong><strong>è‡ªèº«ç«¯å£è¯»å–</strong></strong></strong></strong></strong></strong></strong></strong>*****&#x2F;<br>        P0&#x3D;0xff;&#x2F;&#x2F;æ‰«æç¬¬8è¡Œ<br>&#x2F;&#x2F;    delay(5);<br>        tmp&#x3D;P0;<br>    if (Search(arr, 8, tmp))<br>    {<br>        &#x2F;&#x2F;å°†æ£€æµ‹åˆ°çš„P0çŠ¶æ€å€¼èµ‹å€¼ç»™ä¸´æ—¶å˜é‡<br>        switch(Search(arr, 8, tmp))<br>        {   &#x2F;&#x2F;ä¸´æ—¶å˜é‡å¯¹é€ä¸ªIOå£è¿›è¡ŒæŸ¥è¯¢<br>        case 0xfe:<br>            keynum&#x3D;57;<br>            break;&#x2F;&#x2F;ç¬¬1è¡Œç¬¬1ä¸ªæŒ‰é”®æŒ‰ä¸‹<br>        case 0xfd:<br>            keynum&#x3D;58;<br>            break;&#x2F;&#x2F;ç¬¬1è¡Œç¬¬2ä¸ªæŒ‰é”®æŒ‰ä¸‹<br>        case 0xfb:<br>            keynum&#x3D;59;<br>            break;&#x2F;&#x2F;ç¬¬1è¡Œç¬¬3ä¸ªæŒ‰é”®æŒ‰ä¸‹<br>        case 0xf7:<br>            keynum&#x3D;60;<br>            break;&#x2F;&#x2F;ç¬¬1è¡Œç¬¬4ä¸ªæŒ‰é”®æŒ‰ä¸‹<br>        case 0xef:<br>            keynum&#x3D;61;<br>            break;&#x2F;&#x2F;ç¬¬1è¡Œç¬¬5ä¸ªæŒ‰é”®æŒ‰ä¸‹<br>        case 0xdf:<br>            keynum&#x3D;62;<br>            break;&#x2F;&#x2F;ç¬¬1è¡Œç¬¬6ä¸ªæŒ‰é”®æŒ‰ä¸‹<br>        case 0xbf:<br>            keynum&#x3D;63;<br>            break;&#x2F;&#x2F;ç¬¬1è¡Œç¬¬7ä¸ªæŒ‰é”®æŒ‰ä¸‹<br>        case 0x7f:<br>            keynum&#x3D;64;<br>            break;&#x2F;&#x2F;ç¬¬1è¡Œç¬¬8ä¸ªæŒ‰é”®æŒ‰ä¸‹<br>        }<br>            display();&#x2F;&#x2F;è¿™é‡Œå¿…é¡»å•ç‹¬å¤„ç†P0çš„IOæ£€æµ‹å’Œæ˜¾ç¤ºï¼Œå¦åˆ™å®¹æ˜“è·³æ•°<br>            delay(80);&#x2F;&#x2F;é˜»å¡æŒ‰é”®æ‰«æï¼Œé˜²æ­¢æ•°ç ç®¡è·³å˜ï¼Œå…¶ä»–è¡Œæ‰«æä¸éœ€è¦æ­¤å¤„çš„å»¶æ—¶ã€‚<br>    }<br>   display();&#x2F;&#x2F;è¿™é‡Œçš„æ˜¾ç¤ºæ˜¯ä¿å­˜ä¸Šä¸€æ¬¡çš„æ˜¾ç¤ºå€¼ </p><p>}<br>void main()<br>{<br>    keynum&#x3D;0;<br>    P0&#x3D;0xff;<br>    while(1)<br>    {<br>        key_scan();</p><pre><code>&#125;</code></pre><p>}&#96;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E4%B8%89%E6%9E%81%E7%AE%A1%E7%BB%84%E6%88%90%E7%9A%84H%E6%A1%A5%E9%A9%B1%E5%8A%A8%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%AD%A3%E5%8F%8D%E8%BD%AC%E5%8F%AF%E6%8E%A7/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E4%B8%89%E6%9E%81%E7%AE%A1%E7%BB%84%E6%88%90%E7%9A%84H%E6%A1%A5%E9%A9%B1%E5%8A%A8%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%AD%A3%E5%8F%8D%E8%BD%AC%E5%8F%AF%E6%8E%A7/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§"><a href="#ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§"></a>ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§</h1><h3 id="ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§-1"><a href="#ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§"></a>ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/0da52aa9618f45b6aa29983a6705f781.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å®ä¾‹ä»£ç "><a href="#å®ä¾‹ä»£ç " class="headerlink" title="å®ä¾‹ä»£ç "></a>å®ä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§</span><br><span class="line">*/</span><br><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">sbit K1   = P3^0;//æ­£è½¬</span><br><span class="line">sbit K2   = P3^1;//åè½¬</span><br><span class="line">sbit K3   = P3^2;//åœæ­¢</span><br><span class="line"></span><br><span class="line">sbit LED1 = P0^0;//æŒ‡ç¤ºç¯</span><br><span class="line">sbit LED2 = P0^1;</span><br><span class="line">sbit LED3 = P0^2;</span><br><span class="line"></span><br><span class="line">sbit MA   = P1^0;//ç”µæœºæ§åˆ¶å¼•è„š</span><br><span class="line">sbit MB   = P1^1;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">LED1 = 1;</span><br><span class="line">LED2 = 1;</span><br><span class="line">LED3 = 0;</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line"> if(K1 == 0)</span><br><span class="line">&#123;</span><br><span class="line"> while(K1 == 0);</span><br><span class="line">LED1 = 0;</span><br><span class="line">LED2 = 1;</span><br><span class="line">LED3 = 1;</span><br><span class="line">MA   = 0;</span><br><span class="line">MB   = 1;</span><br><span class="line">&#125;</span><br><span class="line">if(K2 == 0)</span><br><span class="line">&#123;</span><br><span class="line"> while(K1 == 0);</span><br><span class="line">LED1 = 1;</span><br><span class="line">LED2 = 0;</span><br><span class="line">LED3 = 1;</span><br><span class="line">MA   = 1;</span><br><span class="line">MB   = 0;</span><br><span class="line">&#125;</span><br><span class="line">if(K3 == 0)</span><br><span class="line">&#123;</span><br><span class="line"> while(K1 == 0);</span><br><span class="line">LED1 = 1;</span><br><span class="line">LED2 = 1;</span><br><span class="line">LED3 = 0;</span><br><span class="line">MA   = 0;</span><br><span class="line">MB   = 0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;*<br>ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœºæ­£åè½¬å¯æ§<br>*&#x2F;<br>#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;<br>#define uint unsigned int<br>#define uchar unsigned char<br>sbit K1   &#x3D; P3^0;&#x2F;&#x2F;æ­£è½¬<br>sbit K2   &#x3D; P3^1;&#x2F;&#x2F;åè½¬<br>sbit K3   &#x3D; P3^2;&#x2F;&#x2F;åœæ­¢</p><p>sbit LED1 &#x3D; P0^0;&#x2F;&#x2F;æŒ‡ç¤ºç¯<br>sbit LED2 &#x3D; P0^1;<br>sbit LED3 &#x3D; P0^2;</p><p>sbit MA   &#x3D; P1^0;&#x2F;&#x2F;ç”µæœºæ§åˆ¶å¼•è„š<br>sbit MB   &#x3D; P1^1;</p><p>void main(void)<br>{<br>    LED1 &#x3D; 1;<br>    LED2 &#x3D; 1;<br>    LED3 &#x3D; 0;<br>    while(1)<br>    {<br>     if(K1 &#x3D;&#x3D; 0)<br>        {<br>         while(K1 &#x3D;&#x3D; 0);<br>            LED1 &#x3D; 0;<br>            LED2 &#x3D; 1;<br>            LED3 &#x3D; 1;<br>            MA   &#x3D; 0;<br>            MB   &#x3D; 1;<br>        }<br>        if(K2 &#x3D;&#x3D; 0)<br>        {<br>         while(K1 &#x3D;&#x3D; 0);<br>            LED1 &#x3D; 1;<br>            LED2 &#x3D; 0;<br>            LED3 &#x3D; 1;<br>            MA   &#x3D; 1;<br>            MB   &#x3D; 0;<br>        }<br>        if(K3 &#x3D;&#x3D; 0)<br>        {<br>         while(K1 &#x3D;&#x3D; 0);<br>            LED1 &#x3D; 1;<br>            LED2 &#x3D; 1;<br>            LED3 &#x3D; 0;<br>            MA   &#x3D; 0;<br>            MB   &#x3D; 0;<br>        }<br>    }<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1aAQ4BJ0AV-MzecxzrpC8YQ </span><br><span class="line">æå–ç ï¼šbmd8</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1aAQ4BJ0AV-MzecxzrpC8YQ  æå–ç ï¼šbmd8</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è“æ¡¥æ¯å•ç‰‡æœºå®šæ—¶å™¨ä¸ä¸­æ–­ç§’è¡¨å®éªŒ+Proteusä»¿çœŸ</title>
      <link href="/2024/03/Proteus-%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%8D%95%E7%89%87%E6%9C%BA%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%A7%92%E8%A1%A8%E5%AE%9E%E9%AA%8CProteus%E4%BB%BF%E7%9C%9F/"/>
      <url>/2024/03/Proteus-%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%8D%95%E7%89%87%E6%9C%BA%E5%AE%9A%E6%97%B6%E5%99%A8%E4%B8%8E%E4%B8%AD%E6%96%AD%E7%A7%92%E8%A1%A8%E5%AE%9E%E9%AA%8CProteus%E4%BB%BF%E7%9C%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="è“æ¡¥æ¯å•ç‰‡æœºå®šæ—¶å™¨ä¸ä¸­æ–­ç§’è¡¨å®éªŒ-Proteusä»¿çœŸ"><a href="#è“æ¡¥æ¯å•ç‰‡æœºå®šæ—¶å™¨ä¸ä¸­æ–­ç§’è¡¨å®éªŒ-Proteusä»¿çœŸ" class="headerlink" title="è“æ¡¥æ¯å•ç‰‡æœºå®šæ—¶å™¨ä¸ä¸­æ–­ç§’è¡¨å®éªŒ+Proteusä»¿çœŸ"></a>è“æ¡¥æ¯å•ç‰‡æœºå®šæ—¶å™¨ä¸ä¸­æ–­ç§’è¡¨å®éªŒ+Proteusä»¿çœŸ</h1><h3 id="è“æ¡¥æ¯å•ç‰‡æœºå®šæ—¶å™¨ä¸ä¸­æ–­ç§’è¡¨å®éªŒ"><a href="#è“æ¡¥æ¯å•ç‰‡æœºå®šæ—¶å™¨ä¸ä¸­æ–­ç§’è¡¨å®éªŒ" class="headerlink" title="è“æ¡¥æ¯å•ç‰‡æœºå®šæ—¶å™¨ä¸ä¸­æ–­ç§’è¡¨å®éªŒ"></a>è“æ¡¥æ¯å•ç‰‡æœºå®šæ—¶å™¨ä¸ä¸­æ–­ç§’è¡¨å®éªŒ</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/62276bbc5bb64afda7599984a2e2ac9a.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç§’è¡¨å®éªŒ"><a href="#ç§’è¡¨å®éªŒ" class="headerlink" title="ç§’è¡¨å®éªŒ"></a>ç§’è¡¨å®éªŒ</h4><p>å®éªŒç›®æ ‡ï¼šåœ¨CT107Då•ç‰‡æœºç»¼åˆè®­ç»ƒå¹³å°ä¸Šï¼Œåˆ©ç”¨å®šæ—¶å™¨T0ã€æ•°ç ç®¡æ¨¡å—å’Œ2ä¸ªç‹¬ç«‹æŒ‰é”®(J5çš„2-3çŸ­æ¥)ï¼Œè®¾è®¡ä¸€ä¸ªç§’è¡¨ï¼Œå…·æœ‰æ¸…é›¶ã€æš‚åœã€å¯åŠ¨åŠŸèƒ½ã€‚</p><h5 id="å®éªŒè¦æ±‚ï¼š"><a href="#å®éªŒè¦æ±‚ï¼š" class="headerlink" title="å®éªŒè¦æ±‚ï¼š"></a>å®éªŒè¦æ±‚ï¼š</h5><ol><li>æ˜¾ç¤ºæ ¼å¼ä¸º: åˆ†-ç§’- 0.05ç§’(å³50ms)ï¼Œä¾‹ï¼š08-26-18è¡¨ç¤º: 8åˆ† 26ç§’900æ¯«ç§’ã€‚</li><li>ç‹¬ç«‹æŒ‰é”®S4ä¸º:æš‚åœ|å¯åŠ¨ï¼›ç‹¬ç«‹æŒ‰é”®S5ä¸º:æ¸…é›¶ ï¼ŒæŒ‰é”®å‡ä¸ºæŒ‰ä¸‹æœ‰æ•ˆã€‚</li></ol><h4 id="ç¨‹åºä»£ç "><a href="#ç¨‹åºä»£ç " class="headerlink" title="ç¨‹åºä»£ç "></a>ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;reg52.h&quot;</span><br><span class="line"></span><br><span class="line">sbit S4 = P3^3;</span><br><span class="line">sbit S5 = P3^2;/*ç‹¬ç«‹æŒ‰é”®*/</span><br><span class="line"></span><br><span class="line">unsigned char t_m = 0;/*åˆ†*/</span><br><span class="line">unsigned char t_s = 0;/*ç§’*/</span><br><span class="line">unsigned char t_005s = 0;/*50æ¯«ç§’*/</span><br><span class="line"></span><br><span class="line">unsigned char code SMG_NoDot[18] = </span><br><span class="line">    &#123;0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,</span><br><span class="line">     0x80,0x90,0x88,0x80,0xc6,0xc0,0x86,0x8e,</span><br><span class="line">     0xbf,0x7f&#125;;/*å…±é˜³æ•°ç ç®¡çœŸå€¼*/</span><br><span class="line"></span><br><span class="line">void SelectHC573(unsigned char channel)/*74HC573é”å­˜å™¨*/</span><br><span class="line">&#123;</span><br><span class="line">switch(channel)</span><br><span class="line">&#123;</span><br><span class="line">case 4:</span><br><span class="line">P2 = (P2 &amp; 0x1f) | 0x80;</span><br><span class="line">break;</span><br><span class="line">case 5:</span><br><span class="line">P2 = (P2 &amp; 0x1f) | 0xa0;</span><br><span class="line">break;</span><br><span class="line">case 6:</span><br><span class="line">P2 = (P2 &amp; 0x1f) | 0xc0;</span><br><span class="line">break;</span><br><span class="line">case 7:</span><br><span class="line">P2 = (P2 &amp; 0x1f) | 0xe0;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">void DelaySMG(unsigned int t)/*æ•°ç ç®¡å»¶æ—¶å‡½æ•°*/</span><br><span class="line">&#123;</span><br><span class="line">while(t--);</span><br><span class="line">&#125;</span><br><span class="line">void DisplaySMG_Bit(unsigned char value, unsigned char pos)/*æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°*/</span><br><span class="line">&#123;</span><br><span class="line">P0 = 0x00;</span><br><span class="line">SelectHC573(6);</span><br><span class="line">P0 = 0x01 &lt;&lt; pos;</span><br><span class="line">P2=0x00;//æ¶ˆéš</span><br><span class="line">SelectHC573(7);</span><br><span class="line">P0 = value;</span><br><span class="line">P2=0x00;//æ¶ˆéš</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void DisplayTime()/*è®¾ç½®æ•°ç ç®¡æ˜¾ç¤ºå†…å®¹*/</span><br><span class="line">&#123;</span><br><span class="line">DisplaySMG_Bit(SMG_NoDot[t_005s%10],7);</span><br><span class="line">DelaySMG(500);</span><br><span class="line"></span><br><span class="line">DisplaySMG_Bit(SMG_NoDot[t_005s/10],6);</span><br><span class="line">DelaySMG(500);</span><br><span class="line">DisplaySMG_Bit(SMG_NoDot[16],5);</span><br><span class="line">DelaySMG(500);</span><br><span class="line"></span><br><span class="line">DisplaySMG_Bit(SMG_NoDot[t_s%10],4);</span><br><span class="line">DelaySMG(500);</span><br><span class="line">DisplaySMG_Bit(SMG_NoDot[t_s/10],3);</span><br><span class="line">DelaySMG(500);</span><br><span class="line">DisplaySMG_Bit(SMG_NoDot[16],2);</span><br><span class="line">DelaySMG(500);</span><br><span class="line"></span><br><span class="line">DisplaySMG_Bit(SMG_NoDot[t_m%10],1);</span><br><span class="line">DelaySMG(500);</span><br><span class="line">DisplaySMG_Bit(SMG_NoDot[t_m/10],0);</span><br><span class="line">DelaySMG(500);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//=============å®šæ—¶å™¨ç›¸å…³å‡½æ•°========================</span><br><span class="line">void InitTimer0() /*å®šæ—¶å™¨0åˆå§‹åŒ–*/</span><br><span class="line">&#123;</span><br><span class="line">TMOD = 0x01;</span><br><span class="line">TH0 = (65535 - 50000) / 256;</span><br><span class="line">TL0 = (65535 - 50000) % 256;</span><br><span class="line">ET0 = 1;</span><br><span class="line">EA = 1;</span><br><span class="line">TR0 = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å®šæ—¶å™¨ä¸­æ–­æœåŠ¡å‡½æ•°</span><br><span class="line">void ServiceTimer0() interrupt 1 //é»˜è®¤ä¸­æ–­ä¼˜å…ˆçº§ 1</span><br><span class="line">&#123;</span><br><span class="line">TH0 = (65535 - 50000) / 256;</span><br><span class="line">TL0 = (65535 - 50000) % 256;</span><br><span class="line"></span><br><span class="line">t_005s++;</span><br><span class="line">if(t_005s == 20)</span><br><span class="line">&#123;</span><br><span class="line">t_s++;</span><br><span class="line">t_005s = 0;</span><br><span class="line">if(t_s == 60)</span><br><span class="line">&#123;</span><br><span class="line">t_m++;</span><br><span class="line">t_s = 0;</span><br><span class="line">&#125;</span><br><span class="line">if(t_m == 99)</span><br><span class="line">&#123;</span><br><span class="line">t_m = 0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">//==================æŒ‰é”®ç›¸å…³å‡½æ•°=================================</span><br><span class="line">void DelayK(unsigned char t) /*æŒ‰é”®å»¶æ—¶å‡½æ•°*/</span><br><span class="line">&#123;</span><br><span class="line">while(t--);</span><br><span class="line">&#125;</span><br><span class="line">void ScanKeys() /*æŒ‰é”®è¯»å€¼å¹¶è®¾ç½®æŒ‰é”®åŠŸèƒ½*/</span><br><span class="line">&#123;</span><br><span class="line">if(S4 == 0)//ç§’è¡¨å¯åŠ¨ä¸æš‚åœ</span><br><span class="line">&#123;</span><br><span class="line">DelayK(100);</span><br><span class="line">if(S4 == 0)</span><br><span class="line">&#123;</span><br><span class="line">TR0 = ~TR0;</span><br><span class="line">while(S4 == 0)</span><br><span class="line">&#123;</span><br><span class="line">DisplayTime();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(S5 == 0)//ç§’è¡¨æ¸…é›¶</span><br><span class="line">&#123;</span><br><span class="line">DelayK(100);</span><br><span class="line">if(S5 == 0)</span><br><span class="line">&#123;</span><br><span class="line">t_005s = 0;</span><br><span class="line">t_s = 0;</span><br><span class="line">t_m = 0;</span><br><span class="line">while(S5 == 0)</span><br><span class="line">&#123;</span><br><span class="line">DisplayTime();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">//==================å‡½æ•°=================================</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">InitTimer0();</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">DisplayTime();</span><br><span class="line">ScanKeys();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œreg52.hâ€</p><p>sbit S4 &#x3D; P3^3;<br>sbit S5 &#x3D; P3^2;&#x2F;<em>ç‹¬ç«‹æŒ‰é”®</em>&#x2F;</p><p>unsigned char t_m &#x3D; 0;&#x2F;<em>åˆ†</em>&#x2F;<br>unsigned char t_s &#x3D; 0;&#x2F;<em>ç§’</em>&#x2F;<br>unsigned char t_005s &#x3D; 0;&#x2F;<em>50æ¯«ç§’</em>&#x2F;</p><p>unsigned char code SMG_NoDot[18] &#x3D;<br>    {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,<br>     0x80,0x90,0x88,0x80,0xc6,0xc0,0x86,0x8e,<br>     0xbf,0x7f};&#x2F;<em>å…±é˜³æ•°ç ç®¡çœŸå€¼</em>&#x2F;</p><p>void SelectHC573(unsigned char channel)&#x2F;<em>74HC573é”å­˜å™¨</em>&#x2F;<br>{<br>    switch(channel)<br>    {<br>        case 4:<br>            P2 &#x3D; (P2 &amp; 0x1f) | 0x80;<br>        break;<br>        case 5:<br>            P2 &#x3D; (P2 &amp; 0x1f) | 0xa0;<br>        break;<br>        case 6:<br>            P2 &#x3D; (P2 &amp; 0x1f) | 0xc0;<br>        break;<br>        case 7:<br>            P2 &#x3D; (P2 &amp; 0x1f) | 0xe0;<br>        break;<br>    }<br>}<br>void DelaySMG(unsigned int t)&#x2F;<em>æ•°ç ç®¡å»¶æ—¶å‡½æ•°</em>&#x2F;<br>{<br>    while(tâ€“);<br>}<br>void DisplaySMG_Bit(unsigned char value, unsigned char pos)&#x2F;<em>æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°</em>&#x2F;<br>{<br>    P0 &#x3D; 0x00;<br>    SelectHC573(6);<br>    P0 &#x3D; 0x01 &lt;&lt; pos;<br>    P2&#x3D;0x00;&#x2F;&#x2F;æ¶ˆéš<br>    SelectHC573(7);<br>    P0 &#x3D; value;<br>    P2&#x3D;0x00;&#x2F;&#x2F;æ¶ˆéš<br>}</p><p>void DisplayTime()&#x2F;<em>è®¾ç½®æ•°ç ç®¡æ˜¾ç¤ºå†…å®¹</em>&#x2F;<br>{<br>    DisplaySMG_Bit(SMG_NoDot[t_005s%10],7);<br>    DelaySMG(500);</p><pre><code>DisplaySMG_Bit(SMG_NoDot[t_005s/10],6);DelaySMG(500);DisplaySMG_Bit(SMG_NoDot[16],5);DelaySMG(500);DisplaySMG_Bit(SMG_NoDot[t_s%10],4);DelaySMG(500);DisplaySMG_Bit(SMG_NoDot[t_s/10],3);DelaySMG(500);DisplaySMG_Bit(SMG_NoDot[16],2);DelaySMG(500);DisplaySMG_Bit(SMG_NoDot[t_m%10],1);DelaySMG(500);DisplaySMG_Bit(SMG_NoDot[t_m/10],0);DelaySMG(500);</code></pre><p>}</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å®šæ—¶å™¨ç›¸å…³å‡½æ•°&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void InitTimer0() &#x2F;<em>å®šæ—¶å™¨0åˆå§‹åŒ–</em>&#x2F;<br>{<br>    TMOD &#x3D; 0x01;<br>    TH0 &#x3D; (65535 - 50000) &#x2F; 256;<br>    TL0 &#x3D; (65535 - 50000) % 256;<br>    ET0 &#x3D; 1;<br>    EA &#x3D; 1;<br>    TR0 &#x3D; 1;<br>}</p><p>&#x2F;&#x2F;å®šæ—¶å™¨ä¸­æ–­æœåŠ¡å‡½æ•°<br>void ServiceTimer0() interrupt 1 &#x2F;&#x2F;é»˜è®¤ä¸­æ–­ä¼˜å…ˆçº§ 1<br>{<br>    TH0 &#x3D; (65535 - 50000) &#x2F; 256;<br>    TL0 &#x3D; (65535 - 50000) % 256;</p><pre><code>t_005s++;if(t_005s == 20)&#123;    t_s++;    t_005s = 0;    if(t_s == 60)    &#123;        t_m++;        t_s = 0;    &#125;    if(t_m == 99)    &#123;        t_m = 0;    &#125;&#125;</code></pre><p>}<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;æŒ‰é”®ç›¸å…³å‡½æ•°&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void DelayK(unsigned char t) &#x2F;<em>æŒ‰é”®å»¶æ—¶å‡½æ•°</em>&#x2F;<br>{<br>    while(tâ€“);<br>}<br>void ScanKeys() &#x2F;<em>æŒ‰é”®è¯»å€¼å¹¶è®¾ç½®æŒ‰é”®åŠŸèƒ½</em>&#x2F;<br>{<br>    if(S4 &#x3D;&#x3D; 0)&#x2F;&#x2F;ç§’è¡¨å¯åŠ¨ä¸æš‚åœ<br>    {<br>        DelayK(100);<br>        if(S4 &#x3D;&#x3D; 0)<br>        {<br>            TR0 &#x3D; ~TR0;<br>            while(S4 &#x3D;&#x3D; 0)<br>            {<br>                DisplayTime();<br>            }<br>        }<br>    }</p><pre><code>if(S5 == 0)//ç§’è¡¨æ¸…é›¶&#123;    DelayK(100);    if(S5 == 0)    &#123;        t_005s = 0;        t_s = 0;        t_m = 0;        while(S5 == 0)        &#123;            DisplayTime();        &#125;    &#125;&#125;</code></pre><p>}<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;å‡½æ•°&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void main()<br>{<br>    InitTimer0();<br>    while(1)<br>    {<br>        DisplayTime();<br>        ScanKeys();<br>    }<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1hLA69iEetIyEYXpdJ3-7lQ </span><br><span class="line">æå–ç ï¼š4jc7</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1hLA69iEetIyEYXpdJ3-7lQ  æå–ç ï¼š4jc7</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Internal Exception: access violation in module â€˜SPICEINP.DLLâ€˜ [000007F9].è§£å†³åŠæ³•</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-Internal-Exception-access-violation-in-module-SPICEINPDLL-000007F9%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-Internal-Exception-access-violation-in-module-SPICEINPDLL-000007F9%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="Internal-Exception-access-violation-in-module-â€˜SPICEINP-DLLâ€˜-000007F9-è§£å†³åŠæ³•"><a href="#Internal-Exception-access-violation-in-module-â€˜SPICEINP-DLLâ€˜-000007F9-è§£å†³åŠæ³•" class="headerlink" title="Internal Exception: access violation in module â€˜SPICEINP.DLLâ€˜ [000007F9].è§£å†³åŠæ³•"></a>Internal Exception: access violation in module â€˜SPICEINP.DLLâ€˜ [000007F9].è§£å†³åŠæ³•</h1><h3 id="Proteusä»¿çœŸæŠ¥â€œInternal-Exception-access-violation-in-module-â€˜SPICEINP-DLLâ€™-000007F9-â€è§£å†³åŠæ³•"><a href="#Proteusä»¿çœŸæŠ¥â€œInternal-Exception-access-violation-in-module-â€˜SPICEINP-DLLâ€™-000007F9-â€è§£å†³åŠæ³•" class="headerlink" title="Proteusä»¿çœŸæŠ¥â€œInternal Exception: access violation in module â€˜SPICEINP.DLLâ€™ [000007F9].â€è§£å†³åŠæ³•"></a>Proteusä»¿çœŸæŠ¥â€œInternal Exception: access violation in module â€˜SPICEINP.DLLâ€™ [000007F9].â€è§£å†³åŠæ³•</h3><ul><li>Proteusé”™è¯¯æˆªå›¾</li></ul><p><img src="https://img-blog.csdnimg.cn/ee104009199e4005a6acc2b07e8a1161.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æˆ‘ä¸æ•¢ä¿è¯ï¼Œèƒ½è§£å†³æ‰€æœ‰äººçš„ï¼Œå…³äºè¿™ä¸ªé”™è¯¯çš„é€šç”¨è§£å†³åŠæ³•ã€‚ä½†æ˜¯è¿™ä¸ªæ˜¯æˆ‘è‡ªå·±å®æµ‹æœ‰æ•ˆï¼Œåå¤æµ‹è¯•äº†bugçš„å¯é‡å¤æ€§å®éªŒåšè¿‡éªŒè¯ã€‚</p><h3 id="æ­¤é”™è¯¯ä¿¡æ¯æ˜¯åœ¨è¿è¡Œä¸€ä¸ªProteusä»¿çœŸæ­¥è¿›ç”µæœºæ§åˆ¶ç¨‹åºçš„æ—¶å€™æŠ¥é”™ã€‚"><a href="#æ­¤é”™è¯¯ä¿¡æ¯æ˜¯åœ¨è¿è¡Œä¸€ä¸ªProteusä»¿çœŸæ­¥è¿›ç”µæœºæ§åˆ¶ç¨‹åºçš„æ—¶å€™æŠ¥é”™ã€‚" class="headerlink" title="æ­¤é”™è¯¯ä¿¡æ¯æ˜¯åœ¨è¿è¡Œä¸€ä¸ªProteusä»¿çœŸæ­¥è¿›ç”µæœºæ§åˆ¶ç¨‹åºçš„æ—¶å€™æŠ¥é”™ã€‚"></a>æ­¤é”™è¯¯ä¿¡æ¯æ˜¯åœ¨è¿è¡Œä¸€ä¸ªProteusä»¿çœŸæ­¥è¿›ç”µæœºæ§åˆ¶ç¨‹åºçš„æ—¶å€™æŠ¥é”™ã€‚</h3><ul><li>æˆ‘åœ¨ç½‘ä¸Šä¹Ÿæœç´¢äº†å¾ˆä¹…ï¼Œæœ‰äººè¯´é‡æ–°å»ºProteuså·¥ç¨‹ï¼Œé‡æ–°æ·»åŠ å™¨ä»¶å¯ä»¥è§£å†³æ­¤é”™è¯¯ï¼ŒæŒ‰ç…§è¿™ä¸ªçº¿ç´¢ï¼Œæˆ‘ç¡®å®šåº”è¯¥è¿˜æ˜¯æŸä¸ªå™¨ä»¶ä¸å…¼å®¹å¯¼è‡´çš„ï¼Œäºæ˜¯æˆ‘å°è¯•åˆ é™¤ç”µè·¯ä¸­è¿æ¥çš„å™¨ä»¶ï¼Œè¿›è¡Œé€ä¸ªç­›æŸ¥ï¼Œæœç„¶ï¼Œåœ¨æˆ‘åˆ é™¤ä»¿çœŸç”µè·¯ä¸­çš„æ­¥è¿›ç”µæœºä»¥åï¼Œåœ¨ç‚¹å‡»è¿è¡Œä»¿çœŸå°±ä¸å†æŠ¥é”™äº†ï¼Œé—®é¢˜å°±é”å®šåœ¨äº†æ­¥è¿›ç”µæœºå™¨ä»¶ä¸Šï¼Œäºæ˜¯ï¼Œæˆ‘åˆ æ‰è¿™ä¸ªæ­¥è¿›ç”µæœºï¼Œé‡æ–°å–å™¨ä»¶åº“æœç´¢æ·»åŠ ï¼Œç»“æœæ”¾ç½®ä¸Šå»ï¼Œè¿è¡Œä»¿çœŸï¼Œç»“æœä¾æ—§æ˜¯æŠ¥é”™ï¼Œæˆ‘è¿˜æ˜¯é‡æ–°è¿æ¥çº¿è·¯ï¼Œä¹Ÿæ— æœï¼ŒåŒå‡»æ­¥è¿›ç”µæœºå±æ€§å‘å‹å±æ€§é‡Œé¢çš„ç”µå‹å€¼æ˜¯12Vé»˜è®¤å€¼ï¼ŒäºŒç³»ç»Ÿä»¿çœŸé»˜è®¤æ˜¯5Vä¾›ç”µç”µå‹ï¼Œäºæ˜¯æˆ‘å»é…ç½®ç³»ç»Ÿé‡Œé¢æ·»åŠ 12Vçš„ç”µæºç”µå‹ï¼Œæ·»åŠ äº†12Vç”µå‹ä¹‹åï¼Œè¿è¡Œåº—æ¥¼ä»¿çœŸï¼Œæœç„¶ä¸å†æŠ¥é”™ï¼Œé—®é¢˜è§£å†³ã€‚</li><li>æŸ¥çœ‹ç”µæœºå±æ€§ï¼Œå¯ä»¥çœ‹åˆ°é©±åŠ¨ç”µå‹å€¼æ˜¯12Vã€‚</li><li>é¦–å…ˆï¼Œåœ¨æ­¥è¿›ç”µæœºä¾›ç”µå±æ€§è®¾ç½®æ ‡ç­¾12V</li><li>å»æ·»åŠ 12Vç”µå‹é…ç½®åˆ°ç³»ç»Ÿå½“ä¸­å»ã€‚</li><li>æ–°å»º12ç”µå‹å€¼çš„ç”µå‹ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/2e9a45b7073744b6bbcc3c95ec8cdecf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/ba33fcb8dd4744a3afb9ffc407455e75.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/cd4099f8f52c4310bbe3ec5070e5749b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/e3b1e3fd775640faa27489c62f1ae387.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC89C52RC+ LCD1602+PCF8574è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º+Proteusä»¿çœŸ</title>
      <link href="/2024/03/Proteus-STC89C52RC-LCD1602PCF8574%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E5%B1%8F%E5%B9%95%E9%A9%B1%E5%8A%A8%E6%98%BE%E7%A4%BAProteus%E4%BB%BF%E7%9C%9F/"/>
      <url>/2024/03/Proteus-STC89C52RC-LCD1602PCF8574%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E5%B1%8F%E5%B9%95%E9%A9%B1%E5%8A%A8%E6%98%BE%E7%A4%BAProteus%E4%BB%BF%E7%9C%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC89C52RC-LCD1602-PCF8574è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º-Proteusä»¿çœŸ"><a href="#STC89C52RC-LCD1602-PCF8574è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º-Proteusä»¿çœŸ" class="headerlink" title="STC89C52RC+ LCD1602+PCF8574è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º+Proteusä»¿çœŸ"></a>STC89C52RC+ LCD1602+PCF8574è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º+Proteusä»¿çœŸ</h1><h3 id="STC89C52RC-LCD1602-PCF8574è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º-Proteusä»¿çœŸ-1"><a href="#STC89C52RC-LCD1602-PCF8574è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º-Proteusä»¿çœŸ-1" class="headerlink" title="STC89C52RC+ LCD1602+PCF8574è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º+Proteusä»¿çœŸ"></a>STC89C52RC+ LCD1602+PCF8574è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º+Proteusä»¿çœŸ</h3><ul><li>ç¡¬ä»¶å®ç‰©é©±åŠ¨æ˜¾ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/fb8f84298f6d4c86b58cfb41befde03f.jpg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/42c63f7574a5450db6586c53cbb27444.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/c235fd7e6dad44e3a1d25dd2e8a4d9bb.jpg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>ProteusåŠ¨æ€ä»¿çœŸæ˜¾ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/3ce6b01acdf74804a2b3c4e062ee042f.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="Proteuså™¨ä»¶é€‰æ‹©æ³¨æ„äº‹é¡¹"><a href="#Proteuså™¨ä»¶é€‰æ‹©æ³¨æ„äº‹é¡¹" class="headerlink" title="Proteuså™¨ä»¶é€‰æ‹©æ³¨æ„äº‹é¡¹"></a>Proteuså™¨ä»¶é€‰æ‹©æ³¨æ„äº‹é¡¹</h4><ul><li>åœ¨é€‰æ‹©PCF8574ï¼Œå™¨ä»¶çš„æ—¶å€™ï¼Œé€‰æ‹©ä¸è¦å¸¦Açš„çš„ï¼Œä¸ç„¶ä»¿çœŸçš„æ—¶å€™ä¸ä¼šæ˜¾ç¤ºã€‚</li></ul><p><code>PCF8574</code></p><p><img src="https://img-blog.csdnimg.cn/f043eccdd9b2493a9e01223968ea4a88.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="é©±åŠ¨ä»£ç "><a href="#é©±åŠ¨ä»£ç " class="headerlink" title="é©±åŠ¨ä»£ç "></a>é©±åŠ¨ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &quot;intrins.h&quot;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//#define   L1                0x80            // ç¬¬ä¸€è¡Œå†™å…¥åœ°å€</span><br><span class="line">//#define   L2                0xc0            // ç¬¬äºŒè¡Œå†™å…¥åœ°å€</span><br><span class="line"></span><br><span class="line">sbit SCL = P1^0;</span><br><span class="line">sbit SDA = P1^1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">char ADDR = 0x4E;    // PCF8574  T  æ¨¡å—çš„åœ°å€ç </span><br><span class="line">//char ADDR = 0x7e;    // PCF8574   AT  æ¨¡å—çš„åœ°å€ç </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//***************************** å»¶æ—¶æ¯«ç§’å‡½æ•°***********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void delay1(int y)   //</span><br><span class="line">&#123;</span><br><span class="line">    while(y--)</span><br><span class="line">    &#123;</span><br><span class="line">        unsigned char a,b,c;</span><br><span class="line">        for(c=1; c&gt;0; c--)</span><br><span class="line">            for(b=142; b&gt;0; b--)</span><br><span class="line">                for(a=2; a&gt;0; a--);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//******************************** IIC ä¸²å£å¼€å§‹ ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void IIC_start(void)</span><br><span class="line">&#123;</span><br><span class="line">    SDA=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SDA=0;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//********************************** IIC ä¸²å£å†™1ä¸ªå­—èŠ‚ ******************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void IIC_writeByte(char temp)</span><br><span class="line">&#123;</span><br><span class="line">    char i;</span><br><span class="line">    for(i=0; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        SDA=(bit)(temp &amp; 0x80) ;   // æ ¹æ®è§„å®š1602çš„æ•°æ®æœ€é«˜ä½å¿…é¡»ä¸º  1</span><br><span class="line">        temp &lt;&lt;=1;</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        SCL=1;</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        SCL=0;</span><br><span class="line">    &#125;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SDA=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    while(SDA);</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//******************************** 1602å†™å‘½ä»¤ ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void LCD_write_command(char comm)</span><br><span class="line">&#123;</span><br><span class="line">    char tmp;</span><br><span class="line">    IIC_start();          // ä¸²å£å¼€å§‹</span><br><span class="line">    IIC_writeByte(ADDR);  // å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</span><br><span class="line"></span><br><span class="line">    tmp = comm &amp; 0xF0;    // ä¸0xf0 åº”è¯¥æ˜¯å–ç¬¬å››ä½çš„æ„æ€å§</span><br><span class="line">    tmp |= 0x0C;         //ä¿ç•™é«˜4ä½ä¸ºæŒ‡ä»¤çš„é«˜å››ä½ï¼Œä½å››ä½ä¸º   RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);  //ä»ä¸²å£é€å‡º</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB;        //Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line"></span><br><span class="line">    tmp = (comm &amp; 0x0F) &lt;&lt; 4 ;  //å°†æŒ‡ä»¤çš„ä½å››ä½ é€åˆ°é«˜ä½ç½®ä¿å­˜</span><br><span class="line">    tmp |= 0x0C;        //RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB; // Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//******************************** 1602å†™æ•°æ® ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void LCD_write_data(char data1)</span><br><span class="line">&#123;</span><br><span class="line">    char tmp;</span><br><span class="line">    IIC_start();</span><br><span class="line">    IIC_writeByte(ADDR);   // å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</span><br><span class="line"></span><br><span class="line">    tmp = data1 &amp; 0xF0;</span><br><span class="line">    tmp |= 0x0D; //RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB; //Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line"></span><br><span class="line">    tmp = (data1 &amp; 0x0F) &lt;&lt; 4 ;</span><br><span class="line">    tmp |= 0x0D; //RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB ; // Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//******************************** 1602åˆå§‹åŒ– ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void Init_Lcd(void)</span><br><span class="line">&#123;</span><br><span class="line">    LCD_write_command(0x33); //å°†8ä½æ€»çº¿è½¬ä¸º4ä½æ€»çº¿</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x32); //</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x28); // 4ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5*7ç‚¹é˜µå­—ç¬¦  ï¼å¦‚æœæ˜¯0x38  åˆ™ä¸º8ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5*7ç‚¹é˜µå­—ç¬¦</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x0C); // å¼€æ˜¾ç¤ºï¼Œå…³é—­å…‰æ ‡ï¼Œä¸é—ªçƒ</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x06); // è®¾å®šè¾“å…¥æ–¹å¼ï¼Œå¢é‡ä¸ä½ç§»</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x01); // æ¸…å±</span><br><span class="line">    delay1(50) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//*************************************** åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸² *************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void Write_LCD(int x, int y, char *str)</span><br><span class="line">&#123;</span><br><span class="line">    char addr;</span><br><span class="line">    if( x &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        x = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if(x &gt; 15)</span><br><span class="line">    &#123;</span><br><span class="line">        x = 15;</span><br><span class="line">    &#125;</span><br><span class="line">    if(y&lt;0)</span><br><span class="line">    &#123;</span><br><span class="line">        y = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if(y &gt; 1)</span><br><span class="line">    &#123;</span><br><span class="line">        y = 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addr = 0x80 + 0x40 * y + x;   // Move cursor  ç§»åŠ¨å…‰æ ‡</span><br><span class="line">    LCD_write_command(addr);</span><br><span class="line">    while (*str)</span><br><span class="line">    &#123;</span><br><span class="line">        LCD_write_data(*str++);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//-------------------------------------------- æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•° ----------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void LCD_write_word(unsigned char *s) //æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">    while(*s&gt;0)</span><br><span class="line">    &#123;</span><br><span class="line">        LCD_write_data(*s);</span><br><span class="line">        s++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//********************************* æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦*******************************************</span><br><span class="line">/*</span><br><span class="line">void Print_Char (unsigned char line,unsigned char num,unsigned char date)</span><br><span class="line">&#123;</span><br><span class="line">                LCD_write_command(line+num);</span><br><span class="line">                LCD_write_data(date);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">//æŒ‰æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦(é’ˆå¯¹1602æ¶²æ™¶)-ç”¨åœ¨æ¸©åº¦æ˜¾ç¤º</span><br><span class="line">void DisplayOneChar(unsigned char X, unsigned char Y, unsigned char DData)</span><br><span class="line">&#123;</span><br><span class="line">    Y &amp;= 0x1;</span><br><span class="line">    X &amp;= 0xF;                 //é™åˆ¶Xä¸èƒ½å¤§äº15ï¼ŒYä¸èƒ½å¤§äº1</span><br><span class="line">    if (Y) X |= 0x40;        //å½“è¦æ˜¾ç¤ºç¬¬äºŒè¡Œæ—¶åœ°å€ç +0x40;</span><br><span class="line">    X |= 0x80;               // ç®—å‡ºæŒ‡ä»¤ç </span><br><span class="line">    LCD_write_command(X);    //è¿™é‡Œä¸æ£€æµ‹å¿™ä¿¡å·ï¼Œå‘é€åœ°å€ç </span><br><span class="line">    LCD_write_data(DData);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">    Init_Lcd();</span><br><span class="line">Write_LCD(3, 1, &quot;STC89C52RC&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">    DisplayOneChar(0,0,&#x27;P&#x27;);//åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦</span><br><span class="line">    DisplayOneChar(1,0,&#x27;e&#x27;);</span><br><span class="line">    DisplayOneChar(2,0,&#x27;r&#x27;);</span><br><span class="line">    DisplayOneChar(3,0,&#x27;s&#x27;);</span><br><span class="line">    DisplayOneChar(4,0,&#x27;e&#x27;);</span><br><span class="line">    DisplayOneChar(5,0,&#x27;v&#x27;);</span><br><span class="line">    DisplayOneChar(6,0,&#x27;e&#x27;);</span><br><span class="line">    DisplayOneChar(7,0,&#x27;r&#x27;);</span><br><span class="line">    DisplayOneChar(8,0,&#x27;a&#x27;);</span><br><span class="line">    DisplayOneChar(9,0,&#x27;n&#x27;);</span><br><span class="line">    DisplayOneChar(10,0,&#x27;c&#x27;);</span><br><span class="line">    DisplayOneChar(11,0,&#x27;e&#x27;);</span><br><span class="line">while(1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include â€œintrins.hâ€<br>#define uchar unsigned char<br>#define uint unsigned int</p><p>&#x2F;&#x2F;#define   L1                0x80            &#x2F;&#x2F; ç¬¬ä¸€è¡Œå†™å…¥åœ°å€<br>&#x2F;&#x2F;#define   L2                0xc0            &#x2F;&#x2F; ç¬¬äºŒè¡Œå†™å…¥åœ°å€</p><p>sbit SCL &#x3D; P1^0;<br>sbit SDA &#x3D; P1^1;</p><p>char ADDR &#x3D; 0x4E;    &#x2F;&#x2F; PCF8574  T  æ¨¡å—çš„åœ°å€ç <br>&#x2F;&#x2F;char ADDR &#x3D; 0x7e;    &#x2F;&#x2F; PCF8574   AT  æ¨¡å—çš„åœ°å€ç </p><p>&#x2F;&#x2F;***************************** å»¶æ—¶æ¯«ç§’å‡½æ•°***********************************************</p><p>void delay1(int y)   &#x2F;&#x2F;<br>{<br>    while(yâ€“)<br>    {<br>        unsigned char a,b,c;<br>        for(c&#x3D;1; c&gt;0; câ€“)<br>            for(b&#x3D;142; b&gt;0; bâ€“)<br>                for(a&#x3D;2; a&gt;0; aâ€“);<br>    }<br>}</p><p>&#x2F;&#x2F;******************************** IIC ä¸²å£å¼€å§‹ ********************************************</p><p>void IIC_start(void)<br>{<br>    SDA&#x3D;1;<br>    <em>nop</em>();<br>    SCL&#x3D;1;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SDA&#x3D;0;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SCL&#x3D;0;<br>}</p><p>&#x2F;&#x2F;********************************** IIC ä¸²å£å†™1ä¸ªå­—èŠ‚ ******************************************</p><p>void IIC_writeByte(char temp)<br>{<br>    char i;<br>    for(i&#x3D;0; i&lt;8; i++)<br>    {<br>        SDA&#x3D;(bit)(temp &amp; 0x80) ;   &#x2F;&#x2F; æ ¹æ®è§„å®š1602çš„æ•°æ®æœ€é«˜ä½å¿…é¡»ä¸º  1<br>        temp &lt;&lt;&#x3D;1;<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        SCL&#x3D;1;<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        SCL&#x3D;0;<br>    }<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SDA&#x3D;1;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SCL&#x3D;1;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    while(SDA);<br>    <em>nop</em>();<br>    SCL&#x3D;0;<br>}</p><p>&#x2F;&#x2F;******************************** 1602å†™å‘½ä»¤ ********************************************</p><p>void LCD_write_command(char comm)<br>{<br>    char tmp;<br>    IIC_start();          &#x2F;&#x2F; ä¸²å£å¼€å§‹<br>    IIC_writeByte(ADDR);  &#x2F;&#x2F; å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</p><pre><code>tmp = comm &amp; 0xF0;    // ä¸0xf0 åº”è¯¥æ˜¯å–ç¬¬å››ä½çš„æ„æ€å§tmp |= 0x0C;         //ä¿ç•™é«˜4ä½ä¸ºæŒ‡ä»¤çš„é«˜å››ä½ï¼Œä½å››ä½ä¸º   RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);  //ä»ä¸²å£é€å‡ºdelay1(20);tmp &amp;= 0xFB;        //Make EN = 0IIC_writeByte(tmp);tmp = (comm &amp; 0x0F) &lt;&lt; 4 ;  //å°†æŒ‡ä»¤çš„ä½å››ä½ é€åˆ°é«˜ä½ç½®ä¿å­˜tmp |= 0x0C;        //RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);delay1(20);tmp &amp;= 0xFB; // Make EN = 0IIC_writeByte(tmp);</code></pre><p>}<br>&#x2F;&#x2F;******************************** 1602å†™æ•°æ® ********************************************</p><p>void LCD_write_data(char data1)<br>{<br>    char tmp;<br>    IIC_start();<br>    IIC_writeByte(ADDR);   &#x2F;&#x2F; å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</p><pre><code>tmp = data1 &amp; 0xF0;tmp |= 0x0D; //RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);delay1(20);tmp &amp;= 0xFB; //Make EN = 0IIC_writeByte(tmp);tmp = (data1 &amp; 0x0F) &lt;&lt; 4 ;tmp |= 0x0D; //RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);delay1(20);tmp &amp;= 0xFB ; // Make EN = 0IIC_writeByte(tmp);</code></pre><p>}</p><p>&#x2F;&#x2F;******************************** 1602åˆå§‹åŒ– ********************************************</p><p>void Init_Lcd(void)<br>{<br>    LCD_write_command(0x33); &#x2F;&#x2F;å°†8ä½æ€»çº¿è½¬ä¸º4ä½æ€»çº¿<br>    delay1(50) ;<br>    LCD_write_command(0x32); &#x2F;&#x2F;<br>    delay1(50) ;<br>    LCD_write_command(0x28); &#x2F;&#x2F; 4ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5<em>7ç‚¹é˜µå­—ç¬¦  ï¼å¦‚æœæ˜¯0x38  åˆ™ä¸º8ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5</em>7ç‚¹é˜µå­—ç¬¦<br>    delay1(50) ;<br>    LCD_write_command(0x0C); &#x2F;&#x2F; å¼€æ˜¾ç¤ºï¼Œå…³é—­å…‰æ ‡ï¼Œä¸é—ªçƒ<br>    delay1(50) ;<br>    LCD_write_command(0x06); &#x2F;&#x2F; è®¾å®šè¾“å…¥æ–¹å¼ï¼Œå¢é‡ä¸ä½ç§»<br>    delay1(50) ;<br>    LCD_write_command(0x01); &#x2F;&#x2F; æ¸…å±<br>    delay1(50) ;<br>}</p><p>&#x2F;&#x2F;*************************************** åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸² *************************************</p><p>void Write_LCD(int x, int y, char *str)<br>{<br>    char addr;<br>    if( x &lt; 0)<br>    {<br>        x &#x3D; 0;<br>    }<br>    if(x &gt; 15)<br>    {<br>        x &#x3D; 15;<br>    }<br>    if(y&lt;0)<br>    {<br>        y &#x3D; 0;<br>    }<br>    if(y &gt; 1)<br>    {<br>        y &#x3D; 1;<br>    }</p><pre><code>addr = 0x80 + 0x40 * y + x;   // Move cursor  ç§»åŠ¨å…‰æ ‡LCD_write_command(addr);while (*str)&#123;    LCD_write_data(*str++);&#125;</code></pre><p>}</p><p>&#x2F;&#x2F;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•° â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p><p>void LCD_write_word(unsigned char *s) &#x2F;&#x2F;æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•°<br>{<br>    while(*s&gt;0)<br>    {<br>        LCD_write_data(*s);<br>        s++;<br>    }<br>}</p><p>&#x2F;&#x2F;********************************* æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦*******************************************<br>&#x2F;*<br>void Print_Char (unsigned char line,unsigned char num,unsigned char date)<br>{<br>                LCD_write_command(line+num);<br>                LCD_write_data(date);<br>}</p><p>*&#x2F;</p><p>&#x2F;&#x2F;æŒ‰æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦(é’ˆå¯¹1602æ¶²æ™¶)-ç”¨åœ¨æ¸©åº¦æ˜¾ç¤º<br>void DisplayOneChar(unsigned char X, unsigned char Y, unsigned char DData)<br>{<br>    Y &amp;&#x3D; 0x1;<br>    X &amp;&#x3D; 0xF;                 &#x2F;&#x2F;é™åˆ¶Xä¸èƒ½å¤§äº15ï¼ŒYä¸èƒ½å¤§äº1<br>    if (Y) X |&#x3D; 0x40;        &#x2F;&#x2F;å½“è¦æ˜¾ç¤ºç¬¬äºŒè¡Œæ—¶åœ°å€ç +0x40;<br>    X |&#x3D; 0x80;               &#x2F;&#x2F; ç®—å‡ºæŒ‡ä»¤ç <br>    LCD_write_command(X);    &#x2F;&#x2F;è¿™é‡Œä¸æ£€æµ‹å¿™ä¿¡å·ï¼Œå‘é€åœ°å€ç <br>    LCD_write_data(DData);<br>}</p><p>void main() {<br>    Init_Lcd();<br>    Write_LCD(3, 1, â€œSTC89C52RCâ€);&#x2F;&#x2F;åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²<br>    DisplayOneChar(0,0,â€™Pâ€™);&#x2F;&#x2F;åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦<br>    DisplayOneChar(1,0,â€™eâ€™);<br>    DisplayOneChar(2,0,â€™râ€™);<br>    DisplayOneChar(3,0,â€™sâ€™);<br>    DisplayOneChar(4,0,â€™eâ€™);<br>    DisplayOneChar(5,0,â€™vâ€™);<br>    DisplayOneChar(6,0,â€™eâ€™);<br>    DisplayOneChar(7,0,â€™râ€™);<br>    DisplayOneChar(8,0,â€™aâ€™);<br>    DisplayOneChar(9,0,â€™nâ€™);<br>    DisplayOneChar(10,0,â€™câ€™);<br>    DisplayOneChar(11,0,â€™eâ€™);<br>                while(1);<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Pn_Et54aGQn-vP_9Up8-gg </span><br><span class="line">æå–ç ï¼šus98</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Pn_Et54aGQn-vP_9Up8-gg  æå–ç ï¼šus98</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC89C52RC+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º</title>
      <link href="/2024/03/STC-51%E5%8D%95%E7%89%87%E6%9C%BALCD1602%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E5%B1%8F%E5%B9%95%E9%A9%B1%E5%8A%A8%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/STC-51%E5%8D%95%E7%89%87%E6%9C%BALCD1602%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E5%B1%8F%E5%B9%95%E9%A9%B1%E5%8A%A8%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC89C52RC-LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º"><a href="#STC89C52RC-LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º" class="headerlink" title="STC89C52RC+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º"></a>STC89C52RC+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º</h1><h3 id="STC89C52RC-LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º-1"><a href="#STC89C52RC-LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º-1" class="headerlink" title="STC89C52RC+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º"></a>STC89C52RC+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º</h3><ul><li>æ¶²æ™¶å±èµ„æ–™</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Gkcpa_sG0M12yK2233GYfQ </span><br><span class="line">æå–ç ï¼š7cz7</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Gkcpa_sG0M12yK2233GYfQ  æå–ç ï¼š7cz7</code></p><p><img src="https://img-blog.csdnimg.cn/64874702b15b434085b31e06563ca95b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/d15fc15b74af44e3a42a35d653303a60.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>LCD1602è½¬IICè½¬æ¥æ¿é©±åŠ¨æ˜¾ç¤ºæ­£é¢</li><li>æ˜¾ç¤ºæ•ˆæœ</li></ul><p><img src="https://img-blog.csdnimg.cn/a77e0cc1911f4211b477ebf463d451c6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/b8817f9b3fcb4084aa9b28c92ae89265.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>LCD1602è½¬IICè½¬æ¥æ¿é©±åŠ¨æ¨¡å—åé¢</li></ul><p><img src="https://img-blog.csdnimg.cn/80fe86cb100741028b4a47d5cb8eb9c7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/2dff11700d02468d96424dc7b8d359e4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><ul><li>LCD1602è½¬IICæ¥å£èŠ¯ç‰‡é‡‡ç”¨çš„é©±åŠ¨èŠ¯ç‰‡å‹å·ä¸ä¸€æ ·ï¼Œå…¶åœ°å€ä¸ç›¸åŒã€‚</li></ul><p>çœ‹æ¸…æ¥šèƒŒé¢è½¬æ¥æ¿ä¸Šé¢èŠ¯ç‰‡å‹å·ï¼Œæˆ‘çš„æ˜¯å¸¦Tçš„PCF8574T</p><p><code>PCF8574T</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">char ADDR = 0x4E;    // PCF8574T  æ¨¡å—çš„åœ°å€ç </span><br><span class="line">//char ADDR = 0x7e;    // PCF8574AT  æ¨¡å—çš„åœ°å€ç </span><br></pre></td></tr></table></figure><p><code>char ADDR = 0x4E;    // PCF8574T  æ¨¡å—çš„åœ°å€ç  //char ADDR = 0x7e;    // PCF8574AT  æ¨¡å—çš„åœ°å€ç </code></p><h4 id="æ¥çº¿æ–¹å¼"><a href="#æ¥çº¿æ–¹å¼" class="headerlink" title="æ¥çº¿æ–¹å¼"></a>æ¥çº¿æ–¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">STC15W408AS----- LCD1602</span><br><span class="line">P1.0--------SCL</span><br><span class="line">P1.1--------SDA</span><br><span class="line">VCC--------VCC(å¦‚æœæ˜¯3.3Vä¾›ç”µéœ€è¦æŠŠäº®åº¦è°ƒè‡³åˆ°æœ€å¤§ï¼Œå¦‚æœæ˜¯5Vä¾›ç”µä¸éœ€è¦è°ƒè‡³åˆ°æœ€äº®)ï¼Œå³å¯çœ‹æ¸…æ˜¾ç¤ºå†…å®¹</span><br><span class="line">GND------GND</span><br></pre></td></tr></table></figure><p><code>STC15W408AS----- LCD1602 P1.0--------SCL P1.1--------SDA VCC--------VCC(å¦‚æœæ˜¯3.3Vä¾›ç”µéœ€è¦æŠŠäº®åº¦è°ƒè‡³åˆ°æœ€å¤§ï¼Œå¦‚æœæ˜¯5Vä¾›ç”µä¸éœ€è¦è°ƒè‡³åˆ°æœ€äº®)ï¼Œå³å¯çœ‹æ¸…æ˜¾ç¤ºå†…å®¹ GND------GND</code></p><h4 id="é©±åŠ¨ä»£ç "><a href="#é©±åŠ¨ä»£ç " class="headerlink" title="é©±åŠ¨ä»£ç "></a>é©±åŠ¨ä»£ç </h4><p>é©±åŠ¨ä»£ç å’Œé©±åŠ¨STC15W408ASç›¸åŒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &quot;intrins.h&quot;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//#define   L1                0x80            // ç¬¬ä¸€è¡Œå†™å…¥åœ°å€</span><br><span class="line">//#define   L2                0xc0            // ç¬¬äºŒè¡Œå†™å…¥åœ°å€</span><br><span class="line"></span><br><span class="line">sbit SCL = P1^0;</span><br><span class="line">sbit SDA = P1^1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">char ADDR = 0x4E;    // PCF8574  T  æ¨¡å—çš„åœ°å€ç </span><br><span class="line">//char ADDR = 0x7e;    // PCF8574   AT  æ¨¡å—çš„åœ°å€ç </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//***************************** å»¶æ—¶æ¯«ç§’å‡½æ•°***********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void delay1(int y)   //</span><br><span class="line">&#123;</span><br><span class="line">    while(y--)</span><br><span class="line">    &#123;</span><br><span class="line">        unsigned char a,b,c;</span><br><span class="line">        for(c=1; c&gt;0; c--)</span><br><span class="line">            for(b=142; b&gt;0; b--)</span><br><span class="line">                for(a=2; a&gt;0; a--);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//******************************** IIC ä¸²å£å¼€å§‹ ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void IIC_start(void)</span><br><span class="line">&#123;</span><br><span class="line">    SDA=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SDA=0;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//********************************** IIC ä¸²å£å†™1ä¸ªå­—èŠ‚ ******************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void IIC_writeByte(char temp)</span><br><span class="line">&#123;</span><br><span class="line">    char i;</span><br><span class="line">    for(i=0; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        SDA=(bit)(temp &amp; 0x80) ;   // æ ¹æ®è§„å®š1602çš„æ•°æ®æœ€é«˜ä½å¿…é¡»ä¸º  1</span><br><span class="line">        temp &lt;&lt;=1;</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        SCL=1;</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        SCL=0;</span><br><span class="line">    &#125;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SDA=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    while(SDA);</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//******************************** 1602å†™å‘½ä»¤ ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void LCD_write_command(char comm)</span><br><span class="line">&#123;</span><br><span class="line">    char tmp;</span><br><span class="line">    IIC_start();          // ä¸²å£å¼€å§‹</span><br><span class="line">    IIC_writeByte(ADDR);  // å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</span><br><span class="line"></span><br><span class="line">    tmp = comm &amp; 0xF0;    // ä¸0xf0 åº”è¯¥æ˜¯å–ç¬¬å››ä½çš„æ„æ€å§</span><br><span class="line">    tmp |= 0x0C;         //ä¿ç•™é«˜4ä½ä¸ºæŒ‡ä»¤çš„é«˜å››ä½ï¼Œä½å››ä½ä¸º   RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);  //ä»ä¸²å£é€å‡º</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB;        //Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line"></span><br><span class="line">    tmp = (comm &amp; 0x0F) &lt;&lt; 4 ;  //å°†æŒ‡ä»¤çš„ä½å››ä½ é€åˆ°é«˜ä½ç½®ä¿å­˜</span><br><span class="line">    tmp |= 0x0C;        //RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB; // Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//******************************** 1602å†™æ•°æ® ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void LCD_write_data(char data1)</span><br><span class="line">&#123;</span><br><span class="line">    char tmp;</span><br><span class="line">    IIC_start();</span><br><span class="line">    IIC_writeByte(ADDR);   // å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</span><br><span class="line"></span><br><span class="line">    tmp = data1 &amp; 0xF0;</span><br><span class="line">    tmp |= 0x0D; //RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB; //Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line"></span><br><span class="line">    tmp = (data1 &amp; 0x0F) &lt;&lt; 4 ;</span><br><span class="line">    tmp |= 0x0D; //RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB ; // Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//******************************** 1602åˆå§‹åŒ– ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void Init_Lcd(void)</span><br><span class="line">&#123;</span><br><span class="line">    LCD_write_command(0x33); //å°†8ä½æ€»çº¿è½¬ä¸º4ä½æ€»çº¿</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x32); //</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x28); // 4ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5*7ç‚¹é˜µå­—ç¬¦  ï¼å¦‚æœæ˜¯0x38  åˆ™ä¸º8ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5*7ç‚¹é˜µå­—ç¬¦</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x0C); // å¼€æ˜¾ç¤ºï¼Œå…³é—­å…‰æ ‡ï¼Œä¸é—ªçƒ</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x06); // è®¾å®šè¾“å…¥æ–¹å¼ï¼Œå¢é‡ä¸ä½ç§»</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x01); // æ¸…å±</span><br><span class="line">    delay1(50) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//*************************************** åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸² *************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void Write_LCD(int x, int y, char *str)</span><br><span class="line">&#123;</span><br><span class="line">    char addr;</span><br><span class="line">    if( x &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        x = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if(x &gt; 15)</span><br><span class="line">    &#123;</span><br><span class="line">        x = 15;</span><br><span class="line">    &#125;</span><br><span class="line">    if(y&lt;0)</span><br><span class="line">    &#123;</span><br><span class="line">        y = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if(y &gt; 1)</span><br><span class="line">    &#123;</span><br><span class="line">        y = 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addr = 0x80 + 0x40 * y + x;   // Move cursor  ç§»åŠ¨å…‰æ ‡</span><br><span class="line">    LCD_write_command(addr);</span><br><span class="line">    while (*str)</span><br><span class="line">    &#123;</span><br><span class="line">        LCD_write_data(*str++);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//-------------------------------------------- æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•° ----------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void LCD_write_word(unsigned char *s) //æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">    while(*s&gt;0)</span><br><span class="line">    &#123;</span><br><span class="line">        LCD_write_data(*s);</span><br><span class="line">        s++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//********************************* æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦*******************************************</span><br><span class="line">/*</span><br><span class="line">void Print_Char (unsigned char line,unsigned char num,unsigned char date)</span><br><span class="line">&#123;</span><br><span class="line">                LCD_write_command(line+num);</span><br><span class="line">                LCD_write_data(date);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">//æŒ‰æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦(é’ˆå¯¹1602æ¶²æ™¶)-ç”¨åœ¨æ¸©åº¦æ˜¾ç¤º</span><br><span class="line">void DisplayOneChar(unsigned char X, unsigned char Y, unsigned char DData)</span><br><span class="line">&#123;</span><br><span class="line">    Y &amp;= 0x1;</span><br><span class="line">    X &amp;= 0xF;                 //é™åˆ¶Xä¸èƒ½å¤§äº15ï¼ŒYä¸èƒ½å¤§äº1</span><br><span class="line">    if (Y) X |= 0x40;        //å½“è¦æ˜¾ç¤ºç¬¬äºŒè¡Œæ—¶åœ°å€ç +0x40;</span><br><span class="line">    X |= 0x80;               // ç®—å‡ºæŒ‡ä»¤ç </span><br><span class="line">    LCD_write_command(X);    //è¿™é‡Œä¸æ£€æµ‹å¿™ä¿¡å·ï¼Œå‘é€åœ°å€ç </span><br><span class="line">    LCD_write_data(DData);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">    Init_Lcd();</span><br><span class="line">Write_LCD(0, 1, &quot;Hell0 World!&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">    DisplayOneChar(0,0,&#x27;P&#x27;);//åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦</span><br><span class="line">    DisplayOneChar(1,0,&#x27;e&#x27;);</span><br><span class="line">    DisplayOneChar(2,0,&#x27;r&#x27;);</span><br><span class="line">    DisplayOneChar(3,0,&#x27;s&#x27;);</span><br><span class="line">    DisplayOneChar(4,0,&#x27;e&#x27;);</span><br><span class="line">    DisplayOneChar(5,0,&#x27;v&#x27;);</span><br><span class="line">    DisplayOneChar(6,0,&#x27;e&#x27;);</span><br><span class="line">    DisplayOneChar(7,0,&#x27;r&#x27;);</span><br><span class="line">    DisplayOneChar(8,0,&#x27;a&#x27;);</span><br><span class="line">    DisplayOneChar(9,0,&#x27;n&#x27;);</span><br><span class="line">    DisplayOneChar(10,0,&#x27;c&#x27;);</span><br><span class="line">    DisplayOneChar(11,0,&#x27;e&#x27;);</span><br><span class="line">while(1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include â€œintrins.hâ€<br>#define uchar unsigned char<br>#define uint unsigned int</p><p>&#x2F;&#x2F;#define   L1                0x80            &#x2F;&#x2F; ç¬¬ä¸€è¡Œå†™å…¥åœ°å€<br>&#x2F;&#x2F;#define   L2                0xc0            &#x2F;&#x2F; ç¬¬äºŒè¡Œå†™å…¥åœ°å€</p><p>sbit SCL &#x3D; P1^0;<br>sbit SDA &#x3D; P1^1;</p><p>char ADDR &#x3D; 0x4E;    &#x2F;&#x2F; PCF8574  T  æ¨¡å—çš„åœ°å€ç <br>&#x2F;&#x2F;char ADDR &#x3D; 0x7e;    &#x2F;&#x2F; PCF8574   AT  æ¨¡å—çš„åœ°å€ç </p><p>&#x2F;&#x2F;***************************** å»¶æ—¶æ¯«ç§’å‡½æ•°***********************************************</p><p>void delay1(int y)   &#x2F;&#x2F;<br>{<br>    while(yâ€“)<br>    {<br>        unsigned char a,b,c;<br>        for(c&#x3D;1; c&gt;0; câ€“)<br>            for(b&#x3D;142; b&gt;0; bâ€“)<br>                for(a&#x3D;2; a&gt;0; aâ€“);<br>    }<br>}</p><p>&#x2F;&#x2F;******************************** IIC ä¸²å£å¼€å§‹ ********************************************</p><p>void IIC_start(void)<br>{<br>    SDA&#x3D;1;<br>    <em>nop</em>();<br>    SCL&#x3D;1;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SDA&#x3D;0;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SCL&#x3D;0;<br>}</p><p>&#x2F;&#x2F;********************************** IIC ä¸²å£å†™1ä¸ªå­—èŠ‚ ******************************************</p><p>void IIC_writeByte(char temp)<br>{<br>    char i;<br>    for(i&#x3D;0; i&lt;8; i++)<br>    {<br>        SDA&#x3D;(bit)(temp &amp; 0x80) ;   &#x2F;&#x2F; æ ¹æ®è§„å®š1602çš„æ•°æ®æœ€é«˜ä½å¿…é¡»ä¸º  1<br>        temp &lt;&lt;&#x3D;1;<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        SCL&#x3D;1;<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        SCL&#x3D;0;<br>    }<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SDA&#x3D;1;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SCL&#x3D;1;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    while(SDA);<br>    <em>nop</em>();<br>    SCL&#x3D;0;<br>}</p><p>&#x2F;&#x2F;******************************** 1602å†™å‘½ä»¤ ********************************************</p><p>void LCD_write_command(char comm)<br>{<br>    char tmp;<br>    IIC_start();          &#x2F;&#x2F; ä¸²å£å¼€å§‹<br>    IIC_writeByte(ADDR);  &#x2F;&#x2F; å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</p><pre><code>tmp = comm &amp; 0xF0;    // ä¸0xf0 åº”è¯¥æ˜¯å–ç¬¬å››ä½çš„æ„æ€å§tmp |= 0x0C;         //ä¿ç•™é«˜4ä½ä¸ºæŒ‡ä»¤çš„é«˜å››ä½ï¼Œä½å››ä½ä¸º   RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);  //ä»ä¸²å£é€å‡ºdelay1(20);tmp &amp;= 0xFB;        //Make EN = 0IIC_writeByte(tmp);tmp = (comm &amp; 0x0F) &lt;&lt; 4 ;  //å°†æŒ‡ä»¤çš„ä½å››ä½ é€åˆ°é«˜ä½ç½®ä¿å­˜tmp |= 0x0C;        //RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);delay1(20);tmp &amp;= 0xFB; // Make EN = 0IIC_writeByte(tmp);</code></pre><p>}<br>&#x2F;&#x2F;******************************** 1602å†™æ•°æ® ********************************************</p><p>void LCD_write_data(char data1)<br>{<br>    char tmp;<br>    IIC_start();<br>    IIC_writeByte(ADDR);   &#x2F;&#x2F; å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</p><pre><code>tmp = data1 &amp; 0xF0;tmp |= 0x0D; //RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);delay1(20);tmp &amp;= 0xFB; //Make EN = 0IIC_writeByte(tmp);tmp = (data1 &amp; 0x0F) &lt;&lt; 4 ;tmp |= 0x0D; //RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);delay1(20);tmp &amp;= 0xFB ; // Make EN = 0IIC_writeByte(tmp);</code></pre><p>}</p><p>&#x2F;&#x2F;******************************** 1602åˆå§‹åŒ– ********************************************</p><p>void Init_Lcd(void)<br>{<br>    LCD_write_command(0x33); &#x2F;&#x2F;å°†8ä½æ€»çº¿è½¬ä¸º4ä½æ€»çº¿<br>    delay1(50) ;<br>    LCD_write_command(0x32); &#x2F;&#x2F;<br>    delay1(50) ;<br>    LCD_write_command(0x28); &#x2F;&#x2F; 4ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5<em>7ç‚¹é˜µå­—ç¬¦  ï¼å¦‚æœæ˜¯0x38  åˆ™ä¸º8ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5</em>7ç‚¹é˜µå­—ç¬¦<br>    delay1(50) ;<br>    LCD_write_command(0x0C); &#x2F;&#x2F; å¼€æ˜¾ç¤ºï¼Œå…³é—­å…‰æ ‡ï¼Œä¸é—ªçƒ<br>    delay1(50) ;<br>    LCD_write_command(0x06); &#x2F;&#x2F; è®¾å®šè¾“å…¥æ–¹å¼ï¼Œå¢é‡ä¸ä½ç§»<br>    delay1(50) ;<br>    LCD_write_command(0x01); &#x2F;&#x2F; æ¸…å±<br>    delay1(50) ;<br>}</p><p>&#x2F;&#x2F;*************************************** åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸² *************************************</p><p>void Write_LCD(int x, int y, char *str)<br>{<br>    char addr;<br>    if( x &lt; 0)<br>    {<br>        x &#x3D; 0;<br>    }<br>    if(x &gt; 15)<br>    {<br>        x &#x3D; 15;<br>    }<br>    if(y&lt;0)<br>    {<br>        y &#x3D; 0;<br>    }<br>    if(y &gt; 1)<br>    {<br>        y &#x3D; 1;<br>    }</p><pre><code>addr = 0x80 + 0x40 * y + x;   // Move cursor  ç§»åŠ¨å…‰æ ‡LCD_write_command(addr);while (*str)&#123;    LCD_write_data(*str++);&#125;</code></pre><p>}</p><p>&#x2F;&#x2F;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•° â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p><p>void LCD_write_word(unsigned char *s) &#x2F;&#x2F;æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•°<br>{<br>    while(*s&gt;0)<br>    {<br>        LCD_write_data(*s);<br>        s++;<br>    }<br>}</p><p>&#x2F;&#x2F;********************************* æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦*******************************************<br>&#x2F;*<br>void Print_Char (unsigned char line,unsigned char num,unsigned char date)<br>{<br>                LCD_write_command(line+num);<br>                LCD_write_data(date);<br>}</p><p>*&#x2F;</p><p>&#x2F;&#x2F;æŒ‰æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦(é’ˆå¯¹1602æ¶²æ™¶)-ç”¨åœ¨æ¸©åº¦æ˜¾ç¤º<br>void DisplayOneChar(unsigned char X, unsigned char Y, unsigned char DData)<br>{<br>    Y &amp;&#x3D; 0x1;<br>    X &amp;&#x3D; 0xF;                 &#x2F;&#x2F;é™åˆ¶Xä¸èƒ½å¤§äº15ï¼ŒYä¸èƒ½å¤§äº1<br>    if (Y) X |&#x3D; 0x40;        &#x2F;&#x2F;å½“è¦æ˜¾ç¤ºç¬¬äºŒè¡Œæ—¶åœ°å€ç +0x40;<br>    X |&#x3D; 0x80;               &#x2F;&#x2F; ç®—å‡ºæŒ‡ä»¤ç <br>    LCD_write_command(X);    &#x2F;&#x2F;è¿™é‡Œä¸æ£€æµ‹å¿™ä¿¡å·ï¼Œå‘é€åœ°å€ç <br>    LCD_write_data(DData);<br>}</p><p>void main() {<br>    Init_Lcd();<br>    Write_LCD(0, 1, â€œHell0 World!â€);&#x2F;&#x2F;åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²<br>    DisplayOneChar(0,0,â€™Pâ€™);&#x2F;&#x2F;åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦<br>    DisplayOneChar(1,0,â€™eâ€™);<br>    DisplayOneChar(2,0,â€™râ€™);<br>    DisplayOneChar(3,0,â€™sâ€™);<br>    DisplayOneChar(4,0,â€™eâ€™);<br>    DisplayOneChar(5,0,â€™vâ€™);<br>    DisplayOneChar(6,0,â€™eâ€™);<br>    DisplayOneChar(7,0,â€™râ€™);<br>    DisplayOneChar(8,0,â€™aâ€™);<br>    DisplayOneChar(9,0,â€™nâ€™);<br>    DisplayOneChar(10,0,â€™câ€™);<br>    DisplayOneChar(11,0,â€™eâ€™);<br>                while(1);<br>}&#96;</p><h4 id="ç¨‹åºæºç "><a href="#ç¨‹åºæºç " class="headerlink" title="ç¨‹åºæºç "></a>ç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1HVlULFfyv5-evyozXqWS6A </span><br><span class="line">æå–ç ï¼š149w</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1HVlULFfyv5-evyozXqWS6A  æå–ç ï¼š149w</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC15W408AS+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º</title>
      <link href="/2024/03/Stc15-STC15W408AS-LCD1602%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E5%B1%8F%E5%B9%95%E9%A9%B1%E5%8A%A8%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Stc15-STC15W408AS-LCD1602%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E5%B1%8F%E5%B9%95%E9%A9%B1%E5%8A%A8%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC15W408AS-LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º"><a href="#STC15W408AS-LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º" class="headerlink" title="STC15W408AS+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º"></a>STC15W408AS+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º</h1><h3 id="STC15W408AS-LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º-1"><a href="#STC15W408AS-LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º-1" class="headerlink" title="STC15W408AS+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º"></a>STC15W408AS+ LCD1602è½¬IICæ¥å£å±å¹•é©±åŠ¨æ˜¾ç¤º</h3><ul><li>æ¶²æ™¶å±èµ„æ–™</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Gkcpa_sG0M12yK2233GYfQ </span><br><span class="line">æå–ç ï¼š7cz7</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Gkcpa_sG0M12yK2233GYfQ  æå–ç ï¼š7cz7</code></p><ul><li>LCD1602è½¬IICè½¬æ¥æ¿é©±åŠ¨æ˜¾ç¤ºæ­£é¢</li><li>æ˜¾ç¤ºæ•ˆæœ</li></ul><p><img src="https://img-blog.csdnimg.cn/a77e0cc1911f4211b477ebf463d451c6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/b8817f9b3fcb4084aa9b28c92ae89265.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>LCD1602è½¬IICè½¬æ¥æ¿é©±åŠ¨æ¨¡å—åé¢</li></ul><p><img src="https://img-blog.csdnimg.cn/80fe86cb100741028b4a47d5cb8eb9c7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/2dff11700d02468d96424dc7b8d359e4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><ul><li>LCD1602è½¬IICæ¥å£èŠ¯ç‰‡é‡‡ç”¨çš„é©±åŠ¨èŠ¯ç‰‡å‹å·ä¸ä¸€æ ·ï¼Œå…¶åœ°å€ä¸ç›¸åŒã€‚</li></ul><p>çœ‹æ¸…æ¥šèƒŒé¢è½¬æ¥æ¿ä¸Šé¢èŠ¯ç‰‡å‹å·ï¼Œæˆ‘çš„æ˜¯å¸¦Tçš„PCF8574T</p><p><code>PCF8574T</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">char ADDR = 0x4E;    // PCF8574T  æ¨¡å—çš„åœ°å€ç </span><br><span class="line">//char ADDR = 0x7e;    // PCF8574AT  æ¨¡å—çš„åœ°å€ç </span><br></pre></td></tr></table></figure><p><code>char ADDR = 0x4E;    // PCF8574T  æ¨¡å—çš„åœ°å€ç  //char ADDR = 0x7e;    // PCF8574AT  æ¨¡å—çš„åœ°å€ç </code></p><h4 id="æ¥çº¿æ–¹å¼"><a href="#æ¥çº¿æ–¹å¼" class="headerlink" title="æ¥çº¿æ–¹å¼"></a>æ¥çº¿æ–¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">STC15W408AS----- LCD1602</span><br><span class="line">P1.0--------SCL</span><br><span class="line">P1.1--------SDA</span><br><span class="line">VCC--------VCC(å¦‚æœæ˜¯3.3Vä¾›ç”µéœ€è¦æŠŠäº®åº¦è°ƒè‡³åˆ°æœ€å¤§ï¼Œå¦‚æœæ˜¯5Vä¾›ç”µä¸éœ€è¦è°ƒè‡³åˆ°æœ€äº®)</span><br><span class="line">GND------GND</span><br></pre></td></tr></table></figure><p><code>STC15W408AS----- LCD1602 P1.0--------SCL P1.1--------SDA VCC--------VCC(å¦‚æœæ˜¯3.3Vä¾›ç”µéœ€è¦æŠŠäº®åº¦è°ƒè‡³åˆ°æœ€å¤§ï¼Œå¦‚æœæ˜¯5Vä¾›ç”µä¸éœ€è¦è°ƒè‡³åˆ°æœ€äº®) GND------GND</code></p><h4 id="é©±åŠ¨ä»£ç "><a href="#é©±åŠ¨ä»£ç " class="headerlink" title="é©±åŠ¨ä»£ç "></a>é©±åŠ¨ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &quot;intrins.h&quot;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//#define   L1                0x80            // ç¬¬ä¸€è¡Œå†™å…¥åœ°å€</span><br><span class="line">//#define   L2                0xc0            // ç¬¬äºŒè¡Œå†™å…¥åœ°å€</span><br><span class="line"></span><br><span class="line">sbit SCL = P1^0;</span><br><span class="line">sbit SDA = P1^1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">char ADDR = 0x4E;    // PCF8574  T  æ¨¡å—çš„åœ°å€ç </span><br><span class="line">//char ADDR = 0x7e;    // PCF8574   AT  æ¨¡å—çš„åœ°å€ç </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//***************************** å»¶æ—¶æ¯«ç§’å‡½æ•°***********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void delay1(int y)   //</span><br><span class="line">&#123;</span><br><span class="line">    while(y--)</span><br><span class="line">    &#123;</span><br><span class="line">        unsigned char a,b,c;</span><br><span class="line">        for(c=1; c&gt;0; c--)</span><br><span class="line">            for(b=142; b&gt;0; b--)</span><br><span class="line">                for(a=2; a&gt;0; a--);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//******************************** IIC ä¸²å£å¼€å§‹ ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void IIC_start(void)</span><br><span class="line">&#123;</span><br><span class="line">    SDA=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SDA=0;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//********************************** IIC ä¸²å£å†™1ä¸ªå­—èŠ‚ ******************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void IIC_writeByte(char temp)</span><br><span class="line">&#123;</span><br><span class="line">    char i;</span><br><span class="line">    for(i=0; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        SDA=(bit)(temp &amp; 0x80) ;   // æ ¹æ®è§„å®š1602çš„æ•°æ®æœ€é«˜ä½å¿…é¡»ä¸º  1</span><br><span class="line">        temp &lt;&lt;=1;</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        SCL=1;</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        _nop_();</span><br><span class="line">        SCL=0;</span><br><span class="line">    &#125;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SDA=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=1;</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    while(SDA);</span><br><span class="line">    _nop_();</span><br><span class="line">    SCL=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//******************************** 1602å†™å‘½ä»¤ ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void LCD_write_command(char comm)</span><br><span class="line">&#123;</span><br><span class="line">    char tmp;</span><br><span class="line">    IIC_start();          // ä¸²å£å¼€å§‹</span><br><span class="line">    IIC_writeByte(ADDR);  // å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</span><br><span class="line"></span><br><span class="line">    tmp = comm &amp; 0xF0;    // ä¸0xf0 åº”è¯¥æ˜¯å–ç¬¬å››ä½çš„æ„æ€å§</span><br><span class="line">    tmp |= 0x0C;         //ä¿ç•™é«˜4ä½ä¸ºæŒ‡ä»¤çš„é«˜å››ä½ï¼Œä½å››ä½ä¸º   RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);  //ä»ä¸²å£é€å‡º</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB;        //Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line"></span><br><span class="line">    tmp = (comm &amp; 0x0F) &lt;&lt; 4 ;  //å°†æŒ‡ä»¤çš„ä½å››ä½ é€åˆ°é«˜ä½ç½®ä¿å­˜</span><br><span class="line">    tmp |= 0x0C;        //RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB; // Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//******************************** 1602å†™æ•°æ® ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void LCD_write_data(char data1)</span><br><span class="line">&#123;</span><br><span class="line">    char tmp;</span><br><span class="line">    IIC_start();</span><br><span class="line">    IIC_writeByte(ADDR);   // å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</span><br><span class="line"></span><br><span class="line">    tmp = data1 &amp; 0xF0;</span><br><span class="line">    tmp |= 0x0D; //RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB; //Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line"></span><br><span class="line">    tmp = (data1 &amp; 0x0F) &lt;&lt; 4 ;</span><br><span class="line">    tmp |= 0x0D; //RS = 0, RW = 0, EN = 1</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">    delay1(20);</span><br><span class="line">    tmp &amp;= 0xFB ; // Make EN = 0</span><br><span class="line">    IIC_writeByte(tmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//******************************** 1602åˆå§‹åŒ– ********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void Init_Lcd(void)</span><br><span class="line">&#123;</span><br><span class="line">    LCD_write_command(0x33); //å°†8ä½æ€»çº¿è½¬ä¸º4ä½æ€»çº¿</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x32); //</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x28); // 4ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5*7ç‚¹é˜µå­—ç¬¦  ï¼å¦‚æœæ˜¯0x38  åˆ™ä¸º8ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5*7ç‚¹é˜µå­—ç¬¦</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x0C); // å¼€æ˜¾ç¤ºï¼Œå…³é—­å…‰æ ‡ï¼Œä¸é—ªçƒ</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x06); // è®¾å®šè¾“å…¥æ–¹å¼ï¼Œå¢é‡ä¸ä½ç§»</span><br><span class="line">    delay1(50) ;</span><br><span class="line">    LCD_write_command(0x01); // æ¸…å±</span><br><span class="line">    delay1(50) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//*************************************** åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸² *************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void Write_LCD(int x, int y, char *str)</span><br><span class="line">&#123;</span><br><span class="line">    char addr;</span><br><span class="line">    if( x &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        x = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if(x &gt; 15)</span><br><span class="line">    &#123;</span><br><span class="line">        x = 15;</span><br><span class="line">    &#125;</span><br><span class="line">    if(y&lt;0)</span><br><span class="line">    &#123;</span><br><span class="line">        y = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if(y &gt; 1)</span><br><span class="line">    &#123;</span><br><span class="line">        y = 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addr = 0x80 + 0x40 * y + x;   // Move cursor  ç§»åŠ¨å…‰æ ‡</span><br><span class="line">    LCD_write_command(addr);</span><br><span class="line">    while (*str)</span><br><span class="line">    &#123;</span><br><span class="line">        LCD_write_data(*str++);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//-------------------------------------------- æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•° ----------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void LCD_write_word(unsigned char *s) //æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">    while(*s&gt;0)</span><br><span class="line">    &#123;</span><br><span class="line">        LCD_write_data(*s);</span><br><span class="line">        s++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//********************************* æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦*******************************************</span><br><span class="line">/*</span><br><span class="line">void Print_Char (unsigned char line,unsigned char num,unsigned char date)</span><br><span class="line">&#123;</span><br><span class="line">                LCD_write_command(line+num);</span><br><span class="line">                LCD_write_data(date);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">//æŒ‰æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦(é’ˆå¯¹1602æ¶²æ™¶)-ç”¨åœ¨æ¸©åº¦æ˜¾ç¤º</span><br><span class="line">void DisplayOneChar(unsigned char X, unsigned char Y, unsigned char DData)</span><br><span class="line">&#123;</span><br><span class="line">    Y &amp;= 0x1;</span><br><span class="line">    X &amp;= 0xF;                 //é™åˆ¶Xä¸èƒ½å¤§äº15ï¼ŒYä¸èƒ½å¤§äº1</span><br><span class="line">    if (Y) X |= 0x40;        //å½“è¦æ˜¾ç¤ºç¬¬äºŒè¡Œæ—¶åœ°å€ç +0x40;</span><br><span class="line">    X |= 0x80;               // ç®—å‡ºæŒ‡ä»¤ç </span><br><span class="line">    LCD_write_command(X);    //è¿™é‡Œä¸æ£€æµ‹å¿™ä¿¡å·ï¼Œå‘é€åœ°å€ç </span><br><span class="line">    LCD_write_data(DData);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">    Init_Lcd();</span><br><span class="line">Write_LCD(0, 1, &quot;Hell0 World!&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">    DisplayOneChar(0,0,&#x27;P&#x27;);//åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦</span><br><span class="line">    DisplayOneChar(1,0,&#x27;e&#x27;);</span><br><span class="line">    DisplayOneChar(2,0,&#x27;r&#x27;);</span><br><span class="line">    DisplayOneChar(3,0,&#x27;s&#x27;);</span><br><span class="line">    DisplayOneChar(4,0,&#x27;e&#x27;);</span><br><span class="line">    DisplayOneChar(5,0,&#x27;v&#x27;);</span><br><span class="line">    DisplayOneChar(6,0,&#x27;e&#x27;);</span><br><span class="line">    DisplayOneChar(7,0,&#x27;r&#x27;);</span><br><span class="line">    DisplayOneChar(8,0,&#x27;a&#x27;);</span><br><span class="line">    DisplayOneChar(9,0,&#x27;n&#x27;);</span><br><span class="line">    DisplayOneChar(10,0,&#x27;c&#x27;);</span><br><span class="line">    DisplayOneChar(11,0,&#x27;e&#x27;);</span><br><span class="line">while(1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include â€œintrins.hâ€<br>#define uchar unsigned char<br>#define uint unsigned int</p><p>&#x2F;&#x2F;#define   L1                0x80            &#x2F;&#x2F; ç¬¬ä¸€è¡Œå†™å…¥åœ°å€<br>&#x2F;&#x2F;#define   L2                0xc0            &#x2F;&#x2F; ç¬¬äºŒè¡Œå†™å…¥åœ°å€</p><p>sbit SCL &#x3D; P1^0;<br>sbit SDA &#x3D; P1^1;</p><p>char ADDR &#x3D; 0x4E;    &#x2F;&#x2F; PCF8574  T  æ¨¡å—çš„åœ°å€ç <br>&#x2F;&#x2F;char ADDR &#x3D; 0x7e;    &#x2F;&#x2F; PCF8574   AT  æ¨¡å—çš„åœ°å€ç </p><p>&#x2F;&#x2F;***************************** å»¶æ—¶æ¯«ç§’å‡½æ•°***********************************************</p><p>void delay1(int y)   &#x2F;&#x2F;<br>{<br>    while(yâ€“)<br>    {<br>        unsigned char a,b,c;<br>        for(c&#x3D;1; c&gt;0; câ€“)<br>            for(b&#x3D;142; b&gt;0; bâ€“)<br>                for(a&#x3D;2; a&gt;0; aâ€“);<br>    }<br>}</p><p>&#x2F;&#x2F;******************************** IIC ä¸²å£å¼€å§‹ ********************************************</p><p>void IIC_start(void)<br>{<br>    SDA&#x3D;1;<br>    <em>nop</em>();<br>    SCL&#x3D;1;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SDA&#x3D;0;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SCL&#x3D;0;<br>}</p><p>&#x2F;&#x2F;********************************** IIC ä¸²å£å†™1ä¸ªå­—èŠ‚ ******************************************</p><p>void IIC_writeByte(char temp)<br>{<br>    char i;<br>    for(i&#x3D;0; i&lt;8; i++)<br>    {<br>        SDA&#x3D;(bit)(temp &amp; 0x80) ;   &#x2F;&#x2F; æ ¹æ®è§„å®š1602çš„æ•°æ®æœ€é«˜ä½å¿…é¡»ä¸º  1<br>        temp &lt;&lt;&#x3D;1;<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        SCL&#x3D;1;<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        <em>nop</em>();<br>        SCL&#x3D;0;<br>    }<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SDA&#x3D;1;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    SCL&#x3D;1;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    while(SDA);<br>    <em>nop</em>();<br>    SCL&#x3D;0;<br>}</p><p>&#x2F;&#x2F;******************************** 1602å†™å‘½ä»¤ ********************************************</p><p>void LCD_write_command(char comm)<br>{<br>    char tmp;<br>    IIC_start();          &#x2F;&#x2F; ä¸²å£å¼€å§‹<br>    IIC_writeByte(ADDR);  &#x2F;&#x2F; å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</p><pre><code>tmp = comm &amp; 0xF0;    // ä¸0xf0 åº”è¯¥æ˜¯å–ç¬¬å››ä½çš„æ„æ€å§tmp |= 0x0C;         //ä¿ç•™é«˜4ä½ä¸ºæŒ‡ä»¤çš„é«˜å››ä½ï¼Œä½å››ä½ä¸º   RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);  //ä»ä¸²å£é€å‡ºdelay1(20);tmp &amp;= 0xFB;        //Make EN = 0IIC_writeByte(tmp);tmp = (comm &amp; 0x0F) &lt;&lt; 4 ;  //å°†æŒ‡ä»¤çš„ä½å››ä½ é€åˆ°é«˜ä½ç½®ä¿å­˜tmp |= 0x0C;        //RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);delay1(20);tmp &amp;= 0xFB; // Make EN = 0IIC_writeByte(tmp);</code></pre><p>}<br>&#x2F;&#x2F;******************************** 1602å†™æ•°æ® ********************************************</p><p>void LCD_write_data(char data1)<br>{<br>    char tmp;<br>    IIC_start();<br>    IIC_writeByte(ADDR);   &#x2F;&#x2F; å…ˆé€‰PCF 8574T çš„åœ°å€  ï¼ˆåº”è¯¥æ˜¯ç›¸å½“äºé€‰ä¸­çš„æ„æ€å§ï¼‰</p><pre><code>tmp = data1 &amp; 0xF0;tmp |= 0x0D; //RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);delay1(20);tmp &amp;= 0xFB; //Make EN = 0IIC_writeByte(tmp);tmp = (data1 &amp; 0x0F) &lt;&lt; 4 ;tmp |= 0x0D; //RS = 0, RW = 0, EN = 1IIC_writeByte(tmp);delay1(20);tmp &amp;= 0xFB ; // Make EN = 0IIC_writeByte(tmp);</code></pre><p>}</p><p>&#x2F;&#x2F;******************************** 1602åˆå§‹åŒ– ********************************************</p><p>void Init_Lcd(void)<br>{<br>    LCD_write_command(0x33); &#x2F;&#x2F;å°†8ä½æ€»çº¿è½¬ä¸º4ä½æ€»çº¿<br>    delay1(50) ;<br>    LCD_write_command(0x32); &#x2F;&#x2F;<br>    delay1(50) ;<br>    LCD_write_command(0x28); &#x2F;&#x2F; 4ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5<em>7ç‚¹é˜µå­—ç¬¦  ï¼å¦‚æœæ˜¯0x38  åˆ™ä¸º8ä½æ•°æ®çº¿ï¼Œæ˜¾ç¤º2è¡Œï¼Œ5</em>7ç‚¹é˜µå­—ç¬¦<br>    delay1(50) ;<br>    LCD_write_command(0x0C); &#x2F;&#x2F; å¼€æ˜¾ç¤ºï¼Œå…³é—­å…‰æ ‡ï¼Œä¸é—ªçƒ<br>    delay1(50) ;<br>    LCD_write_command(0x06); &#x2F;&#x2F; è®¾å®šè¾“å…¥æ–¹å¼ï¼Œå¢é‡ä¸ä½ç§»<br>    delay1(50) ;<br>    LCD_write_command(0x01); &#x2F;&#x2F; æ¸…å±<br>    delay1(50) ;<br>}</p><p>&#x2F;&#x2F;*************************************** åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸² *************************************</p><p>void Write_LCD(int x, int y, char *str)<br>{<br>    char addr;<br>    if( x &lt; 0)<br>    {<br>        x &#x3D; 0;<br>    }<br>    if(x &gt; 15)<br>    {<br>        x &#x3D; 15;<br>    }<br>    if(y&lt;0)<br>    {<br>        y &#x3D; 0;<br>    }<br>    if(y &gt; 1)<br>    {<br>        y &#x3D; 1;<br>    }</p><pre><code>addr = 0x80 + 0x40 * y + x;   // Move cursor  ç§»åŠ¨å…‰æ ‡LCD_write_command(addr);while (*str)&#123;    LCD_write_data(*str++);&#125;</code></pre><p>}</p><p>&#x2F;&#x2F;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•° â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p><p>void LCD_write_word(unsigned char *s) &#x2F;&#x2F;æ˜¾ç¤ºå­—ç¬¦ä¸²çš„å‡½æ•°<br>{<br>    while(*s&gt;0)<br>    {<br>        LCD_write_data(*s);<br>        s++;<br>    }<br>}</p><p>&#x2F;&#x2F;********************************* æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦*******************************************<br>&#x2F;*<br>void Print_Char (unsigned char line,unsigned char num,unsigned char date)<br>{<br>                LCD_write_command(line+num);<br>                LCD_write_data(date);<br>}</p><p>*&#x2F;</p><p>&#x2F;&#x2F;æŒ‰æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦(é’ˆå¯¹1602æ¶²æ™¶)-ç”¨åœ¨æ¸©åº¦æ˜¾ç¤º<br>void DisplayOneChar(unsigned char X, unsigned char Y, unsigned char DData)<br>{<br>    Y &amp;&#x3D; 0x1;<br>    X &amp;&#x3D; 0xF;                 &#x2F;&#x2F;é™åˆ¶Xä¸èƒ½å¤§äº15ï¼ŒYä¸èƒ½å¤§äº1<br>    if (Y) X |&#x3D; 0x40;        &#x2F;&#x2F;å½“è¦æ˜¾ç¤ºç¬¬äºŒè¡Œæ—¶åœ°å€ç +0x40;<br>    X |&#x3D; 0x80;               &#x2F;&#x2F; ç®—å‡ºæŒ‡ä»¤ç <br>    LCD_write_command(X);    &#x2F;&#x2F;è¿™é‡Œä¸æ£€æµ‹å¿™ä¿¡å·ï¼Œå‘é€åœ°å€ç <br>    LCD_write_data(DData);<br>}</p><p>void main() {<br>    Init_Lcd();<br>    Write_LCD(0, 1, â€œHell0 World!â€);&#x2F;&#x2F;åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²<br>    DisplayOneChar(0,0,â€™Pâ€™);&#x2F;&#x2F;åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦<br>    DisplayOneChar(1,0,â€™eâ€™);<br>    DisplayOneChar(2,0,â€™râ€™);<br>    DisplayOneChar(3,0,â€™sâ€™);<br>    DisplayOneChar(4,0,â€™eâ€™);<br>    DisplayOneChar(5,0,â€™vâ€™);<br>    DisplayOneChar(6,0,â€™eâ€™);<br>    DisplayOneChar(7,0,â€™râ€™);<br>    DisplayOneChar(8,0,â€™aâ€™);<br>    DisplayOneChar(9,0,â€™nâ€™);<br>    DisplayOneChar(10,0,â€™câ€™);<br>    DisplayOneChar(11,0,â€™eâ€™);<br>        while(1);<br>}&#96;</p><h4 id="ç¨‹åºæºç "><a href="#ç¨‹åºæºç " class="headerlink" title="ç¨‹åºæºç "></a>ç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1HVlULFfyv5-evyozXqWS6A </span><br><span class="line">æå–ç ï¼š149w</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1HVlULFfyv5-evyozXqWS6A  æå–ç ï¼š149w</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC15W408ASå•ç‰‡æœºé€šè¿‡ADCç«¯å£é‡‡é›†æ¨¡æ‹Ÿé‡å¹¶ä»ä¸²å£æ‰“å°æ•°å€¼</title>
      <link href="/2024/03/Stc15-STC15W408AS%E5%8D%95%E7%89%87%E6%9C%BA%E9%80%9A%E8%BF%87ADC%E7%AB%AF%E5%8F%A3%E9%87%87%E9%9B%86%E6%A8%A1%E6%8B%9F%E9%87%8F%E5%B9%B6%E4%BB%8E%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0%E6%95%B0%E5%80%BC/"/>
      <url>/2024/03/Stc15-STC15W408AS%E5%8D%95%E7%89%87%E6%9C%BA%E9%80%9A%E8%BF%87ADC%E7%AB%AF%E5%8F%A3%E9%87%87%E9%9B%86%E6%A8%A1%E6%8B%9F%E9%87%8F%E5%B9%B6%E4%BB%8E%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0%E6%95%B0%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC15W408ASå•ç‰‡æœºé€šè¿‡ADCç«¯å£é‡‡é›†æ¨¡æ‹Ÿé‡å¹¶ä»ä¸²å£æ‰“å°æ•°å€¼"><a href="#STC15W408ASå•ç‰‡æœºé€šè¿‡ADCç«¯å£é‡‡é›†æ¨¡æ‹Ÿé‡å¹¶ä»ä¸²å£æ‰“å°æ•°å€¼" class="headerlink" title="STC15W408ASå•ç‰‡æœºé€šè¿‡ADCç«¯å£é‡‡é›†æ¨¡æ‹Ÿé‡å¹¶ä»ä¸²å£æ‰“å°æ•°å€¼"></a>STC15W408ASå•ç‰‡æœºé€šè¿‡ADCç«¯å£é‡‡é›†æ¨¡æ‹Ÿé‡å¹¶ä»ä¸²å£æ‰“å°æ•°å€¼</h1><h3 id="STC15W408ASå•ç‰‡æœºé€šè¿‡ADCç«¯å£é‡‡é›†æ¨¡æ‹Ÿé‡å¹¶ä»ä¸²å£æ‰“å°æ•°å€¼-1"><a href="#STC15W408ASå•ç‰‡æœºé€šè¿‡ADCç«¯å£é‡‡é›†æ¨¡æ‹Ÿé‡å¹¶ä»ä¸²å£æ‰“å°æ•°å€¼-1" class="headerlink" title="STC15W408ASå•ç‰‡æœºé€šè¿‡ADCç«¯å£é‡‡é›†æ¨¡æ‹Ÿé‡å¹¶ä»ä¸²å£æ‰“å°æ•°å€¼"></a>STC15W408ASå•ç‰‡æœºé€šè¿‡ADCç«¯å£é‡‡é›†æ¨¡æ‹Ÿé‡å¹¶ä»ä¸²å£æ‰“å°æ•°å€¼</h3><ul><li>ğŸ“º0-1023æ•°æ®é‡‡é›†:</li><li>ğŸ”–STC15W408ASå¼•è„šåŠŸèƒ½å›¾</li><li>ğŸ“‘STC15ç³»åˆ—å•ç‰‡æœºçš„A&#x2F;Dè½¬æ¢å™¨</li><li>A&#x2F;Dè½¬æ¢å™¨çš„ç»“æ„</li></ul><p>ğŸ“º0-1023æ•°æ®é‡‡é›†:</p><p><img src="https://img-blog.csdnimg.cn/bfacce81dbb648c8a93b2cda478bcf0d.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ğŸ”–STC15W408ASå¼•è„šåŠŸèƒ½å›¾</p><p><img src="https://img-blog.csdnimg.cn/69555f71b1bc49c0be28772c185ee0a9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ğŸ“‘STC15ç³»åˆ—å•ç‰‡æœºçš„A&#x2F;Dè½¬æ¢å™¨</p><p><img src="https://img-blog.csdnimg.cn/214a8523fbdc48a9b9218c5288361161.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>A&#x2F;Dè½¬æ¢å™¨çš„ç»“æ„</p><p><img src="https://img-blog.csdnimg.cn/f3062fd3d4da445da42ff8922a428656.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>STC15ç³»åˆ—å•ç‰‡æœºADCç”±å¤šè·¯é€‰æ‹©å¼€å…³ã€æ¯”è¾ƒå™¨ã€é€æ¬¡æ¯”è¾ƒå¯„å­˜å™¨ã€10ä½DACã€è½¬æ¢ç»“æœå¯„å­˜å™¨ï¼ˆADC_RESå’ŒADC_RESLï¼‰ä»¥åŠADC_CONTRæ„æˆã€‚ STC15ç³»åˆ—å•ç‰‡æœºçš„ADCæ˜¯é€æ¬¡æ¯”è¾ƒå‹ADCã€‚é€æ¬¡æ¯”è¾ƒå‹ADCç”±ä¸€ä¸ªæ¯”è¾ƒå™¨å’ŒD&#x2F;Aè½¬æ¢å™¨æ„æˆï¼Œé€šè¿‡é€æ¬¡æ¯”è¾ƒé€»è¾‘ï¼Œä»æœ€é«˜ä½ï¼ˆMSBï¼‰å¼€å§‹ï¼Œé¡ºåºåœ°å¯¹æ¯ä¸€è¾“å…¥ç”µå‹ä¸å†…ç½®D&#x2F;Aè½¬æ¢å™¨è¾“å‡ºè¿›è¡Œæ¯”è¾ƒï¼Œç»è¿‡å¤šæ¬¡æ¯”è¾ƒï¼Œä½¿è½¬æ¢æ‰€å¾—çš„æ•°å­—é‡é€æ¬¡é€¼è¿‘è¾“å…¥æ¨¡æ‹Ÿé‡å¯¹åº”å€¼ã€‚é€æ¬¡æ¯”è¾ƒå‹A&#x2F;Dè½¬æ¢å™¨å…·æœ‰é€Ÿåº¦é«˜ï¼ŒåŠŸè€—ä½ç­‰ä¼˜ç‚¹ã€‚ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡æ¨¡æ‹Ÿå¤šè·¯å¼€å…³ï¼Œå°†é€šè¿‡ADCO<del>7çš„æ¨¡æ‹Ÿé‡è¾“å…¥é€ç»™æ¯”è¾ƒå™¨ã€‚ç”¨æ•° &#x2F;æ¨¡è½¬æ¢å™¨ï¼ˆDACï¼‰è½¬æ¢çš„æ¨¡æ‹Ÿé‡ä¸è¾“å…¥çš„æ¨¡æ‹Ÿé‡é€šè¿‡æ¯”è¾ƒå™¨è¿›è¡Œæ¯”è¾ƒï¼Œå°†æ¯”è¾ƒç»“æœä¿å­˜åˆ°é€æ¬¡æ¯”è¾ƒå¯„å­˜å™¨ï¼Œå¹¶é€šè¿‡é€æ¬¡æ¯”è¾ƒå¯„å­˜å™¨è¾“å‡ºè½¬æ¢ç»“æœã€‚A&#x2F;Dè½¬æ¢ç»“æŸåï¼Œæœ€ç»ˆçš„è½¬æ¢ç»“æœä¿å­˜åˆ°ADCè½¬æ¢ç»“æœå¯„å­˜å™¨ADC_RESå’ŒADC_RESLï¼ŒåŒæ—¶ï¼Œç½®ä½ADCæ§åˆ¶å¯„å­˜å™¨ADC_CONTRä¸­çš„A&#x2F;Dè½¬æ¢ç»“æŸæ ‡å¿—ä½ADC_FLAGï¼Œä»¥ä¾›ç¨‹åºæŸ¥è¯¢æˆ–å‘å‡ºä¸­æ–­ç”³è¯·ã€‚æ¨¡æ‹Ÿé€šé“çš„é€‰æ‹©æ§åˆ¶ç”±ADCæ§åˆ¶å¯„å­˜å™¨ADC_CONTRä¸­çš„CHS2</del>CHSOç¡®å®šã€‚ADCçš„è½¬æ¢é€Ÿåº¦ç”±ADCæ§åˆ¶å¯„å­˜å™¨ä¸­çš„SPEED1å’ŒSPEED0ç¡®å®šã€‚åœ¨ä½¿ç”¨ADCä¹‹å‰ï¼Œåº”å…ˆç»™ADCä¸Šç”µï¼Œä¹Ÿå°±æ˜¯ç½®ä½ADCæ§åˆ¶å¯„å­˜å™¨ä¸­ADC_POWERä½ã€‚</p><ul><li>å½“ADRJ&#x3D;0æ—¶ï¼Œå¦‚æœå–10ä½ç»“æœï¼Œåˆ™æŒ‰ä¸‹é¢å…¬å¼è®¡ç®—ï¼š</li><li>å½“ADRJ&#x3D;0æ—¶ï¼Œå¦‚æœå–8ä½ç»“æœï¼ŒæŒ‰ä¸‹é¢å…¬å¼è®¡ç®—ï¼š</li><li>å½“ADRJ&#x3D;1æ—¶ï¼Œå¦‚æœå–10ä½ç»“æœï¼Œåˆ™æŒ‰ä¸‹é¢å…¬å¼è®¡ç®—ï¼š</li></ul><p><img src="https://img-blog.csdnimg.cn/3af37b5b7bd24af69c11b472235099f9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/38d6c52e05b24ea0a469ca1ea5411b79.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/5c255190f9cc4c25b8bb90a67fd35e18.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¼ä¸­ï¼ŒVinä¸ºæ¨¡æ‹Ÿè¾“å…¥é€šé“è¾“å…¥ç”µå‹ï¼ŒVccä¸ºå•ç‰‡æœºå®é™…å·¥ä½œç”µå‹ï¼Œç”¨å•ç‰‡æœºå·¥ä½œç”µå‹ä½œä¸ºæ¨¡æ‹Ÿå‚è€ƒç”µå‹ã€‚</p><h4 id="ä¸A-Dè½¬æ¢ç›¸å…³çš„å¯„å­˜å™¨"><a href="#ä¸A-Dè½¬æ¢ç›¸å…³çš„å¯„å­˜å™¨" class="headerlink" title="ä¸A&#x2F;Dè½¬æ¢ç›¸å…³çš„å¯„å­˜å™¨"></a>ä¸A&#x2F;Dè½¬æ¢ç›¸å…³çš„å¯„å­˜å™¨</h4><p>ä¸STC15ç³»åˆ—å•ç‰‡æœºA&#x2F;Dè½¬æ¢ç›¸å…³çš„å¯„å­˜å™¨åˆ—äºä¸‹è¡¨æ‰€ç¤º:</p><p><img src="https://img-blog.csdnimg.cn/df7c7a0211ef45cd91198fe25050b582.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ol><li>P1å£æ¨¡æ‹ŸåŠŸèƒ½æ§åˆ¶å¯„å­˜å™¨P1ASF</li></ol><p>STC15ç³»åˆ—å•ç‰‡æœºçš„A&#x2F;Dè½¬æ¢å£åœ¨P1å£ï¼ˆP1.7-P1.0ï¼‰ï¼Œæœ‰8è·¯10ä½é«˜é€ŸA&#x2F;Dè½¬æ¢å™¨ï¼Œé€Ÿåº¦å¯è¾¾åˆ°300KHzï¼ˆ30ä¸‡æ¬¡&#x2F;ç§’ï¼‰ã€‚8è·¯ç”µå‹è¾“å…¥å‹A&#x2F;Dï¼Œå¯åšæ¸©åº¦æ£€æµ‹ã€ç”µæ± ç”µå‹æ£€æµ‹ã€æŒ‰é”®æ‰«æã€é¢‘è°±æ£€æµ‹ç­‰ã€‚ä¸Šç”µå¤ä½åP1å£ä¸ºå¼±ä¸Šæ‹‰å‹&#x2F;Oå£ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è½¯ä»¶è®¾ç½®å°†8è·¯ä¸­çš„ä»»ä½•ä¸€è·¯è®¾ç½®ä¸ºA&#x2F;Dè½¬æ¢ï¼Œä¸éœ€ä½œä¸ºA&#x2F;Dä½¿ç”¨çš„P1å£å¯ç»§ç»­ä½œä¸ºI&#x2F;Oå£ä½¿ç”¨ï¼ˆå»ºè®®åªä½œä¸ºè¾“å…¥ï¼‰ã€‚éœ€ä½œä¸ºA&#x2F;Dä½¿ç”¨çš„å£éœ€å…ˆå°†PlASFç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨ä¸­çš„ç›¸åº”ä½ç½®ä¸ºâ€˜1â€™ï¼Œå°†ç›¸åº”çš„å£è®¾ç½®ä¸ºæ¨¡æ‹ŸåŠŸèƒ½ã€‚PlASFå¯„å­˜å™¨çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><p>P1ASF:P1å£æ¨¡æ‹ŸåŠŸèƒ½æ§åˆ¶å¯„å­˜å™¨ï¼ˆè¯¥å¯„å­˜å™¨æ˜¯åªå†™å¯„å­˜å™¨ï¼Œè¯»æ— æ•ˆï¼‰  2. ADCæ§åˆ¶å¯„å­˜å™¨ADC_CONTR ADC_CONTRå¯„å­˜å™¨çš„æ ¼å¼å¦‚ä¸‹ï¼š ADCCONTR:ADCæ§åˆ¶å¯„å­˜å™¨  å¯¹ADCCONTRå¯„å­˜å™¨è¿›è¡Œæ“ä½œï¼Œå»ºè®®ç›´æ¥ç”¨MOVèµ‹å€¼è¯­å¥ï¼Œä¸è¦ç”¨â€˜ä¸â€™å’Œâ€˜æˆ–â€™è¯­å¥ã€‚ ADC_POWER:ADCç”µæºæ§åˆ¶ä½ã€‚ 0ï¼šå…³é—­ADCç”µæºï¼› 1ï¼šæ‰“å¼€A&#x2F;Dè½¬æ¢å™¨ç”µæº. å»ºè®®è¿›å…¥ç©ºé—²æ¨¡å¼å’Œæ‰ç”µæ¨¡å¼å‰ï¼Œå°†ADCç”µæºå…³é—­ï¼Œå³ADCPOWER&#x3D;0ï¼Œå¯é™ä½åŠŸè€—ã€‚å¯åŠ¨A&#x2F;Dè½¬æ¢å‰ä¸€å®šè¦ç¡®è®¤A&#x2F;Dç”µæºå·²æ‰“å¼€ï¼ŒA&#x2F;Dè½¬æ¢ç»“æŸåå…³é—­A&#x2F;Dç”µæºå¯é™ä½åŠŸè€—ï¼Œä¹Ÿå¯ä¸å…³é—­ã€‚åˆæ¬¡æ‰“å¼€å†…éƒ¨A&#x2F;Dè½¬æ¢æ¨¡æ‹Ÿç”µæºï¼Œéœ€é€‚å½“å»¶æ—¶ï¼Œç­‰å†…éƒ¨æ¨¡æ‹Ÿç”µæºç¨³å®šåï¼Œå†å¯åŠ¨A&#x2F;Dè½¬æ¢ã€‚ å»ºè®®å¯åŠ¨A&#x2F;Dè½¬æ¢åï¼Œåœ¨A&#x2F;Dè½¬æ¢ç»“æŸä¹‹å‰ï¼Œä¸æ”¹å˜ä»»ä½•I&#x2F;0å£çš„çŠ¶æ€ï¼Œæœ‰åˆ©äºé«˜ç²¾åº¦A&#x2F;Dè½¬æ¢ï¼Œå¦‚èƒ½å°†å®šæ—¶å™¨&#x2F;ä¸²è¡Œå£&#x2F;ä¸­æ–­ç³»ç»Ÿå…³é—­æ›´å¥½ã€‚ SPEED1ï¼ŒSPEEDOï¼šæ¨¡æ•°è½¬æ¢å™¨è½¬æ¢é€Ÿåº¦æ§åˆ¶ä½  ADCFLAGï¼šæ¨¡æ•°è½¬æ¢å™¨è½¬æ¢ç»“æŸæ ‡å¿—ä½ï¼Œå½“A&#x2F;Dè½¬æ¢å®Œæˆåï¼ŒADCFLAG&#x3D;1ï¼Œè¦ç”±è½¯ä»¶æ¸…0ã€‚ ä¸ç®¡æ˜¯A&#x2F;Dè½¬æ¢å®Œæˆåç”±è¯¥ä½ç”³è¯·äº§ç”Ÿä¸­æ–­ï¼Œè¿˜æ˜¯ç”±è½¯ä»¶æŸ¥è¯¢è¯¥æ ‡å¿—ä½A&#x2F;Dè½¬æ¢æ˜¯å¦ç»“æŸï¼Œå½“A&#x2F;Dè½¬æ¢å®Œæˆåï¼ŒADC_FLAG&#x3D;1ï¼Œä¸€å®šè¦è½¯ä»¶æ¸…0ã€‚ ADC_STARTï¼šæ¨¡æ•°è½¬æ¢å™¨ï¼ˆADCï¼‰è½¬æ¢å¯åŠ¨æ§åˆ¶ä½ï¼Œè®¾ç½®ä¸ºâ€œ1â€æ—¶ï¼Œå¼€å§‹è½¬æ¢ï¼Œè½¬æ¢ç»“æŸåä¸º0ã€‚ CHS2&#x2F;CHS1&#x2F;CHSOï¼šæ¨¡æ‹Ÿè¾“å…¥é€šé“é€‰æ‹©ï¼ŒCHS2&#x2F;CHS1&#x2F;CHSO  3. ADCè½¬æ¢ç»“æœè°ƒæ•´å¯„å­˜å™¨ä½â€”ADRJ ADCè½¬æ¢ç»“æœè°ƒæ•´å¯„å­˜å™¨ä½ä¸€â€”ADRJä½äºå¯„å­˜å™¨CLK_DIV&#x2F;PCONä¸­ï¼Œç”¨äºæ§åˆ¶ADCè½¬æ¢ç»“æœå­˜æ”¾çš„ä½ç½®ã€‚  ADRJ:ADCè½¬æ¢ç»“æœè°ƒæ•´ 0ï¼šADCRES[7ï¼š01å­˜æ”¾é«˜8ä½ADCç»“æœï¼ŒADCRESL[1ï¼š0]å­˜æ”¾ä½2ä½ADCç»“æœ1ï¼šADC_RES[1ï¼š0]å­˜æ”¾é«˜2ä½ADCç»“æœï¼ŒADC_RESL[7ï¼š0]å­˜æ”¾ä½8ä½ADCç»“æœ 4. A&#x2F;Dè½¬æ¢ç»“æœå¯„å­˜å™¨ADC_RESã€ADC_RESLç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨ADC_RESå’ŒADC_RESLå¯„å­˜å™¨ç”¨äºä¿å­˜A&#x2F;Dè½¬æ¢ç»“æœï¼Œå…¶æ ¼å¼å¦‚ä¸‹ï¼š  CKKO_DIVå¯„å­˜å™¨çš„ADRJä½æ˜¯A&#x2F;Dè½¬æ¢ç»“æœå¯„å­˜å™¨ï¼ˆADC_RESï¼ŒADC_RESLï¼‰çš„æ•°æ®æ ¼å¼è°ƒæ•´æ§åˆ¶ä½. å½“ADRJ&#x3D;0æ—¶ï¼Œ10ä½A&#x2F;Dè½¬æ¢ç»“æœçš„é«˜8ä½å­˜æ”¾åœ¨ADC_RESä¸­ï¼Œä½2ä½å­˜æ”¾åœ¨ADC_RESLçš„ä½2ä½ä¸­ã€‚  æ­¤æ—¶ï¼Œå¦‚æœéœ€å–å®Œæ•´10ä½ç»“æœï¼ŒæŒ‰ä¸‹é¢å…¬å¼è®¡ç®—ï¼š  å¦‚æœç”¨æˆ·åªéœ€å–8ä½ç»“æœï¼ŒæŒ‰ä¸‹é¢å…¬å¼è®¡ç®—ï¼š  å¼ä¸­ï¼ŒVinä¸ºæ¨¡æ‹Ÿè¾“å…¥é€šé“è¾“å…¥ç”µå‹ï¼ŒVccä¸ºå•ç‰‡æœºå®é™…å·¥ä½œç”µå‹ï¼Œç”¨å•ç‰‡æœºå·¥ä½œç”µå‹ä½œä¸ºæ¨¡æ‹Ÿå‚è€ƒç”µå‹ã€‚ å½“ADRJ&#x3D;1æ—¶ï¼Œ10ä½A&#x2F;Dè½¬æ¢ç»“æœçš„é«˜2ä½å­˜æ”¾åœ¨ADC_RESçš„ä½2ä½ä¸­ï¼Œä½8ä½å­˜æ”¾åœ¨ADC_RESLä¸­ã€‚ æ­¤æ—¶ï¼Œå¦‚æœç”¨æˆ·éœ€å–å®Œæ•´10ä½ç»“æœï¼ŒæŒ‰ä¸‹é¢å…¬å¼è®¡ç®—ï¼š</p><p><img src="https://img-blog.csdnimg.cn/912a48a9a4db4a27b079d1304c5e20c5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/23b6970898534399a767dd6a64cbdb2c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/415f7821fd3f4f9fb9f5b8e43734701e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/2b8362b4f13d41a4ad4f9eabacb8a8b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/5964df02cdf04e4db7be51027d15d43d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/ad2d99e494da4b7aaf3d31a1f9e3703e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/1da2524700364793a3758cd8c0f74c2f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/657d073f65e84077a65ac669cb4b56a6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/3b8e679552ea457bb8d5f5f5d95a2799.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/18737ad3b6ff4945aaf4a121f15de7c4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¼ä¸­ï¼ŒVinä¸ºæ¨¡æ‹Ÿè¾“å…¥é€šé“è¾“å…¥ç”µå‹ï¼ŒVccä¸ºå•ç‰‡æœºå®é™…å·¥ä½œç”µå‹ï¼Œç”¨å•ç‰‡æœºå·¥ä½œç”µå‹ä½œä¸ºæ¨¡æ‹Ÿå‚è€ƒç”µå‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/a050a81568cf434db81a5df1ceeb35cd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä»¥ä¸Šèµ„æ–™æ¥è‡ªSTCå•ç‰‡æœºèµ„æ–™ã€‚</p><h4 id="ç¨‹åºç»“æ„"><a href="#ç¨‹åºç»“æ„" class="headerlink" title="ç¨‹åºç»“æ„"></a>ç¨‹åºç»“æ„</h4><p><img src="https://img-blog.csdnimg.cn/2ebf0a2ce20f40bba6b6a66a1df46928.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>å¯è°ƒå®šä½å™¨æ¥çº¿å›¾</li></ul><p><img src="https://img-blog.csdnimg.cn/b5d80a46e06d45a593e9d1791dc78db1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åºå®ä¾‹ä»£ç "><a href="#ä¸»ç¨‹åºå®ä¾‹ä»£ç " class="headerlink" title="ä¸»ç¨‹åºå®ä¾‹ä»£ç "></a>ä¸»ç¨‹åºå®ä¾‹ä»£ç </h4><ul><li>é‡‡é›†P1.4ç«¯å£çš„æ¨¡æ‹Ÿé‡æ•°å€¼</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">/*--------------------------------------------------------------------------------</span><br><span class="line"> * é¡¹ç›®åç§°:</span><br><span class="line"></span><br><span class="line">     ADæ¨¡æ‹Ÿé‡é‡‡é›†æµ‹è¯•ç¨‹åº V1.0.0</span><br><span class="line"></span><br><span class="line"> * åŠŸèƒ½æè¿°:</span><br><span class="line"></span><br><span class="line">     1ã€é‡‡é›†ADCå£çš„æ•°æ®å‘é€åˆ°ä¸²å£æ˜¾ç¤º</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * é…ç½®è¯´æ˜:</span><br><span class="line">     MCU:             STC15W408AS</span><br><span class="line">     å¼€å‘æ¿:         STC15W408ASå¼€å‘æ¿</span><br><span class="line">     æ™¶æŒ¯:        å†…éƒ¨æ—¶é’Ÿï¼š11.0592MHz</span><br><span class="line">     æ‰©å±•æ¨¡å—:    -</span><br><span class="line">     è½¯ä»¶:            Keil.C51.V9.01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * å¤‡æ³¨:</span><br><span class="line">     - å°†å¼€å‘æ¿çš„ä¸²å£ä¸ç”µè„‘ä¸²å£è¿æ¥</span><br><span class="line">-------------------------------------------------------------------------------------*/</span><br><span class="line">/************************åŒ…å«å¤´æ–‡ä»¶***************************************************/</span><br><span class="line"></span><br><span class="line">#include&lt;STC15W.h&gt;</span><br><span class="line">#include&lt;USART.h&gt;</span><br><span class="line">#include&lt;ADC.h&gt;</span><br><span class="line"></span><br><span class="line">//å®šä¹‰è¦é‡‡é›†ADé€šé“</span><br><span class="line">#define ch4//å³P1.4ç«¯å£</span><br><span class="line"></span><br><span class="line">//sfr P1M1 = 0x91;    //PxM1.n,PxM0.n     =00---&gt;Standard,    01---&gt;push-pull</span><br><span class="line">//sfr P1M0 = 0x92;    //                  =10---&gt;pure input,  11---&gt;open drain</span><br><span class="line"></span><br><span class="line">/************************ä¸»å‡½æ•°******************************************************/</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int res=0;</span><br><span class="line">    unsigned char result[4]= &#123;0&#125;;</span><br><span class="line"></span><br><span class="line">    P1M1=0;</span><br><span class="line">    P1M0=0;</span><br><span class="line"></span><br><span class="line">    InitSerialPort(); //åˆå§‹åŒ–ä¸²å£,æ³¢ç‰¹ç‡9600ï¼Œ8bitæ•°æ®ä½ï¼Œ1åœæ­¢ä½ï¼Œæ— æ ¡éªŒ</span><br><span class="line">    OpenADC_CHx(ch);</span><br><span class="line"></span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        //å‘é€æ•°æ®é‡‡é›†ç»“æœ</span><br><span class="line">        SendByte(&#x27;\t&#x27;);</span><br><span class="line">        SendString(&quot;AD_Value = &quot;);</span><br><span class="line">        GetADCResult_Char(ch,result);</span><br><span class="line">        SendString(result);</span><br><span class="line">        //SendByte(GetADCResult_High(ch));</span><br><span class="line">        //SendByte(GetADCResult_Low(ch));</span><br><span class="line">        //æ¢è¡Œ</span><br><span class="line">        SendByte(&#x27;\n&#x27;);</span><br><span class="line">        //å»¶æ—¶</span><br><span class="line">        Delay(30);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*********************************The End****************************************/</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</p><ul><li><p>é¡¹ç›®åç§°:</p><p>  ADæ¨¡æ‹Ÿé‡é‡‡é›†æµ‹è¯•ç¨‹åº V1.0.0</p></li><li><p>åŠŸèƒ½æè¿°:</p><p>  1ã€é‡‡é›†ADCå£çš„æ•°æ®å‘é€åˆ°ä¸²å£æ˜¾ç¤º</p></li><li><p>é…ç½®è¯´æ˜:<br>  MCU:             STC15W408AS<br>  å¼€å‘æ¿:         STC15W408ASå¼€å‘æ¿<br>  æ™¶æŒ¯:        å†…éƒ¨æ—¶é’Ÿï¼š11.0592MHz<br>  æ‰©å±•æ¨¡å—:    -<br>  è½¯ä»¶:            Keil.C51.V9.01</p></li><li><p>å¤‡æ³¨:</p><ul><li>å°†å¼€å‘æ¿çš„ä¸²å£ä¸ç”µè„‘ä¸²å£è¿æ¥<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-<em>&#x2F;<br>&#x2F;<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>åŒ…å«å¤´æ–‡ä»¶</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em>**************************&#x2F;</li></ul></li></ul><p>#include&lt;STC15W.h&gt;<br>#include&lt;USART.h&gt;<br>#include&lt;ADC.h&gt;</p><p>&#x2F;&#x2F;å®šä¹‰è¦é‡‡é›†ADé€šé“<br>#define ch4&#x2F;&#x2F;å³P1.4ç«¯å£</p><p>&#x2F;&#x2F;sfr P1M1 &#x3D; 0x91;    &#x2F;&#x2F;PxM1.n,PxM0.n     &#x3D;00â€”&gt;Standard,    01â€”&gt;push-pull<br>&#x2F;&#x2F;sfr P1M0 &#x3D; 0x92;    &#x2F;&#x2F;                  &#x3D;10â€”&gt;pure input,  11â€”&gt;open drain</p><p>&#x2F;<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>ä¸»å‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>******************************&#x2F;<br>void main()<br>{<br>    unsigned int res&#x3D;0;<br>    unsigned char result[4]&#x3D; {0};</p><pre><code>P1M1=0;P1M0=0;InitSerialPort(); //åˆå§‹åŒ–ä¸²å£,æ³¢ç‰¹ç‡9600ï¼Œ8bitæ•°æ®ä½ï¼Œ1åœæ­¢ä½ï¼Œæ— æ ¡éªŒOpenADC_CHx(ch);while(1)&#123;    //å‘é€æ•°æ®é‡‡é›†ç»“æœ    SendByte(&#39;\t&#39;);    SendString(&quot;AD_Value = &quot;);    GetADCResult_Char(ch,result);    SendString(result);    //SendByte(GetADCResult_High(ch));    //SendByte(GetADCResult_Low(ch));    //æ¢è¡Œ    SendByte(&#39;\n&#39;);    //å»¶æ—¶    Delay(30);&#125;</code></pre><p>}<br>&#x2F;<em><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>The End</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em>*******&#x2F;&#96;</p><h4 id="ğŸ“šå·¥ç¨‹èµ„æºä»£ç "><a href="#ğŸ“šå·¥ç¨‹èµ„æºä»£ç " class="headerlink" title="ğŸ“šå·¥ç¨‹èµ„æºä»£ç "></a>ğŸ“šå·¥ç¨‹èµ„æºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1eeBckMwQ0Lt1e9QMxYL4Jw </span><br><span class="line">æå–ç ï¼šijc2</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1eeBckMwQ0Lt1e9QMxYL4Jw  æå–ç ï¼šijc2</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°</title>
      <link href="/2024/03/Stc15-STC15W408AS%E8%AF%BB%E5%8F%96DHT11%E6%B8%A9%E6%B9%BF%E5%BA%A6OLED%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0/"/>
      <url>/2024/03/Stc15-STC15W408AS%E8%AF%BB%E5%8F%96DHT11%E6%B8%A9%E6%B9%BF%E5%BA%A6OLED%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-OLEDæ˜¾ç¤º-æ•°æ®ä¸²å£æ‰“å°"><a href="#STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-OLEDæ˜¾ç¤º-æ•°æ®ä¸²å£æ‰“å°" class="headerlink" title="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°"></a>STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°</h1><h3 id="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-OLEDæ˜¾ç¤º-æ•°æ®ä¸²å£æ‰“å°-1"><a href="#STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-OLEDæ˜¾ç¤º-æ•°æ®ä¸²å£æ‰“å°-1" class="headerlink" title="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°"></a>STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°</h3><ul><li>ğŸ“Œç›¸å…³ç¯‡ã€ŠSTC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+æ•°æ®ä¸²å£æ‰“å°è¯¦è§£ã€‹</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/121788606">STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+æ•°æ®ä¸²å£æ‰“å°è¯¦è§£</a></p><ul><li>åªè¦è¯»å–åˆ°DHT11æ•°æ®äº†ï¼ŒåŸºæœ¬ä¸Šåªè¦è§£å†³çš„é—®é¢˜å°±æ˜¯OLEDé©±åŠ¨æ˜¾ç¤ºäº†ã€‚</li><li>æœ¬ç¨‹åºï¼Œæ²¡æœ‰é˜‰å‰²OLEDçš„ä¸»è¦åŠŸèƒ½ä»£ç ï¼Œä¿ç•™åŸæœ‰çš„é©±åŠ¨æ˜¾ç¤ºå‡½æ•°ï¼Œç”±äºå­—åº“ç¼–è¯‘çš„å®¹é‡æœ‰é™ï¼Œæ²¡æœ‰ä½¿ç”¨çš„å‡½æ•°åšäº†æ³¨é‡Šï¼Œç¨‹åºå·¥ç¨‹åšåˆ°äº†0 error 0 warningï¼ï¼Œå¯ä»¥ä½œä¸ºIIC OLEDé©±åŠ¨æ¨¡æ¿æˆ–è€…ä¸²å£è¾“å‡ºæ¨¡æ¿æ¥ä½¿ç”¨ï¼Œé‡Œé¢åŒ…å«å®Œæ•´çš„OLEDé©±åŠ¨æ˜¾ç¤ºå‡½æ•°ï¼Œä»¥åŠä¸²å£é‡æ˜ å°„printfå‡½æ•°æ‰“å°ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…ç§»æ¤åˆ°å…¶ä»–åŒç±»å‹å•ç‰‡æœºçš„å·¥ç¨‹é¡¹ç›®å½“ä¸­ï¼Œä¸€ä¸ªå¥½çš„å·¥ç¨‹é¡¹ç›®ä¸ä»…ç”¨æ¥å­¦ä¹ ï¼Œè¿˜åº”è¯¥å‘æ¨¡æ¿å·¥ç¨‹æ–¹å‘å‘å±•ã€‚</li></ul><p><code>0 error 0 warningï¼</code></p><p><code>printf</code></p><p><img src="https://img-blog.csdnimg.cn/93e89df25cbd47f5a9b13c2e61f7a50a.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>ğŸ“‹ä¸²å£è¾“å‡ºæ‰“å°</li></ul><p><img src="https://img-blog.csdnimg.cn/3a55afe09ae140e7a6f09242f919edee.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ±‰å­—å–æ¨¡æ–¹å¼"><a href="#æ±‰å­—å–æ¨¡æ–¹å¼" class="headerlink" title="æ±‰å­—å–æ¨¡æ–¹å¼"></a>æ±‰å­—å–æ¨¡æ–¹å¼</h4><p><img src="https://img-blog.csdnimg.cn/02d8fd181f624175a4f8720a6360e5de.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ¥çº¿è¯´æ˜"><a href="#æ¥çº¿è¯´æ˜" class="headerlink" title="æ¥çº¿è¯´æ˜"></a>æ¥çº¿è¯´æ˜</h4><ul><li>4çº¿ IIC OLED 0.96å¯¸â€ å±å¹•æ¥çº¿</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//              GND    ç”µæºåœ°</span><br><span class="line">//              VCC  æ¥5Væˆ–3.3vç”µæº</span><br><span class="line">//             IIC OLED 0.96å¯¸&quot;  </span><br><span class="line">// P1^0 -----SCL</span><br><span class="line">//       P1^1 -----SDA</span><br></pre></td></tr></table></figure><p><code>//              GND    ç”µæºåœ° //              VCC  æ¥5Væˆ–3.3vç”µæº //             IIC OLED 0.96å¯¸&quot;   // P1^0 -----SCL //       P1^1 -----SDA</code></p><p>DHT11æ¥çº¿</p><p><img src="https://img-blog.csdnimg.cn/c325deb87b1c4d54bfb2d7d15e93be16.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P1^4---DATA</span><br></pre></td></tr></table></figure><p><code>P1^4---DATA</code></p><h4 id="å·¥ç¨‹æ¦‚è§ˆ"><a href="#å·¥ç¨‹æ¦‚è§ˆ" class="headerlink" title="å·¥ç¨‹æ¦‚è§ˆ"></a>å·¥ç¨‹æ¦‚è§ˆ</h4><p><img src="https://img-blog.csdnimg.cn/d4be22c1c3f94a5696d83d8166b33d76.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>ç¼–è¯‘ä¿¡æ¯</li></ul><p><img src="https://img-blog.csdnimg.cn/fa7cd2e9c4d140969977dea005f503f4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">//#include &quot;string.h&quot;</span><br><span class="line">//#include &quot;stdarg.h&quot; </span><br><span class="line">#include&quot;USART1.h&quot;</span><br><span class="line">#include&quot;delay.h&quot;</span><br><span class="line">#include &quot;oled.h&quot;</span><br><span class="line">#define uint unsigned int </span><br><span class="line">#define uchar unsigned char</span><br><span class="line"></span><br><span class="line">/*************åŠŸèƒ½è¯´æ˜**************</span><br><span class="line"></span><br><span class="line">åŒä¸²å£å…¨åŒå·¥ä¸­æ–­æ–¹å¼æ”¶å‘é€šè®¯ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">é€šè¿‡PCå‘MCUå‘é€æ•°æ®, MCUæ”¶åˆ°åé€šè¿‡ä¸²å£æŠŠæ”¶åˆ°çš„æ•°æ®åŸæ ·è¿”å›.</span><br><span class="line"></span><br><span class="line">******************************************/</span><br><span class="line"></span><br><span class="line">/*************æœ¬åœ°å¸¸é‡å£°æ˜**************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sbit Temp_data = P1^4 ;</span><br><span class="line">sbit led = P1^5;//DHTå“åº”æŒ‡ç¤ºç¯</span><br><span class="line">sbit led2 = P1^6;//æ•ˆéªŒæ•°æ®æŒ‡ç¤ºç¯</span><br><span class="line">unsigned int  rec_dat[4];</span><br><span class="line"></span><br><span class="line">void DHT11_start();//DHTå¼€å§‹ä¿¡å·</span><br><span class="line">unsigned char DHT11_rec_byte();</span><br><span class="line">void DHT11_receive();</span><br><span class="line"></span><br><span class="line">/*************  å¤–éƒ¨å‡½æ•°å’Œå˜é‡å£°æ˜ *****************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*************  ä¸²å£1åˆå§‹åŒ–å‡½æ•° *****************/</span><br><span class="line">voidUART_config(void)</span><br><span class="line">&#123;</span><br><span class="line">COMx_InitDefineCOMx_InitStructure;//ç»“æ„å®šä¹‰</span><br><span class="line">COMx_InitStructure.UART_Mode      = UART_8bit_BRTx;//æ¨¡å¼,       UART_ShiftRight,UART_8bit_BRTx,UART_9bit,UART_9bit_BRTx</span><br><span class="line">COMx_InitStructure.UART_BRT_Use   = BRT_Timer2;//ä½¿ç”¨æ³¢ç‰¹ç‡,   BRT_Timer1, BRT_Timer2 (æ³¨æ„: ä¸²å£2å›ºå®šä½¿ç”¨BRT_Timer2)</span><br><span class="line">COMx_InitStructure.UART_BaudRate  = 115200ul;//æ³¢ç‰¹ç‡, ä¸€èˆ¬ 110 ~ 115200</span><br><span class="line">COMx_InitStructure.UART_RxEnable  = ENABLE;//æ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE</span><br><span class="line">COMx_InitStructure.BaudRateDouble = DISABLE;//æ³¢ç‰¹ç‡åŠ å€, ENABLEæˆ–DISABLE</span><br><span class="line">COMx_InitStructure.UART_Interrupt = ENABLE;//ä¸­æ–­å…è®¸,   ENABLEæˆ–DISABLE</span><br><span class="line">COMx_InitStructure.UART_Polity    = PolityLow;//ä¸­æ–­ä¼˜å…ˆçº§, PolityLow,PolityHigh</span><br><span class="line">COMx_InitStructure.UART_P_SW      = UART1_SW_P30_P31;//åˆ‡æ¢ç«¯å£,   UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17(å¿…é¡»ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿ)</span><br><span class="line">COMx_InitStructure.UART_RXD_TXD_Short = DISABLE;//å†…éƒ¨çŸ­è·¯RXDä¸TXD, åšä¸­ç»§, ENABLE,DISABLE</span><br><span class="line">USART_Configuration(USART1, &amp;COMx_InitStructure);//åˆå§‹åŒ–ä¸²å£1 USART1,USART2</span><br><span class="line"></span><br><span class="line">PrintString1(&quot;STC15W408AS UART1 \r\n&quot;);//SUART1å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void display()&#123;</span><br><span class="line">OLED_Clear();</span><br><span class="line">        OLED_ShowCHinese(18,0,0);//æ¸©æ¹¿åº¦ç›‘æµ‹</span><br><span class="line">        OLED_ShowCHinese(36,0,1);//</span><br><span class="line">        OLED_ShowCHinese(54,0,2);//</span><br><span class="line">        OLED_ShowCHinese(72,0,3);//</span><br><span class="line">        OLED_ShowCHinese(90,0,4);//</span><br><span class="line"></span><br><span class="line">        OLED_ShowCHinese(15,3,0);</span><br><span class="line">        OLED_ShowCHinese(32,3,2);</span><br><span class="line"></span><br><span class="line">        OLED_ShowCHinese(15,5,1);</span><br><span class="line">        OLED_ShowCHinese(32,5,2);</span><br><span class="line">        OLED_ShowChar(50,3,&#x27;:&#x27;,16);</span><br><span class="line">        OLED_ShowChar(50,5,&#x27;:&#x27;,16);</span><br><span class="line">&#125;</span><br><span class="line">/**********************************************/</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">float tem = 0.0,hum = 0.0;</span><br><span class="line"> unsigned char Tempbuf[5],Humbuf[5];</span><br><span class="line">led = 1;</span><br><span class="line">led2 = 1;</span><br><span class="line">UART_config();</span><br><span class="line">EA = 1;</span><br><span class="line">    OLED_Init();//åˆå§‹åŒ–OLED</span><br><span class="line">    OLED_Clear();</span><br><span class="line">while (1)</span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">delayms(150);</span><br><span class="line">        DHT11_receive();</span><br><span class="line">hum = rec_dat[0] + rec_dat[1]/10.0;//ä¿®è®¢ç¬¬ä¸€ç‰ˆæ˜¾ç¤ºç²¾åº¦é—®é¢˜</span><br><span class="line">tem = rec_dat[2] + rec_dat[3]/10.0;</span><br><span class="line"></span><br><span class="line">sprintf(Tempbuf, &quot;%3.1f&quot;,tem);</span><br><span class="line">sprintf(Humbuf, &quot;%2.0f %%&quot;, hum);</span><br><span class="line">display();</span><br><span class="line">OLED_ShowString(62,3,Tempbuf,16);//</span><br><span class="line">OLED_ShowCHinese(98,3,5);</span><br><span class="line">OLED_ShowString(62,5,Humbuf,16);</span><br><span class="line">/******ä¸²å£æ‰“å°******/ </span><br><span class="line">printf(&quot;æ¸©åº¦:%3.1f â„ƒ\r\n&quot;,tem);</span><br><span class="line">printf(&quot;æ¹¿åº¦:%2.0f ï¼…\r\n&quot;,hum);</span><br><span class="line"></span><br><span class="line">delayms(2000);</span><br><span class="line">led = 1;</span><br><span class="line">led2 = 1;</span><br><span class="line">OLED_Clear();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">//DHT11èµ·å§‹ä¿¡å·</span><br><span class="line"></span><br><span class="line">void DHT11_start()</span><br><span class="line">&#123;</span><br><span class="line">    Temp_data=1;</span><br><span class="line">    Delayus(10);</span><br><span class="line">    Temp_data=0;</span><br><span class="line">     delayms(25);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®</span><br><span class="line">    Temp_data=1;</span><br><span class="line">    Delayus(50);//MCUé‡Šæ”¾æ€»çº¿20~40us,éœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´</span><br><span class="line">//if(Temp_data==0)&#123;</span><br><span class="line">//led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·</span><br><span class="line">// while(Temp_data==0); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿,è·³è¿‡ME</span><br><span class="line">       // Delayus(80);  //50æ‹‰é«˜åå»¶æ—¶80us</span><br><span class="line">// while(Temp_data==1);ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿,ç­‰å¾…æ‹‰ä½,è·³è¿‡EF</span><br><span class="line">//&#125;else&#123;led=1;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æ¥æ”¶ä¸€ä¸ªå­—èŠ‚</span><br><span class="line">unsigned char DHT11_rec_byte()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char i,dat=0;</span><br><span class="line">    for(i=0; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        while(!Temp_data);//è·³è¿‡æ•°æ®å‰æ®µçš„50us</span><br><span class="line">Delayus(33);//è¿‡äº†æ•°æ®0å’Œæ•°æ®1ç›¸åŒåŒºåŸŸï¼Œå†åšæ£€æµ‹      </span><br><span class="line">         dat &lt;&lt;=1;</span><br><span class="line">if(Temp_data==1)</span><br><span class="line">        &#123;//å¦‚æœè¯»åˆ°çš„æ•°æ®æ˜¯1</span><br><span class="line">  dat +=1;</span><br><span class="line">        &#125;</span><br><span class="line">while(Temp_data);</span><br><span class="line">    &#125;</span><br><span class="line">    return dat;</span><br><span class="line">&#125;</span><br><span class="line">//æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®</span><br><span class="line">void DHT11_receive()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int R_H,R_L,T_H,T_L;</span><br><span class="line">    unsigned char RH,RL,TH,TL,revise;</span><br><span class="line">DHT11_start();</span><br><span class="line">    if(Temp_data==0)</span><br><span class="line">    &#123;led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·</span><br><span class="line">while(Temp_data==0); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿</span><br><span class="line">while(Temp_data==1); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿</span><br><span class="line">  </span><br><span class="line">      R_H=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦é«˜å…«ä½</span><br><span class="line">        R_L=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦ä½å…«ä½</span><br><span class="line">        T_H=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦é«˜å…«ä½</span><br><span class="line">        T_L=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦ä½å…«ä½</span><br><span class="line">        revise=DHT11_rec_byte(); //æ¥æ”¶æ ¡æ­£ä½</span><br><span class="line">        Delayus(25);    //ç»“æŸ</span><br><span class="line">/******ä¸²å£æ‰“å°******/</span><br><span class="line">printf(&quot;æ¹¿åº¦: %d.%d%% æ¸©åº¦: %d.%dâ„ƒ \r\n&quot;,R_H,R_L,T_H,T_L);</span><br><span class="line">        if((R_H+R_L+T_H+T_L)==revise)      //æ ¡æ­£</span><br><span class="line">        &#123;</span><br><span class="line">led2 = 0;</span><br><span class="line">            RH=R_H;</span><br><span class="line">            RL=R_L;</span><br><span class="line">            TH=T_H;</span><br><span class="line">            TL=T_L;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/</span><br><span class="line">        rec_dat[0]=RH;</span><br><span class="line">        rec_dat[1]=RL;</span><br><span class="line">        rec_dat[2]=TH;</span><br><span class="line">        rec_dat[3]=TL;</span><br><span class="line"></span><br><span class="line">  &#125;else&#123;led=1;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œstdio.hâ€<br>&#x2F;&#x2F;#include â€œstring.hâ€<br>&#x2F;&#x2F;#include â€œstdarg.hâ€<br>#includeâ€œUSART1.hâ€<br>#includeâ€œdelay.hâ€<br>#include â€œoled.hâ€<br>#define uint unsigned int<br>#define uchar unsigned char</p><p>&#x2F;*************åŠŸèƒ½è¯´æ˜**************</p><p>åŒä¸²å£å…¨åŒå·¥ä¸­æ–­æ–¹å¼æ”¶å‘é€šè®¯ç¨‹åºã€‚</p><p>é€šè¿‡PCå‘MCUå‘é€æ•°æ®, MCUæ”¶åˆ°åé€šè¿‡ä¸²å£æŠŠæ”¶åˆ°çš„æ•°æ®åŸæ ·è¿”å›.</p><p>******************************************&#x2F;</p><p>&#x2F;*************æœ¬åœ°å¸¸é‡å£°æ˜**************&#x2F;</p><p>sbit Temp_data &#x3D; P1^4 ;<br>sbit led &#x3D; P1^5;&#x2F;&#x2F;DHTå“åº”æŒ‡ç¤ºç¯<br>sbit led2 &#x3D; P1^6;&#x2F;&#x2F;æ•ˆéªŒæ•°æ®æŒ‡ç¤ºç¯<br>unsigned int  rec_dat[4];</p><p>void DHT11_start();&#x2F;&#x2F;DHTå¼€å§‹ä¿¡å·<br>unsigned char DHT11_rec_byte();<br>void DHT11_receive();</p><p>&#x2F;*************  å¤–éƒ¨å‡½æ•°å’Œå˜é‡å£°æ˜ *****************&#x2F;</p><p>&#x2F;*************  ä¸²å£1åˆå§‹åŒ–å‡½æ•° *****************&#x2F;<br>voidUART_config(void)<br>{<br>    COMx_InitDefineCOMx_InitStructure;&#x2F;&#x2F;ç»“æ„å®šä¹‰<br>    COMx_InitStructure.UART_Mode      &#x3D; UART_8bit_BRTx;&#x2F;&#x2F;æ¨¡å¼,       UART_ShiftRight,UART_8bit_BRTx,UART_9bit,UART_9bit_BRTx<br>    COMx_InitStructure.UART_BRT_Use   &#x3D; BRT_Timer2;&#x2F;&#x2F;ä½¿ç”¨æ³¢ç‰¹ç‡,   BRT_Timer1, BRT_Timer2 (æ³¨æ„: ä¸²å£2å›ºå®šä½¿ç”¨BRT_Timer2)<br>    COMx_InitStructure.UART_BaudRate  &#x3D; 115200ul;&#x2F;&#x2F;æ³¢ç‰¹ç‡, ä¸€èˆ¬ 110 ~ 115200<br>    COMx_InitStructure.UART_RxEnable  &#x3D; ENABLE;&#x2F;&#x2F;æ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE<br>    COMx_InitStructure.BaudRateDouble &#x3D; DISABLE;&#x2F;&#x2F;æ³¢ç‰¹ç‡åŠ å€, ENABLEæˆ–DISABLE<br>    COMx_InitStructure.UART_Interrupt &#x3D; ENABLE;&#x2F;&#x2F;ä¸­æ–­å…è®¸,   ENABLEæˆ–DISABLE<br>    COMx_InitStructure.UART_Polity    &#x3D; PolityLow;&#x2F;&#x2F;ä¸­æ–­ä¼˜å…ˆçº§, PolityLow,PolityHigh<br>    COMx_InitStructure.UART_P_SW      &#x3D; UART1_SW_P30_P31;&#x2F;&#x2F;åˆ‡æ¢ç«¯å£,   UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17(å¿…é¡»ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿ)<br>    COMx_InitStructure.UART_RXD_TXD_Short &#x3D; DISABLE;&#x2F;&#x2F;å†…éƒ¨çŸ­è·¯RXDä¸TXD, åšä¸­ç»§, ENABLE,DISABLE<br>    USART_Configuration(USART1, &amp;COMx_InitStructure);&#x2F;&#x2F;åˆå§‹åŒ–ä¸²å£1 USART1,USART2</p><pre><code>PrintString1(&quot;STC15W408AS UART1 \r\n&quot;);//SUART1å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²</code></pre><p>}</p><p>void display(){<br>                OLED_Clear();<br>        OLED_ShowCHinese(18,0,0);&#x2F;&#x2F;æ¸©æ¹¿åº¦ç›‘æµ‹<br>        OLED_ShowCHinese(36,0,1);&#x2F;&#x2F;<br>        OLED_ShowCHinese(54,0,2);&#x2F;&#x2F;<br>        OLED_ShowCHinese(72,0,3);&#x2F;&#x2F;<br>        OLED_ShowCHinese(90,0,4);&#x2F;&#x2F;</p><pre><code>    OLED_ShowCHinese(15,3,0);    OLED_ShowCHinese(32,3,2);    OLED_ShowCHinese(15,5,1);    OLED_ShowCHinese(32,5,2);    OLED_ShowChar(50,3,&#39;:&#39;,16);    OLED_ShowChar(50,5,&#39;:&#39;,16);</code></pre><p>}<br>&#x2F;**********************************************&#x2F;<br>void main(void)<br>{<br>    float tem &#x3D; 0.0,hum &#x3D; 0.0;<br> unsigned char Tempbuf[5],Humbuf[5];<br>    led &#x3D; 1;<br>    led2 &#x3D; 1;<br>    UART_config();<br>    EA &#x3D; 1;<br>    OLED_Init();&#x2F;&#x2F;åˆå§‹åŒ–OLED<br>    OLED_Clear();<br>    while (1)<br>    {</p><pre><code>            delayms(150);    DHT11_receive();    hum = rec_dat[0] + rec_dat[1]/10.0;//ä¿®è®¢ç¬¬ä¸€ç‰ˆæ˜¾ç¤ºç²¾åº¦é—®é¢˜    tem = rec_dat[2] + rec_dat[3]/10.0;        sprintf(Tempbuf, &quot;%3.1f&quot;,tem);    sprintf(Humbuf, &quot;%2.0f %%&quot;, hum);    display();    OLED_ShowString(62,3,Tempbuf,16);//    OLED_ShowCHinese(98,3,5);    OLED_ShowString(62,5,Humbuf,16);        /******ä¸²å£æ‰“å°******/     printf(&quot;æ¸©åº¦:%3.1f â„ƒ\r\n&quot;,tem);    printf(&quot;æ¹¿åº¦:%2.0f ï¼…\r\n&quot;,hum);    delayms(2000);        led = 1;        led2 = 1;        OLED_Clear();&#125;</code></pre><p>}<br>&#x2F;&#x2F;DHT11èµ·å§‹ä¿¡å·</p><p>void DHT11_start()<br>{<br>    Temp_data&#x3D;1;<br>    Delayus(10);<br>    Temp_data&#x3D;0;<br>     delayms(25);&#x2F;&#x2F;è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®<br>    Temp_data&#x3D;1;<br>    Delayus(50);&#x2F;&#x2F;MCUé‡Šæ”¾æ€»çº¿20~40us,éœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´<br>&#x2F;&#x2F;if(Temp_data&#x3D;&#x3D;0){<br>&#x2F;&#x2F;led&#x3D;0;&#x2F;&#x2F;æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·<br>            &#x2F;&#x2F; while(Temp_data&#x3D;&#x3D;0); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿,è·³è¿‡ME<br>       &#x2F;&#x2F; Delayus(80);  &#x2F;&#x2F;50æ‹‰é«˜åå»¶æ—¶80us<br>            &#x2F;&#x2F; while(Temp_data&#x3D;&#x3D;1);ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿,ç­‰å¾…æ‹‰ä½,è·³è¿‡EF<br>&#x2F;&#x2F;}else{led&#x3D;1;}</p><p>}</p><p>&#x2F;&#x2F;æ¥æ”¶ä¸€ä¸ªå­—èŠ‚<br>unsigned char DHT11_rec_byte()<br>{<br>    unsigned char i,dat&#x3D;0;<br>    for(i&#x3D;0; i&lt;8; i++)<br>    {<br>        while(!Temp_data);&#x2F;&#x2F;è·³è¿‡æ•°æ®å‰æ®µçš„50us<br>                    Delayus(33);&#x2F;&#x2F;è¿‡äº†æ•°æ®0å’Œæ•°æ®1ç›¸åŒåŒºåŸŸï¼Œå†åšæ£€æµ‹<br>         dat &lt;&lt;&#x3D;1;<br>            if(Temp_data&#x3D;&#x3D;1)<br>        {&#x2F;&#x2F;å¦‚æœè¯»åˆ°çš„æ•°æ®æ˜¯1<br>                      dat +&#x3D;1;<br>        }<br>            while(Temp_data);<br>    }<br>    return dat;<br>}<br>&#x2F;&#x2F;æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®<br>void DHT11_receive()<br>{<br>    unsigned int R_H,R_L,T_H,T_L;<br>    unsigned char RH,RL,TH,TL,revise;<br>        DHT11_start();<br>        if(Temp_data&#x3D;&#x3D;0)<br>    {led&#x3D;0;&#x2F;&#x2F;æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·<br>            while(Temp_data&#x3D;&#x3D;0); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿<br>            while(Temp_data&#x3D;&#x3D;1); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿</p><pre><code>  R_H=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦é«˜å…«ä½    R_L=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦ä½å…«ä½    T_H=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦é«˜å…«ä½    T_L=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦ä½å…«ä½    revise=DHT11_rec_byte(); //æ¥æ”¶æ ¡æ­£ä½    Delayus(25);    //ç»“æŸ            /******ä¸²å£æ‰“å°******/        printf(&quot;æ¹¿åº¦: %d.%d%% æ¸©åº¦: %d.%dâ„ƒ \r\n&quot;,R_H,R_L,T_H,T_L);    if((R_H+R_L+T_H+T_L)==revise)      //æ ¡æ­£    &#123;    led2 = 0;        RH=R_H;        RL=R_L;        TH=T_H;        TL=T_L;                    &#125;    /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/    rec_dat[0]=RH;    rec_dat[1]=RL;    rec_dat[2]=TH;    rec_dat[3]=TL;</code></pre><p>  }else{led&#x3D;1;}<br>}&#96;</p><h4 id="ç¨‹åºæºç "><a href="#ç¨‹åºæºç " class="headerlink" title="ç¨‹åºæºç "></a>ç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/14T_vfAJNF3a4zg-YKNj-_w </span><br><span class="line">æå–ç ï¼šf0oi</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/14T_vfAJNF3a4zg-YKNj-_w  æå–ç ï¼šf0oi</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°ã€ä¿®è®¢ç‰ˆã€‘</title>
      <link href="/2024/03/Stc15-STC15W408AS%E8%AF%BB%E5%8F%96DHT11%E6%B8%A9%E6%B9%BF%E5%BA%A6OLED%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0%E4%BF%AE%E8%AE%A2%E7%89%88/"/>
      <url>/2024/03/Stc15-STC15W408AS%E8%AF%BB%E5%8F%96DHT11%E6%B8%A9%E6%B9%BF%E5%BA%A6OLED%E6%98%BE%E7%A4%BA%E6%95%B0%E6%8D%AE%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0%E4%BF%AE%E8%AE%A2%E7%89%88/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-OLEDæ˜¾ç¤º-æ•°æ®ä¸²å£æ‰“å°ã€ä¿®è®¢ç‰ˆã€‘"><a href="#STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-OLEDæ˜¾ç¤º-æ•°æ®ä¸²å£æ‰“å°ã€ä¿®è®¢ç‰ˆã€‘" class="headerlink" title="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°ã€ä¿®è®¢ç‰ˆã€‘"></a>STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°ã€ä¿®è®¢ç‰ˆã€‘</h1><h3 id="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-OLEDæ˜¾ç¤º-æ•°æ®ä¸²å£æ‰“å°ã€ä¿®è®¢ç‰ˆã€‘-1"><a href="#STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-OLEDæ˜¾ç¤º-æ•°æ®ä¸²å£æ‰“å°ã€ä¿®è®¢ç‰ˆã€‘-1" class="headerlink" title="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°ã€ä¿®è®¢ç‰ˆã€‘"></a>STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°ã€ä¿®è®¢ç‰ˆã€‘</h3><ul><li>ğŸ“Œç›¸å…³ç¯‡ã€ŠSTC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°ã€‹</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/121798933">STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+OLEDæ˜¾ç¤º+æ•°æ®ä¸²å£æ‰“å°</a></p><p>âœ¨è¯¥ç‰ˆæœ¬ä¸»è¦ä¿®æ­£äº†æ¸©åº¦æ˜¾ç¤ºç²¾åº¦é—®é¢˜ã€‚</p><p><img src="https://img-blog.csdnimg.cn/5a3f7c89739c4b0488423654e7ed1d14.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>ğŸŒ¿æ‰€ä½¿ç”¨çš„å•ç‰‡æœºï¼šSTC15W408ASï¼Œ</li><li>ğŸ“ã€Šã€å¼€æºåˆ†äº«ã€‘è‡ªåˆ¶STC15W408ASå¼€å‘æ¿ã€‹</li><li>ğŸ”–ä¹Ÿå¯ä»¥è‡ªå·±å»TBè´­ä¹°ç°æˆçš„å¼€å‘æ¿</li></ul><p><code>STC15W408AS</code></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/122150323">ã€å¼€æºåˆ†äº«ã€‘è‡ªåˆ¶STC15W408ASå¼€å‘æ¿</a></p><p><img src="https://img-blog.csdnimg.cn/050febe37f7248c68980e36d856e1371.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="â›³æ³¨æ„äº‹é¡¹"><a href="#â›³æ³¨æ„äº‹é¡¹" class="headerlink" title="â›³æ³¨æ„äº‹é¡¹"></a>â›³æ³¨æ„äº‹é¡¹</h4><ul><li>ğŸŒ¿æ‰€ä½¿ç”¨çš„æ™¶æŒ¯é¢‘ç‡æ¥è‡ªèŠ¯ç‰‡å†…éƒ¨çš„ï¼Œé¢‘ç‡æ˜¯22.1184MHzï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹</li><li>ğŸŒ¿æ³¢ç‰¹ç‡é»˜è®¤è®¾ç½®çš„æ˜¯ï¼š115200ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹ã€‚</li><li>ğŸŒ¿è·å–ä¼ æ„Ÿå™¨æ•°æ®ï¼Œæ˜¯é€šè¿‡å•æ€»çº¿çš„é€šè®¯åè®®è¯»å–çš„ï¼Œè¯»æ•°æ®è¿‡ç¨‹ä¸­ï¼Œå¯¹é€šè®¯å½“ä¸­æ—¶é—´éœ€è¦æ¯”è¾ƒç²¾å‡†ï¼Œå¦åˆ™è¯»ä¸åˆ°æ•°æ®ã€‚å¦‚æœè‡ªè¡Œè°ƒæ•´é¢‘ç‡ï¼Œè¯·æ³¨æ„é€šè®¯åè®®ç›¸å…³çš„ä»£ç æ˜¯å¦æœ‰å½±å“ï¼Œè¯·è‡ªè¡Œè€ƒè™‘å’Œè¯„ä¼°ã€‚</li><li>ğŸŒ¿ä¸€èˆ¬æ¶‰åŠåˆ°é€šè®¯ç›¸å…³çš„æ•°æ®è·å–å¯¹æ—¶é—´æ§åˆ¶æ–¹é¢è¦æ±‚éƒ½æ˜¯æ¯”è¾ƒé«˜çš„ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/2dfd0456ed3f4c1a9797903764be1431.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ› æ¥çº¿è¯´æ˜"><a href="#ğŸ› æ¥çº¿è¯´æ˜" class="headerlink" title="ğŸ› æ¥çº¿è¯´æ˜"></a>ğŸ› æ¥çº¿è¯´æ˜</h4><ul><li>4çº¿ IIC OLED 0.96å¯¸â€ å±å¹•æ¥çº¿</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//              GND    ç”µæºåœ°</span><br><span class="line">//              VCC  æ¥5Væˆ–3.3vç”µæº</span><br><span class="line">//             IIC OLED 0.96å¯¸&quot;  </span><br><span class="line">// P1^0 -----SCL</span><br><span class="line">//       P1^1 -----SDA</span><br></pre></td></tr></table></figure><p><code>//              GND    ç”µæºåœ° //              VCC  æ¥5Væˆ–3.3vç”µæº //             IIC OLED 0.96å¯¸&quot;   // P1^0 -----SCL //       P1^1 -----SDA</code></p><ul><li>DHT11æ¥çº¿</li></ul><p><img src="https://img-blog.csdnimg.cn/c325deb87b1c4d54bfb2d7d15e93be16.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P1^4---DATA</span><br></pre></td></tr></table></figure><p><code>P1^4---DATA</code></p><p><img src="https://img-blog.csdnimg.cn/288d28d6e0574f0381cbde160aaadea4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“ä¸»ç¨‹åºä»£ç "><a href="#ğŸ“ä¸»ç¨‹åºä»£ç " class="headerlink" title="ğŸ“ä¸»ç¨‹åºä»£ç "></a>ğŸ“ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">//#include &quot;string.h&quot;</span><br><span class="line">//#include &quot;stdarg.h&quot; </span><br><span class="line">#include&quot;USART1.h&quot;</span><br><span class="line">#include&quot;delay.h&quot;</span><br><span class="line">#include &quot;oled.h&quot;</span><br><span class="line">#define uint unsigned int </span><br><span class="line">#define uchar unsigned char</span><br><span class="line"></span><br><span class="line">/*************æœ¬åœ°å¸¸é‡å£°æ˜**************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sbit Temp_data = P1^4 ;</span><br><span class="line">sbit led = P1^5;//DHTå“åº”æŒ‡ç¤ºç¯</span><br><span class="line">sbit led2 = P1^6;//æ•ˆéªŒæ•°æ®æŒ‡ç¤ºç¯</span><br><span class="line">unsigned int rec_dat[4];</span><br><span class="line"></span><br><span class="line">void DHT11_start();//DHTå¼€å§‹ä¿¡å·</span><br><span class="line">unsigned char DHT11_rec_byte();</span><br><span class="line">void DHT11_receive();</span><br><span class="line"></span><br><span class="line">/*************  å¤–éƒ¨å‡½æ•°å’Œå˜é‡å£°æ˜ *****************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*************  ä¸²å£1åˆå§‹åŒ–å‡½æ•° *****************/</span><br><span class="line">voidUART_config(void)</span><br><span class="line">&#123;</span><br><span class="line">COMx_InitDefineCOMx_InitStructure;//ç»“æ„å®šä¹‰</span><br><span class="line">COMx_InitStructure.UART_Mode      = UART_8bit_BRTx;//æ¨¡å¼,       UART_ShiftRight,UART_8bit_BRTx,UART_9bit,UART_9bit_BRTx</span><br><span class="line">COMx_InitStructure.UART_BRT_Use   = BRT_Timer2;//ä½¿ç”¨æ³¢ç‰¹ç‡,   BRT_Timer1, BRT_Timer2 (æ³¨æ„: ä¸²å£2å›ºå®šä½¿ç”¨BRT_Timer2)</span><br><span class="line">COMx_InitStructure.UART_BaudRate  = 115200ul;//æ³¢ç‰¹ç‡, ä¸€èˆ¬ 110 ~ 115200</span><br><span class="line">COMx_InitStructure.UART_RxEnable  = ENABLE;//æ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE</span><br><span class="line">COMx_InitStructure.BaudRateDouble = DISABLE;//æ³¢ç‰¹ç‡åŠ å€, ENABLEæˆ–DISABLE</span><br><span class="line">COMx_InitStructure.UART_Interrupt = ENABLE;//ä¸­æ–­å…è®¸,   ENABLEæˆ–DISABLE</span><br><span class="line">COMx_InitStructure.UART_Polity    = PolityLow;//ä¸­æ–­ä¼˜å…ˆçº§, PolityLow,PolityHigh</span><br><span class="line">COMx_InitStructure.UART_P_SW      = UART1_SW_P30_P31;//åˆ‡æ¢ç«¯å£,   UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17(å¿…é¡»ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿ)</span><br><span class="line">COMx_InitStructure.UART_RXD_TXD_Short = DISABLE;//å†…éƒ¨çŸ­è·¯RXDä¸TXD, åšä¸­ç»§, ENABLE,DISABLE</span><br><span class="line">USART_Configuration(USART1, &amp;COMx_InitStructure);//åˆå§‹åŒ–ä¸²å£1 USART1,USART2</span><br><span class="line"></span><br><span class="line">PrintString1(&quot;STC15W408AS UART1 \r\n&quot;);//SUART1å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void display()&#123;</span><br><span class="line">OLED_Clear();</span><br><span class="line">        OLED_ShowCHinese(18,0,0);//æ¸©æ¹¿åº¦ç›‘æµ‹</span><br><span class="line">        OLED_ShowCHinese(36,0,1);//</span><br><span class="line">        OLED_ShowCHinese(54,0,2);//</span><br><span class="line">        OLED_ShowCHinese(72,0,3);//</span><br><span class="line">        OLED_ShowCHinese(90,0,4);//</span><br><span class="line"></span><br><span class="line">        OLED_ShowCHinese(15,3,0);</span><br><span class="line">        OLED_ShowCHinese(32,3,2);</span><br><span class="line"></span><br><span class="line">        OLED_ShowCHinese(15,5,1);</span><br><span class="line">        OLED_ShowCHinese(32,5,2);</span><br><span class="line">        OLED_ShowChar(50,3,&#x27;:&#x27;,16);</span><br><span class="line">        OLED_ShowChar(50,5,&#x27;:&#x27;,16);</span><br><span class="line">&#125;</span><br><span class="line">/**********************************************/</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">//unsigned char i;</span><br><span class="line">float tem = 0.0,hum = 0.0;</span><br><span class="line"> unsigned char Tempbuf[5],Humbuf[5];</span><br><span class="line">led = 1;</span><br><span class="line">led2 = 1;</span><br><span class="line">UART_config();</span><br><span class="line">EA = 1;</span><br><span class="line">    OLED_Init();//åˆå§‹åŒ–OLED</span><br><span class="line">    OLED_Clear();</span><br><span class="line">while (1)</span><br><span class="line">&#123;   </span><br><span class="line">delayms(150);</span><br><span class="line">        DHT11_receive();</span><br><span class="line"></span><br><span class="line">hum = rec_dat[0] + rec_dat[1]/10.0;</span><br><span class="line">tem = rec_dat[2] + rec_dat[3]/10.0;</span><br><span class="line">sprintf(Tempbuf, &quot;%3.1f&quot;,tem);</span><br><span class="line">sprintf(Humbuf, &quot;%2.0f %%&quot;, hum);</span><br><span class="line"></span><br><span class="line">display();</span><br><span class="line">OLED_ShowString(62,3,Tempbuf,16);//</span><br><span class="line">OLED_ShowCHinese(98,3,5);</span><br><span class="line">OLED_ShowString(62,5,Humbuf,16);</span><br><span class="line">/******ä¸²å£æ‰“å°******/</span><br><span class="line"></span><br><span class="line">printf(&quot;æ¹¿åº¦: %d.%d%% æ¸©åº¦: %d.%dâ„ƒ \r\n&quot;,rec_dat[0],rec_dat[1],rec_dat[2],rec_dat[3]);</span><br><span class="line">delayms(2000);</span><br><span class="line">led = 1;</span><br><span class="line">led2 = 1;</span><br><span class="line">OLED_Clear();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">//DHT11èµ·å§‹ä¿¡å·</span><br><span class="line"></span><br><span class="line">void DHT11_start()</span><br><span class="line">&#123;</span><br><span class="line">    Temp_data=1;</span><br><span class="line">    Delayus(10);</span><br><span class="line">    Temp_data=0;</span><br><span class="line">     delayms(25);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®</span><br><span class="line">    Temp_data=1;</span><br><span class="line">    Delayus(50);//MCUé‡Šæ”¾æ€»çº¿20~40us,éœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´</span><br><span class="line">//if(Temp_data==0)&#123;</span><br><span class="line">//led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·</span><br><span class="line">// while(Temp_data==0); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿,è·³è¿‡ME</span><br><span class="line">       // Delayus(80);  //50æ‹‰é«˜åå»¶æ—¶80us</span><br><span class="line">// while(Temp_data==1);ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿,ç­‰å¾…æ‹‰ä½,è·³è¿‡EF</span><br><span class="line">//&#125;else&#123;led=1;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æ¥æ”¶ä¸€ä¸ªå­—èŠ‚</span><br><span class="line">unsigned char DHT11_rec_byte()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char i,dat=0;</span><br><span class="line">    for(i=0; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        while(!Temp_data);//è·³è¿‡æ•°æ®å‰æ®µçš„50us</span><br><span class="line">Delayus(33);//è¿‡äº†æ•°æ®0å’Œæ•°æ®1ç›¸åŒåŒºåŸŸï¼Œå†åšæ£€æµ‹      </span><br><span class="line">         dat &lt;&lt;=1;</span><br><span class="line">if(Temp_data==1)</span><br><span class="line">        &#123;//å¦‚æœè¯»åˆ°çš„æ•°æ®æ˜¯1</span><br><span class="line">  dat +=1;</span><br><span class="line">        &#125;</span><br><span class="line">while(Temp_data);</span><br><span class="line">    &#125;</span><br><span class="line">    return dat;</span><br><span class="line">&#125;</span><br><span class="line">//æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®</span><br><span class="line">void DHT11_receive()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int R_H,R_L,T_H,T_L;</span><br><span class="line">    unsigned char RH,RL,TH,TL,revise;</span><br><span class="line">DHT11_start();</span><br><span class="line">    if(Temp_data==0)</span><br><span class="line">    &#123;led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·</span><br><span class="line">while(Temp_data==0); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿</span><br><span class="line">while(Temp_data==1); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿</span><br><span class="line">  </span><br><span class="line">        R_H=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦é«˜å…«ä½</span><br><span class="line">        R_L=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦ä½å…«ä½</span><br><span class="line">        T_H=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦é«˜å…«ä½</span><br><span class="line">        T_L=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦ä½å…«ä½</span><br><span class="line">        revise=DHT11_rec_byte(); //æ¥æ”¶æ ¡æ­£ä½</span><br><span class="line">        Delayus(25);    //ç»“æŸ</span><br><span class="line">/******ä¸²å£æ‰“å°******/</span><br><span class="line">//printf(&quot;æ¹¿åº¦: %d.%d%% æ¸©åº¦: %d.%dâ„ƒ \r\n&quot;,R_H,R_L,T_H,T_L);</span><br><span class="line"></span><br><span class="line">        if((R_H+R_L+T_H+T_L)==revise)      //æ ¡æ­£</span><br><span class="line">        &#123;</span><br><span class="line"> led2 = 0;</span><br><span class="line">            RH=R_H;</span><br><span class="line">            RL=R_L;</span><br><span class="line">            TH=T_H;</span><br><span class="line">            TL=T_L;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/</span><br><span class="line">        rec_dat[0]=RH;</span><br><span class="line">        rec_dat[1]=RL;</span><br><span class="line">        rec_dat[2]=TH;</span><br><span class="line">        rec_dat[3]=TL;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;else&#123;led=1;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œstdio.hâ€<br>&#x2F;&#x2F;#include â€œstring.hâ€<br>&#x2F;&#x2F;#include â€œstdarg.hâ€<br>#includeâ€œUSART1.hâ€<br>#includeâ€œdelay.hâ€<br>#include â€œoled.hâ€<br>#define uint unsigned int<br>#define uchar unsigned char</p><p>&#x2F;*************æœ¬åœ°å¸¸é‡å£°æ˜**************&#x2F;</p><p>sbit Temp_data &#x3D; P1^4 ;<br>sbit led &#x3D; P1^5;&#x2F;&#x2F;DHTå“åº”æŒ‡ç¤ºç¯<br>sbit led2 &#x3D; P1^6;&#x2F;&#x2F;æ•ˆéªŒæ•°æ®æŒ‡ç¤ºç¯<br>unsigned int rec_dat[4];</p><p>void DHT11_start();&#x2F;&#x2F;DHTå¼€å§‹ä¿¡å·<br>unsigned char DHT11_rec_byte();<br>void DHT11_receive();</p><p>&#x2F;*************  å¤–éƒ¨å‡½æ•°å’Œå˜é‡å£°æ˜ *****************&#x2F;</p><p>&#x2F;*************  ä¸²å£1åˆå§‹åŒ–å‡½æ•° *****************&#x2F;<br>voidUART_config(void)<br>{<br>    COMx_InitDefineCOMx_InitStructure;&#x2F;&#x2F;ç»“æ„å®šä¹‰<br>    COMx_InitStructure.UART_Mode      &#x3D; UART_8bit_BRTx;&#x2F;&#x2F;æ¨¡å¼,       UART_ShiftRight,UART_8bit_BRTx,UART_9bit,UART_9bit_BRTx<br>    COMx_InitStructure.UART_BRT_Use   &#x3D; BRT_Timer2;&#x2F;&#x2F;ä½¿ç”¨æ³¢ç‰¹ç‡,   BRT_Timer1, BRT_Timer2 (æ³¨æ„: ä¸²å£2å›ºå®šä½¿ç”¨BRT_Timer2)<br>    COMx_InitStructure.UART_BaudRate  &#x3D; 115200ul;&#x2F;&#x2F;æ³¢ç‰¹ç‡, ä¸€èˆ¬ 110 ~ 115200<br>    COMx_InitStructure.UART_RxEnable  &#x3D; ENABLE;&#x2F;&#x2F;æ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE<br>    COMx_InitStructure.BaudRateDouble &#x3D; DISABLE;&#x2F;&#x2F;æ³¢ç‰¹ç‡åŠ å€, ENABLEæˆ–DISABLE<br>    COMx_InitStructure.UART_Interrupt &#x3D; ENABLE;&#x2F;&#x2F;ä¸­æ–­å…è®¸,   ENABLEæˆ–DISABLE<br>    COMx_InitStructure.UART_Polity    &#x3D; PolityLow;&#x2F;&#x2F;ä¸­æ–­ä¼˜å…ˆçº§, PolityLow,PolityHigh<br>    COMx_InitStructure.UART_P_SW      &#x3D; UART1_SW_P30_P31;&#x2F;&#x2F;åˆ‡æ¢ç«¯å£,   UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17(å¿…é¡»ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿ)<br>    COMx_InitStructure.UART_RXD_TXD_Short &#x3D; DISABLE;&#x2F;&#x2F;å†…éƒ¨çŸ­è·¯RXDä¸TXD, åšä¸­ç»§, ENABLE,DISABLE<br>    USART_Configuration(USART1, &amp;COMx_InitStructure);&#x2F;&#x2F;åˆå§‹åŒ–ä¸²å£1 USART1,USART2</p><pre><code>PrintString1(&quot;STC15W408AS UART1 \r\n&quot;);//SUART1å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²</code></pre><p>}</p><p>void display(){<br>                OLED_Clear();<br>        OLED_ShowCHinese(18,0,0);&#x2F;&#x2F;æ¸©æ¹¿åº¦ç›‘æµ‹<br>        OLED_ShowCHinese(36,0,1);&#x2F;&#x2F;<br>        OLED_ShowCHinese(54,0,2);&#x2F;&#x2F;<br>        OLED_ShowCHinese(72,0,3);&#x2F;&#x2F;<br>        OLED_ShowCHinese(90,0,4);&#x2F;&#x2F;</p><pre><code>    OLED_ShowCHinese(15,3,0);    OLED_ShowCHinese(32,3,2);    OLED_ShowCHinese(15,5,1);    OLED_ShowCHinese(32,5,2);    OLED_ShowChar(50,3,&#39;:&#39;,16);    OLED_ShowChar(50,5,&#39;:&#39;,16);</code></pre><p>}<br>&#x2F;**********************************************&#x2F;<br>void main(void)<br>{<br>    &#x2F;&#x2F;unsigned char i;<br>    float tem &#x3D; 0.0,hum &#x3D; 0.0;<br> unsigned char Tempbuf[5],Humbuf[5];<br>    led &#x3D; 1;<br>    led2 &#x3D; 1;<br>    UART_config();<br>    EA &#x3D; 1;<br>    OLED_Init();&#x2F;&#x2F;åˆå§‹åŒ–OLED<br>    OLED_Clear();<br>    while (1)<br>    {<br>                delayms(150);<br>        DHT11_receive();</p><pre><code>    hum = rec_dat[0] + rec_dat[1]/10.0;    tem = rec_dat[2] + rec_dat[3]/10.0;    sprintf(Tempbuf, &quot;%3.1f&quot;,tem);    sprintf(Humbuf, &quot;%2.0f %%&quot;, hum);    display();    OLED_ShowString(62,3,Tempbuf,16);//    OLED_ShowCHinese(98,3,5);    OLED_ShowString(62,5,Humbuf,16);        /******ä¸²å£æ‰“å°******/</code></pre><p>printf(â€œæ¹¿åº¦: %d.%d%% æ¸©åº¦: %d.%dâ„ƒ \r\nâ€,rec_dat[0],rec_dat[1],rec_dat[2],rec_dat[3]);<br>                delayms(2000);<br>            led &#x3D; 1;<br>            led2 &#x3D; 1;<br>            OLED_Clear();</p><pre><code>&#125;</code></pre><p>}<br>&#x2F;&#x2F;DHT11èµ·å§‹ä¿¡å·</p><p>void DHT11_start()<br>{<br>    Temp_data&#x3D;1;<br>    Delayus(10);<br>    Temp_data&#x3D;0;<br>     delayms(25);&#x2F;&#x2F;è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®<br>    Temp_data&#x3D;1;<br>    Delayus(50);&#x2F;&#x2F;MCUé‡Šæ”¾æ€»çº¿20~40us,éœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´<br>&#x2F;&#x2F;if(Temp_data&#x3D;&#x3D;0){<br>&#x2F;&#x2F;led&#x3D;0;&#x2F;&#x2F;æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·<br>            &#x2F;&#x2F; while(Temp_data&#x3D;&#x3D;0); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿,è·³è¿‡ME<br>       &#x2F;&#x2F; Delayus(80);  &#x2F;&#x2F;50æ‹‰é«˜åå»¶æ—¶80us<br>            &#x2F;&#x2F; while(Temp_data&#x3D;&#x3D;1);ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿,ç­‰å¾…æ‹‰ä½,è·³è¿‡EF<br>&#x2F;&#x2F;}else{led&#x3D;1;}</p><p>}</p><p>&#x2F;&#x2F;æ¥æ”¶ä¸€ä¸ªå­—èŠ‚<br>unsigned char DHT11_rec_byte()<br>{<br>    unsigned char i,dat&#x3D;0;<br>    for(i&#x3D;0; i&lt;8; i++)<br>    {<br>        while(!Temp_data);&#x2F;&#x2F;è·³è¿‡æ•°æ®å‰æ®µçš„50us<br>                    Delayus(33);&#x2F;&#x2F;è¿‡äº†æ•°æ®0å’Œæ•°æ®1ç›¸åŒåŒºåŸŸï¼Œå†åšæ£€æµ‹<br>         dat &lt;&lt;&#x3D;1;<br>            if(Temp_data&#x3D;&#x3D;1)<br>        {&#x2F;&#x2F;å¦‚æœè¯»åˆ°çš„æ•°æ®æ˜¯1<br>                      dat +&#x3D;1;<br>        }<br>            while(Temp_data);<br>    }<br>    return dat;<br>}<br>&#x2F;&#x2F;æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®<br>void DHT11_receive()<br>{<br>    unsigned int R_H,R_L,T_H,T_L;<br>    unsigned char RH,RL,TH,TL,revise;<br>        DHT11_start();<br>        if(Temp_data&#x3D;&#x3D;0)<br>    {led&#x3D;0;&#x2F;&#x2F;æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·<br>            while(Temp_data&#x3D;&#x3D;0); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿<br>            while(Temp_data&#x3D;&#x3D;1); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿</p><pre><code>    R_H=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦é«˜å…«ä½    R_L=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦ä½å…«ä½    T_H=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦é«˜å…«ä½    T_L=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦ä½å…«ä½    revise=DHT11_rec_byte(); //æ¥æ”¶æ ¡æ­£ä½    Delayus(25);    //ç»“æŸ            /******ä¸²å£æ‰“å°******/</code></pre><p>&#x2F;&#x2F;printf(â€œæ¹¿åº¦: %d.%d%% æ¸©åº¦: %d.%dâ„ƒ \r\nâ€,R_H,R_L,T_H,T_L);</p><pre><code>    if((R_H+R_L+T_H+T_L)==revise)      //æ ¡æ­£    &#123;         led2 = 0;        RH=R_H;        RL=R_L;        TH=T_H;        TL=T_L;            &#125;    /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/    rec_dat[0]=RH;    rec_dat[1]=RL;    rec_dat[2]=TH;    rec_dat[3]=TL;            </code></pre><p>  }else{led&#x3D;1;}<br>}&#96;</p><ul><li>ä¿®è®¢å†…å®¹å’Œæ—¶é—´ï¼ˆ2022-5-10ï¼‰</li></ul><p>å¯¹äºprintfæ‰“å°è¾“å‡ºï¼Œè¿›è¡Œè°ƒæ•´ã€‚ å…·ä½“ç»†èŠ‚å‚è€ƒã€Šprintfå‡½æ•°åœ¨Keil å¼€å‘C51å•ç‰‡æœºå½“ä¸­çš„ä½¿ç”¨ç»†èŠ‚ã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/124656745">printfå‡½æ•°åœ¨Keil å¼€å‘C51å•ç‰‡æœºå½“ä¸­çš„ä½¿ç”¨ç»†èŠ‚</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">printf(&quot;DHT11 TEMP:%02bd.%02bd;Hum:%02bd.%02bd \n&quot;, rec_dat[0], rec_dat[1], rec_dat[2], rec_dat[3]);</span><br><span class="line"></span><br><span class="line">/******ä¸²å£æ‰“å°******/ </span><br><span class="line">printf(&quot;æ¸©åº¦:%gâ„ƒ\r\n&quot;,tem);</span><br><span class="line">printf(&quot;æ¹¿åº¦:%gï¼…\r\n&quot;,hum);</span><br></pre></td></tr></table></figure><p>&#96;printf(â€œDHT11 TEMP:%02bd.%02bd;Hum:%02bd.%02bd \nâ€, rec_dat[0], rec_dat[1], rec_dat[2], rec_dat[3]);</p><pre><code>        /******ä¸²å£æ‰“å°******/     printf(&quot;æ¸©åº¦:%gâ„ƒ\r\n&quot;,tem);    printf(&quot;æ¹¿åº¦:%gï¼…\r\n&quot;,hum);`</code></pre><h4 id="ğŸ“šç¨‹åºæºç "><a href="#ğŸ“šç¨‹åºæºç " class="headerlink" title="ğŸ“šç¨‹åºæºç "></a>ğŸ“šç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Y-tt0B5LF2tccMheX0RRxQ </span><br><span class="line">æå–ç ï¼š139y</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Y-tt0B5LF2tccMheX0RRxQ  æå–ç ï¼š139y</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>TM1638èŠ¯ç‰‡çš„æ˜¾å­˜åœ°å€è¯¦ç»†è§£è¯»</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-TM1638%E8%8A%AF%E7%89%87%E7%9A%84%E6%98%BE%E5%AD%98%E5%9C%B0%E5%9D%80%E8%AF%A6%E7%BB%86%E8%A7%A3%E8%AF%BB/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-TM1638%E8%8A%AF%E7%89%87%E7%9A%84%E6%98%BE%E5%AD%98%E5%9C%B0%E5%9D%80%E8%AF%A6%E7%BB%86%E8%A7%A3%E8%AF%BB/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="TM1638èŠ¯ç‰‡çš„æ˜¾å­˜åœ°å€è¯¦ç»†è§£è¯»"><a href="#TM1638èŠ¯ç‰‡çš„æ˜¾å­˜åœ°å€è¯¦ç»†è§£è¯»" class="headerlink" title="TM1638èŠ¯ç‰‡çš„æ˜¾å­˜åœ°å€è¯¦ç»†è§£è¯»"></a>TM1638èŠ¯ç‰‡çš„æ˜¾å­˜åœ°å€è¯¦ç»†è§£è¯»</h1><h3 id="TM1638èŠ¯ç‰‡çš„æ˜¾å­˜åœ°å€è¯¦ç»†è§£è¯»-1"><a href="#TM1638èŠ¯ç‰‡çš„æ˜¾å­˜åœ°å€è¯¦ç»†è§£è¯»-1" class="headerlink" title="TM1638èŠ¯ç‰‡çš„æ˜¾å­˜åœ°å€è¯¦ç»†è§£è¯»"></a>TM1638èŠ¯ç‰‡çš„æ˜¾å­˜åœ°å€è¯¦ç»†è§£è¯»</h3><ul><li>ç›¸å…³ç¯‡ã€ŠArduino UNO åˆ©ç”¨3ä¸ªIOå£ + TM1638+é©±åŠ¨8ä½æ•°ç ç®¡æ˜¾ç¤º+24ä¸ªç‹¬ç«‹æŒ‰é”®ã€‹</li><li>ã€Š51å•ç‰‡æœºé©±åŠ¨TM1638èŠ¯ç‰‡+Proteusä»¿çœŸã€‹</li><li>ã€ŠArduino UNO + DS1302 + TM1638æ—¶é—´æ˜¾ç¤º+Proteusä»¿çœŸäºŒã€‹</li><li>ã€ŠArduino UNO + DS1302 + TM1638æ—¶é—´æ˜¾ç¤º+Proteusä»¿çœŸã€‹</li><li>é©±åŠ¨8ä½å…±é˜´æ•°ç ç®¡ä»¿çœŸ</li><li>é©±åŠ¨ç‹¬ç«‹çš„24ä¸ªæŒ‰é”®å¹¶æ˜¾ç¤ºä»¿çœŸ</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/121914458">Arduino UNO åˆ©ç”¨3ä¸ªIOå£ + TM1638+é©±åŠ¨8ä½æ•°ç ç®¡æ˜¾ç¤º+24ä¸ªç‹¬ç«‹æŒ‰é”®</a></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/121942355">51å•ç‰‡æœºé©±åŠ¨TM1638èŠ¯ç‰‡+Proteusä»¿çœŸ</a></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/121881461">Arduino UNO + DS1302 + TM1638æ—¶é—´æ˜¾ç¤º+Proteusä»¿çœŸäºŒ</a></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/121879483">Arduino UNO + DS1302 + TM1638æ—¶é—´æ˜¾ç¤º+Proteusä»¿çœŸ</a></p><p><img src="https://img-blog.csdnimg.cn/990da67ce57d43b4aed0405903acb991.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/fdd8a9c2d8b141ef820018ed5e591df7.gif#pic_center#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™ä¸€ç¯‡å•ç‹¬æ¥è®²é©±åŠ¨å‰©ä½™çš„ä¸¤ç»„SEG8-SEG9ä¸¤ä¸ªIOå£é©±åŠ¨2X8LEDç¯ã€‚</p><p><code>2X8</code></p><ul><li>ç”µè·¯è¿æ¥å›¾</li></ul><p><img src="https://img-blog.csdnimg.cn/76dd3703358a4e0abdaf8826622b83fe.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å›åˆ°TM1638æ•°æ®æ‰‹å†Œçœ‹å¯¹åº”éƒ¨åˆ†çš„å†…å®¹"><a href="#å›åˆ°TM1638æ•°æ®æ‰‹å†Œçœ‹å¯¹åº”éƒ¨åˆ†çš„å†…å®¹" class="headerlink" title="å›åˆ°TM1638æ•°æ®æ‰‹å†Œçœ‹å¯¹åº”éƒ¨åˆ†çš„å†…å®¹"></a>å›åˆ°TM1638æ•°æ®æ‰‹å†Œçœ‹å¯¹åº”éƒ¨åˆ†çš„å†…å®¹</h4><p>éœ€è¦å•ç‹¬ç‚¹äº®LEDç¯ï¼Œéœ€è¦åˆ©ç”¨å›ºå®šåœ°å€æ¨¡å¼ç»™æŒ‡å®šçš„åœ°å€å†™æ•°æ®ã€‚</p><h5 id="å›ºå®šåœ°å€æ¨¡å¼"><a href="#å›ºå®šåœ°å€æ¨¡å¼" class="headerlink" title="å›ºå®šåœ°å€æ¨¡å¼"></a>å›ºå®šåœ°å€æ¨¡å¼</h5><p>ä½¿ç”¨å›ºå®šåœ°å€æ¨¡å¼ï¼Œè®¾ç½®åœ°å€å…¶å®é™…ä¸Šæ˜¯è®¾ç½®éœ€è¦ä¼ é€çš„1BYTEæ•°æ®å­˜æ”¾çš„åœ°å€ã€‚åœ°å€å‘é€å®Œ æ¯•ï¼Œâ€œSTBâ€ä¸éœ€è¦ç½®é«˜ï¼Œç´§è·Ÿç€ä¼ 1BYTEæ•°æ®ï¼Œæ•°æ®ä¼ é€å®Œæ¯•æ‰å°†â€œSTBâ€ç½®é«˜ã€‚ç„¶åé‡æ–°è®¾ç½®ç¬¬2 ä¸ªæ•°æ®éœ€è¦å­˜æ”¾çš„åœ°å€ï¼Œæœ€å¤š14BYTEæ•°æ®ä¼ é€å®Œæ¯•ï¼Œâ€œSTBâ€ç½®é«˜ã€‚</p><ul><li>å›ºå®šåœ°å€æ¨¡å¼ä¸‹é€šè®¯æ—¶åºå›¾</li><li>æµç¨‹å›¾</li></ul><p><img src="https://img-blog.csdnimg.cn/92b9f75382ab48a898a4cae125132c9e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/e6a0df74ff394a5cb2efee1d2e4733f8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ“ä½œæ­¥éª¤ï¼š"><a href="#æ“ä½œæ­¥éª¤ï¼š" class="headerlink" title="æ“ä½œæ­¥éª¤ï¼š"></a>æ“ä½œæ­¥éª¤ï¼š</h4><ol><li>åˆå§‹åŒ–éƒ¨åˆ†ï¼Œè®¾ç½®å†™æ˜¾å­˜çš„æ•°æ®å‘½ä»¤ï¼Œå¦‚æœæ˜¯é‡‡ç”¨åœ°å€è‡ªåŠ¨åŠ  1ï¼Œé‚£ä¹ˆåˆå§‹åœ°å€å°±æ˜¯0x40,</li></ol><p><code>0x40</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">void Write_COM(unsigned char cmd)//å‘é€å‘½ä»¤å­—</span><br><span class="line">&#123;</span><br><span class="line">STB=0;</span><br><span class="line">TM1638_Write(cmd);</span><br><span class="line">STB=1;</span><br><span class="line">&#125;</span><br><span class="line">//TM1638åˆå§‹åŒ–å‡½æ•°</span><br><span class="line">void init_TM1638(void)</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i;</span><br><span class="line">Write_COM(0x8b);       //äº®åº¦ (0x88-0x8f)8çº§äº®åº¦å¯è°ƒ</span><br><span class="line">Write_COM(0x40);       //é‡‡ç”¨åœ°å€è‡ªåŠ¨åŠ 1</span><br><span class="line">STB=0;           //</span><br><span class="line">TM1638_Write(0xc0);    //è®¾ç½®èµ·å§‹åœ°å€</span><br><span class="line">for(i=0;i&lt;16;i++)   //ä¼ é€16ä¸ªå­—èŠ‚çš„æ•°æ®0x00-0x0f</span><br><span class="line">TM1638_Write(0x00);</span><br><span class="line">STB=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>void Write_COM(unsigned char cmd)//å‘é€å‘½ä»¤å­— &#123;     STB=0;     TM1638_Write(cmd);     STB=1; &#125; //TM1638åˆå§‹åŒ–å‡½æ•° void init_TM1638(void) &#123;     unsigned char i;     Write_COM(0x8b);       //äº®åº¦ (0x88-0x8f)8çº§äº®åº¦å¯è°ƒ     Write_COM(0x40);       //é‡‡ç”¨åœ°å€è‡ªåŠ¨åŠ 1     STB=0;           //     TM1638_Write(0xc0);    //è®¾ç½®èµ·å§‹åœ°å€     for(i=0;i&lt;16;i++)   //ä¼ é€16ä¸ªå­—èŠ‚çš„æ•°æ®0x00-0x0f     TM1638_Write(0x00);     STB=1; &#125;</code></p><p>2.è®¾ç½®æ˜¾ç¤ºæ¨¡å¼ï¼šå›ºå®šæ¨¡å¼ï¼Œå†™æŒ‡å®šåœ°å€ç”¨æ¥ç‚¹äº®å¯¹åº”çš„LEDç¯</p><p>è¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹ï¼Œå†™æ³•æœ‰å¾ˆå¤šï¼Œæ ¹æ®ä¸ªäººå–œå¥½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/*****æŒ‡å®šåœ°å€å†™å…¥æ•°æ®*******/</span><br><span class="line">void Write_DATA(unsigned char addr,unsigned char DATA)//æŒ‡å®šåœ°å€å†™å…¥æ•°æ®</span><br><span class="line">&#123;</span><br><span class="line">Write_COM(0x44);//è®¾ç½®å†™æ˜¾å­˜çš„æ•°æ®å‘½ä»¤,é‡‡ç”¨å›ºå®šåœ°å€</span><br><span class="line">STB=0;</span><br><span class="line">TM1638_Write(0xc0|addr);C0èµ·å§‹åœ°å€+ledä½ç½®åœ°å€</span><br><span class="line">_nop_();</span><br><span class="line">TM1638_Write(DATA);</span><br><span class="line">STB=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>/*****æŒ‡å®šåœ°å€å†™å…¥æ•°æ®*******/ void Write_DATA(unsigned char addr,unsigned char DATA)//æŒ‡å®šåœ°å€å†™å…¥æ•°æ® &#123;     Write_COM(0x44);//è®¾ç½®å†™æ˜¾å­˜çš„æ•°æ®å‘½ä»¤,é‡‡ç”¨å›ºå®šåœ°å€     STB=0;     TM1638_Write(0xc0|addr);C0èµ·å§‹åœ°å€+ledä½ç½®åœ°å€     _nop_();     TM1638_Write(DATA);     STB=1; &#125;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/*****å›ºå®šåœ°å€ä¼ é€*******/</span><br><span class="line">void TM1638_display_Fix(unsigned char add,unsigned char DATA)</span><br><span class="line">&#123;//å›ºå®šåœ°å€ä¼ é€</span><br><span class="line">Write_COM(0X44);</span><br><span class="line">STB=0;</span><br><span class="line">TM1638_Write(0xC0+2*add);</span><br><span class="line">_nop_();</span><br><span class="line">TM1638_Write(buff[DATA]);</span><br><span class="line">STB=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>/*****å›ºå®šåœ°å€ä¼ é€*******/ void TM1638_display_Fix(unsigned char add,unsigned char DATA) &#123;//å›ºå®šåœ°å€ä¼ é€     Write_COM(0X44);     STB=0;     TM1638_Write(0xC0+2*add);         _nop_();     TM1638_Write(buff[DATA]);     STB=1; &#125;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">void Write_oneLED(unsigned char num,unsigned char flag)//å•ç‹¬æ§åˆ¶ä¸€ä¸ªLEDå‡½æ•°ï¼Œnumä¸ºéœ€è¦æ§åˆ¶çš„ledåºå·ï¼Œflagä¸º0æ—¶ç†„ç­ï¼Œä¸ä¸º0æ—¶ç‚¹äº®</span><br><span class="line">&#123;</span><br><span class="line">unsigned char TM1638_Addr_LED[8]= &#123;0xc1,0xC3,0xC5,0xC7,0xC9,0xCB,0xCD,0xCF&#125;; //æ¨¡å—ä»å³åˆ°å·¦çš„å…«ä¸ªå‘å…‰äºŒæç®¡</span><br><span class="line">Write_COM(0x44);</span><br><span class="line">if(flag)</span><br><span class="line">&#123;</span><br><span class="line">Write_COM(0x44);//è®¾ç½®å†™æ˜¾å­˜çš„æ•°æ®å‘½ä»¤,é‡‡ç”¨å›ºå®šåœ°å€</span><br><span class="line">STB=0;</span><br><span class="line">TM1638_Write(TM1638_Addr_LED[num]);//C0èµ·å§‹åœ°å€ï¼Œ</span><br><span class="line">TM1638_Write(flag);</span><br><span class="line">STB=1;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">Write_COM(0x44);//è®¾ç½®å†™æ˜¾å­˜çš„æ•°æ®å‘½ä»¤,é‡‡ç”¨å›ºå®šåœ°å€</span><br><span class="line">STB=0;</span><br><span class="line">TM1638_Write(TM1638_Addr_LED[num]);//C0èµ·å§‹åœ°å€ï¼Œ</span><br><span class="line">TM1638_Write(flag);</span><br><span class="line">STB=1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>void Write_oneLED(unsigned char num,unsigned char flag)//å•ç‹¬æ§åˆ¶ä¸€ä¸ªLEDå‡½æ•°ï¼Œnumä¸ºéœ€è¦æ§åˆ¶çš„ledåºå·ï¼Œflagä¸º0æ—¶ç†„ç­ï¼Œä¸ä¸º0æ—¶ç‚¹äº® &#123; unsigned char TM1638_Addr_LED[8]= &#123;0xc1,0xC3,0xC5,0xC7,0xC9,0xCB,0xCD,0xCF&#125;; //æ¨¡å—ä»å³åˆ°å·¦çš„å…«ä¸ªå‘å…‰äºŒæç®¡     Write_COM(0x44);     if(flag)     &#123;     Write_COM(0x44);//è®¾ç½®å†™æ˜¾å­˜çš„æ•°æ®å‘½ä»¤,é‡‡ç”¨å›ºå®šåœ°å€     STB=0;     TM1638_Write(TM1638_Addr_LED[num]);//C0èµ·å§‹åœ°å€ï¼Œ     TM1638_Write(flag);     STB=1;     &#125;     else&#123;     Write_COM(0x44);//è®¾ç½®å†™æ˜¾å­˜çš„æ•°æ®å‘½ä»¤,é‡‡ç”¨å›ºå®šåœ°å€     STB=0;     TM1638_Write(TM1638_Addr_LED[num]);//C0èµ·å§‹åœ°å€ï¼Œ     TM1638_Write(flag);     STB=1;     &#125; &#125;</code></p><ul><li>8ä¸ªledçš„åœ°å€ï¼Œä¾æ¬¡ä¸ºled1-led8</li><li>unsigned char TM1638_Addr_LED[8]&#x3D; {0xc1,0xC3,0xC5,0xC7,0xC9,0xCB,0xCD,0xCF};</li></ul><p><code>unsigned char TM1638_Addr_LED[8]= &#123;0xc1,0xC3,0xC5,0xC7,0xC9,0xCB,0xCD,0xCF&#125;;</code></p><p>è§£æï¼šä¸ºä»€ä¹ˆåœ°å€ä¸æ˜¯0x01,ä»ä¸Šé¢çš„æµç¨‹å›¾ä¸Šç¬¬ä¸‰æ­¥ï¼Œå¯ä»¥çœ‹åˆ°è®¾ç½®åˆå§‹åŒ–åœ°å€ä½è®¾ç½®èµ·å§‹åœ° å€ ï¼š0xC0,å†ä¾æ®ä¸‹é¢çš„èµŒèµ¢å…³ç³»æˆ‘ä»¬å¯ä»¥æ¨æµ‹ï¼ŒæŒ‡å®šLEDç¯çš„å…·ä½“åœ°å€ï¼šåˆå§‹åœ°å€0xC0 + LEDåœ°å€</p><p><code>0x01</code></p><p><code>0xC0</code></p><p><code>0xC0</code></p><p><code>LEDåœ°å€</code></p><ul><li>åˆå§‹åœ°å€0xC0 + 0x01,0x03,0x05,0x07,0x09,0x0B,0x0D,0x0F,ä¹Ÿå°±æ˜¯ä¸Šé¢çš„æ•°ç»„ã€‚</li></ul><p><code>0xC0 + 0x01</code></p><p><code>0x03</code></p><p><code>0x05</code></p><p><code>0x07</code></p><p><code>0x09</code></p><p><code>0x0B</code></p><p><code>0x0D</code></p><p><code>0x0F</code></p><p><img src="https://img-blog.csdnimg.cn/439b1abf001445dfa28d61072b216006.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>æ‰¾åˆ°äº†åœ°å€åï¼Œç°åœ¨å°±æ˜¯å†™å€¼ã€‚ç»„ä¸€ï¼ˆSEG9ï¼‰,å’Œç»„äºŒï¼ˆSEG10ï¼‰</li><li>SEG9LEDç¯</li><li>SEG9LEDç¯</li><li>å‚ç…§ä¸‹å›¾ï¼šç‚¹äº®LED1-LED8ï¼Œé‚£ä¹ˆåªéœ€è¦å†™B0çš„bitä½å†™0x01å³å¯ã€‚0000 0001ï¼ˆä¾ç…§ä¸‹é¢çš„bitä½æ’åˆ—é¡ºåºï¼‰</li><li>åŒç†ï¼ŒSEG10è¿™ç»„çš„LED1-LED8ï¼Œé‚£ä¹ˆåªéœ€è¦å†™0x02å³å¯ã€‚0000 0010ï¼Œï¼ˆä¾ç…§ä¸‹é¢çš„bitä½æ’åˆ—é¡ºåºï¼‰</li><li>åŒç†ï¼ŒSEG10è¿™ç»„çš„LED1-LED8ï¼Œé‚£ä¹ˆåªéœ€è¦å†™0x02å³å¯ã€‚0000 0010ï¼Œï¼ˆä¾ç…§ä¸‹é¢çš„bitä½æ’åˆ—é¡ºåºï¼‰</li></ul><p>æ‰¾åˆ°äº†åœ°å€åï¼Œç°åœ¨å°±æ˜¯å†™å€¼ã€‚ç»„ä¸€ï¼ˆSEG9ï¼‰,å’Œç»„äºŒï¼ˆSEG10ï¼‰</p><ul><li>SEG9LEDç¯</li></ul><p><code>SEG9</code></p><p><img src="https://img-blog.csdnimg.cn/a778e984891e419ea96ae2507be47b3d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‚ç…§ä¸‹å›¾ï¼šç‚¹äº®LED1-LED8ï¼Œé‚£ä¹ˆåªéœ€è¦å†™B0çš„bitä½å†™0x01å³å¯ã€‚0000 0001ï¼ˆä¾ç…§ä¸‹é¢çš„bitä½æ’åˆ—é¡ºåºï¼‰</p><p><code>LED1-LED8</code></p><p><code>0x01</code></p><p><code>0000 0001</code></p><p><img src="https://img-blog.csdnimg.cn/4afeb71567014d2ea2d1193865adc1da.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>åŒç†ï¼ŒSEG10è¿™ç»„çš„LED1-LED8ï¼Œé‚£ä¹ˆåªéœ€è¦å†™0x02å³å¯ã€‚0000 0010ï¼Œï¼ˆä¾ç…§ä¸‹é¢çš„bitä½æ’åˆ—é¡ºåºï¼‰</li></ul><p><code>SEG10</code></p><p><code>LED1-LED8</code></p><p><code>0x02</code></p><p><code>0000 0010</code></p><p><img src="https://img-blog.csdnimg.cn/bb42bf5fc29b4cfa9a64dad61867a5e0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;REGX51.H&gt;</span><br><span class="line">#include&lt;tm1638.h&gt;</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line">unsigned char num[8];//å„ä¸ªæ•°ç ç®¡æ˜¾ç¤ºçš„å€¼</span><br><span class="line">//8ä¸ªledçš„åœ°å€ï¼Œä¾æ¬¡ä¸ºled1-led8</span><br><span class="line">const unsigned char TM1638_LedAddrTab[] =</span><br><span class="line">&#123;</span><br><span class="line">0xC1,0xC3,0xC5,0xC7,0xC9,0xCB,0xCD,0xCF</span><br><span class="line">&#125;;</span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i;</span><br><span class="line">init_TM1638();                           //åˆå§‹åŒ–TM1638</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">Write_DATA(2*i,tab[16]);//åˆå§‹åŒ–å¯„å­˜å™¨,æ˜¾ç¤º&quot;--- ----&quot;</span><br><span class="line">Delay1000ms();</span><br><span class="line"></span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">for(i=0;i&lt;8;i++)&#123;//LEDç¯é—ªçƒ</span><br><span class="line">Write_oneLED(i,1);//0-7ä½ç½®.1å¯¹åº”SEG9çš„LEDç¯</span><br><span class="line"> Write_oneLED(i,2);//0-7ä½ç½®.2å¯¹åº”SEG10çš„LEDç¯</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line">for(i=0;i&lt;8;i++)&#123;//æ˜¾ç¤º01234567</span><br><span class="line">Write_DATA(2*i,tab[i]);Delay1000ms();&#125;</span><br><span class="line"></span><br><span class="line">for(i=0;i&lt;8;i++)&#123;//æ˜¾ç¤ºå¸¦ç‚¹çš„01234567</span><br><span class="line">TM1638_display_Fix(i,18-i);Delay1000ms();&#125;</span><br><span class="line"></span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">Write_DATA(2*i,tab[17]);//åˆå§‹åŒ–å¯„å­˜å™¨,ç†„ç­</span><br><span class="line">*/</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include&lt;REGX51.H&gt;<br>#include&lt;tm1638.h&gt;<br>#include&lt;intrins.h&gt;<br>unsigned char num[8];&#x2F;&#x2F;å„ä¸ªæ•°ç ç®¡æ˜¾ç¤ºçš„å€¼<br>&#x2F;&#x2F;8ä¸ªledçš„åœ°å€ï¼Œä¾æ¬¡ä¸ºled1-led8<br>const unsigned char TM1638_LedAddrTab[] &#x3D;<br>{<br>    0xC1,0xC3,0xC5,0xC7,0xC9,0xCB,0xCD,0xCF<br>};<br>int main(void)<br>{<br>    unsigned char i;<br>    init_TM1638();                           &#x2F;&#x2F;åˆå§‹åŒ–TM1638<br>    for(i&#x3D;0;i&lt;8;i++)<br>    Write_DATA(2*i,tab[16]);&#x2F;&#x2F;åˆå§‹åŒ–å¯„å­˜å™¨,æ˜¾ç¤ºâ€â€” â€”-â€œ<br>    Delay1000ms();</p><pre><code>while(1)&#123;        for(i=0;i&lt;8;i++)&#123;//LEDç¯é—ªçƒWrite_oneLED(i,1);//0-7ä½ç½®.1å¯¹åº”SEG9çš„LEDç¯ Write_oneLED(i,2);//0-7ä½ç½®.2å¯¹åº”SEG10çš„LEDç¯        &#125;</code></pre><p>&#x2F;*<br>            for(i&#x3D;0;i&lt;8;i++){&#x2F;&#x2F;æ˜¾ç¤º01234567<br>    Write_DATA(2*i,tab[i]);Delay1000ms();}</p><pre><code>for(i=0;i&lt;8;i++)&#123;//æ˜¾ç¤ºå¸¦ç‚¹çš„01234567TM1638_display_Fix(i,18-i);Delay1000ms();&#125;            for(i=0;i&lt;8;i++)Write_DATA(2*i,tab[17]);//åˆå§‹åŒ–å¯„å­˜å™¨,ç†„ç­</code></pre><p>*&#x2F;<br>}<br>}&#96;</p><p><img src="https://img-blog.csdnimg.cn/53629b0a5bed453e9668b2a722b4f7e6.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œå›´ç»•TM1638èŠ¯ç‰‡åŸºæœ¬åŠŸèƒ½éƒ½å·²ç»åšå®Œäº†é™¤äº†å…±é˜³æ•°ç ç®¡çš„é©±åŠ¨ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå…¨é è‡ªå·±ä¸æ–­é‡‡å‘æ‘¸ç´¢å’Œæ€»ç»“ã€‚"><a href="#åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œå›´ç»•TM1638èŠ¯ç‰‡åŸºæœ¬åŠŸèƒ½éƒ½å·²ç»åšå®Œäº†é™¤äº†å…±é˜³æ•°ç ç®¡çš„é©±åŠ¨ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå…¨é è‡ªå·±ä¸æ–­é‡‡å‘æ‘¸ç´¢å’Œæ€»ç»“ã€‚" class="headerlink" title="åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œå›´ç»•TM1638èŠ¯ç‰‡åŸºæœ¬åŠŸèƒ½éƒ½å·²ç»åšå®Œäº†é™¤äº†å…±é˜³æ•°ç ç®¡çš„é©±åŠ¨ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå…¨é è‡ªå·±ä¸æ–­é‡‡å‘æ‘¸ç´¢å’Œæ€»ç»“ã€‚"></a>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œå›´ç»•TM1638èŠ¯ç‰‡åŸºæœ¬åŠŸèƒ½éƒ½å·²ç»åšå®Œäº†é™¤äº†å…±é˜³æ•°ç ç®¡çš„é©±åŠ¨ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå…¨é è‡ªå·±ä¸æ–­é‡‡å‘æ‘¸ç´¢å’Œæ€»ç»“ã€‚</h5><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1bvGm7squ7-1ejPGEaHfQXA </span><br><span class="line">æå–ç ï¼šdt68</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1bvGm7squ7-1ejPGEaHfQXA  æå–ç ï¼šdt68</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Proteusä»¿çœŸDHT11å’Œå®é™…ç¡¬ä»¶çš„å·®å¼‚ä»¥åŠè¯»ä¸åˆ°æ•°æ®åŸå› åˆ†æ</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FDHT11%E5%92%8C%E5%AE%9E%E9%99%85%E7%A1%AC%E4%BB%B6%E7%9A%84%E5%B7%AE%E5%BC%82%E4%BB%A5%E5%8F%8A%E8%AF%BB%E4%B8%8D%E5%88%B0%E6%95%B0%E6%8D%AE%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FDHT11%E5%92%8C%E5%AE%9E%E9%99%85%E7%A1%AC%E4%BB%B6%E7%9A%84%E5%B7%AE%E5%BC%82%E4%BB%A5%E5%8F%8A%E8%AF%BB%E4%B8%8D%E5%88%B0%E6%95%B0%E6%8D%AE%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="Proteusä»¿çœŸDHT11å’Œå®é™…ç¡¬ä»¶çš„å·®å¼‚ä»¥åŠè¯»ä¸åˆ°æ•°æ®åŸå› åˆ†æ"><a href="#Proteusä»¿çœŸDHT11å’Œå®é™…ç¡¬ä»¶çš„å·®å¼‚ä»¥åŠè¯»ä¸åˆ°æ•°æ®åŸå› åˆ†æ" class="headerlink" title="Proteusä»¿çœŸDHT11å’Œå®é™…ç¡¬ä»¶çš„å·®å¼‚ä»¥åŠè¯»ä¸åˆ°æ•°æ®åŸå› åˆ†æ"></a>Proteusä»¿çœŸDHT11å’Œå®é™…ç¡¬ä»¶çš„å·®å¼‚ä»¥åŠè¯»ä¸åˆ°æ•°æ®åŸå› åˆ†æ</h1><h3 id="Proteusä»¿çœŸDHT11å’Œå®é™…ç¡¬ä»¶çš„å·®å¼‚ä»¥åŠè¯»ä¸åˆ°æ•°æ®åŸå› åˆ†æ-1"><a href="#Proteusä»¿çœŸDHT11å’Œå®é™…ç¡¬ä»¶çš„å·®å¼‚ä»¥åŠè¯»ä¸åˆ°æ•°æ®åŸå› åˆ†æ-1" class="headerlink" title="Proteusä»¿çœŸDHT11å’Œå®é™…ç¡¬ä»¶çš„å·®å¼‚ä»¥åŠè¯»ä¸åˆ°æ•°æ®åŸå› åˆ†æ"></a>Proteusä»¿çœŸDHT11å’Œå®é™…ç¡¬ä»¶çš„å·®å¼‚ä»¥åŠè¯»ä¸åˆ°æ•°æ®åŸå› åˆ†æ</h3><p><img src="https://img-blog.csdnimg.cn/061dc02343c7436e977c3cc49f6ccc77.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨Proteusä»¿çœŸé‡Œé¢ï¼Œä»¿çœŸLCD1602æ˜¾ç¤ºDHT11æ•°æ®ï¼Œå‘ç°ä¸èƒ½æ˜¾ç¤ºï¼Œæœ‰ç‚¹å°´å°¬ï¼Œè¯»å–DHT11æ˜æ˜æ˜¯æŒ‰ç…§æ•°æ®æ‰‹å†Œä¸Šçš„æ—¶åºæ¥å†™çš„ï¼Œä¸ºä»€ä¹ˆä¸èƒ½æ˜¾ç¤ºï¼Ÿ</p><ul><li>ç¬¬ä¸€ç§åŸå› ï¼Œå¯èƒ½æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨å»¶æ—¶å‡½æ•°çš„æ—¶å€™ï¼Œä¹ æƒ¯ç”¨ä¸‹é¢è¿™ç§å‡½æ•°æ¥å»¶æ—¶ï¼Œè¿™ç§å‡½æ•°åœ¨çš„å»¶æ—¶ç²¾åº¦å¾ˆéš¾ä¿è¯ã€‚</li><li>Proteusä¸­51å•ç‰‡æœºçš„é»˜è®¤æ—¶é’Ÿé¢‘ç‡æ˜¯12MHzã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">void DHT11_delay_us(unsigned char n)</span><br><span class="line">&#123;</span><br><span class="line">    while(--n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>void DHT11_delay_us(unsigned char n) &#123;     while(--n); &#125;</code></p><h4 id="åœ¨è°ƒè¯•é˜¶æ®µï¼Œåœ¨å„ä¸ªæ•°æ®è¯»å–é˜¶æ®µè®¾ç½®æ ‡å¿—ä½ã€‚"><a href="#åœ¨è°ƒè¯•é˜¶æ®µï¼Œåœ¨å„ä¸ªæ•°æ®è¯»å–é˜¶æ®µè®¾ç½®æ ‡å¿—ä½ã€‚" class="headerlink" title="åœ¨è°ƒè¯•é˜¶æ®µï¼Œåœ¨å„ä¸ªæ•°æ®è¯»å–é˜¶æ®µè®¾ç½®æ ‡å¿—ä½ã€‚"></a>åœ¨è°ƒè¯•é˜¶æ®µï¼Œåœ¨å„ä¸ªæ•°æ®è¯»å–é˜¶æ®µè®¾ç½®æ ‡å¿—ä½ã€‚</h4><p>æœ‰æ—¶å€™çœŸçš„ä¸å‡ºæ•°æ®ï¼Œè®©äººæ‘¸ä¸ç€å¤´è„‘ã€‚</p><ul><li>æ€»æ—¶åº</li></ul><p>åœ¨å•ç‰‡æœºæ‹‰é«˜ç”µå¹³æ—¶é—´åœ¨20-40usé˜¶æ®µï¼Œè®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½ï¼Œåˆ¤æ–­æ•°æ®IOå£çŠ¶æ€æ˜¯å¦è¢«DHTæ‹‰ä½ï¼Œå¦‚æœæ‹‰ä½ï¼Œåˆ™ç‚¹äº®Ledç¯ï¼Œç”¨æ¥è§‚å¯Ÿä¿¡å·åˆ°åº•æœ‰æ²¡æœ‰æ‹‰ä½ï¼Œè¿™æ ·å¾ˆç›´è§‚å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">void DHT11_start()</span><br><span class="line">&#123;</span><br><span class="line">    Temp_data=1;</span><br><span class="line">    Delayus(10);</span><br><span class="line">    Temp_data=0;</span><br><span class="line">     delayms(25);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®</span><br><span class="line">    Temp_data=1;</span><br><span class="line">    Delayus(50);//MCUé‡Šæ”¾æ€»çº¿20~40us,éœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´</span><br><span class="line">if(Temp_data==0)&#123;</span><br><span class="line">led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·</span><br><span class="line"> while(Temp_data==0); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿,è·³è¿‡</span><br><span class="line">      Delayus(80);  //50æ‹‰é«˜åå»¶æ—¶80us</span><br><span class="line"> while(Temp_data==1);ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿,ç­‰å¾…æ‹‰ä½,è·³è¿‡EF</span><br><span class="line">&#125;else&#123;led=1;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;void DHT11_start()<br>{<br>    Temp_data&#x3D;1;<br>    Delayus(10);<br>    Temp_data&#x3D;0;<br>     delayms(25);&#x2F;&#x2F;è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®<br>    Temp_data&#x3D;1;<br>    Delayus(50);&#x2F;&#x2F;MCUé‡Šæ”¾æ€»çº¿20~40us,éœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´<br>    if(Temp_data&#x3D;&#x3D;0){<br>                    led&#x3D;0;&#x2F;&#x2F;æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·<br>             while(Temp_data&#x3D;&#x3D;0); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿,è·³è¿‡<br>      Delayus(80);  &#x2F;&#x2F;50æ‹‰é«˜åå»¶æ—¶80us<br>             while(Temp_data&#x3D;&#x3D;1);ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿,ç­‰å¾…æ‹‰ä½,è·³è¿‡EF<br>        }else{led&#x3D;1;}</p><p>}&#96;</p><p><img src="https://img-blog.csdnimg.cn/403664851ae4474dae9ab4c519663ddd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>è¯»æ•°æ®0çš„æ—¶åº</li><li>è¯»æ•°æ®1çš„æ—¶åº</li></ul><p><img src="https://img-blog.csdnimg.cn/9867f562d4f147ce9afc7b6a702cc145.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/ba52d46c122e47a8aa07f12df2993a20.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">/*******************************************************************************</span><br><span class="line">* å®éªŒå   :æ¸©åº¦æ˜¾ç¤ºå®éªŒ</span><br><span class="line">* ä½¿ç”¨çš„IO     :</span><br><span class="line">* å®éªŒæ•ˆæœ       :1602æ˜¾ç¤ºæ¸©åº¦</span><br><span class="line">*æ³¨æ„ ï¼š</span><br><span class="line">*******************************************************************************/</span><br><span class="line"></span><br><span class="line">#include&lt;reg51.h&gt;</span><br><span class="line">#include&quot;lcd.h&quot;</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">sbit Temp_data=P3^6;</span><br><span class="line">/*******************************************************************************</span><br><span class="line">* å‡½æ•°å         : main</span><br><span class="line">* å‡½æ•°åŠŸèƒ½   : ä¸»å‡½æ•°</span><br><span class="line">* è¾“å…¥           : æ— </span><br><span class="line">* è¾“å‡º          : æ— </span><br><span class="line">*******************************************************************************/</span><br><span class="line">unsigned int rec_dat[4];</span><br><span class="line"></span><br><span class="line">unsigned char rec_dat_lcd0[6];</span><br><span class="line">unsigned char rec_dat_lcd1[6];</span><br><span class="line">unsigned char rec_dat_lcd2[6];</span><br><span class="line">unsigned char rec_dat_lcd3[6];</span><br><span class="line"></span><br><span class="line">//å®šä¹‰</span><br><span class="line">void DHT11_delay_us(unsigned char n);</span><br><span class="line">void DHT11_delay_ms(unsigned int z);</span><br><span class="line">void DHT11_start();</span><br><span class="line">unsigned char DHT11_rec_byte();</span><br><span class="line">void DHT11_receive();</span><br><span class="line">void InitUART(void);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//ä¸»å‡½æ•°</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    InitUART();</span><br><span class="line">P1=0xf0;</span><br><span class="line">    InitLcd1602();</span><br><span class="line">    LcdShowStr(0,0,&quot;Humi:&quot;);</span><br><span class="line">    LcdShowStr(0,1,&quot;Temp:&quot;);</span><br><span class="line">    EA = 1;                  //å¼€æ€»ä¸­æ–­</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        DHT11_delay_ms(150);</span><br><span class="line">        DHT11_receive();</span><br><span class="line">        sprintf(rec_dat_lcd0,&quot;%d&quot;,rec_dat[0]);</span><br><span class="line">        sprintf(rec_dat_lcd1,&quot;%d&quot;,rec_dat[1]);</span><br><span class="line">        sprintf(rec_dat_lcd2,&quot;%d&quot;,rec_dat[2]);</span><br><span class="line">        sprintf(rec_dat_lcd3,&quot;%d&quot;,rec_dat[3]);</span><br><span class="line">        DHT11_delay_ms(100);</span><br><span class="line"></span><br><span class="line">        //æ¹¿åº¦</span><br><span class="line">        LcdShowStr(6,0,rec_dat_lcd0);</span><br><span class="line">        LcdShowStr(8,0,&quot;.&quot;);</span><br><span class="line">        LcdShowStr(9,0,rec_dat_lcd1);</span><br><span class="line">        LcdShowStr(10,0,&quot; %&quot;);</span><br><span class="line"></span><br><span class="line">        //æ¸©åº¦</span><br><span class="line">        LcdShowStr(6,1,rec_dat_lcd2);</span><br><span class="line">        LcdShowStr(8,1,&quot;.&quot;);</span><br><span class="line">        LcdShowStr(9,1,rec_dat_lcd3);</span><br><span class="line">        LcdShowStr(10,1,&quot;*C&quot;);</span><br><span class="line"></span><br><span class="line">        //ä¸‹é¢é€šè¿‡ä¸²å£åŠ©æ‰‹æ‰“å°æ¸©åº¦</span><br><span class="line">        printf(&quot;Humi:%d.%d %%\n&quot;,rec_dat[0],rec_dat[1]);</span><br><span class="line">        printf(&quot;Temp:%d.%d â„ƒ\n&quot;,rec_dat[2],rec_dat[3]);</span><br><span class="line">DHT11_delay_ms(3000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//DHT11èµ·å§‹ä¿¡å·</span><br><span class="line"></span><br><span class="line">void DHT11_start()</span><br><span class="line">&#123;</span><br><span class="line">    Temp_data=1;</span><br><span class="line"></span><br><span class="line">    DHT11_delay_us(10);</span><br><span class="line"></span><br><span class="line">    Temp_data=0;</span><br><span class="line"></span><br><span class="line">    DHT11_delay_ms(50);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®</span><br><span class="line"></span><br><span class="line">    Temp_data=1;</span><br><span class="line"></span><br><span class="line">    DHT11_delay_us(50);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æ¥æ”¶ä¸€ä¸ªå­—èŠ‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unsigned char DHT11_rec_byte()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char i,dat=0;</span><br><span class="line">    for(i=0; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">while(!Temp_data);//å¼€å§‹å‘é€æ•°æ®ï¼Œ50us</span><br><span class="line">//proteusä»¿çœŸé‡Œé¢ä¸‹é¢çš„å»¶æ—¶èŒƒå›´æœ€å¥½åœ¨10&lt;delay&lt;20,å®é™…ç¡¬ä»¶ç”µè·¯éœ€è¦30usåˆ°40us</span><br><span class="line">        DHT11_delay_us(20);//æ•°æ®é«˜ç”µå¹³é˜¶æ®µåˆ¤æ–­æ•°æ®0è¿˜æ˜¯1</span><br><span class="line">        dat &lt;&lt;=1;</span><br><span class="line">        if(Temp_data==1)</span><br><span class="line">        &#123;</span><br><span class="line">            dat +=1;</span><br><span class="line">        &#125;</span><br><span class="line">        while(Temp_data);</span><br><span class="line">    &#125;</span><br><span class="line">    return dat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®</span><br><span class="line">void DHT11_receive()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int R_H,R_L,T_H,T_L;</span><br><span class="line">    unsigned char RH,RL,TH,TL,revise;</span><br><span class="line"></span><br><span class="line">    DHT11_start();</span><br><span class="line">  //  Temp_data=1;</span><br><span class="line">    if(Temp_data==0)//DHTæ‹‰ä½IOå£ï¼Œå“åº”ä¿¡å·</span><br><span class="line">    &#123;</span><br><span class="line">        while(Temp_data==0);   //ç­‰å¾…æ‹‰é«˜80us</span><br><span class="line">       // DHT11_delay_us(40);  //æ‹‰é«˜åå»¶æ—¶80us</span><br><span class="line">while(Temp_data==1);   //ç­‰å¾…æ‹‰é«˜80us</span><br><span class="line">        R_H=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦é«˜å…«ä½</span><br><span class="line">        R_L=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦ä½å…«ä½</span><br><span class="line">        T_H=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦é«˜å…«ä½</span><br><span class="line">        T_L=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦ä½å…«ä½</span><br><span class="line">        revise=DHT11_rec_byte(); //æ¥æ”¶æ ¡æ­£ä½</span><br><span class="line"></span><br><span class="line">        DHT11_delay_us(25);    //ç»“æŸ</span><br><span class="line"></span><br><span class="line">        if((R_H+R_L+T_H+T_L)==revise)      //æ ¡æ­£</span><br><span class="line">        &#123;</span><br><span class="line">            RH=R_H;</span><br><span class="line">            RL=R_L;</span><br><span class="line">            TH=T_H;</span><br><span class="line">            TL=T_L;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/</span><br><span class="line">        rec_dat[0]=RH;</span><br><span class="line">        rec_dat[1]=RL;</span><br><span class="line">        rec_dat[2]=TH;</span><br><span class="line">        rec_dat[3]=TL;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å»¶æ—¶us   --2*n+5us</span><br><span class="line">void DHT11_delay_us(unsigned char n)</span><br><span class="line">&#123;</span><br><span class="line">    while(--n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å»¶æ—¶ms</span><br><span class="line">void DHT11_delay_ms(unsigned int z)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int i,j;</span><br><span class="line">    for(i=z; i&gt;0; i--)</span><br><span class="line">        for(j=110; j&gt;0; j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void InitUART(void)//ä½¿ç”¨å®šæ—¶å™¨1ä½œä¸ºä¸²å£æ³¢ç‰¹ç‡å‘ç”Ÿå™¨</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    SCON=0x40;//ä¸²å£é€šä¿¡å·¥ä½œæ–¹å¼1</span><br><span class="line">    REN=1;//å…è®¸æ¥æ”¶</span><br><span class="line">    TMOD=0x20;//å®šæ—¶å™¨1çš„å·¥ä½œæ–¹å¼2</span><br><span class="line">    TH1=0xF3,TL1=0xF3;</span><br><span class="line">    TI=1;                       //è¿™é‡Œä¸€å®šè¦æ³¨æ„</span><br><span class="line">    TR1=1;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;*******************************************************************************</p><ul><li>å®éªŒå   :æ¸©åº¦æ˜¾ç¤ºå®éªŒ</li><li>ä½¿ç”¨çš„IO     :</li><li>å®éªŒæ•ˆæœ       :1602æ˜¾ç¤ºæ¸©åº¦</li><li>   æ³¨æ„ ï¼š<br>*******************************************************************************&#x2F;</li></ul><p>#include&lt;reg51.h&gt;<br>#includeâ€lcd.hâ€<br>#include&lt;intrins.h&gt;<br>#include&lt;stdio.h&gt;</p><p>sbit Temp_data&#x3D;P3^6;<br>&#x2F;*******************************************************************************</p><ul><li>å‡½æ•°å         : main</li><li>å‡½æ•°åŠŸèƒ½   : ä¸»å‡½æ•°</li><li>è¾“å…¥           : æ— </li><li>è¾“å‡º          : æ— <br>*******************************************************************************&#x2F;<br>unsigned int rec_dat[4];</li></ul><p>unsigned char rec_dat_lcd0[6];<br>unsigned char rec_dat_lcd1[6];<br>unsigned char rec_dat_lcd2[6];<br>unsigned char rec_dat_lcd3[6];</p><p>&#x2F;&#x2F;å®šä¹‰<br>void DHT11_delay_us(unsigned char n);<br>void DHT11_delay_ms(unsigned int z);<br>void DHT11_start();<br>unsigned char DHT11_rec_byte();<br>void DHT11_receive();<br>void InitUART(void);</p><p>&#x2F;&#x2F;ä¸»å‡½æ•°<br>void main()<br>{<br>    InitUART();<br>        P1&#x3D;0xf0;<br>    InitLcd1602();<br>    LcdShowStr(0,0,â€Humi:â€);<br>    LcdShowStr(0,1,â€Temp:â€);<br>    EA &#x3D; 1;                  &#x2F;&#x2F;å¼€æ€»ä¸­æ–­<br>    while(1)<br>    {<br>        DHT11_delay_ms(150);<br>        DHT11_receive();<br>        sprintf(rec_dat_lcd0,â€%dâ€,rec_dat[0]);<br>        sprintf(rec_dat_lcd1,â€%dâ€,rec_dat[1]);<br>        sprintf(rec_dat_lcd2,â€%dâ€,rec_dat[2]);<br>        sprintf(rec_dat_lcd3,â€%dâ€,rec_dat[3]);<br>        DHT11_delay_ms(100);</p><pre><code>    //æ¹¿åº¦    LcdShowStr(6,0,rec_dat_lcd0);    LcdShowStr(8,0,&quot;.&quot;);    LcdShowStr(9,0,rec_dat_lcd1);    LcdShowStr(10,0,&quot; %&quot;);    //æ¸©åº¦    LcdShowStr(6,1,rec_dat_lcd2);    LcdShowStr(8,1,&quot;.&quot;);    LcdShowStr(9,1,rec_dat_lcd3);    LcdShowStr(10,1,&quot;*C&quot;);    //ä¸‹é¢é€šè¿‡ä¸²å£åŠ©æ‰‹æ‰“å°æ¸©åº¦    printf(&quot;Humi:%d.%d %%\n&quot;,rec_dat[0],rec_dat[1]);    printf(&quot;Temp:%d.%d â„ƒ\n&quot;,rec_dat[2],rec_dat[3]);            DHT11_delay_ms(3000);&#125;</code></pre><p>}</p><p>&#x2F;&#x2F;DHT11èµ·å§‹ä¿¡å·</p><p>void DHT11_start()<br>{<br>    Temp_data&#x3D;1;</p><pre><code>DHT11_delay_us(10);Temp_data=0;DHT11_delay_ms(50);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®Temp_data=1;DHT11_delay_us(50);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­</code></pre><p>}</p><p>&#x2F;&#x2F;æ¥æ”¶ä¸€ä¸ªå­—èŠ‚</p><p>unsigned char DHT11_rec_byte()<br>{<br>    unsigned char i,dat&#x3D;0;<br>    for(i&#x3D;0; i&lt;8; i++)<br>    {<br>            while(!Temp_data);&#x2F;&#x2F;å¼€å§‹å‘é€æ•°æ®ï¼Œ50us<br>            &#x2F;&#x2F;proteusä»¿çœŸé‡Œé¢ä¸‹é¢çš„å»¶æ—¶èŒƒå›´æœ€å¥½åœ¨10&lt;delay&lt;20,å®é™…ç¡¬ä»¶ç”µè·¯éœ€è¦30usåˆ°40us<br>        DHT11_delay_us(20);&#x2F;&#x2F;æ•°æ®é«˜ç”µå¹³é˜¶æ®µåˆ¤æ–­æ•°æ®0è¿˜æ˜¯1<br>        dat &lt;&lt;&#x3D;1;<br>        if(Temp_data&#x3D;&#x3D;1)<br>        {<br>            dat +&#x3D;1;<br>        }<br>        while(Temp_data);<br>    }<br>    return dat;<br>}</p><p>&#x2F;&#x2F;æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®<br>void DHT11_receive()<br>{<br>    unsigned int R_H,R_L,T_H,T_L;<br>    unsigned char RH,RL,TH,TL,revise;</p><pre><code>DHT11_start();</code></pre><p>  &#x2F;&#x2F;  Temp_data&#x3D;1;<br>    if(Temp_data&#x3D;&#x3D;0)&#x2F;&#x2F;DHTæ‹‰ä½IOå£ï¼Œå“åº”ä¿¡å·<br>    {<br>        while(Temp_data&#x3D;&#x3D;0);   &#x2F;&#x2F;ç­‰å¾…æ‹‰é«˜80us<br>       &#x2F;&#x2F; DHT11_delay_us(40);  &#x2F;&#x2F;æ‹‰é«˜åå»¶æ—¶80us<br>while(Temp_data&#x3D;&#x3D;1);   &#x2F;&#x2F;ç­‰å¾…æ‹‰é«˜80us<br>        R_H&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶æ¹¿åº¦é«˜å…«ä½<br>        R_L&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶æ¹¿åº¦ä½å…«ä½<br>        T_H&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶æ¸©åº¦é«˜å…«ä½<br>        T_L&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶æ¸©åº¦ä½å…«ä½<br>        revise&#x3D;DHT11_rec_byte(); &#x2F;&#x2F;æ¥æ”¶æ ¡æ­£ä½</p><pre><code>    DHT11_delay_us(25);    //ç»“æŸ    if((R_H+R_L+T_H+T_L)==revise)      //æ ¡æ­£    &#123;        RH=R_H;        RL=R_L;        TH=T_H;        TL=T_L;    &#125;    /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/    rec_dat[0]=RH;    rec_dat[1]=RL;    rec_dat[2]=TH;    rec_dat[3]=TL;&#125;</code></pre><p>}</p><p>&#x2F;&#x2F;å»¶æ—¶us   â€“2*n+5us<br>void DHT11_delay_us(unsigned char n)<br>{<br>    while(â€“n);<br>}</p><p>&#x2F;&#x2F;å»¶æ—¶ms<br>void DHT11_delay_ms(unsigned int z)<br>{<br>    unsigned int i,j;<br>    for(i&#x3D;z; i&gt;0; iâ€“)<br>        for(j&#x3D;110; j&gt;0; jâ€“);<br>}</p><p>void InitUART(void)&#x2F;&#x2F;ä½¿ç”¨å®šæ—¶å™¨1ä½œä¸ºä¸²å£æ³¢ç‰¹ç‡å‘ç”Ÿå™¨<br>{</p><pre><code>SCON=0x40;//ä¸²å£é€šä¿¡å·¥ä½œæ–¹å¼1REN=1;//å…è®¸æ¥æ”¶TMOD=0x20;//å®šæ—¶å™¨1çš„å·¥ä½œæ–¹å¼2TH1=0xF3,TL1=0xF3;TI=1;                       //è¿™é‡Œä¸€å®šè¦æ³¨æ„TR1=1;</code></pre><p>}&#96;</p><ul><li>lcd.c</li></ul><p><code>lcd.c</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">#include&quot;lcd.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//void Read_Busy()           //å¿™æ£€æµ‹å‡½æ•°ï¼Œåˆ¤æ–­bit7æ˜¯0ï¼Œå…è®¸æ‰§è¡Œï¼›1ç¦æ­¢</span><br><span class="line">//&#123;</span><br><span class="line">//    unsigned char sta;      //</span><br><span class="line">//    LCD1602_DB = 0xff;</span><br><span class="line">//    LCD1602_RS = 0;</span><br><span class="line">//    LCD1602_RW = 1;</span><br><span class="line">//    do</span><br><span class="line">//    &#123;</span><br><span class="line">//        LCD1602_EN = 1;</span><br><span class="line">//        sta = LCD1602_DB;</span><br><span class="line">//        LCD1602_EN = 0;    //ä½¿èƒ½ï¼Œç”¨å®Œå°±æ‹‰ä½ï¼Œé‡Šæ”¾æ€»çº¿</span><br><span class="line">//    &#125;while(sta &amp; 0x80);</span><br><span class="line">//&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void Lcd1602_Write_Cmd(unsigned char cmd)     //å†™å‘½ä»¤</span><br><span class="line">&#123;</span><br><span class="line">    //Read_Busy();</span><br><span class="line">    LCD1602_RS = 0;</span><br><span class="line">    LCD1602_RW = 0;</span><br><span class="line">    LCD1602_DB = cmd;</span><br><span class="line">    LCD_Delay10ms(1);</span><br><span class="line">    LCD1602_EN = 1;</span><br><span class="line">    LCD_Delay10ms(1);</span><br><span class="line">    LCD1602_EN = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Lcd1602_Write_Data(unsigned char dat)   //å†™æ•°æ®</span><br><span class="line">&#123;</span><br><span class="line">    //Read_Busy();</span><br><span class="line">    LCD1602_RS = 1;</span><br><span class="line">    LCD1602_RW = 0;</span><br><span class="line">    LCD1602_DB = dat;</span><br><span class="line">    LCD_Delay10ms(1);</span><br><span class="line">    LCD1602_EN = 1;</span><br><span class="line">    LCD_Delay10ms(1);</span><br><span class="line">    LCD1602_EN = 0;</span><br><span class="line">&#125;</span><br><span class="line">//æŒ‡å®šä½ç½®å¼€å§‹æ˜¾ç¤ºæ•°æ®ï¼</span><br><span class="line">void LcdSetCursor(unsigned char x,unsigned char y)  //åæ ‡æ˜¾ç¤º</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char addr;</span><br><span class="line">    if(y == 0)</span><br><span class="line">        addr = 0x00 + x;//ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œxè¡¨ç¤ºä¸€è¡Œçš„ç¬¬xä¸ª</span><br><span class="line">    else</span><br><span class="line">        addr = 0x40 + x;//ç¬¬äºŒè¡Œå¼€å§‹ï¼Œxè¡¨ç¤ºä¸€è¡Œçš„ç¬¬xä¸ª</span><br><span class="line"></span><br><span class="line">    Lcd1602_Write_Cmd(addr|0x80);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void LcdShowStr(unsigned char x,unsigned char y,unsigned char *str)     //æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">&#123;</span><br><span class="line">    LcdSetCursor(x,y);      //å½“å‰å­—ç¬¦çš„åæ ‡</span><br><span class="line">    while(*str != &#x27;\0&#x27;)</span><br><span class="line">    &#123;</span><br><span class="line">        Lcd1602_Write_Data(*str++);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void InitLcd1602()              //1602åˆå§‹åŒ–</span><br><span class="line">&#123;</span><br><span class="line">    Lcd1602_Write_Cmd(0x38);    //æ‰“å¼€ï¼Œ5*8,8ä½æ•°æ®</span><br><span class="line">    Lcd1602_Write_Cmd(0x0c);</span><br><span class="line">    Lcd1602_Write_Cmd(0x06);</span><br><span class="line">    Lcd1602_Write_Cmd(0x01);    //æ¸…å±</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void LCD_Delay10ms(unsigned int c)   //è¯¯å·® 0us</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char a,b;</span><br><span class="line">    for(; c&gt;0; c--)</span><br><span class="line">        for(b=38; b&gt;0; b--)</span><br><span class="line">            for(a=130; a&gt;0; a--);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#includeâ€lcd.hâ€</p><p>&#x2F;&#x2F;void Read_Busy()           &#x2F;&#x2F;å¿™æ£€æµ‹å‡½æ•°ï¼Œåˆ¤æ–­bit7æ˜¯0ï¼Œå…è®¸æ‰§è¡Œï¼›1ç¦æ­¢<br>&#x2F;&#x2F;{<br>&#x2F;&#x2F;    unsigned char sta;      &#x2F;&#x2F;<br>&#x2F;&#x2F;    LCD1602_DB &#x3D; 0xff;<br>&#x2F;&#x2F;    LCD1602_RS &#x3D; 0;<br>&#x2F;&#x2F;    LCD1602_RW &#x3D; 1;<br>&#x2F;&#x2F;    do<br>&#x2F;&#x2F;    {<br>&#x2F;&#x2F;        LCD1602_EN &#x3D; 1;<br>&#x2F;&#x2F;        sta &#x3D; LCD1602_DB;<br>&#x2F;&#x2F;        LCD1602_EN &#x3D; 0;    &#x2F;&#x2F;ä½¿èƒ½ï¼Œç”¨å®Œå°±æ‹‰ä½ï¼Œé‡Šæ”¾æ€»çº¿<br>&#x2F;&#x2F;    }while(sta &amp; 0x80);<br>&#x2F;&#x2F;}</p><p>void Lcd1602_Write_Cmd(unsigned char cmd)     &#x2F;&#x2F;å†™å‘½ä»¤<br>{<br>    &#x2F;&#x2F;Read_Busy();<br>    LCD1602_RS &#x3D; 0;<br>    LCD1602_RW &#x3D; 0;<br>    LCD1602_DB &#x3D; cmd;<br>    LCD_Delay10ms(1);<br>    LCD1602_EN &#x3D; 1;<br>    LCD_Delay10ms(1);<br>    LCD1602_EN &#x3D; 0;<br>}</p><p>void Lcd1602_Write_Data(unsigned char dat)   &#x2F;&#x2F;å†™æ•°æ®<br>{<br>    &#x2F;&#x2F;Read_Busy();<br>    LCD1602_RS &#x3D; 1;<br>    LCD1602_RW &#x3D; 0;<br>    LCD1602_DB &#x3D; dat;<br>    LCD_Delay10ms(1);<br>    LCD1602_EN &#x3D; 1;<br>    LCD_Delay10ms(1);<br>    LCD1602_EN &#x3D; 0;<br>}<br>&#x2F;&#x2F;æŒ‡å®šä½ç½®å¼€å§‹æ˜¾ç¤ºæ•°æ®ï¼<br>void LcdSetCursor(unsigned char x,unsigned char y)  &#x2F;&#x2F;åæ ‡æ˜¾ç¤º<br>{<br>    unsigned char addr;<br>    if(y &#x3D;&#x3D; 0)<br>        addr &#x3D; 0x00 + x;&#x2F;&#x2F;ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œxè¡¨ç¤ºä¸€è¡Œçš„ç¬¬xä¸ª<br>    else<br>        addr &#x3D; 0x40 + x;&#x2F;&#x2F;ç¬¬äºŒè¡Œå¼€å§‹ï¼Œxè¡¨ç¤ºä¸€è¡Œçš„ç¬¬xä¸ª</p><pre><code>Lcd1602_Write_Cmd(addr|0x80);</code></pre><p>}</p><p>void LcdShowStr(unsigned char x,unsigned char y,unsigned char *str)     &#x2F;&#x2F;æ˜¾ç¤ºå­—ç¬¦ä¸²<br>{<br>    LcdSetCursor(x,y);      &#x2F;&#x2F;å½“å‰å­—ç¬¦çš„åæ ‡<br>    while(*str !&#x3D; â€˜\0â€™)<br>    {<br>        Lcd1602_Write_Data(*str++);<br>    }<br>}</p><p>void InitLcd1602()              &#x2F;&#x2F;1602åˆå§‹åŒ–<br>{<br>    Lcd1602_Write_Cmd(0x38);    &#x2F;&#x2F;æ‰“å¼€ï¼Œ5*8,8ä½æ•°æ®<br>    Lcd1602_Write_Cmd(0x0c);<br>    Lcd1602_Write_Cmd(0x06);<br>    Lcd1602_Write_Cmd(0x01);    &#x2F;&#x2F;æ¸…å±<br>}</p><p>void LCD_Delay10ms(unsigned int c)   &#x2F;&#x2F;è¯¯å·® 0us<br>{<br>    unsigned char a,b;<br>    for(; c&gt;0; câ€“)<br>        for(b&#x3D;38; b&gt;0; bâ€“)<br>            for(a&#x3D;130; a&gt;0; aâ€“);<br>}&#96;</p><ul><li>lcd.h</li></ul><p><code>lcd.h</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#ifndef __LCD_H_</span><br><span class="line">#define __LCD_H_</span><br><span class="line">/**********************************</span><br><span class="line">å½“ä½¿ç”¨çš„æ˜¯4ä½æ•°æ®ä¼ è¾“çš„æ—¶å€™å®šä¹‰ï¼Œ</span><br><span class="line">ä½¿ç”¨8ä½å–æ¶ˆè¿™ä¸ªå®šä¹‰</span><br><span class="line">**********************************/</span><br><span class="line">//#define LCD1602_4PINS</span><br><span class="line"></span><br><span class="line">/**********************************</span><br><span class="line">åŒ…å«å¤´æ–‡ä»¶</span><br><span class="line">**********************************/</span><br><span class="line">#include&lt;reg51.h&gt;</span><br><span class="line"></span><br><span class="line">//---é‡å®šä¹‰å…³é”®è¯---//</span><br><span class="line">#ifndef uchar</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">#ifndef uint</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">/**********************************</span><br><span class="line">PINå£å®šä¹‰</span><br><span class="line">**********************************/</span><br><span class="line">#define LCD1602_DB  P0      //data bus æ•°æ®æ€»çº¿</span><br><span class="line">sbit LCD1602_RS = P2^0;</span><br><span class="line">sbit LCD1602_RW = P2^1;</span><br><span class="line">sbit LCD1602_EN = P2^2;</span><br><span class="line"></span><br><span class="line">/**********************************</span><br><span class="line">å‡½æ•°å£°æ˜</span><br><span class="line">**********************************/</span><br><span class="line">/*åœ¨51å•ç‰‡æœº12MHZæ—¶é’Ÿä¸‹çš„å»¶æ—¶å‡½æ•°*/</span><br><span class="line">//void Lcd1602_Delay1ms(uint c);   //è¯¯å·® 0usvo</span><br><span class="line">void LCD_Delay10ms(unsigned int c);</span><br><span class="line">//void Read_Busy();           //å¿™æ£€æµ‹å‡½æ•°ï¼Œåˆ¤æ–­bit7æ˜¯0ï¼Œå…è®¸æ‰§è¡Œï¼›1ç¦æ­¢</span><br><span class="line">void Lcd1602_Write_Cmd(unsigned char cmd);     //å†™å‘½ä»¤</span><br><span class="line">void Lcd1602_Write_Data(unsigned char dat);   //å†™æ•°æ®</span><br><span class="line">void LcdSetCursor(unsigned char x,unsigned char y);  //åæ ‡æ˜¾ç¤º</span><br><span class="line">void LcdShowStr(unsigned char x,unsigned char y,unsigned char *str);     //æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">void InitLcd1602();              //1602åˆå§‹åŒ–</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>&#96;#ifndef _<em>LCD_H</em><br>#define _<em>LCD_H</em><br>&#x2F;**********************************<br>å½“ä½¿ç”¨çš„æ˜¯4ä½æ•°æ®ä¼ è¾“çš„æ—¶å€™å®šä¹‰ï¼Œ<br>ä½¿ç”¨8ä½å–æ¶ˆè¿™ä¸ªå®šä¹‰<br>**********************************&#x2F;<br>&#x2F;&#x2F;#define LCD1602_4PINS</p><p>&#x2F;**********************************<br>åŒ…å«å¤´æ–‡ä»¶<br>**********************************&#x2F;<br>#include&lt;reg51.h&gt;</p><p>&#x2F;&#x2F;â€”é‡å®šä¹‰å…³é”®è¯â€”&#x2F;&#x2F;<br>#ifndef uchar<br>#define uchar unsigned char<br>#endif</p><p>#ifndef uint<br>#define uint unsigned int<br>#endif</p><p>&#x2F;**********************************<br>PINå£å®šä¹‰<br>**********************************&#x2F;<br>#define LCD1602_DB  P0      &#x2F;&#x2F;data bus æ•°æ®æ€»çº¿<br>sbit LCD1602_RS &#x3D; P2^0;<br>sbit LCD1602_RW &#x3D; P2^1;<br>sbit LCD1602_EN &#x3D; P2^2;</p><p>&#x2F;**********************************<br>å‡½æ•°å£°æ˜<br>**********************************&#x2F;<br>&#x2F;<em>åœ¨51å•ç‰‡æœº12MHZæ—¶é’Ÿä¸‹çš„å»¶æ—¶å‡½æ•°</em>&#x2F;<br>&#x2F;&#x2F;void Lcd1602_Delay1ms(uint c);   &#x2F;&#x2F;è¯¯å·® 0usvo<br>void LCD_Delay10ms(unsigned int c);<br>&#x2F;&#x2F;void Read_Busy();           &#x2F;&#x2F;å¿™æ£€æµ‹å‡½æ•°ï¼Œåˆ¤æ–­bit7æ˜¯0ï¼Œå…è®¸æ‰§è¡Œï¼›1ç¦æ­¢<br>void Lcd1602_Write_Cmd(unsigned char cmd);     &#x2F;&#x2F;å†™å‘½ä»¤<br>void Lcd1602_Write_Data(unsigned char dat);   &#x2F;&#x2F;å†™æ•°æ®<br>void LcdSetCursor(unsigned char x,unsigned char y);  &#x2F;&#x2F;åæ ‡æ˜¾ç¤º<br>void LcdShowStr(unsigned char x,unsigned char y,unsigned char *str);     &#x2F;&#x2F;æ˜¾ç¤ºå­—ç¬¦ä¸²<br>void InitLcd1602();              &#x2F;&#x2F;1602åˆå§‹åŒ–</p><p>#endif&#96;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+æ•°æ®ä¸²å£æ‰“å°è¯¦è§£</title>
      <link href="/2024/03/Stc15-STC15W408AS%E8%AF%BB%E5%8F%96DHT11%E6%B8%A9%E6%B9%BF%E5%BA%A6%E6%95%B0%E6%8D%AE%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0%E8%AF%A6%E8%A7%A3/"/>
      <url>/2024/03/Stc15-STC15W408AS%E8%AF%BB%E5%8F%96DHT11%E6%B8%A9%E6%B9%BF%E5%BA%A6%E6%95%B0%E6%8D%AE%E4%B8%B2%E5%8F%A3%E6%89%93%E5%8D%B0%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-æ•°æ®ä¸²å£æ‰“å°è¯¦è§£"><a href="#STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-æ•°æ®ä¸²å£æ‰“å°è¯¦è§£" class="headerlink" title="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+æ•°æ®ä¸²å£æ‰“å°è¯¦è§£"></a>STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+æ•°æ®ä¸²å£æ‰“å°è¯¦è§£</h1><h3 id="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-æ•°æ®ä¸²å£æ‰“å°è¾“å‡ºè¯¦è§£"><a href="#STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦-æ•°æ®ä¸²å£æ‰“å°è¾“å‡ºè¯¦è§£" class="headerlink" title="STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+æ•°æ®ä¸²å£æ‰“å°è¾“å‡ºè¯¦è§£"></a>STC15W408ASè¯»å–DHT11æ¸©æ¹¿åº¦+æ•°æ®ä¸²å£æ‰“å°è¾“å‡ºè¯¦è§£</h3><p><img src="https://img-blog.csdnimg.cn/81086c7af8f54b309593b67346d173ca.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™ä¸ªæ•°æ®ç»“æœåšäº†æˆ‘2å¤©æ—¶é—´æ¥éªŒè¯ï¼Œä¸»è¦éš¾ç‚¹æ˜¯è¯»å–DHT11æ—¶åºä¸Šï¼Œå¼„æ‡‚äº†æ—¶åºï¼Œè¯»è¿™ç±»ä¼ æ„Ÿå™¨å°±å¾ˆç®€å•æ‹¿åˆ°æ•°æ®äº†ã€‚</p><ul><li>ç½‘ç»œä¸Šå¯¹äºè¿™ç±»ä¼ æ„Ÿå™¨çš„èµ„æ–™ä¸€æœç´¢ä¸€ç®©ç­ä¸å…‰æ˜¯ä»æºç åˆ°åŸç†å®ç°çš„ç›¸å…³æ–¹é¢çš„èµ„æ–™å¾ˆå¤šï¼Œæ»¡ç›®ç³ç…ï¼Œåªæƒ³è¯´ä¸€å¥å‚å·®ä¸é½ã€‚ä¸äº†è§£å‰ï¼Œä¸è¦ä¸€è‚¡è„‘å„¿çš„åœ¨ç½‘ä¸Šæœç´¢ç­”æ¡ˆï¼Œæœ‰å¯èƒ½æŠŠä½ å¸¦å…¥æ‰¾ä¸åˆ°åŒ—çš„æ€ªåœˆã€‚åªæœ‰ä»åŸç†ä¸Šè¯»æ‡‚äº†ï¼Œä½ æ‰èƒ½åœ¨æµ©ç€šçš„ç½‘ç»œä¸­ç”„åˆ«æ•°æ®èµ„æ–™çš„å¯ä¿¡åº¦ã€‚</li><li>STC15W408ASæœ€æ–°ç³»ç»Ÿå¼€å‘æ¿</li><li>DHT11</li></ul><p><img src="https://img-blog.csdnimg.cn/bae78bd671f640f98058e30339b77394.jpg#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/19d8351173fb43fdafc97cce35da86a9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/3c47c6cc4d9a49d0906e0b20abf0709a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ¥çº¿è¯´æ˜"><a href="#æ¥çº¿è¯´æ˜" class="headerlink" title="æ¥çº¿è¯´æ˜"></a>æ¥çº¿è¯´æ˜</h4><ul><li>DHT11å¦‚æœæ˜¯ç‹¬ç«‹ä¾›ç”µï¼Œé‚£ä¹ˆéœ€è¦å°†DHT11çš„GNDä¸å•ç‰‡æœºçš„GNDç›¸è¿ï¼Œå¦åˆ™æ— æ³•è¯»åˆ°æ•°æ®ã€‚</li><li>DHT11çš„æ•°æ®å¼•è„šæœ€å¥½æ¥ä¸€ä¸ª4.7K-5.1Kçš„ä¸Šæ‹‰ç”µé˜»åˆ°VCCã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/84c76a6e19e0488e88916a6a0c8e2c25.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="éªŒè¯æ­¥éª¤"><a href="#éªŒè¯æ­¥éª¤" class="headerlink" title="éªŒè¯æ­¥éª¤"></a>éªŒè¯æ­¥éª¤</h4><h5 id="ç¡®å®šå¥½è‡ªå·±éœ€è¦åœ¨ä»€ä¹ˆå¼€å‘æ¿ä¸Šæ¥è¯»å–DHT11çš„æ•°æ®ã€‚"><a href="#ç¡®å®šå¥½è‡ªå·±éœ€è¦åœ¨ä»€ä¹ˆå¼€å‘æ¿ä¸Šæ¥è¯»å–DHT11çš„æ•°æ®ã€‚" class="headerlink" title="ç¡®å®šå¥½è‡ªå·±éœ€è¦åœ¨ä»€ä¹ˆå¼€å‘æ¿ä¸Šæ¥è¯»å–DHT11çš„æ•°æ®ã€‚"></a>ç¡®å®šå¥½è‡ªå·±éœ€è¦åœ¨ä»€ä¹ˆå¼€å‘æ¿ä¸Šæ¥è¯»å–DHT11çš„æ•°æ®ã€‚</h5><p>ä¸åŒçš„å¼€å‘æ¿æˆ–èŠ¯ç‰‡ï¼Œæ—¶é’Ÿé¢‘ç‡ä¸åŒï¼ŒDHTè¯»å–æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦åˆ©ç”¨å»¶æ—¶æ—¶é—´æ¥æ§åˆ¶IOå£çš„é«˜ä½ç”µå¹³çŠ¶æ€ä¿æŒçš„æ—¶é—´ã€‚è¿™ä¸€ç‚¹å¾ˆå…³é”®!ä¸€å¥è¯æ€»ç»“ï¼šä½ è¦æå‰å‡†å¤‡å¥½è¾ƒä¸ºç²¾å‡†çš„å»¶æ—¶å‡½æ•°ã€‚éƒ½æ˜¯ä¸ºäº†åé¢è¯»æ—¶åºåšå¥½å‡†å¤‡ã€‚</p><ul><li>å»¶æ—¶å‡½æ•°ç¡®å®šæ–¹æ³•</li></ul><p>ä½¿ç”¨STCçƒ§å½•å·¥å…·ä¸Šçš„è½¯ä»¶å»¶æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆå³å¯ã€‚å‚æ•°æœ‰STCå‹å·ï¼Œå·¥ä½œé¢‘ç‡ã€‚æŒ‡ä»¤é›†ï¼ˆçœ‹å³ä¾§çš„æè¿°ï¼Œä¸åŒçš„å‹å·å¯¹åº”ä¸åŒçš„æŒ‡ä»¤é›†ï¼Œé€‚ç”¨äºä»€ä¹ˆç³»åˆ—ï¼Œå°±é€‰æ‹©ä»€ä¹ˆæŒ‡ä»¤é›†ï¼‰</p><p><img src="https://img-blog.csdnimg.cn/12caf164291a46578a7b7bf36d180e6b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="çœ‹æ‡‚DHT11æ—¶åº"><a href="#çœ‹æ‡‚DHT11æ—¶åº" class="headerlink" title="çœ‹æ‡‚DHT11æ—¶åº"></a>çœ‹æ‡‚DHT11æ—¶åº</h5><p>æˆ‘ä»¬ä¸è¦æ€¥äºç›´æ¥å»copyä»£ç ï¼Œå…ˆå¬è®²è§£ã€‚</p><p>DHT11æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨</p><p>çœ‹è¿™ä¸ªè§†é¢‘è®²è§£ï¼Œç¬¬ä¸€éæ²¡çœ‹æ‡‚çš„è¯ï¼Œå¤šçœ‹ä¸€éã€‚</p><ul><li>æ•´ä¸ªæ—¶åºå›¾</li></ul><p><img src="https://img-blog.csdnimg.cn/d1a568baa24d4b4aad5a5a14bed56b41.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>å¼€å§‹ä¿¡å·æ—¶åºå›¾</li><li>æ•°æ®æ—¶åºå›¾</li></ul><p><img src="https://img-blog.csdnimg.cn/03e7cabc47324c9ab081514d2bf7eed9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½æ•°æ®â€œ0â€çš„æ ¼å¼ä¸ºï¼š 50 å¾®ç§’çš„ä½ç”µå¹³å’Œ 26-28 å¾®ç§’çš„é«˜ç”µå¹³ï¼Œä½æ•°æ®â€œ1â€çš„æ ¼å¼ä¸ºï¼š 50 å¾®ç§’çš„ä½ç”µå¹³åŠ  70å¾®ç§’çš„é«˜ç”µå¹³ã€‚</p><p><code>50</code></p><p><code>26-28</code></p><p><code>50</code></p><p><code>70</code></p><ul><li>æ ¹æ®æ•°æ®ä½çš„é«˜ç”µå¹³æ—¶é—´ä¸ä¸€æ ·ï¼Œæ¥åˆ¤æ–­æ¥æ”¶çš„æ˜¯0è¿˜æ˜¯1ï¼Œæ¥æ”¶æ•°æ®æ—¶å¯ä»¥å…ˆç­‰å¾…ä½ç”µå¹³è¿‡å»ï¼Œå³ç­‰å¾…æ•°æ®çº¿æ‹‰é«˜ï¼Œå†å»¶æ—¶60usï¼Œå› ä¸º60uså¤§äº28usä¸”å°äº70usï¼Œå†æ£€æµ‹æ­¤æ—¶æ•°æ®çº¿æ˜¯å¦ä¸ºé«˜ï¼Œå¦‚æœä¸ºé«˜ï¼Œåˆ™æ•°æ®åˆ¤å®šä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚ â€“ è¯»å–æ•°æ®0æ—¶åº  â€“ è¯»å–æ•°æ®1æ—¶åºå›¾</li></ul><p><code>0</code></p><p><code>1</code></p><p><code>0</code></p><p><img src="https://img-blog.csdnimg.cn/e6f394e8e1ed4311b20cac03a9acfdb4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>1</code></p><p><img src="https://img-blog.csdnimg.cn/c34424aa797c413392f4c4d399317263.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ—¶åºä¸ä»£ç å¯¹åº”å…³ç³»"><a href="#æ—¶åºä¸ä»£ç å¯¹åº”å…³ç³»" class="headerlink" title="æ—¶åºä¸ä»£ç å¯¹åº”å…³ç³»"></a>æ—¶åºä¸ä»£ç å¯¹åº”å…³ç³»</h4><ol><li>èµ·å§‹ä¿¡å·æ®µ</li></ol><p><img src="https://img-blog.csdnimg.cn/2a20258e0c36466ca92bde73681fd117.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">void DHT11_start()</span><br><span class="line">&#123;</span><br><span class="line">    Temp_data=1;//é€šè®¯å‰ï¼Œå°†DHT11æ•°æ®IOå£ç½®ä¸ºé«˜ç”µå¹³</span><br><span class="line">    Delayus(10);</span><br><span class="line">    Temp_data=0;//mcuå¼€å§‹é€šè®¯ï¼Œä¸»åŠ¨æ‹‰ç‚¹æ•°æ®IOå£</span><br><span class="line">     delayms(25);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®</span><br><span class="line">    Temp_data=1;</span><br><span class="line">    Delayus(50);/MCUæ‹‰é«˜æ•°æ®IOå£ç”µå¹³æ—¶é—´20~40usä¹‹å,ç­‰å¾…DHT11å°†æ•°æ®IOå£æ¥æ‹‰ä½ç”µå¹³ï¼Œè¿™æ˜¯å•ç‰‡æœºå˜æˆäº†è¯»å–IOå£ä¿¡å·ã€‚ä¹‹å‰å•ç‰‡æœºæ•°æ®IOå£éƒ½æ˜¯ç”¨æ¥ä½œä¸ºè¾“å‡ºé«˜ä½ç”µå¹³IOå£ï¼Œåˆ°äº†è¿™é‡Œï¼Œå•ç‰‡æœºæ•°æ®IOå£å˜æˆè¯»å–è¾“å…¥ä¿¡å·çš„IOå£ï¼Œéœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>void DHT11_start() &#123;     Temp_data=1;//é€šè®¯å‰ï¼Œå°†DHT11æ•°æ®IOå£ç½®ä¸ºé«˜ç”µå¹³     Delayus(10);     Temp_data=0;//mcuå¼€å§‹é€šè®¯ï¼Œä¸»åŠ¨æ‹‰ç‚¹æ•°æ®IOå£      delayms(25);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®     Temp_data=1;     Delayus(50);/MCUæ‹‰é«˜æ•°æ®IOå£ç”µå¹³æ—¶é—´20~40usä¹‹å,ç­‰å¾…DHT11å°†æ•°æ®IOå£æ¥æ‹‰ä½ç”µå¹³ï¼Œè¿™æ˜¯å•ç‰‡æœºå˜æˆäº†è¯»å–IOå£ä¿¡å·ã€‚ä¹‹å‰å•ç‰‡æœºæ•°æ®IOå£éƒ½æ˜¯ç”¨æ¥ä½œä¸ºè¾“å‡ºé«˜ä½ç”µå¹³IOå£ï¼Œåˆ°äº†è¿™é‡Œï¼Œå•ç‰‡æœºæ•°æ®IOå£å˜æˆè¯»å–è¾“å…¥ä¿¡å·çš„IOå£ï¼Œéœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´     &#125;</code></p><ol><li>åº”ç­”ä¿¡å·å’Œè¯»æ•°æ®</li></ol><p><img src="https://img-blog.csdnimg.cn/efed1873cc5146f7b8cdd95eaaafdffd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®</span><br><span class="line">void DHT11_receive()</span><br><span class="line">&#123;</span><br><span class="line">DHT11_start();//è¿™éƒ¨åˆ†æ˜¯å¼€å§‹ä¿¡å·</span><br><span class="line">    if(Temp_data==0)//è¿™é‡Œçš„æ¡ä»¶åˆ¤æ–­å¯¹åº”çš„æ˜¯ä¸Šå›¾ä¸­çº¢è™šçº¿æ¡†å†…åº”ç­”ä¿¡å·åŒºåŸŸ&quot;DHTå“åº”ä¿¡å·80usåŒºæ®µ&quot;</span><br><span class="line">    &#123;led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œledä½œä¸ºå“åº”ä¿¡å·çš„æ ‡å¿—ï¼Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿä¿¡å·æ˜¯å¦è¢«DHTå“åº”åˆ°ï¼Œå¦‚æœæ‹‰ä½ç”µå¹³ï¼Œè¯´æ˜DHTå“åº”äº†ï¼Œå¹¶è¿›å…¥ifæ¡ä»¶é‡Œé¢æ‰§è¡Œå†…å®¹</span><br><span class="line">while(Temp_data==0); //ä¸€ç›´ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ•°æ®IOå£çš„ç”µå¹³çŠ¶æ€ï¼Œæ‰ç»“æŸè¿™ä¸ªwhileå¾ªç¯ã€‚</span><br><span class="line">while(Temp_data==1); //ä¸€ç›´ç­‰å¾…ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿æ•°æ®IOå£çš„ç”µå¹³çŠ¶æ€ï¼Œæ‰ç»“æŸè¿™ä¸ªwhileå¾ªç¯ã€‚</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;else&#123;led=1;//ç¨‹åºè¿è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜DHTæ•°æ®IOå£æ²¡æœ‰è¢«DHTä¼ æ„Ÿå™¨å“åº”åˆ°&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>//æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ® void DHT11_receive() &#123;         DHT11_start();//è¿™éƒ¨åˆ†æ˜¯å¼€å§‹ä¿¡å·         if(Temp_data==0)//è¿™é‡Œçš„æ¡ä»¶åˆ¤æ–­å¯¹åº”çš„æ˜¯ä¸Šå›¾ä¸­çº¢è™šçº¿æ¡†å†…åº”ç­”ä¿¡å·åŒºåŸŸ&quot;DHTå“åº”ä¿¡å·80usåŒºæ®µ&quot;     &#123;led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œledä½œä¸ºå“åº”ä¿¡å·çš„æ ‡å¿—ï¼Œä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿä¿¡å·æ˜¯å¦è¢«DHTå“åº”åˆ°ï¼Œå¦‚æœæ‹‰ä½ç”µå¹³ï¼Œè¯´æ˜DHTå“åº”äº†ï¼Œå¹¶è¿›å…¥ifæ¡ä»¶é‡Œé¢æ‰§è¡Œå†…å®¹             while(Temp_data==0); //ä¸€ç›´ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ•°æ®IOå£çš„ç”µå¹³çŠ¶æ€ï¼Œæ‰ç»“æŸè¿™ä¸ªwhileå¾ªç¯ã€‚             while(Temp_data==1); //ä¸€ç›´ç­‰å¾…ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿æ•°æ®IOå£çš„ç”µå¹³çŠ¶æ€ï¼Œæ‰ç»“æŸè¿™ä¸ªwhileå¾ªç¯ã€‚         &#125;   &#125;else&#123;led=1;//ç¨‹åºè¿è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜DHTæ•°æ®IOå£æ²¡æœ‰è¢«DHTä¼ æ„Ÿå™¨å“åº”åˆ°&#125; &#125;</code></p><ol><li>è¯»å–DHT11æ•°æ® â€“ è¯»å–æ•°æ®0æ—¶åº  â€“ è¯»å–æ•°æ®1æ—¶åºå›¾</li></ol><p><code>0</code></p><p><img src="https://img-blog.csdnimg.cn/e6f394e8e1ed4311b20cac03a9acfdb4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>1</code></p><p><img src="https://img-blog.csdnimg.cn/c34424aa797c413392f4c4d399317263.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¸Šé¢è¿™ä¸¤å¼ å›¾ä¸€èµ·æ¥çœ‹ã€‚æ‰€è¯»åˆ°çš„æ•°æ®æ˜¯0è¿˜æ˜¯1ç»“æœçš„æ—¶åºä¸Šçš„å·®å¼‚å°±æ˜¯é«˜ç”µå¹³ä¿æŒæ—¶é—´ä¸ä¸€æ ·é•¿ã€‚å‰é¢50usç›¸åŒçš„ä½ç”µå¹³ä¿æŒæ—¶é—´å’Œè¯»å–æ•°æ®ç»“æŸåçš„æ•°æ®IOå£çŠ¶æ€éƒ½æ˜¯ä½ç”µå¹³æ—¶é—´å¯ä»¥å…ˆä¸ç”¨ç®¡å®ƒï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯æŸ¥çœ‹å·®å¼‚éƒ¨åˆ†æ¥åˆ†ææ•°æ®ï¼Œå¹¶è½¬æ¢ä¸ºCä»£ç æ¥åˆ¤æ–­æ•°æ®ç»“æœã€‚</p><p><code>0</code></p><p><code>1</code></p><p><code>é«˜ç”µå¹³ä¿æŒæ—¶é—´ä¸ä¸€æ ·é•¿</code></p><p><code>å‰é¢50usç›¸åŒçš„ä½ç”µå¹³ä¿æŒæ—¶é—´</code></p><p><code>è¯»å–æ•°æ®ç»“æŸåçš„æ•°æ®IOå£çŠ¶æ€éƒ½æ˜¯ä½ç”µå¹³æ—¶é—´</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//æ¥æ”¶ä¸€ä¸ªå­—èŠ‚</span><br><span class="line">unsigned char DHT11_rec_byte()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char i,dat=0;</span><br><span class="line">    for(i=0; i&lt;8; i++)</span><br><span class="line">    &#123;//ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®8bitä½ï¼Œæ‰€ä»¥éœ€è¦è¿ç»­è¯»8æ¬¡ï¼Œæ‰æ˜¯ä¸€ä¸ªå®Œæ•´çš„å­—èŠ‚æ•°æ®ã€‚</span><br><span class="line">        while(!Temp_data);//è¯»æ•°æ®æ—¶è·³è¿‡æ•°æ®å‰æ®µçš„50usï¼Œå½“DHTæ•°æ®IOå£å˜é«˜æ—¶ï¼Œå°±è·³å‡ºwhileï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“çš„å‰æ®µ50usæ—¶é—´ã€‚</span><br><span class="line">Delayus(33);//è¿™ä¸ªå»¶æ—¶æ˜¯ä¸ºäº†è¿‡æ»¤æ‰â€œ26-28usâ€æ•°æ®0å’Œ1çš„ç›¸åŒé«˜ç”µå¹³æ—¶é—´ï¼Œä¹‹åï¼Œå†åšDHTæ•°æ®IOå£çš„ç”µå¹³çŠ¶æ€ç›‘æµ‹ã€‚ </span><br><span class="line">// è¿™ä¸ªå»¶æ—¶å–å€¼èŒƒå›´28us&lt;delay&lt;70usåŒºé—´çš„å€¼    </span><br><span class="line">          dat &lt;&lt;=1;//æ¯è¯»ä¸€æ¬¡ä¿¡å·æ•°æ®å·¦ç§»ä¸€ä½ã€‚</span><br><span class="line">if(Temp_data==1)</span><br><span class="line">        &#123;//å¦‚æœè¯»åˆ°çš„æ•°æ®IOå£çŠ¶æ€ä¸ºé«˜ï¼Œé‚£ä¹ˆå°±æ˜¯æ•°æ®1ï¼Œ</span><br><span class="line">  dat +=1;//å½“å‰ä½ä¸º1</span><br><span class="line">        &#125;</span><br><span class="line">while(Temp_data);//ä¸ç®¡æ˜¯æ•°æ®0è¿˜æ˜¯1ï¼Œåªè¦æ•°æ®IOå£çŠ¶æ€å˜ä½ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºè¯¥bitä½æ•°æ®å°±è¯»å–ç»“æŸäº†ã€‚</span><br><span class="line">    &#125;</span><br><span class="line">    return dat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>//æ¥æ”¶ä¸€ä¸ªå­—èŠ‚ unsigned char DHT11_rec_byte() &#123;     unsigned char i,dat=0;     for(i=0; i&lt;8; i++)     &#123;//ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®8bitä½ï¼Œæ‰€ä»¥éœ€è¦è¿ç»­è¯»8æ¬¡ï¼Œæ‰æ˜¯ä¸€ä¸ªå®Œæ•´çš„å­—èŠ‚æ•°æ®ã€‚         while(!Temp_data);//è¯»æ•°æ®æ—¶è·³è¿‡æ•°æ®å‰æ®µçš„50usï¼Œå½“DHTæ•°æ®IOå£å˜é«˜æ—¶ï¼Œå°±è·³å‡ºwhileï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“çš„å‰æ®µ50usæ—¶é—´ã€‚         Delayus(33);//è¿™ä¸ªå»¶æ—¶æ˜¯ä¸ºäº†è¿‡æ»¤æ‰â€œ26-28usâ€æ•°æ®0å’Œ1çš„ç›¸åŒé«˜ç”µå¹³æ—¶é—´ï¼Œä¹‹åï¼Œå†åšDHTæ•°æ®IOå£çš„ç”µå¹³çŠ¶æ€ç›‘æµ‹ã€‚          // è¿™ä¸ªå»¶æ—¶å–å€¼èŒƒå›´28us&lt;delay&lt;70usåŒºé—´çš„å€¼               dat &lt;&lt;=1;//æ¯è¯»ä¸€æ¬¡ä¿¡å·æ•°æ®å·¦ç§»ä¸€ä½ã€‚             if(Temp_data==1)         &#123;//å¦‚æœè¯»åˆ°çš„æ•°æ®IOå£çŠ¶æ€ä¸ºé«˜ï¼Œé‚£ä¹ˆå°±æ˜¯æ•°æ®1ï¼Œ                       dat +=1;//å½“å‰ä½ä¸º1         &#125;             while(Temp_data);//ä¸ç®¡æ˜¯æ•°æ®0è¿˜æ˜¯1ï¼Œåªè¦æ•°æ®IOå£çŠ¶æ€å˜ä½ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºè¯¥bitä½æ•°æ®å°±è¯»å–ç»“æŸäº†ã€‚     &#125;     return dat; &#125;</code></p><ul><li>ä¸€æ¬¡å®Œæ•´çš„æ•°æ®ä¼ è¾“æ˜¯40bitï¼Œä¹Ÿå°±æ˜¯5X8bit&#x3D;5Byteä¸ªå­—èŠ‚ã€‚æ¢å¥è¯å°±æ˜¯ï¼šä¸Šé¢çš„å‡½æ•° DHT11_rec_byte()éœ€è¦è¿ç»­æ‰§è¡Œ5æ¬¡æ‰ç®—è¯»å®Œä¸€æ¬¡å®Œæ•´çš„æ•°æ®ã€‚</li><li>ä¸€æ¬¡ä¼ é€ 40 ä½æ•°æ®ï¼Œé«˜ä½å…ˆå‡º.</li><li>æ•°æ®æ ¡æ­£</li><li>åˆ¤æ–­â€œ8bit æ¹¿åº¦æ•´æ•°æ•°æ® + 8bit æ¹¿åº¦å°æ•°æ•°æ®+8bit æ¸©åº¦æ•´æ•°æ•°æ® + 8bit æ¸©åº¦å°æ•°æ•°æ®â€çš„ç»“æœæ˜¯å¦ç­‰äº8bit æ ¡éªŒä½ã€‚å¦‚æœç­‰äºåˆ™æ•°æ®æ¥æ”¶æ­£ç¡®ï¼Œå¦åˆ™åº”è¯¥æ”¾å¼ƒè¿™ä¸€æ¬¡çš„æ•°æ®ï¼Œé‡æ–°æ¥æ”¶ã€‚</li></ul><p><code>DHT11_rec_byte()</code></p><p>8bit æ¹¿åº¦æ•´æ•°æ•°æ® + 8bit æ¹¿åº¦å°æ•°æ•°æ®+8bit æ¸©åº¦æ•´æ•°æ•°æ® + 8bit æ¸©åº¦å°æ•°æ•°æ®+8bit æ ¡éªŒä½ã€‚</p><p><img src="https://img-blog.csdnimg.cn/dd2a65bc7eeb4b32afe194cd80f6abe5.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®</span><br><span class="line">void DHT11_receive()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int R_H,R_L,T_H,T_L;</span><br><span class="line">    unsigned char RH,RL,TH,TL,revise;</span><br><span class="line">DHT11_start();//å¼€å§‹ä¿¡å·</span><br><span class="line">    if(Temp_data==0)//åº”ç­”ä¿¡å·</span><br><span class="line">    &#123;led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œæ·»åŠ ledä½œä¸ºå“åº”ä¿¡å·æ–¹ä¾¿è§‚å¯Ÿ</span><br><span class="line">while(Temp_data==0); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿</span><br><span class="line">while(Temp_data==1); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿</span><br><span class="line">        R_H=DHT11_rec_byte();    //æ¥æ”¶ç¬¬ä¸€æ¬¡æ¹¿åº¦é«˜å…«ä½</span><br><span class="line">        R_L=DHT11_rec_byte();    //æ¥æ”¶ç¬¬äºŒæ¬¡æ¹¿åº¦ä½å…«ä½</span><br><span class="line">        T_H=DHT11_rec_byte();    //æ¥æ”¶ç¬¬ä¸‰æ¬¡æ¸©åº¦é«˜å…«ä½</span><br><span class="line">        T_L=DHT11_rec_byte();    //æ¥æ”¶ç¬¬å››æ¬¡æ¸©åº¦ä½å…«ä½</span><br><span class="line">        revise=DHT11_rec_byte(); //æ¥æ”¶ç¬¬äº”æ¬¡ï¼Œä¸ºæ•°æ®æ ¡æ­£ä½</span><br><span class="line">        Delayus(25);    //è¿™ä¸ªå»¶æ—¶ä¸æ˜¯å¾ˆé‡è¦ï¼Œç”¨äºæ•°æ®ç¼“å†²ã€‚</span><br><span class="line"></span><br><span class="line">        if((R_H+R_L+T_H+T_L)==revise)//æ•°æ®æ ¡æ­£</span><br><span class="line">        &#123;</span><br><span class="line">led2 = 0;//å¦‚æœæ•°æ®æ ¡æ­£æ²¡é—®é¢˜ï¼Œè®©LED2ç¯äº®èµ·ï¼Œæ–¹ä¾¿è§‚å¯Ÿ</span><br><span class="line">            RH=R_H;</span><br><span class="line">            RL=R_L;</span><br><span class="line">            TH=T_H;</span><br><span class="line">            TL=T_L;</span><br><span class="line">        &#125;</span><br><span class="line">        /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/</span><br><span class="line">        rec_dat[0]=RH;//å°†æ•°æ®åˆ†åˆ«å¯¹åº”å­˜è¿›å…¨å±€æ•°ç»„å˜é‡é‡Œé¢</span><br><span class="line">        rec_dat[1]=RL;</span><br><span class="line">        rec_dat[2]=TH;</span><br><span class="line">        rec_dat[3]=TL;</span><br><span class="line">  &#125;else&#123;led=1;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;&#x2F;æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®<br>void DHT11_receive()<br>{<br>    unsigned int R_H,R_L,T_H,T_L;<br>    unsigned char RH,RL,TH,TL,revise;<br>        DHT11_start();&#x2F;&#x2F;å¼€å§‹ä¿¡å·<br>        if(Temp_data&#x3D;&#x3D;0)&#x2F;&#x2F;åº”ç­”ä¿¡å·<br>    {led&#x3D;0;&#x2F;&#x2F;æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œæ·»åŠ ledä½œä¸ºå“åº”ä¿¡å·æ–¹ä¾¿è§‚å¯Ÿ<br>            while(Temp_data&#x3D;&#x3D;0); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿<br>            while(Temp_data&#x3D;&#x3D;1); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿<br>        R_H&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶ç¬¬ä¸€æ¬¡æ¹¿åº¦é«˜å…«ä½<br>        R_L&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶ç¬¬äºŒæ¬¡æ¹¿åº¦ä½å…«ä½<br>        T_H&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶ç¬¬ä¸‰æ¬¡æ¸©åº¦é«˜å…«ä½<br>        T_L&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶ç¬¬å››æ¬¡æ¸©åº¦ä½å…«ä½<br>        revise&#x3D;DHT11_rec_byte(); &#x2F;&#x2F;æ¥æ”¶ç¬¬äº”æ¬¡ï¼Œä¸ºæ•°æ®æ ¡æ­£ä½<br>        Delayus(25);    &#x2F;&#x2F;è¿™ä¸ªå»¶æ—¶ä¸æ˜¯å¾ˆé‡è¦ï¼Œç”¨äºæ•°æ®ç¼“å†²ã€‚</p><pre><code>    if((R_H+R_L+T_H+T_L)==revise)//æ•°æ®æ ¡æ­£    &#123;        led2 = 0;//å¦‚æœæ•°æ®æ ¡æ­£æ²¡é—®é¢˜ï¼Œè®©LED2ç¯äº®èµ·ï¼Œæ–¹ä¾¿è§‚å¯Ÿ        RH=R_H;        RL=R_L;        TH=T_H;        TL=T_L;    &#125;    /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/    rec_dat[0]=RH;//å°†æ•°æ®åˆ†åˆ«å¯¹åº”å­˜è¿›å…¨å±€æ•°ç»„å˜é‡é‡Œé¢    rec_dat[1]=RL;    rec_dat[2]=TH;    rec_dat[3]=TL;</code></pre><p>  }else{led&#x3D;1;}<br>}&#96;</p><h4 id="ç¤ºä¾‹ç¨‹åºç¨‹åº"><a href="#ç¤ºä¾‹ç¨‹åºç¨‹åº" class="headerlink" title="ç¤ºä¾‹ç¨‹åºç¨‹åº"></a>ç¤ºä¾‹ç¨‹åºç¨‹åº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">//#include &quot;string.h&quot;</span><br><span class="line">//#include &quot;stdarg.h&quot; </span><br><span class="line"></span><br><span class="line">#include&quot;config.h&quot;</span><br><span class="line">#include&quot;USART1.h&quot;</span><br><span class="line">#include&quot;delay.h&quot;</span><br><span class="line"></span><br><span class="line">#define uint unsigned int </span><br><span class="line">#define uchar unsigned char</span><br><span class="line"></span><br><span class="line">/*************åŠŸèƒ½è¯´æ˜**************</span><br><span class="line"></span><br><span class="line">åŒä¸²å£å…¨åŒå·¥ä¸­æ–­æ–¹å¼æ”¶å‘é€šè®¯ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">é€šè¿‡PCå‘MCUå‘é€æ•°æ®, MCUæ”¶åˆ°åé€šè¿‡ä¸²å£æŠŠæ”¶åˆ°çš„æ•°æ®åŸæ ·è¿”å›.</span><br><span class="line"></span><br><span class="line">******************************************/</span><br><span class="line"></span><br><span class="line">/*************æœ¬åœ°å¸¸é‡å£°æ˜**************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sbit Temp_data = P1^4 ;</span><br><span class="line">sbit led = P1^5;//DHTå“åº”æŒ‡ç¤ºç¯</span><br><span class="line">sbit led2 = P1^6;//æ•ˆéªŒæ•°æ®æŒ‡ç¤ºç¯</span><br><span class="line">unsigned int rec_dat[4];</span><br><span class="line">unsigned char dht_dat[4];</span><br><span class="line">unsigned char rec_dat_lcd0[6];</span><br><span class="line">unsigned char rec_dat_lcd1[6];</span><br><span class="line">unsigned char rec_dat_lcd2[6];</span><br><span class="line">unsigned char rec_dat_lcd3[6];</span><br><span class="line"></span><br><span class="line">//å®šä¹‰</span><br><span class="line"></span><br><span class="line">void DHT11_start();//DHTå¼€å§‹ä¿¡å·</span><br><span class="line">unsigned char DHT11_rec_byte();</span><br><span class="line">void DHT11_receive();</span><br><span class="line"></span><br><span class="line">/*************  å¤–éƒ¨å‡½æ•°å’Œå˜é‡å£°æ˜ *****************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*************  ä¸²å£1åˆå§‹åŒ–å‡½æ•° *****************/</span><br><span class="line">voidUART_config(void)</span><br><span class="line">&#123;</span><br><span class="line">COMx_InitDefineCOMx_InitStructure;//ç»“æ„å®šä¹‰</span><br><span class="line">COMx_InitStructure.UART_Mode      = UART_8bit_BRTx;//æ¨¡å¼,       UART_ShiftRight,UART_8bit_BRTx,UART_9bit,UART_9bit_BRTx</span><br><span class="line">COMx_InitStructure.UART_BRT_Use   = BRT_Timer2;//ä½¿ç”¨æ³¢ç‰¹ç‡,   BRT_Timer1, BRT_Timer2 (æ³¨æ„: ä¸²å£2å›ºå®šä½¿ç”¨BRT_Timer2)</span><br><span class="line">COMx_InitStructure.UART_BaudRate  = 115200ul;//æ³¢ç‰¹ç‡, ä¸€èˆ¬ 110 ~ 115200</span><br><span class="line">COMx_InitStructure.UART_RxEnable  = ENABLE;//æ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE</span><br><span class="line">COMx_InitStructure.BaudRateDouble = DISABLE;//æ³¢ç‰¹ç‡åŠ å€, ENABLEæˆ–DISABLE</span><br><span class="line">COMx_InitStructure.UART_Interrupt = ENABLE;//ä¸­æ–­å…è®¸,   ENABLEæˆ–DISABLE</span><br><span class="line">COMx_InitStructure.UART_Polity    = PolityLow;//ä¸­æ–­ä¼˜å…ˆçº§, PolityLow,PolityHigh</span><br><span class="line">COMx_InitStructure.UART_P_SW      = UART1_SW_P30_P31;//åˆ‡æ¢ç«¯å£,   UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17(å¿…é¡»ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿ)</span><br><span class="line">COMx_InitStructure.UART_RXD_TXD_Short = DISABLE;//å†…éƒ¨çŸ­è·¯RXDä¸TXD, åšä¸­ç»§, ENABLE,DISABLE</span><br><span class="line">USART_Configuration(USART1, &amp;COMx_InitStructure);//åˆå§‹åŒ–ä¸²å£1 USART1,USART2</span><br><span class="line"></span><br><span class="line">PrintString1(&quot;STC15W408AS UART1 \r\n&quot;);//SUART1å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**********************************************/</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">float tem = 0.0,hum = 0.0;</span><br><span class="line">led = 1;</span><br><span class="line">led2 = 1;</span><br><span class="line">UART_config();</span><br><span class="line">EA = 1;</span><br><span class="line"></span><br><span class="line">while (1)</span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">delayms(150);</span><br><span class="line">        DHT11_receive();</span><br><span class="line">        sprintf(rec_dat_lcd0,&quot;%d&quot;,rec_dat[0]);</span><br><span class="line">        sprintf(rec_dat_lcd1,&quot;%d&quot;,rec_dat[1]);</span><br><span class="line">        sprintf(rec_dat_lcd2,&quot;%d&quot;,rec_dat[2]);</span><br><span class="line">        sprintf(rec_dat_lcd3,&quot;%d&quot;,rec_dat[3]);</span><br><span class="line">hum = rec_dat[0] + rec_dat[1]/256.0;</span><br><span class="line">tem = rec_dat[2] + rec_dat[3]/256.0;</span><br><span class="line">printf(&quot;æ¸©åº¦:%.2f â„ƒ\r\n&quot;,tem);</span><br><span class="line">printf(&quot;æ¹¿åº¦:%.2f ï¼…\r\n&quot;,hum);</span><br><span class="line">//        printf(&quot;æ¹¿åº¦:%d%d %%\t&quot;,rec_dat[0],rec_dat[1]);</span><br><span class="line">//        printf(&quot;æ¸©åº¦:%d%d â„ƒ\r\n&quot;,rec_dat[2],rec_dat[3]);</span><br><span class="line">delayms(2000);</span><br><span class="line">led = 1;</span><br><span class="line">led2 = 1;</span><br><span class="line">//DHT11_start();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">//DHT11èµ·å§‹ä¿¡å·</span><br><span class="line"></span><br><span class="line">void DHT11_start()</span><br><span class="line">&#123;</span><br><span class="line">    Temp_data=1;</span><br><span class="line">    Delayus(10);</span><br><span class="line">    Temp_data=0;</span><br><span class="line">     delayms(25);//è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®</span><br><span class="line">    Temp_data=1;</span><br><span class="line">    Delayus(50);//MCUé‡Šæ”¾æ€»çº¿20~40us,éœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´</span><br><span class="line">//if(Temp_data==0)&#123;</span><br><span class="line">//led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·</span><br><span class="line">// while(Temp_data==0); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿,è·³è¿‡ME</span><br><span class="line">       // Delayus(80);  //50æ‹‰é«˜åå»¶æ—¶80us</span><br><span class="line">// while(Temp_data==1);ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿,ç­‰å¾…æ‹‰ä½,è·³è¿‡EF</span><br><span class="line">//&#125;else&#123;led=1;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æ¥æ”¶ä¸€ä¸ªå­—èŠ‚</span><br><span class="line">unsigned char DHT11_rec_byte()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char i,dat=0;</span><br><span class="line">    for(i=0; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        while(!Temp_data);//è·³è¿‡æ•°æ®å‰æ®µçš„50us</span><br><span class="line">Delayus(33);//è¿‡äº†æ•°æ®0å’Œæ•°æ®1ç›¸åŒåŒºåŸŸï¼Œå†åšæ£€æµ‹      </span><br><span class="line">         dat &lt;&lt;=1;</span><br><span class="line">if(Temp_data==1)</span><br><span class="line">        &#123;//å¦‚æœè¯»åˆ°çš„æ•°æ®æ˜¯1</span><br><span class="line">  dat +=1;</span><br><span class="line">        &#125;</span><br><span class="line">while(Temp_data);</span><br><span class="line">    &#125;</span><br><span class="line">    return dat;</span><br><span class="line">&#125;</span><br><span class="line">//æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®</span><br><span class="line">void DHT11_receive()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int R_H,R_L,T_H,T_L;</span><br><span class="line">    unsigned char RH,RL,TH,TL,revise;</span><br><span class="line">DHT11_start();</span><br><span class="line">    if(Temp_data==0)</span><br><span class="line">    &#123;led=0;//æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·</span><br><span class="line">while(Temp_data==0); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿</span><br><span class="line">while(Temp_data==1); //ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿</span><br><span class="line">        R_H=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦é«˜å…«ä½</span><br><span class="line">        R_L=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦ä½å…«ä½</span><br><span class="line">        T_H=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦é«˜å…«ä½</span><br><span class="line">        T_L=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦ä½å…«ä½</span><br><span class="line">        revise=DHT11_rec_byte(); //æ¥æ”¶æ ¡æ­£ä½</span><br><span class="line">        Delayus(25);    //ç»“æŸ</span><br><span class="line"></span><br><span class="line">        if((R_H+R_L+T_H+T_L)==revise)      //æ ¡æ­£</span><br><span class="line">        &#123;</span><br><span class="line"> led2 = 0;</span><br><span class="line">            RH=R_H;</span><br><span class="line">            RL=R_L;</span><br><span class="line">            TH=T_H;</span><br><span class="line">            TL=T_L;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/</span><br><span class="line">        rec_dat[0]=RH;</span><br><span class="line">        rec_dat[1]=RL;</span><br><span class="line">        rec_dat[2]=TH;</span><br><span class="line">        rec_dat[3]=TL;</span><br><span class="line">  &#125;else&#123;led=1;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œstdio.hâ€<br>&#x2F;&#x2F;#include â€œstring.hâ€<br>&#x2F;&#x2F;#include â€œstdarg.hâ€ </p><p>#includeâ€œconfig.hâ€<br>#includeâ€œUSART1.hâ€<br>#includeâ€œdelay.hâ€</p><p>#define uint unsigned int<br>#define uchar unsigned char</p><p>&#x2F;*************åŠŸèƒ½è¯´æ˜**************</p><p>åŒä¸²å£å…¨åŒå·¥ä¸­æ–­æ–¹å¼æ”¶å‘é€šè®¯ç¨‹åºã€‚</p><p>é€šè¿‡PCå‘MCUå‘é€æ•°æ®, MCUæ”¶åˆ°åé€šè¿‡ä¸²å£æŠŠæ”¶åˆ°çš„æ•°æ®åŸæ ·è¿”å›.</p><p>******************************************&#x2F;</p><p>&#x2F;*************æœ¬åœ°å¸¸é‡å£°æ˜**************&#x2F;</p><p>sbit Temp_data &#x3D; P1^4 ;<br>sbit led &#x3D; P1^5;&#x2F;&#x2F;DHTå“åº”æŒ‡ç¤ºç¯<br>sbit led2 &#x3D; P1^6;&#x2F;&#x2F;æ•ˆéªŒæ•°æ®æŒ‡ç¤ºç¯<br>unsigned int rec_dat[4];<br>unsigned char dht_dat[4];<br>unsigned char rec_dat_lcd0[6];<br>unsigned char rec_dat_lcd1[6];<br>unsigned char rec_dat_lcd2[6];<br>unsigned char rec_dat_lcd3[6];</p><p>&#x2F;&#x2F;å®šä¹‰</p><p>void DHT11_start();&#x2F;&#x2F;DHTå¼€å§‹ä¿¡å·<br>unsigned char DHT11_rec_byte();<br>void DHT11_receive();</p><p>&#x2F;*************  å¤–éƒ¨å‡½æ•°å’Œå˜é‡å£°æ˜ *****************&#x2F;</p><p>&#x2F;*************  ä¸²å£1åˆå§‹åŒ–å‡½æ•° *****************&#x2F;<br>voidUART_config(void)<br>{<br>    COMx_InitDefineCOMx_InitStructure;&#x2F;&#x2F;ç»“æ„å®šä¹‰<br>    COMx_InitStructure.UART_Mode      &#x3D; UART_8bit_BRTx;&#x2F;&#x2F;æ¨¡å¼,       UART_ShiftRight,UART_8bit_BRTx,UART_9bit,UART_9bit_BRTx<br>    COMx_InitStructure.UART_BRT_Use   &#x3D; BRT_Timer2;&#x2F;&#x2F;ä½¿ç”¨æ³¢ç‰¹ç‡,   BRT_Timer1, BRT_Timer2 (æ³¨æ„: ä¸²å£2å›ºå®šä½¿ç”¨BRT_Timer2)<br>    COMx_InitStructure.UART_BaudRate  &#x3D; 115200ul;&#x2F;&#x2F;æ³¢ç‰¹ç‡, ä¸€èˆ¬ 110 ~ 115200<br>    COMx_InitStructure.UART_RxEnable  &#x3D; ENABLE;&#x2F;&#x2F;æ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE<br>    COMx_InitStructure.BaudRateDouble &#x3D; DISABLE;&#x2F;&#x2F;æ³¢ç‰¹ç‡åŠ å€, ENABLEæˆ–DISABLE<br>    COMx_InitStructure.UART_Interrupt &#x3D; ENABLE;&#x2F;&#x2F;ä¸­æ–­å…è®¸,   ENABLEæˆ–DISABLE<br>    COMx_InitStructure.UART_Polity    &#x3D; PolityLow;&#x2F;&#x2F;ä¸­æ–­ä¼˜å…ˆçº§, PolityLow,PolityHigh<br>    COMx_InitStructure.UART_P_SW      &#x3D; UART1_SW_P30_P31;&#x2F;&#x2F;åˆ‡æ¢ç«¯å£,   UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17(å¿…é¡»ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿ)<br>    COMx_InitStructure.UART_RXD_TXD_Short &#x3D; DISABLE;&#x2F;&#x2F;å†…éƒ¨çŸ­è·¯RXDä¸TXD, åšä¸­ç»§, ENABLE,DISABLE<br>    USART_Configuration(USART1, &amp;COMx_InitStructure);&#x2F;&#x2F;åˆå§‹åŒ–ä¸²å£1 USART1,USART2</p><pre><code>PrintString1(&quot;STC15W408AS UART1 \r\n&quot;);//SUART1å‘é€ä¸€ä¸ªå­—ç¬¦ä¸²</code></pre><p>}</p><p>&#x2F;**********************************************&#x2F;<br>void main(void)<br>{<br>    float tem &#x3D; 0.0,hum &#x3D; 0.0;<br>    led &#x3D; 1;<br>    led2 &#x3D; 1;<br>    UART_config();<br>    EA &#x3D; 1;</p><pre><code>while (1)&#123;                   delayms(150);    DHT11_receive();    sprintf(rec_dat_lcd0,&quot;%d&quot;,rec_dat[0]);    sprintf(rec_dat_lcd1,&quot;%d&quot;,rec_dat[1]);    sprintf(rec_dat_lcd2,&quot;%d&quot;,rec_dat[2]);    sprintf(rec_dat_lcd3,&quot;%d&quot;,rec_dat[3]);    hum = rec_dat[0] + rec_dat[1]/256.0;    tem = rec_dat[2] + rec_dat[3]/256.0;    printf(&quot;æ¸©åº¦:%.2f â„ƒ\r\n&quot;,tem);    printf(&quot;æ¹¿åº¦:%.2f ï¼…\r\n&quot;,hum);</code></pre><p>&#x2F;&#x2F;        printf(â€œæ¹¿åº¦:%d%d %%\tâ€,rec_dat[0],rec_dat[1]);<br>&#x2F;&#x2F;        printf(â€œæ¸©åº¦:%d%d â„ƒ\r\nâ€,rec_dat[2],rec_dat[3]);<br>                delayms(2000);<br>            led &#x3D; 1;<br>            led2 &#x3D; 1;<br>&#x2F;&#x2F;DHT11_start();</p><pre><code>&#125;</code></pre><p>}<br>&#x2F;&#x2F;DHT11èµ·å§‹ä¿¡å·</p><p>void DHT11_start()<br>{<br>    Temp_data&#x3D;1;<br>    Delayus(10);<br>    Temp_data&#x3D;0;<br>     delayms(25);&#x2F;&#x2F;è¿™ä¸ªå»¶æ—¶ä¸èƒ½è¿‡çŸ­,18msä»¥ä¸Š,å®é™…åœ¨ä»¿çœŸå½“ä¸­è¦æƒ³è¯»åˆ°æ•°æ®å»¶æ—¶è¦åœ¨å»¶æ—¶å‚æ•°è¦åœ¨40ä»¥ä¸Šæ‰èƒ½å‡ºæ•°æ®<br>    Temp_data&#x3D;1;<br>    Delayus(50);&#x2F;&#x2F;MCUé‡Šæ”¾æ€»çº¿20~40us,éœ€è¦åœ¨40å¾®ç§’åˆ°100å¾®ç§’ä¹‹é—´<br>&#x2F;&#x2F;if(Temp_data&#x3D;&#x3D;0){<br>&#x2F;&#x2F;led&#x3D;0;&#x2F;&#x2F;æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·<br>            &#x2F;&#x2F; while(Temp_data&#x3D;&#x3D;0); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿,è·³è¿‡ME<br>       &#x2F;&#x2F; Delayus(80);  &#x2F;&#x2F;50æ‹‰é«˜åå»¶æ—¶80us<br>            &#x2F;&#x2F; while(Temp_data&#x3D;&#x3D;1);ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿,ç­‰å¾…æ‹‰ä½,è·³è¿‡EF<br>&#x2F;&#x2F;}else{led&#x3D;1;}</p><p>}</p><p>&#x2F;&#x2F;æ¥æ”¶ä¸€ä¸ªå­—èŠ‚<br>unsigned char DHT11_rec_byte()<br>{<br>    unsigned char i,dat&#x3D;0;<br>    for(i&#x3D;0; i&lt;8; i++)<br>    {<br>        while(!Temp_data);&#x2F;&#x2F;è·³è¿‡æ•°æ®å‰æ®µçš„50us<br>                    Delayus(33);&#x2F;&#x2F;è¿‡äº†æ•°æ®0å’Œæ•°æ®1ç›¸åŒåŒºåŸŸï¼Œå†åšæ£€æµ‹<br>         dat &lt;&lt;&#x3D;1;<br>            if(Temp_data&#x3D;&#x3D;1)<br>        {&#x2F;&#x2F;å¦‚æœè¯»åˆ°çš„æ•°æ®æ˜¯1<br>                      dat +&#x3D;1;<br>        }<br>            while(Temp_data);<br>    }<br>    return dat;<br>}<br>&#x2F;&#x2F;æ¥æ”¶æ¸©æ¹¿åº¦æ•°æ®<br>void DHT11_receive()<br>{<br>    unsigned int R_H,R_L,T_H,T_L;<br>    unsigned char RH,RL,TH,TL,revise;<br>        DHT11_start();<br>        if(Temp_data&#x3D;&#x3D;0)<br>    {led&#x3D;0;&#x2F;&#x2F;æ£€æµ‹ä»è®¾å¤‡DHTæ‹‰ä½æ€»çº¿ä¿¡å·ï¼Œä½œä¸ºå“åº”ä¿¡å·<br>            while(Temp_data&#x3D;&#x3D;0); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰é«˜æ€»çº¿<br>            while(Temp_data&#x3D;&#x3D;1); &#x2F;&#x2F;ç­‰å¾…DHTå“åº”ä¿¡å·ï¼Œ80uså†…æ¥æ‹‰ä½æ€»çº¿<br>        R_H&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶æ¹¿åº¦é«˜å…«ä½<br>        R_L&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶æ¹¿åº¦ä½å…«ä½<br>        T_H&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶æ¸©åº¦é«˜å…«ä½<br>        T_L&#x3D;DHT11_rec_byte();    &#x2F;&#x2F;æ¥æ”¶æ¸©åº¦ä½å…«ä½<br>        revise&#x3D;DHT11_rec_byte(); &#x2F;&#x2F;æ¥æ”¶æ ¡æ­£ä½<br>        Delayus(25);    &#x2F;&#x2F;ç»“æŸ</p><pre><code>    if((R_H+R_L+T_H+T_L)==revise)      //æ ¡æ­£    &#123;                 led2 = 0;        RH=R_H;        RL=R_L;        TH=T_H;        TL=T_L;                    &#125;    /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/    rec_dat[0]=RH;    rec_dat[1]=RL;    rec_dat[2]=TH;    rec_dat[3]=TL;</code></pre><p>  }else{led&#x3D;1;}<br>}&#96;</p><h4 id="ç¨‹åºå®Œæ•´æºç å·¥ç¨‹"><a href="#ç¨‹åºå®Œæ•´æºç å·¥ç¨‹" class="headerlink" title="ç¨‹åºå®Œæ•´æºç å·¥ç¨‹"></a>ç¨‹åºå®Œæ•´æºç å·¥ç¨‹</h4><p>åˆ›ä½œä¸æ˜“ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Bm8VW8S0CbFC5sw0taGB_w </span><br><span class="line">æå–ç ï¼šgkjj</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Bm8VW8S0CbFC5sw0taGB_w  æå–ç ï¼šgkjj</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘4-16è¯‘ç å™¨ï¼ˆ74HC154 ï¼‰æµæ°´ç¯</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F416%E8%AF%91%E7%A0%81%E5%99%A874HC154-%E6%B5%81%E6%B0%B4%E7%81%AF/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F416%E8%AF%91%E7%A0%81%E5%99%A874HC154-%E6%B5%81%E6%B0%B4%E7%81%AF/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘4-16è¯‘ç å™¨ï¼ˆ74HC154-ï¼‰æµæ°´ç¯"><a href="#ã€Proteusä»¿çœŸã€‘4-16è¯‘ç å™¨ï¼ˆ74HC154-ï¼‰æµæ°´ç¯" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4-16è¯‘ç å™¨ï¼ˆ74HC154 ï¼‰æµæ°´ç¯"></a>ã€Proteusä»¿çœŸã€‘4-16è¯‘ç å™¨ï¼ˆ74HC154 ï¼‰æµæ°´ç¯</h1><h3 id="ã€Proteusä»¿çœŸã€‘4-16è¯‘ç å™¨ï¼ˆ74HC154-ï¼‰æµæ°´ç¯-1"><a href="#ã€Proteusä»¿çœŸã€‘4-16è¯‘ç å™¨ï¼ˆ74HC154-ï¼‰æµæ°´ç¯-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4-16è¯‘ç å™¨ï¼ˆ74HC154 ï¼‰æµæ°´ç¯"></a>ã€Proteusä»¿çœŸã€‘4-16è¯‘ç å™¨ï¼ˆ74HC154 ï¼‰æµæ°´ç¯</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/38a7d5893ad94afbba446ff0fce32668.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="74HC154ç®€ä»‹"><a href="#74HC154ç®€ä»‹" class="headerlink" title="74HC154ç®€ä»‹"></a>74HC154ç®€ä»‹</h4><p>74HC154ï¼›74HCT154æ˜¯ä¸€ç§é«˜é€Ÿç¡…æ …CMOSå™¨ä»¶ï¼Œä¸ä½åŠŸè€—è‚–ç‰¹åŸºTTLï¼ˆLSTTLï¼‰å¼•è„šå…¼å®¹ã€‚ 74HC154è§£ç å™¨æ¥å—å››ä¸ªæ´»åŠ¨çš„é«˜äºŒè¿›åˆ¶åœ°å€è¾“å…¥å¹¶æä¾›16ä¸ªäº’æ–¥çš„æ´»åŠ¨ä½è¾“å‡ºã€‚åŒè¾“å…¥ä½¿èƒ½é—¨å¯ä»¥ç”¨æ¥é€‰é€šè§£ç å™¨ï¼Œä»¥æ¶ˆé™¤è¾“å‡ºä¸Šçš„æ­£å¸¸è§£ç â€œå°æ•…éšœâ€ï¼Œæˆ–è€…å¯ä»¥ç”¨æ¥æ‰©å±•è§£ç å™¨ã€‚ ä½¿èƒ½é—¨æœ‰ä¸¤ä¸ªè¾“å…¥,å¿…é¡»æ¥ä½ç”µå¹³ï¼Œä»¥ä½¿èƒ½è¾“å‡ºã€‚ 74HC154å¯ä»¥é€šè¿‡ä½¿ç”¨ä½¿èƒ½è¾“å…¥ä¹‹ä¸€ä½œä¸ºå¤šè·¯å¤ç”¨æ•°æ®è¾“å…¥æ¥ç”¨ä½œ1-åˆ°16çš„è§£å¤ç”¨å™¨ã€‚ å½“å¦ä¸€ä¸ªå¯ç”¨è¾“å…¥ä¸ºLOWæ—¶ï¼Œå¯»å€è¾“å‡ºå°†éµå¾ªåº”ç”¨æ•°æ®çš„çŠ¶æ€ã€‚</p><ul><li>74HC154åŠŸèƒ½å›¾</li><li>é€»è¾‘åŠŸèƒ½å›¾</li><li>å¼•è„šå›¾</li></ul><p><img src="https://img-blog.csdnimg.cn/f27422fb1f7b47528de9154a2b8d8b58.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/68d06876c8364487bb7aa5f2097098ef.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/d49b3caffbe44cd7af77fc94be1ffa4d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/039ecbbb5a4648dcb698885b84b48fd8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/a2aa8688076b4de6ad74cc8c443b9fda.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/23ad22344420486882b8163b044dd475.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="çœŸå€¼è¡¨"><a href="#çœŸå€¼è¡¨" class="headerlink" title="çœŸå€¼è¡¨"></a>çœŸå€¼è¡¨</h4><p><img src="https://img-blog.csdnimg.cn/5b0989615c384d0eb97f25aa029cc469.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>ä¾›ç”µå‚æ•°</li></ul><p><img src="https://img-blog.csdnimg.cn/fd267362e2f74211b9afb14087b090a3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç ä»¥åŠæ•°æ®æ‰‹å†Œèµ„æ–™"><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç ä»¥åŠæ•°æ®æ‰‹å†Œèµ„æ–™" class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç ä»¥åŠæ•°æ®æ‰‹å†Œèµ„æ–™"></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç ä»¥åŠæ•°æ®æ‰‹å†Œèµ„æ–™</h4><p><img src="https://img-blog.csdnimg.cn/ea3f108a37a2475a9a9082a940e86f7e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1055dXTKsHzXnKdNIAbCs4Q </span><br><span class="line">æå–ç ï¼šiefm</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1055dXTKsHzXnKdNIAbCs4Q  æå–ç ï¼šiefm</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘PCF8591 ADç”µå‹é‡‡é›†8X8ç‚¹é˜µæ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FPCF8591-AD%E7%94%B5%E5%8E%8B%E9%87%87%E9%9B%868X8%E7%82%B9%E9%98%B5%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FPCF8591-AD%E7%94%B5%E5%8E%8B%E9%87%87%E9%9B%868X8%E7%82%B9%E9%98%B5%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘PCF8591-ADç”µå‹é‡‡é›†8X8ç‚¹é˜µæ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘PCF8591-ADç”µå‹é‡‡é›†8X8ç‚¹é˜µæ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘PCF8591 ADç”µå‹é‡‡é›†8X8ç‚¹é˜µæ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘PCF8591 ADç”µå‹é‡‡é›†8X8ç‚¹é˜µæ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘PCF8591-ADç”µå‹é‡‡é›†8X8ç‚¹é˜µæ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘PCF8591-ADç”µå‹é‡‡é›†8X8ç‚¹é˜µæ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘PCF8591 ADç”µå‹é‡‡é›†8X8ç‚¹é˜µæ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘PCF8591 ADç”µå‹é‡‡é›†8X8ç‚¹é˜µæ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸæ•ˆæœ</li><li>é‡‡ç”¨çš„æ˜¯8X8ç‚¹é˜µæ¥ä½œä¸ºæ•°æ®æ˜¾ç¤ºçš„ï¼Œæ˜¾ç¤ºç²¾åº¦æ˜¯å°æ•°ç‚¹å2ä½ï¼Œæ˜¾ç¤ºæ–¹å¼æ˜¯è½®æµæ˜¾ç¤ºã€‚</li><li>è¯»å–çš„ç”µå‹èŒƒå›´æ˜¯ï¼š0 ~ 4.98Vï¼ˆæ»‘åŠ¨ç”µé˜»åœ¨0æ¬§å§†æ˜¯çš„ç”µå‹å€¼ä¸ºæœ€é«˜4.98Vï¼Œæ»‘åŠ¨ç”µé˜»é˜»å€¼æœ€å¤§æ—¶ï¼Œç”µå‹å€¼æœ€ä½0.ï¼‰</li><li>é‡‡ç”¨æ•°æ®é”å­˜å™¨74HC573æ¥é©±åŠ¨æ˜¾ç¤ºçš„ã€‚</li></ul><p>Proteusä»¿çœŸæ•ˆæœ</p><p><img src="https://img-blog.csdnimg.cn/27eb77c85edc4419b087b6254acba635.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é‡‡ç”¨çš„æ˜¯8X8ç‚¹é˜µæ¥ä½œä¸ºæ•°æ®æ˜¾ç¤ºçš„ï¼Œæ˜¾ç¤ºç²¾åº¦æ˜¯å°æ•°ç‚¹å2ä½ï¼Œæ˜¾ç¤ºæ–¹å¼æ˜¯è½®æµæ˜¾ç¤ºã€‚</p><p>è¯»å–çš„ç”µå‹èŒƒå›´æ˜¯ï¼š0 ~ 4.98Vï¼ˆæ»‘åŠ¨ç”µé˜»åœ¨0æ¬§å§†æ˜¯çš„ç”µå‹å€¼ä¸ºæœ€é«˜4.98Vï¼Œæ»‘åŠ¨ç”µé˜»é˜»å€¼æœ€å¤§æ—¶ï¼Œç”µå‹å€¼æœ€ä½0.ï¼‰</p><p><code>0 ~ 4.98V</code></p><p>é‡‡ç”¨æ•°æ®é”å­˜å™¨74HC573æ¥é©±åŠ¨æ˜¾ç¤ºçš„ã€‚</p><h4 id="ä¸»ç¨‹åºç¤ºä¾‹ä»£ç "><a href="#ä¸»ç¨‹åºç¤ºä¾‹ä»£ç " class="headerlink" title="ä¸»ç¨‹åºç¤ºä¾‹ä»£ç "></a>ä¸»ç¨‹åºç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">/**********************************************************************************</span><br><span class="line"></span><br><span class="line">--------------------------------*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#include&lt;reg52.h&gt;</span><br><span class="line">#include &lt;I2C.H&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#define  PCF8591 0x90    //PCF8591 åœ°å€</span><br><span class="line"></span><br><span class="line">unsigned char code tab[]= &#123;0xfe,0xfd,0xfb,0xf7,</span><br><span class="line">                           0xef,0xdf,0xbf,0x7f</span><br><span class="line">                          &#125;;</span><br><span class="line">unsigned char code graph[11][8]= &#123;</span><br><span class="line">    &#123;0x0,0x18,0x24,0x24,0x24,0x24,0x24,0x18&#125;,//0</span><br><span class="line">    &#123;0x0,0x8,0x18,0x8,0x8,0x8,0x8,0x8&#125;,//1</span><br><span class="line">    &#123;0x0,0x18,0x24,0x24,0x8,0x10,0x20,0x3C&#125;,//2</span><br><span class="line">    &#123;0x0,0x18,0x24,0x4,0x8,0x24,0x24,0x18&#125;,//3</span><br><span class="line">    &#123;0x0,0x8,0x8,0x18,0x28,0x3C,0x8,0x8&#125;,//4</span><br><span class="line">    &#123;0x0,0x3C,0x20,0x38,0x4,0x4,0x24,0x18&#125;,//5</span><br><span class="line">    &#123;0x0,0x18,0x24,0x20,0x38,0x24,0x24,0x18&#125;,//6</span><br><span class="line">    &#123;0x0,0x3C,0x24,0x4,0x8,0x10,0x10,0x10&#125;,//7</span><br><span class="line">    &#123;0x0,0x18,0x24,0x24,0x18,0x24,0x24,0x18&#125;,//8</span><br><span class="line">    &#123;0x0,0x18,0x24,0x24,0x1C,0x4,0x24,0x18&#125;,//9</span><br><span class="line">    &#123;0x4C,0xD2,0x52,0x52,0x52,0x52,0x52,0xEC&#125;,//10</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">unsigned char count;</span><br><span class="line">unsigned char cnta;</span><br><span class="line"></span><br><span class="line">unsigned char AD_CHANNEL;</span><br><span class="line">unsigned int  D[4];</span><br><span class="line"></span><br><span class="line">void delay11(unsigned int cnt)</span><br><span class="line">&#123;</span><br><span class="line">    while(--cnt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*******************************************************************</span><br><span class="line">ADCå‘é€å­—èŠ‚[å‘½ä»¤]æ•°æ®å‡½æ•°</span><br><span class="line">*******************************************************************/</span><br><span class="line">bit ISendByte(unsigned char sla,unsigned char c)</span><br><span class="line">&#123;</span><br><span class="line">    Start_I2c();              //å¯åŠ¨æ€»çº¿</span><br><span class="line">    SendByte(sla);            //å‘é€å™¨ä»¶åœ°å€</span><br><span class="line">    if(ack==0)return(0);</span><br><span class="line">    SendByte(c);              //å‘é€æ•°æ®</span><br><span class="line">    if(ack==0)return(0);</span><br><span class="line">    Stop_I2c();               //ç»“æŸæ€»çº¿</span><br><span class="line">    return(1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*******************************************************************</span><br><span class="line">ADCè¯»å­—èŠ‚æ•°æ®å‡½æ•°</span><br><span class="line">*******************************************************************/</span><br><span class="line">unsigned char IRcvByte(unsigned char sla)</span><br><span class="line">&#123;   unsigned char c;</span><br><span class="line"></span><br><span class="line">    Start_I2c();          //å¯åŠ¨æ€»çº¿</span><br><span class="line">    SendByte(sla+1);      //å‘é€å™¨ä»¶åœ°å€</span><br><span class="line">    if(ack==0)return(0);</span><br><span class="line">    c=RcvByte();          //è¯»å–æ•°æ®0</span><br><span class="line"></span><br><span class="line">    Ack_I2c(1);           //å‘é€éå°±ç­”ä½</span><br><span class="line">    Stop_I2c();           //ç»“æŸæ€»çº¿</span><br><span class="line">    return(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//******************************************************************/</span><br><span class="line">main()</span><br><span class="line">&#123;   unsigned char jj,kk,ll,bb,cc,dd;</span><br><span class="line">    double Data; //</span><br><span class="line">    double V; //è½¬åŒ–æˆçš„ç”µå‹å€¼</span><br><span class="line"></span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        ISendByte(PCF8591,0x40);</span><br><span class="line">        Data=IRcvByte(PCF8591);  //ADC0 æ¨¡æ•°è½¬æ¢1</span><br><span class="line">        V=Data*5/256;</span><br><span class="line">        D[0]=V*100;</span><br><span class="line"></span><br><span class="line">        for(bb=0; bb&lt;10; bb++) &#123;</span><br><span class="line">            for(jj=0; jj&lt;8; jj++) //å…±è¦æ‰«æå…«è¡Œ</span><br><span class="line">            &#123;</span><br><span class="line">                P1=graph[D[0]/100][jj];   //é€å­—æ¨¡æ•°æ®</span><br><span class="line">                P2=tab[jj];</span><br><span class="line">                delay11(200);   //é€‰ä¸­ç¬¬ä¸€è¡Œ</span><br><span class="line">                P2=0xff;</span><br><span class="line">                delay11(500);</span><br><span class="line">            &#125;</span><br><span class="line">            delay11(500);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for(bb=0; bb&lt;10; bb++) &#123;</span><br><span class="line">            for(jj=0; jj&lt;8; jj++) //å…±è¦æ‰«æå…«è¡Œ</span><br><span class="line">            &#123;</span><br><span class="line">                P1=0x06;</span><br><span class="line">                P2=0x7f;</span><br><span class="line">                delay11(500);</span><br><span class="line">                P2=0xbf;</span><br><span class="line">                delay11(500);</span><br><span class="line">            &#125;</span><br><span class="line">            delay11(500);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        for(cc=0; cc&lt;10; cc++) &#123;</span><br><span class="line">            for(kk=0; kk&lt;8; kk++) //å…±è¦æ‰«æå…«è¡Œ</span><br><span class="line">            &#123;</span><br><span class="line">                P1=graph[D[0]%100/10][kk];   //é€å­—æ¨¡æ•°æ®</span><br><span class="line">                P2=tab[kk];</span><br><span class="line">                delay11(200);   //é€‰ä¸­ç¬¬ä¸€è¡Œ</span><br><span class="line">                P2=0xff;</span><br><span class="line">                delay11(500);</span><br><span class="line">            &#125;</span><br><span class="line">            delay11(500);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for(dd=0; dd&lt;10; dd++)</span><br><span class="line">        &#123;</span><br><span class="line">            for(ll=0; ll&lt;8; ll++) //å…±è¦æ‰«æå…«è¡Œ</span><br><span class="line">            &#123;</span><br><span class="line">                P1=graph[D[0]%10][ll];   //é€å­—æ¨¡æ•°æ®</span><br><span class="line">                P2=tab[ll];</span><br><span class="line">                delay11(200);   //é€‰ä¸­ç¬¬ä¸€è¡Œ</span><br><span class="line">                P2=0xff;</span><br><span class="line">                delay11(500);</span><br><span class="line">            &#125;</span><br><span class="line">            delay11(500);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;**********************************************************************************</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“*&#x2F;</p><p>#include&lt;reg52.h&gt;<br>#include &lt;I2C.H&gt;<br>#define uchar unsigned char<br>#define uint unsigned int</p><p>#define  PCF8591 0x90    &#x2F;&#x2F;PCF8591 åœ°å€</p><p>unsigned char code tab[]&#x3D; {0xfe,0xfd,0xfb,0xf7,<br>                           0xef,0xdf,0xbf,0x7f<br>                          };<br>unsigned char code graph[11][8]&#x3D; {<br>    {0x0,0x18,0x24,0x24,0x24,0x24,0x24,0x18},&#x2F;&#x2F;0<br>    {0x0,0x8,0x18,0x8,0x8,0x8,0x8,0x8},&#x2F;&#x2F;1<br>    {0x0,0x18,0x24,0x24,0x8,0x10,0x20,0x3C},&#x2F;&#x2F;2<br>    {0x0,0x18,0x24,0x4,0x8,0x24,0x24,0x18},&#x2F;&#x2F;3<br>    {0x0,0x8,0x8,0x18,0x28,0x3C,0x8,0x8},&#x2F;&#x2F;4<br>    {0x0,0x3C,0x20,0x38,0x4,0x4,0x24,0x18},&#x2F;&#x2F;5<br>    {0x0,0x18,0x24,0x20,0x38,0x24,0x24,0x18},&#x2F;&#x2F;6<br>    {0x0,0x3C,0x24,0x4,0x8,0x10,0x10,0x10},&#x2F;&#x2F;7<br>    {0x0,0x18,0x24,0x24,0x18,0x24,0x24,0x18},&#x2F;&#x2F;8<br>    {0x0,0x18,0x24,0x24,0x1C,0x4,0x24,0x18},&#x2F;&#x2F;9<br>    {0x4C,0xD2,0x52,0x52,0x52,0x52,0x52,0xEC},&#x2F;&#x2F;10<br>};</p><p>unsigned char count;<br>unsigned char cnta;</p><p>unsigned char AD_CHANNEL;<br>unsigned int  D[4];</p><p>void delay11(unsigned int cnt)<br>{<br>    while(â€“cnt);<br>}</p><p>&#x2F;*******************************************************************<br>ADCå‘é€å­—èŠ‚[å‘½ä»¤]æ•°æ®å‡½æ•°<br>*******************************************************************&#x2F;<br>bit ISendByte(unsigned char sla,unsigned char c)<br>{<br>    Start_I2c();              &#x2F;&#x2F;å¯åŠ¨æ€»çº¿<br>    SendByte(sla);            &#x2F;&#x2F;å‘é€å™¨ä»¶åœ°å€<br>    if(ack&#x3D;&#x3D;0)return(0);<br>    SendByte(c);              &#x2F;&#x2F;å‘é€æ•°æ®<br>    if(ack&#x3D;&#x3D;0)return(0);<br>    Stop_I2c();               &#x2F;&#x2F;ç»“æŸæ€»çº¿<br>    return(1);<br>}</p><p>&#x2F;*******************************************************************<br>ADCè¯»å­—èŠ‚æ•°æ®å‡½æ•°<br>*******************************************************************&#x2F;<br>unsigned char IRcvByte(unsigned char sla)<br>{   unsigned char c;</p><pre><code>Start_I2c();          //å¯åŠ¨æ€»çº¿SendByte(sla+1);      //å‘é€å™¨ä»¶åœ°å€if(ack==0)return(0);c=RcvByte();          //è¯»å–æ•°æ®0Ack_I2c(1);           //å‘é€éå°±ç­”ä½Stop_I2c();           //ç»“æŸæ€»çº¿return(c);</code></pre><p>}</p><p>&#x2F;&#x2F;******************************************************************&#x2F;<br>main()<br>{   unsigned char jj,kk,ll,bb,cc,dd;<br>    double Data; &#x2F;&#x2F;<br>    double V; &#x2F;&#x2F;è½¬åŒ–æˆçš„ç”µå‹å€¼</p><pre><code>while(1)&#123;    ISendByte(PCF8591,0x40);    Data=IRcvByte(PCF8591);  //ADC0 æ¨¡æ•°è½¬æ¢1    V=Data*5/256;    D[0]=V*100;    for(bb=0; bb&lt;10; bb++) &#123;        for(jj=0; jj&lt;8; jj++) //å…±è¦æ‰«æå…«è¡Œ        &#123;            P1=graph[D[0]/100][jj];   //é€å­—æ¨¡æ•°æ®            P2=tab[jj];            delay11(200);   //é€‰ä¸­ç¬¬ä¸€è¡Œ            P2=0xff;            delay11(500);        &#125;        delay11(500);    &#125;    for(bb=0; bb&lt;10; bb++) &#123;        for(jj=0; jj&lt;8; jj++) //å…±è¦æ‰«æå…«è¡Œ        &#123;            P1=0x06;            P2=0x7f;            delay11(500);            P2=0xbf;            delay11(500);        &#125;        delay11(500);    &#125;    for(cc=0; cc&lt;10; cc++) &#123;        for(kk=0; kk&lt;8; kk++) //å…±è¦æ‰«æå…«è¡Œ        &#123;            P1=graph[D[0]%100/10][kk];   //é€å­—æ¨¡æ•°æ®            P2=tab[kk];            delay11(200);   //é€‰ä¸­ç¬¬ä¸€è¡Œ            P2=0xff;            delay11(500);        &#125;        delay11(500);    &#125;    for(dd=0; dd&lt;10; dd++)    &#123;        for(ll=0; ll&lt;8; ll++) //å…±è¦æ‰«æå…«è¡Œ        &#123;            P1=graph[D[0]%10][ll];   //é€å­—æ¨¡æ•°æ®            P2=tab[ll];            delay11(200);   //é€‰ä¸­ç¬¬ä¸€è¡Œ            P2=0xff;            delay11(500);        &#125;        delay11(500);    &#125;&#125;</code></pre><p>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1IQYZ9810e0Nr3Z_BnriRMw </span><br><span class="line">æå–ç ï¼šxtrt</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1IQYZ9810e0Nr3Z_BnriRMw  æå–ç ï¼šxtrt</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FTLC5615%E8%BE%93%E5%87%BA256%E7%82%B9%E6%AD%A3%E5%BC%A6%E6%B3%A2%E6%8C%AF%E5%B9%85%E5%8F%AF%E8%B0%83/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FTLC5615%E8%BE%93%E5%87%BA256%E7%82%B9%E6%AD%A3%E5%BC%A6%E6%B3%A2%E6%8C%AF%E5%B9%85%E5%8F%AF%E8%B0%83/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰"><a href="#ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰" class="headerlink" title="ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰"></a>ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰</h1><h3 id="ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰-1"><a href="#ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰"></a>ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰</h3><ul><li>ç›¸å…³ç¯‡ã€Šã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰ã€‹</li><li>Proteusä»¿çœŸ</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/124524009">ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰</a></p><p><img src="https://img-blog.csdnimg.cn/9a9219760e8343a1a6ed159b8637ca81.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é€šè¿‡å¯è°ƒç”µé˜»ï¼Œè°ƒèŠ‚å‚è€ƒå¼•è„šè¾“å…¥çš„ç”µå‹å€¼ï¼Œä»è€Œæ”¹å˜è¾“å‡ºæŒ¯å¹…</p><ul><li>æ‰€éœ€è¦ä½¿ç”¨åˆ°çš„å·¥å…·</li></ul><p>æ­£å¼¦æ³¢æ•°æ®ç”Ÿæˆå™¨ï¼ˆæœ€å¤§4096ç‚¹ï¼‰</p><p><img src="https://img-blog.csdnimg.cn/b7424cec79de4160b6d68be51c85b5a1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¨‹åºæºç "><a href="#ç¨‹åºæºç " class="headerlink" title="ç¨‹åºæºç "></a>ç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">/************************************************************************************</span><br><span class="line">1.TLC5615 DAæ¨¡å—</span><br><span class="line">ã€ç¨‹åºåŠŸèƒ½ã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢</span><br><span class="line">TLC5615 DAæ¨¡å—æœ¬èº«å¿…é¡»ä½¿ç”¨5Vç”µæºï¼Œæ§åˆ¶ä¿¡å·å¯ä»¥æ¥å—3.3Væˆ–è€…5Vã€‚</span><br><span class="line">ã€IOé…ç½®ã€‘</span><br><span class="line">DIN---&gt;P1.0</span><br><span class="line">SCLK---&gt;P1.1</span><br><span class="line">CS---&gt;P1.2</span><br><span class="line">Dout---&gt;ç©ºï¼Œæœªå®šä¹‰</span><br><span class="line">************************************************************************************/</span><br><span class="line">#include&lt;reg52.h&gt;//åŒ…å«51å•ç‰‡æœºå¯„å­˜å™¨å®šä¹‰çš„å¤´æ–‡ä»¶</span><br><span class="line">#include&lt;intrins.h&gt;//åŒ…å«nopå‡½æ•°çš„å¤´æ–‡ä»¶</span><br><span class="line">#define uchar unsigned char//å®å®šä¹‰</span><br><span class="line">#define uint unsigned int//å®å®šä¹‰</span><br><span class="line"></span><br><span class="line">sbit DIN=P1^0;//IOå®šä¹‰</span><br><span class="line">sbit SCLK=P1^1;</span><br><span class="line">sbit CS=P1^2;</span><br><span class="line"></span><br><span class="line">uint code sin1[256]=//256ç‚¹12ä½æ•°æ®çš„æ­£å¼¦æ³¢è¡¨</span><br><span class="line">&#123;</span><br><span class="line">0x7F,0x82,0x85,0x88,0x8B,0x8F,0x92,0x95,0x98,0x9B,0x9E,0xA1,0xA4,0xA7,0xAA,0xAD</span><br><span class="line">,0xB0,0xB3,0xB6,0xB8,0xBB,0xBE,0xC1,0xC3,0xC6,0xC8,0xCB,0xCD,0xD0,0xD2,0xD5,0xD7</span><br><span class="line">,0xD9,0xDB,0xDD,0xE0,0xE2,0xE4,0xE5,0xE7,0xE9,0xEB,0xEC,0xEE,0xEF,0xF1,0xF2,0xF4</span><br><span class="line">,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFB,0xFC,0xFD,0xFD,0xFE,0xFE,0xFE,0xFE,0xFE</span><br><span class="line">,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFD,0xFD,0xFC,0xFB,0xFB,0xFA,0xF9,0xF8,0xF7,0xF6</span><br><span class="line">,0xF5,0xF4,0xF2,0xF1,0xEF,0xEE,0xEC,0xEB,0xE9,0xE7,0xE5,0xE4,0xE2,0xE0,0xDD,0xDB</span><br><span class="line">,0xD9,0xD7,0xD5,0xD2,0xD0,0xCD,0xCB,0xC8,0xC6,0xC3,0xC1,0xBE,0xBB,0xB8,0xB6,0xB3</span><br><span class="line">,0xB0,0xAD,0xAA,0xA7,0xA4,0xA1,0x9E,0x9B,0x98,0x95,0x92,0x8F,0x8B,0x88,0x85,0x82</span><br><span class="line">,0x7F,0x7C,0x79,0x76,0x73,0x6F,0x6C,0x69,0x66,0x63,0x60,0x5D,0x5A,0x57,0x54,0x51</span><br><span class="line">,0x4E,0x4B,0x48,0x46,0x43,0x40,0x3D,0x3B,0x38,0x36,0x33,0x31,0x2E,0x2C,0x29,0x27</span><br><span class="line">,0x25,0x23,0x21,0x1E,0x1C,0x1A,0x19,0x17,0x15,0x13,0x12,0x10,0x0F,0x0D,0x0C,0x0A</span><br><span class="line">,0x09,0x08,0x07,0x06,0x05,0x04,0x03,0x03,0x02,0x01,0x01,0x00,0x00,0x00,0x00,0x00</span><br><span class="line">,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x02,0x03,0x03,0x04,0x05,0x06,0x07,0x08</span><br><span class="line">,0x09,0x0A,0x0C,0x0D,0x0F,0x10,0x12,0x13,0x15,0x17,0x19,0x1A,0x1C,0x1E,0x21,0x23</span><br><span class="line">,0x25,0x27,0x29,0x2C,0x2E,0x31,0x33,0x36,0x38,0x3B,0x3D,0x40,0x43,0x46,0x48,0x4B</span><br><span class="line">,0x4E,0x51,0x54,0x57,0x5A,0x5D,0x60,0x63,0x66,0x69,0x6C,0x6F,0x73,0x76,0x79,0x7C</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> void delay_us(unsigned char n)//usçº§å»¶æ—¶å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line"> unsigned char i;</span><br><span class="line"> for(i=0;i&lt;n;i++);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/******************************************************************</span><br><span class="line">1.sclkçš„ä¸Šå‡æ²¿æ•°æ®è¿›å…¥è¾“å…¥å¯„å­˜å™¨</span><br><span class="line">2.åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSçš„ä¸Šå‡æ²¿æ•°æ®å¼€å§‹DAè½¬åŒ–</span><br><span class="line">3.è¿ç»­è¾“å…¥12ä½æ•°æ®ï¼Œé«˜ä½åœ¨å‰ï¼Œå…¶ä¸­å‰10ä½æœ‰æ•ˆï¼Œåä¸¤ä½è¡¥0</span><br><span class="line">***************************************************************/</span><br><span class="line">void output(uint DA_Value)//TLC5615é©±åŠ¨å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i;</span><br><span class="line">DA_Value=DA_Value&lt;&lt;6;//å°†DA_Valueå·¦ç§»6ä½ï¼Œå³nnnn nnnn nnnnå˜ä¸ºnnnn nnnn nn00 0000</span><br><span class="line">SCLK=0;//ä¸ºä½ï¼Œå‡†å¤‡è¾“å…¥æ•°æ®</span><br><span class="line">CS=0;//ç‰‡é€‰</span><br><span class="line">for(i=12;i&gt;0;i--)//ä»é«˜ä½å¼€å§‹ï¼Œè¿ç»­å–å‡º12ä½æ•°æ®ï¼Œ</span><br><span class="line">&#123;</span><br><span class="line">if(DA_Value&amp;0x8000)//å’Œ1000 0000 0000 0000æ±‚ä¸ï¼Œè·å–æœ€é«˜ä½çš„å€¼ã€‚</span><br><span class="line">DIN=1;</span><br><span class="line">else</span><br><span class="line">DIN=0;</span><br><span class="line">SCLK=1;//ä¸Šå‡æ²¿ï¼Œè¿›å…¥è¾“å…¥å¯„å­˜å™¨</span><br><span class="line">SCLK=0;//å‡†å¤‡ä¸‹ä¸€æ¬¡è¾“å…¥</span><br><span class="line">DA_Value=DA_Value&lt;&lt;1;//å·¦ç§»1ä½ï¼Œå‡†å¤‡è¾“å…¥ä¸‹ä¸€ä½æ•°æ®</span><br><span class="line">&#125;</span><br><span class="line">CS=1;//åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSä¸Šå‡æ²¿ï¼Œæ•°æ®å¼€å§‹DAè½¬åŒ–</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">   uint i;</span><br><span class="line">   while(1)</span><br><span class="line">&#123;</span><br><span class="line">i=0;</span><br><span class="line">for(i=0;i&lt;255;i++)//è¿ç»­å–å‡º256ç‚¹æ­£å¼¦æ•°æ®</span><br><span class="line">output(sin1[i]);//è¾“å‡ºæ­£å¼¦æ³¢</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;************************************************************************************<br>1.TLC5615 DAæ¨¡å—<br>ã€ç¨‹åºåŠŸèƒ½ã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢<br>TLC5615 DAæ¨¡å—æœ¬èº«å¿…é¡»ä½¿ç”¨5Vç”µæºï¼Œæ§åˆ¶ä¿¡å·å¯ä»¥æ¥å—3.3Væˆ–è€…5Vã€‚<br>ã€IOé…ç½®ã€‘<br>DINâ€”&gt;P1.0<br>SCLKâ€”&gt;P1.1<br>CSâ€”&gt;P1.2<br>Doutâ€”&gt;ç©ºï¼Œæœªå®šä¹‰<br>************************************************************************************&#x2F;<br>#include&lt;reg52.h&gt;&#x2F;&#x2F;åŒ…å«51å•ç‰‡æœºå¯„å­˜å™¨å®šä¹‰çš„å¤´æ–‡ä»¶<br>#include&lt;intrins.h&gt;&#x2F;&#x2F;åŒ…å«nopå‡½æ•°çš„å¤´æ–‡ä»¶<br>#define uchar unsigned char&#x2F;&#x2F;å®å®šä¹‰<br>#define uint unsigned int&#x2F;&#x2F;å®å®šä¹‰</p><p>sbit DIN&#x3D;P1^0;&#x2F;&#x2F;IOå®šä¹‰<br>sbit SCLK&#x3D;P1^1;<br>sbit CS&#x3D;P1^2;</p><p>uint code sin1[256]&#x3D;&#x2F;&#x2F;256ç‚¹12ä½æ•°æ®çš„æ­£å¼¦æ³¢è¡¨<br>{<br>    0x7F,0x82,0x85,0x88,0x8B,0x8F,0x92,0x95,0x98,0x9B,0x9E,0xA1,0xA4,0xA7,0xAA,0xAD<br>,0xB0,0xB3,0xB6,0xB8,0xBB,0xBE,0xC1,0xC3,0xC6,0xC8,0xCB,0xCD,0xD0,0xD2,0xD5,0xD7<br>,0xD9,0xDB,0xDD,0xE0,0xE2,0xE4,0xE5,0xE7,0xE9,0xEB,0xEC,0xEE,0xEF,0xF1,0xF2,0xF4<br>,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFB,0xFC,0xFD,0xFD,0xFE,0xFE,0xFE,0xFE,0xFE<br>,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFD,0xFD,0xFC,0xFB,0xFB,0xFA,0xF9,0xF8,0xF7,0xF6<br>,0xF5,0xF4,0xF2,0xF1,0xEF,0xEE,0xEC,0xEB,0xE9,0xE7,0xE5,0xE4,0xE2,0xE0,0xDD,0xDB<br>,0xD9,0xD7,0xD5,0xD2,0xD0,0xCD,0xCB,0xC8,0xC6,0xC3,0xC1,0xBE,0xBB,0xB8,0xB6,0xB3<br>,0xB0,0xAD,0xAA,0xA7,0xA4,0xA1,0x9E,0x9B,0x98,0x95,0x92,0x8F,0x8B,0x88,0x85,0x82<br>,0x7F,0x7C,0x79,0x76,0x73,0x6F,0x6C,0x69,0x66,0x63,0x60,0x5D,0x5A,0x57,0x54,0x51<br>,0x4E,0x4B,0x48,0x46,0x43,0x40,0x3D,0x3B,0x38,0x36,0x33,0x31,0x2E,0x2C,0x29,0x27<br>,0x25,0x23,0x21,0x1E,0x1C,0x1A,0x19,0x17,0x15,0x13,0x12,0x10,0x0F,0x0D,0x0C,0x0A<br>,0x09,0x08,0x07,0x06,0x05,0x04,0x03,0x03,0x02,0x01,0x01,0x00,0x00,0x00,0x00,0x00<br>,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x02,0x03,0x03,0x04,0x05,0x06,0x07,0x08<br>,0x09,0x0A,0x0C,0x0D,0x0F,0x10,0x12,0x13,0x15,0x17,0x19,0x1A,0x1C,0x1E,0x21,0x23<br>,0x25,0x27,0x29,0x2C,0x2E,0x31,0x33,0x36,0x38,0x3B,0x3D,0x40,0x43,0x46,0x48,0x4B<br>,0x4E,0x51,0x54,0x57,0x5A,0x5D,0x60,0x63,0x66,0x69,0x6C,0x6F,0x73,0x76,0x79,0x7C<br> };</p><p> void delay_us(unsigned char n)&#x2F;&#x2F;usçº§å»¶æ—¶å‡½æ•°<br>    {<br>         unsigned char i;<br>         for(i&#x3D;0;i&lt;n;i++);<br>    }</p><p>&#x2F;******************************************************************<br>    1.sclkçš„ä¸Šå‡æ²¿æ•°æ®è¿›å…¥è¾“å…¥å¯„å­˜å™¨<br>    2.åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSçš„ä¸Šå‡æ²¿æ•°æ®å¼€å§‹DAè½¬åŒ–<br>    3.è¿ç»­è¾“å…¥12ä½æ•°æ®ï¼Œé«˜ä½åœ¨å‰ï¼Œå…¶ä¸­å‰10ä½æœ‰æ•ˆï¼Œåä¸¤ä½è¡¥0<br>    ***************************************************************&#x2F;<br>void output(uint DA_Value)&#x2F;&#x2F;TLC5615é©±åŠ¨å‡½æ•°<br>    {<br>        unsigned char i;<br>        DA_Value&#x3D;DA_Value&lt;&lt;6;&#x2F;&#x2F;å°†DA_Valueå·¦ç§»6ä½ï¼Œå³nnnn nnnn nnnnå˜ä¸ºnnnn nnnn nn00 0000<br>        SCLK&#x3D;0;&#x2F;&#x2F;ä¸ºä½ï¼Œå‡†å¤‡è¾“å…¥æ•°æ®<br>        CS&#x3D;0;&#x2F;&#x2F;ç‰‡é€‰<br>        for(i&#x3D;12;i&gt;0;iâ€“)&#x2F;&#x2F;ä»é«˜ä½å¼€å§‹ï¼Œè¿ç»­å–å‡º12ä½æ•°æ®ï¼Œ<br>            {<br>                if(DA_Value&amp;0x8000)&#x2F;&#x2F;å’Œ1000 0000 0000 0000æ±‚ä¸ï¼Œè·å–æœ€é«˜ä½çš„å€¼ã€‚<br>                DIN&#x3D;1;<br>                else<br>                DIN&#x3D;0;<br>                SCLK&#x3D;1;&#x2F;&#x2F;ä¸Šå‡æ²¿ï¼Œè¿›å…¥è¾“å…¥å¯„å­˜å™¨<br>                SCLK&#x3D;0;&#x2F;&#x2F;å‡†å¤‡ä¸‹ä¸€æ¬¡è¾“å…¥<br>                DA_Value&#x3D;DA_Value&lt;&lt;1;&#x2F;&#x2F;å·¦ç§»1ä½ï¼Œå‡†å¤‡è¾“å…¥ä¸‹ä¸€ä½æ•°æ®<br>            }<br>            CS&#x3D;1;&#x2F;&#x2F;åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSä¸Šå‡æ²¿ï¼Œæ•°æ®å¼€å§‹DAè½¬åŒ–<br>    }<br>void main()<br>{<br>   uint i;<br>   while(1)<br>        {<br>            i&#x3D;0;<br>            for(i&#x3D;0;i&lt;255;i++)&#x2F;&#x2F;è¿ç»­å–å‡º256ç‚¹æ­£å¼¦æ•°æ®<br>            output(sin1[i]);&#x2F;&#x2F;è¾“å‡ºæ­£å¼¦æ³¢<br>        }<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1pk0HpbHSKmH8Wwav-_VrwQ </span><br><span class="line">æå–ç ï¼šbkb4</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1pk0HpbHSKmH8Wwav-_VrwQ  æå–ç ï¼šbkb4</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘uln2003é©±åŠ¨äºŒç›¸å››çº¿åˆ¶æ­¥è¿›ç”µæœºæ­£è½¬</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9Fuln2003%E9%A9%B1%E5%8A%A8%E4%BA%8C%E7%9B%B8%E5%9B%9B%E7%BA%BF%E5%88%B6%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E6%AD%A3%E8%BD%AC/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9Fuln2003%E9%A9%B1%E5%8A%A8%E4%BA%8C%E7%9B%B8%E5%9B%9B%E7%BA%BF%E5%88%B6%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E6%AD%A3%E8%BD%AC/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘uln2003é©±åŠ¨äºŒç›¸å››çº¿åˆ¶æ­¥è¿›ç”µæœºæ­£è½¬"><a href="#ã€Proteusä»¿çœŸã€‘uln2003é©±åŠ¨äºŒç›¸å››çº¿åˆ¶æ­¥è¿›ç”µæœºæ­£è½¬" class="headerlink" title="ã€Proteusä»¿çœŸã€‘uln2003é©±åŠ¨äºŒç›¸å››çº¿åˆ¶æ­¥è¿›ç”µæœºæ­£è½¬"></a>ã€Proteusä»¿çœŸã€‘uln2003é©±åŠ¨äºŒç›¸å››çº¿åˆ¶æ­¥è¿›ç”µæœºæ­£è½¬</h1><h3 id="ã€Proteusä»¿çœŸã€‘äºŒç›¸å››çº¿åˆ¶æ­¥è¿›ç”µæœºæ§åˆ¶æ­£è½¬"><a href="#ã€Proteusä»¿çœŸã€‘äºŒç›¸å››çº¿åˆ¶æ­¥è¿›ç”µæœºæ§åˆ¶æ­£è½¬" class="headerlink" title="ã€Proteusä»¿çœŸã€‘äºŒç›¸å››çº¿åˆ¶æ­¥è¿›ç”µæœºæ§åˆ¶æ­£è½¬"></a>ã€Proteusä»¿çœŸã€‘äºŒç›¸å››çº¿åˆ¶æ­¥è¿›ç”µæœºæ§åˆ¶æ­£è½¬</h3><ul><li>Proteusæ¼”ç¤º</li><li>ä¸¤ç›¸å››çº¿æ­¥è¿›ç”µæœºå†…éƒ¨çº¿åœˆ</li></ul><p><img src="https://img-blog.csdnimg.cn/72248836e34946cbad93566e381fbac4.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/853da9ddeb84411282a11498fe513e0f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ­£è½¬æµ‹è¯•ä»£ç "><a href="#æ­£è½¬æµ‹è¯•ä»£ç " class="headerlink" title="æ­£è½¬æµ‹è¯•ä»£ç "></a>æ­£è½¬æµ‹è¯•ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">//2çº¿å››ç›¸å…«æ‹</span><br><span class="line">#include &lt;STC89C5xRC.H&gt;</span><br><span class="line"></span><br><span class="line">main()&#123;</span><br><span class="line"></span><br><span class="line">while(1)&#123;</span><br><span class="line"></span><br><span class="line">unsigned int i,j,k;</span><br><span class="line"></span><br><span class="line"> for(k=0;k&lt;255;k++)&#123;</span><br><span class="line">//å››çº¿å…«æ‹</span><br><span class="line">for(i=0;i&lt;75;i++)</span><br><span class="line">for(j=0;j&lt;255;j++);</span><br><span class="line"></span><br><span class="line">P2=0x01;//0001</span><br><span class="line"> for(i=0;i&lt;75;i++)</span><br><span class="line">for(j=0;j&lt;255;j++);</span><br><span class="line"></span><br><span class="line">P2=0x03;//0011</span><br><span class="line">   for(i=0;i&lt;75;i++)</span><br><span class="line">for(j=0;j&lt;255;j++);</span><br><span class="line"></span><br><span class="line">P2=0x02;//0010</span><br><span class="line">  for(i=0;i&lt;75;i++)</span><br><span class="line">for(j=0;j&lt;255;j++);</span><br><span class="line"></span><br><span class="line">P2=0x06;//0110</span><br><span class="line"> for(i=0;i&lt;75;i++)</span><br><span class="line">for(j=0;j&lt;255;j++);</span><br><span class="line"></span><br><span class="line">P2=0x04;//0100</span><br><span class="line"> for(i=0;i&lt;75;i++)</span><br><span class="line">for(j=0;j&lt;255;j++);</span><br><span class="line"></span><br><span class="line">P2=0x0c;//1100</span><br><span class="line">   for(i=0;i&lt;75;i++)</span><br><span class="line">for(j=0;j&lt;255;j++);</span><br><span class="line"></span><br><span class="line">P2=0x08;//1000</span><br><span class="line">  for(i=0;i&lt;75;i++)</span><br><span class="line">for(j=0;j&lt;255;j++);</span><br><span class="line"></span><br><span class="line">P2=0x09;//1001</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;&#x2F;2çº¿å››ç›¸å…«æ‹<br>#include &lt;STC89C5xRC.H&gt;</p><p>main(){</p><p>while(1){</p><p>unsigned int i,j,k;</p><p> for(k&#x3D;0;k&lt;255;k++){<br>&#x2F;&#x2F;å››çº¿å…«æ‹<br>for(i&#x3D;0;i&lt;75;i++)<br>for(j&#x3D;0;j&lt;255;j++);</p><p>P2&#x3D;0x01;&#x2F;&#x2F;0001<br> for(i&#x3D;0;i&lt;75;i++)<br>for(j&#x3D;0;j&lt;255;j++);</p><p>P2&#x3D;0x03;&#x2F;&#x2F;0011<br>   for(i&#x3D;0;i&lt;75;i++)<br>for(j&#x3D;0;j&lt;255;j++);</p><p>P2&#x3D;0x02;&#x2F;&#x2F;0010<br>  for(i&#x3D;0;i&lt;75;i++)<br>for(j&#x3D;0;j&lt;255;j++);</p><p>P2&#x3D;0x06;&#x2F;&#x2F;0110<br> for(i&#x3D;0;i&lt;75;i++)<br>for(j&#x3D;0;j&lt;255;j++);</p><p>P2&#x3D;0x04;&#x2F;&#x2F;0100<br> for(i&#x3D;0;i&lt;75;i++)<br>for(j&#x3D;0;j&lt;255;j++);</p><p>P2&#x3D;0x0c;&#x2F;&#x2F;1100<br>   for(i&#x3D;0;i&lt;75;i++)<br>for(j&#x3D;0;j&lt;255;j++);</p><p>P2&#x3D;0x08;&#x2F;&#x2F;1000<br>  for(i&#x3D;0;i&lt;75;i++)<br>for(j&#x3D;0;j&lt;255;j++);</p><p>P2&#x3D;0x09;&#x2F;&#x2F;1001<br> }</p><p>  }<br>}&#96;</p><h4 id="ä»¿çœŸæ–‡ä»¶å’Œä»£ç èµ„æº"><a href="#ä»¿çœŸæ–‡ä»¶å’Œä»£ç èµ„æº" class="headerlink" title="ä»¿çœŸæ–‡ä»¶å’Œä»£ç èµ„æº"></a>ä»¿çœŸæ–‡ä»¶å’Œä»£ç èµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/12mUuafhSGwk7EWwUjQ1pNA </span><br><span class="line">æå–ç ï¼š1j59</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/12mUuafhSGwk7EWwUjQ1pNA  æå–ç ï¼š1j59</code></p><h4 id="æ”¹è¿›å‹"><a href="#æ”¹è¿›å‹" class="headerlink" title="æ”¹è¿›å‹"></a>æ”¹è¿›å‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#define uchar unsigned char</span><br><span class="line"></span><br><span class="line">unsigned char code F_Rotation[]=&#123;0x01,0x03,0x02,0x06,0x04,0x0c,0x08,0x09&#125;;//æ­£è½¬è¡¨æ ¼</span><br><span class="line">unsigned char code B_Rotation[]=&#123;0x09,0x08,0x0c,0x04,0x06,0x02,0x03,0x01&#125;;//åè½¬è¡¨æ ¼</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void DelayMS(uint t)</span><br><span class="line">&#123;</span><br><span class="line"> uchar k;</span><br><span class="line">   while(t--)</span><br><span class="line">   &#123;</span><br><span class="line">    for(k=0; k&lt;125; k++);</span><br><span class="line">&#125;</span><br><span class="line"> &#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line"> unsigned char i;</span><br><span class="line"></span><br><span class="line"> while(1)</span><br><span class="line"> &#123;</span><br><span class="line">  for(i=0;i&lt;8;i++)      //4ç›¸</span><br><span class="line">     &#123;</span><br><span class="line">//     P2=F_Rotation[i];  //è¾“å‡ºå¯¹åº”çš„ç›¸ å¯ä»¥è‡ªè¡Œæ¢æˆæ­£è½¬è¡¨æ ¼</span><br><span class="line">  P2=B_Rotation[i];   //è¾“å‡ºå¯¹åº”çš„ç›¸ å¯ä»¥è‡ªè¡Œæ¢æˆåè½¬è¡¨æ ¼</span><br><span class="line">     DelayMS(80);        //æ”¹å˜è¿™ä¸ªå‚æ•°å¯ä»¥è°ƒæ•´ç”µæœºè½¬é€Ÿ</span><br><span class="line"> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#define uint unsigned int<br>#define uchar unsigned char</p><p>unsigned char code F_Rotation[]&#x3D;{0x01,0x03,0x02,0x06,0x04,0x0c,0x08,0x09};&#x2F;&#x2F;æ­£è½¬è¡¨æ ¼<br>unsigned char code B_Rotation[]&#x3D;{0x09,0x08,0x0c,0x04,0x06,0x02,0x03,0x01};&#x2F;&#x2F;åè½¬è¡¨æ ¼</p><p>void DelayMS(uint t)<br>{<br> uchar k;<br>   while(tâ€“)<br>   {<br>    for(k&#x3D;0; k&lt;125; k++);<br>}<br>     }<br>void main()<br>{</p><p> unsigned char i;</p><p> while(1)<br> {<br>  for(i&#x3D;0;i&lt;8;i++)      &#x2F;&#x2F;4ç›¸<br>     {<br>&#x2F;&#x2F;     P2&#x3D;F_Rotation[i];  &#x2F;&#x2F;è¾“å‡ºå¯¹åº”çš„ç›¸ å¯ä»¥è‡ªè¡Œæ¢æˆæ­£è½¬è¡¨æ ¼<br>              P2&#x3D;B_Rotation[i];   &#x2F;&#x2F;è¾“å‡ºå¯¹åº”çš„ç›¸ å¯ä»¥è‡ªè¡Œæ¢æˆåè½¬è¡¨æ ¼<br>         DelayMS(80);        &#x2F;&#x2F;æ”¹å˜è¿™ä¸ªå‚æ•°å¯ä»¥è°ƒæ•´ç”µæœºè½¬é€Ÿ<br>     }<br>  }<br>}&#96;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘å•ç‰‡æœº+DS18B20+LCD1602æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%8D%95%E7%89%87%E6%9C%BADS18B20LCD1602%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%8D%95%E7%89%87%E6%9C%BADS18B20LCD1602%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘å•ç‰‡æœº-DS18B20-LCD1602æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘å•ç‰‡æœº-DS18B20-LCD1602æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å•ç‰‡æœº+DS18B20+LCD1602æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘å•ç‰‡æœº+DS18B20+LCD1602æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘å•ç‰‡æœº-DS18B20-LCD1602æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘å•ç‰‡æœº-DS18B20-LCD1602æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å•ç‰‡æœº+DS18B20+LCD1602æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘å•ç‰‡æœº+DS18B20+LCD1602æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/17b5d4fa50e642fdb90f0b823520c4fd.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¸¦å°æ•°ç‚¹æ˜¾ç¤ºï¼Œå¤„ç†å°æ•°ç‚¹æ˜¾ç¤ºï¼Œæ¸©åº¦ç¬¦å·é‡‡ç”¨ASCIIç ï¼Œ0xdfæ¥è¡¨ç¤ºâ€å¥å·â€</p><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;absacc.h&gt;</span><br><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;DS18B20.h&gt;</span><br><span class="line">#include &quot;LCD1602.h&quot;æ¶²æ™¶æ˜¾ç¤ºå¤´æ–‡ä»¶</span><br><span class="line">//sbit DQ = P3^4;//å®šä¹‰DQå¼•è„šä¸ºP3.4</span><br><span class="line">unsigned char t[2],*pt;//ç”¨æ¥å­˜æ”¾æ¸©åº¦å€¼,æµ‹æ¸©ç¨‹åºå°±æ˜¯é€šè¿‡è¿™ä¸ªæ•°ç»„ä¸ä¸»å‡½æ•°é€šä¿¡çš„</span><br><span class="line">unsigned char  TempBuffer1[9]=&#123;0x2b,0x31,0x32,0x32,0x2e,0x30,0x30,0xdf,&#x27;C&#x27;&#125;;</span><br><span class="line">//æ˜¾ç¤ºå®æ—¶æ¸©åº¦,0xdfä»£è¡¨â„ƒ</span><br><span class="line">unsigned char  TempBuffer0[16]=&#123;0x48,0x3a,0x2b,0x31,0x32,0x35,0x20,</span><br><span class="line">0x4c,0x3a,0x31,0x32,0x34,0x30,0xdf,&#x27;C&#x27;&#125;;</span><br><span class="line">//æ˜¾ç¤ºæ¸©åº¦ä¸Šä¸‹é™,ä¸Šç”µæ—¶æ˜¾ç¤ºTH:+110 TL:+124C</span><br><span class="line">unsigned char code dotcode[4]=&#123;0,25,50,75&#125;;</span><br><span class="line">/***å› æ˜¾ç¤ºåˆ†è¾¨ç‡ä¸º0.25,ä½†å°æ•°è¿ç®—æ¯”è¾ƒéº»çƒ¦,æ•…é‡‡ç”¨æŸ¥è¡¨çš„æ–¹æ³•*******</span><br><span class="line">å†å°†è¡¨å€¼åˆ†ç¦»å‡ºåä½å’Œä¸ªä½åé€åˆ°ååˆ†ä½å’Œç™¾åˆ†ä½********************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void covert0( unsigned char TH, unsigned char TL)//å°†æ¸©åº¦ä¸Šä¸‹é™è½¬æ¢ä¸ºLCDæ˜¾ç¤ºçš„æ•°æ®</span><br><span class="line">&#123; </span><br><span class="line">   if(TH&gt;0x7F)                    //åˆ¤æ–­æ­£è´Ÿ,å¦‚æœä¸ºè´Ÿæ¸©,å°†å…¶è½¬åŒ–ä¸ºå…¶ç»å¯¹å€¼</span><br><span class="line">   &#123;</span><br><span class="line">    TempBuffer0[2]=0x2d;     //0x2dä¸º&quot;-&quot;çš„ASCIIç </span><br><span class="line">TH=~TH;</span><br><span class="line">TH++;</span><br><span class="line">   &#125;</span><br><span class="line">   else TempBuffer0[2]=0x2b;//0x2Bä¸º&quot;+&quot;çš„ASCIIç </span><br><span class="line"></span><br><span class="line">   if(TL&gt;0x7f)</span><br><span class="line">   &#123;</span><br><span class="line">   TempBuffer0[9]=0x2d;     //0x2dä¸º&quot;-&quot;çš„ASCIIç </span><br><span class="line">   TL=~TL+1;</span><br><span class="line">   &#125;</span><br><span class="line">   else TempBuffer0[9]=0x2b;//0x2Bä¸º&quot;+&quot;çš„ASCIIç </span><br><span class="line"></span><br><span class="line">  TempBuffer0[3]=TH/100+0x30;             //åˆ†ç¦»å‡ºTHçš„ç™¾åä¸ªä½</span><br><span class="line">  if( TempBuffer0[3]==0x30) TempBuffer0[4]=0xfe; //ç™¾ä½æ•°æ¶ˆéš</span><br><span class="line">  TempBuffer0[4]=(TH%100)/10+0x30;//åˆ†ç¦»å‡ºåä½</span><br><span class="line">  TempBuffer0[5]=(TH%100)%10+0x30; //åˆ†ç¦»å‡ºä¸ªä½</span><br><span class="line">  TempBuffer0[10]=TL/100+0x30;             //åˆ†ç¦»å‡ºTLçš„ç™¾åä¸ªä½</span><br><span class="line">  if( TempBuffer0[10]==0x30) TempBuffer0[10]=0xfe; //ç™¾ä½æ•°æ¶ˆéš</span><br><span class="line">  TempBuffer0[11]=(TL%100)/10+0x30;//åˆ†ç¦»å‡ºåä½</span><br><span class="line">  TempBuffer0[12]=(TL%100)%10+0x30; //åˆ†ç¦»å‡ºä¸ªä½</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void covert1(void)//å°†æ¸©åº¦è½¬æ¢ä¸ºLCDæ˜¾ç¤ºçš„æ•°æ®</span><br><span class="line">&#123;</span><br><span class="line">   unsigned char x=0x00,y=0x00;</span><br><span class="line">   t[0]=*pt;</span><br><span class="line">   pt++;</span><br><span class="line">   t[1]=*pt;</span><br><span class="line">   if(t[1]&gt;0x07)                    //åˆ¤æ–­æ­£è´Ÿæ¸©åº¦</span><br><span class="line">   &#123;</span><br><span class="line">    TempBuffer1[0]=0x2d;     //0x2dä¸º&quot;-&quot;çš„ASCIIç </span><br><span class="line">t[1]=~t[1]; /*ä¸‹é¢å‡ å¥æŠŠè´Ÿæ•°çš„è¡¥ç */</span><br><span class="line">t[0]=~t[0];  /* æ¢ç®—æˆç»å¯¹å€¼*********/</span><br><span class="line">x=t[0]+1; /***********************/</span><br><span class="line">t[0]=x; /***********************/</span><br><span class="line">if(x&gt;255)                /**********************/</span><br><span class="line">t[1]++; /*********************/</span><br><span class="line">   &#125;</span><br><span class="line">   else TempBuffer1[0]=0x2b;//0xfeä¸ºå˜&quot;+&quot;çš„ASCIIç </span><br><span class="line">  t[1]&lt;&lt;=4;//å°†é«˜å­—èŠ‚å·¦ç§»4ä½</span><br><span class="line">  t[1]=t[1]&amp;0x70;//å–å‡ºé«˜å­—èŠ‚çš„3ä¸ªæœ‰æ•ˆæ•°å­—ä½</span><br><span class="line">  x=t[0];//å°†t[0]æš‚å­˜åˆ°X,å› ä¸ºå–å°æ•°éƒ¨åˆ†è¿˜è¦ç”¨åˆ°å®ƒ</span><br><span class="line">  x&gt;&gt;=4;//å³ç§»4ä½</span><br><span class="line">  x=x&amp;0x0f;//å’Œå‰é¢ä¸¤å¥å°±æ˜¯å–å‡ºt[0]çš„é«˜å››ä½</span><br><span class="line">  t[1]=t[1]|x;//å°†é«˜ä½å­—èŠ‚çš„æœ‰æ•ˆå€¼çš„æ•´æ•°éƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—èŠ‚</span><br><span class="line">  TempBuffer1[1]=t[1]/100+0x30;             //+0x30 ä¸ºå˜ 0~9 ASCIIç </span><br><span class="line">   if( TempBuffer1[1]==0x30) TempBuffer1[1]=0xfe; //ç™¾ä½æ•°æ¶ˆéš</span><br><span class="line">  TempBuffer1[2]=(t[1]%100)/10+&#x27;0&#x27;;//åˆ†ç¦»å‡ºåä½</span><br><span class="line">  TempBuffer1[3]=(t[1]%100)%10+&#x27;0&#x27;; //åˆ†ç¦»å‡ºä¸ªä½</span><br><span class="line">  t[0]=t[0]&amp;0x0c;//å–æœ‰æ•ˆçš„ä¸¤ä½å°æ•°</span><br><span class="line">  t[0]&gt;&gt;=2;//å·¦ç§»ä¸¤ä½,ä»¥ä¾¿æŸ¥è¡¨</span><br><span class="line">  x=t[0];</span><br><span class="line">  y=dotcode[x];//æŸ¥è¡¨æ¢ç®—æˆå®é™…çš„å°æ•°</span><br><span class="line">  TempBuffer1[5]=y/10+0x30;//åˆ†ç¦»å‡ºååˆ†ä½</span><br><span class="line">  TempBuffer1[6]=y%10+0x30;//åˆ†ç¦»å‡ºç™¾åˆ†ä½</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void delay(unsigned char i)</span><br><span class="line">&#123;</span><br><span class="line">while(i--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">  char TH=110,TL=-20;    //ä¸‹ä¸€æ­¥æ‰©å±•æ—¶å¯èƒ½é€šè¿‡è¿™ä¸¤ä¸ªå˜é‡,è°ƒèŠ‚ä¸Šä¸‹é™</span><br><span class="line">        //æµ‹æ¸©å‡½æ•°è¿”å›è¿™ä¸ªæ•°ç»„çš„å¤´åœ°å€</span><br><span class="line"> while(1)</span><br><span class="line"> &#123;</span><br><span class="line">    pt=ReadTemperature(TH,TL,0x3f); //ä¸Šé™æ¸©åº¦-22,ä¸‹é™-24,åˆ†è¾¨ç‡10ä½,ä¹Ÿå°±æ˜¯0.25C</span><br><span class="line"> //è¯»å–æ¸©åº¦,æ¸©åº¦å€¼å­˜æ”¾åœ¨ä¸€ä¸ªä¸¤ä¸ªå­—èŠ‚çš„æ•°ç»„ä¸­,</span><br><span class="line">delay(100); </span><br><span class="line">covert1();</span><br><span class="line">covert0(TH,TL);</span><br><span class="line">LCD_Initial();//ç¬¬ä¸€ä¸ªå‚æ•°åˆ—å·,ç¬¬äºŒä¸ªä¸ºè¡Œå·,ä¸º0è¡¨ç¤ºç¬¬ä¸€è¡Œ</span><br><span class="line">//ä¸º1è¡¨ç¤ºç¬¬äºŒè¡Œ,ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ˜¾ç¤ºæ•°æ®çš„é¦–åœ°å€</span><br><span class="line">LCD_Print(0,0,TempBuffer0);</span><br><span class="line">LCD_Print(0,1,TempBuffer1); </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include &lt;absacc.h&gt;<br>#include &lt;ctype.h&gt;<br>#include &lt;math.h&gt;<br>#include &lt;stdio.h&gt;<br>#include &lt;string.h&gt;<br>#include &lt;DS18B20.h&gt;<br>#include â€œLCD1602.hâ€æ¶²æ™¶æ˜¾ç¤ºå¤´æ–‡ä»¶<br>&#x2F;&#x2F;sbit DQ &#x3D; P3^4;&#x2F;&#x2F;å®šä¹‰DQå¼•è„šä¸ºP3.4<br>unsigned char t[2],<em>pt;&#x2F;&#x2F;ç”¨æ¥å­˜æ”¾æ¸©åº¦å€¼,æµ‹æ¸©ç¨‹åºå°±æ˜¯é€šè¿‡è¿™ä¸ªæ•°ç»„ä¸ä¸»å‡½æ•°é€šä¿¡çš„<br>unsigned char  TempBuffer1[9]&#x3D;{0x2b,0x31,0x32,0x32,0x2e,0x30,0x30,0xdf,â€™Câ€™};<br>                                &#x2F;&#x2F;æ˜¾ç¤ºå®æ—¶æ¸©åº¦,0xdfä»£è¡¨â„ƒ<br>unsigned char  TempBuffer0[16]&#x3D;{0x48,0x3a,0x2b,0x31,0x32,0x35,0x20,<br>                                0x4c,0x3a,0x31,0x32,0x34,0x30,0xdf,â€™Câ€™};<br>                                &#x2F;&#x2F;æ˜¾ç¤ºæ¸©åº¦ä¸Šä¸‹é™,ä¸Šç”µæ—¶æ˜¾ç¤ºTH:+110 TL:+124C<br>unsigned char code dotcode[4]&#x3D;{0,25,50,75};<br>&#x2F;<em><strong>å› æ˜¾ç¤ºåˆ†è¾¨ç‡ä¸º0.25,ä½†å°æ•°è¿ç®—æ¯”è¾ƒéº»çƒ¦,æ•…é‡‡ç”¨æŸ¥è¡¨çš„æ–¹æ³•</strong></em></em>***<br>å†å°†è¡¨å€¼åˆ†ç¦»å‡ºåä½å’Œä¸ªä½åé€åˆ°ååˆ†ä½å’Œç™¾åˆ†ä½********************&#x2F;</p><p>void covert0( unsigned char TH, unsigned char TL)&#x2F;&#x2F;å°†æ¸©åº¦ä¸Šä¸‹é™è½¬æ¢ä¸ºLCDæ˜¾ç¤ºçš„æ•°æ®<br>{<br>   if(TH&gt;0x7F)                    &#x2F;&#x2F;åˆ¤æ–­æ­£è´Ÿ,å¦‚æœä¸ºè´Ÿæ¸©,å°†å…¶è½¬åŒ–ä¸ºå…¶ç»å¯¹å€¼<br>   {<br>    TempBuffer0[2]&#x3D;0x2d;     &#x2F;&#x2F;0x2dä¸ºâ€-â€œçš„ASCIIç <br>    TH&#x3D;~TH;<br>    TH++;<br>   }<br>   else TempBuffer0[2]&#x3D;0x2b;&#x2F;&#x2F;0x2Bä¸ºâ€+â€çš„ASCIIç </p><p>   if(TL&gt;0x7f)<br>   {<br>   TempBuffer0[9]&#x3D;0x2d;     &#x2F;&#x2F;0x2dä¸ºâ€-â€œçš„ASCIIç <br>   TL&#x3D;~TL+1;<br>   }<br>   else TempBuffer0[9]&#x3D;0x2b;&#x2F;&#x2F;0x2Bä¸ºâ€+â€çš„ASCIIç </p><p>  TempBuffer0[3]&#x3D;TH&#x2F;100+0x30;             &#x2F;&#x2F;åˆ†ç¦»å‡ºTHçš„ç™¾åä¸ªä½<br>  if( TempBuffer0[3]&#x3D;&#x3D;0x30) TempBuffer0[4]&#x3D;0xfe; &#x2F;&#x2F;ç™¾ä½æ•°æ¶ˆéš<br>  TempBuffer0[4]&#x3D;(TH%100)&#x2F;10+0x30;&#x2F;&#x2F;åˆ†ç¦»å‡ºåä½<br>  TempBuffer0[5]&#x3D;(TH%100)%10+0x30; &#x2F;&#x2F;åˆ†ç¦»å‡ºä¸ªä½<br>  TempBuffer0[10]&#x3D;TL&#x2F;100+0x30;             &#x2F;&#x2F;åˆ†ç¦»å‡ºTLçš„ç™¾åä¸ªä½<br>  if( TempBuffer0[10]&#x3D;&#x3D;0x30) TempBuffer0[10]&#x3D;0xfe; &#x2F;&#x2F;ç™¾ä½æ•°æ¶ˆéš<br>  TempBuffer0[11]&#x3D;(TL%100)&#x2F;10+0x30;&#x2F;&#x2F;åˆ†ç¦»å‡ºåä½<br>  TempBuffer0[12]&#x3D;(TL%100)%10+0x30; &#x2F;&#x2F;åˆ†ç¦»å‡ºä¸ªä½<br>}</p><p>void covert1(void)&#x2F;&#x2F;å°†æ¸©åº¦è½¬æ¢ä¸ºLCDæ˜¾ç¤ºçš„æ•°æ®<br>{<br>   unsigned char x&#x3D;0x00,y&#x3D;0x00;<br>   t[0]&#x3D;<em>pt;<br>   pt++;<br>   t[1]&#x3D;<em>pt;<br>   if(t[1]&gt;0x07)                    &#x2F;&#x2F;åˆ¤æ–­æ­£è´Ÿæ¸©åº¦<br>   {<br>    TempBuffer1[0]&#x3D;0x2d;     &#x2F;&#x2F;0x2dä¸ºâ€-â€œçš„ASCIIç <br>    t[1]&#x3D;<del>t[1]; &#x2F;<em>ä¸‹é¢å‡ å¥æŠŠè´Ÿæ•°çš„è¡¥ç </em>&#x2F;<br>    t[0]&#x3D;</del>t[0];  &#x2F;</em> æ¢ç®—æˆç»å¯¹å€¼</em><strong><strong><strong><strong>&#x2F;<br>    x&#x3D;t[0]+1; &#x2F;</strong></strong></strong></strong><em><strong><strong><strong><strong><strong><strong><strong>&#x2F;<br>    t[0]&#x3D;x; &#x2F;</strong></strong></strong></strong></strong></strong></strong></em><strong><strong><strong><strong>&#x2F;<br>    if(x&gt;255)                &#x2F;</strong></strong></strong><strong><strong><strong><strong><strong><strong><strong><strong>&#x2F;<br>    t[1]++; &#x2F;</strong></strong></strong></strong></strong></strong></strong></strong>***</strong>&#x2F;<br>   }<br>   else TempBuffer1[0]&#x3D;0x2b;&#x2F;&#x2F;0xfeä¸ºå˜â€+â€çš„ASCIIç <br>  t[1]&lt;&lt;&#x3D;4;&#x2F;&#x2F;å°†é«˜å­—èŠ‚å·¦ç§»4ä½<br>  t[1]&#x3D;t[1]&0x70;&#x2F;&#x2F;å–å‡ºé«˜å­—èŠ‚çš„3ä¸ªæœ‰æ•ˆæ•°å­—ä½<br>  x&#x3D;t[0];&#x2F;&#x2F;å°†t[0]æš‚å­˜åˆ°X,å› ä¸ºå–å°æ•°éƒ¨åˆ†è¿˜è¦ç”¨åˆ°å®ƒ<br>  x&gt;&gt;&#x3D;4;&#x2F;&#x2F;å³ç§»4ä½<br>  x&#x3D;x&0x0f;&#x2F;&#x2F;å’Œå‰é¢ä¸¤å¥å°±æ˜¯å–å‡ºt[0]çš„é«˜å››ä½<br>  t[1]&#x3D;t[1]|x;&#x2F;&#x2F;å°†é«˜ä½å­—èŠ‚çš„æœ‰æ•ˆå€¼çš„æ•´æ•°éƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—èŠ‚<br>  TempBuffer1[1]&#x3D;t[1]&#x2F;100+0x30;             &#x2F;&#x2F;+0x30 ä¸ºå˜ 0~9 ASCIIç <br>   if( TempBuffer1[1]&#x3D;&#x3D;0x30) TempBuffer1[1]&#x3D;0xfe; &#x2F;&#x2F;ç™¾ä½æ•°æ¶ˆéš<br>  TempBuffer1[2]&#x3D;(t[1]%100)&#x2F;10+â€™0â€™;&#x2F;&#x2F;åˆ†ç¦»å‡ºåä½<br>  TempBuffer1[3]&#x3D;(t[1]%100)%10+â€™0â€™; &#x2F;&#x2F;åˆ†ç¦»å‡ºä¸ªä½<br>  t[0]&#x3D;t[0]&0x0c;&#x2F;&#x2F;å–æœ‰æ•ˆçš„ä¸¤ä½å°æ•°<br>  t[0]&gt;&gt;&#x3D;2;&#x2F;&#x2F;å·¦ç§»ä¸¤ä½,ä»¥ä¾¿æŸ¥è¡¨<br>  x&#x3D;t[0];<br>  y&#x3D;dotcode[x];&#x2F;&#x2F;æŸ¥è¡¨æ¢ç®—æˆå®é™…çš„å°æ•°<br>  TempBuffer1[5]&#x3D;y&#x2F;10+0x30;&#x2F;&#x2F;åˆ†ç¦»å‡ºååˆ†ä½<br>  TempBuffer1[6]&#x3D;y%10+0x30;&#x2F;&#x2F;åˆ†ç¦»å‡ºç™¾åˆ†ä½<br>}</p><p>void delay(unsigned char i)<br>{<br>    while(iâ€“);<br>}</p><p>void main()<br>{<br>  char TH&#x3D;110,TL&#x3D;-20;    &#x2F;&#x2F;ä¸‹ä¸€æ­¥æ‰©å±•æ—¶å¯èƒ½é€šè¿‡è¿™ä¸¤ä¸ªå˜é‡,è°ƒèŠ‚ä¸Šä¸‹é™<br>                                            &#x2F;&#x2F;æµ‹æ¸©å‡½æ•°è¿”å›è¿™ä¸ªæ•°ç»„çš„å¤´åœ°å€<br> while(1)<br> {<br>    pt&#x3D;ReadTemperature(TH,TL,0x3f); &#x2F;&#x2F;ä¸Šé™æ¸©åº¦-22,ä¸‹é™-24,åˆ†è¾¨ç‡10ä½,ä¹Ÿå°±æ˜¯0.25C<br>                                         &#x2F;&#x2F;è¯»å–æ¸©åº¦,æ¸©åº¦å€¼å­˜æ”¾åœ¨ä¸€ä¸ªä¸¤ä¸ªå­—èŠ‚çš„æ•°ç»„ä¸­,<br>    delay(100);<br>    covert1();<br>    covert0(TH,TL);<br>    LCD_Initial();&#x2F;&#x2F;ç¬¬ä¸€ä¸ªå‚æ•°åˆ—å·,ç¬¬äºŒä¸ªä¸ºè¡Œå·,ä¸º0è¡¨ç¤ºç¬¬ä¸€è¡Œ<br>                                            &#x2F;&#x2F;ä¸º1è¡¨ç¤ºç¬¬äºŒè¡Œ,ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ˜¾ç¤ºæ•°æ®çš„é¦–åœ°å€<br>    LCD_Print(0,0,TempBuffer0);<br>    LCD_Print(0,1,TempBuffer1); <br> }<br>}&#96;</p><h4 id="ç¨‹åºæºç ä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç ä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç ä»¿çœŸèµ„æº"></a>ç¨‹åºæºç ä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1I9zxuTAft5Y_Uv27P0CP_Q </span><br><span class="line">æå–ç ï¼šua3g</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1I9zxuTAft5Y_Uv27P0CP_Q  æå–ç ï¼šua3g</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­è§¦å‘å€’è®¡æ—¶5ç§’</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E8%A7%A6%E5%8F%91%E5%80%92%E8%AE%A1%E6%97%B65%E7%A7%92/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E8%A7%A6%E5%8F%91%E5%80%92%E8%AE%A1%E6%97%B65%E7%A7%92/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­è§¦å‘å€’è®¡æ—¶5ç§’"><a href="#ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­è§¦å‘å€’è®¡æ—¶5ç§’" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­è§¦å‘å€’è®¡æ—¶5ç§’"></a>ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­è§¦å‘å€’è®¡æ—¶5ç§’</h1><h3 id="ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­è§¦å‘å€’è®¡æ—¶5ç§’-1"><a href="#ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­è§¦å‘å€’è®¡æ—¶5ç§’-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­è§¦å‘å€’è®¡æ—¶5ç§’"></a>ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­è§¦å‘å€’è®¡æ—¶5ç§’</h3><ul><li>ç›¸å…³ç¯‡ã€Šã€Proteusä»¿çœŸã€‘51å•ç‰‡æœºå¤–éƒ¨ä¸­æ–­æ§åˆ¶è¾“å‡º10ç§’ï¼Œåå…³é—­è¾“å‡ºã€‹</li><li>Proteusä»¿çœŸ</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/124158563">ã€Proteusä»¿çœŸã€‘51å•ç‰‡æœºå¤–éƒ¨ä¸­æ–­æ§åˆ¶è¾“å‡º10ç§’ï¼Œåå…³é—­è¾“å‡º</a></p><p><img src="https://img-blog.csdnimg.cn/23f62f693fe745bba6ef1932046a8ef3.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¨‹åºä»£ç "><a href="#ç¨‹åºä»£ç " class="headerlink" title="ç¨‹åºä»£ç "></a>ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#define uchar unsigned char</span><br><span class="line"></span><br><span class="line">sbit a = P2^1;</span><br><span class="line">sbit b = P2^0;</span><br><span class="line">uchar code table[]=&#123;0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90&#125;; //å…±é˜³ææ®µç 0-9 </span><br><span class="line"></span><br><span class="line">uint num=5;</span><br><span class="line">uchar shi=0;</span><br><span class="line">void delayms(uint xms)//å»¶æ—¶ç¨‹åº</span><br><span class="line">&#123;</span><br><span class="line">uint i,j;</span><br><span class="line">for(i=xms;i&gt;0;i--)</span><br><span class="line">for(j=110;j&gt;0;j--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void display(uint num)</span><br><span class="line">&#123;</span><br><span class="line">a=1;//å…±é˜³ææ•°ç ç®¡é«˜ç”µå¹³æœ‰æ•ˆ</span><br><span class="line">P0=table[num%10];//å¾ªç¯æ˜¾ç¤º0-9</span><br><span class="line">delayms(5);//åˆ·æ–°</span><br><span class="line">P0=0XFF;//æ¶ˆéš</span><br><span class="line">a=0;</span><br><span class="line"></span><br><span class="line">b=1;//å…±é˜³ææ•°ç ç®¡é«˜ç”µå¹³æœ‰æ•ˆ</span><br><span class="line">P0=table[(num/10)%10];//å¾ªç¯æ˜¾ç¤º0-9</span><br><span class="line">delayms(5);//åˆ·æ–°</span><br><span class="line">P0=0XFF;//æ¶ˆéš</span><br><span class="line">b=0;</span><br><span class="line">&#125;</span><br><span class="line">//å¤–éƒ¨ä¸­æ–­æœåŠ¡ç¨‹åº</span><br><span class="line">void exint0() interrupt 0 </span><br><span class="line">&#123;</span><br><span class="line">EX0=0;//å…³é—­å¤–éƒ¨è¯·æ±‚ä¸­æ–­å…è®¸ä½</span><br><span class="line">TL0 = 0xb0;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TH0 = 0x3c;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TR0=1;//å¼€å¯å®šæ—¶å™¨0ä¸­æ–­</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Timer0 interrupt routine */</span><br><span class="line">void tm0_isr() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">//EX0 = 0; //å…³é—­INT0ä¸­æ–­</span><br><span class="line">if(shi==20)</span><br><span class="line">&#123;//20*50MSå®šæ—¶æ—¶é—´ä¸º1ç§’</span><br><span class="line">shi=0;</span><br><span class="line">if(!num--)&#123;</span><br><span class="line">TR0=0;</span><br><span class="line">EX0=1;//å¯ç”¨å¤–éƒ¨è¯·æ±‚ä¸­æ–­å…è®¸ä½</span><br><span class="line">num =5;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">TL0 = 0xb0;//è®¾ç½®å®šæ—¶åˆå§‹å€¼(65536-50000)%256</span><br><span class="line">TH0 = 0x3c;//è®¾ç½®å®šæ—¶åˆå§‹å€¼(65536-50000)/256</span><br><span class="line"></span><br><span class="line"> shi++;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">TMOD = 0x01; /*å®šæ—¶å™¨å·¥ä½œæ–¹å¼1*/</span><br><span class="line">EA=1;//ä¸­æ–­æ€»å¼€å…³</span><br><span class="line">EX0 = 1; //ä½¿èƒ½INT0ä¸­æ–­</span><br><span class="line">ET0=1;//ä½¿èƒ½å®šæ—¶å™¨0ä¸­æ–­</span><br><span class="line">IT0=1;//å¤–éƒ¨ä¸­æ–­é‡‡ç”¨ä¸‹é™æ²¿è§¦å‘</span><br><span class="line">INT0 = 1;//å¤–éƒ¨ä¸­æ–­å¼•è„šç½®1</span><br><span class="line">TR0=0;//å®šæ—¶å™¨0å…è®¸ä¸­æ–­ä½å…³é—­</span><br><span class="line">TF0 = 0;//æ¸…é™¤TF0æ ‡å¿—</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">display(num);//è°ƒç”¨å‡½æ•°</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#define uint unsigned int<br>#define uchar unsigned char</p><p>sbit a &#x3D; P2^1;<br>sbit b &#x3D; P2^0;<br>uchar code table[]&#x3D;{0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90}; &#x2F;&#x2F;å…±é˜³ææ®µç 0-9 </p><p>uint num&#x3D;5;<br>uchar shi&#x3D;0;<br>void delayms(uint xms)&#x2F;&#x2F;å»¶æ—¶ç¨‹åº<br>{<br>    uint i,j;<br>    for(i&#x3D;xms;i&gt;0;iâ€“)<br>        for(j&#x3D;110;j&gt;0;jâ€“);<br>}</p><p>void display(uint num)<br>{<br>        a&#x3D;1;&#x2F;&#x2F;å…±é˜³ææ•°ç ç®¡é«˜ç”µå¹³æœ‰æ•ˆ<br>        P0&#x3D;table[num%10];&#x2F;&#x2F;å¾ªç¯æ˜¾ç¤º0-9<br>        delayms(5);&#x2F;&#x2F;åˆ·æ–°<br>        P0&#x3D;0XFF;&#x2F;&#x2F;æ¶ˆéš<br>        a&#x3D;0;</p><pre><code>    b=1;//å…±é˜³ææ•°ç ç®¡é«˜ç”µå¹³æœ‰æ•ˆ    P0=table[(num/10)%10];//å¾ªç¯æ˜¾ç¤º0-9    delayms(5);//åˆ·æ–°    P0=0XFF;//æ¶ˆéš    b=0;</code></pre><p>}<br>&#x2F;&#x2F;å¤–éƒ¨ä¸­æ–­æœåŠ¡ç¨‹åº<br>void exint0() interrupt 0<br>{<br>        EX0&#x3D;0;&#x2F;&#x2F;å…³é—­å¤–éƒ¨è¯·æ±‚ä¸­æ–­å…è®¸ä½<br>    TL0 &#x3D; 0xb0;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TH0 &#x3D; 0x3c;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>        TR0&#x3D;1;&#x2F;&#x2F;å¼€å¯å®šæ—¶å™¨0ä¸­æ–­</p><p>}</p><p>&#x2F;* Timer0 interrupt routine <em>&#x2F;<br>void tm0_isr() interrupt 1<br>{<br>&#x2F;&#x2F;EX0 &#x3D; 0; &#x2F;&#x2F;å…³é—­INT0ä¸­æ–­<br>    if(shi&#x3D;&#x3D;20)<br>    {&#x2F;&#x2F;20</em>50MSå®šæ—¶æ—¶é—´ä¸º1ç§’<br>        shi&#x3D;0;<br>        if(!numâ€“){<br>        TR0&#x3D;0;<br>        EX0&#x3D;1;&#x2F;&#x2F;å¯ç”¨å¤–éƒ¨è¯·æ±‚ä¸­æ–­å…è®¸ä½<br>        num &#x3D;5;<br>    }<br>    }<br>    TL0 &#x3D; 0xb0;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼(65536-50000)%256<br>    TH0 &#x3D; 0x3c;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼(65536-50000)&#x2F;256</p><p> shi++;</p><p>}</p><p>void main()<br>{<br>    TMOD &#x3D; 0x01; &#x2F;<em>å®šæ—¶å™¨å·¥ä½œæ–¹å¼1</em>&#x2F;<br>    EA&#x3D;1;&#x2F;&#x2F;ä¸­æ–­æ€»å¼€å…³<br>    EX0 &#x3D; 1; &#x2F;&#x2F;ä½¿èƒ½INT0ä¸­æ–­<br>    ET0&#x3D;1;&#x2F;&#x2F;ä½¿èƒ½å®šæ—¶å™¨0ä¸­æ–­<br>    IT0&#x3D;1;&#x2F;&#x2F;å¤–éƒ¨ä¸­æ–­é‡‡ç”¨ä¸‹é™æ²¿è§¦å‘<br>    INT0 &#x3D; 1;&#x2F;&#x2F;å¤–éƒ¨ä¸­æ–­å¼•è„šç½®1<br>    TR0&#x3D;0;&#x2F;&#x2F;å®šæ—¶å™¨0å…è®¸ä¸­æ–­ä½å…³é—­<br>    TF0 &#x3D; 0;&#x2F;&#x2F;æ¸…é™¤TF0æ ‡å¿—<br>    while(1)<br>    {<br>        display(num);&#x2F;&#x2F;è°ƒç”¨å‡½æ•°<br>    }<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/19rcxhfV_dVtq0frkXR-7kQ </span><br><span class="line">æå–ç ï¼šxkwh</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/19rcxhfV_dVtq0frkXR-7kQ  æå–ç ï¼šxkwh</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­é€šè¿‡åŒç»§ç”µå™¨æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E9%80%9A%E8%BF%87%E5%8F%8C%E7%BB%A7%E7%94%B5%E5%99%A8%E6%8E%A7%E5%88%B6%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%AD%A3%E5%8F%8D%E8%BD%AC/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E9%80%9A%E8%BF%87%E5%8F%8C%E7%BB%A7%E7%94%B5%E5%99%A8%E6%8E%A7%E5%88%B6%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%AD%A3%E5%8F%8D%E8%BD%AC/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­é€šè¿‡åŒç»§ç”µå™¨æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬"><a href="#ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­é€šè¿‡åŒç»§ç”µå™¨æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­é€šè¿‡åŒç»§ç”µå™¨æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬"></a>ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­é€šè¿‡åŒç»§ç”µå™¨æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬</h1><h3 id="ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­é€šè¿‡åŒç»§ç”µå™¨æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬-1"><a href="#ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­é€šè¿‡åŒç»§ç”µå™¨æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­é€šè¿‡åŒç»§ç”µå™¨æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬"></a>ã€Proteusä»¿çœŸã€‘å¤–éƒ¨ä¸­æ–­é€šè¿‡åŒç»§ç”µå™¨æ§åˆ¶ç›´æµç”µæœºæ­£åè½¬</h3><ul><li>Proteusä»¿çœŸ</li><li>è¯´æ˜</li></ul><p><img src="https://img-blog.csdnimg.cn/e9dd5a547c5f42be9533f38c0fb756dc.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä½¿ç”¨äº†å¤–éƒ¨ä¸­æ–­0å’Œ1ï¼Œåˆ†åˆ«æ§åˆ¶ç”µæœºæ­£åè½¬ï¼Œå¯åŠ¨å’Œåœæ­¢éƒ½åœ¨ä¸¤ä¸ªæŒ‰é”®ä¸Šï¼Œç¬¬ä¸€æ¬¡æ˜¯å¯åŠ¨ï¼Œåœ¨æŒ‰åŒä¸€ä¸ªæŒ‰é”®å°±æ˜¯æ˜¯åœæ­¢ï¼Œç¨‹åºç°åœ¨ä¸è¶³çš„åœ°æ–¹æ˜¯å¦‚æœå¯åŠ¨æ—¶æ­£è½¬æˆ–åè½¬ï¼Œè®©åå»æŒ‰å¦å¤–ä¸€ä¸ªæ§åˆ¶æŒ‰é’®å°±ä¸èµ·ä½œç”¨ï¼Œç„¶åå»æŒ‰å‰ä¸€æ¬¡çš„æŒ‰é”®æ—¶ï¼Œç»§ç”µå™¨ä¼šå‡ºç°åŒæ—¶è·³åŠ¨çš„æƒ…å†µã€‚å¦‚æœä½¿ç”¨å“ªä¸ªå¯åŠ¨å“ªä¸ªå°±æœ‰åœæ­¢çš„æƒé™å°±ä¸ä¼šå‡ºç°ä¸¤ä¸ªç»§ç”µå™¨åŒæ—¶è·³åŠ¨çš„æƒ…å†µã€‚</p><h4 id="ç¨‹åºæºç "><a href="#ç¨‹åºæºç " class="headerlink" title="ç¨‹åºæºç "></a>ç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;STC89C5xRC.H&gt;</span><br><span class="line"></span><br><span class="line">sbit LED1 = P1^0 ;</span><br><span class="line">sbit LED2 = P1^1 ;</span><br><span class="line"></span><br><span class="line">static void Init0(void)    </span><br><span class="line">&#123;</span><br><span class="line">  IT0 = 1;      //è®¾ç½®INT0çš„ä¸­æ–­ç±»å‹ (1:ä¸‹é™æ²¿ 0:ä½ç”µå¹³)</span><br><span class="line">  EX0 = 1;      //INT0ä¸­æ–­ä½¿èƒ½</span><br><span class="line">&#125;</span><br><span class="line">static void Init1(void)    </span><br><span class="line">&#123;</span><br><span class="line">  IT1 = 1;      //è®¾ç½®INT0çš„ä¸­æ–­ç±»å‹ (1:ä¸‹é™æ²¿ 0:ä½ç”µå¹³)</span><br><span class="line">  EX1 = 1;      //INT0ä¸­æ–­ä½¿èƒ½</span><br><span class="line">&#125;</span><br><span class="line">void main()&#123;</span><br><span class="line"></span><br><span class="line">Init0();</span><br><span class="line">Init1();</span><br><span class="line">EA = 1;             //å¼€å¯æ€»ä¸­æ–­</span><br><span class="line">P1 =0x00;</span><br><span class="line">while(1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void EXIT0_isr(void) interrupt 0 using 0</span><br><span class="line">&#123;  </span><br><span class="line">   static volatile unsigned char flag0 = 0;</span><br><span class="line">  if(flag0 == 0)  //äº®ç¯</span><br><span class="line">  &#123;</span><br><span class="line">LED1 = 1 ;</span><br><span class="line">    flag0 = 1;</span><br><span class="line">EX1 = 0;      //å¦‚æœLED2å…³é—­äº†ï¼Œå°±å…³é—­INT1ä¸­æ–­</span><br><span class="line">  &#125;</span><br><span class="line">  else         //ç­ç¯</span><br><span class="line">  &#123;</span><br><span class="line">    LED1 = 0;</span><br><span class="line">    flag0 = !flag0;</span><br><span class="line">EX1 = 1;      //å¦‚æœLED2å…³é—­äº†ï¼Œå°±å¼€å¯INT1ä¸­æ–­</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">void EXIT1_isr(void) interrupt 2 using 0</span><br><span class="line">&#123;  </span><br><span class="line">   static volatile unsigned char flag1 = 1;</span><br><span class="line">  if(flag1 == 0)  //äº®ç¯</span><br><span class="line">  &#123;</span><br><span class="line">LED2 = 1;</span><br><span class="line">    flag1 = 1;</span><br><span class="line">EX0 = 0;      //å¦‚æœLED2å¼€å¯äº†ï¼Œå°±å…³é—­INT0ä¸­æ–­</span><br><span class="line">  &#125;</span><br><span class="line">  else         //ç­ç¯</span><br><span class="line">  &#123;</span><br><span class="line">    LED2 = 0;</span><br><span class="line">    flag1 = !flag1;</span><br><span class="line">EX0 = 1;      //å¦‚æœLED2å…³é—­äº†ï¼Œå°±å¼€å¯INT0ä¸­æ–­</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;STC89C5xRC.H&gt;</p><p>sbit LED1 &#x3D; P1^0 ;<br>sbit LED2 &#x3D; P1^1 ;</p><p>static void Init0(void)<br>{<br>  IT0 &#x3D; 1;      &#x2F;&#x2F;è®¾ç½®INT0çš„ä¸­æ–­ç±»å‹ (1:ä¸‹é™æ²¿ 0:ä½ç”µå¹³)<br>  EX0 &#x3D; 1;      &#x2F;&#x2F;INT0ä¸­æ–­ä½¿èƒ½<br>}<br>static void Init1(void)<br>{<br>  IT1 &#x3D; 1;      &#x2F;&#x2F;è®¾ç½®INT0çš„ä¸­æ–­ç±»å‹ (1:ä¸‹é™æ²¿ 0:ä½ç”µå¹³)<br>  EX1 &#x3D; 1;      &#x2F;&#x2F;INT0ä¸­æ–­ä½¿èƒ½<br>}<br>void main(){</p><pre><code>Init0();Init1();EA = 1;             //å¼€å¯æ€»ä¸­æ–­P1 =0x00;while(1);</code></pre><p>}</p><p>void EXIT0_isr(void) interrupt 0 using 0<br>{<br>   static volatile unsigned char flag0 &#x3D; 0;<br>  if(flag0 &#x3D;&#x3D; 0)  &#x2F;&#x2F;äº®ç¯<br>  {<br>        LED1 &#x3D; 1 ;<br>    flag0 &#x3D; 1;<br>        EX1 &#x3D; 0;      &#x2F;&#x2F;å¦‚æœLED2å…³é—­äº†ï¼Œå°±å…³é—­INT1ä¸­æ–­<br>  }<br>  else         &#x2F;&#x2F;ç­ç¯<br>  {<br>    LED1 &#x3D; 0;<br>    flag0 &#x3D; !flag0;<br>        EX1 &#x3D; 1;      &#x2F;&#x2F;å¦‚æœLED2å…³é—­äº†ï¼Œå°±å¼€å¯INT1ä¸­æ–­<br>  }<br>}<br>void EXIT1_isr(void) interrupt 2 using 0<br>{<br>   static volatile unsigned char flag1 &#x3D; 1;<br>  if(flag1 &#x3D;&#x3D; 0)  &#x2F;&#x2F;äº®ç¯<br>  {<br>        LED2 &#x3D; 1;<br>    flag1 &#x3D; 1;<br>        EX0 &#x3D; 0;      &#x2F;&#x2F;å¦‚æœLED2å¼€å¯äº†ï¼Œå°±å…³é—­INT0ä¸­æ–­<br>  }<br>  else         &#x2F;&#x2F;ç­ç¯<br>  {<br>    LED2 &#x3D; 0;<br>    flag1 &#x3D; !flag1;<br>        EX0 &#x3D; 1;      &#x2F;&#x2F;å¦‚æœLED2å…³é—­äº†ï¼Œå°±å¼€å¯INT0ä¸­æ–­<br>  }<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1sgacmzP6YSxGmxeTDqWv9A </span><br><span class="line">æå–ç ï¼šedxt</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1sgacmzP6YSxGmxeTDqWv9A  æå–ç ï¼šedxt</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘æŒ‰é”®è®¾ç½®+æ•°ç ç®¡æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%8C%89%E9%94%AE%E8%AE%BE%E7%BD%AE%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%8C%89%E9%94%AE%E8%AE%BE%E7%BD%AE%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘æŒ‰é”®è®¾ç½®-æ•°ç ç®¡æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘æŒ‰é”®è®¾ç½®-æ•°ç ç®¡æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æŒ‰é”®è®¾ç½®+æ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘æŒ‰é”®è®¾ç½®+æ•°ç ç®¡æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘æŒ‰é”®è®¾ç½®-æ•°ç ç®¡æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘æŒ‰é”®è®¾ç½®-æ•°ç ç®¡æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æŒ‰é”®è®¾ç½®+æ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘æŒ‰é”®è®¾ç½®+æ•°ç ç®¡æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/96a134bb919d4a4da8d891c80cb0fed0.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é‡‡ç”¨çš„æ˜¯7ä½å…±é˜´æ•°ç ç®¡æ®µç ä½œä¸ºæ˜¾ç¤ºï¼Œå¯ä»¥ç”¨äºç§»æ¤åˆ°æ‰€éœ€çš„å…¶ä»–é¡¹ç›®ä¸Šï¼Œä½œä¸ºæ¨¡æ¿æˆ–å‚è€ƒç¨‹åºæ¥ä½¿ç”¨ï¼Œå…¶ä¸­åŒ…å«äº†æŒ‰é”®æ‰«æåŠŸèƒ½çš„å®ç°ï¼Œæ˜¾ç¤ºå’Œè®¾ç½®åŠŸèƒ½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">å®éªŒè¯´æ˜ï¼š</span><br><span class="line">å®éªŒæ¥çº¿ï¼š</span><br><span class="line">1ï¼ŒåŠ¨æ€æ•°ç ç®¡æ¨¡å—--&gt;å•ç‰‡æœºç®¡è„š</span><br><span class="line">2ï¼Œç‹¬ç«‹æŒ‰é”®æ¨¡å—--&gt;å•ç‰‡æœºç®¡è„š </span><br><span class="line">K1--&gt;P10</span><br><span class="line">K2--&gt;P11</span><br><span class="line">K3--&gt;P12</span><br><span class="line">K4--&gt;P13</span><br><span class="line"></span><br><span class="line">å®éªŒç°è±¡ï¼š</span><br><span class="line">æŒ‰K4é”®è¿›å…¥æ•°å­—è®¾ç½®ï¼ŒæŒ‰K1å’ŒK3é”®å¯¹é—ªçƒçš„æ•°å­—è¿›è¡ŒåŠ å’Œå‡ï¼ŒæŒ‰K2é”®è¿›è¡Œæ•°ç ç®¡ç§»ä½è®¾ç½®</span><br><span class="line">å†æ¬¡æŒ‰ä¸‹K4é”®é€€å‡ºè®¾ç½®ã€‚</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#include &quot;reg52.h&quot; //æ­¤æ–‡ä»¶ä¸­å®šä¹‰äº†å•ç‰‡æœºçš„ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨</span><br><span class="line"></span><br><span class="line">typedef unsigned int u16;  //å¯¹æ•°æ®ç±»å‹è¿›è¡Œå£°æ˜å®šä¹‰</span><br><span class="line">typedef unsigned char u8;</span><br><span class="line"></span><br><span class="line">sbit LSA=P2^2;</span><br><span class="line">sbit LSB=P2^3;</span><br><span class="line">sbit LSC=P2^4;</span><br><span class="line"></span><br><span class="line">sbit k1=P1^0;</span><br><span class="line">sbit k2=P1^1;</span><br><span class="line">sbit k3=P1^2;</span><br><span class="line">sbit k4=P1^3; //å®šä¹‰æŒ‰é”®ç«¯å£</span><br><span class="line"></span><br><span class="line">#define KEY1 1</span><br><span class="line">#define KEY2 2</span><br><span class="line">#define KEY3 3</span><br><span class="line">#define KEY4 4</span><br><span class="line"></span><br><span class="line">u8 code smgduan[17]=&#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,</span><br><span class="line">0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71&#125;;//å…±é˜´æ•°ç ç®¡æ®µç æ˜¾ç¤º0~Fçš„å€¼</span><br><span class="line"></span><br><span class="line">u8 DisplayData[8];</span><br><span class="line">char datnum1=0,datnum2=0,datnum3=0,datnum4=0;</span><br><span class="line">u8 setflag=0;</span><br><span class="line">u8 wei_change=0;</span><br><span class="line"></span><br><span class="line">/*******************************************************************************</span><br><span class="line">* å‡½ æ•° å         : delay</span><br><span class="line">* å‡½æ•°åŠŸèƒ½   : å»¶æ—¶å‡½æ•°ï¼Œi=1æ—¶ï¼Œå¤§çº¦å»¶æ—¶10us</span><br><span class="line">*******************************************************************************/</span><br><span class="line">void delay(u16 i)</span><br><span class="line">&#123;</span><br><span class="line">while(i--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*******************************************************************************</span><br><span class="line">* å‡½ æ•° å         : Timer0Init</span><br><span class="line">* å‡½æ•°åŠŸèƒ½   : å®šæ—¶å™¨0åˆå§‹åŒ–</span><br><span class="line">* è¾“    å…¥         : æ— </span><br><span class="line">* è¾“    å‡º         : æ— </span><br><span class="line">*******************************************************************************/</span><br><span class="line">void Timer0Init()</span><br><span class="line">&#123;</span><br><span class="line">TMOD|=0X01;//é€‰æ‹©ä¸ºå®šæ—¶å™¨0æ¨¡å¼ï¼Œå·¥ä½œæ–¹å¼1ï¼Œä»…ç”¨TR0æ‰“å¼€å¯åŠ¨ã€‚</span><br><span class="line"></span><br><span class="line">TH0=0Xd8;//ç»™å®šæ—¶å™¨èµ‹åˆå€¼ï¼Œå®šæ—¶10ms</span><br><span class="line">TL0=0Xf0;</span><br><span class="line">ET0=1;//æ‰“å¼€å®šæ—¶å™¨0ä¸­æ–­å…è®¸</span><br><span class="line">EA=1;//æ‰“å¼€æ€»ä¸­æ–­</span><br><span class="line">//TR0=1;//æ‰“å¼€å®šæ—¶å™¨</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*******************************************************************************</span><br><span class="line">* å‡½ æ•° å         : DigDisplay</span><br><span class="line">* å‡½æ•°åŠŸèƒ½   : æ•°ç ç®¡åŠ¨æ€æ‰«æå‡½æ•°ï¼Œå¾ªç¯æ‰«æ8ä¸ªæ•°ç ç®¡æ˜¾ç¤º</span><br><span class="line">*******************************************************************************/</span><br><span class="line">void DigDisplay()</span><br><span class="line">&#123;</span><br><span class="line">u8 i;</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">&#123;</span><br><span class="line">switch(i) //ä½é€‰ï¼Œé€‰æ‹©ç‚¹äº®çš„æ•°ç ç®¡ï¼Œ</span><br><span class="line">&#123;</span><br><span class="line">case(0):</span><br><span class="line">LSA=1;LSB=1;LSC=1; break;//æ˜¾ç¤ºç¬¬7ä½</span><br><span class="line">case(1):</span><br><span class="line">LSA=0;LSB=1;LSC=1; break;//æ˜¾ç¤ºç¬¬6ä½</span><br><span class="line">case(2):</span><br><span class="line">LSA=1;LSB=0;LSC=1; break;//æ˜¾ç¤ºç¬¬5ä½</span><br><span class="line">case(3):</span><br><span class="line">LSA=0;LSB=0;LSC=1; break;//æ˜¾ç¤ºç¬¬4ä½</span><br><span class="line">case(4):</span><br><span class="line">LSA=1;LSB=1;LSC=0; break;//æ˜¾ç¤ºç¬¬3ä½ </span><br><span class="line">case(5):</span><br><span class="line">LSA=0;LSB=1;LSC=0; break;//æ˜¾ç¤ºç¬¬2ä½ </span><br><span class="line">case(6):</span><br><span class="line">LSA=1;LSB=0;LSC=0; break;//æ˜¾ç¤ºç¬¬1ä½ </span><br><span class="line">case(7):</span><br><span class="line">LSA=0;LSB=0;LSC=0; break;//æ˜¾ç¤ºç¬¬0ä½</span><br><span class="line">&#125;</span><br><span class="line">P0=DisplayData[i];//å‘é€æ®µç </span><br><span class="line">delay(100); //é—´éš”ä¸€æ®µæ—¶é—´æ‰«æ</span><br><span class="line">P0=0x00;//æ¶ˆéš</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//mode=0 å•æ¬¡   1ï¼šè¿ç»­</span><br><span class="line">u8 KeyScan(u8 mode)</span><br><span class="line">&#123;</span><br><span class="line">static u8 keyen=1;</span><br><span class="line">if(mode==1)</span><br><span class="line">&#123;</span><br><span class="line">keyen=1;</span><br><span class="line">&#125;</span><br><span class="line">if(keyen==1&amp;&amp;(k1==0||k2==0||k3==0||k4==0))</span><br><span class="line">&#123;</span><br><span class="line">delay(1000);  //æ¶ˆæŠ–å¤„ç†</span><br><span class="line">keyen=0;</span><br><span class="line">if(k1==0)return KEY1;</span><br><span class="line">else if(k2==0)return KEY2;</span><br><span class="line">else if(k3==0)return KEY3;</span><br><span class="line">else if(k4==0)return KEY4;</span><br><span class="line">&#125;</span><br><span class="line">else if(k1==1&amp;&amp;k2==1&amp;&amp;k3==1&amp;&amp;k4==1)</span><br><span class="line">&#123;</span><br><span class="line">keyen=1;</span><br><span class="line">&#125;</span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void datapros()</span><br><span class="line">&#123;</span><br><span class="line">u8 key;</span><br><span class="line">key=KeyScan(0);</span><br><span class="line"></span><br><span class="line">if(key==KEY4)   //è®¾ç½®</span><br><span class="line">&#123;</span><br><span class="line">setflag++;</span><br><span class="line">TR0=1;   //å¼€å¯å®šæ—¶å™¨</span><br><span class="line">if(setflag==2)</span><br><span class="line">&#123;</span><br><span class="line">TR0=0;//å…³é—­å®šæ—¶å™¨</span><br><span class="line">setflag=0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(setflag==0) //é»˜è®¤/é€€å‡ºè®¾ç½®æ˜¾ç¤º</span><br><span class="line">&#123;</span><br><span class="line">DisplayData[0]=smgduan[datnum4];</span><br><span class="line">DisplayData[1]=smgduan[datnum3];</span><br><span class="line">DisplayData[2]=smgduan[datnum2];</span><br><span class="line">DisplayData[3]=smgduan[datnum1];</span><br><span class="line">&#125;</span><br><span class="line">else  //è¿›å…¥è®¾ç½®  æ•°ç ç®¡é€‰ä¸­é—ªçƒ</span><br><span class="line">&#123;</span><br><span class="line">if(key==KEY2)    //æ•°æ®ä½æ•°ç§»åŠ¨å˜åŒ–</span><br><span class="line">&#123;</span><br><span class="line">wei_change++;</span><br><span class="line">if(wei_change&gt;3)wei_change=0;</span><br><span class="line">DisplayData[0]=smgduan[datnum4];</span><br><span class="line">DisplayData[1]=smgduan[datnum3];</span><br><span class="line">DisplayData[2]=smgduan[datnum2];</span><br><span class="line">DisplayData[3]=smgduan[datnum1];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">else if(key==KEY1) //æ•°æ®åŠ </span><br><span class="line">&#123;</span><br><span class="line">switch(wei_change)</span><br><span class="line">&#123;</span><br><span class="line">case 0:  datnum1++;</span><br><span class="line">if(datnum1&gt;9)datnum1=0;</span><br><span class="line">break;</span><br><span class="line">case 1:  datnum2++;</span><br><span class="line">if(datnum2&gt;9)datnum2=0;</span><br><span class="line">break;</span><br><span class="line">case 2:  datnum3++;</span><br><span class="line">if(datnum3&gt;9)datnum3=0;</span><br><span class="line">break;</span><br><span class="line">case 3:  datnum4++;</span><br><span class="line">if(datnum4&gt;9)datnum4=0;</span><br><span class="line">break;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else if(key==KEY3) //æ•°æ®å‡</span><br><span class="line">&#123;</span><br><span class="line">switch(wei_change)</span><br><span class="line">&#123;</span><br><span class="line">case 0:  datnum1--;</span><br><span class="line">if(datnum1&lt;=0)datnum1=9;</span><br><span class="line">break;</span><br><span class="line">case 1:  datnum2--;</span><br><span class="line">if(datnum2&lt;=0)datnum2=9;</span><br><span class="line">break;</span><br><span class="line">case 2:  datnum3--;</span><br><span class="line">if(datnum3&lt;=0)datnum3=9;</span><br><span class="line">break;</span><br><span class="line">case 3:  datnum4--;</span><br><span class="line">if(datnum4&lt;=0)datnum4=9;</span><br><span class="line">break;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/*******************************************************************************</span><br><span class="line">* å‡½ æ•° å       : main</span><br><span class="line">* å‡½æ•°åŠŸèƒ½ : ä¸»å‡½æ•°</span><br><span class="line">* è¾“    å…¥       : æ— </span><br><span class="line">* è¾“    å‡º     : æ— </span><br><span class="line">*******************************************************************************/</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">Timer0Init();</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">datapros();</span><br><span class="line">DigDisplay();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*******************************************************************************</span><br><span class="line">* å‡½ æ•° å         : void Timer0() interrupt 1</span><br><span class="line">* å‡½æ•°åŠŸèƒ½   : å®šæ—¶å™¨0ä¸­æ–­å‡½æ•°</span><br><span class="line">* è¾“    å…¥         : æ— </span><br><span class="line">* è¾“    å‡º         : æ— </span><br><span class="line">*******************************************************************************/</span><br><span class="line">void Timer0() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">static u8 i;</span><br><span class="line">TH0=0Xd8;//ç»™å®šæ—¶å™¨èµ‹åˆå€¼ï¼Œå®šæ—¶10ms</span><br><span class="line">TL0=0Xf0;</span><br><span class="line">i++;</span><br><span class="line">if(i==50)  //500ms</span><br><span class="line">&#123;</span><br><span class="line">switch(wei_change)</span><br><span class="line">&#123;</span><br><span class="line">case 0: DisplayData[3]=0x00;break;</span><br><span class="line">case 1: DisplayData[2]=0x00;break;</span><br><span class="line">case 2: DisplayData[1]=0x00;break;</span><br><span class="line">case 3: DisplayData[0]=0x00;break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if(i==100)   //1s</span><br><span class="line">&#123;</span><br><span class="line">i=0;</span><br><span class="line">switch(wei_change)</span><br><span class="line">&#123;</span><br><span class="line">case 0: DisplayData[3]=smgduan[datnum1];break;</span><br><span class="line">case 1: DisplayData[2]=smgduan[datnum2];break;</span><br><span class="line">case 2: DisplayData[1]=smgduan[datnum3];break;</span><br><span class="line">case 3: DisplayData[0]=smgduan[datnum4];break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;*<br>å®éªŒè¯´æ˜ï¼š<br>å®éªŒæ¥çº¿ï¼š<br>    1ï¼ŒåŠ¨æ€æ•°ç ç®¡æ¨¡å—â€“&gt;å•ç‰‡æœºç®¡è„š<br>    2ï¼Œç‹¬ç«‹æŒ‰é”®æ¨¡å—â€“&gt;å•ç‰‡æœºç®¡è„š<br>    K1â€“&gt;P10<br>    K2â€“&gt;P11<br>    K3â€“&gt;P12<br>    K4â€“&gt;P13</p><p>å®éªŒç°è±¡ï¼š<br>    æŒ‰K4é”®è¿›å…¥æ•°å­—è®¾ç½®ï¼ŒæŒ‰K1å’ŒK3é”®å¯¹é—ªçƒçš„æ•°å­—è¿›è¡ŒåŠ å’Œå‡ï¼ŒæŒ‰K2é”®è¿›è¡Œæ•°ç ç®¡ç§»ä½è®¾ç½®<br>    å†æ¬¡æŒ‰ä¸‹K4é”®é€€å‡ºè®¾ç½®ã€‚<br>*&#x2F;</p><p>#include â€œreg52.hâ€ &#x2F;&#x2F;æ­¤æ–‡ä»¶ä¸­å®šä¹‰äº†å•ç‰‡æœºçš„ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨</p><p>typedef unsigned int u16;  &#x2F;&#x2F;å¯¹æ•°æ®ç±»å‹è¿›è¡Œå£°æ˜å®šä¹‰<br>typedef unsigned char u8;</p><p>sbit LSA&#x3D;P2^2;<br>sbit LSB&#x3D;P2^3;<br>sbit LSC&#x3D;P2^4;</p><p>sbit k1&#x3D;P1^0;<br>sbit k2&#x3D;P1^1;<br>sbit k3&#x3D;P1^2;<br>sbit k4&#x3D;P1^3; &#x2F;&#x2F;å®šä¹‰æŒ‰é”®ç«¯å£</p><p>#define KEY1 1<br>#define KEY2 2<br>#define KEY3 3<br>#define KEY4 4</p><p>u8 code smgduan[17]&#x3D;{0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,<br>                    0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};&#x2F;&#x2F;å…±é˜´æ•°ç ç®¡æ®µç æ˜¾ç¤º0~Fçš„å€¼</p><p>u8 DisplayData[8];<br>char datnum1&#x3D;0,datnum2&#x3D;0,datnum3&#x3D;0,datnum4&#x3D;0;<br>u8 setflag&#x3D;0;<br>u8 wei_change&#x3D;0;</p><p>&#x2F;*******************************************************************************</p><ul><li>å‡½ æ•° å         : delay</li><li>å‡½æ•°åŠŸèƒ½   : å»¶æ—¶å‡½æ•°ï¼Œi&#x3D;1æ—¶ï¼Œå¤§çº¦å»¶æ—¶10us<br>*******************************************************************************&#x2F;<br>void delay(u16 i)<br>{<br>  while(iâ€“);<br>}</li></ul><p>&#x2F;*******************************************************************************</p><ul><li><p>å‡½ æ•° å         : Timer0Init</p></li><li><p>å‡½æ•°åŠŸèƒ½   : å®šæ—¶å™¨0åˆå§‹åŒ–</p></li><li><p>è¾“    å…¥         : æ— </p></li><li><p>è¾“    å‡º         : æ— <br>*******************************************************************************&#x2F;<br>void Timer0Init()<br>{<br>  TMOD|&#x3D;0X01;&#x2F;&#x2F;é€‰æ‹©ä¸ºå®šæ—¶å™¨0æ¨¡å¼ï¼Œå·¥ä½œæ–¹å¼1ï¼Œä»…ç”¨TR0æ‰“å¼€å¯åŠ¨ã€‚</p><p>  TH0&#x3D;0Xd8;&#x2F;&#x2F;ç»™å®šæ—¶å™¨èµ‹åˆå€¼ï¼Œå®šæ—¶10ms<br>  TL0&#x3D;0Xf0;<br>  ET0&#x3D;1;&#x2F;&#x2F;æ‰“å¼€å®šæ—¶å™¨0ä¸­æ–­å…è®¸<br>  EA&#x3D;1;&#x2F;&#x2F;æ‰“å¼€æ€»ä¸­æ–­<br>  &#x2F;&#x2F;TR0&#x3D;1;&#x2F;&#x2F;æ‰“å¼€å®šæ—¶å™¨</p></li></ul><p><br>}</p><p>&#x2F;*******************************************************************************</p><ul><li>å‡½ æ•° å         : DigDisplay</li><li>å‡½æ•°åŠŸèƒ½   : æ•°ç ç®¡åŠ¨æ€æ‰«æå‡½æ•°ï¼Œå¾ªç¯æ‰«æ8ä¸ªæ•°ç ç®¡æ˜¾ç¤º<br>*******************************************************************************&#x2F;<br>void DigDisplay()<br>{<br>  u8 i;<br>  for(i&#x3D;0;i&lt;8;i++)<br>  {<br>  switch(i) &#x2F;&#x2F;ä½é€‰ï¼Œé€‰æ‹©ç‚¹äº®çš„æ•°ç ç®¡ï¼Œ<br>  {<br>      case(0):<br>          LSA&#x3D;1;LSB&#x3D;1;LSC&#x3D;1; break;&#x2F;&#x2F;æ˜¾ç¤ºç¬¬7ä½<br>      case(1):<br>          LSA&#x3D;0;LSB&#x3D;1;LSC&#x3D;1; break;&#x2F;&#x2F;æ˜¾ç¤ºç¬¬6ä½<br>      case(2):<br>          LSA&#x3D;1;LSB&#x3D;0;LSC&#x3D;1; break;&#x2F;&#x2F;æ˜¾ç¤ºç¬¬5ä½<br>      case(3):<br>          LSA&#x3D;0;LSB&#x3D;0;LSC&#x3D;1; break;&#x2F;&#x2F;æ˜¾ç¤ºç¬¬4ä½<br>      case(4):<br>          LSA&#x3D;1;LSB&#x3D;1;LSC&#x3D;0; break;&#x2F;&#x2F;æ˜¾ç¤ºç¬¬3ä½<br>      case(5):<br>          LSA&#x3D;0;LSB&#x3D;1;LSC&#x3D;0; break;&#x2F;&#x2F;æ˜¾ç¤ºç¬¬2ä½<br>      case(6):<br>          LSA&#x3D;1;LSB&#x3D;0;LSC&#x3D;0; break;&#x2F;&#x2F;æ˜¾ç¤ºç¬¬1ä½<br>      case(7):<br>          LSA&#x3D;0;LSB&#x3D;0;LSC&#x3D;0; break;&#x2F;&#x2F;æ˜¾ç¤ºç¬¬0ä½<br>  }<br>  P0&#x3D;DisplayData[i];&#x2F;&#x2F;å‘é€æ®µç <br>  delay(100); &#x2F;&#x2F;é—´éš”ä¸€æ®µæ—¶é—´æ‰«æ<br>  P0&#x3D;0x00;&#x2F;&#x2F;æ¶ˆéš<br>  }<br>}</li></ul><p>&#x2F;&#x2F;mode&#x3D;0 å•æ¬¡   1ï¼šè¿ç»­<br>u8 KeyScan(u8 mode)<br>{<br>    static u8 keyen&#x3D;1;<br>    if(mode&#x3D;&#x3D;1)<br>    {<br>        keyen&#x3D;1;<br>    }<br>    if(keyen&#x3D;&#x3D;1&amp;&amp;(k1&#x3D;&#x3D;0||k2&#x3D;&#x3D;0||k3&#x3D;&#x3D;0||k4&#x3D;&#x3D;0))<br>    {<br>        delay(1000);  &#x2F;&#x2F;æ¶ˆæŠ–å¤„ç†<br>        keyen&#x3D;0;<br>        if(k1&#x3D;&#x3D;0)return KEY1;<br>        else if(k2&#x3D;&#x3D;0)return KEY2;<br>        else if(k3&#x3D;&#x3D;0)return KEY3;<br>        else if(k4&#x3D;&#x3D;0)return KEY4;<br>    }<br>    else if(k1&#x3D;&#x3D;1&amp;&amp;k2&#x3D;&#x3D;1&amp;&amp;k3&#x3D;&#x3D;1&amp;&amp;k4&#x3D;&#x3D;1)<br>    {<br>        keyen&#x3D;1;<br>    }<br>    return 0;<br>}</p><p>void datapros()<br>{<br>    u8 key;<br>    key&#x3D;KeyScan(0);</p><pre><code>if(key==KEY4)   //è®¾ç½®&#123;    setflag++;    TR0=1;   //å¼€å¯å®šæ—¶å™¨    if(setflag==2)    &#123;        TR0=0;//å…³é—­å®šæ—¶å™¨        setflag=0;    &#125;&#125;if(setflag==0) //é»˜è®¤/é€€å‡ºè®¾ç½®æ˜¾ç¤º&#123;    DisplayData[0]=smgduan[datnum4];    DisplayData[1]=smgduan[datnum3];    DisplayData[2]=smgduan[datnum2];    DisplayData[3]=smgduan[datnum1];&#125;else  //è¿›å…¥è®¾ç½®  æ•°ç ç®¡é€‰ä¸­é—ªçƒ&#123;    if(key==KEY2)    //æ•°æ®ä½æ•°ç§»åŠ¨å˜åŒ–    &#123;        wei_change++;        if(wei_change&gt;3)wei_change=0;        DisplayData[0]=smgduan[datnum4];        DisplayData[1]=smgduan[datnum3];        DisplayData[2]=smgduan[datnum2];        DisplayData[3]=smgduan[datnum1];    &#125;    else if(key==KEY1) //æ•°æ®åŠ     &#123;        switch(wei_change)        &#123;            case 0:  datnum1++;                    if(datnum1&gt;9)datnum1=0;                    break;            case 1:  datnum2++;                    if(datnum2&gt;9)datnum2=0;                    break;            case 2:  datnum3++;                    if(datnum3&gt;9)datnum3=0;                    break;            case 3:  datnum4++;                    if(datnum4&gt;9)datnum4=0;                    break;        &#125;    &#125;    else if(key==KEY3) //æ•°æ®å‡    &#123;        switch(wei_change)        &#123;            case 0:  datnum1--;                    if(datnum1&lt;=0)datnum1=9;                    break;            case 1:  datnum2--;                    if(datnum2&lt;=0)datnum2=9;                    break;            case 2:  datnum3--;                    if(datnum3&lt;=0)datnum3=9;                    break;            case 3:  datnum4--;                    if(datnum4&lt;=0)datnum4=9;                    break;        &#125;    &#125;        &#125;</code></pre><p>}<br>&#x2F;*******************************************************************************</p><ul><li>å‡½ æ•° å       : main</li><li>å‡½æ•°åŠŸèƒ½ : ä¸»å‡½æ•°</li><li>è¾“    å…¥       : æ— </li><li>è¾“    å‡º     : æ— <br>*******************************************************************************&#x2F;<br>void main()<br>{<br>  Timer0Init();<br>  while(1)<br>  {<br>  datapros();<br>  DigDisplay();<br>  }<br>}</li></ul><p>&#x2F;*******************************************************************************</p><ul><li>å‡½ æ•° å         : void Timer0() interrupt 1</li><li>å‡½æ•°åŠŸèƒ½   : å®šæ—¶å™¨0ä¸­æ–­å‡½æ•°</li><li>è¾“    å…¥         : æ— </li><li>è¾“    å‡º         : æ— <br>*******************************************************************************&#x2F;<br>void Timer0() interrupt 1<br>{<br>  static u8 i;<br>  TH0&#x3D;0Xd8;&#x2F;&#x2F;ç»™å®šæ—¶å™¨èµ‹åˆå€¼ï¼Œå®šæ—¶10ms<br>  TL0&#x3D;0Xf0;<br>  i++;<br>  if(i&#x3D;&#x3D;50)  &#x2F;&#x2F;500ms<br>  {<br>  switch(wei_change)<br>  {<br>      case 0: DisplayData[3]&#x3D;0x00;break;<br>      case 1: DisplayData[2]&#x3D;0x00;break;<br>      case 2: DisplayData[1]&#x3D;0x00;break;<br>      case 3: DisplayData[0]&#x3D;0x00;break;<br>  }<br>  }<br>  if(i&#x3D;&#x3D;100)   &#x2F;&#x2F;1s<br>  {<br>  i&#x3D;0;<br>  switch(wei_change)<br>  {<br>      case 0: DisplayData[3]&#x3D;smgduan[datnum1];break;<br>      case 1: DisplayData[2]&#x3D;smgduan[datnum2];break;<br>      case 2: DisplayData[1]&#x3D;smgduan[datnum3];break;<br>      case 3: DisplayData[0]&#x3D;smgduan[datnum4];break;<br>  }<br>  }<br>}&#96;</li></ul><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/15Aak_hkC96iZayfbUrctFg </span><br><span class="line">æå–ç ï¼špxdd</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/15Aak_hkC96iZayfbUrctFg  æå–ç ï¼špxdd</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘æ³¢å½¢ä¿¡å·å‘ç”Ÿå™¨ï¼ˆ4ç§æ³¢å½¢å¯é€‰ï¼Œé¢‘ç‡å¯è°ƒï¼‰</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%B3%A2%E5%BD%A2%E4%BF%A1%E5%8F%B7%E5%8F%91%E7%94%9F%E5%99%A84%E7%A7%8D%E6%B3%A2%E5%BD%A2%E5%8F%AF%E9%80%89%E9%A2%91%E7%8E%87%E5%8F%AF%E8%B0%83/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%B3%A2%E5%BD%A2%E4%BF%A1%E5%8F%B7%E5%8F%91%E7%94%9F%E5%99%A84%E7%A7%8D%E6%B3%A2%E5%BD%A2%E5%8F%AF%E9%80%89%E9%A2%91%E7%8E%87%E5%8F%AF%E8%B0%83/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘æ³¢å½¢ä¿¡å·å‘ç”Ÿå™¨ï¼ˆ4ç§æ³¢å½¢å¯é€‰ï¼Œé¢‘ç‡å¯è°ƒï¼‰"><a href="#ã€Proteusä»¿çœŸã€‘æ³¢å½¢ä¿¡å·å‘ç”Ÿå™¨ï¼ˆ4ç§æ³¢å½¢å¯é€‰ï¼Œé¢‘ç‡å¯è°ƒï¼‰" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æ³¢å½¢ä¿¡å·å‘ç”Ÿå™¨ï¼ˆ4ç§æ³¢å½¢å¯é€‰ï¼Œé¢‘ç‡å¯è°ƒï¼‰"></a>ã€Proteusä»¿çœŸã€‘æ³¢å½¢ä¿¡å·å‘ç”Ÿå™¨ï¼ˆ4ç§æ³¢å½¢å¯é€‰ï¼Œé¢‘ç‡å¯è°ƒï¼‰</h1><h3 id="ã€Proteusä»¿çœŸã€‘æ³¢å½¢ä¿¡å·å‘ç”Ÿå™¨ï¼ˆ4ç§æ³¢å½¢å¯é€‰ï¼Œé¢‘ç‡å¯è°ƒï¼‰-1"><a href="#ã€Proteusä»¿çœŸã€‘æ³¢å½¢ä¿¡å·å‘ç”Ÿå™¨ï¼ˆ4ç§æ³¢å½¢å¯é€‰ï¼Œé¢‘ç‡å¯è°ƒï¼‰-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æ³¢å½¢ä¿¡å·å‘ç”Ÿå™¨ï¼ˆ4ç§æ³¢å½¢å¯é€‰ï¼Œé¢‘ç‡å¯è°ƒï¼‰"></a>ã€Proteusä»¿çœŸã€‘æ³¢å½¢ä¿¡å·å‘ç”Ÿå™¨ï¼ˆ4ç§æ³¢å½¢å¯é€‰ï¼Œé¢‘ç‡å¯è°ƒï¼‰</h3><ul><li>ğŸ“Œç›¸å…³ç¯‡ã€Šã€Proteusä»¿çœŸã€‘51å•ç‰‡æœº+DAC0832+LM358æ”¾å¤§ç”µè·¯æ³¢å½¢å‘ç”Ÿå™¨ã€‹</li><li>ğŸ“ºProteusä»¿çœŸæ¼”ç¤ºï¼š</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/122897111">ã€Proteusä»¿çœŸã€‘51å•ç‰‡æœº+DAC0832+LM358æ”¾å¤§ç”µè·¯æ³¢å½¢å‘ç”Ÿå™¨</a></p><p><img src="https://img-blog.csdnimg.cn/dafa9b400e8d4afeb2f7c886ab8aa068.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/67ada69593b841908ca5f4989d339cd5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“ä¸»ç¨‹åºä»£ç "><a href="#ğŸ“ä¸»ç¨‹åºä»£ç " class="headerlink" title="ğŸ“ä¸»ç¨‹åºä»£ç "></a>ğŸ“ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;reg51.h&quot; </span><br><span class="line">#include &lt;data.h&gt;</span><br><span class="line">#include &lt;LCD1602.h&gt;</span><br><span class="line">#define uchar unsigned char   </span><br><span class="line">#define uint unsigned int   </span><br><span class="line">#define key P1   </span><br><span class="line">#define dataout P3   </span><br><span class="line">uchar fre[5] =&quot;001Hz&quot;;</span><br><span class="line">uint data THHL=65536-3906;</span><br><span class="line">uchar data keyword,n=0;   </span><br><span class="line">uchar data Signal_chose = 0; </span><br><span class="line">uchar data div = 1; </span><br><span class="line">void keyscan()   </span><br><span class="line">&#123;    </span><br><span class="line"> keyword=key&amp;0x3f;   </span><br><span class="line"> if(keyword!=0x3f)   </span><br><span class="line"> &#123;   </span><br><span class="line">  while((key&amp;0x3f)!=0x3f);//ç­‰å¾…æŒ‰é”®æ¾å¼€   </span><br><span class="line">  switch(keyword)   </span><br><span class="line">  &#123;   </span><br><span class="line">case 62: &#123;</span><br><span class="line">if(div&gt;=100) THHL=65536-39; else &#123;div++;THHL=65536-3906/div;&#125;//é¢‘ç‡up</span><br><span class="line">fre[0]=div/100 + &#x27;0&#x27;;fre[1]=div/10%10 + &#x27;0&#x27;;fre[2]=div%10 + &#x27;0&#x27;;</span><br><span class="line">TR1=0;LCD_send(2,11,fre,5);TR1=1; break;</span><br><span class="line">&#125;   </span><br><span class="line">case 61: &#123;</span><br><span class="line">if(div&lt;=1) THHL=65536-3906; else &#123;div--;THHL=65536-3906/div;&#125;//é¢‘ç‡down</span><br><span class="line">fre[0]=div/100 + &#x27;0&#x27;;fre[1]=div/10%10 + &#x27;0&#x27;;fre[2]=div%10 + &#x27;0&#x27;;</span><br><span class="line">TR1=0;LCD_send(2,11,fre,5);TR1=1; break;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case 59: &#123;Signal_chose=0;TR1=0;LCD_send(1,5,&quot;Sin       &quot;,10);TR1=1; break;&#125;  //æ­£å¼¦æ³¢</span><br><span class="line">case 55:&#123;Signal_chose=1;TR1=0;LCD_send(1,5,&quot;Triangular&quot;,10);TR1=1; break;&#125;//ä¸‰è§’æ³¢</span><br><span class="line">case 47:&#123;Signal_chose=2;TR1=0;LCD_send(1,5,&quot;Square    &quot;,10);TR1=1; break;&#125;//æ–¹æ³¢</span><br><span class="line">case 31: &#123;Signal_chose=3;TR1=0;LCD_send(1,5,&quot;Sawtooth  &quot;,10);TR1=1; break;&#125;//é”¯é½¿æ³¢</span><br><span class="line">default:&#123;break;&#125;   </span><br><span class="line">   &#125;   </span><br><span class="line"> &#125;   </span><br><span class="line">&#125;   </span><br><span class="line">   </span><br><span class="line">void init()//åˆå§‹åŒ– </span><br><span class="line">&#123;   </span><br><span class="line"> key=0x3f;P2=0x00;dataout=0x00;THHL=65536-3906;  ///åˆå§‹é¢‘ç‡ä¸º1Hz</span><br><span class="line"> TH1=THHL/256;TL1=THHL%256;   </span><br><span class="line"> TMOD=0x11;ET1=1;TR1=1;EA=1;   </span><br><span class="line">&#125;   </span><br><span class="line">   </span><br><span class="line">void main()   </span><br><span class="line">&#123;   </span><br><span class="line">LCD_init();</span><br><span class="line">LCD_send(1,0,&quot;Type:Sin&quot;,8);</span><br><span class="line">LCD_send(2,0,&quot;frequency:&quot;,10);</span><br><span class="line">LCD_send(2,11,fre,5);</span><br><span class="line">init();</span><br><span class="line">while(1)   </span><br><span class="line">&#123;   </span><br><span class="line">keyscan(); </span><br><span class="line">switch(Signal_chose)   </span><br><span class="line">&#123;   </span><br><span class="line">case 0: &#123;dataout=sin_tab[n]; break;&#125;  //æ­£å¼¦æ³¢</span><br><span class="line">case 1: &#123;dataout=thr_tab[n]; break;&#125;  //ä¸‰è§’æ³¢</span><br><span class="line">case 2: &#123;dataout=squ_tab[n]; break;&#125;  //æ–¹æ³¢</span><br><span class="line">case 3: &#123;dataout=255-n;break;&#125;//é”¯é½¿æ³¢</span><br><span class="line">default:&#123;break;&#125;   </span><br><span class="line"> &#125;   </span><br><span class="line">&#125;   </span><br><span class="line">&#125;   </span><br><span class="line">   </span><br><span class="line">void time_intt1(void) interrupt 3   </span><br><span class="line">&#123;   </span><br><span class="line">TL1=THHL%256;TH1=THHL/256;  </span><br><span class="line">//if(n&gt;=255) &#123;n=0;&#125; else &#123;n++;&#125;   </span><br><span class="line">n++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œreg51.hâ€<br>#include &lt;data.h&gt;<br>#include &lt;LCD1602.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int<br>#define key P1<br>#define dataout P3<br>uchar fre[5] &#x3D;â€001Hzâ€;<br>uint data THHL&#x3D;65536-3906;<br>uchar data keyword,n&#x3D;0;<br>uchar data Signal_chose &#x3D; 0;<br>uchar data div &#x3D; 1;<br>void keyscan()<br>{<br> keyword&#x3D;key&0x3f;<br> if(keyword!&#x3D;0x3f)<br> {<br>  while((key&amp;0x3f)!&#x3D;0x3f);&#x2F;&#x2F;ç­‰å¾…æŒ‰é”®æ¾å¼€<br>  switch(keyword)<br>  {<br>        case 62: {<br>                            if(div&gt;&#x3D;100) THHL&#x3D;65536-39; else {div++;THHL&#x3D;65536-3906&#x2F;div;}&#x2F;&#x2F;é¢‘ç‡up<br>                            fre[0]&#x3D;div&#x2F;100 + â€˜0â€™;fre[1]&#x3D;div&#x2F;10%10 + â€˜0â€™;fre[2]&#x3D;div%10 + â€˜0â€™;<br>                            TR1&#x3D;0;LCD_send(2,11,fre,5);TR1&#x3D;1; break;<br>                            }<br>        case 61: {<br>                            if(div&lt;&#x3D;1) THHL&#x3D;65536-3906; else {divâ€“;THHL&#x3D;65536-3906&#x2F;div;}&#x2F;&#x2F;é¢‘ç‡down<br>                            fre[0]&#x3D;div&#x2F;100 + â€˜0â€™;fre[1]&#x3D;div&#x2F;10%10 + â€˜0â€™;fre[2]&#x3D;div%10 + â€˜0â€™;<br>                            TR1&#x3D;0;LCD_send(2,11,fre,5);TR1&#x3D;1; break;<br>                            }   </p><pre><code>    case 59: &#123;Signal_chose=0;TR1=0;LCD_send(1,5,&quot;Sin       &quot;,10);TR1=1; break;&#125;  //æ­£å¼¦æ³¢    case 55:&#123;Signal_chose=1;TR1=0;LCD_send(1,5,&quot;Triangular&quot;,10);TR1=1; break;&#125;//ä¸‰è§’æ³¢    case 47:&#123;Signal_chose=2;TR1=0;LCD_send(1,5,&quot;Square    &quot;,10);TR1=1; break;&#125;//æ–¹æ³¢    case 31: &#123;Signal_chose=3;TR1=0;LCD_send(1,5,&quot;Sawtooth  &quot;,10);TR1=1; break;&#125;//é”¯é½¿æ³¢    default:&#123;break;&#125;   </code></pre><p>   }<br> }<br>}   </p><p>void init()&#x2F;&#x2F;åˆå§‹åŒ–<br>{<br> key&#x3D;0x3f;P2&#x3D;0x00;dataout&#x3D;0x00;THHL&#x3D;65536-3906;  &#x2F;&#x2F;&#x2F;åˆå§‹é¢‘ç‡ä¸º1Hz<br> TH1&#x3D;THHL&#x2F;256;TL1&#x3D;THHL%256;<br> TMOD&#x3D;0x11;ET1&#x3D;1;TR1&#x3D;1;EA&#x3D;1;<br>}   </p><p>void main()<br>{<br>    LCD_init();<br>    LCD_send(1,0,â€Type:Sinâ€,8);<br>    LCD_send(2,0,â€frequency:â€,10);<br>    LCD_send(2,11,fre,5);<br>    init();<br>    while(1)<br>    {<br>        keyscan();<br>        switch(Signal_chose)<br>            {<br>                case 0: {dataout&#x3D;sin_tab[n]; break;}  &#x2F;&#x2F;æ­£å¼¦æ³¢<br>                case 1: {dataout&#x3D;thr_tab[n]; break;}  &#x2F;&#x2F;ä¸‰è§’æ³¢<br>                case 2: {dataout&#x3D;squ_tab[n]; break;}  &#x2F;&#x2F;æ–¹æ³¢<br>                case 3: {dataout&#x3D;255-n;break;}&#x2F;&#x2F;é”¯é½¿æ³¢<br>                default:{break;}<br>             }   <br>    }<br>}   </p><p>void time_intt1(void) interrupt 3<br>{<br>    TL1&#x3D;THHL%256;TH1&#x3D;THHL&#x2F;256;<br>&#x2F;&#x2F;if(n&gt;&#x3D;255) {n&#x3D;0;} else {n++;}<br>    n++;<br>}&#96;</p><h4 id="ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zgFzzDAer8ItDjCP5LxZSw </span><br><span class="line">æå–ç ï¼šu2to</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zgFzzDAer8ItDjCP5LxZSw  æå–ç ï¼šu2to</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘è‡ªåŠ¨é‡ç¨‹(èŒƒå›´ï¼œ10V)åˆ‡æ¢æ•°å­—ç”µå‹è¡¨</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E8%87%AA%E5%8A%A8%E9%87%8F%E7%A8%8B%E8%8C%83%E5%9B%B410V%E5%88%87%E6%8D%A2%E6%95%B0%E5%AD%97%E7%94%B5%E5%8E%8B%E8%A1%A8/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E8%87%AA%E5%8A%A8%E9%87%8F%E7%A8%8B%E8%8C%83%E5%9B%B410V%E5%88%87%E6%8D%A2%E6%95%B0%E5%AD%97%E7%94%B5%E5%8E%8B%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘è‡ªåŠ¨é‡ç¨‹-èŒƒå›´ï¼œ10V-åˆ‡æ¢æ•°å­—ç”µå‹è¡¨"><a href="#ã€Proteusä»¿çœŸã€‘è‡ªåŠ¨é‡ç¨‹-èŒƒå›´ï¼œ10V-åˆ‡æ¢æ•°å­—ç”µå‹è¡¨" class="headerlink" title="ã€Proteusä»¿çœŸã€‘è‡ªåŠ¨é‡ç¨‹(èŒƒå›´ï¼œ10V)åˆ‡æ¢æ•°å­—ç”µå‹è¡¨"></a>ã€Proteusä»¿çœŸã€‘è‡ªåŠ¨é‡ç¨‹(èŒƒå›´ï¼œ10V)åˆ‡æ¢æ•°å­—ç”µå‹è¡¨</h1><h3 id="ã€Proteusä»¿çœŸã€‘è‡ªåŠ¨é‡ç¨‹-èŒƒå›´"><a href="#ã€Proteusä»¿çœŸã€‘è‡ªåŠ¨é‡ç¨‹-èŒƒå›´" class="headerlink" title="ã€Proteusä»¿çœŸã€‘è‡ªåŠ¨é‡ç¨‹(èŒƒå›´&lt;10V)åˆ‡æ¢æ•°å­—ç”µå‹è¡¨"></a>ã€Proteusä»¿çœŸã€‘è‡ªåŠ¨é‡ç¨‹(èŒƒå›´&lt;10V)åˆ‡æ¢æ•°å­—ç”µå‹è¡¨</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/a5e1d1a9e385468db0ca014606f5827f.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ç¨‹åºä»£ç "><a href="#ç¤ºä¾‹ç¨‹åºä»£ç " class="headerlink" title="ç¤ºä¾‹ç¨‹åºä»£ç "></a>ç¤ºä¾‹ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;reg52.h&gt;</span><br><span class="line">unsigned char code dispbitcode[]= &#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f&#125;;//å…±é˜´æ•°ç ç®¡æ–­ç </span><br><span class="line">unsigned char dispbuf[4];</span><br><span class="line">unsigned int i;</span><br><span class="line">unsigned int j;</span><br><span class="line">unsigned int getdata;</span><br><span class="line">unsigned int temp;</span><br><span class="line">unsigned int temp1;</span><br><span class="line">unsigned char count;</span><br><span class="line">unsigned char d;</span><br><span class="line">sbit ST=P2^4;</span><br><span class="line">sbit OE=P2^5;</span><br><span class="line">sbit EOC=P2^6;</span><br><span class="line">sbit CLK=P2^7;</span><br><span class="line">sbit ADD_A=P3^4;  //é€‰æ‹©ADçš„è¾“å…¥ç«¯</span><br><span class="line">sbit ADD_B=P3^5;</span><br><span class="line">sbit ADD_C=P3^6;</span><br><span class="line">sbit D0=P2^0;  //æ•°ç ç®¡çš„ä½æ§åˆ¶ç«¯</span><br><span class="line">sbit D1=P2^1;</span><br><span class="line">sbit D2=P2^2;</span><br><span class="line">sbit D3=P2^3;</span><br><span class="line">sbit P17=P1^7;  //ç¡®å®šå°æ•°ç‚¹çš„ä½ç½®</span><br><span class="line">sbit s1=P3^2;</span><br><span class="line">sbit s2=P3^3;</span><br><span class="line">#define _v0_5 &#123;s1=1;s2=0;&#125;</span><br><span class="line">#define _v10 &#123;s1=0;s2=1;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unsigned char m;</span><br><span class="line"></span><br><span class="line">void TimeInitial();</span><br><span class="line">void Delay(unsigned int i);</span><br><span class="line"></span><br><span class="line">/*å®šæ—¶å™¨1åˆå§‹åŒ–å‡½æ•°*/</span><br><span class="line">void TimeInitial()</span><br><span class="line">&#123;   TMOD=0x10;</span><br><span class="line">    TH1=(65536-200)/256;</span><br><span class="line">    TL1=(65536-200)%256;</span><br><span class="line">    EA=1;</span><br><span class="line">    ET1=1;</span><br><span class="line">    TR1=1;</span><br><span class="line">&#125;</span><br><span class="line">/*å»¶æ—¶å‡½æ•°*/</span><br><span class="line">void Delay(unsigned int i)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned int j;</span><br><span class="line">    for(; i&gt;0; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        for(j=0; j&lt;125; j++)</span><br><span class="line">        &#123;;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°*/</span><br><span class="line">void Display()</span><br><span class="line">&#123;</span><br><span class="line">    P1=dispbitcode[dispbuf[3]];</span><br><span class="line"></span><br><span class="line">    D0=0;</span><br><span class="line">    D1=1;</span><br><span class="line">    D2=1;</span><br><span class="line">    D3=1;</span><br><span class="line">    Delay(10);</span><br><span class="line">    P1=0x00;</span><br><span class="line"></span><br><span class="line">    P1=dispbitcode[dispbuf[2]];</span><br><span class="line">    if(m==2)</span><br><span class="line">    &#123;</span><br><span class="line">        P17=1;</span><br><span class="line">    &#125;</span><br><span class="line">    D0=1;</span><br><span class="line">    D1=0;</span><br><span class="line">    D2=1;</span><br><span class="line">    D3=1;</span><br><span class="line">    Delay(10);</span><br><span class="line">    P1=0x00;</span><br><span class="line">    P1=dispbitcode[dispbuf[1]];</span><br><span class="line">    if(m==10)</span><br><span class="line">    &#123;</span><br><span class="line">        P17=1;</span><br><span class="line">    &#125;</span><br><span class="line">    D0=1;</span><br><span class="line">    D1=1;</span><br><span class="line">    D2=0;</span><br><span class="line">    D3=1;</span><br><span class="line">    Delay(10);</span><br><span class="line">    P1=0x00;</span><br><span class="line">    P1=dispbitcode[dispbuf[0]];</span><br><span class="line">    D0=1;</span><br><span class="line">    D1=1;</span><br><span class="line">    D2=1;</span><br><span class="line">    D3=0;</span><br><span class="line">    Delay(10);</span><br><span class="line">    P1=0x00;</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    TimeInitial();</span><br><span class="line">    ADD_A=0;</span><br><span class="line">    ADD_B=0;</span><br><span class="line">    ADD_C=0;</span><br><span class="line">    _v10;</span><br><span class="line">    m=2;</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ST=0;</span><br><span class="line">        OE=0;</span><br><span class="line">        ST=1;</span><br><span class="line">        ST=0;</span><br><span class="line">        while(EOC==0);</span><br><span class="line">        OE=1;</span><br><span class="line">        getdata=P0;</span><br><span class="line">        OE=0;</span><br><span class="line">        if ((s1==0) &amp;&amp; (s2==1) &amp;&amp; (getdata&lt;6))</span><br><span class="line">        &#123;</span><br><span class="line">            ADD_A=1;</span><br><span class="line">            _v0_5;</span><br><span class="line"></span><br><span class="line">            m=10;</span><br><span class="line">        &#125;</span><br><span class="line">        else if((s1==1)&amp;&amp;(s2==0) &amp;&amp; (getdata&gt;254))</span><br><span class="line">        &#123;</span><br><span class="line">            ADD_A=0;</span><br><span class="line">            _v10;</span><br><span class="line"></span><br><span class="line">            m=2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        temp=(getdata*1.0/255)*500*m;</span><br><span class="line">        dispbuf[0]=temp%10;</span><br><span class="line">        dispbuf[1]=temp/10%10;</span><br><span class="line">        dispbuf[2]=temp/100%10;</span><br><span class="line">        dispbuf[3]=temp/1000;</span><br><span class="line">        Display();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void t1(void) interrupt 3 using 0</span><br><span class="line">&#123;</span><br><span class="line">    TH1=(65536-200)/256;</span><br><span class="line">    TL1=(65536-200)%256;</span><br><span class="line">    CLK=~CLK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include&lt;reg52.h&gt;<br>unsigned char code dispbitcode[]&#x3D; {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};&#x2F;&#x2F;å…±é˜´æ•°ç ç®¡æ–­ç <br>unsigned char dispbuf[4];<br>unsigned int i;<br>unsigned int j;<br>unsigned int getdata;<br>unsigned int temp;<br>unsigned int temp1;<br>unsigned char count;<br>unsigned char d;<br>sbit ST&#x3D;P2^4;<br>sbit OE&#x3D;P2^5;<br>sbit EOC&#x3D;P2^6;<br>sbit CLK&#x3D;P2^7;<br>sbit ADD_A&#x3D;P3^4;  &#x2F;&#x2F;é€‰æ‹©ADçš„è¾“å…¥ç«¯<br>sbit ADD_B&#x3D;P3^5;<br>sbit ADD_C&#x3D;P3^6;<br>sbit D0&#x3D;P2^0;  &#x2F;&#x2F;æ•°ç ç®¡çš„ä½æ§åˆ¶ç«¯<br>sbit D1&#x3D;P2^1;<br>sbit D2&#x3D;P2^2;<br>sbit D3&#x3D;P2^3;<br>sbit P17&#x3D;P1^7;  &#x2F;&#x2F;ç¡®å®šå°æ•°ç‚¹çš„ä½ç½®<br>sbit s1&#x3D;P3^2;<br>sbit s2&#x3D;P3^3;<br>#define _v0_5 {s1&#x3D;1;s2&#x3D;0;}<br>#define _v10 {s1&#x3D;0;s2&#x3D;1;}</p><p>unsigned char m;</p><p>void TimeInitial();<br>void Delay(unsigned int i);</p><p>&#x2F;<em>å®šæ—¶å™¨1åˆå§‹åŒ–å‡½æ•°</em>&#x2F;<br>void TimeInitial()<br>{   TMOD&#x3D;0x10;<br>    TH1&#x3D;(65536-200)&#x2F;256;<br>    TL1&#x3D;(65536-200)%256;<br>    EA&#x3D;1;<br>    ET1&#x3D;1;<br>    TR1&#x3D;1;<br>}<br>&#x2F;<em>å»¶æ—¶å‡½æ•°</em>&#x2F;<br>void Delay(unsigned int i)<br>{<br>    unsigned int j;<br>    for(; i&gt;0; iâ€“)<br>    {<br>        for(j&#x3D;0; j&lt;125; j++)<br>        {;}<br>    }<br>}<br>&#x2F;<em>æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°</em>&#x2F;<br>void Display()<br>{<br>    P1&#x3D;dispbitcode[dispbuf[3]];</p><pre><code>D0=0;D1=1;D2=1;D3=1;Delay(10);P1=0x00;P1=dispbitcode[dispbuf[2]];if(m==2)&#123;    P17=1;&#125;D0=1;D1=0;D2=1;D3=1;Delay(10);P1=0x00;P1=dispbitcode[dispbuf[1]];if(m==10)&#123;    P17=1;&#125;D0=1;D1=1;D2=0;D3=1;Delay(10);P1=0x00;P1=dispbitcode[dispbuf[0]];D0=1;D1=1;D2=1;D3=0;Delay(10);P1=0x00;</code></pre><p>}<br>void main()<br>{<br>    TimeInitial();<br>    ADD_A&#x3D;0;<br>    ADD_B&#x3D;0;<br>    ADD_C&#x3D;0;<br>    _v10;<br>    m&#x3D;2;<br>    while(1)<br>    {</p><pre><code>    ST=0;    OE=0;    ST=1;    ST=0;    while(EOC==0);    OE=1;    getdata=P0;    OE=0;    if ((s1==0) &amp;&amp; (s2==1) &amp;&amp; (getdata&lt;6))    &#123;        ADD_A=1;        _v0_5;        m=10;    &#125;    else if((s1==1)&amp;&amp;(s2==0) &amp;&amp; (getdata&gt;254))    &#123;        ADD_A=0;        _v10;        m=2;    &#125;    temp=(getdata*1.0/255)*500*m;    dispbuf[0]=temp%10;    dispbuf[1]=temp/10%10;    dispbuf[2]=temp/100%10;    dispbuf[3]=temp/1000;    Display();&#125;</code></pre><p>}</p><p>void t1(void) interrupt 3 using 0<br>{<br>    TH1&#x3D;(65536-200)&#x2F;256;<br>    TL1&#x3D;(65536-200)%256;<br>    CLK&#x3D;~CLK;<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/12-rNBvoMRujGYpEN550fEQ </span><br><span class="line">æå–ç ï¼š986e</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/12-rNBvoMRujGYpEN550fEQ  æå–ç ï¼š986e</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å’Œé¢‘ç‡å¯è°ƒï¼‰</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-TLC5615%E8%BE%93%E5%87%BA256%E7%82%B9%E6%AD%A3%E5%BC%A6%E6%B3%A2%E6%8C%AF%E5%B9%85%E5%92%8C%E9%A2%91%E7%8E%87%E5%8F%AF%E8%B0%83/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-TLC5615%E8%BE%93%E5%87%BA256%E7%82%B9%E6%AD%A3%E5%BC%A6%E6%B3%A2%E6%8C%AF%E5%B9%85%E5%92%8C%E9%A2%91%E7%8E%87%E5%8F%AF%E8%B0%83/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å’Œé¢‘ç‡å¯è°ƒï¼‰"><a href="#TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å’Œé¢‘ç‡å¯è°ƒï¼‰" class="headerlink" title="TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å’Œé¢‘ç‡å¯è°ƒï¼‰"></a>TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å’Œé¢‘ç‡å¯è°ƒï¼‰</h1><h3 id="TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å’Œé¢‘ç‡å¯è°ƒï¼‰-1"><a href="#TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å’Œé¢‘ç‡å¯è°ƒï¼‰-1" class="headerlink" title="TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å’Œé¢‘ç‡å¯è°ƒï¼‰"></a>TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å’Œé¢‘ç‡å¯è°ƒï¼‰</h3><ul><li>ç›¸å…³ç¯‡ã€Šã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰ã€‹</li><li>ã€Šã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰ã€‹</li><li>Proteusä»¿çœŸ</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/124524009?csdn_share_tail=%7B%22type%22:%22blog%22,%22rType%22:%22article%22,%22rId%22:%22124524009%22,%22source%22:%22weixin_42880082%22%7D&ctrtid=8suHz">ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰</a></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/124525074">ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰</a></p><p><img src="https://img-blog.csdnimg.cn/74a582e7b40e420a851ec5d4af3abeac.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><ul><li>æ­£å¼¦æ³¢æ•°æ®ç”Ÿæˆå™¨ï¼ˆæœ€å¤§4096ç‚¹ï¼‰</li></ul><p>é‡‡ç”¨è¾“å‡ºç‚¹æ•°256ï¼Œ10ä½ç²¾åº¦ï¼Œ</p><p><img src="https://img-blog.csdnimg.cn/96d71fe48d4d4fedba5da839d61c4802.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¨‹åºæºç "><a href="#ç¨‹åºæºç " class="headerlink" title="ç¨‹åºæºç "></a>ç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">/************************************************************************************</span><br><span class="line">1.TLC5615 DAæ¨¡å—</span><br><span class="line">2.TLC5615 æ­£å¼¦æ³¢æ¨¡å—</span><br><span class="line">ã€ç¨‹åºåŠŸèƒ½ã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢</span><br><span class="line">TLC5615 DAæ¨¡å—æœ¬èº«å¿…é¡»ä½¿ç”¨5Vç”µæºï¼Œæ§åˆ¶ä¿¡å·å¯ä»¥æ¥å—3.3Væˆ–è€…5Vã€‚</span><br><span class="line">ã€IOé…ç½®ã€‘</span><br><span class="line">DIN---&gt;P1.0</span><br><span class="line">SCLK---&gt;P1.1</span><br><span class="line">CS---&gt;P1.2</span><br><span class="line">Dout---&gt;ç©ºï¼Œæœªå®šä¹‰</span><br><span class="line">************************************************************************************/</span><br><span class="line">#include&lt;reg52.h&gt;//åŒ…å«51å•ç‰‡æœºå¯„å­˜å™¨å®šä¹‰çš„å¤´æ–‡ä»¶</span><br><span class="line">#include&lt;intrins.h&gt;//åŒ…å«nopå‡½æ•°çš„å¤´æ–‡ä»¶</span><br><span class="line">#define uchar unsigned char//å®å®šä¹‰</span><br><span class="line">#define uint unsigned int//å®å®šä¹‰</span><br><span class="line"></span><br><span class="line">sbit DIN=P1^0;//IOå®šä¹‰</span><br><span class="line">sbit SCLK=P1^1;</span><br><span class="line">sbit CS=P1^2;</span><br><span class="line"></span><br><span class="line">sbit key1 = P2^1;  //æ§åˆ¶é¢‘ç‡çš„åŠ æŒ‰é”®</span><br><span class="line">sbit key2 = P2^0;  //æ§åˆ¶é¢‘ç‡çš„å‡æŒ‰é”®</span><br><span class="line">uint val = 1000; //åˆå§‹å€¼</span><br><span class="line">uint code sin1[]=//256ç‚¹8ä½æ•°æ®çš„æ­£å¼¦æ³¢è¡¨</span><br><span class="line">&#123;</span><br><span class="line"> 0x1FF,0x20C,0x218,0x225,0x231,0x23E,0x24A,0x256,0x263,0x26F,0x27B,0x287,0x293,0x29F,0x2AB,0x2B7</span><br><span class="line">,0x2C3,0x2CE,0x2DA,0x2E5,0x2F0,0x2FB,0x306,0x311,0x31B,0x326,0x330,0x33A,0x343,0x34D,0x357,0x360</span><br><span class="line">,0x369,0x371,0x37A,0x382,0x38A,0x392,0x39A,0x3A1,0x3A8,0x3AF,0x3B6,0x3BC,0x3C2,0x3C8,0x3CD,0x3D3</span><br><span class="line">,0x3D8,0x3DC,0x3E1,0x3E5,0x3E8,0x3EC,0x3EF,0x3F2,0x3F5,0x3F7,0x3F9,0x3FB,0x3FC,0x3FD,0x3FE,0x3FE</span><br><span class="line">,0x3FE,0x3FE,0x3FE,0x3FD,0x3FC,0x3FB,0x3F9,0x3F7,0x3F5,0x3F2,0x3EF,0x3EC,0x3E8,0x3E5,0x3E1,0x3DC</span><br><span class="line">,0x3D8,0x3D3,0x3CD,0x3C8,0x3C2,0x3BC,0x3B6,0x3AF,0x3A8,0x3A1,0x39A,0x392,0x38A,0x382,0x37A,0x371</span><br><span class="line">,0x369,0x360,0x357,0x34D,0x343,0x33A,0x330,0x326,0x31B,0x311,0x306,0x2FB,0x2F0,0x2E5,0x2DA,0x2CE</span><br><span class="line">,0x2C3,0x2B7,0x2AB,0x29F,0x293,0x287,0x27B,0x26F,0x263,0x256,0x24A,0x23E,0x231,0x225,0x218,0x20C</span><br><span class="line">,0x1FF,0x1F2,0x1E6,0x1D9,0x1CD,0x1C0,0x1B4,0x1A8,0x19B,0x18F,0x183,0x177,0x16B,0x15F,0x153,0x147</span><br><span class="line">,0x13B,0x130,0x124,0x119,0x10E,0x103,0x0F8,0x0ED,0x0E3,0x0D8,0x0CE,0x0C4,0x0BB,0x0B1,0x0A7,0x09E</span><br><span class="line">,0x095,0x08D,0x084,0x07C,0x074,0x06C,0x064,0x05D,0x056,0x04F,0x048,0x042,0x03C,0x036,0x031,0x02B</span><br><span class="line">,0x026,0x022,0x01D,0x019,0x016,0x012,0x00F,0x00C,0x009,0x007,0x005,0x003,0x002,0x001,0x000,0x000</span><br><span class="line">,0x000,0x000,0x000,0x001,0x002,0x003,0x005,0x007,0x009,0x00C,0x00F,0x012,0x016,0x019,0x01D,0x022</span><br><span class="line">,0x026,0x02B,0x031,0x036,0x03C,0x042,0x048,0x04F,0x056,0x05D,0x064,0x06C,0x074,0x07C,0x084,0x08D</span><br><span class="line">,0x095,0x09E,0x0A8,0x0B1,0x0BB,0x0C4,0x0CE,0x0D8,0x0E3,0x0ED,0x0F8,0x103,0x10E,0x119,0x124,0x130</span><br><span class="line">,0x13B,0x147,0x153,0x15F,0x16B,0x177,0x183,0x18F,0x19B,0x1A8,0x1B4,0x1C0,0x1CD,0x1D9,0x1E6,0x1F2</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// void delay_us(unsigned char n)//usçº§å»¶æ—¶å‡½æ•°</span><br><span class="line">//&#123;</span><br><span class="line">// unsigned char i;</span><br><span class="line">// for(i=0;i&lt;n;i++);</span><br><span class="line">//&#125;</span><br><span class="line"></span><br><span class="line">void delay(uint y)</span><br><span class="line">&#123;</span><br><span class="line">   uint x,z;</span><br><span class="line">  for(x = y;x&gt;0;x--);</span><br><span class="line">   for(z = 120;z&gt;0;z--);</span><br><span class="line">&#125;</span><br><span class="line">void key_scan()  //æŒ‰é”®æ‰«æç¨‹åº</span><br><span class="line">&#123;</span><br><span class="line">  if(!key1)  //key1æŒ‰ä¸‹</span><br><span class="line"> &#123;  </span><br><span class="line">  delay(1);</span><br><span class="line">  while(!key1);//ç­‰å¾…æŒ‰é”®å¼¹èµ·</span><br><span class="line">     val+=1000; //é¢‘ç‡å‡å°</span><br><span class="line">    if(val==10000) //ä¸‹é™å€¼</span><br><span class="line">   &#123;</span><br><span class="line">     val = 10000;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">else if(!key2)  //key2æŒ‰ä¸‹</span><br><span class="line"> &#123;</span><br><span class="line">    delay(1);</span><br><span class="line">    while(!key2);//ç­‰å¾…æŒ‰é”®å¼¹èµ·    </span><br><span class="line">        val-=1000; //é¢‘ç‡å¢åŠ </span><br><span class="line">       if(val==1000) //ä¸Šé™å€¼</span><br><span class="line">      &#123;</span><br><span class="line">        val = 1000;</span><br><span class="line">       &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">/******************************************************************</span><br><span class="line">1.sclkçš„ä¸Šå‡æ²¿æ•°æ®è¿›å…¥è¾“å…¥å¯„å­˜å™¨</span><br><span class="line">2.åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSçš„ä¸Šå‡æ²¿æ•°æ®å¼€å§‹DAè½¬åŒ–</span><br><span class="line">3.è¿ç»­è¾“å…¥12ä½æ•°æ®ï¼Œé«˜ä½åœ¨å‰ï¼Œå…¶ä¸­å‰10ä½æœ‰æ•ˆï¼Œåä¸¤ä½è¡¥0</span><br><span class="line">***************************************************************/</span><br><span class="line">void output(uint DA_Value)//TLC5615é©±åŠ¨å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i;</span><br><span class="line">DA_Value=DA_Value&lt;&lt;6;//å°†DA_Valueå·¦ç§»6ä½ï¼Œå³nnnn nnnn nnnnå˜ä¸ºnnnn nnnn nn00 0000</span><br><span class="line">SCLK=0;//ä¸ºä½ï¼Œå‡†å¤‡è¾“å…¥æ•°æ®</span><br><span class="line">CS=0;//ç‰‡é€‰</span><br><span class="line">for(i=12;i&gt;0;i--)//ä»é«˜ä½å¼€å§‹ï¼Œè¿ç»­å–å‡º12ä½æ•°æ®ï¼Œ</span><br><span class="line">&#123;</span><br><span class="line">if(DA_Value&amp;0x8000)//å’Œ1000 0000 0000 0000æ±‚ä¸ï¼Œè·å–æœ€é«˜ä½çš„å€¼ã€‚</span><br><span class="line">DIN=1;//ä¿¡å·1å†™å…¥èŠ¯ç‰‡</span><br><span class="line">else</span><br><span class="line">DIN=0;//ä¿¡å·0å†™å…¥èŠ¯ç‰‡</span><br><span class="line"></span><br><span class="line">//  _nop_();</span><br><span class="line">//_nop_();</span><br><span class="line">SCLK=1;//ä¸Šå‡æ²¿ï¼Œè¿›å…¥è¾“å…¥å¯„å­˜å™¨</span><br><span class="line">SCLK=0;//å¼€å¯ä¸‹ä¸€ä¸ªæ•°æ®å†™å…¥//å‡†å¤‡ä¸‹ä¸€æ¬¡è¾“å…¥</span><br><span class="line">DA_Value &lt;&lt;=1;//å·¦ç§»1ä½ï¼Œå‡†å¤‡è¾“å…¥ä¸‹ä¸€ä½æ•°æ®</span><br><span class="line">&#125;</span><br><span class="line">CS=1;//èŠ¯ç‰‡å…³é—­//åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSä¸Šå‡æ²¿ï¼Œæ•°æ®å¼€å§‹DAè½¬åŒ–</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Timer0Init(void)//å®šæ—¶å™¨0åˆå§‹åŒ–</span><br><span class="line">&#123;</span><br><span class="line"> TMOD = 0x01;</span><br><span class="line"> TH0 = (65536 - val)/256;</span><br><span class="line"> TL0 = (65536 - val)%256;</span><br><span class="line"> TR0 = 1;</span><br><span class="line"> ET0 = 1;</span><br><span class="line"> EA = 1;</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">Timer0Init();</span><br><span class="line">   while(1)</span><br><span class="line">&#123;</span><br><span class="line">key_scan();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">void Timer0_isr() interrupt 1 using 0</span><br><span class="line">&#123;</span><br><span class="line"> static volatile uint i=0;</span><br><span class="line">  TH0 = (65536 - val)/256;</span><br><span class="line">TL0 = (65536 - val)%256;</span><br><span class="line">output(sin1[i++]);//è¾“å‡ºæ­£å¼¦æ³¢</span><br><span class="line"> if(i&gt;256) i = 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;************************************************************************************<br>1.TLC5615 DAæ¨¡å—<br>2.TLC5615 æ­£å¼¦æ³¢æ¨¡å—<br>ã€ç¨‹åºåŠŸèƒ½ã€‘TLC5615è¾“å‡º256ç‚¹æ­£å¼¦æ³¢<br>TLC5615 DAæ¨¡å—æœ¬èº«å¿…é¡»ä½¿ç”¨5Vç”µæºï¼Œæ§åˆ¶ä¿¡å·å¯ä»¥æ¥å—3.3Væˆ–è€…5Vã€‚<br>ã€IOé…ç½®ã€‘<br>DINâ€”&gt;P1.0<br>SCLKâ€”&gt;P1.1<br>CSâ€”&gt;P1.2<br>Doutâ€”&gt;ç©ºï¼Œæœªå®šä¹‰<br>************************************************************************************&#x2F;<br>#include&lt;reg52.h&gt;&#x2F;&#x2F;åŒ…å«51å•ç‰‡æœºå¯„å­˜å™¨å®šä¹‰çš„å¤´æ–‡ä»¶<br>#include&lt;intrins.h&gt;&#x2F;&#x2F;åŒ…å«nopå‡½æ•°çš„å¤´æ–‡ä»¶<br>#define uchar unsigned char&#x2F;&#x2F;å®å®šä¹‰<br>#define uint unsigned int&#x2F;&#x2F;å®å®šä¹‰</p><p>sbit DIN&#x3D;P1^0;&#x2F;&#x2F;IOå®šä¹‰<br>sbit SCLK&#x3D;P1^1;<br>sbit CS&#x3D;P1^2;</p><p>sbit key1 &#x3D; P2^1;  &#x2F;&#x2F;æ§åˆ¶é¢‘ç‡çš„åŠ æŒ‰é”®<br>sbit key2 &#x3D; P2^0;  &#x2F;&#x2F;æ§åˆ¶é¢‘ç‡çš„å‡æŒ‰é”®<br>uint val &#x3D; 1000; &#x2F;&#x2F;åˆå§‹å€¼<br>uint code sin1[]&#x3D;&#x2F;&#x2F;256ç‚¹8ä½æ•°æ®çš„æ­£å¼¦æ³¢è¡¨<br>{<br>     0x1FF,0x20C,0x218,0x225,0x231,0x23E,0x24A,0x256,0x263,0x26F,0x27B,0x287,0x293,0x29F,0x2AB,0x2B7<br>,0x2C3,0x2CE,0x2DA,0x2E5,0x2F0,0x2FB,0x306,0x311,0x31B,0x326,0x330,0x33A,0x343,0x34D,0x357,0x360<br>,0x369,0x371,0x37A,0x382,0x38A,0x392,0x39A,0x3A1,0x3A8,0x3AF,0x3B6,0x3BC,0x3C2,0x3C8,0x3CD,0x3D3<br>,0x3D8,0x3DC,0x3E1,0x3E5,0x3E8,0x3EC,0x3EF,0x3F2,0x3F5,0x3F7,0x3F9,0x3FB,0x3FC,0x3FD,0x3FE,0x3FE<br>,0x3FE,0x3FE,0x3FE,0x3FD,0x3FC,0x3FB,0x3F9,0x3F7,0x3F5,0x3F2,0x3EF,0x3EC,0x3E8,0x3E5,0x3E1,0x3DC<br>,0x3D8,0x3D3,0x3CD,0x3C8,0x3C2,0x3BC,0x3B6,0x3AF,0x3A8,0x3A1,0x39A,0x392,0x38A,0x382,0x37A,0x371<br>,0x369,0x360,0x357,0x34D,0x343,0x33A,0x330,0x326,0x31B,0x311,0x306,0x2FB,0x2F0,0x2E5,0x2DA,0x2CE<br>,0x2C3,0x2B7,0x2AB,0x29F,0x293,0x287,0x27B,0x26F,0x263,0x256,0x24A,0x23E,0x231,0x225,0x218,0x20C<br>,0x1FF,0x1F2,0x1E6,0x1D9,0x1CD,0x1C0,0x1B4,0x1A8,0x19B,0x18F,0x183,0x177,0x16B,0x15F,0x153,0x147<br>,0x13B,0x130,0x124,0x119,0x10E,0x103,0x0F8,0x0ED,0x0E3,0x0D8,0x0CE,0x0C4,0x0BB,0x0B1,0x0A7,0x09E<br>,0x095,0x08D,0x084,0x07C,0x074,0x06C,0x064,0x05D,0x056,0x04F,0x048,0x042,0x03C,0x036,0x031,0x02B<br>,0x026,0x022,0x01D,0x019,0x016,0x012,0x00F,0x00C,0x009,0x007,0x005,0x003,0x002,0x001,0x000,0x000<br>,0x000,0x000,0x000,0x001,0x002,0x003,0x005,0x007,0x009,0x00C,0x00F,0x012,0x016,0x019,0x01D,0x022<br>,0x026,0x02B,0x031,0x036,0x03C,0x042,0x048,0x04F,0x056,0x05D,0x064,0x06C,0x074,0x07C,0x084,0x08D<br>,0x095,0x09E,0x0A8,0x0B1,0x0BB,0x0C4,0x0CE,0x0D8,0x0E3,0x0ED,0x0F8,0x103,0x10E,0x119,0x124,0x130<br>,0x13B,0x147,0x153,0x15F,0x16B,0x177,0x183,0x18F,0x19B,0x1A8,0x1B4,0x1C0,0x1CD,0x1D9,0x1E6,0x1F2<br>};</p><p>&#x2F;&#x2F; void delay_us(unsigned char n)&#x2F;&#x2F;usçº§å»¶æ—¶å‡½æ•°<br>&#x2F;&#x2F;{<br>&#x2F;&#x2F; unsigned char i;<br>&#x2F;&#x2F; for(i&#x3D;0;i&lt;n;i++);<br>&#x2F;&#x2F;}</p><pre><code>void delay(uint y)</code></pre><p>{<br>   uint x,z;<br>  for(x &#x3D; y;x&gt;0;xâ€“);<br>   for(z &#x3D; 120;z&gt;0;zâ€“);<br>}<br>void key_scan()  &#x2F;&#x2F;æŒ‰é”®æ‰«æç¨‹åº<br>{<br>  if(!key1)  &#x2F;&#x2F;key1æŒ‰ä¸‹<br> {<br>  delay(1);<br>  while(!key1);&#x2F;&#x2F;ç­‰å¾…æŒ‰é”®å¼¹èµ·<br>     val+&#x3D;1000; &#x2F;&#x2F;é¢‘ç‡å‡å°<br>    if(val&#x3D;&#x3D;10000) &#x2F;&#x2F;ä¸‹é™å€¼<br>   {<br>     val &#x3D; 10000;<br>   }<br> }<br>else if(!key2)  &#x2F;&#x2F;key2æŒ‰ä¸‹<br> {<br>    delay(1);<br>    while(!key2);&#x2F;&#x2F;ç­‰å¾…æŒ‰é”®å¼¹èµ·<br>        val-&#x3D;1000; &#x2F;&#x2F;é¢‘ç‡å¢åŠ <br>       if(val&#x3D;&#x3D;1000) &#x2F;&#x2F;ä¸Šé™å€¼<br>      {<br>        val &#x3D; 1000;<br>       }<br>  }<br> }</p><p>&#x2F;******************************************************************<br>    1.sclkçš„ä¸Šå‡æ²¿æ•°æ®è¿›å…¥è¾“å…¥å¯„å­˜å™¨<br>    2.åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSçš„ä¸Šå‡æ²¿æ•°æ®å¼€å§‹DAè½¬åŒ–<br>    3.è¿ç»­è¾“å…¥12ä½æ•°æ®ï¼Œé«˜ä½åœ¨å‰ï¼Œå…¶ä¸­å‰10ä½æœ‰æ•ˆï¼Œåä¸¤ä½è¡¥0<br>    ***************************************************************&#x2F;<br>void output(uint DA_Value)&#x2F;&#x2F;TLC5615é©±åŠ¨å‡½æ•°<br>    {<br>        unsigned char i;<br>        DA_Value&#x3D;DA_Value&lt;&lt;6;&#x2F;&#x2F;å°†DA_Valueå·¦ç§»6ä½ï¼Œå³nnnn nnnn nnnnå˜ä¸ºnnnn nnnn nn00 0000<br>        SCLK&#x3D;0;&#x2F;&#x2F;ä¸ºä½ï¼Œå‡†å¤‡è¾“å…¥æ•°æ®<br>        CS&#x3D;0;&#x2F;&#x2F;ç‰‡é€‰<br>        for(i&#x3D;12;i&gt;0;iâ€“)&#x2F;&#x2F;ä»é«˜ä½å¼€å§‹ï¼Œè¿ç»­å–å‡º12ä½æ•°æ®ï¼Œ<br>            {<br>                if(DA_Value&amp;0x8000)&#x2F;&#x2F;å’Œ1000 0000 0000 0000æ±‚ä¸ï¼Œè·å–æœ€é«˜ä½çš„å€¼ã€‚<br>                DIN&#x3D;1;&#x2F;&#x2F;ä¿¡å·1å†™å…¥èŠ¯ç‰‡<br>                else<br>                DIN&#x3D;0;&#x2F;&#x2F;ä¿¡å·0å†™å…¥èŠ¯ç‰‡</p><p>&#x2F;&#x2F;  <em>nop</em>();<br>&#x2F;&#x2F;<em>nop</em>();<br>                SCLK&#x3D;1;&#x2F;&#x2F;ä¸Šå‡æ²¿ï¼Œè¿›å…¥è¾“å…¥å¯„å­˜å™¨<br>                SCLK&#x3D;0;&#x2F;&#x2F;å¼€å¯ä¸‹ä¸€ä¸ªæ•°æ®å†™å…¥&#x2F;&#x2F;å‡†å¤‡ä¸‹ä¸€æ¬¡è¾“å…¥<br>                DA_Value &lt;&lt;&#x3D;1;&#x2F;&#x2F;å·¦ç§»1ä½ï¼Œå‡†å¤‡è¾“å…¥ä¸‹ä¸€ä½æ•°æ®<br>            }<br>            CS&#x3D;1;&#x2F;&#x2F;èŠ¯ç‰‡å…³é—­&#x2F;&#x2F;åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSä¸Šå‡æ²¿ï¼Œæ•°æ®å¼€å§‹DAè½¬åŒ–<br>    }</p><p>void Timer0Init(void)&#x2F;&#x2F;å®šæ—¶å™¨0åˆå§‹åŒ–<br>{<br>         TMOD &#x3D; 0x01;<br>         TH0 &#x3D; (65536 - val)&#x2F;256;<br>         TL0 &#x3D; (65536 - val)%256;<br>         TR0 &#x3D; 1;<br>         ET0 &#x3D; 1;<br>         EA &#x3D; 1;<br>}<br>void main()<br>{<br>    Timer0Init();<br>   while(1)<br>        {<br>        key_scan();<br>}<br>}<br>void Timer0_isr() interrupt 1 using 0<br>{<br> static volatile uint i&#x3D;0;<br>  TH0 &#x3D; (65536 - val)&#x2F;256;<br>    TL0 &#x3D; (65536 - val)%256;<br>    output(sin1[i++]);&#x2F;&#x2F;è¾“å‡ºæ­£å¼¦æ³¢<br> if(i&gt;256) i &#x3D; 0;<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1gK8_czsBje3kp_NbVQw5_Q </span><br><span class="line">æå–ç ï¼špcud</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1gK8_czsBje3kp_NbVQw5_Q  æå–ç ï¼špcud</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FTLC5615%E8%BE%93%E5%87%BA1024%E7%82%B9%E6%AD%A3%E5%BC%A6%E6%B3%A2%E6%8C%AF%E5%B9%85%E5%8F%AF%E8%B0%83/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FTLC5615%E8%BE%93%E5%87%BA1024%E7%82%B9%E6%AD%A3%E5%BC%A6%E6%B3%A2%E6%8C%AF%E5%B9%85%E5%8F%AF%E8%B0%83/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰"><a href="#ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰" class="headerlink" title="ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰"></a>ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰</h1><h3 id="ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰-1"><a href="#ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰"></a>ã€Proteusä»¿çœŸã€‘TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢ï¼ˆæŒ¯å¹…å¯è°ƒï¼‰</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/086226131b0e45fda45ef2bce5ab7449.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/437102da5d3041d0b77c3198f7691f37.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é€šè¿‡å¯è°ƒç”µé˜»ï¼Œè°ƒèŠ‚å‚è€ƒå¼•è„šè¾“å…¥çš„ç”µå‹å€¼ï¼Œä»è€Œæ”¹å˜è¾“å‡ºæŒ¯å¹…</p><h4 id="ç›¸å…³å·¥å…·"><a href="#ç›¸å…³å·¥å…·" class="headerlink" title="ç›¸å…³å·¥å…·"></a>ç›¸å…³å·¥å…·</h4><ul><li>æ­£å¼¦æ³¢æ•°æ®ç”Ÿæˆå™¨ï¼ˆæœ€å¤§4096ç‚¹ï¼‰ï¼Œä½¿ç”¨è¯¥å·¥å…·æœ€å¥½å»8ä½ç²¾åº¦çš„ï¼Œä¸ç„¶åœ¨ä»¿çœŸçš„æ—¶å€™ï¼Œåœ¨è°ƒèŠ‚åˆ°é«˜äº2.5Vç”µå‹æ—¶ï¼Œæ­£å¼¦æ³¢æ­£åŠå‘¨æœŸå³°å€¼ä¼šè¢«å‰Šæ‰çš„æƒ…å†µã€‚</li></ul><p>è¯¥å·¥å…·å’Œç¨‹åºèµ„æºå’Œä»¿çœŸæ–‡ä»¶æ‰“åŒ…åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œé¢ã€‚</p><p><img src="https://img-blog.csdnimg.cn/2095350bf5674eec9105f67b0fad48ef.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¨‹åºä»£ç "><a href="#ç¨‹åºä»£ç " class="headerlink" title="ç¨‹åºä»£ç "></a>ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">/************************************************************************************</span><br><span class="line"></span><br><span class="line">TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢</span><br><span class="line">ã€æ³¨æ„äº‹é¡¹ã€‘</span><br><span class="line">2.TLC5615 DAæ¨¡å—æœ¬èº«å¿…é¡»ä½¿ç”¨5Vç”µæºï¼Œæ§åˆ¶ä¿¡å·å¯ä»¥æ¥å—3.3Væˆ–è€…5Vã€‚</span><br><span class="line">ã€IOé…ç½®ã€‘</span><br><span class="line">DIN---&gt;P1.0</span><br><span class="line">SCLK---&gt;P1.1</span><br><span class="line">CS---&gt;P1.2</span><br><span class="line">Dout---&gt;ç©ºï¼Œæœªå®šä¹‰</span><br><span class="line">************************************************************************************/</span><br><span class="line">#include&lt;reg52.h&gt;//åŒ…å«51å•ç‰‡æœºå¯„å­˜å™¨å®šä¹‰çš„å¤´æ–‡ä»¶</span><br><span class="line">#include&lt;intrins.h&gt;//åŒ…å«nopå‡½æ•°çš„å¤´æ–‡ä»¶</span><br><span class="line">#define uchar unsigned char//å®å®šä¹‰</span><br><span class="line">#define uint unsigned int//å®å®šä¹‰</span><br><span class="line">sbit DIN=P1^0;//IOå®šä¹‰</span><br><span class="line">sbit SCLK=P1^1;</span><br><span class="line">sbit CS=P1^2;</span><br><span class="line"></span><br><span class="line">uint code sin1[1024]=//1024ç‚¹12ä½æ•°æ®çš„æ­£å¼¦æ³¢è¡¨</span><br><span class="line">&#123;</span><br><span class="line">0x1FF,0x202,0x205,0x208,0x20C,0x20F,0x212,0x215,0x218,0x21B,0x21E,0x221,0x225,0x228,0x22B,0x22E</span><br><span class="line">,0x231,0x234,0x237,0x23A,0x23E,0x241,0x244,0x247,0x24A,0x24D,0x250,0x253,0x256,0x25A,0x25D,0x260</span><br><span class="line">,0x263,0x266,0x269,0x26C,0x26F,0x272,0x275,0x278,0x27B,0x27E,0x281,0x284,0x287,0x28A,0x28D,0x290</span><br><span class="line">,0x293,0x296,0x299,0x29C,0x29F,0x2A2,0x2A5,0x2A8,0x2AB,0x2AE,0x2B1,0x2B4,0x2B7,0x2BA,0x2BD,0x2C0</span><br><span class="line">,0x2C3,0x2C6,0x2C9,0x2CB,0x2CE,0x2D1,0x2D4,0x2D7,0x2DA,0x2DD,0x2DF,0x2E2,0x2E5,0x2E8,0x2EB,0x2ED</span><br><span class="line">,0x2F0,0x2F3,0x2F6,0x2F8,0x2FB,0x2FE,0x301,0x303,0x306,0x309,0x30B,0x30E,0x311,0x313,0x316,0x319</span><br><span class="line">,0x31B,0x31E,0x320,0x323,0x326,0x328,0x32B,0x32D,0x330,0x332,0x335,0x337,0x33A,0x33C,0x33F,0x341</span><br><span class="line">,0x343,0x346,0x348,0x34B,0x34D,0x34F,0x352,0x354,0x357,0x359,0x35B,0x35D,0x360,0x362,0x364,0x366</span><br><span class="line">,0x369,0x36B,0x36D,0x36F,0x371,0x374,0x376,0x378,0x37A,0x37C,0x37E,0x380,0x382,0x384,0x386,0x388</span><br><span class="line">,0x38A,0x38C,0x38E,0x390,0x392,0x394,0x396,0x398,0x39A,0x39C,0x39E,0x39F,0x3A1,0x3A3,0x3A5,0x3A7</span><br><span class="line">,0x3A8,0x3AA,0x3AC,0x3AD,0x3AF,0x3B1,0x3B2,0x3B4,0x3B6,0x3B7,0x3B9,0x3BA,0x3BC,0x3BE,0x3BF,0x3C1</span><br><span class="line">,0x3C2,0x3C4,0x3C5,0x3C6,0x3C8,0x3C9,0x3CB,0x3CC,0x3CD,0x3CF,0x3D0,0x3D1,0x3D3,0x3D4,0x3D5,0x3D6</span><br><span class="line">,0x3D8,0x3D9,0x3DA,0x3DB,0x3DC,0x3DD,0x3DE,0x3E0,0x3E1,0x3E2,0x3E3,0x3E4,0x3E5,0x3E6,0x3E7,0x3E8</span><br><span class="line">,0x3E8,0x3E9,0x3EA,0x3EB,0x3EC,0x3ED,0x3EE,0x3EE,0x3EF,0x3F0,0x3F1,0x3F1,0x3F2,0x3F3,0x3F3,0x3F4</span><br><span class="line">,0x3F5,0x3F5,0x3F6,0x3F6,0x3F7,0x3F7,0x3F8,0x3F8,0x3F9,0x3F9,0x3FA,0x3FA,0x3FB,0x3FB,0x3FB,0x3FC</span><br><span class="line">,0x3FC,0x3FC,0x3FD,0x3FD,0x3FD,0x3FD,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE</span><br><span class="line">,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FD,0x3FD,0x3FD,0x3FD,0x3FC</span><br><span class="line">,0x3FC,0x3FC,0x3FB,0x3FB,0x3FB,0x3FA,0x3FA,0x3F9,0x3F9,0x3F8,0x3F8,0x3F7,0x3F7,0x3F6,0x3F6,0x3F5</span><br><span class="line">,0x3F5,0x3F4,0x3F3,0x3F3,0x3F2,0x3F1,0x3F1,0x3F0,0x3EF,0x3EE,0x3EE,0x3ED,0x3EC,0x3EB,0x3EA,0x3E9</span><br><span class="line">,0x3E8,0x3E8,0x3E7,0x3E6,0x3E5,0x3E4,0x3E3,0x3E2,0x3E1,0x3E0,0x3DE,0x3DD,0x3DC,0x3DB,0x3DA,0x3D9</span><br><span class="line">,0x3D8,0x3D6,0x3D5,0x3D4,0x3D3,0x3D1,0x3D0,0x3CF,0x3CD,0x3CC,0x3CB,0x3C9,0x3C8,0x3C6,0x3C5,0x3C4</span><br><span class="line">,0x3C2,0x3C1,0x3BF,0x3BE,0x3BC,0x3BA,0x3B9,0x3B7,0x3B6,0x3B4,0x3B2,0x3B1,0x3AF,0x3AD,0x3AC,0x3AA</span><br><span class="line">,0x3A8,0x3A7,0x3A5,0x3A3,0x3A1,0x39F,0x39E,0x39C,0x39A,0x398,0x396,0x394,0x392,0x390,0x38E,0x38C</span><br><span class="line">,0x38A,0x388,0x386,0x384,0x382,0x380,0x37E,0x37C,0x37A,0x378,0x376,0x374,0x371,0x36F,0x36D,0x36B</span><br><span class="line">,0x369,0x366,0x364,0x362,0x360,0x35D,0x35B,0x359,0x357,0x354,0x352,0x34F,0x34D,0x34B,0x348,0x346</span><br><span class="line">,0x343,0x341,0x33F,0x33C,0x33A,0x337,0x335,0x332,0x330,0x32D,0x32B,0x328,0x326,0x323,0x320,0x31E</span><br><span class="line">,0x31B,0x319,0x316,0x313,0x311,0x30E,0x30B,0x309,0x306,0x303,0x301,0x2FE,0x2FB,0x2F8,0x2F6,0x2F3</span><br><span class="line">,0x2F0,0x2ED,0x2EB,0x2E8,0x2E5,0x2E2,0x2DF,0x2DD,0x2DA,0x2D7,0x2D4,0x2D1,0x2CE,0x2CB,0x2C9,0x2C6</span><br><span class="line">,0x2C3,0x2C0,0x2BD,0x2BA,0x2B7,0x2B4,0x2B1,0x2AE,0x2AB,0x2A8,0x2A5,0x2A2,0x29F,0x29C,0x299,0x296</span><br><span class="line">,0x293,0x290,0x28D,0x28A,0x287,0x284,0x281,0x27E,0x27B,0x278,0x275,0x272,0x26F,0x26C,0x269,0x266</span><br><span class="line">,0x263,0x260,0x25D,0x25A,0x256,0x253,0x250,0x24D,0x24A,0x247,0x244,0x241,0x23E,0x23A,0x237,0x234</span><br><span class="line">,0x231,0x22E,0x22B,0x228,0x225,0x221,0x21E,0x21B,0x218,0x215,0x212,0x20F,0x20C,0x208,0x205,0x202</span><br><span class="line">,0x1FF,0x1FC,0x1F9,0x1F6,0x1F2,0x1EF,0x1EC,0x1E9,0x1E6,0x1E3,0x1E0,0x1DC,0x1D9,0x1D6,0x1D3,0x1D0</span><br><span class="line">,0x1CD,0x1CA,0x1C7,0x1C3,0x1C0,0x1BD,0x1BA,0x1B7,0x1B4,0x1B1,0x1AE,0x1AB,0x1A8,0x1A4,0x1A1,0x19E</span><br><span class="line">,0x19B,0x198,0x195,0x192,0x18F,0x18C,0x189,0x186,0x183,0x180,0x17D,0x17A,0x177,0x174,0x171,0x16E</span><br><span class="line">,0x16B,0x168,0x165,0x162,0x15F,0x15C,0x159,0x156,0x153,0x150,0x14D,0x14A,0x147,0x144,0x141,0x13E</span><br><span class="line">,0x13B,0x138,0x135,0x133,0x130,0x12D,0x12A,0x127,0x124,0x121,0x11F,0x11C,0x119,0x116,0x113,0x111</span><br><span class="line">,0x10E,0x10B,0x108,0x106,0x103,0x100,0x0FD,0x0FB,0x0F8,0x0F5,0x0F3,0x0F0,0x0ED,0x0EB,0x0E8,0x0E5</span><br><span class="line">,0x0E3,0x0E0,0x0DE,0x0DB,0x0D8,0x0D6,0x0D3,0x0D1,0x0CE,0x0CC,0x0C9,0x0C7,0x0C4,0x0C2,0x0BF,0x0BD</span><br><span class="line">,0x0BB,0x0B8,0x0B6,0x0B3,0x0B1,0x0AF,0x0AC,0x0AA,0x0A7,0x0A5,0x0A3,0x0A1,0x09E,0x09C,0x09A,0x098</span><br><span class="line">,0x095,0x093,0x091,0x08F,0x08D,0x08A,0x088,0x086,0x084,0x082,0x080,0x07E,0x07C,0x07A,0x078,0x076</span><br><span class="line">,0x074,0x072,0x070,0x06E,0x06C,0x06A,0x068,0x066,0x064,0x062,0x060,0x05F,0x05D,0x05B,0x059,0x057</span><br><span class="line">,0x056,0x054,0x052,0x051,0x04F,0x04D,0x04C,0x04A,0x048,0x047,0x045,0x044,0x042,0x040,0x03F,0x03D</span><br><span class="line">,0x03C,0x03A,0x039,0x038,0x036,0x035,0x033,0x032,0x031,0x02F,0x02E,0x02D,0x02B,0x02A,0x029,0x028</span><br><span class="line">,0x026,0x025,0x024,0x023,0x022,0x021,0x020,0x01E,0x01D,0x01C,0x01B,0x01A,0x019,0x018,0x017,0x016</span><br><span class="line">,0x016,0x015,0x014,0x013,0x012,0x011,0x010,0x010,0x00F,0x00E,0x00D,0x00D,0x00C,0x00B,0x00B,0x00A</span><br><span class="line">,0x009,0x009,0x008,0x008,0x007,0x007,0x006,0x006,0x005,0x005,0x004,0x004,0x003,0x003,0x003,0x002</span><br><span class="line">,0x002,0x002,0x001,0x001,0x001,0x001,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000</span><br><span class="line">,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x001,0x001,0x001,0x001,0x002</span><br><span class="line">,0x002,0x002,0x003,0x003,0x003,0x004,0x004,0x005,0x005,0x006,0x006,0x007,0x007,0x008,0x008,0x009</span><br><span class="line">,0x009,0x00A,0x00B,0x00B,0x00C,0x00D,0x00D,0x00E,0x00F,0x010,0x010,0x011,0x012,0x013,0x014,0x015</span><br><span class="line">,0x016,0x016,0x017,0x018,0x019,0x01A,0x01B,0x01C,0x01D,0x01E,0x020,0x021,0x022,0x023,0x024,0x025</span><br><span class="line">,0x026,0x028,0x029,0x02A,0x02B,0x02D,0x02E,0x02F,0x031,0x032,0x033,0x035,0x036,0x038,0x039,0x03A</span><br><span class="line">,0x03C,0x03D,0x03F,0x040,0x042,0x044,0x045,0x047,0x048,0x04A,0x04C,0x04D,0x04F,0x051,0x052,0x054</span><br><span class="line">,0x056,0x057,0x059,0x05B,0x05D,0x05F,0x060,0x062,0x064,0x066,0x068,0x06A,0x06C,0x06E,0x070,0x072</span><br><span class="line">,0x074,0x076,0x078,0x07A,0x07C,0x07E,0x080,0x082,0x084,0x086,0x088,0x08A,0x08D,0x08F,0x091,0x093</span><br><span class="line">,0x095,0x098,0x09A,0x09C,0x09E,0x0A1,0x0A3,0x0A5,0x0A8,0x0AA,0x0AC,0x0AF,0x0B1,0x0B3,0x0B6,0x0B8</span><br><span class="line">,0x0BB,0x0BD,0x0BF,0x0C2,0x0C4,0x0C7,0x0C9,0x0CC,0x0CE,0x0D1,0x0D3,0x0D6,0x0D8,0x0DB,0x0DE,0x0E0</span><br><span class="line">,0x0E3,0x0E5,0x0E8,0x0EB,0x0ED,0x0F0,0x0F3,0x0F5,0x0F8,0x0FB,0x0FD,0x100,0x103,0x106,0x108,0x10B</span><br><span class="line">,0x10E,0x111,0x113,0x116,0x119,0x11C,0x11F,0x121,0x124,0x127,0x12A,0x12D,0x130,0x133,0x135,0x138</span><br><span class="line">,0x13B,0x13E,0x141,0x144,0x147,0x14A,0x14D,0x150,0x153,0x156,0x159,0x15C,0x15F,0x162,0x165,0x168</span><br><span class="line">,0x16B,0x16E,0x171,0x174,0x177,0x17A,0x17D,0x180,0x183,0x186,0x189,0x18C,0x18F,0x192,0x195,0x198</span><br><span class="line">,0x19B,0x19E,0x1A1,0x1A4,0x1A8,0x1AB,0x1AE,0x1B1,0x1B4,0x1B7,0x1BA,0x1BD,0x1C0,0x1C4,0x1C7,0x1CA</span><br><span class="line">,0x1CD,0x1D0,0x1D3,0x1D6,0x1D9,0x1DD,0x1E0,0x1E3,0x1E6,0x1E9,0x1EC,0x1EF,0x1F2,0x1F6,0x1F9,0x1FC&#125;;</span><br><span class="line">void delay_us(unsigned char n)//usçº§å»¶æ—¶å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line"> unsigned char i;</span><br><span class="line"> for(i=0;i&lt;n;i++);</span><br><span class="line">&#125;</span><br><span class="line">/******************************************************************</span><br><span class="line">1.sclkçš„ä¸Šå‡æ²¿æ•°æ®è¿›å…¥è¾“å…¥å¯„å­˜å™¨</span><br><span class="line">2.åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSçš„ä¸Šå‡æ²¿æ•°æ®å¼€å§‹DAè½¬åŒ–</span><br><span class="line">3.è¿ç»­è¾“å…¥12ä½æ•°æ®ï¼Œé«˜ä½åœ¨å‰ï¼Œå…¶ä¸­å‰10ä½æœ‰æ•ˆï¼Œåä¸¤ä½è¡¥0</span><br><span class="line">***************************************************************/</span><br><span class="line">void output(uint DA_Value)//TLC5615é©±åŠ¨å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i;</span><br><span class="line">DA_Value=DA_Value&lt;&lt;6;//å°†DA_Valueå·¦ç§»6ä½ï¼Œå³nnnn nnnn nnnnå˜ä¸ºnnnn nnnn nn00 0000</span><br><span class="line"></span><br><span class="line">SCLK=0;//ä¸ºä½ï¼Œå‡†å¤‡è¾“å…¥æ•°æ®</span><br><span class="line">CS=0;//ç‰‡é€‰</span><br><span class="line">for(i=12;i&gt;0;i--)//ä»é«˜ä½å¼€å§‹ï¼Œè¿ç»­å–å‡º12ä½æ•°æ®ï¼Œ</span><br><span class="line">&#123;</span><br><span class="line">if(DA_Value&amp;0x8000)//å’Œ1000 0000 0000 0000æ±‚ä¸ï¼Œè·å–æœ€é«˜ä½çš„å€¼ã€‚</span><br><span class="line">DIN=1;</span><br><span class="line">else</span><br><span class="line">DIN=0;</span><br><span class="line">SCLK=1;//ä¸Šå‡æ²¿ï¼Œè¿›å…¥è¾“å…¥å¯„å­˜å™¨</span><br><span class="line">SCLK=0;//å‡†å¤‡ä¸‹ä¸€æ¬¡è¾“å…¥</span><br><span class="line">DA_Value=DA_Value&lt;&lt;1;//å·¦ç§»1ä½ï¼Œå‡†å¤‡è¾“å…¥ä¸‹ä¸€ä½æ•°æ®</span><br><span class="line">&#125;</span><br><span class="line">CS=1;//åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSä¸Šå‡æ²¿ï¼Œæ•°æ®å¼€å§‹DAè½¬åŒ–</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">   uint i;</span><br><span class="line">   while(1)</span><br><span class="line">&#123;</span><br><span class="line">i=0;</span><br><span class="line">for(i=0;i&lt;1023;i++)//è¿ç»­å–å‡º1024ç‚¹æ­£å¼¦æ•°æ®</span><br><span class="line">output(sin1[i]);//è¾“å‡ºæ­£å¼¦æ³¢</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;************************************************************************************</p><p>TLC5615è¾“å‡º1024ç‚¹æ­£å¼¦æ³¢<br>ã€æ³¨æ„äº‹é¡¹ã€‘<br>2.TLC5615 DAæ¨¡å—æœ¬èº«å¿…é¡»ä½¿ç”¨5Vç”µæºï¼Œæ§åˆ¶ä¿¡å·å¯ä»¥æ¥å—3.3Væˆ–è€…5Vã€‚<br>ã€IOé…ç½®ã€‘<br>DINâ€”&gt;P1.0<br>SCLKâ€”&gt;P1.1<br>CSâ€”&gt;P1.2<br>Doutâ€”&gt;ç©ºï¼Œæœªå®šä¹‰<br>************************************************************************************&#x2F;<br>#include&lt;reg52.h&gt;&#x2F;&#x2F;åŒ…å«51å•ç‰‡æœºå¯„å­˜å™¨å®šä¹‰çš„å¤´æ–‡ä»¶<br>#include&lt;intrins.h&gt;&#x2F;&#x2F;åŒ…å«nopå‡½æ•°çš„å¤´æ–‡ä»¶<br>#define uchar unsigned char&#x2F;&#x2F;å®å®šä¹‰<br>#define uint unsigned int&#x2F;&#x2F;å®å®šä¹‰<br>sbit DIN&#x3D;P1^0;&#x2F;&#x2F;IOå®šä¹‰<br>sbit SCLK&#x3D;P1^1;<br>sbit CS&#x3D;P1^2;</p><p>uint code sin1[1024]&#x3D;&#x2F;&#x2F;1024ç‚¹12ä½æ•°æ®çš„æ­£å¼¦æ³¢è¡¨<br>{<br>0x1FF,0x202,0x205,0x208,0x20C,0x20F,0x212,0x215,0x218,0x21B,0x21E,0x221,0x225,0x228,0x22B,0x22E<br>,0x231,0x234,0x237,0x23A,0x23E,0x241,0x244,0x247,0x24A,0x24D,0x250,0x253,0x256,0x25A,0x25D,0x260<br>,0x263,0x266,0x269,0x26C,0x26F,0x272,0x275,0x278,0x27B,0x27E,0x281,0x284,0x287,0x28A,0x28D,0x290<br>,0x293,0x296,0x299,0x29C,0x29F,0x2A2,0x2A5,0x2A8,0x2AB,0x2AE,0x2B1,0x2B4,0x2B7,0x2BA,0x2BD,0x2C0<br>,0x2C3,0x2C6,0x2C9,0x2CB,0x2CE,0x2D1,0x2D4,0x2D7,0x2DA,0x2DD,0x2DF,0x2E2,0x2E5,0x2E8,0x2EB,0x2ED<br>,0x2F0,0x2F3,0x2F6,0x2F8,0x2FB,0x2FE,0x301,0x303,0x306,0x309,0x30B,0x30E,0x311,0x313,0x316,0x319<br>,0x31B,0x31E,0x320,0x323,0x326,0x328,0x32B,0x32D,0x330,0x332,0x335,0x337,0x33A,0x33C,0x33F,0x341<br>,0x343,0x346,0x348,0x34B,0x34D,0x34F,0x352,0x354,0x357,0x359,0x35B,0x35D,0x360,0x362,0x364,0x366<br>,0x369,0x36B,0x36D,0x36F,0x371,0x374,0x376,0x378,0x37A,0x37C,0x37E,0x380,0x382,0x384,0x386,0x388<br>,0x38A,0x38C,0x38E,0x390,0x392,0x394,0x396,0x398,0x39A,0x39C,0x39E,0x39F,0x3A1,0x3A3,0x3A5,0x3A7<br>,0x3A8,0x3AA,0x3AC,0x3AD,0x3AF,0x3B1,0x3B2,0x3B4,0x3B6,0x3B7,0x3B9,0x3BA,0x3BC,0x3BE,0x3BF,0x3C1<br>,0x3C2,0x3C4,0x3C5,0x3C6,0x3C8,0x3C9,0x3CB,0x3CC,0x3CD,0x3CF,0x3D0,0x3D1,0x3D3,0x3D4,0x3D5,0x3D6<br>,0x3D8,0x3D9,0x3DA,0x3DB,0x3DC,0x3DD,0x3DE,0x3E0,0x3E1,0x3E2,0x3E3,0x3E4,0x3E5,0x3E6,0x3E7,0x3E8<br>,0x3E8,0x3E9,0x3EA,0x3EB,0x3EC,0x3ED,0x3EE,0x3EE,0x3EF,0x3F0,0x3F1,0x3F1,0x3F2,0x3F3,0x3F3,0x3F4<br>,0x3F5,0x3F5,0x3F6,0x3F6,0x3F7,0x3F7,0x3F8,0x3F8,0x3F9,0x3F9,0x3FA,0x3FA,0x3FB,0x3FB,0x3FB,0x3FC<br>,0x3FC,0x3FC,0x3FD,0x3FD,0x3FD,0x3FD,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE<br>,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FE,0x3FD,0x3FD,0x3FD,0x3FD,0x3FC<br>,0x3FC,0x3FC,0x3FB,0x3FB,0x3FB,0x3FA,0x3FA,0x3F9,0x3F9,0x3F8,0x3F8,0x3F7,0x3F7,0x3F6,0x3F6,0x3F5<br>,0x3F5,0x3F4,0x3F3,0x3F3,0x3F2,0x3F1,0x3F1,0x3F0,0x3EF,0x3EE,0x3EE,0x3ED,0x3EC,0x3EB,0x3EA,0x3E9<br>,0x3E8,0x3E8,0x3E7,0x3E6,0x3E5,0x3E4,0x3E3,0x3E2,0x3E1,0x3E0,0x3DE,0x3DD,0x3DC,0x3DB,0x3DA,0x3D9<br>,0x3D8,0x3D6,0x3D5,0x3D4,0x3D3,0x3D1,0x3D0,0x3CF,0x3CD,0x3CC,0x3CB,0x3C9,0x3C8,0x3C6,0x3C5,0x3C4<br>,0x3C2,0x3C1,0x3BF,0x3BE,0x3BC,0x3BA,0x3B9,0x3B7,0x3B6,0x3B4,0x3B2,0x3B1,0x3AF,0x3AD,0x3AC,0x3AA<br>,0x3A8,0x3A7,0x3A5,0x3A3,0x3A1,0x39F,0x39E,0x39C,0x39A,0x398,0x396,0x394,0x392,0x390,0x38E,0x38C<br>,0x38A,0x388,0x386,0x384,0x382,0x380,0x37E,0x37C,0x37A,0x378,0x376,0x374,0x371,0x36F,0x36D,0x36B<br>,0x369,0x366,0x364,0x362,0x360,0x35D,0x35B,0x359,0x357,0x354,0x352,0x34F,0x34D,0x34B,0x348,0x346<br>,0x343,0x341,0x33F,0x33C,0x33A,0x337,0x335,0x332,0x330,0x32D,0x32B,0x328,0x326,0x323,0x320,0x31E<br>,0x31B,0x319,0x316,0x313,0x311,0x30E,0x30B,0x309,0x306,0x303,0x301,0x2FE,0x2FB,0x2F8,0x2F6,0x2F3<br>,0x2F0,0x2ED,0x2EB,0x2E8,0x2E5,0x2E2,0x2DF,0x2DD,0x2DA,0x2D7,0x2D4,0x2D1,0x2CE,0x2CB,0x2C9,0x2C6<br>,0x2C3,0x2C0,0x2BD,0x2BA,0x2B7,0x2B4,0x2B1,0x2AE,0x2AB,0x2A8,0x2A5,0x2A2,0x29F,0x29C,0x299,0x296<br>,0x293,0x290,0x28D,0x28A,0x287,0x284,0x281,0x27E,0x27B,0x278,0x275,0x272,0x26F,0x26C,0x269,0x266<br>,0x263,0x260,0x25D,0x25A,0x256,0x253,0x250,0x24D,0x24A,0x247,0x244,0x241,0x23E,0x23A,0x237,0x234<br>,0x231,0x22E,0x22B,0x228,0x225,0x221,0x21E,0x21B,0x218,0x215,0x212,0x20F,0x20C,0x208,0x205,0x202<br>,0x1FF,0x1FC,0x1F9,0x1F6,0x1F2,0x1EF,0x1EC,0x1E9,0x1E6,0x1E3,0x1E0,0x1DC,0x1D9,0x1D6,0x1D3,0x1D0<br>,0x1CD,0x1CA,0x1C7,0x1C3,0x1C0,0x1BD,0x1BA,0x1B7,0x1B4,0x1B1,0x1AE,0x1AB,0x1A8,0x1A4,0x1A1,0x19E<br>,0x19B,0x198,0x195,0x192,0x18F,0x18C,0x189,0x186,0x183,0x180,0x17D,0x17A,0x177,0x174,0x171,0x16E<br>,0x16B,0x168,0x165,0x162,0x15F,0x15C,0x159,0x156,0x153,0x150,0x14D,0x14A,0x147,0x144,0x141,0x13E<br>,0x13B,0x138,0x135,0x133,0x130,0x12D,0x12A,0x127,0x124,0x121,0x11F,0x11C,0x119,0x116,0x113,0x111<br>,0x10E,0x10B,0x108,0x106,0x103,0x100,0x0FD,0x0FB,0x0F8,0x0F5,0x0F3,0x0F0,0x0ED,0x0EB,0x0E8,0x0E5<br>,0x0E3,0x0E0,0x0DE,0x0DB,0x0D8,0x0D6,0x0D3,0x0D1,0x0CE,0x0CC,0x0C9,0x0C7,0x0C4,0x0C2,0x0BF,0x0BD<br>,0x0BB,0x0B8,0x0B6,0x0B3,0x0B1,0x0AF,0x0AC,0x0AA,0x0A7,0x0A5,0x0A3,0x0A1,0x09E,0x09C,0x09A,0x098<br>,0x095,0x093,0x091,0x08F,0x08D,0x08A,0x088,0x086,0x084,0x082,0x080,0x07E,0x07C,0x07A,0x078,0x076<br>,0x074,0x072,0x070,0x06E,0x06C,0x06A,0x068,0x066,0x064,0x062,0x060,0x05F,0x05D,0x05B,0x059,0x057<br>,0x056,0x054,0x052,0x051,0x04F,0x04D,0x04C,0x04A,0x048,0x047,0x045,0x044,0x042,0x040,0x03F,0x03D<br>,0x03C,0x03A,0x039,0x038,0x036,0x035,0x033,0x032,0x031,0x02F,0x02E,0x02D,0x02B,0x02A,0x029,0x028<br>,0x026,0x025,0x024,0x023,0x022,0x021,0x020,0x01E,0x01D,0x01C,0x01B,0x01A,0x019,0x018,0x017,0x016<br>,0x016,0x015,0x014,0x013,0x012,0x011,0x010,0x010,0x00F,0x00E,0x00D,0x00D,0x00C,0x00B,0x00B,0x00A<br>,0x009,0x009,0x008,0x008,0x007,0x007,0x006,0x006,0x005,0x005,0x004,0x004,0x003,0x003,0x003,0x002<br>,0x002,0x002,0x001,0x001,0x001,0x001,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000<br>,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x001,0x001,0x001,0x001,0x002<br>,0x002,0x002,0x003,0x003,0x003,0x004,0x004,0x005,0x005,0x006,0x006,0x007,0x007,0x008,0x008,0x009<br>,0x009,0x00A,0x00B,0x00B,0x00C,0x00D,0x00D,0x00E,0x00F,0x010,0x010,0x011,0x012,0x013,0x014,0x015<br>,0x016,0x016,0x017,0x018,0x019,0x01A,0x01B,0x01C,0x01D,0x01E,0x020,0x021,0x022,0x023,0x024,0x025<br>,0x026,0x028,0x029,0x02A,0x02B,0x02D,0x02E,0x02F,0x031,0x032,0x033,0x035,0x036,0x038,0x039,0x03A<br>,0x03C,0x03D,0x03F,0x040,0x042,0x044,0x045,0x047,0x048,0x04A,0x04C,0x04D,0x04F,0x051,0x052,0x054<br>,0x056,0x057,0x059,0x05B,0x05D,0x05F,0x060,0x062,0x064,0x066,0x068,0x06A,0x06C,0x06E,0x070,0x072<br>,0x074,0x076,0x078,0x07A,0x07C,0x07E,0x080,0x082,0x084,0x086,0x088,0x08A,0x08D,0x08F,0x091,0x093<br>,0x095,0x098,0x09A,0x09C,0x09E,0x0A1,0x0A3,0x0A5,0x0A8,0x0AA,0x0AC,0x0AF,0x0B1,0x0B3,0x0B6,0x0B8<br>,0x0BB,0x0BD,0x0BF,0x0C2,0x0C4,0x0C7,0x0C9,0x0CC,0x0CE,0x0D1,0x0D3,0x0D6,0x0D8,0x0DB,0x0DE,0x0E0<br>,0x0E3,0x0E5,0x0E8,0x0EB,0x0ED,0x0F0,0x0F3,0x0F5,0x0F8,0x0FB,0x0FD,0x100,0x103,0x106,0x108,0x10B<br>,0x10E,0x111,0x113,0x116,0x119,0x11C,0x11F,0x121,0x124,0x127,0x12A,0x12D,0x130,0x133,0x135,0x138<br>,0x13B,0x13E,0x141,0x144,0x147,0x14A,0x14D,0x150,0x153,0x156,0x159,0x15C,0x15F,0x162,0x165,0x168<br>,0x16B,0x16E,0x171,0x174,0x177,0x17A,0x17D,0x180,0x183,0x186,0x189,0x18C,0x18F,0x192,0x195,0x198<br>,0x19B,0x19E,0x1A1,0x1A4,0x1A8,0x1AB,0x1AE,0x1B1,0x1B4,0x1B7,0x1BA,0x1BD,0x1C0,0x1C4,0x1C7,0x1CA<br>,0x1CD,0x1D0,0x1D3,0x1D6,0x1D9,0x1DD,0x1E0,0x1E3,0x1E6,0x1E9,0x1EC,0x1EF,0x1F2,0x1F6,0x1F9,0x1FC};<br>void delay_us(unsigned char n)&#x2F;&#x2F;usçº§å»¶æ—¶å‡½æ•°<br>    {<br>         unsigned char i;<br>         for(i&#x3D;0;i&lt;n;i++);<br>    }<br>&#x2F;******************************************************************<br>    1.sclkçš„ä¸Šå‡æ²¿æ•°æ®è¿›å…¥è¾“å…¥å¯„å­˜å™¨<br>    2.åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSçš„ä¸Šå‡æ²¿æ•°æ®å¼€å§‹DAè½¬åŒ–<br>    3.è¿ç»­è¾“å…¥12ä½æ•°æ®ï¼Œé«˜ä½åœ¨å‰ï¼Œå…¶ä¸­å‰10ä½æœ‰æ•ˆï¼Œåä¸¤ä½è¡¥0<br>    ***************************************************************&#x2F;<br>void output(uint DA_Value)&#x2F;&#x2F;TLC5615é©±åŠ¨å‡½æ•°<br>    {<br>        unsigned char i;<br>        DA_Value&#x3D;DA_Value&lt;&lt;6;&#x2F;&#x2F;å°†DA_Valueå·¦ç§»6ä½ï¼Œå³nnnn nnnn nnnnå˜ä¸ºnnnn nnnn nn00 0000</p><pre><code>    SCLK=0;//ä¸ºä½ï¼Œå‡†å¤‡è¾“å…¥æ•°æ®    CS=0;//ç‰‡é€‰    for(i=12;i&gt;0;i--)//ä»é«˜ä½å¼€å§‹ï¼Œè¿ç»­å–å‡º12ä½æ•°æ®ï¼Œ        &#123;            if(DA_Value&amp;0x8000)//å’Œ1000 0000 0000 0000æ±‚ä¸ï¼Œè·å–æœ€é«˜ä½çš„å€¼ã€‚            DIN=1;            else            DIN=0;            SCLK=1;//ä¸Šå‡æ²¿ï¼Œè¿›å…¥è¾“å…¥å¯„å­˜å™¨            SCLK=0;//å‡†å¤‡ä¸‹ä¸€æ¬¡è¾“å…¥            DA_Value=DA_Value&lt;&lt;1;//å·¦ç§»1ä½ï¼Œå‡†å¤‡è¾“å…¥ä¸‹ä¸€ä½æ•°æ®        &#125;        CS=1;//åœ¨sclkä¸ºä½çš„æ—¶å€™ï¼ŒCSä¸Šå‡æ²¿ï¼Œæ•°æ®å¼€å§‹DAè½¬åŒ–&#125;</code></pre><p>void main()<br>{<br>   uint i;<br>   while(1)<br>        {<br>            i&#x3D;0;<br>            for(i&#x3D;0;i&lt;1023;i++)&#x2F;&#x2F;è¿ç»­å–å‡º1024ç‚¹æ­£å¼¦æ•°æ®<br>            output(sin1[i]);&#x2F;&#x2F;è¾“å‡ºæ­£å¼¦æ³¢</p><pre><code>&#125;</code></pre><p>   }&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œæºç "><a href="#ä»¿çœŸèµ„æºå’Œæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œæºç "></a>ä»¿çœŸèµ„æºå’Œæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1CjJ88b5ax5d9ScD6TNoysw </span><br><span class="line">æå–ç ï¼š0iij</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1CjJ88b5ax5d9ScD6TNoysw  æå–ç ï¼š0iij</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC15å•ç‰‡æœºå¯è®¾ç½®å€’è®¡æ—¶ï¼ˆ0~9999ï¼‰æŠ¥è­¦å™¨+Proteusä»¿çœŸ</title>
      <link href="/2024/03/Proteus-STC15%E5%8D%95%E7%89%87%E6%9C%BA%E5%8F%AF%E8%AE%BE%E7%BD%AE%E5%80%92%E8%AE%A1%E6%97%B609999%E6%8A%A5%E8%AD%A6%E5%99%A8Proteus%E4%BB%BF%E7%9C%9F/"/>
      <url>/2024/03/Proteus-STC15%E5%8D%95%E7%89%87%E6%9C%BA%E5%8F%AF%E8%AE%BE%E7%BD%AE%E5%80%92%E8%AE%A1%E6%97%B609999%E6%8A%A5%E8%AD%A6%E5%99%A8Proteus%E4%BB%BF%E7%9C%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC15å•ç‰‡æœºå¯è®¾ç½®å€’è®¡æ—¶ï¼ˆ0-9999ï¼‰æŠ¥è­¦å™¨-Proteusä»¿çœŸ"><a href="#STC15å•ç‰‡æœºå¯è®¾ç½®å€’è®¡æ—¶ï¼ˆ0-9999ï¼‰æŠ¥è­¦å™¨-Proteusä»¿çœŸ" class="headerlink" title="STC15å•ç‰‡æœºå¯è®¾ç½®å€’è®¡æ—¶ï¼ˆ0~9999ï¼‰æŠ¥è­¦å™¨+Proteusä»¿çœŸ"></a>STC15å•ç‰‡æœºå¯è®¾ç½®å€’è®¡æ—¶ï¼ˆ0~9999ï¼‰æŠ¥è­¦å™¨+Proteusä»¿çœŸ</h1><h3 id="STC15å•ç‰‡æœºå¯è®¾ç½®å€’è®¡æ—¶ï¼ˆ0-9999ï¼‰æŠ¥è­¦å™¨-Proteusä»¿çœŸ-1"><a href="#STC15å•ç‰‡æœºå¯è®¾ç½®å€’è®¡æ—¶ï¼ˆ0-9999ï¼‰æŠ¥è­¦å™¨-Proteusä»¿çœŸ-1" class="headerlink" title="STC15å•ç‰‡æœºå¯è®¾ç½®å€’è®¡æ—¶ï¼ˆ0~9999ï¼‰æŠ¥è­¦å™¨+Proteusä»¿çœŸ"></a>STC15å•ç‰‡æœºå¯è®¾ç½®å€’è®¡æ—¶ï¼ˆ0~9999ï¼‰æŠ¥è­¦å™¨+Proteusä»¿çœŸ</h3><ul><li>ğŸ“ºProteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/7cbcde4c609e487b820382f633141fdf.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><p>âœ¨2023-3-3 å†…å®¹æ›´æ–°ï¼š</p></li><li><p>ä¿®å¤åŸç¨‹åºbugï¼Œæ–°å¢æŒ‰é”®ï¼Œå¼•è„šå®šä¹‰åœ¨P34ï¼Œåœ¨è®¾å®šå€’è®¡æ—¶çš„æ—¶å€™ï¼Œå¯ä»¥å‡å°‘æ•°å€¼ã€‚</p></li><li><p>ä¿®å¤åŸç¨‹åºbugï¼Œæ–°å¢æŒ‰é”®ï¼Œå¼•è„šå®šä¹‰åœ¨P34ï¼Œåœ¨è®¾å®šå€’è®¡æ—¶çš„æ—¶å€™ï¼Œå¯ä»¥å‡å°‘æ•°å€¼ã€‚</p></li><li><p>ä»¿çœŸä¸­æ·»åŠ äº†ç»§ç”µå™¨ï¼Œåœ¨å€’è®¡æ—¶æ—¶å¼€å¯ï¼Œå€’è®¡æ—¶ç»“æŸå…³é—­ã€‚</p></li><li><p>ä»¿çœŸä¸­æ·»åŠ äº†ç»§ç”µå™¨ï¼Œåœ¨å€’è®¡æ—¶æ—¶å¼€å¯ï¼Œå€’è®¡æ—¶ç»“æŸå…³é—­ã€‚</p></li></ul><ol><li><p>ä¿®å¤åŸç¨‹åºbugï¼Œæ–°å¢æŒ‰é”®ï¼Œå¼•è„šå®šä¹‰åœ¨P34ï¼Œåœ¨è®¾å®šå€’è®¡æ—¶çš„æ—¶å€™ï¼Œå¯ä»¥å‡å°‘æ•°å€¼ã€‚</p></li><li><p>ä»¿çœŸä¸­æ·»åŠ äº†ç»§ç”µå™¨ï¼Œåœ¨å€’è®¡æ—¶æ—¶å¼€å¯ï¼Œå€’è®¡æ—¶ç»“æŸå…³é—­ã€‚</p></li></ol><p><img src="https://img-blog.csdnimg.cn/8f567839b71b4a8d827c2b8a2c2195aa.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“ç¨‹åºä»£ç "><a href="#ğŸ“ç¨‹åºä»£ç " class="headerlink" title="ğŸ“ç¨‹åºä»£ç "></a>ğŸ“ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br></pre></td><td class="code"><pre><span class="line">/*------------------------------------------------------------------*/</span><br><span class="line">/* --- STC MCU International Limited -------------------------------*/</span><br><span class="line">/* --- STC 1T Series MCU RC Demo -----------------------------------*/</span><br><span class="line">/* --- Mobile: (86)13922805190 -------------------------------------*/</span><br><span class="line">/* --- Fax: 86-0513-55012956,55012947,55012969 ---------------------*/</span><br><span class="line">/* --- Tel: 86-0513-55012928,55012929,55012966 ---------------------*/</span><br><span class="line">/* --- Web: www.GXWMCU.com -----------------------------------------*/</span><br><span class="line">/* --- QQ:  800003751 ----------------------------------------------*/</span><br><span class="line">/* If you want to use the program or the program referenced in the  */</span><br><span class="line">/* article, please specify in which data and procedures from STC    */</span><br><span class="line">/*------------------------------------------------------------------*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#include&quot;config.h&quot;</span><br><span class="line">#include&quot;GPIO.h&quot;</span><br><span class="line">#include&quot;delay.h&quot;</span><br><span class="line"></span><br><span class="line">/*************åŠŸèƒ½è¯´æ˜**************</span><br><span class="line"></span><br><span class="line">æœ¬ç¨‹åºæ¼”ç¤ºè·‘é©¬ç¯ã€‚</span><br><span class="line">ç¨‹åºä½¿ç”¨P2å£æ¥æ¼”ç¤ºï¼Œè¾“å‡ºä½é©±åŠ¨ã€‚ç”¨æˆ·å¯ä»¥ä¿®æ”¹ä¸ºåˆ«çš„å£ã€‚</span><br><span class="line"></span><br><span class="line">******************************************/</span><br><span class="line"></span><br><span class="line">/*************æœ¬åœ°å¸¸é‡å£°æ˜**************/</span><br><span class="line">#define u8 unsigned char</span><br><span class="line">#define u16 unsigned int</span><br><span class="line">#define u32 unsigned long</span><br><span class="line">#define s8 signed char</span><br><span class="line">#define s16 signed int</span><br><span class="line">#define s32 signed long</span><br><span class="line">#define KEY_TIME 25                        //æŒ‰é”®æ¶ˆæŠ–æ—¶é—´ (æ¯«ç§’)</span><br><span class="line">#define reset()        IAP_CONTR |= 0x20                //èŠ¯ç‰‡å¤ä½</span><br><span class="line">#define feed_dog()  WDT_CONTR |= 0x10   //çœ‹é—¨ç‹—å–‚ç‹—</span><br><span class="line">u8 code nbr[16] = &#123;                //å…±é˜´æ•°ç ç®¡æ®µç 16è¿›åˆ¶</span><br><span class="line">    0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71</span><br><span class="line">&#125;;</span><br><span class="line">u8 show[4];                //4ä½æ•°ç ç®¡å½“å‰æ˜¾ç¤ºçš„æ®µç  æ›´æ”¹æ•°ç ç®¡æ˜¾ç¤ºçš„æ®µç  åªéœ€æ›´æ”¹æ­¤æ•°ç»„</span><br><span class="line">u8 wink;                //é—ªçƒçš„æ•°ç ç®¡æ®µç         0x01: ç¬¬ä¸€ä½é—ªçƒ 0x02:ç¬¬äºŒä½é—ªçƒ 0x04: ç¬¬ä¸‰ä½é—ªçƒ 0x0F:å…¨é—ªçƒ 0x00:å…¨ä¸é—ªçƒ</span><br><span class="line"></span><br><span class="line">sbit P3_0 = P3 ^ 0;                //æŒ‰é”®S1 (I/Oå£å®šä¹‰çš„æŒ‰é”®æœªç»æ¶ˆæŠ–,è¯·å‹¿åœ¨ä¸­æ–­å¤–ç›´æ¥ä½¿ç”¨)</span><br><span class="line">sbit P3_1 = P3 ^ 1;                //æŒ‰é”®S2</span><br><span class="line">sbit P3_2 = P3 ^ 2;     //æœ‰æºèœ‚é¸£å™¨ ä½ç”µå¹³é¸£å«</span><br><span class="line">sbit P3_3 = P3 ^ 3;     //ç»§ç”µå™¨æˆ–MOSç®¡ ä½ç”µå¹³å¸åˆ(å¯¼é€š)</span><br><span class="line">u16 S1_ms, S2_ms;                //æŒ‰é”®0ã€æŒ‰é”®1è¿ç»­æŒ‰ä¸‹çš„æ—¶é—´ å®šæ—¶å™¨ä¸­æ–­è®¡æ•°æ­¤å˜é‡ æœ€é•¿65535æ¯«ç§’ æ¾å¼€æ¸…é›¶</span><br><span class="line"></span><br><span class="line">u16 delayms;  //å®šæ—¶å™¨ä¸­æ–­å»¶æ—¶ (æ¯«ç§’)</span><br><span class="line">u16 time;      //å®šæ—¶æ—¶é—´ (ç§’)</span><br><span class="line">u16 beep_ms;   //èœ‚é¸£å™¨é¸£å«æ—¶é—´ (æ¯«ç§’)</span><br><span class="line"></span><br><span class="line">u16 bdata Bit16 = 0;    //å®šä¹‰16ä½å¯ä½å¯»å€å˜é‡</span><br><span class="line">sbit delay = Bit16 ^ 0;      //å®šæ—¶å™¨ä¸­æ–­å»¶æ—¶æ¯«ç§’å¼€å…³ ä¸­æ–­å¤–ç½®1 å»¶æ—¶å®Œä¸­æ–­å†…æ¸…0</span><br><span class="line">sbit test = Bit16 ^ 1;       //æ­¤å€¼ä¸º1æ•°ç ç®¡å…¨äº® èœ‚é¸£å™¨å“ æ‰€æœ‰æŒ‰é”®æ— æ•ˆ å¦åˆ™æ­£å¸¸</span><br><span class="line">sbit S1 = Bit16 ^ 2;         //æŒ‰é”®0 è¿ç»­æŒ‰ä¸‹Næ¯«ç§’æ¸…0, æ¾å¼€ç½®1(å®šæ—¶å™¨0ä¸­æ–­æ¶ˆæŠ–)</span><br><span class="line">sbit S2 = Bit16 ^ 3;         //æŒ‰é”®1 (å¤„ç†æ–¹å¼ä¸æŒ‰é”®0ç›¸åŒ)</span><br><span class="line">sbit hz10 = Bit16 ^ 4;      //10Hzä¿¡å·æº (å®šæ—¶å™¨0ä¸­æ–­äº§ç”Ÿ,ç”¨äºæ§åˆ¶æ•°ç ç®¡é—ªçƒ)</span><br><span class="line">sbit bak = Bit16 ^ 5;       //æŒ‰é”®é•¿æŒ‰è¯†åˆ«å¤„ç†ç”¨</span><br><span class="line">sbit Beep = Bit16 ^ 6;      //æœ‰æºèœ‚é¸£å™¨ ä½ç”µå¹³å“</span><br><span class="line">sbit start = Bit16 ^ 7;     //å€’è®¡æ—¶å¼€å…³ ç½®1å€’è®¡æ—¶å¼€å§‹ æ¸…0åˆ™ç»“æŸ</span><br><span class="line">sbit pause = Bit16 ^ 8;     //1æš‚åœå€’è®¡æ—¶ 0æ­£å¸¸</span><br><span class="line">sbit relay = Bit16 ^ 9;     //ç»§ç”µå™¨æˆ–MOSç®¡ ä½ç”µå¹³å¸åˆ(å¯¼é€š) 1ç§’åªèƒ½å¸åˆæˆ–é‡Šæ”¾1æ¬¡</span><br><span class="line"></span><br><span class="line">/*************æœ¬åœ°å˜é‡å£°æ˜**************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*************æœ¬åœ°å‡½æ•°å£°æ˜**************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*************  å¤–éƒ¨å‡½æ•°å’Œå˜é‡å£°æ˜ *****************/</span><br><span class="line">void InitTimer0() &#123;        //åˆå§‹åŒ–å®šæ—¶å™¨0ä¸­æ–­</span><br><span class="line">    TMOD = 0x01;</span><br><span class="line">    TH0 = 0xFC;</span><br><span class="line">    TL0 = 0x18;</span><br><span class="line">    EA = 1;</span><br><span class="line">    ET0 = 1;</span><br><span class="line">    TR0 = 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void beep(u16 ms) &#123;     //èœ‚é¸£å™¨é¸£å« å‚æ•°:é¸£å«æ¯«ç§’</span><br><span class="line">    beep_ms = ms;</span><br><span class="line">    Beep = 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u16 set_time() &#123;        //è®¾å®šå®šæ—¶æ—¶é—´</span><br><span class="line">    u8 n = 0;       //0:ç¼–è¾‘åƒä½ 1:ç™¾ä½ 2:åä½ 3:ä¸ªä½</span><br><span class="line">    u8 o[4];</span><br><span class="line">    o[0] = 0; o[1] = 0; o[2] = 0; o[3] = 0;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        feed_dog();</span><br><span class="line">        wink = 8 &gt;&gt; n;</span><br><span class="line">        show[0] = nbr[o[0]];</span><br><span class="line">        show[1] = nbr[o[1]];</span><br><span class="line">        show[2] = nbr[o[2]];</span><br><span class="line">        show[3] = nbr[o[3]];</span><br><span class="line">        if (S2 == 0) &#123;                        //S2æŒ‰ä¸‹ çŸ­æŒ‰åŠ 1</span><br><span class="line">            beep(50);</span><br><span class="line">            if (o[n]++ &gt;= 9) o[n] = 0;</span><br><span class="line">            show[n] = nbr[o[n]];</span><br><span class="line">            delayms = 500; delay = 1;</span><br><span class="line">            while (delay &amp;&amp; S2 == 0);        //é•¿æŒ‰å»¶æ—¶ç­‰å¾…</span><br><span class="line">            while (S2_ms &gt;= 500) &#123;                //æŒ‰é”®é•¿æŒ‰,å¼€å§‹è¿åŠ </span><br><span class="line">                feed_dog();</span><br><span class="line">                delayms = 125; delay = 1;                //0.125ç§’è¿åŠ ä¸€æ¬¡</span><br><span class="line">                while (delay &amp;&amp; S2 == 0);</span><br><span class="line">                beep(50);</span><br><span class="line">                if (o[n]++ &gt;= 9) o[n] = 0;</span><br><span class="line">                show[n] = nbr[o[n]];</span><br><span class="line">            &#125;</span><br><span class="line">            delay = 0;</span><br><span class="line">            delayms = 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (S1 == 0) &#123;                //S1æŒ‰ä¸‹</span><br><span class="line">            beep(50);</span><br><span class="line">            n++;                //è¾“å…¥ä¸‹ä¸€ä½</span><br><span class="line">            while (S1 == 0) &#123;</span><br><span class="line">                feed_dog();</span><br><span class="line">                if (S1_ms &gt;= 1000 &amp;&amp; !bak) &#123;                //é•¿æŒ‰é€€å›ç¼–è¾‘</span><br><span class="line">                    beep(50);</span><br><span class="line">                    n = 0;</span><br><span class="line">                    wink = 8 &gt;&gt; n;</span><br><span class="line">                    show[0] = nbr[o[0]];</span><br><span class="line">                    show[1] = nbr[o[1]];</span><br><span class="line">                    show[2] = nbr[o[2]];</span><br><span class="line">                    show[3] = nbr[o[3]];</span><br><span class="line">                    bak = 1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (bak) &#123;</span><br><span class="line">                bak = 0;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (n &gt;= 4) &#123;                //ä¸ªä½è¾“å…¥å®Œæˆ</span><br><span class="line">                wink = 0;</span><br><span class="line">                return o[0] * 1000 + o[1] * 100 + o[2] * 10 + o[3];</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">//    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/******************** IOé…ç½®å‡½æ•° **************************/</span><br><span class="line">voidGPIO_config(void)</span><br><span class="line">&#123;</span><br><span class="line">GPIO_InitTypeDefGPIO_InitStructure;//ç»“æ„å®šä¹‰</span><br><span class="line">GPIO_InitStructure.Pin  = GPIO_Pin_All;//æŒ‡å®šè¦åˆå§‹åŒ–çš„IO, GPIO_Pin_0 ~ GPIO_Pin_7, æˆ–æ“ä½œ</span><br><span class="line">GPIO_InitStructure.Mode = GPIO_OUT_PP;//æŒ‡å®šIOçš„è¾“å…¥æˆ–è¾“å‡ºæ–¹å¼,GPIO_PullUp,GPIO_HighZ,GPIO_OUT_OD,GPIO_OUT_PP</span><br><span class="line">GPIO_Inilize(GPIO_P2,&amp;GPIO_InitStructure);//åˆå§‹åŒ–</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/******************** ä¸»å‡½æ•° **************************/</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"> u8 i = 0;</span><br><span class="line">    Beep = 1;</span><br><span class="line">    WDT_CONTR = 0x27;           //åˆå§‹åŒ–çœ‹é—¨ç‹—</span><br><span class="line">    P1M0 = 0x0F; P1M1 = 0x00;   //P1.0~P1.3å¼ºæ¨æŒ½</span><br><span class="line">    P2M0 = 0xFF; P2M1 = 0x00;   //P2.0~P2.7å¼ºæ¨æŒ½</span><br><span class="line">    //ä¸Šç”µ1ç§’æ•°ç ç®¡å…¨äº® èœ‚é¸£å™¨å“</span><br><span class="line">    test = 1;</span><br><span class="line">GPIO_config();</span><br><span class="line">    InitTimer0();</span><br><span class="line">    delayms = 1000; delay = 1;</span><br><span class="line">    while (delay);</span><br><span class="line">    test = 0;</span><br><span class="line"></span><br><span class="line">    show[0] = nbr[0];</span><br><span class="line">    show[1] = nbr[0];</span><br><span class="line">    show[2] = nbr[0];</span><br><span class="line">    show[3] = nbr[0];</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">relay = 1;</span><br><span class="line">        pause = 0;</span><br><span class="line">        do &#123;        //æ—¶é—´è®¾å®š</span><br><span class="line">            time = set_time();</span><br><span class="line">        &#125; while (!time);</span><br><span class="line">        time -= 1;</span><br><span class="line">        start = 1;</span><br><span class="line">        relay = 0;</span><br><span class="line">        while (start) &#123;</span><br><span class="line">            feed_dog();</span><br><span class="line">            if (S1 == 0) &#123;      //S1æŒ‰ä¸‹èœ‚é¸£å™¨å“1ä¸‹</span><br><span class="line">                beep(50);</span><br><span class="line">                while (S1 == 0) &#123;</span><br><span class="line">                    feed_dog();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (S2 == 0) &#123;      //S2æŒ‰ä¸‹æš‚åœå€’è®¡æ—¶</span><br><span class="line">                beep(50);</span><br><span class="line">                pause = !pause;</span><br><span class="line">                relay = pause;</span><br><span class="line">                while (S2 == 0) &#123;</span><br><span class="line">                    feed_dog();</span><br><span class="line">                    if (pause &amp;&amp; S2_ms &gt;= 3000) &#123;       //é•¿æŒ‰3ç§’å¤ä½</span><br><span class="line">                        _nop_(); _nop_(); _nop_(); _nop_();</span><br><span class="line">                        reset();</span><br><span class="line">                        _nop_(); _nop_(); _nop_(); _nop_();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        //å€’è®¡æ—¶ç»“æŸ</span><br><span class="line">        show[0] = 0x79;     //E</span><br><span class="line">        show[1] = 0x54;     //n</span><br><span class="line">        show[2] = 0x5E;     //d</span><br><span class="line">        show[3] = 0x00;</span><br><span class="line">        for (i = 0; i &lt; 6; i++) &#123;       //èœ‚é¸£å™¨å“6ä¸‹</span><br><span class="line">            delayms = 500; delay = 1; while (delay);</span><br><span class="line">            beep(500);</span><br><span class="line">            while (!Beep);</span><br><span class="line">            feed_dog();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        while (1) &#123;</span><br><span class="line">            feed_dog();</span><br><span class="line">            if (S1 == 0 || S2 == 0) &#123;</span><br><span class="line">                beep(50);</span><br><span class="line">                while (S1 == 0 || S2 == 0) &#123;</span><br><span class="line">                    feed_dog();</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Timer0Interrupt() interrupt 1&#123;         //12Mhz 1mSå®šæ—¶å™¨ä¸­æ–­</span><br><span class="line">    static u8 seg = 0;  //å½“å‰æ­£åœ¨æ‰«æçš„æ•°ç ç®¡æ®µç  4ä½æ•°ç ç®¡ èŒƒå›´:0~3</span><br><span class="line">    static u8 ms1 = 0;</span><br><span class="line">    static u16 ms = 0, ms2 = 0;</span><br><span class="line">    TH0 = 0xFC;</span><br><span class="line">    TL0 = 0x18;</span><br><span class="line">    if (delay &amp;&amp; !--delayms) &#123;    //å»¶æ—¶ä»»æ„æ¯«ç§’</span><br><span class="line">        delay = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    //æ•°ç ç®¡åŠ¨æ€æ‰«æå¤„ç†</span><br><span class="line">    P1 |= 0xF;          //æ¶ˆå½±</span><br><span class="line">    P2 = test ? 0xFF : (wink &amp; (1 &lt;&lt; (3 ^ seg)) &amp;&amp; !hz10 ? 0 : show[seg]);      //æ®µç </span><br><span class="line">    P1 &amp;= ~(1 &lt;&lt; seg);   //ä½ç </span><br><span class="line">    if (++seg &gt;= 4) seg = 0;</span><br><span class="line"></span><br><span class="line">    if (test) &#123;     //æµ‹è¯•æ¨¡å¼</span><br><span class="line">        S1 = 1; S2 = 1;</span><br><span class="line">        P3_2 = 0;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //èœ‚é¸£å™¨å¤„ç†</span><br><span class="line">    P3_2 = Beep;</span><br><span class="line">    if (!Beep &amp;&amp; !--beep_ms) &#123;</span><br><span class="line">        Beep = 1;</span><br><span class="line">    &#125;</span><br><span class="line">    if (++ms1 &gt;= 50) &#123;</span><br><span class="line">        ms1 = 0;</span><br><span class="line">        hz10 = !hz10;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //æŒ‰é”®å¤„ç†</span><br><span class="line">    if (P3_0 == 0) &#123;</span><br><span class="line">        if (S1_ms != 0xFFFF) S1_ms++;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        S1_ms = 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (P3_1 == 0) &#123;</span><br><span class="line">        if (S2_ms != 0xFFFF) S2_ms++;</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        S2_ms = 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    S1 = !(S1_ms &gt;= KEY_TIME);</span><br><span class="line">    S2 = !(S2_ms &gt;= KEY_TIME);</span><br><span class="line">    //ç»§ç”µå™¨å¤„ç†</span><br><span class="line">    if (++ms2 &gt;= 1000) &#123;    //ç»§ç”µå™¨1ç§’åªèƒ½è¿›è¡Œ1æ¬¡å¸åˆæˆ–é‡Šæ”¾ï¼Œé˜²æ­¢é¢‘ç¹å¼€å…³å¯¼è‡´è®¾å¤‡æŸå</span><br><span class="line">        ms2 = 0;</span><br><span class="line">        P3_3 = relay;</span><br><span class="line">    &#125;</span><br><span class="line">    //æ—¶é—´å€’è®¡æ—¶å¤„ç†</span><br><span class="line">    if (start) &#123;</span><br><span class="line">        if (pause) &#123;</span><br><span class="line">            wink = 0xF;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            wink = 0;</span><br><span class="line">            if (++ms &gt;= 1000) &#123;</span><br><span class="line">                ms = 0;</span><br><span class="line">                show[0] = nbr[time / 1000 % 10];</span><br><span class="line">                show[1] = nbr[time / 100 % 10];</span><br><span class="line">                show[2] = nbr[time / 10 % 10];</span><br><span class="line">                show[3] = nbr[time % 10];</span><br><span class="line"></span><br><span class="line">                if (!time--) &#123;      //å€’è®¡æ—¶ç»“æŸ</span><br><span class="line">                    start = 0;</span><br><span class="line">                    relay = 1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>&#x2F;* â€” STC MCU International Limited â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-<em>&#x2F;<br>&#x2F;</em> â€” STC 1T Series MCU RC Demo â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<em>&#x2F;<br>&#x2F;</em> â€” Mobile: (86)13922805190 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-<em>&#x2F;<br>&#x2F;</em> â€” Fax: 86-0513-55012956,55012947,55012969 â€”â€”â€”â€”â€”â€”â€”<em>&#x2F;<br>&#x2F;</em> â€” Tel: 86-0513-55012928,55012929,55012966 â€”â€”â€”â€”â€”â€”â€”<em>&#x2F;<br>&#x2F;</em> â€” Web: <a href="http://www.gxwmcu.com/">www.GXWMCU.com</a> â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<em>&#x2F;<br>&#x2F;</em> â€” QQ:  800003751 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-<em>&#x2F;<br>&#x2F;</em> If you want to use the program or the program referenced in the  <em>&#x2F;<br>&#x2F;</em> article, please specify in which data and procedures from STC    <em>&#x2F;<br>&#x2F;</em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*&#x2F;</p><p>#includeâ€œconfig.hâ€<br>#includeâ€œGPIO.hâ€<br>#includeâ€œdelay.hâ€</p><p>&#x2F;*************åŠŸèƒ½è¯´æ˜**************</p><p>æœ¬ç¨‹åºæ¼”ç¤ºè·‘é©¬ç¯ã€‚<br>ç¨‹åºä½¿ç”¨P2å£æ¥æ¼”ç¤ºï¼Œè¾“å‡ºä½é©±åŠ¨ã€‚ç”¨æˆ·å¯ä»¥ä¿®æ”¹ä¸ºåˆ«çš„å£ã€‚</p><p>******************************************&#x2F;</p><p>&#x2F;*************æœ¬åœ°å¸¸é‡å£°æ˜**************&#x2F;<br>#define u8 unsigned char<br>#define u16 unsigned int<br>#define u32 unsigned long<br>#define s8 signed char<br>#define s16 signed int<br>#define s32 signed long<br>#define KEY_TIME 25                        &#x2F;&#x2F;æŒ‰é”®æ¶ˆæŠ–æ—¶é—´ (æ¯«ç§’)<br>#define reset()        IAP_CONTR |&#x3D; 0x20                &#x2F;&#x2F;èŠ¯ç‰‡å¤ä½<br>#define feed_dog()  WDT_CONTR |&#x3D; 0x10   &#x2F;&#x2F;çœ‹é—¨ç‹—å–‚ç‹—<br>u8 code nbr[16] &#x3D; {                &#x2F;&#x2F;å…±é˜´æ•°ç ç®¡æ®µç 16è¿›åˆ¶<br>    0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71<br>};<br>u8 show[4];                &#x2F;&#x2F;4ä½æ•°ç ç®¡å½“å‰æ˜¾ç¤ºçš„æ®µç  æ›´æ”¹æ•°ç ç®¡æ˜¾ç¤ºçš„æ®µç  åªéœ€æ›´æ”¹æ­¤æ•°ç»„<br>u8 wink;                &#x2F;&#x2F;é—ªçƒçš„æ•°ç ç®¡æ®µç         0x01: ç¬¬ä¸€ä½é—ªçƒ 0x02:ç¬¬äºŒä½é—ªçƒ 0x04: ç¬¬ä¸‰ä½é—ªçƒ 0x0F:å…¨é—ªçƒ 0x00:å…¨ä¸é—ªçƒ</p><p>sbit P3_0 &#x3D; P3 ^ 0;                &#x2F;&#x2F;æŒ‰é”®S1 (I&#x2F;Oå£å®šä¹‰çš„æŒ‰é”®æœªç»æ¶ˆæŠ–,è¯·å‹¿åœ¨ä¸­æ–­å¤–ç›´æ¥ä½¿ç”¨)<br>sbit P3_1 &#x3D; P3 ^ 1;                &#x2F;&#x2F;æŒ‰é”®S2<br>sbit P3_2 &#x3D; P3 ^ 2;     &#x2F;&#x2F;æœ‰æºèœ‚é¸£å™¨ ä½ç”µå¹³é¸£å«<br>sbit P3_3 &#x3D; P3 ^ 3;     &#x2F;&#x2F;ç»§ç”µå™¨æˆ–MOSç®¡ ä½ç”µå¹³å¸åˆ(å¯¼é€š)<br>u16 S1_ms, S2_ms;                &#x2F;&#x2F;æŒ‰é”®0ã€æŒ‰é”®1è¿ç»­æŒ‰ä¸‹çš„æ—¶é—´ å®šæ—¶å™¨ä¸­æ–­è®¡æ•°æ­¤å˜é‡ æœ€é•¿65535æ¯«ç§’ æ¾å¼€æ¸…é›¶</p><p>u16 delayms;  &#x2F;&#x2F;å®šæ—¶å™¨ä¸­æ–­å»¶æ—¶ (æ¯«ç§’)<br>u16 time;      &#x2F;&#x2F;å®šæ—¶æ—¶é—´ (ç§’)<br>u16 beep_ms;   &#x2F;&#x2F;èœ‚é¸£å™¨é¸£å«æ—¶é—´ (æ¯«ç§’)</p><p>u16 bdata Bit16 &#x3D; 0;    &#x2F;&#x2F;å®šä¹‰16ä½å¯ä½å¯»å€å˜é‡<br>sbit delay &#x3D; Bit16 ^ 0;      &#x2F;&#x2F;å®šæ—¶å™¨ä¸­æ–­å»¶æ—¶æ¯«ç§’å¼€å…³ ä¸­æ–­å¤–ç½®1 å»¶æ—¶å®Œä¸­æ–­å†…æ¸…0<br>sbit test &#x3D; Bit16 ^ 1;       &#x2F;&#x2F;æ­¤å€¼ä¸º1æ•°ç ç®¡å…¨äº® èœ‚é¸£å™¨å“ æ‰€æœ‰æŒ‰é”®æ— æ•ˆ å¦åˆ™æ­£å¸¸<br>sbit S1 &#x3D; Bit16 ^ 2;         &#x2F;&#x2F;æŒ‰é”®0 è¿ç»­æŒ‰ä¸‹Næ¯«ç§’æ¸…0, æ¾å¼€ç½®1(å®šæ—¶å™¨0ä¸­æ–­æ¶ˆæŠ–)<br>sbit S2 &#x3D; Bit16 ^ 3;         &#x2F;&#x2F;æŒ‰é”®1 (å¤„ç†æ–¹å¼ä¸æŒ‰é”®0ç›¸åŒ)<br>sbit hz10 &#x3D; Bit16 ^ 4;      &#x2F;&#x2F;10Hzä¿¡å·æº (å®šæ—¶å™¨0ä¸­æ–­äº§ç”Ÿ,ç”¨äºæ§åˆ¶æ•°ç ç®¡é—ªçƒ)<br>sbit bak &#x3D; Bit16 ^ 5;       &#x2F;&#x2F;æŒ‰é”®é•¿æŒ‰è¯†åˆ«å¤„ç†ç”¨<br>sbit Beep &#x3D; Bit16 ^ 6;      &#x2F;&#x2F;æœ‰æºèœ‚é¸£å™¨ ä½ç”µå¹³å“<br>sbit start &#x3D; Bit16 ^ 7;     &#x2F;&#x2F;å€’è®¡æ—¶å¼€å…³ ç½®1å€’è®¡æ—¶å¼€å§‹ æ¸…0åˆ™ç»“æŸ<br>sbit pause &#x3D; Bit16 ^ 8;     &#x2F;&#x2F;1æš‚åœå€’è®¡æ—¶ 0æ­£å¸¸<br>sbit relay &#x3D; Bit16 ^ 9;     &#x2F;&#x2F;ç»§ç”µå™¨æˆ–MOSç®¡ ä½ç”µå¹³å¸åˆ(å¯¼é€š) 1ç§’åªèƒ½å¸åˆæˆ–é‡Šæ”¾1æ¬¡</p><p>&#x2F;*************æœ¬åœ°å˜é‡å£°æ˜**************&#x2F;</p><p>&#x2F;*************æœ¬åœ°å‡½æ•°å£°æ˜**************&#x2F;</p><p>&#x2F;*************  å¤–éƒ¨å‡½æ•°å’Œå˜é‡å£°æ˜ *****************&#x2F;<br>void InitTimer0() {        &#x2F;&#x2F;åˆå§‹åŒ–å®šæ—¶å™¨0ä¸­æ–­<br>    TMOD &#x3D; 0x01;<br>    TH0 &#x3D; 0xFC;<br>    TL0 &#x3D; 0x18;<br>    EA &#x3D; 1;<br>    ET0 &#x3D; 1;<br>    TR0 &#x3D; 1;<br>}</p><p>void beep(u16 ms) {     &#x2F;&#x2F;èœ‚é¸£å™¨é¸£å« å‚æ•°:é¸£å«æ¯«ç§’<br>    beep_ms &#x3D; ms;<br>    Beep &#x3D; 0;<br>}</p><p>u16 set_time() {        &#x2F;&#x2F;è®¾å®šå®šæ—¶æ—¶é—´<br>    u8 n &#x3D; 0;       &#x2F;&#x2F;0:ç¼–è¾‘åƒä½ 1:ç™¾ä½ 2:åä½ 3:ä¸ªä½<br>    u8 o[4];<br>    o[0] &#x3D; 0; o[1] &#x3D; 0; o[2] &#x3D; 0; o[3] &#x3D; 0;<br>    while (1) {<br>        feed_dog();<br>        wink &#x3D; 8 &gt;&gt; n;<br>        show[0] &#x3D; nbr[o[0]];<br>        show[1] &#x3D; nbr[o[1]];<br>        show[2] &#x3D; nbr[o[2]];<br>        show[3] &#x3D; nbr[o[3]];<br>        if (S2 &#x3D;&#x3D; 0) {                        &#x2F;&#x2F;S2æŒ‰ä¸‹ çŸ­æŒ‰åŠ 1<br>            beep(50);<br>            if (o[n]++ &gt;&#x3D; 9) o[n] &#x3D; 0;<br>            show[n] &#x3D; nbr[o[n]];<br>            delayms &#x3D; 500; delay &#x3D; 1;<br>            while (delay &amp;&amp; S2 &#x3D;&#x3D; 0);        &#x2F;&#x2F;é•¿æŒ‰å»¶æ—¶ç­‰å¾…<br>            while (S2_ms &gt;&#x3D; 500) {                &#x2F;&#x2F;æŒ‰é”®é•¿æŒ‰,å¼€å§‹è¿åŠ <br>                feed_dog();<br>                delayms &#x3D; 125; delay &#x3D; 1;                &#x2F;&#x2F;0.125ç§’è¿åŠ ä¸€æ¬¡<br>                while (delay &amp;&amp; S2 &#x3D;&#x3D; 0);<br>                beep(50);<br>                if (o[n]++ &gt;&#x3D; 9) o[n] &#x3D; 0;<br>                show[n] &#x3D; nbr[o[n]];<br>            }<br>            delay &#x3D; 0;<br>            delayms &#x3D; 0;<br>        }</p><pre><code>    if (S1 == 0) &#123;                //S1æŒ‰ä¸‹        beep(50);        n++;                //è¾“å…¥ä¸‹ä¸€ä½        while (S1 == 0) &#123;            feed_dog();            if (S1_ms &gt;= 1000 &amp;&amp; !bak) &#123;                //é•¿æŒ‰é€€å›ç¼–è¾‘                beep(50);                n = 0;                wink = 8 &gt;&gt; n;                show[0] = nbr[o[0]];                show[1] = nbr[o[1]];                show[2] = nbr[o[2]];                show[3] = nbr[o[3]];                bak = 1;            &#125;        &#125;        if (bak) &#123;            bak = 0;            continue;        &#125;        if (n &gt;= 4) &#123;                //ä¸ªä½è¾“å…¥å®Œæˆ            wink = 0;            return o[0] * 1000 + o[1] * 100 + o[2] * 10 + o[3];        &#125;    &#125;&#125;</code></pre><p>&#x2F;&#x2F;    return 0;<br>}</p><p>&#x2F;******************** IOé…ç½®å‡½æ•° **************************&#x2F;<br>voidGPIO_config(void)<br>{<br>    GPIO_InitTypeDefGPIO_InitStructure;&#x2F;&#x2F;ç»“æ„å®šä¹‰<br>    GPIO_InitStructure.Pin  &#x3D; GPIO_Pin_All;&#x2F;&#x2F;æŒ‡å®šè¦åˆå§‹åŒ–çš„IO, GPIO_Pin_0 ~ GPIO_Pin_7, æˆ–æ“ä½œ<br>    GPIO_InitStructure.Mode &#x3D; GPIO_OUT_PP;&#x2F;&#x2F;æŒ‡å®šIOçš„è¾“å…¥æˆ–è¾“å‡ºæ–¹å¼,GPIO_PullUp,GPIO_HighZ,GPIO_OUT_OD,GPIO_OUT_PP<br>    GPIO_Inilize(GPIO_P2,&amp;GPIO_InitStructure);&#x2F;&#x2F;åˆå§‹åŒ–<br>}</p><p>&#x2F;******************** ä¸»å‡½æ•° **************************&#x2F;<br>void main(void)<br>{<br>     u8 i &#x3D; 0;<br>    Beep &#x3D; 1;<br>    WDT_CONTR &#x3D; 0x27;           &#x2F;&#x2F;åˆå§‹åŒ–çœ‹é—¨ç‹—<br>    P1M0 &#x3D; 0x0F; P1M1 &#x3D; 0x00;   &#x2F;&#x2F;P1.0<del>P1.3å¼ºæ¨æŒ½<br>    P2M0 &#x3D; 0xFF; P2M1 &#x3D; 0x00;   &#x2F;&#x2F;P2.0</del>P2.7å¼ºæ¨æŒ½<br>    &#x2F;&#x2F;ä¸Šç”µ1ç§’æ•°ç ç®¡å…¨äº® èœ‚é¸£å™¨å“<br>    test &#x3D; 1;<br>        GPIO_config();<br>    InitTimer0();<br>    delayms &#x3D; 1000; delay &#x3D; 1;<br>    while (delay);<br>    test &#x3D; 0;</p><pre><code>show[0] = nbr[0];show[1] = nbr[0];show[2] = nbr[0];show[3] = nbr[0];while(1)&#123;</code></pre><p>relay &#x3D; 1;<br>        pause &#x3D; 0;<br>        do {        &#x2F;&#x2F;æ—¶é—´è®¾å®š<br>            time &#x3D; set_time();<br>        } while (!time);<br>        time -&#x3D; 1;<br>        start &#x3D; 1;<br>        relay &#x3D; 0;<br>        while (start) {<br>            feed_dog();<br>            if (S1 &#x3D;&#x3D; 0) {      &#x2F;&#x2F;S1æŒ‰ä¸‹èœ‚é¸£å™¨å“1ä¸‹<br>                beep(50);<br>                while (S1 &#x3D;&#x3D; 0) {<br>                    feed_dog();<br>                }<br>            }</p><pre><code>        if (S2 == 0) &#123;      //S2æŒ‰ä¸‹æš‚åœå€’è®¡æ—¶            beep(50);            pause = !pause;            relay = pause;            while (S2 == 0) &#123;                feed_dog();                if (pause &amp;&amp; S2_ms &gt;= 3000) &#123;       //é•¿æŒ‰3ç§’å¤ä½                    _nop_(); _nop_(); _nop_(); _nop_();                    reset();                    _nop_(); _nop_(); _nop_(); _nop_();                &#125;            &#125;        &#125;    &#125;    //å€’è®¡æ—¶ç»“æŸ    show[0] = 0x79;     //E    show[1] = 0x54;     //n    show[2] = 0x5E;     //d    show[3] = 0x00;    for (i = 0; i &lt; 6; i++) &#123;       //èœ‚é¸£å™¨å“6ä¸‹        delayms = 500; delay = 1; while (delay);        beep(500);        while (!Beep);        feed_dog();    &#125;    while (1) &#123;        feed_dog();        if (S1 == 0 || S2 == 0) &#123;            beep(50);            while (S1 == 0 || S2 == 0) &#123;                feed_dog();            &#125;            break;        &#125;    &#125;&#125;</code></pre><p>}</p><p>void Timer0Interrupt() interrupt 1{         &#x2F;&#x2F;12Mhz 1mSå®šæ—¶å™¨ä¸­æ–­<br>    static u8 seg &#x3D; 0;  &#x2F;&#x2F;å½“å‰æ­£åœ¨æ‰«æçš„æ•°ç ç®¡æ®µç  4ä½æ•°ç ç®¡ èŒƒå›´:0~3<br>    static u8 ms1 &#x3D; 0;<br>    static u16 ms &#x3D; 0, ms2 &#x3D; 0;<br>    TH0 &#x3D; 0xFC;<br>    TL0 &#x3D; 0x18;<br>    if (delay &amp;&amp; !â€“delayms) {    &#x2F;&#x2F;å»¶æ—¶ä»»æ„æ¯«ç§’<br>        delay &#x3D; 0;<br>    }<br>    &#x2F;&#x2F;æ•°ç ç®¡åŠ¨æ€æ‰«æå¤„ç†<br>    P1 |&#x3D; 0xF;          &#x2F;&#x2F;æ¶ˆå½±<br>    P2 &#x3D; test ? 0xFF : (wink &amp; (1 &lt;&lt; (3 ^ seg)) &amp;&amp; !hz10 ? 0 : show[seg]);      &#x2F;&#x2F;æ®µç <br>    P1 &amp;&#x3D; ~(1 &lt;&lt; seg);   &#x2F;&#x2F;ä½ç <br>    if (++seg &gt;&#x3D; 4) seg &#x3D; 0;</p><pre><code>if (test) &#123;     //æµ‹è¯•æ¨¡å¼    S1 = 1; S2 = 1;    P3_2 = 0;    return;&#125;//èœ‚é¸£å™¨å¤„ç†P3_2 = Beep;if (!Beep &amp;&amp; !--beep_ms) &#123;    Beep = 1;&#125;if (++ms1 &gt;= 50) &#123;    ms1 = 0;    hz10 = !hz10;&#125;//æŒ‰é”®å¤„ç†if (P3_0 == 0) &#123;    if (S1_ms != 0xFFFF) S1_ms++;&#125;else &#123;    S1_ms = 0;&#125;if (P3_1 == 0) &#123;    if (S2_ms != 0xFFFF) S2_ms++;&#125;else &#123;    S2_ms = 0;&#125;S1 = !(S1_ms &gt;= KEY_TIME);S2 = !(S2_ms &gt;= KEY_TIME);//ç»§ç”µå™¨å¤„ç†if (++ms2 &gt;= 1000) &#123;    //ç»§ç”µå™¨1ç§’åªèƒ½è¿›è¡Œ1æ¬¡å¸åˆæˆ–é‡Šæ”¾ï¼Œé˜²æ­¢é¢‘ç¹å¼€å…³å¯¼è‡´è®¾å¤‡æŸå    ms2 = 0;    P3_3 = relay;&#125;//æ—¶é—´å€’è®¡æ—¶å¤„ç†if (start) &#123;    if (pause) &#123;        wink = 0xF;    &#125;    else &#123;        wink = 0;        if (++ms &gt;= 1000) &#123;            ms = 0;            show[0] = nbr[time / 1000 % 10];            show[1] = nbr[time / 100 % 10];            show[2] = nbr[time / 10 % 10];            show[3] = nbr[time % 10];            if (!time--) &#123;      //å€’è®¡æ—¶ç»“æŸ                start = 0;                relay = 1;            &#125;        &#125;    &#125;&#125;</code></pre><p>}&#96;</p><h4 id="ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1DjhHyl_yG3VP1gXn8rU5iQ </span><br><span class="line">æå–ç ï¼š07fx</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1DjhHyl_yG3VP1gXn8rU5iQ  æå–ç ï¼š07fx</code></p><ul><li>âœ…èµ„æºæ›´æ–°ï¼ˆ2023-3-3ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥: https://pan.baidu.com/s/1xaQZnQ3xNZuZpbiDwixsjg</span><br><span class="line">æå–ç : 8nr4</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥: https://pan.baidu.com/s/1xaQZnQ3xNZuZpbiDwixsjg æå–ç : 8nr4</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F4X4%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE%E6%89%AB%E6%8F%8F%E7%BB%84%E6%88%90%E7%9A%84%E7%AE%80%E6%98%93%E5%8A%A0%E6%B3%95%E5%99%A8/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F4X4%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE%E6%89%AB%E6%8F%8F%E7%BB%84%E6%88%90%E7%9A%84%E7%AE%80%E6%98%93%E5%8A%A0%E6%B3%95%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨"><a href="#ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨"></a>ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨</h1><h3 id="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨-1"><a href="#ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨"></a>ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨</h3><ul><li>ç›¸å…³ç¯‡ã€Š51å•ç‰‡æœº8x9çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸã€‹</li><li>ã€Š51å•ç‰‡æœº8x8çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸã€‹</li><li>ã€Š51å•ç‰‡æœº4x4çŸ©é˜µé”®ç›˜æ‰«æ+æ•°ç ç®¡æ˜¾ç¤º(ä¸‰)ã€‹</li><li>æœ¬å®éªŒåŸºäºProteus VSM Studioä»¿çœŸ</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120009976">51å•ç‰‡æœº8x9çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸ</a></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120007533">51å•ç‰‡æœº8x8çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸ</a></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120002822">51å•ç‰‡æœº4x4çŸ©é˜µé”®ç›˜æ‰«æ+æ•°ç ç®¡æ˜¾ç¤º(ä¸‰)</a></p><p><img src="https://img-blog.csdnimg.cn/942f6c69c6e0438f9e4e110dfa73f8ad.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="VSM-Studioç¨‹åºä»£ç "><a href="#VSM-Studioç¨‹åºä»£ç " class="headerlink" title="VSM Studioç¨‹åºä»£ç "></a>VSM Studioç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *ç®€æ˜“åŠ æ³•è®¡ç®—å™¨</span><br><span class="line"> * Created:   å‘¨äºŒ 6æœˆ 14 2022</span><br><span class="line"> * Processor: AT89C52</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line"> </span><br><span class="line">sbit ADDR0 = P1^0;</span><br><span class="line">sbit ADDR1 = P1^1;</span><br><span class="line">sbit ADDR2 = P1^2;</span><br><span class="line">sbit ADDR3 = P1^3;</span><br><span class="line">sbit ENLED = P1^4;</span><br><span class="line">sbit KEY_IN_1 = P2^4;</span><br><span class="line">sbit KEY_IN_2 = P2^5;</span><br><span class="line">sbit KEY_IN_3 = P2^6;</span><br><span class="line">sbit KEY_IN_4 = P2^7;</span><br><span class="line">sbit KEY_OUT_1 = P2^3;</span><br><span class="line">sbit KEY_OUT_2 = P2^2;</span><br><span class="line">sbit KEY_OUT_3 = P2^1;</span><br><span class="line">sbit KEY_OUT_4 = P2^0;</span><br><span class="line">unsigned char code LedChar[] = &#123; //æ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦è½¬æ¢è¡¨</span><br><span class="line">0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8,</span><br><span class="line">0x80, 0x90, 0x88, 0x83, 0xC6, 0xA1, 0x86, 0x8E</span><br><span class="line">&#125;;</span><br><span class="line">unsigned char LedBuff[6]=&#123;0xff,0xff,0xff,0xff,0xff,0xff&#125;; //æ•°ç ç®¡æ˜¾ç¤ºç¼“å†²åŒº </span><br><span class="line">unsigned char code KeyCodeMap[4][4] = &#123; //çŸ©é˜µæŒ‰é”®ç¼–å·åˆ°æ ‡å‡†é”®ç›˜é”®ç çš„æ˜ å°„è¡¨</span><br><span class="line">&#123; 0x31, 0x32, 0x33, 0x26 &#125;, //æ•°å­—é”® 1ã€æ•°å­—é”® 2ã€æ•°å­—é”® 3ã€å‘ä¸Šé”®</span><br><span class="line">&#123; 0x34, 0x35, 0x36, 0x25 &#125;, //æ•°å­—é”® 4ã€æ•°å­—é”® 5ã€æ•°å­—é”® 6ã€å‘å·¦é”®</span><br><span class="line">&#123; 0x37, 0x38, 0x39, 0x28 &#125;, //æ•°å­—é”® 7ã€æ•°å­—é”® 8ã€æ•°å­—é”® 9ã€å‘ä¸‹é”®</span><br><span class="line">&#123; 0x30, 0x1B, 0x0D, 0x27 &#125; //æ•°å­—é”® 0ã€ESC é”®ã€ å›è½¦é”®ã€ å‘å³é”®</span><br><span class="line">&#125;;        </span><br><span class="line">unsigned char KeySta[4][4] = &#123; //å…¨éƒ¨çŸ©é˜µæŒ‰é”®çš„å½“å‰çŠ¶æ€</span><br><span class="line">&#123;1, 1, 1, 1&#125;, &#123;1, 1, 1, 1&#125;, &#123;1, 1, 1, 1&#125;, &#123;1, 1, 1, 1&#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">unsigned char THR0,TLR0;</span><br><span class="line">void KeyDriver();</span><br><span class="line">void ConfigTimer(unsigned long ms);</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">EA = 1;     //ä½¿èƒ½æ€»ä¸­æ–­</span><br><span class="line">ENLED = 0;</span><br><span class="line">ADDR3 = 1;</span><br><span class="line">ConfigTimer(1); //è®¡ç®—å®šæ—¶1msï¼Œéœ€è¦èµ‹çš„åˆå€¼ï¼Œå­˜åœ¨åœ¨ THR0,TLR0ä¸­</span><br><span class="line">TMOD = TMOD &amp; 0xF0;</span><br><span class="line">TMOD = TMOD | 0x01;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼1 ,ä¸å½±å“é«˜å››ä½</span><br><span class="line">TH0 = THR0; //å®šæ—¶å™¨èµ‹åˆå€¼</span><br><span class="line">TL0 = TLR0;</span><br><span class="line">ET0= 1;//ä½¿èƒ½T0ä¸­æ–­</span><br><span class="line">TR0 = 1;    //å¯åŠ¨å®šæ—¶å™¨T0</span><br><span class="line">LedBuff[0] = LedChar[0];   //æ•°ç ç®¡é»˜è®¤æ˜¾ç¤º0</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">   KeyDriver();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">void ConfigTimer(unsigned long ms)</span><br><span class="line">&#123;</span><br><span class="line">unsigned long temp;</span><br><span class="line">temp = 65536 - ms*11059200/1000/12;//msæœ€å¤§å®šæ—¶71ms</span><br><span class="line">THR0 = (unsigned char)(temp&gt;&gt;8);    //å–è®¡æ•°å€¼é«˜å…«ä½ ï¼Œè®¡æ•°å€¼ä¸ä¼šè¶…è¿‡65535ï¼Œæœ€å¤šå ç”¨16ä½ã€‚</span><br><span class="line">TLR0 = (char)temp; //å–è®¡æ•°å€¼ä½å…«ä½ </span><br><span class="line">&#125;</span><br><span class="line">void ShowNumber(unsigned long num)</span><br><span class="line">&#123;</span><br><span class="line"> signed char i;</span><br><span class="line"> unsigned char buf[6];   //å°†numå…­ä½æ•°å­—æŒ‰é¡ºåºæ”¾å…¥bufæ•°ç»„ä¸­</span><br><span class="line"> for(i=0;i&lt;=5;i++)</span><br><span class="line"> &#123;</span><br><span class="line"> buf[i]=num%10;</span><br><span class="line">num = num/10;</span><br><span class="line"> &#125;</span><br><span class="line"> for(i=5;i&gt;=1;i--) //ä»é«˜ä½åˆ°ä½ä½ä¾æ¬¡æ‰«æï¼Œç›´åˆ°æŸä¸€ä½ä¸ä¸º0</span><br><span class="line"> &#123;</span><br><span class="line"> if(buf[i]==0)</span><br><span class="line">&#123;</span><br><span class="line">LedBuff[i]=0xff;     //å¦‚æœé«˜ä½ä¸º0ï¼Œåˆ™å…³é—­æ­¤å¯¹åº”æ•°ç ç®¡æ˜¾ç¤ºï¼Œå¦åˆ™è·³å‡ºï¼Œä¿ç•™buf[]ä¸­ä¸ä¸º0çš„ä¸‹è§’æ ‡åœ¨iä¸­</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line"> &#125;</span><br><span class="line"> for(;i&gt;=0;i--)</span><br><span class="line"> &#123;</span><br><span class="line"> LedBuff[i]=LedChar[buf[i]];    //å°†å„ä½æ•°å­—å–å‡ºï¼Œè½¬æ¢æˆæ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦æ”¾å…¥å…¬æœ‰æ•°ç»„å˜é‡LedBuff[6]ä¸­</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">void KeyAction(unsigned char keycode)</span><br><span class="line">&#123;</span><br><span class="line">static unsigned long result = 0;</span><br><span class="line">static unsigned long addend = 0;</span><br><span class="line">if((keycode&gt;=0x30)&amp;&amp;(keycode&lt;=0x39))    //è¾“å…¥çš„æ˜¯æ•°å­—</span><br><span class="line">&#123;</span><br><span class="line">addend = (addend*10)+(keycode-0x30); //å°†åŸæœ‰æ•°å­—é¡¶ä¸Šå»</span><br><span class="line">ShowNumber(addend);</span><br><span class="line">&#125;</span><br><span class="line">else if(keycode == 0x26)     //ä¸Šé”®ï¼Œæ‰§è¡ŒåŠ æ³•æ“ä½œ</span><br><span class="line">&#123;</span><br><span class="line">result += addend; //å°†ä¸Šä¸€ä¸ªæ•°å­—addendå­˜åœ¨resultä¸­ï¼Œæ¸…ç©ºaddendï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ•°å­—</span><br><span class="line">addend = 0;</span><br><span class="line">ShowNumber(result);</span><br><span class="line">&#125;</span><br><span class="line">else if(keycode == 0x0D)  //å›è½¦é”®ï¼Œä½œç”¨å’Œä¸Šé”®ç­‰åŒ</span><br><span class="line">&#123;</span><br><span class="line">result += addend; //å°†ä¸Šä¸€ä¸ªæ•°å­—addendå­˜åœ¨resultä¸­ï¼Œæ¸…ç©ºaddendï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ•°å­—</span><br><span class="line">addend = 0;</span><br><span class="line">ShowNumber(result);</span><br><span class="line">&#125;</span><br><span class="line">else if(keycode == 0x1B)         //escé”®ï¼Œæ¸…é›¶</span><br><span class="line">&#123;</span><br><span class="line">addend = 0;</span><br><span class="line">result = 0;</span><br><span class="line">ShowNumber(addend);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">void KeyDriver()  </span><br><span class="line">&#123;</span><br><span class="line">unsigned char i,j;</span><br><span class="line">static unsigned char backup[4][4]=&#123;    //ä¸€å®šå®šä¹‰æˆé™æ€ï¼Œå¦åˆ™bug</span><br><span class="line">&#123;1,1,1,1&#125;, &#123;1,1,1,1&#125;,&#123;1,1,1,1&#125;,&#123;1,1,1,1&#125;</span><br><span class="line">&#125;;</span><br><span class="line"> for(i=0;i&lt;4;i++)</span><br><span class="line">&#123;</span><br><span class="line">for(j=0;j&lt;4;j++)</span><br><span class="line">&#123;</span><br><span class="line">if(KeySta[i][j]!=backup[i][j])  //å½“å‰æŒ‰é”®çŠ¶æ€å’Œä¹‹å‰æŒ‰é”®çŠ¶æ€ä¸ä¸€è‡´ï¼Œè¯æ˜æŒ‰é”®å·²ç»æŒ‰ä¸‹æˆ–è€…æŠ¬èµ·</span><br><span class="line">&#123;</span><br><span class="line">if(KeySta[i][j]==0)          //å¦‚æœå½“å‰æŒ‰é”®çŠ¶æ€ä¸º0ï¼Œè¯´æ˜æŒ‰é”®æŒ‰ä¸‹ï¼›åœ¨æ­¤æˆ‘ä»¬åªå¯¹æŒ‰é”®æŒ‰ä¸‹åŠ¨ä½œå“åº”</span><br><span class="line">&#123;</span><br><span class="line">KeyAction(KeyCodeMap[i][j]);  //å°†å¯¹åº”çš„æŒ‰é”®è½¬æ¢æˆæ ‡å‡†é”®ç›˜ç ä¼ å…¥KeyActionä¸­ï¼Œæ ¹æ®ä¼ å…¥çš„é”®ç›˜ç æ‰§è¡Œç›¸åº”åŠ¨ä½œ</span><br><span class="line">&#125;</span><br><span class="line">backup[i][j]=KeySta[i][j]; //ä¿å­˜å½“å‰æŒ‰é”®çŠ¶æ€</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">void LedScan()</span><br><span class="line">&#123;</span><br><span class="line">static unsigned char i = 0;</span><br><span class="line">P0=0xff;</span><br><span class="line">switch(i)</span><br><span class="line">&#123;</span><br><span class="line">case 0: ADDR2=0;ADDR1=0;ADDR0=0;P0=LedBuff[i];i++;break;</span><br><span class="line">case 1: ADDR2=0;ADDR1=0;ADDR0=1;P0=LedBuff[i];i++;break;</span><br><span class="line">case 2: ADDR2=0;ADDR1=1;ADDR0=0;P0=LedBuff[i];i++;break;</span><br><span class="line">case 3: ADDR2=0;ADDR1=1;ADDR0=1;P0=LedBuff[i];i++;break;</span><br><span class="line">case 4: ADDR2=1;ADDR1=0;ADDR0=0;P0=LedBuff[i];i++;break;</span><br><span class="line">case 5: ADDR2=1;ADDR1=0;ADDR0=1;P0=LedBuff[i];i=0;break;</span><br><span class="line">default:break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">void KeyScan()</span><br><span class="line">&#123;</span><br><span class="line">static unsigned char keyout = 0;</span><br><span class="line">unsigned char i;</span><br><span class="line">static unsigned char keybuf[4][4]=&#123;</span><br><span class="line">&#123;0xff,0xff,0xff,0xff&#125;,&#123;0xff,0xff,0xff,0xff&#125;,&#123;0xff,0xff,0xff,0xff&#125;,&#123;0xff,0xff,0xff,0xff&#125;</span><br><span class="line">&#125;;</span><br><span class="line">keybuf[keyout][0] = (keybuf[keyout][0]&lt;&lt;1)| KEY_IN_1;</span><br><span class="line">keybuf[keyout][1] = (keybuf[keyout][1]&lt;&lt;1)| KEY_IN_2;</span><br><span class="line">keybuf[keyout][2] = (keybuf[keyout][2]&lt;&lt;1)| KEY_IN_3;</span><br><span class="line">keybuf[keyout][3] = (keybuf[keyout][3]&lt;&lt;1)| KEY_IN_4;</span><br><span class="line">for(i=0;i&lt;=3;i++)</span><br><span class="line">&#123;</span><br><span class="line">if((keybuf[keyout][i]&amp;0x0f)==0x00)</span><br><span class="line">&#123;</span><br><span class="line">KeySta[keyout][i]=0;</span><br><span class="line">&#125;</span><br><span class="line">else if((keybuf[keyout][i]&amp;0x0f)==0x0f)</span><br><span class="line">&#123;</span><br><span class="line">KeySta[keyout][i]=1;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">keyout++;</span><br><span class="line">if(keyout&gt;=4)</span><br><span class="line">&#123;keyout=0;&#125;</span><br><span class="line">switch(keyout) //æ‰«æä¸‹ä¸€è¡Œ</span><br><span class="line">&#123;</span><br><span class="line">case 0:KEY_OUT_4=1;KEY_OUT_1=0;break;</span><br><span class="line">case 1:KEY_OUT_1=1;KEY_OUT_2=0;break;</span><br><span class="line">case 2:KEY_OUT_2=1;KEY_OUT_3=0;break;</span><br><span class="line">case 3:KEY_OUT_3=1;KEY_OUT_4=0;break;</span><br><span class="line">default:break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">void  InterruptTimer0() interrupt 1      </span><br><span class="line">&#123;</span><br><span class="line">   TH0=THR0;</span><br><span class="line">   TL0=TLR0;</span><br><span class="line">   LedScan();</span><br><span class="line">   KeyScan();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *ç®€æ˜“åŠ æ³•è®¡ç®—å™¨</p><ul><li>Created:   å‘¨äºŒ 6æœˆ 14 2022</li><li>Processor: AT89C52</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include &lt;reg52.h&gt;</p><p>sbit ADDR0 &#x3D; P1^0;<br>sbit ADDR1 &#x3D; P1^1;<br>sbit ADDR2 &#x3D; P1^2;<br>sbit ADDR3 &#x3D; P1^3;<br>sbit ENLED &#x3D; P1^4;<br>sbit KEY_IN_1 &#x3D; P2^4;<br>sbit KEY_IN_2 &#x3D; P2^5;<br>sbit KEY_IN_3 &#x3D; P2^6;<br>sbit KEY_IN_4 &#x3D; P2^7;<br>sbit KEY_OUT_1 &#x3D; P2^3;<br>sbit KEY_OUT_2 &#x3D; P2^2;<br>sbit KEY_OUT_3 &#x3D; P2^1;<br>sbit KEY_OUT_4 &#x3D; P2^0;<br>unsigned char code LedChar[] &#x3D; { &#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦è½¬æ¢è¡¨<br>0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8,<br>0x80, 0x90, 0x88, 0x83, 0xC6, 0xA1, 0x86, 0x8E<br>};<br>unsigned char LedBuff[6]&#x3D;{0xff,0xff,0xff,0xff,0xff,0xff}; &#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºç¼“å†²åŒº<br>unsigned char code KeyCodeMap[4][4] &#x3D; { &#x2F;&#x2F;çŸ©é˜µæŒ‰é”®ç¼–å·åˆ°æ ‡å‡†é”®ç›˜é”®ç çš„æ˜ å°„è¡¨<br>{ 0x31, 0x32, 0x33, 0x26 }, &#x2F;&#x2F;æ•°å­—é”® 1ã€æ•°å­—é”® 2ã€æ•°å­—é”® 3ã€å‘ä¸Šé”®<br>{ 0x34, 0x35, 0x36, 0x25 }, &#x2F;&#x2F;æ•°å­—é”® 4ã€æ•°å­—é”® 5ã€æ•°å­—é”® 6ã€å‘å·¦é”®<br>{ 0x37, 0x38, 0x39, 0x28 }, &#x2F;&#x2F;æ•°å­—é”® 7ã€æ•°å­—é”® 8ã€æ•°å­—é”® 9ã€å‘ä¸‹é”®<br>{ 0x30, 0x1B, 0x0D, 0x27 } &#x2F;&#x2F;æ•°å­—é”® 0ã€ESC é”®ã€ å›è½¦é”®ã€ å‘å³é”®<br>};<br>unsigned char KeySta[4][4] &#x3D; { &#x2F;&#x2F;å…¨éƒ¨çŸ©é˜µæŒ‰é”®çš„å½“å‰çŠ¶æ€<br>{1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}<br>};</p><p>unsigned char THR0,TLR0;<br>void KeyDriver();<br>void ConfigTimer(unsigned long ms);<br>void main()<br>{<br>    EA &#x3D; 1;     &#x2F;&#x2F;ä½¿èƒ½æ€»ä¸­æ–­<br>    ENLED &#x3D; 0;<br>    ADDR3 &#x3D; 1;<br>    ConfigTimer(1); &#x2F;&#x2F;è®¡ç®—å®šæ—¶1msï¼Œéœ€è¦èµ‹çš„åˆå€¼ï¼Œå­˜åœ¨åœ¨ THR0,TLR0ä¸­<br>    TMOD &#x3D; TMOD &amp; 0xF0;<br>    TMOD &#x3D; TMOD | 0x01;&#x2F;&#x2F;è®¾ç½®å®šæ—¶å™¨æ¨¡å¼1 ,ä¸å½±å“é«˜å››ä½<br>    TH0 &#x3D; THR0; &#x2F;&#x2F;å®šæ—¶å™¨èµ‹åˆå€¼<br>    TL0 &#x3D; TLR0;<br>    ET0&#x3D; 1;&#x2F;&#x2F;ä½¿èƒ½T0ä¸­æ–­<br>    TR0 &#x3D; 1;    &#x2F;&#x2F;å¯åŠ¨å®šæ—¶å™¨T0<br>    LedBuff[0] &#x3D; LedChar[0];   &#x2F;&#x2F;æ•°ç ç®¡é»˜è®¤æ˜¾ç¤º0<br>    while(1)<br>    {<br>       KeyDriver();<br>    }<br>}<br>void ConfigTimer(unsigned long ms)<br>{<br>    unsigned long temp;<br>    temp &#x3D; 65536 - ms<em>11059200&#x2F;1000&#x2F;12;&#x2F;&#x2F;msæœ€å¤§å®šæ—¶71ms<br>    THR0 &#x3D; (unsigned char)(temp&gt;&gt;8);    &#x2F;&#x2F;å–è®¡æ•°å€¼é«˜å…«ä½ ï¼Œè®¡æ•°å€¼ä¸ä¼šè¶…è¿‡65535ï¼Œæœ€å¤šå ç”¨16ä½ã€‚<br>    TLR0 &#x3D; (char)temp; &#x2F;&#x2F;å–è®¡æ•°å€¼ä½å…«ä½<br>}<br>void ShowNumber(unsigned long num)<br>{<br>     signed char i;<br>     unsigned char buf[6];   &#x2F;&#x2F;å°†numå…­ä½æ•°å­—æŒ‰é¡ºåºæ”¾å…¥bufæ•°ç»„ä¸­<br>     for(i&#x3D;0;i&lt;&#x3D;5;i++)<br>     {<br>     buf[i]&#x3D;num%10;<br>        num &#x3D; num&#x2F;10;<br>     }<br>     for(i&#x3D;5;i&gt;&#x3D;1;iâ€“) &#x2F;&#x2F;ä»é«˜ä½åˆ°ä½ä½ä¾æ¬¡æ‰«æï¼Œç›´åˆ°æŸä¸€ä½ä¸ä¸º0<br>     {<br>     if(buf[i]&#x3D;&#x3D;0)<br>        {<br>            LedBuff[i]&#x3D;0xff;     &#x2F;&#x2F;å¦‚æœé«˜ä½ä¸º0ï¼Œåˆ™å…³é—­æ­¤å¯¹åº”æ•°ç ç®¡æ˜¾ç¤ºï¼Œå¦åˆ™è·³å‡ºï¼Œä¿ç•™buf[]ä¸­ä¸ä¸º0çš„ä¸‹è§’æ ‡åœ¨iä¸­<br>        }<br>        else<br>        {<br>            break;<br>        }<br>     }<br>     for(;i&gt;&#x3D;0;iâ€“)<br>     {<br>     LedBuff[i]&#x3D;LedChar[buf[i]];    &#x2F;&#x2F;å°†å„ä½æ•°å­—å–å‡ºï¼Œè½¬æ¢æˆæ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦æ”¾å…¥å…¬æœ‰æ•°ç»„å˜é‡LedBuff[6]ä¸­<br>     }<br>}<br>void KeyAction(unsigned char keycode)<br>{<br>    static unsigned long result &#x3D; 0;<br>    static unsigned long addend &#x3D; 0;<br>    if((keycode&gt;&#x3D;0x30)&amp;&amp;(keycode&lt;&#x3D;0x39))    &#x2F;&#x2F;è¾“å…¥çš„æ˜¯æ•°å­—<br>    {<br>        addend &#x3D; (addend</em>10)+(keycode-0x30); &#x2F;&#x2F;å°†åŸæœ‰æ•°å­—é¡¶ä¸Šå»<br>        ShowNumber(addend);<br>    }<br>    else if(keycode &#x3D;&#x3D; 0x26)     &#x2F;&#x2F;ä¸Šé”®ï¼Œæ‰§è¡ŒåŠ æ³•æ“ä½œ<br>    {<br>        result +&#x3D; addend; &#x2F;&#x2F;å°†ä¸Šä¸€ä¸ªæ•°å­—addendå­˜åœ¨resultä¸­ï¼Œæ¸…ç©ºaddendï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ•°å­—<br>        addend &#x3D; 0;<br>        ShowNumber(result);<br>    }<br>    else if(keycode &#x3D;&#x3D; 0x0D)  &#x2F;&#x2F;å›è½¦é”®ï¼Œä½œç”¨å’Œä¸Šé”®ç­‰åŒ<br>    {<br>        result +&#x3D; addend; &#x2F;&#x2F;å°†ä¸Šä¸€ä¸ªæ•°å­—addendå­˜åœ¨resultä¸­ï¼Œæ¸…ç©ºaddendï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ•°å­—<br>        addend &#x3D; 0;<br>        ShowNumber(result);<br>    }<br>    else if(keycode &#x3D;&#x3D; 0x1B)         &#x2F;&#x2F;escé”®ï¼Œæ¸…é›¶<br>    {<br>        addend &#x3D; 0;<br>        result &#x3D; 0;<br>        ShowNumber(addend);<br>    }<br>}<br>void KeyDriver()<br>{<br>    unsigned char i,j;<br>    static unsigned char backup[4][4]&#x3D;{    &#x2F;&#x2F;ä¸€å®šå®šä¹‰æˆé™æ€ï¼Œå¦åˆ™bug<br>    {1,1,1,1}, {1,1,1,1},{1,1,1,1},{1,1,1,1}<br>    };<br>     for(i&#x3D;0;i&lt;4;i++)<br>    {<br>        for(j&#x3D;0;j&lt;4;j++)<br>        {<br>            if(KeySta[i][j]!&#x3D;backup[i][j])  &#x2F;&#x2F;å½“å‰æŒ‰é”®çŠ¶æ€å’Œä¹‹å‰æŒ‰é”®çŠ¶æ€ä¸ä¸€è‡´ï¼Œè¯æ˜æŒ‰é”®å·²ç»æŒ‰ä¸‹æˆ–è€…æŠ¬èµ·<br>            {<br>                if(KeySta[i][j]&#x3D;&#x3D;0)          &#x2F;&#x2F;å¦‚æœå½“å‰æŒ‰é”®çŠ¶æ€ä¸º0ï¼Œè¯´æ˜æŒ‰é”®æŒ‰ä¸‹ï¼›åœ¨æ­¤æˆ‘ä»¬åªå¯¹æŒ‰é”®æŒ‰ä¸‹åŠ¨ä½œå“åº”<br>                {<br>                    KeyAction(KeyCodeMap[i][j]);  &#x2F;&#x2F;å°†å¯¹åº”çš„æŒ‰é”®è½¬æ¢æˆæ ‡å‡†é”®ç›˜ç ä¼ å…¥KeyActionä¸­ï¼Œæ ¹æ®ä¼ å…¥çš„é”®ç›˜ç æ‰§è¡Œç›¸åº”åŠ¨ä½œ<br>                }<br>                backup[i][j]&#x3D;KeySta[i][j]; &#x2F;&#x2F;ä¿å­˜å½“å‰æŒ‰é”®çŠ¶æ€<br>            }<br>        }<br>    }<br>}</p><p>void LedScan()<br>{<br>    static unsigned char i &#x3D; 0;<br>    P0&#x3D;0xff;<br>    switch(i)<br>    {<br>        case 0: ADDR2&#x3D;0;ADDR1&#x3D;0;ADDR0&#x3D;0;P0&#x3D;LedBuff[i];i++;break;<br>        case 1: ADDR2&#x3D;0;ADDR1&#x3D;0;ADDR0&#x3D;1;P0&#x3D;LedBuff[i];i++;break;<br>        case 2: ADDR2&#x3D;0;ADDR1&#x3D;1;ADDR0&#x3D;0;P0&#x3D;LedBuff[i];i++;break;<br>        case 3: ADDR2&#x3D;0;ADDR1&#x3D;1;ADDR0&#x3D;1;P0&#x3D;LedBuff[i];i++;break;<br>        case 4: ADDR2&#x3D;1;ADDR1&#x3D;0;ADDR0&#x3D;0;P0&#x3D;LedBuff[i];i++;break;<br>        case 5: ADDR2&#x3D;1;ADDR1&#x3D;0;ADDR0&#x3D;1;P0&#x3D;LedBuff[i];i&#x3D;0;break;<br>        default:break;<br>    }<br>}<br>void KeyScan()<br>{<br>    static unsigned char keyout &#x3D; 0;<br>    unsigned char i;<br>    static unsigned char keybuf[4][4]&#x3D;{<br>    {0xff,0xff,0xff,0xff},{0xff,0xff,0xff,0xff},{0xff,0xff,0xff,0xff},{0xff,0xff,0xff,0xff}<br>    };<br>    keybuf[keyout][0] &#x3D; (keybuf[keyout][0]&lt;&lt;1)| KEY_IN_1;<br>    keybuf[keyout][1] &#x3D; (keybuf[keyout][1]&lt;&lt;1)| KEY_IN_2;<br>    keybuf[keyout][2] &#x3D; (keybuf[keyout][2]&lt;&lt;1)| KEY_IN_3;<br>    keybuf[keyout][3] &#x3D; (keybuf[keyout][3]&lt;&lt;1)| KEY_IN_4;<br>    for(i&#x3D;0;i&lt;&#x3D;3;i++)<br>    {<br>        if((keybuf[keyout][i]&amp;0x0f)&#x3D;&#x3D;0x00)<br>        {<br>            KeySta[keyout][i]&#x3D;0;<br>        }<br>        else if((keybuf[keyout][i]&amp;0x0f)&#x3D;&#x3D;0x0f)<br>        {<br>            KeySta[keyout][i]&#x3D;1;<br>        }<br>        else<br>        {}<br>    }<br>    keyout++;<br>    if(keyout&gt;&#x3D;4)<br>    {keyout&#x3D;0;}<br>    switch(keyout) &#x2F;&#x2F;æ‰«æä¸‹ä¸€è¡Œ<br>    {<br>        case 0:KEY_OUT_4&#x3D;1;KEY_OUT_1&#x3D;0;break;<br>        case 1:KEY_OUT_1&#x3D;1;KEY_OUT_2&#x3D;0;break;<br>        case 2:KEY_OUT_2&#x3D;1;KEY_OUT_3&#x3D;0;break;<br>        case 3:KEY_OUT_3&#x3D;1;KEY_OUT_4&#x3D;0;break;<br>        default:break;<br>    }<br>}<br>void  InterruptTimer0() interrupt 1<br>{<br>   TH0&#x3D;THR0;<br>   TL0&#x3D;TLR0;<br>   LedScan();<br>   KeyScan();<br>}&#96;</p><ul><li>VSM Studioç•Œé¢</li></ul><p><img src="https://img-blog.csdnimg.cn/b6ade35cf2c74f218db889de0922ce14.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ï¼Œæœ¬é¡¹ç›®å¦å¤–åŒ…å«Keilå·¥ç¨‹ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1o64EZGZlfyirrx1ib13mBQ </span><br><span class="line">æå–ç ï¼š0aho</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1o64EZGZlfyirrx1ib13mBQ  æå–ç ï¼š0aho</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡ç§’è®¡æ•°å™¨ï¼ˆ0-999999Sï¼‰</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F6%E4%BD%8D%E6%95%B0%E7%A0%81%E7%AE%A1%E7%A7%92%E8%AE%A1%E6%95%B0%E5%99%A80999999S/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F6%E4%BD%8D%E6%95%B0%E7%A0%81%E7%AE%A1%E7%A7%92%E8%AE%A1%E6%95%B0%E5%99%A80999999S/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡ç§’è®¡æ•°å™¨ï¼ˆ0-999999Sï¼‰"><a href="#ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡ç§’è®¡æ•°å™¨ï¼ˆ0-999999Sï¼‰" class="headerlink" title="ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡ç§’è®¡æ•°å™¨ï¼ˆ0-999999Sï¼‰"></a>ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡ç§’è®¡æ•°å™¨ï¼ˆ0-999999Sï¼‰</h1><h3 id="ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡ç§’è®¡æ•°å™¨ï¼ˆ0-999999Sï¼‰-1"><a href="#ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡ç§’è®¡æ•°å™¨ï¼ˆ0-999999Sï¼‰-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡ç§’è®¡æ•°å™¨ï¼ˆ0-999999Sï¼‰"></a>ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡ç§’è®¡æ•°å™¨ï¼ˆ0-999999Sï¼‰</h3><ul><li>ğŸ¬ Proteus VSMä»¿çœŸæ¼”ç¤º</li><li>ğŸ“ºä¾‹ç¨‹äºŒæ¼”ç¤ºï¼š</li></ul><p><img src="https://img-blog.csdnimg.cn/7a4f7d4b645c452da26ac7138b434106.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/52573e61cb424bebb7f54ddf35a27a1e.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“ä¾‹ç¨‹ä¸€ï¼šVSM-Studioä»£ç "><a href="#ğŸ“ä¾‹ç¨‹ä¸€ï¼šVSM-Studioä»£ç " class="headerlink" title="ğŸ“ä¾‹ç¨‹ä¸€ï¼šVSM Studioä»£ç "></a>ğŸ“ä¾‹ç¨‹ä¸€ï¼šVSM Studioä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *0-999999ç§’è¡¨</span><br><span class="line"> * Created:   å‘¨å›› 6æœˆ 14 2022</span><br><span class="line"> * Processor: AT89C52</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#define FOSC 12000000uL</span><br><span class="line">//#define T50MS 15536  //50ms timer calculation method in 12T mode</span><br><span class="line">#define T50MS (65536-FOSC*50/12/1000)   //1ms*50 timer calculation method in 12T mode</span><br><span class="line"></span><br><span class="line">sbit ADDR0 = P1^0;</span><br><span class="line">sbit ADDR1 = P1^1;</span><br><span class="line">sbit ADDR2 = P1^2;</span><br><span class="line">sbit ADDR3 = P1^3;</span><br><span class="line">sbit ENLED = P1^4;</span><br><span class="line">sbit led = P1^5; </span><br><span class="line">unsigned char code LedChar[] = &#123;  //æ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦è½¬æ¢è¡¨</span><br><span class="line">    0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8,</span><br><span class="line">    0x80, 0x90, 0x88, 0x83, 0xC6, 0xA1, 0x86, 0x8E</span><br><span class="line">&#125;;</span><br><span class="line">unsigned char LedBuff[6] = &#123; //æ•°ç ç®¡æ˜¾ç¤ºç¼“å†²åŒºï¼Œåˆå€¼ 0xFF ç¡®ä¿å¯åŠ¨æ—¶éƒ½ä¸äº®</span><br><span class="line">    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF</span><br><span class="line">&#125;;</span><br><span class="line">    unsigned int cnt = 0; //è®°å½• T0 ä¸­æ–­æ¬¡æ•°</span><br><span class="line">    unsigned long sec = 0; //è®°å½•ç»è¿‡çš„ç§’æ•°</span><br><span class="line">void tm0_isr() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    TL0 = T50MS;                     //reload timer0 low byte</span><br><span class="line">    TH0 = T50MS &gt;&gt; 8;                //reload timer0 high byte</span><br><span class="line">    if (cnt-- == 0)               //1ms * 1000 -&gt; 1s</span><br><span class="line">    &#123;</span><br><span class="line">        cnt = 20;               //reset counter</span><br><span class="line">sec++;  //ç§’è®¡æ•°è‡ªåŠ  1</span><br><span class="line">        led = ! led;      //work LED flash          </span><br><span class="line">                //ä»¥ä¸‹ä»£ç å°† sec æŒ‰åè¿›åˆ¶ä½ä»ä½åˆ°é«˜ä¾æ¬¡æå–å¹¶è½¬ä¸ºæ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦</span><br><span class="line">                LedBuff[0] = LedChar[sec/100000];</span><br><span class="line">                LedBuff[1] = LedChar[sec%100000/10000];</span><br><span class="line">                LedBuff[2] = LedChar[sec%100000%10000/1000];</span><br><span class="line">                LedBuff[3] = LedChar[sec%100000%10000%1000/100];</span><br><span class="line">                LedBuff[4] = LedChar[sec%100000%10000%1000%100/10];</span><br><span class="line">                LedBuff[5] = LedChar[sec%100000%10000%1000%100%10];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//å»¶æ—¶å‡½æ•°</span><br><span class="line">void delay(int xms)</span><br><span class="line">&#123;</span><br><span class="line">unsigned int i,j;</span><br><span class="line">for(i=xms;i&gt;0;i--)</span><br><span class="line">for(j=110;j&gt;0;j--);</span><br><span class="line">&#125;</span><br><span class="line">void main()&#123;</span><br><span class="line">    unsigned char i = 0;  //åŠ¨æ€æ‰«æçš„ç´¢å¼•      </span><br><span class="line">    ENLED = 0;  //ä½¿èƒ½ U3ï¼Œé€‰æ‹©æ§åˆ¶æ•°ç ç®¡</span><br><span class="line">    ADDR3 = 1; //å› ä¸ºéœ€è¦åŠ¨æ€æ”¹å˜ ADDR0-2 çš„å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦å†åˆå§‹åŒ–äº†</span><br><span class="line">   </span><br><span class="line">    TMOD = 0x01;  //è®¾ç½® T0 ä¸ºæ¨¡å¼ 1</span><br><span class="line">    TL0 = T50MS;                     //initial timer0 low byte</span><br><span class="line">    TH0 = T50MS &gt;&gt; 8; </span><br><span class="line">TR0 = 1;                        //timer0 start running</span><br><span class="line">    ET0 = 1;                        //enable timer0 interrupt</span><br><span class="line">    EA = 1;                         //open global interrupt switch</span><br><span class="line"></span><br><span class="line">    while (1)&#123;</span><br><span class="line">            //ä»¥ä¸‹ä»£ç å®Œæˆæ•°ç ç®¡åŠ¨æ€æ‰«æåˆ·æ–°</span><br><span class="line">            switch (i)&#123;</span><br><span class="line">                case 0: ENLED=1;ADDR2=0; ADDR1=0; ADDR0=0; i++; P0=LedBuff[0]; delay(5);ENLED=0;break;</span><br><span class="line">                case 1: ENLED=1;ADDR2=0; ADDR1=0; ADDR0=1; i++; P0=LedBuff[1]; delay(5);ENLED=0;break;</span><br><span class="line">                case 2: ENLED=1;ADDR2=0; ADDR1=1; ADDR0=0; i++; P0=LedBuff[2]; delay(5);ENLED=0;break;</span><br><span class="line">                case 3: ENLED=1;ADDR2=0; ADDR1=1; ADDR0=1; i++; P0=LedBuff[3]; delay(5);ENLED=0;break;</span><br><span class="line">                case 4: ENLED=1;ADDR2=1; ADDR1=0; ADDR0=0; i++; P0=LedBuff[4]; delay(5);ENLED=0;break;</span><br><span class="line">                case 5: ENLED=1;ADDR2=1; ADDR1=0; ADDR0=1; i=0; P0=LedBuff[5]; delay(5);ENLED=0;break;</span><br><span class="line">                default: break;</span><br><span class="line">            &#125; </span><br><span class="line">P0=0xFF;//æ¶ˆéš</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *0-999999ç§’è¡¨</p><ul><li>Created:   å‘¨å›› 6æœˆ 14 2022</li><li>Processor: AT89C52</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include &lt;reg52.h&gt;<br>#define FOSC 12000000uL<br>&#x2F;&#x2F;#define T50MS 15536  &#x2F;&#x2F;50ms timer calculation method in 12T mode<br>#define T50MS (65536-FOSC<em>50&#x2F;12&#x2F;1000)   &#x2F;&#x2F;1ms</em>50 timer calculation method in 12T mode</p><p>sbit ADDR0 &#x3D; P1^0;<br>sbit ADDR1 &#x3D; P1^1;<br>sbit ADDR2 &#x3D; P1^2;<br>sbit ADDR3 &#x3D; P1^3;<br>sbit ENLED &#x3D; P1^4;<br>sbit led &#x3D; P1^5;<br>unsigned char code LedChar[] &#x3D; {  &#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦è½¬æ¢è¡¨<br>    0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8,<br>    0x80, 0x90, 0x88, 0x83, 0xC6, 0xA1, 0x86, 0x8E<br>};<br>unsigned char LedBuff[6] &#x3D; { &#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºç¼“å†²åŒºï¼Œåˆå€¼ 0xFF ç¡®ä¿å¯åŠ¨æ—¶éƒ½ä¸äº®<br>    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF<br>};<br>    unsigned int cnt &#x3D; 0; &#x2F;&#x2F;è®°å½• T0 ä¸­æ–­æ¬¡æ•°<br>    unsigned long sec &#x3D; 0; &#x2F;&#x2F;è®°å½•ç»è¿‡çš„ç§’æ•°<br>void tm0_isr() interrupt 1<br>{<br>    TL0 &#x3D; T50MS;                     &#x2F;&#x2F;reload timer0 low byte<br>    TH0 &#x3D; T50MS &gt;&gt; 8;                &#x2F;&#x2F;reload timer0 high byte<br>    if (cntâ€“ &#x3D;&#x3D; 0)               &#x2F;&#x2F;1ms * 1000 -&gt; 1s<br>    {<br>        cnt &#x3D; 20;               &#x2F;&#x2F;reset counter<br>        sec++;  &#x2F;&#x2F;ç§’è®¡æ•°è‡ªåŠ  1<br>        led &#x3D; ! led;      &#x2F;&#x2F;work LED flash<br>                &#x2F;&#x2F;ä»¥ä¸‹ä»£ç å°† sec æŒ‰åè¿›åˆ¶ä½ä»ä½åˆ°é«˜ä¾æ¬¡æå–å¹¶è½¬ä¸ºæ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦<br>                LedBuff[0] &#x3D; LedChar[sec&#x2F;100000];<br>                LedBuff[1] &#x3D; LedChar[sec%100000&#x2F;10000];<br>                LedBuff[2] &#x3D; LedChar[sec%100000%10000&#x2F;1000];<br>                LedBuff[3] &#x3D; LedChar[sec%100000%10000%1000&#x2F;100];<br>                LedBuff[4] &#x3D; LedChar[sec%100000%10000%1000%100&#x2F;10];<br>                LedBuff[5] &#x3D; LedChar[sec%100000%10000%1000%100%10];<br>    }<br>}<br>&#x2F;&#x2F;å»¶æ—¶å‡½æ•°<br>void delay(int xms)<br>{<br>    unsigned int i,j;<br>    for(i&#x3D;xms;i&gt;0;iâ€“)<br>        for(j&#x3D;110;j&gt;0;jâ€“);<br>}<br>void main(){<br>    unsigned char i &#x3D; 0;  &#x2F;&#x2F;åŠ¨æ€æ‰«æçš„ç´¢å¼•<br>    ENLED &#x3D; 0;  &#x2F;&#x2F;ä½¿èƒ½ U3ï¼Œé€‰æ‹©æ§åˆ¶æ•°ç ç®¡<br>    ADDR3 &#x3D; 1; &#x2F;&#x2F;å› ä¸ºéœ€è¦åŠ¨æ€æ”¹å˜ ADDR0-2 çš„å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦å†åˆå§‹åŒ–äº†</p><pre><code>TMOD = 0x01;  //è®¾ç½® T0 ä¸ºæ¨¡å¼ 1TL0 = T50MS;                     //initial timer0 low byteTH0 = T50MS &gt;&gt; 8; TR0 = 1;                        //timer0 start runningET0 = 1;                        //enable timer0 interruptEA = 1;                         //open global interrupt switchwhile (1)&#123;        //ä»¥ä¸‹ä»£ç å®Œæˆæ•°ç ç®¡åŠ¨æ€æ‰«æåˆ·æ–°        switch (i)&#123;            case 0: ENLED=1;ADDR2=0; ADDR1=0; ADDR0=0; i++; P0=LedBuff[0]; delay(5);ENLED=0;break;            case 1: ENLED=1;ADDR2=0; ADDR1=0; ADDR0=1; i++; P0=LedBuff[1]; delay(5);ENLED=0;break;            case 2: ENLED=1;ADDR2=0; ADDR1=1; ADDR0=0; i++; P0=LedBuff[2]; delay(5);ENLED=0;break;            case 3: ENLED=1;ADDR2=0; ADDR1=1; ADDR0=1; i++; P0=LedBuff[3]; delay(5);ENLED=0;break;            case 4: ENLED=1;ADDR2=1; ADDR1=0; ADDR0=0; i++; P0=LedBuff[4]; delay(5);ENLED=0;break;            case 5: ENLED=1;ADDR2=1; ADDR1=0; ADDR0=1; i=0; P0=LedBuff[5]; delay(5);ENLED=0;break;            default: break;        &#125;         P0=0xFF;//æ¶ˆéš</code></pre><p>}<br>}&#96;</p><h4 id="ğŸ“šä¾‹ç¨‹ä¸€ä»¿çœŸèµ„æº"><a href="#ğŸ“šä¾‹ç¨‹ä¸€ä»¿çœŸèµ„æº" class="headerlink" title="ğŸ“šä¾‹ç¨‹ä¸€ä»¿çœŸèµ„æº"></a>ğŸ“šä¾‹ç¨‹ä¸€ä»¿çœŸèµ„æº</h4><ul><li>ğŸ”– æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ï¼Œä¿ç•™Keilå·¥ç¨‹ã€‚</li></ul><p><code>Proteus8.12</code></p><p><img src="https://img-blog.csdnimg.cn/d0a6d5a5b6b9417fb6cee789ee5eba92.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zx1Y9I5MAs6erV6hgEQ4TQ </span><br><span class="line">æå–ç ï¼šgbij</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zx1Y9I5MAs6erV6hgEQ4TQ  æå–ç ï¼šgbij</code></p><h4 id="ğŸ““ä¾‹ç¨‹äºŒ"><a href="#ğŸ““ä¾‹ç¨‹äºŒ" class="headerlink" title="ğŸ““ä¾‹ç¨‹äºŒ"></a>ğŸ““ä¾‹ç¨‹äºŒ</h4><ul><li>ğŸ“‹å°†æ•°ç ç®¡çš„ä¸€ä¸ªä½ç”¨äºæ¯«ç§’è®¡æ•°æ˜¾ç¤ºã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line"></span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line">uchar Count;</span><br><span class="line">sbit Dot = P0^7;</span><br><span class="line">uchar code DSY_CODE[]=</span><br><span class="line">&#123;</span><br><span class="line"> 0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f</span><br><span class="line">&#125;;//å…±é˜´æ•°ç ç®¡æ–­ç ï¼š0 - 9</span><br><span class="line"></span><br><span class="line">uchar Digits_of_6DSY[]=&#123;0,0,0,0,0,0&#125;;//ä½é€‰æ˜¾ç¤º</span><br><span class="line"></span><br><span class="line">void Delayms(uint x)</span><br><span class="line">&#123;</span><br><span class="line"> uchar i;</span><br><span class="line">while(--x)</span><br><span class="line">&#123;</span><br><span class="line"> for(i=0;i&lt;120;i++);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> uchar i,j;</span><br><span class="line">P0 = 0x00;</span><br><span class="line">P3 = 0xff;</span><br><span class="line">Count =0;</span><br><span class="line">TMOD = 0x01;</span><br><span class="line">TH0  = (65535-50000)/256;</span><br><span class="line">TL0  = (65535-50000)%256;</span><br><span class="line">IE = 0x82;</span><br><span class="line">TR0 = 1;</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line"> j = 0x7f;</span><br><span class="line">for(i=5;i!=-1;i--)</span><br><span class="line">&#123;</span><br><span class="line"> j=_crol_(j,1);</span><br><span class="line">P3 = j;</span><br><span class="line">P0 = DSY_CODE[Digits_of_6DSY[i]];</span><br><span class="line">if(i==1) P0 |= 0x80;</span><br><span class="line">Delayms(2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Time0() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line"> uchar i;</span><br><span class="line">TH0  = (65535-50000)/256;</span><br><span class="line">TL0  = (65535-50000)%256;</span><br><span class="line">if(++Count !=2) return;</span><br><span class="line">Count = 0;</span><br><span class="line">Digits_of_6DSY[0]++;</span><br><span class="line">for(i=0;i&lt;=5;i++)</span><br><span class="line">&#123;</span><br><span class="line"> if(Digits_of_6DSY[i] == 10)</span><br><span class="line">&#123;</span><br><span class="line"> Digits_of_6DSY[i] = 0;</span><br><span class="line">if(i != 5) Digits_of_6DSY[i+1]++;</span><br><span class="line">&#125;</span><br><span class="line">else break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;</p><p>#define uchar unsigned char<br>#define uint unsigned int<br>uchar Count;<br>sbit Dot &#x3D; P0^7;<br>uchar code DSY_CODE[]&#x3D;<br>{<br>     0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f<br>};&#x2F;&#x2F;å…±é˜´æ•°ç ç®¡æ–­ç ï¼š0 - 9</p><p>uchar Digits_of_6DSY[]&#x3D;{0,0,0,0,0,0};&#x2F;&#x2F;ä½é€‰æ˜¾ç¤º</p><p>void Delayms(uint x)<br>{<br>     uchar i;<br>    while(â€“x)<br>    {<br>     for(i&#x3D;0;i&lt;120;i++);<br>    }<br>}</p><p>void main()<br>{<br>     uchar i,j;<br>    P0 &#x3D; 0x00;<br>    P3 &#x3D; 0xff;<br>    Count &#x3D;0;<br>    TMOD &#x3D; 0x01;<br>    TH0  &#x3D; (65535-50000)&#x2F;256;<br>    TL0  &#x3D; (65535-50000)%256;<br>    IE &#x3D; 0x82;<br>    TR0 &#x3D; 1;<br>    while(1)<br>    {<br>     j &#x3D; 0x7f;<br>        for(i&#x3D;5;i!&#x3D;-1;iâ€“)<br>        {<br>         j&#x3D;<em>crol</em>(j,1);<br>            P3 &#x3D; j;<br>            P0 &#x3D; DSY_CODE[Digits_of_6DSY[i]];<br>            if(i&#x3D;&#x3D;1) P0 |&#x3D; 0x80;<br>            Delayms(2);<br>        }<br>    }<br>}</p><p>void Time0() interrupt 1<br>{<br>     uchar i;<br>    TH0  &#x3D; (65535-50000)&#x2F;256;<br>    TL0  &#x3D; (65535-50000)%256;<br>    if(++Count !&#x3D;2) return;<br>    Count &#x3D; 0;<br>    Digits_of_6DSY[0]++;<br>    for(i&#x3D;0;i&lt;&#x3D;5;i++)<br>    {<br>     if(Digits_of_6DSY[i] &#x3D;&#x3D; 10)<br>        {<br>         Digits_of_6DSY[i] &#x3D; 0;<br>            if(i !&#x3D; 5) Digits_of_6DSY[i+1]++;<br>        }<br>        else break;<br>    }<br>}&#96;</p><h4 id="ğŸä¾‹ç¨‹äºŒèµ„æºæ–‡ä»¶"><a href="#ğŸä¾‹ç¨‹äºŒèµ„æºæ–‡ä»¶" class="headerlink" title="ğŸä¾‹ç¨‹äºŒèµ„æºæ–‡ä»¶"></a>ğŸä¾‹ç¨‹äºŒèµ„æºæ–‡ä»¶</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1bn7GZ5WHI84OFwny6RPSIg </span><br><span class="line">æå–ç ï¼šebaf</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1bn7GZ5WHI84OFwny6RPSIg  æå–ç ï¼šebaf</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F4X4%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE%E6%98%BE%E7%A4%BA0F/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F4X4%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE%E6%98%BE%E7%A4%BA0F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F"><a href="#ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F"></a>ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F</h1><h3 id="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F-1"><a href="#ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F"></a>ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F</h3><ul><li>æœ¬å®éªŒåŸºäºProteus VSM Studioä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/0f21322ffbd2419e91106a8d0757b483.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="VSM-Studioç¨‹åºä»£ç "><a href="#VSM-Studioç¨‹åºä»£ç " class="headerlink" title="VSM Studioç¨‹åºä»£ç "></a>VSM Studioç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> * 4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F</span><br><span class="line"> * Created:   å‘¨ä¸‰ 6æœˆ 15 2022</span><br><span class="line"> * Processor: AT89C52</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">sbit ADDR0 = P1^0;</span><br><span class="line">sbit ADDR1 = P1^1;</span><br><span class="line">sbit ADDR2 = P1^2;</span><br><span class="line">sbit ADDR3 = P1^3;</span><br><span class="line">sbit ENLED = P1^4;</span><br><span class="line">sbit KEY_IN_1 = P2^4;</span><br><span class="line">sbit KEY_IN_2 = P2^5;</span><br><span class="line">sbit KEY_IN_3 = P2^6;</span><br><span class="line">sbit KEY_IN_4 = P2^7;</span><br><span class="line">sbit KEY_OUT_1 = P2^3;</span><br><span class="line">sbit KEY_OUT_2 = P2^2;</span><br><span class="line">sbit KEY_OUT_3 = P2^1;</span><br><span class="line">sbit KEY_OUT_4 = P2^0;</span><br><span class="line">unsigned char code LedChar[] = &#123; //æ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦è½¬æ¢è¡¨</span><br><span class="line"> 0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8,</span><br><span class="line"> 0x80, 0x90, 0x88, 0x83, 0xC6, 0xA1, 0x86, 0x8E</span><br><span class="line">&#125;;</span><br><span class="line">unsigned char KeySta[4][4] = &#123; //å…¨éƒ¨çŸ©é˜µæŒ‰é”®çš„å½“å‰çŠ¶æ€</span><br><span class="line"> &#123;1, 1, 1, 1&#125;, &#123;1, 1, 1, 1&#125;, &#123;1, 1, 1, 1&#125;, &#123;1, 1, 1, 1&#125;</span><br><span class="line">&#125;;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> unsigned char i, j;</span><br><span class="line"> unsigned char backup[4][4] = &#123; //æŒ‰é”®å€¼å¤‡ä»½ï¼Œä¿å­˜å‰ä¸€æ¬¡çš„å€¼</span><br><span class="line"> &#123;1, 1, 1, 1&#125;, &#123;1, 1, 1, 1&#125;, &#123;1, 1, 1, 1&#125;, &#123;1, 1, 1, 1&#125;</span><br><span class="line"> &#125;;</span><br><span class="line">EA = 1; //ä½¿èƒ½æ€»ä¸­æ–­</span><br><span class="line"> ENLED = 0; //é€‰æ‹©æ•°ç ç®¡ DS1 è¿›è¡Œæ˜¾ç¤º</span><br><span class="line"> ADDR3 = 1;</span><br><span class="line"> ADDR2 = 0;</span><br><span class="line"> ADDR1 = 0;</span><br><span class="line"> ADDR0 = 0;</span><br><span class="line"> TMOD = 0x01; //è®¾ç½® T0 ä¸ºæ¨¡å¼ 1</span><br><span class="line"> TH0 = 0xFC; //ä¸º T0 èµ‹åˆå€¼ 0xFC67ï¼Œå®šæ—¶ 1ms</span><br><span class="line"> TL0 = 0x67;</span><br><span class="line"> ET0 = 1; //ä½¿èƒ½ T0 ä¸­æ–­</span><br><span class="line"> TR0 = 1; //å¯åŠ¨ T0</span><br><span class="line"> P0 = LedChar[0]; //é»˜è®¤æ˜¾ç¤º 0</span><br><span class="line"> while (1)</span><br><span class="line"> &#123;</span><br><span class="line"> for (i=0; i&lt;4; i++) //å¾ªç¯æ£€æµ‹ 4*4 çš„çŸ©é˜µæŒ‰é”®</span><br><span class="line"> &#123;</span><br><span class="line"> for (j=0; j&lt;4; j++)</span><br><span class="line"> &#123;</span><br><span class="line"> if (backup[i][j] != KeySta[i][j]) //æ£€æµ‹æŒ‰é”®åŠ¨ä½œ</span><br><span class="line"> &#123;</span><br><span class="line"> if (backup[i][j] != 0) //æŒ‰é”®æŒ‰ä¸‹æ—¶æ‰§è¡ŒåŠ¨ä½œ</span><br><span class="line"> &#123;</span><br><span class="line"> P0 = LedChar[i*4+j]; //å°†ç¼–å·æ˜¾ç¤ºåˆ°æ•°ç ç®¡</span><br><span class="line"> &#125;</span><br><span class="line"> backup[i][j] = KeySta[i][j]; //æ›´æ–°å‰ä¸€æ¬¡çš„å¤‡ä»½å€¼</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">/* T0 ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œæ‰«æçŸ©é˜µæŒ‰é”®çŠ¶æ€å¹¶æ¶ˆæŠ– */</span><br><span class="line">void InterruptTimer0() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line"> unsigned char i;</span><br><span class="line"> static unsigned char keyout = 0; //çŸ©é˜µæŒ‰é”®æ‰«æè¾“å‡ºç´¢å¼•</span><br><span class="line"> static unsigned char keybuf[4][4] = &#123; //çŸ©é˜µæŒ‰é”®æ‰«æç¼“å†²åŒº</span><br><span class="line"> &#123;0xFF, 0xFF, 0xFF, 0xFF&#125;, &#123;0xFF, 0xFF, 0xFF, 0xFF&#125;,</span><br><span class="line"> &#123;0xFF, 0xFF, 0xFF, 0xFF&#125;, &#123;0xFF, 0xFF, 0xFF, 0xFF&#125;</span><br><span class="line"> &#125;;</span><br><span class="line"> </span><br><span class="line"> TH0 = 0xFC; //é‡æ–°åŠ è½½åˆå€¼</span><br><span class="line"> TL0 = 0x67;</span><br><span class="line">//å°†ä¸€è¡Œçš„ 4 ä¸ªæŒ‰é”®å€¼ç§»å…¥ç¼“å†²åŒº</span><br><span class="line"> keybuf[keyout][0] = (keybuf[keyout][0] &lt;&lt; 1) | KEY_IN_1;</span><br><span class="line"> keybuf[keyout][1] = (keybuf[keyout][1] &lt;&lt; 1) | KEY_IN_2;</span><br><span class="line"> keybuf[keyout][2] = (keybuf[keyout][2] &lt;&lt; 1) | KEY_IN_3;</span><br><span class="line"> keybuf[keyout][3] = (keybuf[keyout][3] &lt;&lt; 1) | KEY_IN_4;</span><br><span class="line"> //æ¶ˆæŠ–åæ›´æ–°æŒ‰é”®çŠ¶æ€</span><br><span class="line"> for (i=0; i&lt;4; i++) //æ¯è¡Œ 4 ä¸ªæŒ‰é”®ï¼Œæ‰€ä»¥å¾ªç¯ 4 æ¬¡</span><br><span class="line"> &#123;</span><br><span class="line"> if ((keybuf[keyout][i] &amp; 0x0F) == 0x00)</span><br><span class="line"> &#123; //è¿ç»­ 4 æ¬¡æ‰«æå€¼ä¸º 0ï¼Œå³ 4*4ms å†…éƒ½æ˜¯æŒ‰ä¸‹çŠ¶æ€æ—¶ï¼Œå¯è®¤ä¸ºæŒ‰é”®å·²ç¨³å®šçš„æŒ‰ä¸‹</span><br><span class="line"> KeySta[keyout][i] = 0;</span><br><span class="line"> &#125;</span><br><span class="line"> else if ((keybuf[keyout][i] &amp; 0x0F) == 0x0F)</span><br><span class="line"> &#123; //è¿ç»­ 4 æ¬¡æ‰«æå€¼ä¸º 1ï¼Œå³ 4*4ms å†…éƒ½æ˜¯å¼¹èµ·çŠ¶æ€æ—¶ï¼Œå¯è®¤ä¸ºæŒ‰é”®å·²ç¨³å®šçš„å¼¹èµ·</span><br><span class="line"> KeySta[keyout][i] = 1;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> //æ‰§è¡Œä¸‹ä¸€æ¬¡çš„æ‰«æè¾“å‡º</span><br><span class="line"> keyout++; //è¾“å‡ºç´¢å¼•é€’å¢</span><br><span class="line"> keyout = keyout &amp; 0x03; //ç´¢å¼•å€¼åŠ åˆ° 4 å³å½’é›¶</span><br><span class="line"> switch (keyout) //æ ¹æ®ç´¢å¼•ï¼Œé‡Šæ”¾å½“å‰è¾“å‡ºå¼•è„šï¼Œæ‹‰ä½ä¸‹æ¬¡çš„è¾“å‡ºå¼•è„š</span><br><span class="line"> &#123;</span><br><span class="line"> case 0: KEY_OUT_4 = 1; KEY_OUT_1 = 0; break;</span><br><span class="line"> case 1: KEY_OUT_1 = 1; KEY_OUT_2 = 0; break;</span><br><span class="line"> case 2: KEY_OUT_2 = 1; KEY_OUT_3 = 0; break;</span><br><span class="line"> case 3: KEY_OUT_3 = 1; KEY_OUT_4 = 0; break;</span><br><span class="line"> default: break;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard</p><ul><li>4X4çŸ©é˜µæŒ‰é”®æ˜¾ç¤º0-F</li><li>Created:   å‘¨ä¸‰ 6æœˆ 15 2022</li><li>Processor: AT89C52</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include &lt;reg52.h&gt;<br>sbit ADDR0 &#x3D; P1^0;<br>sbit ADDR1 &#x3D; P1^1;<br>sbit ADDR2 &#x3D; P1^2;<br>sbit ADDR3 &#x3D; P1^3;<br>sbit ENLED &#x3D; P1^4;<br>sbit KEY_IN_1 &#x3D; P2^4;<br>sbit KEY_IN_2 &#x3D; P2^5;<br>sbit KEY_IN_3 &#x3D; P2^6;<br>sbit KEY_IN_4 &#x3D; P2^7;<br>sbit KEY_OUT_1 &#x3D; P2^3;<br>sbit KEY_OUT_2 &#x3D; P2^2;<br>sbit KEY_OUT_3 &#x3D; P2^1;<br>sbit KEY_OUT_4 &#x3D; P2^0;<br>unsigned char code LedChar[] &#x3D; { &#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦è½¬æ¢è¡¨<br> 0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8,<br> 0x80, 0x90, 0x88, 0x83, 0xC6, 0xA1, 0x86, 0x8E<br>};<br>unsigned char KeySta[4][4] &#x3D; { &#x2F;&#x2F;å…¨éƒ¨çŸ©é˜µæŒ‰é”®çš„å½“å‰çŠ¶æ€<br> {1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}<br>};<br>void main()<br>{<br> unsigned char i, j;<br> unsigned char backup[4][4] &#x3D; { &#x2F;&#x2F;æŒ‰é”®å€¼å¤‡ä»½ï¼Œä¿å­˜å‰ä¸€æ¬¡çš„å€¼<br> {1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}, {1, 1, 1, 1}<br> };<br>EA &#x3D; 1; &#x2F;&#x2F;ä½¿èƒ½æ€»ä¸­æ–­<br> ENLED &#x3D; 0; &#x2F;&#x2F;é€‰æ‹©æ•°ç ç®¡ DS1 è¿›è¡Œæ˜¾ç¤º<br> ADDR3 &#x3D; 1;<br> ADDR2 &#x3D; 0;<br> ADDR1 &#x3D; 0;<br> ADDR0 &#x3D; 0;<br> TMOD &#x3D; 0x01; &#x2F;&#x2F;è®¾ç½® T0 ä¸ºæ¨¡å¼ 1<br> TH0 &#x3D; 0xFC; &#x2F;&#x2F;ä¸º T0 èµ‹åˆå€¼ 0xFC67ï¼Œå®šæ—¶ 1ms<br> TL0 &#x3D; 0x67;<br> ET0 &#x3D; 1; &#x2F;&#x2F;ä½¿èƒ½ T0 ä¸­æ–­<br> TR0 &#x3D; 1; &#x2F;&#x2F;å¯åŠ¨ T0<br> P0 &#x3D; LedChar[0]; &#x2F;&#x2F;é»˜è®¤æ˜¾ç¤º 0<br> while (1)<br> {<br> for (i&#x3D;0; i&lt;4; i++) &#x2F;&#x2F;å¾ªç¯æ£€æµ‹ 4<em>4 çš„çŸ©é˜µæŒ‰é”®<br> {<br> for (j&#x3D;0; j&lt;4; j++)<br> {<br> if (backup[i][j] !&#x3D; KeySta[i][j]) &#x2F;&#x2F;æ£€æµ‹æŒ‰é”®åŠ¨ä½œ<br> {<br> if (backup[i][j] !&#x3D; 0) &#x2F;&#x2F;æŒ‰é”®æŒ‰ä¸‹æ—¶æ‰§è¡ŒåŠ¨ä½œ<br> {<br> P0 &#x3D; LedChar[i</em>4+j]; &#x2F;&#x2F;å°†ç¼–å·æ˜¾ç¤ºåˆ°æ•°ç ç®¡<br> }<br> backup[i][j] &#x3D; KeySta[i][j]; &#x2F;&#x2F;æ›´æ–°å‰ä¸€æ¬¡çš„å¤‡ä»½å€¼<br> }<br> }<br> }<br> }<br>}<br>&#x2F;* T0 ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œæ‰«æçŸ©é˜µæŒ‰é”®çŠ¶æ€å¹¶æ¶ˆæŠ– *&#x2F;<br>void InterruptTimer0() interrupt 1<br>{<br> unsigned char i;<br> static unsigned char keyout &#x3D; 0; &#x2F;&#x2F;çŸ©é˜µæŒ‰é”®æ‰«æè¾“å‡ºç´¢å¼•<br> static unsigned char keybuf[4][4] &#x3D; { &#x2F;&#x2F;çŸ©é˜µæŒ‰é”®æ‰«æç¼“å†²åŒº<br> {0xFF, 0xFF, 0xFF, 0xFF}, {0xFF, 0xFF, 0xFF, 0xFF},<br> {0xFF, 0xFF, 0xFF, 0xFF}, {0xFF, 0xFF, 0xFF, 0xFF}<br> };</p><p> TH0 &#x3D; 0xFC; &#x2F;&#x2F;é‡æ–°åŠ è½½åˆå€¼<br> TL0 &#x3D; 0x67;<br>&#x2F;&#x2F;å°†ä¸€è¡Œçš„ 4 ä¸ªæŒ‰é”®å€¼ç§»å…¥ç¼“å†²åŒº<br> keybuf[keyout][0] &#x3D; (keybuf[keyout][0] &lt;&lt; 1) | KEY_IN_1;<br> keybuf[keyout][1] &#x3D; (keybuf[keyout][1] &lt;&lt; 1) | KEY_IN_2;<br> keybuf[keyout][2] &#x3D; (keybuf[keyout][2] &lt;&lt; 1) | KEY_IN_3;<br> keybuf[keyout][3] &#x3D; (keybuf[keyout][3] &lt;&lt; 1) | KEY_IN_4;<br> &#x2F;&#x2F;æ¶ˆæŠ–åæ›´æ–°æŒ‰é”®çŠ¶æ€<br> for (i&#x3D;0; i&lt;4; i++) &#x2F;&#x2F;æ¯è¡Œ 4 ä¸ªæŒ‰é”®ï¼Œæ‰€ä»¥å¾ªç¯ 4 æ¬¡<br> {<br> if ((keybuf[keyout][i] &amp; 0x0F) &#x3D;&#x3D; 0x00)<br> { &#x2F;&#x2F;è¿ç»­ 4 æ¬¡æ‰«æå€¼ä¸º 0ï¼Œå³ 4<em>4ms å†…éƒ½æ˜¯æŒ‰ä¸‹çŠ¶æ€æ—¶ï¼Œå¯è®¤ä¸ºæŒ‰é”®å·²ç¨³å®šçš„æŒ‰ä¸‹<br> KeySta[keyout][i] &#x3D; 0;<br> }<br> else if ((keybuf[keyout][i] &amp; 0x0F) &#x3D;&#x3D; 0x0F)<br> { &#x2F;&#x2F;è¿ç»­ 4 æ¬¡æ‰«æå€¼ä¸º 1ï¼Œå³ 4</em>4ms å†…éƒ½æ˜¯å¼¹èµ·çŠ¶æ€æ—¶ï¼Œå¯è®¤ä¸ºæŒ‰é”®å·²ç¨³å®šçš„å¼¹èµ·<br> KeySta[keyout][i] &#x3D; 1;<br> }<br> }<br> &#x2F;&#x2F;æ‰§è¡Œä¸‹ä¸€æ¬¡çš„æ‰«æè¾“å‡º<br> keyout++; &#x2F;&#x2F;è¾“å‡ºç´¢å¼•é€’å¢<br> keyout &#x3D; keyout &amp; 0x03; &#x2F;&#x2F;ç´¢å¼•å€¼åŠ åˆ° 4 å³å½’é›¶<br> switch (keyout) &#x2F;&#x2F;æ ¹æ®ç´¢å¼•ï¼Œé‡Šæ”¾å½“å‰è¾“å‡ºå¼•è„šï¼Œæ‹‰ä½ä¸‹æ¬¡çš„è¾“å‡ºå¼•è„š<br> {<br> case 0: KEY_OUT_4 &#x3D; 1; KEY_OUT_1 &#x3D; 0; break;<br> case 1: KEY_OUT_1 &#x3D; 1; KEY_OUT_2 &#x3D; 0; break;<br> case 2: KEY_OUT_2 &#x3D; 1; KEY_OUT_3 &#x3D; 0; break;<br> case 3: KEY_OUT_3 &#x3D; 1; KEY_OUT_4 &#x3D; 0; break;<br> default: break;<br> }<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1CW9FqVMqbrAo9GMZVIsIbQ </span><br><span class="line">æå–ç ï¼š9d3i</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1CW9FqVMqbrAo9GMZVIsIbQ  æå–ç ï¼š9d3i</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡è®¡æ—¶å™¨(0-10^5)</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F6%E4%BD%8D%E6%95%B0%E7%A0%81%E7%AE%A1%E8%AE%A1%E6%97%B6%E5%99%A80105/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F6%E4%BD%8D%E6%95%B0%E7%A0%81%E7%AE%A1%E8%AE%A1%E6%97%B6%E5%99%A80105/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡è®¡æ—¶å™¨-0-10-5"><a href="#ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡è®¡æ—¶å™¨-0-10-5" class="headerlink" title="ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡è®¡æ—¶å™¨(0-10^5)"></a>ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡è®¡æ—¶å™¨(0-10^5)</h1><h3 id="ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡è®¡æ—¶å™¨-0-105"><a href="#ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡è®¡æ—¶å™¨-0-105" class="headerlink" title="ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡è®¡æ—¶å™¨(0-105)"></a>ã€Proteusä»¿çœŸã€‘6ä½æ•°ç ç®¡è®¡æ—¶å™¨(0-105)</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/7c805e45d5d54488b8c40d46194cd699.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä»¿çœŸéš¾ç‚¹ï¼Œå¦‚ä½•æ§åˆ¶æ•°å­—æ˜¾ç¤ºæ—¶ä¸é—ªå±é—®é¢˜"><a href="#ä»¿çœŸéš¾ç‚¹ï¼Œå¦‚ä½•æ§åˆ¶æ•°å­—æ˜¾ç¤ºæ—¶ä¸é—ªå±é—®é¢˜" class="headerlink" title="ä»¿çœŸéš¾ç‚¹ï¼Œå¦‚ä½•æ§åˆ¶æ•°å­—æ˜¾ç¤ºæ—¶ä¸é—ªå±é—®é¢˜"></a>ä»¿çœŸéš¾ç‚¹ï¼Œå¦‚ä½•æ§åˆ¶æ•°å­—æ˜¾ç¤ºæ—¶ä¸é—ªå±é—®é¢˜</h4><h5 id="æ•°ç ç®¡ç¬¬ä¸€ä½æ˜¾ç¤ºçš„æ˜¯100æ¯«ç§’é€’å¢-1çš„æ¨¡å¼ï¼Œ2-6ä½æ˜¯æ¯ç§’è®¡æ•°ï¼Œ"><a href="#æ•°ç ç®¡ç¬¬ä¸€ä½æ˜¾ç¤ºçš„æ˜¯100æ¯«ç§’é€’å¢-1çš„æ¨¡å¼ï¼Œ2-6ä½æ˜¯æ¯ç§’è®¡æ•°ï¼Œ" class="headerlink" title="æ•°ç ç®¡ç¬¬ä¸€ä½æ˜¾ç¤ºçš„æ˜¯100æ¯«ç§’é€’å¢+1çš„æ¨¡å¼ï¼Œ2-6ä½æ˜¯æ¯ç§’è®¡æ•°ï¼Œ"></a>æ•°ç ç®¡ç¬¬ä¸€ä½æ˜¾ç¤ºçš„æ˜¯100æ¯«ç§’é€’å¢+1çš„æ¨¡å¼ï¼Œ2-6ä½æ˜¯æ¯ç§’è®¡æ•°ï¼Œ</h5><h4 id="ç¨‹åºæºç "><a href="#ç¨‹åºæºç " class="headerlink" title="ç¨‹åºæºç "></a>ç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">/*6ä½æ•°ç ç®¡è®¡æ—¶å™¨*/</span><br><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line">uchar Count;</span><br><span class="line">sbit Dot = P0^7;</span><br><span class="line"></span><br><span class="line">uchar code DSY_CODE[]=</span><br><span class="line">&#123;</span><br><span class="line"> 0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">uchar Digits_of_6DSY[]=&#123;0,0,0,0,0,0&#125;;</span><br><span class="line"></span><br><span class="line">void DelayMS(uint x)</span><br><span class="line">&#123;</span><br><span class="line"> uchar i;</span><br><span class="line">while(--x)</span><br><span class="line">&#123;</span><br><span class="line"> for(i=0;i&lt;120;i++);//120</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> uchar i,j;</span><br><span class="line">P0 = 0x00;</span><br><span class="line">P2 = 0xff;</span><br><span class="line">Count =0;</span><br><span class="line">TMOD = 0x01;</span><br><span class="line">TH0  = (65535-50000)/256;</span><br><span class="line">TL0  = (65535-50000)%256;</span><br><span class="line">IE = 0x82;</span><br><span class="line">TR0 = 1;</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line"> j = 0x7f;</span><br><span class="line">for(i=6;i&gt;0;i--)</span><br><span class="line">&#123;</span><br><span class="line">P0 =0x00;//æ¶ˆéš</span><br><span class="line">P2 =0xff;</span><br><span class="line"> j=_crol_(j,1);</span><br><span class="line">P2 = j;</span><br><span class="line">P0 = DSY_CODE[Digits_of_6DSY[i-1]];</span><br><span class="line">if(i==2)&#123;</span><br><span class="line">P0 |= 0x80; //åŠ å°æ•°ç‚¹</span><br><span class="line">&#125;</span><br><span class="line">DelayMS(2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Time0() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line"> uchar i;</span><br><span class="line">TH0  = (65535-50000)/256;//50mså®šæ—¶åˆå€¼</span><br><span class="line">TL0  = (65535-50000)%256;</span><br><span class="line">if(++Count !=2) return;</span><br><span class="line">Count = 0;</span><br><span class="line">Digits_of_6DSY[0]++;//0.1sä½ç´¯åŠ </span><br><span class="line">for(i=0;i&lt;=5;i++)//è¿›ä½å¤„ç†</span><br><span class="line">&#123;</span><br><span class="line"> if(Digits_of_6DSY[i] == 10)</span><br><span class="line">&#123;</span><br><span class="line"> Digits_of_6DSY[i] = 0;</span><br><span class="line">if(i &lt; 5) Digits_of_6DSY[i+1]++; //å¦‚æœ0~4ä½åˆ™åˆ†åˆ«å‘é«˜ä¸€ä½è¿›ä½ </span><br><span class="line">&#125;</span><br><span class="line">else break;//è‹¥æŸä½ä½æ²¡æœ‰è¿›ä½ï¼Œåˆ™å¾ªç¯æå‰ç»“æŸ </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;<em>6ä½æ•°ç ç®¡è®¡æ—¶å™¨</em>&#x2F;<br>#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int<br>uchar Count;<br>sbit Dot &#x3D; P0^7;</p><p>uchar code DSY_CODE[]&#x3D;<br>{<br>     0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f<br>};</p><p>uchar Digits_of_6DSY[]&#x3D;{0,0,0,0,0,0};</p><p>void DelayMS(uint x)<br>{<br>     uchar i;<br>    while(â€“x)<br>    {<br>     for(i&#x3D;0;i&lt;120;i++);&#x2F;&#x2F;120<br>    }<br>}</p><p>void main()<br>{<br>     uchar i,j;<br>    P0 &#x3D; 0x00;<br>    P2 &#x3D; 0xff;<br>    Count &#x3D;0;<br>    TMOD &#x3D; 0x01;<br>    TH0  &#x3D; (65535-50000)&#x2F;256;<br>    TL0  &#x3D; (65535-50000)%256;<br>    IE &#x3D; 0x82;<br>    TR0 &#x3D; 1;<br>    while(1)<br>    {<br>     j &#x3D; 0x7f;<br>        for(i&#x3D;6;i&gt;0;iâ€“)<br>        {<br>                        P0 &#x3D;0x00;&#x2F;&#x2F;æ¶ˆéš<br>                        P2 &#x3D;0xff;<br>         j&#x3D;<em>crol</em>(j,1);<br>            P2 &#x3D; j;<br>            P0 &#x3D; DSY_CODE[Digits_of_6DSY[i-1]];<br>            if(i&#x3D;&#x3D;2){<br>            P0 |&#x3D; 0x80; &#x2F;&#x2F;åŠ å°æ•°ç‚¹<br>            }<br>                    DelayMS(2);<br>        }<br>    }<br>}</p><p>void Time0() interrupt 1<br>{<br>     uchar i;<br>    TH0  &#x3D; (65535-50000)&#x2F;256;&#x2F;&#x2F;50mså®šæ—¶åˆå€¼<br>    TL0  &#x3D; (65535-50000)%256;<br>    if(++Count !&#x3D;2) return;<br>    Count &#x3D; 0;<br>    Digits_of_6DSY[0]++;&#x2F;&#x2F;0.1sä½ç´¯åŠ <br>    for(i&#x3D;0;i&lt;&#x3D;5;i++)&#x2F;&#x2F;è¿›ä½å¤„ç†<br>    {<br>     if(Digits_of_6DSY[i] &#x3D;&#x3D; 10)<br>        {<br>         Digits_of_6DSY[i] &#x3D; 0;<br>            if(i &lt; 5) Digits_of_6DSY[i+1]++; &#x2F;&#x2F;å¦‚æœ0~4ä½åˆ™åˆ†åˆ«å‘é«˜ä¸€ä½è¿›ä½<br>        }<br>        else break;&#x2F;&#x2F;è‹¥æŸä½ä½æ²¡æœ‰è¿›ä½ï¼Œåˆ™å¾ªç¯æå‰ç»“æŸ<br>    }<br>}&#96;</p><h4 id="æœ‰é—®é¢˜çš„ç¨‹åºä»£ç "><a href="#æœ‰é—®é¢˜çš„ç¨‹åºä»£ç " class="headerlink" title="æœ‰é—®é¢˜çš„ç¨‹åºä»£ç "></a>æœ‰é—®é¢˜çš„ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">/*6ä½æ•°ç ç®¡è®¡æ—¶å™¨*/</span><br><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line">uchar Count;</span><br><span class="line">sbit Dot = P0^7;</span><br><span class="line">uchar code DSY_CODE[]=</span><br><span class="line">&#123;</span><br><span class="line"> 0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">uchar Digits_of_6DSY[]=&#123;0,0,0,0,0,0&#125;;</span><br><span class="line"></span><br><span class="line">void DelayMS(uint x)</span><br><span class="line">&#123;</span><br><span class="line"> uchar i;</span><br><span class="line">while(--x)</span><br><span class="line">&#123;</span><br><span class="line"> for(i=0;i&lt;120;i++);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> uchar i,j;</span><br><span class="line">P0 = 0x00;</span><br><span class="line">P3 = 0xff;</span><br><span class="line">Count =0;</span><br><span class="line">TMOD = 0x01;</span><br><span class="line">TH0  = (65535-50000)/256;</span><br><span class="line">TL0  = (65535-50000)%256;</span><br><span class="line">IE = 0x82;</span><br><span class="line">TR0 = 1;</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line"> j = 0x7f;</span><br><span class="line"> //å‰é¢é«˜ä½ï¼Œåé¢ä½ä½ï¼Œå¾ªç¯ä¸­ i!=-1 äº¦å¯å†™æˆ i!=0xff</span><br><span class="line">for(i=5;i!=-1;i--)</span><br><span class="line">&#123;</span><br><span class="line"> j=_crol_(j,1);</span><br><span class="line">P3 = j;</span><br><span class="line">P0 = DSY_CODE[Digits_of_6DSY[i]];</span><br><span class="line">if(i==1) P0 |= 0x80;</span><br><span class="line">DelayMS(2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Time0() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line"> uchar i;</span><br><span class="line">TH0  = (65535-50000)/256;</span><br><span class="line">TL0  = (65535-50000)%256;</span><br><span class="line">if(++Count !=2) return;</span><br><span class="line">Count = 0;</span><br><span class="line">Digits_of_6DSY[0]++;</span><br><span class="line">for(i=0;i&lt;=5;i++)</span><br><span class="line">&#123;</span><br><span class="line"> if(Digits_of_6DSY[i] == 10)</span><br><span class="line">&#123;</span><br><span class="line"> Digits_of_6DSY[i] = 0;</span><br><span class="line">if(i != 5) Digits_of_6DSY[i+1]++;</span><br><span class="line">&#125;</span><br><span class="line">else break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;<em>6ä½æ•°ç ç®¡è®¡æ—¶å™¨</em>&#x2F;<br>#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int<br>uchar Count;<br>sbit Dot &#x3D; P0^7;<br>uchar code DSY_CODE[]&#x3D;<br>{<br>     0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f<br>};</p><p>uchar Digits_of_6DSY[]&#x3D;{0,0,0,0,0,0};</p><p>void DelayMS(uint x)<br>{<br>     uchar i;<br>    while(â€“x)<br>    {<br>     for(i&#x3D;0;i&lt;120;i++);<br>    }<br>}</p><p>void main()<br>{<br>     uchar i,j;<br>    P0 &#x3D; 0x00;<br>    P3 &#x3D; 0xff;<br>    Count &#x3D;0;<br>    TMOD &#x3D; 0x01;<br>    TH0  &#x3D; (65535-50000)&#x2F;256;<br>    TL0  &#x3D; (65535-50000)%256;<br>    IE &#x3D; 0x82;<br>    TR0 &#x3D; 1;<br>    while(1)<br>    {<br>     j &#x3D; 0x7f;<br>     &#x2F;&#x2F;å‰é¢é«˜ä½ï¼Œåé¢ä½ä½ï¼Œå¾ªç¯ä¸­ i!&#x3D;-1 äº¦å¯å†™æˆ i!&#x3D;0xff<br>        for(i&#x3D;5;i!&#x3D;-1;iâ€“)<br>        {<br>         j&#x3D;<em>crol</em>(j,1);<br>            P3 &#x3D; j;<br>            P0 &#x3D; DSY_CODE[Digits_of_6DSY[i]];<br>            if(i&#x3D;&#x3D;1) P0 |&#x3D; 0x80;<br>            DelayMS(2);<br>        }<br>    }<br>}</p><p>void Time0() interrupt 1<br>{<br>     uchar i;<br>    TH0  &#x3D; (65535-50000)&#x2F;256;<br>    TL0  &#x3D; (65535-50000)%256;<br>    if(++Count !&#x3D;2) return;<br>    Count &#x3D; 0;<br>    Digits_of_6DSY[0]++;<br>    for(i&#x3D;0;i&lt;&#x3D;5;i++)<br>    {<br>     if(Digits_of_6DSY[i] &#x3D;&#x3D; 10)<br>        {<br>         Digits_of_6DSY[i] &#x3D; 0;<br>            if(i !&#x3D; 5) Digits_of_6DSY[i+1]++;<br>        }<br>        else break;<br>    }<br>}&#96;</p><h4 id="é—®é¢˜ç‚¹æ€»ç»“å’Œåˆ†æ"><a href="#é—®é¢˜ç‚¹æ€»ç»“å’Œåˆ†æ" class="headerlink" title="é—®é¢˜ç‚¹æ€»ç»“å’Œåˆ†æ"></a>é—®é¢˜ç‚¹æ€»ç»“å’Œåˆ†æ</h4><h5 id="é—®é¢˜ä»£ç çš„è¿è¡Œå‡ºç°é—ªå±ï¼ŒåŸå› ï¼šä»£ç ä¸­æœ‰äº›è¯­å¥å¯èƒ½åœ¨Keilä»¥å¾€ä½ç‰ˆæœ¬ç¼–è¯‘çš„Hexæ–‡ä»¶ä»¿çœŸæ—¶è¿è¡Œå¯èƒ½æ²¡æœ‰é—®é¢˜ï¼Œåœ¨Keil5-37ç‰ˆæœ¬ç¼–è¯‘åï¼Œå°±å‡ºç°é—ªå±ã€‚"><a href="#é—®é¢˜ä»£ç çš„è¿è¡Œå‡ºç°é—ªå±ï¼ŒåŸå› ï¼šä»£ç ä¸­æœ‰äº›è¯­å¥å¯èƒ½åœ¨Keilä»¥å¾€ä½ç‰ˆæœ¬ç¼–è¯‘çš„Hexæ–‡ä»¶ä»¿çœŸæ—¶è¿è¡Œå¯èƒ½æ²¡æœ‰é—®é¢˜ï¼Œåœ¨Keil5-37ç‰ˆæœ¬ç¼–è¯‘åï¼Œå°±å‡ºç°é—ªå±ã€‚" class="headerlink" title="é—®é¢˜ä»£ç çš„è¿è¡Œå‡ºç°é—ªå±ï¼ŒåŸå› ï¼šä»£ç ä¸­æœ‰äº›è¯­å¥å¯èƒ½åœ¨Keilä»¥å¾€ä½ç‰ˆæœ¬ç¼–è¯‘çš„Hexæ–‡ä»¶ä»¿çœŸæ—¶è¿è¡Œå¯èƒ½æ²¡æœ‰é—®é¢˜ï¼Œåœ¨Keil5.37ç‰ˆæœ¬ç¼–è¯‘åï¼Œå°±å‡ºç°é—ªå±ã€‚"></a>é—®é¢˜ä»£ç çš„è¿è¡Œå‡ºç°é—ªå±ï¼ŒåŸå› ï¼šä»£ç ä¸­æœ‰äº›è¯­å¥å¯èƒ½åœ¨Keilä»¥å¾€ä½ç‰ˆæœ¬ç¼–è¯‘çš„Hexæ–‡ä»¶ä»¿çœŸæ—¶è¿è¡Œå¯èƒ½æ²¡æœ‰é—®é¢˜ï¼Œåœ¨Keil5.37ç‰ˆæœ¬ç¼–è¯‘åï¼Œå°±å‡ºç°é—ªå±ã€‚</h5><ol><li>ç¼–è¯‘æœºåˆ¶å’Œè¯­æ³•ä¸Šå¯èƒ½æœ‰å·®å¼‚ã€‚</li><li>æ•°ç ç®¡æ‰«ææ˜¾ç¤ºçš„è¯ï¼Œéœ€è¦æ³¨æ„æ¶ˆéšå¤„ç†ã€‚æ•°ç ç®¡æ˜¾ç¤ºçš„æ•ˆæœå‘ˆç°çš„æ˜¯è§†è§‰æ•ˆæœï¼Œæ˜¯æ ¹æ®äººè§†è§‰å“åº”å’Œåœç•™çš„æ—¶é—´å¯¹åº”å…³ç³»ã€‚å¦‚æœå°†æ¯ä¸€å¸§æ•°æ®å•ç‹¬æ‹¿å‡ºæ¥çœ‹çš„è¯ï¼Œæ˜¯é—´éš”çš„ã€‚</li><li>é—ªå±é—®é¢˜ç‚¹å·²ç»æ‰¾å‡ºï¼Œå¯ä»¥å‚è€ƒä¸Šé¢æä¾›çš„ä¸¤æ®µä»£ç å¯¹æ¯”åˆ†æ</li></ol><h5 id="ç¨‹åºä»£ç åœ¨ä¹¦å†™è¡¨è¾¾æ—¶ï¼Œå°½é‡é€šä¿—æ˜“æ‡‚ï¼Œè¨€ç®€æ„èµ…æ˜¯æœ€ä¸Šå±‚çš„ä¿®ä¸ºã€‚ä¸è¦å¼„ä¸€äº›ç”Ÿåƒ»ï¼Œæˆ–æ ‡æ–°ç«‹å¼‚çš„å†™æ³•ï¼Œå†™ä»£ç è¦æ˜ç™½ä¸€ç‚¹ï¼Œæ˜¯ç»™è‡ªå·±é˜…è¯»çš„ï¼Œæ‰€ä»¥å†™æ³•ä¸€å®šè¦è§„èŒƒï¼Œä¸è¦æ±‚å¾ˆé«˜ï¼Œèµ·ç è‡ªå·±èƒ½ä¸€çœ¼å°±å¯ä»¥çœ‹æ‡‚ã€‚"><a href="#ç¨‹åºä»£ç åœ¨ä¹¦å†™è¡¨è¾¾æ—¶ï¼Œå°½é‡é€šä¿—æ˜“æ‡‚ï¼Œè¨€ç®€æ„èµ…æ˜¯æœ€ä¸Šå±‚çš„ä¿®ä¸ºã€‚ä¸è¦å¼„ä¸€äº›ç”Ÿåƒ»ï¼Œæˆ–æ ‡æ–°ç«‹å¼‚çš„å†™æ³•ï¼Œå†™ä»£ç è¦æ˜ç™½ä¸€ç‚¹ï¼Œæ˜¯ç»™è‡ªå·±é˜…è¯»çš„ï¼Œæ‰€ä»¥å†™æ³•ä¸€å®šè¦è§„èŒƒï¼Œä¸è¦æ±‚å¾ˆé«˜ï¼Œèµ·ç è‡ªå·±èƒ½ä¸€çœ¼å°±å¯ä»¥çœ‹æ‡‚ã€‚" class="headerlink" title="ç¨‹åºä»£ç åœ¨ä¹¦å†™è¡¨è¾¾æ—¶ï¼Œå°½é‡é€šä¿—æ˜“æ‡‚ï¼Œè¨€ç®€æ„èµ…æ˜¯æœ€ä¸Šå±‚çš„ä¿®ä¸ºã€‚ä¸è¦å¼„ä¸€äº›ç”Ÿåƒ»ï¼Œæˆ–æ ‡æ–°ç«‹å¼‚çš„å†™æ³•ï¼Œå†™ä»£ç è¦æ˜ç™½ä¸€ç‚¹ï¼Œæ˜¯ç»™è‡ªå·±é˜…è¯»çš„ï¼Œæ‰€ä»¥å†™æ³•ä¸€å®šè¦è§„èŒƒï¼Œä¸è¦æ±‚å¾ˆé«˜ï¼Œèµ·ç è‡ªå·±èƒ½ä¸€çœ¼å°±å¯ä»¥çœ‹æ‡‚ã€‚"></a>ç¨‹åºä»£ç åœ¨ä¹¦å†™è¡¨è¾¾æ—¶ï¼Œå°½é‡é€šä¿—æ˜“æ‡‚ï¼Œè¨€ç®€æ„èµ…æ˜¯æœ€ä¸Šå±‚çš„ä¿®ä¸ºã€‚ä¸è¦å¼„ä¸€äº›ç”Ÿåƒ»ï¼Œæˆ–æ ‡æ–°ç«‹å¼‚çš„å†™æ³•ï¼Œå†™ä»£ç è¦æ˜ç™½ä¸€ç‚¹ï¼Œæ˜¯ç»™è‡ªå·±é˜…è¯»çš„ï¼Œæ‰€ä»¥å†™æ³•ä¸€å®šè¦è§„èŒƒï¼Œä¸è¦æ±‚å¾ˆé«˜ï¼Œèµ·ç è‡ªå·±èƒ½ä¸€çœ¼å°±å¯ä»¥çœ‹æ‡‚ã€‚</h5><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><p>ä»¿çœŸåŸºäºproteus8.9SP2</p><p><code>proteus8.9SP2</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1AcBl8w6aA71U5QYfPZK1vA </span><br><span class="line">æå–ç ï¼šgi35</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1AcBl8w6aA71U5QYfPZK1vA  æå–ç ï¼šgi35</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘74HC154 å››çº¿è½¬12çº¿è¯‘ç å™¨ç»„æˆçš„16è·¯æµæ°´ç¯</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F74HC154-%E5%9B%9B%E7%BA%BF%E8%BD%AC12%E7%BA%BF%E8%AF%91%E7%A0%81%E5%99%A8%E7%BB%84%E6%88%90%E7%9A%8416%E8%B7%AF%E6%B5%81%E6%B0%B4%E7%81%AF/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F74HC154-%E5%9B%9B%E7%BA%BF%E8%BD%AC12%E7%BA%BF%E8%AF%91%E7%A0%81%E5%99%A8%E7%BB%84%E6%88%90%E7%9A%8416%E8%B7%AF%E6%B5%81%E6%B0%B4%E7%81%AF/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘74HC154-å››çº¿è½¬12çº¿è¯‘ç å™¨ç»„æˆçš„16è·¯æµæ°´ç¯"><a href="#ã€Proteusä»¿çœŸã€‘74HC154-å››çº¿è½¬12çº¿è¯‘ç å™¨ç»„æˆçš„16è·¯æµæ°´ç¯" class="headerlink" title="ã€Proteusä»¿çœŸã€‘74HC154 å››çº¿è½¬12çº¿è¯‘ç å™¨ç»„æˆçš„16è·¯æµæ°´ç¯"></a>ã€Proteusä»¿çœŸã€‘74HC154 å››çº¿è½¬12çº¿è¯‘ç å™¨ç»„æˆçš„16è·¯æµæ°´ç¯</h1><h3 id="ã€Proteusä»¿çœŸã€‘74HC154-å››çº¿è½¬12çº¿è¯‘ç å™¨ç»„æˆçš„16è·¯æµæ°´ç¯-1"><a href="#ã€Proteusä»¿çœŸã€‘74HC154-å››çº¿è½¬12çº¿è¯‘ç å™¨ç»„æˆçš„16è·¯æµæ°´ç¯-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘74HC154 å››çº¿è½¬12çº¿è¯‘ç å™¨ç»„æˆçš„16è·¯æµæ°´ç¯"></a>ã€Proteusä»¿çœŸã€‘74HC154 å››çº¿è½¬12çº¿è¯‘ç å™¨ç»„æˆçš„16è·¯æµæ°´ç¯</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/ee9140fb368b49aeb77bc6ee59391768.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="74LS154ï¼Œæ˜¯åœ¨å•ç‰‡æœºç³»ç»Ÿä¸­å¸¸ç”¨çš„4çº¿ï¼12çº¿è¯‘ç å™¨ï¼Œå½“é€‰é€šç«¯ï¼ˆG1ã€G2ï¼‰å‡ä¸ºä½ç”µå¹³æ—¶ï¼Œå¯å°†åœ°å€ç«¯ï¼ˆABCDï¼‰çš„äºŒè¿›åˆ¶ç¼–ç åœ¨ä¸€ä¸ªå¯¹åº”çš„è¾“å‡ºç«¯ï¼Œä»¥ä½ç”µå¹³è¯‘å‡ºã€‚"><a href="#74LS154ï¼Œæ˜¯åœ¨å•ç‰‡æœºç³»ç»Ÿä¸­å¸¸ç”¨çš„4çº¿ï¼12çº¿è¯‘ç å™¨ï¼Œå½“é€‰é€šç«¯ï¼ˆG1ã€G2ï¼‰å‡ä¸ºä½ç”µå¹³æ—¶ï¼Œå¯å°†åœ°å€ç«¯ï¼ˆABCDï¼‰çš„äºŒè¿›åˆ¶ç¼–ç åœ¨ä¸€ä¸ªå¯¹åº”çš„è¾“å‡ºç«¯ï¼Œä»¥ä½ç”µå¹³è¯‘å‡ºã€‚" class="headerlink" title="74LS154ï¼Œæ˜¯åœ¨å•ç‰‡æœºç³»ç»Ÿä¸­å¸¸ç”¨çš„4çº¿ï¼12çº¿è¯‘ç å™¨ï¼Œå½“é€‰é€šç«¯ï¼ˆG1ã€G2ï¼‰å‡ä¸ºä½ç”µå¹³æ—¶ï¼Œå¯å°†åœ°å€ç«¯ï¼ˆABCDï¼‰çš„äºŒè¿›åˆ¶ç¼–ç åœ¨ä¸€ä¸ªå¯¹åº”çš„è¾“å‡ºç«¯ï¼Œä»¥ä½ç”µå¹³è¯‘å‡ºã€‚"></a>74LS154ï¼Œæ˜¯åœ¨å•ç‰‡æœºç³»ç»Ÿä¸­å¸¸ç”¨çš„4çº¿ï¼12çº¿è¯‘ç å™¨ï¼Œå½“é€‰é€šç«¯ï¼ˆG1ã€G2ï¼‰å‡ä¸ºä½ç”µå¹³æ—¶ï¼Œå¯å°†åœ°å€ç«¯ï¼ˆABCDï¼‰çš„äºŒè¿›åˆ¶ç¼–ç åœ¨ä¸€ä¸ªå¯¹åº”çš„è¾“å‡ºç«¯ï¼Œä»¥ä½ç”µå¹³è¯‘å‡ºã€‚</h5><h4 id="çœŸå€¼è¡¨"><a href="#çœŸå€¼è¡¨" class="headerlink" title="çœŸå€¼è¡¨"></a>çœŸå€¼è¡¨</h4><p><img src="https://img-blog.csdnimg.cn/e6ff07c2f7994c34841449127935996c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç”±74HC154ç»„æˆçš„16è·¯æµæ°´ç¯ç¤ºä¾‹ä»£ç "><a href="#ç”±74HC154ç»„æˆçš„16è·¯æµæ°´ç¯ç¤ºä¾‹ä»£ç " class="headerlink" title="ç”±74HC154ç»„æˆçš„16è·¯æµæ°´ç¯ç¤ºä¾‹ä»£ç "></a>ç”±74HC154ç»„æˆçš„16è·¯æµæ°´ç¯ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#define uchar unsigned char</span><br><span class="line"></span><br><span class="line">void Delay(uint x)</span><br><span class="line">&#123;</span><br><span class="line"> uchar i;</span><br><span class="line">while(x--)</span><br><span class="line">&#123;</span><br><span class="line"> for(i=0;i&lt;120;i++);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> while(1)</span><br><span class="line">&#123;</span><br><span class="line"> P2 = (P2+1)%16;</span><br><span class="line">Delay(200);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#define uint unsigned int<br>#define uchar unsigned char</p><p>void Delay(uint x)<br>{<br>     uchar i;<br>    while(xâ€“)<br>    {<br>     for(i&#x3D;0;i&lt;120;i++);<br>    }<br>}</p><p>void main()<br>{<br>     while(1)<br>    {<br>     P2 &#x3D; (P2+1)%16;<br>        Delay(200);<br>    }<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1xVIPHevAhUJ1juu8hWkwMA </span><br><span class="line">æå–ç ï¼š9wjm</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1xVIPHevAhUJ1juu8hWkwMA  æå–ç ï¼š9wjm</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘74LS194ç»„æˆçš„8ä¸ªledæµæ°´ç¯</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F74LS194%E7%BB%84%E6%88%90%E7%9A%848%E4%B8%AAled%E6%B5%81%E6%B0%B4%E7%81%AF/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F74LS194%E7%BB%84%E6%88%90%E7%9A%848%E4%B8%AAled%E6%B5%81%E6%B0%B4%E7%81%AF/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘74LS194ç»„æˆçš„8ä¸ªledæµæ°´ç¯"><a href="#ã€Proteusä»¿çœŸã€‘74LS194ç»„æˆçš„8ä¸ªledæµæ°´ç¯" class="headerlink" title="ã€Proteusä»¿çœŸã€‘74LS194ç»„æˆçš„8ä¸ªledæµæ°´ç¯"></a>ã€Proteusä»¿çœŸã€‘74LS194ç»„æˆçš„8ä¸ªledæµæ°´ç¯</h1><h3 id="ã€Proteusä»¿çœŸã€‘74LS194ç»„æˆçš„8ä¸ªledæµæ°´ç¯-1"><a href="#ã€Proteusä»¿çœŸã€‘74LS194ç»„æˆçš„8ä¸ªledæµæ°´ç¯-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘74LS194ç»„æˆçš„8ä¸ªledæµæ°´ç¯"></a>ã€Proteusä»¿çœŸã€‘74LS194ç»„æˆçš„8ä¸ªledæµæ°´ç¯</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/b014ffc0ecee47878979e05767108239.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="åŸç†å›¾"><a href="#åŸç†å›¾" class="headerlink" title="åŸç†å›¾"></a>åŸç†å›¾</h4><p><img src="https://img-blog.csdnimg.cn/c3ffe481f2404e9a8199afc0d39ff7c3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>74LS194</li></ul><p>ç§»ä½å¯„å­˜å™¨æ˜¯æŒ‡å¯„å­˜å™¨ä¸­æ‰€å­˜çš„ä»£ç èƒ½å¤Ÿåœ¨ç§»ä½è„‰å†²çš„ä½œç”¨ä¸‹ä¾æ¬¡å·¦ç§»æˆ–å³ç§»ã€‚74LS194æ˜¯ä¸€ä¸ª4ä½åŒå‘ç§»ä½å¯„å­˜å™¨ï¼Œæœ€é«˜æ—¶é’Ÿè„‰å†²ä¸º36MHZ.  å…¶ä¸­ï¼šD0ï½D1ä¸ºå¹¶è¡Œè¾“å…¥ç«¯ï¼›Q0ï½Q3ä¸ºå¹¶è¡Œè¾“å‡ºç«¯ï¼›SRå³ç§»ä¸²å¼•è¾“å…¥ç«¯ï¼›SLâ€“å·¦ç§»ä¸²å¼•è¾“å…¥ç«¯ï¼›S1ã€S0-æ“ä½œæ¨¡å¼æ§åˆ¶ç«¯ï¼›MR -ä¸ºç›´æ¥æ— æ¡ä»¶æ¸…é›¶ç«¯ï¼›CLKä¸ºæ—¶é’Ÿè„‰å†²è¾“å…¥ç«¯ã€‚ S1S0å–å€¼ä¸º11æ—¶ï¼Œåšç½®ä½æ“ä½œï¼Œå½“ä¸º01æ—¶ï¼Œåšå³ç§»æ“ä½œã€‚</p><p><img src="https://img-blog.csdnimg.cn/34efb207447f41ad9830e6c065c508d0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>SR</code></p><p><code>SL</code></p><p><code>MR</code></p><p><code>CLK</code></p><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1cOm8vGBwkNxDw149DYBPTg </span><br><span class="line">æå–ç ï¼šy9se</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1cOm8vGBwkNxDw149DYBPTg  æå–ç ï¼šy9se</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘74HC595+74LS154é©±åŠ¨æ˜¾ç¤º16X16ç‚¹é˜µ</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F74HC59574LS154%E9%A9%B1%E5%8A%A8%E6%98%BE%E7%A4%BA16X16%E7%82%B9%E9%98%B5/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F74HC59574LS154%E9%A9%B1%E5%8A%A8%E6%98%BE%E7%A4%BA16X16%E7%82%B9%E9%98%B5/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘74HC595-74LS154é©±åŠ¨æ˜¾ç¤º16X16ç‚¹é˜µ"><a href="#ã€Proteusä»¿çœŸã€‘74HC595-74LS154é©±åŠ¨æ˜¾ç¤º16X16ç‚¹é˜µ" class="headerlink" title="ã€Proteusä»¿çœŸã€‘74HC595+74LS154é©±åŠ¨æ˜¾ç¤º16X16ç‚¹é˜µ"></a>ã€Proteusä»¿çœŸã€‘74HC595+74LS154é©±åŠ¨æ˜¾ç¤º16X16ç‚¹é˜µ</h1><h3 id="ã€Proteusä»¿çœŸã€‘74HC595-74LS154é©±åŠ¨æ˜¾ç¤º16X16ç‚¹é˜µ-1"><a href="#ã€Proteusä»¿çœŸã€‘74HC595-74LS154é©±åŠ¨æ˜¾ç¤º16X16ç‚¹é˜µ-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘74HC595+74LS154é©±åŠ¨æ˜¾ç¤º16X16ç‚¹é˜µ"></a>ã€Proteusä»¿çœŸã€‘74HC595+74LS154é©±åŠ¨æ˜¾ç¤º16X16ç‚¹é˜µ</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/c5620e9fffb94301826f031f23ac318a.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å–æ¨¡è½¯ä»¶å’Œæ–¹å¼"><a href="#å–æ¨¡è½¯ä»¶å’Œæ–¹å¼" class="headerlink" title="å–æ¨¡è½¯ä»¶å’Œæ–¹å¼"></a>å–æ¨¡è½¯ä»¶å’Œæ–¹å¼</h4><ul><li>pctolcd2002</li><li>å–æ¨¡æ–¹å¼ï¼šé€åˆ—å¼ã€é€†å‘ã€C51æ ¼å¼</li></ul><p><code>pctolcd2002</code></p><p><img src="https://img-blog.csdnimg.cn/213adc1a156c4efc9291673e87c80e12.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">//------------------------------------â€”â€”</span><br><span class="line">//åç§°ï¼šç”¨75LS595ä¸74LS154åœ¨16x16ç‚¹é˜µå±ä¸Šæ˜¾ç¤ºä¿¡æ¯</span><br><span class="line">//è¯´æ˜ï¼šæœ¬ä¾‹ç»¼åˆä½¿ç”¨äº†ä¸²å…¥å¹¶å‡ºèŠ¯ç‰‡75LS595,4-16è¯‘ç å™¨75LS154åŠ</span><br><span class="line">//åç›¸æ”¾å¤§å™¨74LS06,åœ¨16x16ç‚¹é˜µå±ä¸Šå®ç°äº†æ±‰å­—æ»šåŠ¨æ˜¾ç¤ºæ•ˆæœã€‚</span><br><span class="line">#include&lt;reg51.h&gt;</span><br><span class="line">//#include &lt;REGX52.H&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line"></span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int </span><br><span class="line"></span><br><span class="line">sbit Serial_Data_Pin = P0^0;//75LS595ä¸²è¡Œæ•°æ®è¾“å…¥</span><br><span class="line">sbit Shift_CLK_Pin = P3^7;//75LS595ç§»ä½è„‰å†²</span><br><span class="line">sbit RCK_Pin = P0^1;//75LS595è¾“å‡ºé”å­˜å™¨æ§åˆ¶</span><br><span class="line">sbit Switch_74LS154 = P3^6;//74LS154è¯‘ç å™¨å¼€å…³</span><br><span class="line"></span><br><span class="line">uchar data Bit_Stream_8[32];//å‘é€ç»™75LS595çš„ä½æµ,æ¯ç‰‡æ¥æ”¶8ä½</span><br><span class="line">uchar code Word_Set_OF_16x16[][32]=//å¾…æ˜¾ç¤ºæ–‡å­—çš„ç‚¹é˜µ</span><br><span class="line">&#123;</span><br><span class="line">&#123;0xFF,0XFF,0x8F,0XF0,0x07,0XE0,0x77,0xEF,0x77,0xEF,0x07,0xE0,0x8F,0xF0,0xFF,0XFF,</span><br><span class="line">0XFF,0XFF,0X0F,0xF0,0x07,0XE0,0xF7,0xEF,0XF7,0xEF,0X07,0xE0,0x0F,0XF0,0XEF,0XFF&#125;,//80</span><br><span class="line"></span><br><span class="line">//&#123;0XFF,0XFF,0x07,0XF6,0X07,0xE6,0x77,0XEF,0x77,0XEF,0x77,0XE0,0XF7,0XF0,0XFF,0XFF,</span><br><span class="line">//0xFF,0XFF,0XEF,0XFF,0XEF,0XFF,0X07,0XE0,0x07,0XE0,0XFF,0XFF,0XFF,0XFF,0XFF,0xFF&#125;,//51</span><br><span class="line">&#123;0xFF,0xFF,0x03,0xCE,0x03,0xCE,0x73,0xCE,0x73,0xCE,0x73,0xCE,0x73,0xCE,0x73,0xC0,</span><br><span class="line">0x73,0xC0,0xFF,0xFF,0xFF,0xFF,0xEF,0xDF,0x03,0xC0,0x03,0xC0,0xFF,0xDF,0xFF,0xFF&#125;,//51</span><br><span class="line"></span><br><span class="line">&#123;0xFF,0xEF,0xFF,0xEF,0x07,0xEC,0xB6,0xED,0xB5,0xED,0xB3,0xED,0xB7,0xED,0x07,0x00,</span><br><span class="line">0xB7,0xED,0xB3,0xED,0xB5,0xED,0xB6,0xED,0x07,0xEC,0xFF,0xEF,0xFF,0xEF,0xFF,0xFF&#125;,/*&quot;å•&quot;,0*/</span><br><span class="line"></span><br><span class="line">&#123;0xFF,0xFF,0xFF,0x7F,0xFF,0x9F,0x01,0xE0,0xDF,0xFD,0xDF,0xFD,0xDF,0xFD,0xDF,0xFD,</span><br><span class="line">0xDF,0xFD,0xC0,0xFD,0xDF,0x01,0xDF,0xFF,0xDF,0xFF,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF&#125;,/*&quot;ç‰‡&quot;,1*/</span><br><span class="line"></span><br><span class="line">&#123;0xFF,0xFF,0xEF,0xF3,0x6F,0xFC,0x01,0x80,0x01,0x80,0x6F,0xBC,0xEF,0x9D,0xFF,0xC7,</span><br><span class="line">0x03,0xF0,0xFB,0xFF,0xFB,0xFF,0x03,0xC0,0x03,0x80,0xFF,0xBF,0xFF,0x9F,0xFF,0xFF&#125;,/*&quot;æœº&quot;,2*/</span><br><span class="line"></span><br><span class="line">&#123;0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x0F,0xF0,0x07,0xE0,0xF3,0xCF,0xF3,0xCF,0xF3,0xCF,</span><br><span class="line">0xF3,0xCF,0xF3,0xCF,0xF3,0xCF,0xC3,0xC3,0xC3,0xE3,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF&#125;,/*&quot;C&quot;,0*/</span><br><span class="line"></span><br><span class="line">&#123;0xFF,0xFF,0xBF,0xFF,0xB9,0xFF,0x33,0x80,0xFF,0xE7,0x7F,0xF7,0x6D,0xFF,0x6D,0x03,</span><br><span class="line">0x0D,0xBB,0x41,0xBB,0x6D,0xBB,0x6D,0xBB,0x0D,0xBB,0x0D,0x03,0x7D,0xFF,0xFF,0xFF&#125;,/*&quot;è¯­&quot;,1*/</span><br><span class="line"></span><br><span class="line">&#123;0xFF,0xFF,0xF7,0xFF,0xF7,0xFF,0xD7,0x82,0xD7,0xDA,0xD7,0xDA,0xD7,0xDA,0xD1,0xDA,</span><br><span class="line">0xD7,0xDA,0xD7,0xDA,0xD7,0xDA,0xD7,0xDA,0xD7,0x82,0xF7,0xFF,0xF7,0xFF,0xFF,0xFF&#125;,/*&quot;è¨€&quot;,2*/</span><br><span class="line"></span><br><span class="line">&#123;0xBF,0xFB,0x8F,0xFB,0xCE,0xFB,0x68,0xFB,0x69,0xFB,0x6F,0xBB,0x6E,0x3B,0x68,0x01,</span><br><span class="line">0x69,0x81,0x6F,0xF8,0x67,0xFA,0x63,0xFB,0xE8,0xFB,0xAC,0xFB,0x8F,0xFB,0xCF,0xFB&#125;,//å­¦&quot;</span><br><span class="line"></span><br><span class="line">&#123;0xFF,0xFF,0xFD,0xF7,0xFD,0xE7,0xFD,0xE7,0xED,0xF3,0xCD,0xFB,0x1D,0xFB,0x3D,0xF9,</span><br><span class="line">0xFD,0xFD,0xFD,0xBC,0xFD,0x3E,0xFD,0x3E,0x01,0x80,0x01,0xC0,0xFF,0xFF,0xFF,0xFF&#125;,//ä¹ &quot;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//å»¶æ—¶</span><br><span class="line">void Delay(uint x)</span><br><span class="line">&#123;</span><br><span class="line">uchar i;</span><br><span class="line">while(x--)</span><br><span class="line">&#123;</span><br><span class="line"> for(i=0;i&lt;120;i++);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å‘75LS595çš„ä¸²è¡Œè¾“å…¥å¼•è„šå†™å…¥ä¸€å­—èŠ‚</span><br><span class="line">void Serial_Input_Pin(uchar Abyte)</span><br><span class="line">&#123;</span><br><span class="line">uchar i;//</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">&#123;</span><br><span class="line">Abyte &lt;&lt;=1;</span><br><span class="line">Serial_Data_Pin = CY;</span><br><span class="line">Shift_CLK_Pin = 1;//ä¸Šå‡æ²¿ç§»ä½i</span><br><span class="line">_nop_();</span><br><span class="line">_nop_();</span><br><span class="line">Shift_CLK_Pin = 0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å®šæ—¶å™¨0ä¸­æ–­,åœ¨ä¸»ç¨‹åºä¸­çš„å»¶æ—¶æœŸé—´ä»¥1msçš„é—´éš”åŠ¨æ€æ˜¾ç¤ºæ¯åˆ—æ•°æ®</span><br><span class="line">//æ‰€æ˜¾ç¤ºçš„æ•°æ®ç”±2ç‰‡75LS595å¹¶è¡Œè¾“å‡º</span><br><span class="line">void TO_Led_Display_control()interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">uchar i;</span><br><span class="line">TH0 = -1000/256;//1ms å®šæ—¶</span><br><span class="line">TL0 = -1000%256;</span><br><span class="line">i=(P2+1)&amp;0x0f;//å½“å‰åˆ—å·åŠ 1,å±è”½é«˜4ä½i=0~15</span><br><span class="line">Serial_Input_Pin(Bit_Stream_8[i*2 +1]);</span><br><span class="line">Serial_Input_Pin(Bit_Stream_8[i*2]);</span><br><span class="line">Switch_74LS154 =1;//å…³é—­è¯‘ç å™¨</span><br><span class="line">RCK_Pin =1;//ä¸Šå‡æ²¿å°†æ•°æ®é€åˆ°è¾“å‡ºé”å­˜å™¨</span><br><span class="line">RCK_Pin =0;//é”å­˜æ˜¾ç¤ºæ•°æ®ï¼ˆ2x8=16ä½)</span><br><span class="line">Switch_74LS154 = 0;//æ‰“å¼€è¯‘ç å™¨</span><br><span class="line">P2=i;//åˆ—å·è¯‘ç (4-16)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">uchar i,k;</span><br><span class="line">TMOD = 0x01;//å®šæ—¶å™¨T0å·¥ä½œæ–¹å¼1</span><br><span class="line">TH0 = (65536-1000)/256;//1ms å®šæ—¶</span><br><span class="line">TL0= (65536-1000)%256;</span><br><span class="line">IE = 0x82;//å…è®¸å®šæ—¶å™¨T0ä¸­æ–­</span><br><span class="line">P2 = 0xFF;//è¡Œå·ç«¯å£åˆå€¼</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">for(k=0;k&lt;10;k++)//æ˜¾ç¤º12é¡¹å†…å®¹</span><br><span class="line">&#123;</span><br><span class="line">for(i= 0;i&lt;32;i++)//å°†å½“å‰å¾…æ˜¾ç¤ºå†…å®¹æ”¾å…¥Bit_Stream.8</span><br><span class="line">&#123;</span><br><span class="line">Bit_Stream_8[i]= Word_Set_OF_16x16[k][i];</span><br><span class="line">TR0 = 1;</span><br><span class="line">Delay(50);//åœ¨æ­¤æœŸé—´ç”±å®šæ—¶å™¨ä¸­æ–­æ˜¾ç¤ºä¿¡æ¯</span><br><span class="line">TR0 = 0;</span><br><span class="line">P2 = 0XFF;</span><br><span class="line">&#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;&#x2F;â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>&#x2F;&#x2F;åç§°ï¼šç”¨75LS595ä¸74LS154åœ¨16x16ç‚¹é˜µå±ä¸Šæ˜¾ç¤ºä¿¡æ¯<br>&#x2F;&#x2F;è¯´æ˜ï¼šæœ¬ä¾‹ç»¼åˆä½¿ç”¨äº†ä¸²å…¥å¹¶å‡ºèŠ¯ç‰‡75LS595,4-16è¯‘ç å™¨75LS154åŠ<br>&#x2F;&#x2F;åç›¸æ”¾å¤§å™¨74LS06,åœ¨16x16ç‚¹é˜µå±ä¸Šå®ç°äº†æ±‰å­—æ»šåŠ¨æ˜¾ç¤ºæ•ˆæœã€‚<br>#include&lt;reg51.h&gt;<br>&#x2F;&#x2F;#include &lt;REGX52.H&gt;<br>#include &lt;intrins.h&gt;</p><p>#define uchar unsigned char<br>#define uint unsigned int </p><p>sbit Serial_Data_Pin &#x3D; P0^0;&#x2F;&#x2F;75LS595ä¸²è¡Œæ•°æ®è¾“å…¥<br>sbit Shift_CLK_Pin &#x3D; P3^7;&#x2F;&#x2F;75LS595ç§»ä½è„‰å†²<br>sbit RCK_Pin &#x3D; P0^1;&#x2F;&#x2F;75LS595è¾“å‡ºé”å­˜å™¨æ§åˆ¶<br>sbit Switch_74LS154 &#x3D; P3^6;&#x2F;&#x2F;74LS154è¯‘ç å™¨å¼€å…³</p><p>uchar data Bit_Stream_8[32];&#x2F;&#x2F;å‘é€ç»™75LS595çš„ä½æµ,æ¯ç‰‡æ¥æ”¶8ä½<br>uchar code Word_Set_OF_16x16[][32]&#x3D;&#x2F;&#x2F;å¾…æ˜¾ç¤ºæ–‡å­—çš„ç‚¹é˜µ<br>{<br>{0xFF,0XFF,0x8F,0XF0,0x07,0XE0,0x77,0xEF,0x77,0xEF,0x07,0xE0,0x8F,0xF0,0xFF,0XFF,<br>0XFF,0XFF,0X0F,0xF0,0x07,0XE0,0xF7,0xEF,0XF7,0xEF,0X07,0xE0,0x0F,0XF0,0XEF,0XFF},&#x2F;&#x2F;80</p><p>&#x2F;&#x2F;{0XFF,0XFF,0x07,0XF6,0X07,0xE6,0x77,0XEF,0x77,0XEF,0x77,0XE0,0XF7,0XF0,0XFF,0XFF,<br>&#x2F;&#x2F;0xFF,0XFF,0XEF,0XFF,0XEF,0XFF,0X07,0XE0,0x07,0XE0,0XFF,0XFF,0XFF,0XFF,0XFF,0xFF},&#x2F;&#x2F;51<br>{0xFF,0xFF,0x03,0xCE,0x03,0xCE,0x73,0xCE,0x73,0xCE,0x73,0xCE,0x73,0xCE,0x73,0xC0,<br>0x73,0xC0,0xFF,0xFF,0xFF,0xFF,0xEF,0xDF,0x03,0xC0,0x03,0xC0,0xFF,0xDF,0xFF,0xFF},&#x2F;&#x2F;51</p><p>{0xFF,0xEF,0xFF,0xEF,0x07,0xEC,0xB6,0xED,0xB5,0xED,0xB3,0xED,0xB7,0xED,0x07,0x00,<br>0xB7,0xED,0xB3,0xED,0xB5,0xED,0xB6,0xED,0x07,0xEC,0xFF,0xEF,0xFF,0xEF,0xFF,0xFF},&#x2F;<em>â€œå•â€,0</em>&#x2F;</p><p>{0xFF,0xFF,0xFF,0x7F,0xFF,0x9F,0x01,0xE0,0xDF,0xFD,0xDF,0xFD,0xDF,0xFD,0xDF,0xFD,<br>0xDF,0xFD,0xC0,0xFD,0xDF,0x01,0xDF,0xFF,0xDF,0xFF,0xDF,0xFF,0xFF,0xFF,0xFF,0xFF},&#x2F;<em>â€œç‰‡â€,1</em>&#x2F;</p><p>{0xFF,0xFF,0xEF,0xF3,0x6F,0xFC,0x01,0x80,0x01,0x80,0x6F,0xBC,0xEF,0x9D,0xFF,0xC7,<br>0x03,0xF0,0xFB,0xFF,0xFB,0xFF,0x03,0xC0,0x03,0x80,0xFF,0xBF,0xFF,0x9F,0xFF,0xFF},&#x2F;<em>â€œæœºâ€,2</em>&#x2F;</p><p>{0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x0F,0xF0,0x07,0xE0,0xF3,0xCF,0xF3,0xCF,0xF3,0xCF,<br>0xF3,0xCF,0xF3,0xCF,0xF3,0xCF,0xC3,0xC3,0xC3,0xE3,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF},&#x2F;<em>â€œCâ€,0</em>&#x2F;</p><p>{0xFF,0xFF,0xBF,0xFF,0xB9,0xFF,0x33,0x80,0xFF,0xE7,0x7F,0xF7,0x6D,0xFF,0x6D,0x03,<br>0x0D,0xBB,0x41,0xBB,0x6D,0xBB,0x6D,0xBB,0x0D,0xBB,0x0D,0x03,0x7D,0xFF,0xFF,0xFF},&#x2F;<em>â€œè¯­â€,1</em>&#x2F;</p><p>{0xFF,0xFF,0xF7,0xFF,0xF7,0xFF,0xD7,0x82,0xD7,0xDA,0xD7,0xDA,0xD7,0xDA,0xD1,0xDA,<br>0xD7,0xDA,0xD7,0xDA,0xD7,0xDA,0xD7,0xDA,0xD7,0x82,0xF7,0xFF,0xF7,0xFF,0xFF,0xFF},&#x2F;<em>â€œè¨€â€,2</em>&#x2F;</p><p>{0xBF,0xFB,0x8F,0xFB,0xCE,0xFB,0x68,0xFB,0x69,0xFB,0x6F,0xBB,0x6E,0x3B,0x68,0x01,<br>0x69,0x81,0x6F,0xF8,0x67,0xFA,0x63,0xFB,0xE8,0xFB,0xAC,0xFB,0x8F,0xFB,0xCF,0xFB},&#x2F;&#x2F;å­¦â€</p><p>{0xFF,0xFF,0xFD,0xF7,0xFD,0xE7,0xFD,0xE7,0xED,0xF3,0xCD,0xFB,0x1D,0xFB,0x3D,0xF9,<br>0xFD,0xFD,0xFD,0xBC,0xFD,0x3E,0xFD,0x3E,0x01,0x80,0x01,0xC0,0xFF,0xFF,0xFF,0xFF},&#x2F;&#x2F;ä¹ â€</p><p>};</p><p>&#x2F;&#x2F;å»¶æ—¶<br>void Delay(uint x)<br>{<br>    uchar i;<br>    while(xâ€“)<br>    {<br>     for(i&#x3D;0;i&lt;120;i++);<br>    }<br>}</p><p>&#x2F;&#x2F;å‘75LS595çš„ä¸²è¡Œè¾“å…¥å¼•è„šå†™å…¥ä¸€å­—èŠ‚<br>void Serial_Input_Pin(uchar Abyte)<br>{<br>uchar i;&#x2F;&#x2F;<br>for(i&#x3D;0;i&lt;8;i++)<br>{<br>    Abyte &lt;&lt;&#x3D;1;<br>    Serial_Data_Pin &#x3D; CY;<br>    Shift_CLK_Pin &#x3D; 1;&#x2F;&#x2F;ä¸Šå‡æ²¿ç§»ä½i<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    Shift_CLK_Pin &#x3D; 0;<br>    }<br>}</p><p>&#x2F;&#x2F;å®šæ—¶å™¨0ä¸­æ–­,åœ¨ä¸»ç¨‹åºä¸­çš„å»¶æ—¶æœŸé—´ä»¥1msçš„é—´éš”åŠ¨æ€æ˜¾ç¤ºæ¯åˆ—æ•°æ®<br>&#x2F;&#x2F;æ‰€æ˜¾ç¤ºçš„æ•°æ®ç”±2ç‰‡75LS595å¹¶è¡Œè¾“å‡º<br>void TO_Led_Display_control()interrupt 1<br>{<br>    uchar i;<br>    TH0 &#x3D; -1000&#x2F;256;&#x2F;&#x2F;1ms å®šæ—¶<br>    TL0 &#x3D; -1000%256;<br>    i&#x3D;(P2+1)&0x0f;&#x2F;&#x2F;å½“å‰åˆ—å·åŠ 1,å±è”½é«˜4ä½i&#x3D;0~15<br>    Serial_Input_Pin(Bit_Stream_8[i<em>2 +1]);<br>    Serial_Input_Pin(Bit_Stream_8[i</em>2]);<br>    Switch_74LS154 &#x3D;1;&#x2F;&#x2F;å…³é—­è¯‘ç å™¨<br>    RCK_Pin &#x3D;1;&#x2F;&#x2F;ä¸Šå‡æ²¿å°†æ•°æ®é€åˆ°è¾“å‡ºé”å­˜å™¨<br>    RCK_Pin &#x3D;0;&#x2F;&#x2F;é”å­˜æ˜¾ç¤ºæ•°æ®ï¼ˆ2x8&#x3D;16ä½)<br>    Switch_74LS154 &#x3D; 0;&#x2F;&#x2F;æ‰“å¼€è¯‘ç å™¨<br>    P2&#x3D;i;&#x2F;&#x2F;åˆ—å·è¯‘ç (4-16)</p><p>}<br>void main()<br>{<br>    uchar i,k;<br>    TMOD &#x3D; 0x01;&#x2F;&#x2F;å®šæ—¶å™¨T0å·¥ä½œæ–¹å¼1<br>    TH0 &#x3D; (65536-1000)&#x2F;256;&#x2F;&#x2F;1ms å®šæ—¶<br>    TL0&#x3D; (65536-1000)%256;<br>    IE &#x3D; 0x82;&#x2F;&#x2F;å…è®¸å®šæ—¶å™¨T0ä¸­æ–­<br>    P2 &#x3D; 0xFF;&#x2F;&#x2F;è¡Œå·ç«¯å£åˆå€¼<br>    while(1)<br>    {<br>        for(k&#x3D;0;k&lt;10;k++)&#x2F;&#x2F;æ˜¾ç¤º12é¡¹å†…å®¹<br>        {<br>            for(i&#x3D; 0;i&lt;32;i++)&#x2F;&#x2F;å°†å½“å‰å¾…æ˜¾ç¤ºå†…å®¹æ”¾å…¥Bit_Stream.8<br>            {<br>    Bit_Stream_8[i]&#x3D; Word_Set_OF_16x16[k][i];<br>                TR0 &#x3D; 1;<br>    Delay(50);&#x2F;&#x2F;åœ¨æ­¤æœŸé—´ç”±å®šæ—¶å™¨ä¸­æ–­æ˜¾ç¤ºä¿¡æ¯<br>    TR0 &#x3D; 0;<br>    P2 &#x3D; 0XFF;<br>            }<br>     }<br>    }<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æºï¼ˆåŒ…å«å–æ¨¡å·¥å…·ï¼‰"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æºï¼ˆåŒ…å«å–æ¨¡å·¥å…·ï¼‰" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æºï¼ˆåŒ…å«å–æ¨¡å·¥å…·ï¼‰"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æºï¼ˆåŒ…å«å–æ¨¡å·¥å…·ï¼‰</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°.</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1225O9hBMRh5LG_T1Jr0-8w </span><br><span class="line">æå–ç ï¼šbsk2</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1225O9hBMRh5LG_T1Jr0-8w  æå–ç ï¼šbsk2</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘8x8Ledç‚¹é˜µæ•°å­—å¾ªç¯æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F8x8Led%E7%82%B9%E9%98%B5%E6%95%B0%E5%AD%97%E5%BE%AA%E7%8E%AF%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F8x8Led%E7%82%B9%E9%98%B5%E6%95%B0%E5%AD%97%E5%BE%AA%E7%8E%AF%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘8x8Ledç‚¹é˜µæ•°å­—å¾ªç¯æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘8x8Ledç‚¹é˜µæ•°å­—å¾ªç¯æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘8x8Ledç‚¹é˜µæ•°å­—å¾ªç¯æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘8x8Ledç‚¹é˜µæ•°å­—å¾ªç¯æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘8x8Ledç‚¹é˜µæ•°å­—å¾ªç¯æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘8x8Ledç‚¹é˜µæ•°å­—å¾ªç¯æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘8x8Ledç‚¹é˜µæ•°å­—å¾ªç¯æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘8x8Ledç‚¹é˜µæ•°å­—å¾ªç¯æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/55cb9f1d6b8e43fc9e3c6621c5ac0c33.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="8x8ç‚¹é˜µå–æ¨¡å·¥å…·å’Œæ–¹æ³•"><a href="#8x8ç‚¹é˜µå–æ¨¡å·¥å…·å’Œæ–¹æ³•" class="headerlink" title="8x8ç‚¹é˜µå–æ¨¡å·¥å…·å’Œæ–¹æ³•"></a>8x8ç‚¹é˜µå–æ¨¡å·¥å…·å’Œæ–¹æ³•</h4><p>é€šè¿‡é¼ æ ‡ç‚¹äº®è¦æ˜¾ç¤ºçš„æ–¹æ ¼ï¼Œç„¶åç‚¹å‡»ç”Ÿæˆæ•°ç»„ï¼Œå°†å–æ¨¡å¥½çš„æ•°ç»„æ”¾åˆ°ç¨‹åºä»£ç ä¸­ï¼Œè‡³äºæ˜¯å…±é˜´è¿˜æ˜¯å…±é˜³ï¼Œå¯ä»¥è°ƒè¯•çœ‹æ•ˆæœå°±æ˜ç™½äº†ï¼Œå¦‚æœæ˜¾ç¤ºçš„æ•ˆæœæ˜¯åçš„ï¼Œé‚£å°±ç‚¹å‡»åˆ‡æ¢å…±é˜´&#x2F;å…±é˜³æŒ‰é’®å³å¯ã€‚</p><p><img src="https://img-blog.csdnimg.cn/62036d68caaf4ffe9dfa64cf939f68b5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ç¨‹åºä»£ç "><a href="#ç¤ºä¾‹ç¨‹åºä»£ç " class="headerlink" title="ç¤ºä¾‹ç¨‹åºä»£ç "></a>ç¤ºä¾‹ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line"></span><br><span class="line">uchar code Table_OF_Digits[]=</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">0x00,0x7E,0x81,0x81,0x81,0x81,0x7E,0x00,/*&#x27;0&#x27;*/</span><br><span class="line">0x00,0x00,0x43,0xFF,0xFF,0x03,0x00,0x00,/*&#x27;1&#x27;*/</span><br><span class="line">0x00,0x00,0x43,0xFF,0xFF,0x03,0x00,0x00,/*&#x27;2&#x27;*/</span><br><span class="line">0x00,0x99,0x99,0x99,0x99,0xFF,0xFF,0x00,/*&#x27;3&#x27;*/</span><br><span class="line">0x00,0x0c,0x14,0x24,0x7f,0x04,0x00,0x00,</span><br><span class="line">0x00,0x72,0x51,0x51,0x51,0x4e,0x00,0x00,</span><br><span class="line">0x00,0x3e,0x49,0x49,0x49,0x26,0x00,0x00,</span><br><span class="line">0x00,0x40,0x40,0x40,0x4f,0x70,0x00,0x00,</span><br><span class="line">0x00,0x36,0x49,0x49,0x49,0x36,0x00,0x00,</span><br><span class="line">0x00,0x32,0x49,0x49,0x49,0x3e,0x00,0x00,</span><br><span class="line">&#125;;</span><br><span class="line">uchar i=0,t=0,Num_Index = 0;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> P3 = 0x80;</span><br><span class="line">Num_Index = 0;</span><br><span class="line">TMOD = 0x00;</span><br><span class="line">TH0 = (8192-2000)/32;</span><br><span class="line">TL0 = (8192-2000)%32;</span><br><span class="line">TR0 = 1;</span><br><span class="line">IE = 0x82;</span><br><span class="line">while(1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void LED_Screen_Display() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line"> TH0 = (8192-2000)/32;</span><br><span class="line">TL0 = (8192-2000)%32;</span><br><span class="line">P3 = _crol_(P3,1);</span><br><span class="line">P0 = ~Table_OF_Digits[Num_Index * 8 +i];</span><br><span class="line">if(++i == 8) i = 0;</span><br><span class="line">if(++t == 250)</span><br><span class="line">&#123;</span><br><span class="line"> t = 0x00;</span><br><span class="line">if(++Num_Index == 10) Num_Index = 0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int</p><p>uchar code Table_OF_Digits[]&#x3D;<br>{</p><pre><code>0x00,0x7E,0x81,0x81,0x81,0x81,0x7E,0x00,/*&#39;0&#39;*/0x00,0x00,0x43,0xFF,0xFF,0x03,0x00,0x00,/*&#39;1&#39;*/0x00,0x00,0x43,0xFF,0xFF,0x03,0x00,0x00,/*&#39;2&#39;*/0x00,0x99,0x99,0x99,0x99,0xFF,0xFF,0x00,/*&#39;3&#39;*/0x00,0x0c,0x14,0x24,0x7f,0x04,0x00,0x00,0x00,0x72,0x51,0x51,0x51,0x4e,0x00,0x00,0x00,0x3e,0x49,0x49,0x49,0x26,0x00,0x00,0x00,0x40,0x40,0x40,0x4f,0x70,0x00,0x00,0x00,0x36,0x49,0x49,0x49,0x36,0x00,0x00,0x00,0x32,0x49,0x49,0x49,0x3e,0x00,0x00,</code></pre><p>};<br>uchar i&#x3D;0,t&#x3D;0,Num_Index &#x3D; 0;</p><p>void main()<br>{<br>     P3 &#x3D; 0x80;<br>    Num_Index &#x3D; 0;<br>    TMOD &#x3D; 0x00;<br>    TH0 &#x3D; (8192-2000)&#x2F;32;<br>    TL0 &#x3D; (8192-2000)%32;<br>    TR0 &#x3D; 1;<br>    IE &#x3D; 0x82;<br>    while(1);<br>}</p><p>void LED_Screen_Display() interrupt 1<br>{<br>     TH0 &#x3D; (8192-2000)&#x2F;32;<br>    TL0 &#x3D; (8192-2000)%32;<br>    P3 &#x3D; <em>crol</em>(P3,1);<br>    P0 &#x3D; ~Table_OF_Digits[Num_Index * 8 +i];<br>    if(++i &#x3D;&#x3D; 8) i &#x3D; 0;<br>    if(++t &#x3D;&#x3D; 250)<br>    {<br>     t &#x3D; 0x00;<br>        if(++Num_Index &#x3D;&#x3D; 10) Num_Index &#x3D; 0;<br>    }<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºä»£ç ï¼ˆåŒ…å«å–æ¨¡å·¥å…·ï¼‰"><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºä»£ç ï¼ˆåŒ…å«å–æ¨¡å·¥å…·ï¼‰" class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºä»£ç ï¼ˆåŒ…å«å–æ¨¡å·¥å…·ï¼‰"></a>ä»¿çœŸèµ„æºå’Œç¨‹åºä»£ç ï¼ˆåŒ…å«å–æ¨¡å·¥å…·ï¼‰</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zmGaHUnvJ38W8MtaFht4ig </span><br><span class="line">æå–ç ï¼šnvax</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1zmGaHUnvJ38W8MtaFht4ig  æå–ç ï¼šnvax</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F8%E4%BD%8D%E6%95%B0%E7%A0%81%E7%AE%A1%E5%8A%A8%E6%80%81%E6%89%AB%E6%8F%8F%E6%98%BE%E7%A4%BA%E5%8F%98%E5%8C%96%E6%95%B0%E6%8D%AE/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F8%E4%BD%8D%E6%95%B0%E7%A0%81%E7%AE%A1%E5%8A%A8%E6%80%81%E6%89%AB%E6%8F%8F%E6%98%BE%E7%A4%BA%E5%8F%98%E5%8C%96%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®"><a href="#ã€Proteusä»¿çœŸã€‘8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®" class="headerlink" title="ã€Proteusä»¿çœŸã€‘8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®"></a>ã€Proteusä»¿çœŸã€‘8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®</h1><h3 id="ã€Proteusä»¿çœŸã€‘8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®-1"><a href="#ã€Proteusä»¿çœŸã€‘8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®"></a>ã€Proteusä»¿çœŸã€‘8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/682d94e0dcc14e218f0e6129af163586.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">/*-----------------------------------------------</span><br><span class="line">  åç§°ï¼š8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®</span><br><span class="line">  å†…å®¹ï¼š8ä½æ•°ç ç®¡åˆ†åˆ«æ˜¾ç¤ºä¸åŒæ•°å­—ï¼Œè¿™ç§æ‰«ææ˜¾ç¤ºæ–¹å¼ç§°ä¸ºåŠ¨æ€æ‰«æï¼Œå¹¶ä¸åœå˜åŒ–èµ‹å€¼</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">#include&lt;reg52.h&gt; //åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</span><br><span class="line"></span><br><span class="line">#define DataPort P0 //å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢</span><br><span class="line">sbit LATCH1=P2^2;//å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜</span><br><span class="line">sbit LATCH2=P2^3;//                 ä½é”å­˜</span><br><span class="line"></span><br><span class="line">unsigned char code DuanMa[10]=&#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f&#125;;// æ˜¾ç¤ºæ®µç å€¼0~9</span><br><span class="line">unsigned char code WeiMa[]=&#123;0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f&#125;;//åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç </span><br><span class="line">unsigned char TempData[8]; //å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡</span><br><span class="line">void Delay(unsigned int t); //å‡½æ•°å£°æ˜</span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num);</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    ä¸»å‡½æ•°</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> unsigned int numA=999,numB=0;</span><br><span class="line"> unsigned int j;</span><br><span class="line"> while(1)</span><br><span class="line">      &#123;</span><br><span class="line">   j++;</span><br><span class="line">   if(j==10)  //æ£€æµ‹å½“å‰æ•°å€¼æ˜¾ç¤ºäº†ä¸€å°æ®µæ—¶é—´åï¼Œ</span><br><span class="line">            //éœ€è¦æ˜¾ç¤ºçš„æ•°å€¼-1ï¼Œå®ç°æ•°æ®æ˜¾ç¤ºçš„å˜åŒ–</span><br><span class="line">     &#123;</span><br><span class="line">  j=0;</span><br><span class="line">  numB++;</span><br><span class="line">  if(numA&gt;0)//ç”¨äºæ˜¾ç¤º0~999</span><br><span class="line">    numA--;</span><br><span class="line">  else</span><br><span class="line">    numA=999;</span><br><span class="line">          if(numB==1000)</span><br><span class="line">    numB=0;</span><br><span class="line"> &#125;</span><br><span class="line">   //é€’å‡çš„ä¸‰ä½æ•°ç ç®¡ï¼Œå¸¦æ¶ˆéš</span><br><span class="line">       if(numA&lt;100)</span><br><span class="line">         TempData[0]=0;</span><br><span class="line">   else</span><br><span class="line">    TempData[0]=DuanMa[numA/100];//åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œ</span><br><span class="line">                          //å¦‚è¦æ˜¾ç¤º68ï¼Œåˆ™68/10=6  68%10=8  </span><br><span class="line">   if(numA&lt;10)</span><br><span class="line">     TempData[1]=0;</span><br><span class="line">   else</span><br><span class="line">     TempData[1]=DuanMa[(numA%100)/10];</span><br><span class="line">   TempData[2]=DuanMa[(numA%100)%10];</span><br><span class="line">       //ä¸­é—´2ä½æ•°ç ç®¡ä¸æ˜¾ç¤ºï¼Œèµ‹å€¼0</span><br><span class="line">       TempData[3]=0; </span><br><span class="line">   TempData[4]=0; </span><br><span class="line">       //é€’å¢çš„ä¸‰ä½æ•°ç ç®¡ï¼Œå¸¦æ¶ˆéš</span><br><span class="line">   if(numB&lt;100)</span><br><span class="line">         TempData[5]=0;</span><br><span class="line">   else</span><br><span class="line">    TempData[5]=DuanMa[numB/100];//åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œ</span><br><span class="line">                          //å¦‚è¦æ˜¾ç¤º68ï¼Œåˆ™68/10=6  68%10=8  </span><br><span class="line">   if(numB&lt;10)</span><br><span class="line">     TempData[6]=0;</span><br><span class="line">   else</span><br><span class="line">     TempData[6]=DuanMa[(numB%100)/10];</span><br><span class="line">   TempData[7]=DuanMa[(numB%100)%10];</span><br><span class="line"></span><br><span class="line">   Display(0,8);//ä»ç¬¬ä¸€ä½æ˜¾ç¤ºï¼Œå…±æ˜¾ç¤º8ä½</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> å»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned int tï¼Œæ— è¿”å›å€¼</span><br><span class="line"> unsigned int æ˜¯å®šä¹‰æ— ç¬¦å·æ•´å½¢å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯</span><br><span class="line"> 0~65535</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Delay(unsigned int t)</span><br><span class="line">&#123;</span><br><span class="line"> while(--t);</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡</span><br><span class="line"> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤º</span><br><span class="line"> ä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º</span><br><span class="line"> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚</span><br><span class="line"> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num)</span><br><span class="line">&#123;</span><br><span class="line">      unsigned char i;</span><br><span class="line">  </span><br><span class="line">  for(i=0;i&lt;Num;i++)</span><br><span class="line">   &#123; </span><br><span class="line">   DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±</span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line"></span><br><span class="line">       DataPort = WeiMa[i+FirstBit]; //å–ä½ç  </span><br><span class="line">       LATCH2=1;     //ä½é”å­˜</span><br><span class="line">       LATCH2=0;</span><br><span class="line"></span><br><span class="line">       DataPort = TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç </span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line">       </span><br><span class="line">   Delay(200); // æ‰«æé—´éš™å»¶æ—¶ï¼Œæ—¶é—´å¤ªé•¿ä¼šé—ªçƒï¼Œ</span><br><span class="line">                   //å¤ªçŸ­ä¼šé€ æˆé‡å½±</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br>  åç§°ï¼š8ä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®<br>  å†…å®¹ï¼š8ä½æ•°ç ç®¡åˆ†åˆ«æ˜¾ç¤ºä¸åŒæ•°å­—ï¼Œè¿™ç§æ‰«ææ˜¾ç¤ºæ–¹å¼ç§°ä¸ºåŠ¨æ€æ‰«æï¼Œå¹¶ä¸åœå˜åŒ–èµ‹å€¼<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>#include&lt;reg52.h&gt; &#x2F;&#x2F;åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</p><p>#define DataPort P0 &#x2F;&#x2F;å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢<br>sbit LATCH1&#x3D;P2^2;&#x2F;&#x2F;å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜<br>sbit LATCH2&#x3D;P2^3;&#x2F;&#x2F;                 ä½é”å­˜</p><p>unsigned char code DuanMa[10]&#x3D;{0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};&#x2F;&#x2F; æ˜¾ç¤ºæ®µç å€¼0<del>9<br>unsigned char code WeiMa[]&#x3D;{0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};&#x2F;&#x2F;åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç <br>unsigned char TempData[8]; &#x2F;&#x2F;å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡<br>void Delay(unsigned int t); &#x2F;&#x2F;å‡½æ•°å£°æ˜<br>void Display(unsigned char FirstBit,unsigned char Num);<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    ä¸»å‡½æ•°<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void main()<br>{<br> unsigned int numA&#x3D;999,numB&#x3D;0;<br> unsigned int j;<br> while(1)<br>      {<br>       j++;<br>       if(j&#x3D;&#x3D;10)  &#x2F;&#x2F;æ£€æµ‹å½“å‰æ•°å€¼æ˜¾ç¤ºäº†ä¸€å°æ®µæ—¶é—´åï¼Œ<br>            &#x2F;&#x2F;éœ€è¦æ˜¾ç¤ºçš„æ•°å€¼-1ï¼Œå®ç°æ•°æ®æ˜¾ç¤ºçš„å˜åŒ–<br>         {<br>          j&#x3D;0;<br>          numB++;<br>          if(numA&gt;0)&#x2F;&#x2F;ç”¨äºæ˜¾ç¤º0</del>999<br>            numAâ€“;<br>          else<br>            numA&#x3D;999;<br>          if(numB&#x3D;&#x3D;1000)<br>            numB&#x3D;0;<br>         }<br>       &#x2F;&#x2F;é€’å‡çš„ä¸‰ä½æ•°ç ç®¡ï¼Œå¸¦æ¶ˆéš<br>       if(numA&lt;100)<br>         TempData[0]&#x3D;0;<br>       else<br>        TempData[0]&#x3D;DuanMa[numA&#x2F;100];&#x2F;&#x2F;åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œ<br>                          &#x2F;&#x2F;å¦‚è¦æ˜¾ç¤º68ï¼Œåˆ™68&#x2F;10&#x3D;6  68%10&#x3D;8<br>       if(numA&lt;10)<br>         TempData[1]&#x3D;0;<br>       else<br>         TempData[1]&#x3D;DuanMa[(numA%100)&#x2F;10];<br>       TempData[2]&#x3D;DuanMa[(numA%100)%10];<br>       &#x2F;&#x2F;ä¸­é—´2ä½æ•°ç ç®¡ä¸æ˜¾ç¤ºï¼Œèµ‹å€¼0<br>       TempData[3]&#x3D;0;<br>       TempData[4]&#x3D;0;<br>       &#x2F;&#x2F;é€’å¢çš„ä¸‰ä½æ•°ç ç®¡ï¼Œå¸¦æ¶ˆéš<br>       if(numB&lt;100)<br>         TempData[5]&#x3D;0;<br>       else<br>        TempData[5]&#x3D;DuanMa[numB&#x2F;100];&#x2F;&#x2F;åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œ<br>                          &#x2F;&#x2F;å¦‚è¦æ˜¾ç¤º68ï¼Œåˆ™68&#x2F;10&#x3D;6  68%10&#x3D;8<br>       if(numB&lt;10)<br>         TempData[6]&#x3D;0;<br>       else<br>         TempData[6]&#x3D;DuanMa[(numB%100)&#x2F;10];<br>       TempData[7]&#x3D;DuanMa[(numB%100)%10];</p><pre><code>   Display(0,8);//ä»ç¬¬ä¸€ä½æ˜¾ç¤ºï¼Œå…±æ˜¾ç¤º8ä½  &#125;</code></pre><p>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> å»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned int tï¼Œæ— è¿”å›å€¼<br> unsigned int æ˜¯å®šä¹‰æ— ç¬¦å·æ•´å½¢å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯<br> 0~65535<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Delay(unsigned int t)<br>{<br> while(â€“t);<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡<br> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤º<br> ä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º<br> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚<br> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Display(unsigned char FirstBit,unsigned char Num)<br>{<br>      unsigned char i;</p><pre><code>  for(i=0;i&lt;Num;i++)   &#123;    DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±   LATCH1=1;     //æ®µé”å­˜   LATCH1=0;   DataPort = WeiMa[i+FirstBit]; //å–ä½ç     LATCH2=1;     //ä½é”å­˜   LATCH2=0;   DataPort = TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç    LATCH1=1;     //æ®µé”å­˜   LATCH1=0;      Delay(200); // æ‰«æé—´éš™å»¶æ—¶ï¼Œæ—¶é—´å¤ªé•¿ä¼šé—ªçƒï¼Œ               //å¤ªçŸ­ä¼šé€ æˆé‡å½±   &#125;</code></pre><p>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1mYSBwXnhikrhhotaSFAOEA </span><br><span class="line">æå–ç ï¼šrg39</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1mYSBwXnhikrhhotaSFAOEA  æå–ç ï¼šrg39</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘8ä½ç«¯å£æ£€æµ‹8ç‹¬ç«‹æŒ‰é”®</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F8%E4%BD%8D%E7%AB%AF%E5%8F%A3%E6%A3%80%E6%B5%8B8%E7%8B%AC%E7%AB%8B%E6%8C%89%E9%94%AE/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F8%E4%BD%8D%E7%AB%AF%E5%8F%A3%E6%A3%80%E6%B5%8B8%E7%8B%AC%E7%AB%8B%E6%8C%89%E9%94%AE/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘8ä½ç«¯å£æ£€æµ‹8ç‹¬ç«‹æŒ‰é”®"><a href="#ã€Proteusä»¿çœŸã€‘8ä½ç«¯å£æ£€æµ‹8ç‹¬ç«‹æŒ‰é”®" class="headerlink" title="ã€Proteusä»¿çœŸã€‘8ä½ç«¯å£æ£€æµ‹8ç‹¬ç«‹æŒ‰é”®"></a>ã€Proteusä»¿çœŸã€‘8ä½ç«¯å£æ£€æµ‹8ç‹¬ç«‹æŒ‰é”®</h1><h3 id="ã€Proteusä»¿çœŸã€‘8ä½ç«¯å£æ£€æµ‹8ç‹¬ç«‹æŒ‰é”®-1"><a href="#ã€Proteusä»¿çœŸã€‘8ä½ç«¯å£æ£€æµ‹8ç‹¬ç«‹æŒ‰é”®-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘8ä½ç«¯å£æ£€æµ‹8ç‹¬ç«‹æŒ‰é”®"></a>ã€Proteusä»¿çœŸã€‘8ä½ç«¯å£æ£€æµ‹8ç‹¬ç«‹æŒ‰é”®</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/fa5ace87a4844cac9a67516b7a935d73.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨ä¸‰ 6æœˆ 29 2022</span><br><span class="line"> * Processor: AT89C51</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line">/*-----------------------------------------------</span><br><span class="line">  åç§°ï¼šå•ä¸ªç‹¬ç«‹æŒ‰é”®ä¾æ¬¡è¾“å…¥æ§åˆ¶</span><br><span class="line">  å†…å®¹ï¼šå¦‚è®¡ç®—å™¨è¾“å…¥æ•°æ®å½¢å¼ç›¸åŒ ä»å·¦å¾€å³ åˆ©ç”¨æ•´ä¸ªç«¯å£æ‰«æè¯»å–æŒ‰é”®å€¼</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">#include&lt;reg52.h&gt; //åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</span><br><span class="line"></span><br><span class="line">#define KeyPort P1</span><br><span class="line">#define DataPort P0 //å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢</span><br><span class="line"></span><br><span class="line">sbit LATCH1=P2^2;//å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜</span><br><span class="line">sbit LATCH2=P2^3;//                 ä½é”å­˜</span><br><span class="line"></span><br><span class="line">unsigned char code DuanMa[10]=&#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f&#125;;// æ˜¾ç¤ºæ®µç å€¼0~9</span><br><span class="line">unsigned char code WeiMa[]=&#123;0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f&#125;;//åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç </span><br><span class="line">unsigned char TempData[10]; //å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡</span><br><span class="line"></span><br><span class="line">void DelayUs2x(unsigned char t);//usçº§å»¶æ—¶å‡½æ•°å£°æ˜ </span><br><span class="line">void DelayMs(unsigned char t); //msçº§å»¶æ—¶</span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num);//æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°</span><br><span class="line">unsigned char KeyScan(void);//é”®ç›˜æ‰«æ</span><br><span class="line">void Init_Timer0(void);//å®šæ—¶å™¨åˆå§‹åŒ–</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    ä¸»å‡½æ•°</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void main (void)</span><br><span class="line">&#123;</span><br><span class="line">unsigned char num,i,j;                  </span><br><span class="line"></span><br><span class="line">Init_Timer0();</span><br><span class="line"></span><br><span class="line">while (1)         //ä¸»å¾ªç¯</span><br><span class="line">  &#123;</span><br><span class="line"> num=KeyScan();</span><br><span class="line"> if(num)</span><br><span class="line">   &#123;</span><br><span class="line">   if(i&lt;8)</span><br><span class="line">     TempData[i]= DuanMa[num];</span><br><span class="line">i++;</span><br><span class="line">if(i==9)//å¤šå‡ºä¸€ä¸ªæŒ‰é”®è¾“å…¥ä¸ºäº†æ¸…å± åŸæœ¬åº”è¯¥ä¸º8</span><br><span class="line">  &#123;</span><br><span class="line">  i=0;</span><br><span class="line">      for(j=0;j&lt;8;j++)//æ¸…å±</span><br><span class="line">         TempData[j]=0;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  //Display(0,8); //æ˜¾ç¤ºå…¨éƒ¨8ä½</span><br><span class="line">     //ä¸»å¾ªç¯ä¸­æ·»åŠ å…¶ä»–éœ€è¦ä¸€ç›´å·¥ä½œçš„ç¨‹åº</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> uSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼</span><br><span class="line"> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯</span><br><span class="line"> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–,å¤§è‡´å»¶æ—¶</span><br><span class="line"> é•¿åº¦å¦‚ä¸‹ T=tx2+5 uS </span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void DelayUs2x(unsigned char t)</span><br><span class="line">&#123;   </span><br><span class="line"> while(--t);</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> mSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼</span><br><span class="line"> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯</span><br><span class="line"> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void DelayMs(unsigned char t)</span><br><span class="line">&#123;</span><br><span class="line">     </span><br><span class="line"> while(t--)</span><br><span class="line"> &#123;</span><br><span class="line">     //å¤§è‡´å»¶æ—¶1mS</span><br><span class="line">     DelayUs2x(245);</span><br><span class="line"> DelayUs2x(245);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡</span><br><span class="line"> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤ºä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º</span><br><span class="line"> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚</span><br><span class="line"> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num)</span><br><span class="line">&#123;</span><br><span class="line">      static unsigned char i=0;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">   DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±</span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line"></span><br><span class="line">       DataPort= WeiMa[i+FirstBit]; //å–ä½ç  </span><br><span class="line">       LATCH2=1;     //ä½é”å­˜</span><br><span class="line">       LATCH2=0;</span><br><span class="line"></span><br><span class="line">       DataPort=TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç </span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line">       </span><br><span class="line">   i++;</span><br><span class="line">       if(i==Num)</span><br><span class="line">      i=0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Init_Timer0(void)</span><br><span class="line">&#123;</span><br><span class="line"> TMOD |= 0x01;  //ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½å®šæ—¶å™¨ï¼Œä½¿ç”¨&quot;|&quot;ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“     </span><br><span class="line"> //TH0=0x00;      //ç»™å®šåˆå€¼</span><br><span class="line"> //TL0=0x00;</span><br><span class="line"> EA=1;            //æ€»ä¸­æ–­æ‰“å¼€</span><br><span class="line"> ET0=1;           //å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€</span><br><span class="line"> TR0=1;           //å®šæ—¶å™¨å¼€å…³æ‰“å¼€</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Timer0_isr(void) interrupt 1 </span><br><span class="line">&#123;</span><br><span class="line"> TH0=(65536-2000)/256;  //é‡æ–°èµ‹å€¼ 2ms</span><br><span class="line"> TL0=(65536-2000)%256;</span><br><span class="line"> </span><br><span class="line"> Display(0,8);       // è°ƒç”¨æ•°ç ç®¡æ‰«æ</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">          æŒ‰é”®æ‰«æå‡½æ•°ï¼Œè¿”å›æ‰«æé”®å€¼</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">unsigned char KeyScan(void)</span><br><span class="line">&#123;</span><br><span class="line"> unsigned char keyvalue;</span><br><span class="line"> if(KeyPort!=0xff)</span><br><span class="line">   &#123;</span><br><span class="line">    DelayMs(10);</span><br><span class="line">    if(KeyPort!=0xff)</span><br><span class="line">   &#123;</span><br><span class="line">    keyvalue=KeyPort;</span><br><span class="line">    while(KeyPort!=0xff);</span><br><span class="line">switch(keyvalue)</span><br><span class="line">&#123;</span><br><span class="line"> case 0xfe:return 1;break;</span><br><span class="line"> case 0xfd:return 2;break;</span><br><span class="line"> case 0xfb:return 3;break;</span><br><span class="line"> case 0xf7:return 4;break;</span><br><span class="line"> case 0xef:return 5;break;</span><br><span class="line"> case 0xdf:return 6;break;</span><br><span class="line"> case 0xbf:return 7;break;</span><br><span class="line"> case 0x7f:return 8;break;</span><br><span class="line"> default:return 0;break;</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨ä¸‰ 6æœˆ 29 2022</li><li>Processor: AT89C51</li><li>Compiler:  Keil for 8051<br> <em>&#x2F;<br>&#x2F;</em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</li></ul><p>  åç§°ï¼šå•ä¸ªç‹¬ç«‹æŒ‰é”®ä¾æ¬¡è¾“å…¥æ§åˆ¶<br>  å†…å®¹ï¼šå¦‚è®¡ç®—å™¨è¾“å…¥æ•°æ®å½¢å¼ç›¸åŒ ä»å·¦å¾€å³ åˆ©ç”¨æ•´ä¸ªç«¯å£æ‰«æè¯»å–æŒ‰é”®å€¼<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*&#x2F;<br>#include&lt;reg52.h&gt; &#x2F;&#x2F;åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</p><p>#define KeyPort P1<br>#define DataPort P0 &#x2F;&#x2F;å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢</p><p>sbit LATCH1&#x3D;P2^2;&#x2F;&#x2F;å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜<br>sbit LATCH2&#x3D;P2^3;&#x2F;&#x2F;                 ä½é”å­˜</p><p>unsigned char code DuanMa[10]&#x3D;{0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};&#x2F;&#x2F; æ˜¾ç¤ºæ®µç å€¼0~9<br>unsigned char code WeiMa[]&#x3D;{0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};&#x2F;&#x2F;åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç <br>unsigned char TempData[10]; &#x2F;&#x2F;å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡</p><p>void DelayUs2x(unsigned char t);&#x2F;&#x2F;usçº§å»¶æ—¶å‡½æ•°å£°æ˜<br>void DelayMs(unsigned char t); &#x2F;&#x2F;msçº§å»¶æ—¶<br>void Display(unsigned char FirstBit,unsigned char Num);&#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°<br>unsigned char KeyScan(void);&#x2F;&#x2F;é”®ç›˜æ‰«æ<br>void Init_Timer0(void);&#x2F;&#x2F;å®šæ—¶å™¨åˆå§‹åŒ–<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    ä¸»å‡½æ•°<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void main (void)<br>{<br>unsigned char num,i,j;                  </p><p>Init_Timer0();</p><p>while (1)         &#x2F;&#x2F;ä¸»å¾ªç¯<br>  {<br> num&#x3D;KeyScan();<br> if(num)<br>   {<br>   if(i&lt;8)<br>     TempData[i]&#x3D; DuanMa[num];<br>    i++;<br>    if(i&#x3D;&#x3D;9)&#x2F;&#x2F;å¤šå‡ºä¸€ä¸ªæŒ‰é”®è¾“å…¥ä¸ºäº†æ¸…å± åŸæœ¬åº”è¯¥ä¸º8<br>      {<br>      i&#x3D;0;<br>      for(j&#x3D;0;j&lt;8;j++)&#x2F;&#x2F;æ¸…å±<br>         TempData[j]&#x3D;0;<br>       }<br>   }<br>  &#x2F;&#x2F;Display(0,8); &#x2F;&#x2F;æ˜¾ç¤ºå…¨éƒ¨8ä½<br>     &#x2F;&#x2F;ä¸»å¾ªç¯ä¸­æ·»åŠ å…¶ä»–éœ€è¦ä¸€ç›´å·¥ä½œçš„ç¨‹åº</p><p>  }<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> uSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼<br> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯<br> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–,å¤§è‡´å»¶æ—¶<br> é•¿åº¦å¦‚ä¸‹ T&#x3D;tx2+5 uS<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void DelayUs2x(unsigned char t)<br>{<br> while(â€“t);<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> mSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼<br> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯<br> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void DelayMs(unsigned char t)<br>{</p><p> while(tâ€“)<br> {<br>     &#x2F;&#x2F;å¤§è‡´å»¶æ—¶1mS<br>     DelayUs2x(245);<br>     DelayUs2x(245);<br> }<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡<br> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤ºä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º<br> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚<br> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Display(unsigned char FirstBit,unsigned char Num)<br>{<br>      static unsigned char i&#x3D;0;</p><pre><code>   DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±   LATCH1=1;     //æ®µé”å­˜   LATCH1=0;   DataPort= WeiMa[i+FirstBit]; //å–ä½ç     LATCH2=1;     //ä½é”å­˜   LATCH2=0;   DataPort=TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç    LATCH1=1;     //æ®µé”å­˜   LATCH1=0;      i++;   if(i==Num)      i=0;</code></pre><p>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Init_Timer0(void)<br>{<br> TMOD |&#x3D; 0x01;  &#x2F;&#x2F;ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½å®šæ—¶å™¨ï¼Œä½¿ç”¨â€|â€ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“<br> &#x2F;&#x2F;TH0&#x3D;0x00;      &#x2F;&#x2F;ç»™å®šåˆå€¼<br> &#x2F;&#x2F;TL0&#x3D;0x00;<br> EA&#x3D;1;            &#x2F;&#x2F;æ€»ä¸­æ–­æ‰“å¼€<br> ET0&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€<br> TR0&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨å¼€å…³æ‰“å¼€<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Timer0_isr(void) interrupt 1<br>{<br> TH0&#x3D;(65536-2000)&#x2F;256;  &#x2F;&#x2F;é‡æ–°èµ‹å€¼ 2ms<br> TL0&#x3D;(65536-2000)%256;</p><p> Display(0,8);       &#x2F;&#x2F; è°ƒç”¨æ•°ç ç®¡æ‰«æ</p><p>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>          æŒ‰é”®æ‰«æå‡½æ•°ï¼Œè¿”å›æ‰«æé”®å€¼<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>unsigned char KeyScan(void)<br>{<br> unsigned char keyvalue;<br> if(KeyPort!&#x3D;0xff)<br>   {<br>    DelayMs(10);<br>    if(KeyPort!&#x3D;0xff)<br>       {<br>        keyvalue&#x3D;KeyPort;<br>        while(KeyPort!&#x3D;0xff);<br>        switch(keyvalue)<br>        {<br>         case 0xfe:return 1;break;<br>         case 0xfd:return 2;break;<br>         case 0xfb:return 3;break;<br>         case 0xf7:return 4;break;<br>         case 0xef:return 5;break;<br>         case 0xdf:return 6;break;<br>         case 0xbf:return 7;break;<br>         case 0x7f:return 8;break;<br>         default:return 0;break;<br>        }<br>      }<br>   }<br>   return 0;<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/18-s5W6zMmE5WO21AulUPfA </span><br><span class="line">æå–ç ï¼šgknh</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/18-s5W6zMmE5WO21AulUPfA  æå–ç ï¼šgknh</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘AT24C02æ•°æ®è¯»å†™+LCD1602æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FAT24C02%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99LCD1602%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FAT24C02%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99LCD1602%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘AT24C02æ•°æ®è¯»å†™-LCD1602æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘AT24C02æ•°æ®è¯»å†™-LCD1602æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘AT24C02æ•°æ®è¯»å†™+LCD1602æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘AT24C02æ•°æ®è¯»å†™+LCD1602æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘AT24C02æ•°æ®è¯»å†™-LCD1602æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘AT24C02æ•°æ®è¯»å†™-LCD1602æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘AT24C02æ•°æ®è¯»å†™+LCD1602æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘AT24C02æ•°æ®è¯»å†™+LCD1602æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/e75def69e4af4f55a957cd9f72c16312.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¨‹åºè¯´æ˜"><a href="#ç¨‹åºè¯´æ˜" class="headerlink" title="ç¨‹åºè¯´æ˜"></a>ç¨‹åºè¯´æ˜</h4><ol><li>AT24C02é‡‡ç”¨çš„IICé€šè®¯ï¼ŒSCK:P20;SDA:P21</li><li>æŒ‰é”®K1-K4åˆ†åˆ«æ¥åˆ°P30-P33å¼•è„šä¸Šã€‚</li></ol><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;REGX52.H&gt;</span><br><span class="line">#include &quot;LCD1602.h&quot;</span><br><span class="line">#include &quot;Key.h&quot;</span><br><span class="line">#include &quot;AT24C02.h&quot;</span><br><span class="line">#include &quot;Delay.h&quot;</span><br><span class="line"></span><br><span class="line">unsigned char KeyNum;</span><br><span class="line">unsigned int Num;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">LCD_Init();</span><br><span class="line">LCD_ShowNum(1,1,Num,5);</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">KeyNum=Key();</span><br><span class="line">if(KeyNum==1)//K1æŒ‰é”®ï¼ŒNumè‡ªå¢P3_1</span><br><span class="line">&#123;</span><br><span class="line">Num++;</span><br><span class="line">LCD_ShowNum(1,1,Num,5);</span><br><span class="line">&#125;</span><br><span class="line">if(KeyNum==2)//K2æŒ‰é”®ï¼ŒNumè‡ªå‡P3_0</span><br><span class="line">&#123;</span><br><span class="line">Num--;</span><br><span class="line">LCD_ShowNum(1,1,Num,5);</span><br><span class="line">&#125;</span><br><span class="line">if(KeyNum==3)//K3æŒ‰é”®ï¼Œå‘AT24C02å†™å…¥æ•°æ®P3_2</span><br><span class="line">&#123;</span><br><span class="line">AT24C02_WriteByte(0,Num%256);</span><br><span class="line">Delay(5);</span><br><span class="line">AT24C02_WriteByte(1,Num/256);</span><br><span class="line">Delay(5);</span><br><span class="line">LCD_ShowString(2,1,&quot;Write OK&quot;);</span><br><span class="line">Delay(1000);</span><br><span class="line">LCD_ShowString(2,1,&quot;        &quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(KeyNum==4)//K4æŒ‰é”®ï¼Œä»AT24C02è¯»å–æ•°æ®P3_4</span><br><span class="line">&#123;</span><br><span class="line">Num=AT24C02_ReadByte(0);</span><br><span class="line">Num|=AT24C02_ReadByte(1)&lt;&lt;8;</span><br><span class="line">LCD_ShowNum(1,1,Num,5);</span><br><span class="line">LCD_ShowString(2,1,&quot;Read OK &quot;);</span><br><span class="line">Delay(1000);</span><br><span class="line">LCD_ShowString(2,1,&quot;        &quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;REGX52.H&gt;<br>#include â€œLCD1602.hâ€<br>#include â€œKey.hâ€<br>#include â€œAT24C02.hâ€<br>#include â€œDelay.hâ€</p><p>unsigned char KeyNum;<br>unsigned int Num;</p><p>void main()<br>{<br>    LCD_Init();<br>    LCD_ShowNum(1,1,Num,5);<br>    while(1)<br>    {<br>        KeyNum&#x3D;Key();<br>        if(KeyNum&#x3D;&#x3D;1)&#x2F;&#x2F;K1æŒ‰é”®ï¼ŒNumè‡ªå¢P3_1<br>        {<br>            Num++;<br>            LCD_ShowNum(1,1,Num,5);<br>        }<br>        if(KeyNum&#x3D;&#x3D;2)&#x2F;&#x2F;K2æŒ‰é”®ï¼ŒNumè‡ªå‡P3_0<br>        {<br>            Numâ€“;<br>            LCD_ShowNum(1,1,Num,5);<br>        }<br>        if(KeyNum&#x3D;&#x3D;3)&#x2F;&#x2F;K3æŒ‰é”®ï¼Œå‘AT24C02å†™å…¥æ•°æ®P3_2<br>        {<br>            AT24C02_WriteByte(0,Num%256);<br>            Delay(5);<br>            AT24C02_WriteByte(1,Num&#x2F;256);<br>            Delay(5);<br>            LCD_ShowString(2,1,â€Write OKâ€);<br>            Delay(1000);<br>            LCD_ShowString(2,1,â€        â€œ);<br>        }<br>        if(KeyNum&#x3D;&#x3D;4)&#x2F;&#x2F;K4æŒ‰é”®ï¼Œä»AT24C02è¯»å–æ•°æ®P3_4<br>        {<br>            Num&#x3D;AT24C02_ReadByte(0);<br>            Num|&#x3D;AT24C02_ReadByte(1)&lt;&lt;8;<br>            LCD_ShowNum(1,1,Num,5);<br>            LCD_ShowString(2,1,â€Read OK â€œ);<br>            Delay(1000);<br>            LCD_ShowString(2,1,â€        â€œ);<br>        }<br>    }<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.9SP2å¹³å°</p><p><code>Proteus8.9SP2</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1dt-wxFNmulZdwDDSQ2Y-Qw </span><br><span class="line">æå–ç ï¼ši6rs</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1dt-wxFNmulZdwDDSQ2Y-Qw  æå–ç ï¼ši6rs</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘BME280æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨æ•°æ®ä¸²å£è¾“å‡º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FBME280%E6%B8%A9%E6%B9%BF%E5%BA%A6%E6%B0%94%E5%8E%8B%E4%BC%A0%E6%84%9F%E5%99%A8%E6%95%B0%E6%8D%AE%E4%B8%B2%E5%8F%A3%E8%BE%93%E5%87%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FBME280%E6%B8%A9%E6%B9%BF%E5%BA%A6%E6%B0%94%E5%8E%8B%E4%BC%A0%E6%84%9F%E5%99%A8%E6%95%B0%E6%8D%AE%E4%B8%B2%E5%8F%A3%E8%BE%93%E5%87%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘BME280æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨æ•°æ®ä¸²å£è¾“å‡º"><a href="#ã€Proteusä»¿çœŸã€‘BME280æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨æ•°æ®ä¸²å£è¾“å‡º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘BME280æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨æ•°æ®ä¸²å£è¾“å‡º"></a>ã€Proteusä»¿çœŸã€‘BME280æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨æ•°æ®ä¸²å£è¾“å‡º</h1><h3 id="ã€Proteusä»¿çœŸã€‘BME280æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨æ•°æ®ä¸²å£è¾“å‡º-1"><a href="#ã€Proteusä»¿çœŸã€‘BME280æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨æ•°æ®ä¸²å£è¾“å‡º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘BME280æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨æ•°æ®ä¸²å£è¾“å‡º"></a>ã€Proteusä»¿çœŸã€‘BME280æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨æ•°æ®ä¸²å£è¾“å‡º</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/582bb0b20e3a44c0b0b632b48a0aa746.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="BMP280èµ„æ–™ä¸‹è½½é“¾æ¥ï¼š"><a href="#BMP280èµ„æ–™ä¸‹è½½é“¾æ¥ï¼š" class="headerlink" title="BMP280èµ„æ–™ä¸‹è½½é“¾æ¥ï¼š"></a>BMP280èµ„æ–™ä¸‹è½½é“¾æ¥ï¼š</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://pan.baidu.com/s/1TyQGJQ6R30hntzGr1SaSNg </span><br><span class="line">æå–ç ï¼š8888</span><br></pre></td></tr></table></figure><p><code>https://pan.baidu.com/s/1TyQGJQ6R30hntzGr1SaSNg  æå–ç ï¼š8888</code></p><h4 id="æ¥å£ç±»å‹"><a href="#æ¥å£ç±»å‹" class="headerlink" title="æ¥å£ç±»å‹"></a>æ¥å£ç±»å‹</h4><ul><li>I2Cæ¥å£</li><li>SPIæ¥å£</li></ul><p><img src="https://img-blog.csdnimg.cn/b1b64f29b6f54163962bb7f58c3bf740.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/75d2a34dd8764917bed11f0300b089d9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ‰€éœ€åº“"><a href="#æ‰€éœ€åº“" class="headerlink" title="æ‰€éœ€åº“"></a>æ‰€éœ€åº“</h4><ul><li>Adafruit_Unified_Sensor</li><li>Adafruit_BME280</li><li>Adafruit_BusIO</li></ul><p>å…·ä½“ç‰ˆæœ¬ä¿¡æ¯å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¼–è¯‘ä¿¡æ¯ã€‚</p><h4 id="ç¨‹åºä»£ç "><a href="#ç¨‹åºä»£ç " class="headerlink" title="ç¨‹åºä»£ç "></a>ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;Wire.h&gt;</span><br><span class="line">#include &lt;SPI.h&gt;</span><br><span class="line">#include &lt;Adafruit_Sensor.h&gt;//ç‚¹å‡»è¿™é‡Œä¼šè‡ªåŠ¨æ‰“å¼€ç®¡ç†åº“é¡µé¢: http://librarymanager/All#Adafruit_Sensor</span><br><span class="line">#include &lt;Adafruit_BME280.h&gt;//ç‚¹å‡»è¿™é‡Œä¼šè‡ªåŠ¨æ‰“å¼€ç®¡ç†åº“é¡µé¢: http://librarymanager/All#Adafruit_BME280</span><br><span class="line"></span><br><span class="line">#define BME_SCK 13</span><br><span class="line">#define BME_MISO 12</span><br><span class="line">#define BME_MOSI 11</span><br><span class="line">#define BME_CS 10</span><br><span class="line"></span><br><span class="line">#define SEALEVELPRESSURE_HPA (1013.25)</span><br><span class="line"></span><br><span class="line">//Adafruit_BME280 bme; // I2C</span><br><span class="line">Adafruit_BME280 bme(BME_CS); // hardware SPI</span><br><span class="line">//Adafruit_BME280 bme(BME_CS, BME_MOSI, BME_MISO, BME_SCK); // software SPI</span><br><span class="line"></span><br><span class="line">unsigned long delayTime;</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line">  Serial.begin(9600);</span><br><span class="line">  Serial.println(F(&quot;BME280 test&quot;));</span><br><span class="line"></span><br><span class="line">  bool status;</span><br><span class="line">  </span><br><span class="line">  // default settings</span><br><span class="line">  // (you can also pass in a Wire library object like &amp;Wire2)</span><br><span class="line">  status = bme.begin();  </span><br><span class="line">  if (!status) &#123;</span><br><span class="line">    Serial.println(&quot;Could not find a valid BME280 sensor, check wiring!&quot;);</span><br><span class="line">    while (1);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Serial.println(&quot;-- Default Test --&quot;);</span><br><span class="line">  delayTime = 1000;</span><br><span class="line"></span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void loop() &#123; </span><br><span class="line">  printValues();</span><br><span class="line">  delay(delayTime);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void printValues() &#123;</span><br><span class="line">  Serial.print(&quot;Temperature = &quot;);</span><br><span class="line">  Serial.print(bme.readTemperature());</span><br><span class="line">  Serial.println(&quot; *C&quot;);</span><br><span class="line">  </span><br><span class="line">  // Convert temperature to Fahrenheit</span><br><span class="line">  /*Serial.print(&quot;Temperature = &quot;);</span><br><span class="line">  Serial.print(1.8 * bme.readTemperature() + 32);</span><br><span class="line">  Serial.println(&quot; *F&quot;);*/</span><br><span class="line">  </span><br><span class="line">  Serial.print(&quot;Pressure = &quot;);</span><br><span class="line">  Serial.print(bme.readPressure() / 100.0F);</span><br><span class="line">  Serial.println(&quot; hPa&quot;);</span><br><span class="line">  </span><br><span class="line">  Serial.print(&quot;Approx. Altitude = &quot;);</span><br><span class="line">  Serial.print(bme.readAltitude(SEALEVELPRESSURE_HPA));</span><br><span class="line">  Serial.println(&quot; m&quot;);</span><br><span class="line">  </span><br><span class="line">  Serial.print(&quot;Humidity = &quot;);</span><br><span class="line">  Serial.print(bme.readHumidity());</span><br><span class="line">  Serial.println(&quot; %&quot;);</span><br><span class="line">  </span><br><span class="line">  Serial.println();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;Wire.h&gt;<br>#include &lt;SPI.h&gt;<br>#include &lt;Adafruit_Sensor.h&gt;&#x2F;&#x2F;ç‚¹å‡»è¿™é‡Œä¼šè‡ªåŠ¨æ‰“å¼€ç®¡ç†åº“é¡µé¢: <a href="http://librarymanager/All#Adafruit_Sensor">http://librarymanager/All#Adafruit_Sensor</a><br>#include &lt;Adafruit_BME280.h&gt;&#x2F;&#x2F;ç‚¹å‡»è¿™é‡Œä¼šè‡ªåŠ¨æ‰“å¼€ç®¡ç†åº“é¡µé¢: <a href="http://librarymanager/All#Adafruit_BME280">http://librarymanager/All#Adafruit_BME280</a></p><p>#define BME_SCK 13<br>#define BME_MISO 12<br>#define BME_MOSI 11<br>#define BME_CS 10</p><p>#define SEALEVELPRESSURE_HPA (1013.25)</p><p>&#x2F;&#x2F;Adafruit_BME280 bme; &#x2F;&#x2F; I2C<br>Adafruit_BME280 bme(BME_CS); &#x2F;&#x2F; hardware SPI<br>&#x2F;&#x2F;Adafruit_BME280 bme(BME_CS, BME_MOSI, BME_MISO, BME_SCK); &#x2F;&#x2F; software SPI</p><p>unsigned long delayTime;</p><p>void setup() {<br>  Serial.begin(9600);<br>  Serial.println(F(â€œBME280 testâ€));</p><p>  bool status;</p><p>  &#x2F;&#x2F; default settings<br>  &#x2F;&#x2F; (you can also pass in a Wire library object like &amp;Wire2)<br>  status &#x3D; bme.begin();<br>  if (!status) {<br>    Serial.println(â€œCould not find a valid BME280 sensor, check wiring!â€);<br>    while (1);<br>  }</p><p>  Serial.println(â€œâ€“ Default Test â€“â€);<br>  delayTime &#x3D; 1000;</p><p>  Serial.println();<br>}</p><p>void loop() {<br>  printValues();<br>  delay(delayTime);<br>}</p><p>void printValues() {<br>  Serial.print(â€œTemperature &#x3D; â€œ);<br>  Serial.print(bme.readTemperature());<br>  Serial.println(â€œ *Câ€);</p><p>  &#x2F;&#x2F; Convert temperature to Fahrenheit<br>  &#x2F;*Serial.print(â€œTemperature &#x3D; â€œ);<br>  Serial.print(1.8 * bme.readTemperature() + 32);<br>  Serial.println(â€œ <em>Fâ€);</em>&#x2F;</p><p>  Serial.print(â€œPressure &#x3D; â€œ);<br>  Serial.print(bme.readPressure() &#x2F; 100.0F);<br>  Serial.println(â€œ hPaâ€);</p><p>  Serial.print(â€œApprox. Altitude &#x3D; â€œ);<br>  Serial.print(bme.readAltitude(SEALEVELPRESSURE_HPA));<br>  Serial.println(â€œ mâ€);</p><p>  Serial.print(â€œHumidity &#x3D; â€œ);<br>  Serial.print(bme.readHumidity());<br>  Serial.println(â€œ %â€);</p><p>  Serial.println();<br>}&#96;</p><ul><li>ç¼–è¯‘ä¿¡æ¯</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨ï¼š C:\Users\Administrator\Documents\Arduino\libraries\Adafruit_BusIO</span><br><span class="line">ä½¿ç”¨ 1.0  ç‰ˆæœ¬çš„åº“ Wire åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\AppData\Local\Arduino15\packages\arduino\hardware\avr\1.8.4\libraries\Wire </span><br><span class="line">ä½¿ç”¨ 1.0  ç‰ˆæœ¬çš„åº“ SPI åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\AppData\Local\Arduino15\packages\arduino\hardware\avr\1.8.4\libraries\SPI </span><br><span class="line">ä½¿ç”¨ 1.1.4  ç‰ˆæœ¬çš„åº“ Adafruit_Unified_Sensor åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\Documents\Arduino\libraries\Adafruit_Unified_Sensor </span><br><span class="line">ä½¿ç”¨ 2.2.1  ç‰ˆæœ¬çš„åº“ Adafruit_BME280_Library åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\Documents\Arduino\libraries\Adafruit_BME280_Library </span><br><span class="line">ä½¿ç”¨ 1.9.8  ç‰ˆæœ¬çš„åº“ Adafruit_BusIO åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\Documents\Arduino\libraries\Adafruit_BusIO </span><br><span class="line">&quot;C:\\Users\\Administrator\\AppData\\Local\\Arduino15\\packages\\arduino\\tools\\avr-gcc\\7.3.0-atmel3.6.1-arduino7/bin/avr-size&quot; -A &quot;d:\\arduino\\MyHexDir/bme280test.ino.elf&quot;</span><br><span class="line">é¡¹ç›®ä½¿ç”¨äº† 13814 å­—èŠ‚ï¼Œå ç”¨äº† (42%) ç¨‹åºå­˜å‚¨ç©ºé—´ã€‚æœ€å¤§ä¸º 32256 å­—èŠ‚ã€‚</span><br><span class="line">å…¨å±€å˜é‡ä½¿ç”¨äº†636å­—èŠ‚ï¼Œ(31%)çš„åŠ¨æ€å†…å­˜ï¼Œä½™ç•™1412å­—èŠ‚å±€éƒ¨å˜é‡ã€‚æœ€å¤§ä¸º2048å­—èŠ‚ã€‚</span><br></pre></td></tr></table></figure><p><code>ä½¿ç”¨ï¼š C:\Users\Administrator\Documents\Arduino\libraries\Adafruit_BusIO ä½¿ç”¨ 1.0  ç‰ˆæœ¬çš„åº“ Wire åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\AppData\Local\Arduino15\packages\arduino\hardware\avr\1.8.4\libraries\Wire  ä½¿ç”¨ 1.0  ç‰ˆæœ¬çš„åº“ SPI åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\AppData\Local\Arduino15\packages\arduino\hardware\avr\1.8.4\libraries\SPI  ä½¿ç”¨ 1.1.4  ç‰ˆæœ¬çš„åº“ Adafruit_Unified_Sensor åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\Documents\Arduino\libraries\Adafruit_Unified_Sensor  ä½¿ç”¨ 2.2.1  ç‰ˆæœ¬çš„åº“ Adafruit_BME280_Library åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\Documents\Arduino\libraries\Adafruit_BME280_Library  ä½¿ç”¨ 1.9.8  ç‰ˆæœ¬çš„åº“ Adafruit_BusIO åœ¨æ–‡ä»¶å¤¹ï¼š C:\Users\Administrator\Documents\Arduino\libraries\Adafruit_BusIO  &quot;C:\\Users\\Administrator\\AppData\\Local\\Arduino15\\packages\\arduino\\tools\\avr-gcc\\7.3.0-atmel3.6.1-arduino7/bin/avr-size&quot; -A &quot;d:\\arduino\\MyHexDir/bme280test.ino.elf&quot; é¡¹ç›®ä½¿ç”¨äº† 13814 å­—èŠ‚ï¼Œå ç”¨äº† (42%) ç¨‹åºå­˜å‚¨ç©ºé—´ã€‚æœ€å¤§ä¸º 32256 å­—èŠ‚ã€‚ å…¨å±€å˜é‡ä½¿ç”¨äº†636å­—èŠ‚ï¼Œ(31%)çš„åŠ¨æ€å†…å­˜ï¼Œä½™ç•™1412å­—èŠ‚å±€éƒ¨å˜é‡ã€‚æœ€å¤§ä¸º2048å­—èŠ‚ã€‚</code></p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/10M_d51nd2jFMpm1RuORLLA </span><br><span class="line">æå–ç ï¼šreo8</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/10M_d51nd2jFMpm1RuORLLA  æå–ç ï¼šreo8</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘DS18B20+æŠ¥è­¦æ¸©åº¦å¯è°ƒ+LM016æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FDS18B20%E6%8A%A5%E8%AD%A6%E6%B8%A9%E5%BA%A6%E5%8F%AF%E8%B0%83LM016%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FDS18B20%E6%8A%A5%E8%AD%A6%E6%B8%A9%E5%BA%A6%E5%8F%AF%E8%B0%83LM016%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘DS18B20-æŠ¥è­¦æ¸©åº¦å¯è°ƒ-LM016æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘DS18B20-æŠ¥è­¦æ¸©åº¦å¯è°ƒ-LM016æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘DS18B20+æŠ¥è­¦æ¸©åº¦å¯è°ƒ+LM016æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘DS18B20+æŠ¥è­¦æ¸©åº¦å¯è°ƒ+LM016æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘DS18B20-æŠ¥è­¦æ¸©åº¦å¯è°ƒ-LM016æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘DS18B20-æŠ¥è­¦æ¸©åº¦å¯è°ƒ-LM016æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘DS18B20+æŠ¥è­¦æ¸©åº¦å¯è°ƒ+LM016æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘DS18B20+æŠ¥è­¦æ¸©åº¦å¯è°ƒ+LM016æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/e50c6dbbb6504e079a26a311362910ba.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åº"><a href="#ä¸»ç¨‹åº" class="headerlink" title="ä¸»ç¨‹åº"></a>ä¸»ç¨‹åº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;reg52.h&gt;</span><br><span class="line">#include&lt;1602.h&gt;</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line">sbit ds   = P2^2;//ds18b20</span><br><span class="line">sbit beep = P2^3;//èœ‚é¸£å™¨æŠ¥è­¦</span><br><span class="line">sbit rd = P3^7;</span><br><span class="line">bit flag;</span><br><span class="line">uchar ds_rom[8];</span><br><span class="line">uchar H,L,Key_value;</span><br><span class="line">void TempDelay(uchar us)</span><br><span class="line">&#123;</span><br><span class="line">while(us--); //6.51us</span><br><span class="line">&#125;</span><br><span class="line">void ds_reset()</span><br><span class="line">&#123;</span><br><span class="line">ds=1;</span><br><span class="line">_nop_();</span><br><span class="line">ds=0;</span><br><span class="line">TempDelay(80);//520us</span><br><span class="line">ds=1;</span><br><span class="line">TempDelay(5);</span><br><span class="line">if(ds==0)</span><br><span class="line">flag=1;</span><br><span class="line">else</span><br><span class="line">flag=0;</span><br><span class="line">TempDelay(20);</span><br><span class="line">ds=1;</span><br><span class="line">&#125;</span><br><span class="line">bit ds_read_bit()</span><br><span class="line">&#123;</span><br><span class="line">bit dat;</span><br><span class="line">ds=0;</span><br><span class="line">_nop_();</span><br><span class="line">_nop_();</span><br><span class="line">ds=1;</span><br><span class="line">_nop_();</span><br><span class="line">dat=ds;</span><br><span class="line">TempDelay(12);</span><br><span class="line">return dat;</span><br><span class="line">&#125;</span><br><span class="line">uchar ds_read_byte()</span><br><span class="line">&#123;</span><br><span class="line">uchar i,j,value;</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">&#123;</span><br><span class="line">j=ds_read_bit();</span><br><span class="line">value=(j&lt;&lt;7)|(value&gt;&gt;1);</span><br><span class="line">&#125;</span><br><span class="line">return value;</span><br><span class="line">&#125;</span><br><span class="line">void ds_write_byte(uchar dat)</span><br><span class="line">&#123;</span><br><span class="line">uchar i,onebit;</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">&#123;</span><br><span class="line">onebit=dat&amp;0x01;</span><br><span class="line">if(onebit)   //Ğ´1</span><br><span class="line">&#123;</span><br><span class="line">ds=0;</span><br><span class="line">TempDelay(1);</span><br><span class="line">ds=1;</span><br><span class="line">_nop_();</span><br><span class="line">&#125;</span><br><span class="line">else  //Ğ´0</span><br><span class="line">&#123;</span><br><span class="line">ds=0;</span><br><span class="line">TempDelay(11);</span><br><span class="line">ds=1;</span><br><span class="line">_nop_();</span><br><span class="line">&#125;</span><br><span class="line">dat&gt;&gt;=1;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void ds_change()</span><br><span class="line">&#123;</span><br><span class="line">ds_reset();</span><br><span class="line">ds_write_byte(0xcc);</span><br><span class="line">ds_write_byte(0x44);</span><br><span class="line">&#125;</span><br><span class="line">uchar get_temperature()</span><br><span class="line">&#123;</span><br><span class="line">uint temp;</span><br><span class="line">uchar a,b,c;</span><br><span class="line">ds_reset();</span><br><span class="line">ds_write_byte(0xcc);</span><br><span class="line">ds_write_byte(0xbe);</span><br><span class="line">a=ds_read_byte();</span><br><span class="line">b=ds_read_byte();</span><br><span class="line">temp=b;</span><br><span class="line">temp&lt;&lt;=8;</span><br><span class="line">temp|=a;</span><br><span class="line">c = temp*0.0625;</span><br><span class="line">return c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void key()</span><br><span class="line">&#123;</span><br><span class="line">Key_value = P3;</span><br><span class="line">Key_value = Key_value &amp; 0x0f;</span><br><span class="line">if ( Key_value != 0x0f )</span><br><span class="line">&#123;</span><br><span class="line">delay(120);</span><br><span class="line">if(Key_value != 0x0f )&#123;</span><br><span class="line"></span><br><span class="line">switch(Key_value)</span><br><span class="line">&#123;</span><br><span class="line">case 0x0e: H++; break;//P30</span><br><span class="line">case 0x0d: H--; break;//P31</span><br><span class="line">case 0x0b: L++; break;//P32</span><br><span class="line">case 0x07: L--; break;//P33</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">uchar i;</span><br><span class="line">rd = 0;</span><br><span class="line">init_1602();</span><br><span class="line"></span><br><span class="line">write_com( 0x80 + 0 + 3);</span><br><span class="line">write_data( &#x27;H&#x27; );</span><br><span class="line">write_com( 0x80 + 0 + 8);</span><br><span class="line">write_data( &#x27;L&#x27; );</span><br><span class="line"></span><br><span class="line">lcd_distostr(1,1,0);</span><br><span class="line"></span><br><span class="line">H = 40;</span><br><span class="line">L = 10;</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">ds_change();</span><br><span class="line">i = get_temperature();</span><br><span class="line">lcd_dis( 1,14,uchartostr( i ) );</span><br><span class="line">lcd_dis( 0,5,uchartostr( H ) );</span><br><span class="line">lcd_dis( 0,10,uchartostr( L ) );</span><br><span class="line">if ( i &gt;= H || i &lt;= L)</span><br><span class="line">&#123;</span><br><span class="line"> beep = 0;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line"> beep = 1;</span><br><span class="line">&#125;</span><br><span class="line">key(); </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include&lt;reg52.h&gt;<br>#include&lt;1602.h&gt;<br>#include&lt;intrins.h&gt;<br>sbit ds   &#x3D; P2^2;&#x2F;&#x2F;ds18b20<br>sbit beep &#x3D; P2^3;&#x2F;&#x2F;èœ‚é¸£å™¨æŠ¥è­¦<br>sbit rd &#x3D; P3^7;<br>bit flag;<br>uchar ds_rom[8];<br>uchar H,L,Key_value;<br>void TempDelay(uchar us)<br>{<br>    while(usâ€“); &#x2F;&#x2F;6.51us<br>}<br>void ds_reset()<br>{<br>    ds&#x3D;1;<br>    <em>nop</em>();<br>    ds&#x3D;0;<br>    TempDelay(80);&#x2F;&#x2F;520us<br>    ds&#x3D;1;<br>    TempDelay(5);<br>    if(ds&#x3D;&#x3D;0)<br>        flag&#x3D;1;<br>    else<br>        flag&#x3D;0;<br>    TempDelay(20);<br>    ds&#x3D;1;<br>}<br>bit ds_read_bit()<br>{<br>    bit dat;<br>    ds&#x3D;0;<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    ds&#x3D;1;<br>    <em>nop</em>();<br>    dat&#x3D;ds;<br>    TempDelay(12);<br>    return dat;<br>}<br>uchar ds_read_byte()<br>{<br>    uchar i,j,value;<br>    for(i&#x3D;0;i&lt;8;i++)<br>    {<br>        j&#x3D;ds_read_bit();<br>        value&#x3D;(j&lt;&lt;7)|(value&gt;&gt;1);<br>    }<br>    return value;<br>}<br>void ds_write_byte(uchar dat)<br>{<br>    uchar i,onebit;<br>    for(i&#x3D;0;i&lt;8;i++)<br>    {<br>        onebit&#x3D;dat&0x01;<br>        if(onebit)   &#x2F;&#x2F;Ğ´1<br>        {<br>            ds&#x3D;0;<br>            TempDelay(1);<br>            ds&#x3D;1;<br>            _nop_();<br>        }<br>        else  &#x2F;&#x2F;Ğ´0<br>        {<br>            ds&#x3D;0;<br>            TempDelay(11);<br>            ds&#x3D;1;<br>            _nop_();<br>        }<br>        dat&gt;&gt;&#x3D;1;<br>    }<br>}</p><p>void ds_change()<br>{<br>    ds_reset();<br>    ds_write_byte(0xcc);<br>    ds_write_byte(0x44);<br>}<br>uchar get_temperature()<br>{<br>    uint temp;<br>    uchar a,b,c;<br>    ds_reset();<br>    ds_write_byte(0xcc);<br>    ds_write_byte(0xbe);<br>    a&#x3D;ds_read_byte();<br>    b&#x3D;ds_read_byte();<br>    temp&#x3D;b;<br>    temp&lt;&lt;&#x3D;8;<br>    temp|&#x3D;a;<br>    c &#x3D; temp*0.0625;<br>    return c;<br>}</p><p>void key()<br>{<br>    Key_value &#x3D; P3;<br>    Key_value &#x3D; Key_value &amp; 0x0f;<br>    if ( Key_value !&#x3D; 0x0f )<br>    {<br>        delay(120);<br>        if(Key_value !&#x3D; 0x0f ){</p><pre><code>        switch(Key_value)        &#123;            case 0x0e: H++; break;//P30            case 0x0d: H--; break;//P31            case 0x0b: L++; break;//P32            case 0x07: L--; break;//P33        &#125;    &#125;&#125;</code></pre><p>}</p><p>void main()<br>{<br>    uchar i;<br>    rd &#x3D; 0;<br>    init_1602();</p><pre><code>write_com( 0x80 + 0 + 3);write_data( &#39;H&#39; );write_com( 0x80 + 0 + 8);write_data( &#39;L&#39; );lcd_distostr(1,1,0);H = 40;L = 10;while(1)&#123;    ds_change();    i = get_temperature();    lcd_dis( 1,14,uchartostr( i ) );    lcd_dis( 0,5,uchartostr( H ) );    lcd_dis( 0,10,uchartostr( L ) );    if ( i &gt;= H || i &lt;= L)    &#123;     beep = 0;    &#125;    else    &#123;     beep = 1;    &#125;    key(); &#125;  </code></pre><p>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1cNOvEdcso85SK95N7-QrSA </span><br><span class="line">æå–ç ï¼šokxs</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1cNOvEdcso85SK95N7-QrSA  æå–ç ï¼šokxs</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘INT0å’ŒINT1ä¸­æ–­è®¡æ•°</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FINT0%E5%92%8CINT1%E4%B8%AD%E6%96%AD%E8%AE%A1%E6%95%B0/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FINT0%E5%92%8CINT1%E4%B8%AD%E6%96%AD%E8%AE%A1%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘INT0å’ŒINT1ä¸­æ–­è®¡æ•°"><a href="#ã€Proteusä»¿çœŸã€‘INT0å’ŒINT1ä¸­æ–­è®¡æ•°" class="headerlink" title="ã€Proteusä»¿çœŸã€‘INT0å’ŒINT1ä¸­æ–­è®¡æ•°"></a>ã€Proteusä»¿çœŸã€‘INT0å’ŒINT1ä¸­æ–­è®¡æ•°</h1><h3 id="ã€Proteusä»¿çœŸã€‘INT0å’ŒINT1ä¸­æ–­è®¡æ•°-1"><a href="#ã€Proteusä»¿çœŸã€‘INT0å’ŒINT1ä¸­æ–­è®¡æ•°-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘INT0å’ŒINT1ä¸­æ–­è®¡æ•°"></a>ã€Proteusä»¿çœŸã€‘INT0å’ŒINT1ä¸­æ–­è®¡æ•°</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/5ca54bf90a4f49538b45cadab6822c1d.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸­æ–­ç›¸å…³å¯„å­˜å™¨"><a href="#ä¸­æ–­ç›¸å…³å¯„å­˜å™¨" class="headerlink" title="ä¸­æ–­ç›¸å…³å¯„å­˜å™¨"></a>ä¸­æ–­ç›¸å…³å¯„å­˜å™¨</h4><ul><li>IE</li><li>IP</li><li>PSï¼šä¸²è¡Œå£ä¸­æ–­ä¼˜å…ˆçº§æ§åˆ¶ä½ã€‚</li><li>PT1ï¼šT1ä¸­æ–­ä¼˜å…ˆçº§æ§åˆ¶ä½ã€‚</li><li>PX1ï¼šå¤–éƒ¨ä¸­æ–­1ä¼˜å…ˆçº§æ§åˆ¶ä½ã€‚</li><li>PT0ï¼šT0ä¸­æ–­ä¼˜å…ˆçº§æ§åˆ¶ä½ã€‚</li><li>PX0ï¼šå¤–éƒ¨ä¸­æ–­0ä¼˜å…ˆçº§æ§åˆ¶ä½ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/be9b149135074270b5e44676cbab58d6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/c392e47b3bc04bc6bbc8890e6970f372.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line"></span><br><span class="line">sbit k3 = P3^4;</span><br><span class="line">sbit k4 = P3^5;</span><br><span class="line"></span><br><span class="line">uchar code DSY_CODE[]=</span><br><span class="line">&#123;</span><br><span class="line"> 0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,0xff</span><br><span class="line">&#125;;//å…±é˜³æ®µç </span><br><span class="line"></span><br><span class="line">uchar code Scan_BITs[]=</span><br><span class="line">&#123;</span><br><span class="line">  0x20,0x10,0x08,0x04,0x02,0x01</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">uchar data Buffer_Counts[]=&#123;0,0,0,0,0,0&#125;;</span><br><span class="line">uint Count_A=0;</span><br><span class="line">uint Count_B=0;</span><br><span class="line"></span><br><span class="line">void DelayMS(uint x)</span><br><span class="line">&#123;</span><br><span class="line"> uchar t;</span><br><span class="line">while(x--)</span><br><span class="line">&#123;</span><br><span class="line"> for(t=0;t&lt;120;t++);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Show_Counts()</span><br><span class="line">&#123;</span><br><span class="line"> uint i;</span><br><span class="line">Buffer_Counts[2] = Count_A / 100;</span><br><span class="line">Buffer_Counts[1] = Count_A % 100 /10;</span><br><span class="line">Buffer_Counts[0] = Count_A % 10;</span><br><span class="line">if(Buffer_Counts[2]==0)</span><br><span class="line">&#123;</span><br><span class="line"> Buffer_Counts[2] = 0x0a;</span><br><span class="line">if(Buffer_Counts[1]==0)</span><br><span class="line">&#123;</span><br><span class="line"> Buffer_Counts[1]=0x0a;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Buffer_Counts[5] = Count_B / 100;</span><br><span class="line">Buffer_Counts[4] = Count_B % 100 /10;</span><br><span class="line">Buffer_Counts[3] = Count_B % 10;</span><br><span class="line">if(Buffer_Counts[5]==0)</span><br><span class="line">&#123;</span><br><span class="line"> Buffer_Counts[5] = 0x0a;</span><br><span class="line">if(Buffer_Counts[4]==0)</span><br><span class="line">&#123;</span><br><span class="line"> Buffer_Counts[4]=0x0a;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">for(i=0;i&lt;6;i++)</span><br><span class="line">&#123;</span><br><span class="line"> P2 = Scan_BITs[i];</span><br><span class="line">P1 = DSY_CODE[Buffer_Counts[i]];</span><br><span class="line">DelayMS(1);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> IT0 = 1;//å¯ç”¨å¤–éƒ¨ä¸­æ–­0</span><br><span class="line">IT1 = 1;//å¯ç”¨å¤–éƒ¨ä¸­æ–­1</span><br><span class="line">PX0 = 1;//è®¾å®šå¤–éƒ¨ä¸­æ–­0ä¸ºæœ€é«˜ä¼˜å…ˆçº§ä¸­æ–­</span><br><span class="line">IE  = 0x85;</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line"> if(k3 == 0) Count_A = 0;</span><br><span class="line">if(k4 == 0) Count_B = 0;</span><br><span class="line">Show_Counts();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">/*å¤–éƒ¨ä¸­æ–­0å‡½æ•°*/</span><br><span class="line">void EX_INT0() interrupt 0</span><br><span class="line">&#123;</span><br><span class="line"> Count_A++;</span><br><span class="line">&#125;</span><br><span class="line">/*å¤–éƒ¨ä¸­æ–­1å‡½æ•°*/</span><br><span class="line">void EX_INT1() interrupt 2</span><br><span class="line">&#123;</span><br><span class="line"> Count_B++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int</p><p>sbit k3 &#x3D; P3^4;<br>sbit k4 &#x3D; P3^5;</p><p>uchar code DSY_CODE[]&#x3D;<br>{<br>     0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,0xff<br>};&#x2F;&#x2F;å…±é˜³æ®µç </p><p>uchar code Scan_BITs[]&#x3D;<br>{<br>      0x20,0x10,0x08,0x04,0x02,0x01<br>};</p><p>uchar data Buffer_Counts[]&#x3D;{0,0,0,0,0,0};<br>uint Count_A&#x3D;0;<br>uint Count_B&#x3D;0;</p><p>void DelayMS(uint x)<br>{<br>     uchar t;<br>    while(xâ€“)<br>    {<br>     for(t&#x3D;0;t&lt;120;t++);<br>    }<br>}</p><p>void Show_Counts()<br>{<br>     uint i;<br>    Buffer_Counts[2] &#x3D; Count_A &#x2F; 100;<br>    Buffer_Counts[1] &#x3D; Count_A % 100 &#x2F;10;<br>    Buffer_Counts[0] &#x3D; Count_A % 10;<br>    if(Buffer_Counts[2]&#x3D;&#x3D;0)<br>    {<br>     Buffer_Counts[2] &#x3D; 0x0a;<br>        if(Buffer_Counts[1]&#x3D;&#x3D;0)<br>        {<br>         Buffer_Counts[1]&#x3D;0x0a;<br>        }<br>    }</p><pre><code>Buffer_Counts[5] = Count_B / 100;Buffer_Counts[4] = Count_B % 100 /10;Buffer_Counts[3] = Count_B % 10;if(Buffer_Counts[5]==0)&#123; Buffer_Counts[5] = 0x0a;    if(Buffer_Counts[4]==0)    &#123;     Buffer_Counts[4]=0x0a;    &#125;&#125;for(i=0;i&lt;6;i++)&#123; P2 = Scan_BITs[i];    P1 = DSY_CODE[Buffer_Counts[i]];    DelayMS(1);&#125;</code></pre><p>}</p><p>void main()<br>{<br>     IT0 &#x3D; 1;&#x2F;&#x2F;å¯ç”¨å¤–éƒ¨ä¸­æ–­0<br>    IT1 &#x3D; 1;&#x2F;&#x2F;å¯ç”¨å¤–éƒ¨ä¸­æ–­1<br>    PX0 &#x3D; 1;&#x2F;&#x2F;è®¾å®šå¤–éƒ¨ä¸­æ–­0ä¸ºæœ€é«˜ä¼˜å…ˆçº§ä¸­æ–­<br>    IE  &#x3D; 0x85;<br>    while(1)<br>    {<br>     if(k3 &#x3D;&#x3D; 0) Count_A &#x3D; 0;<br>        if(k4 &#x3D;&#x3D; 0) Count_B &#x3D; 0;<br>        Show_Counts();<br>    }<br>}<br>&#x2F;<em>å¤–éƒ¨ä¸­æ–­0å‡½æ•°</em>&#x2F;<br>void EX_INT0() interrupt 0<br>{<br>     Count_A++;<br>}<br>&#x2F;<em>å¤–éƒ¨ä¸­æ–­1å‡½æ•°</em>&#x2F;<br>void EX_INT1() interrupt 2<br>{<br>     Count_B++;<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨è¿™é‡Œæ’å…¥ä»£ç ç‰‡</span><br></pre></td></tr></table></figure><p><code>åœ¨è¿™é‡Œæ’å…¥ä»£ç ç‰‡</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘HC-SRF04è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨æ•°ç ç®¡æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FHCSRF04%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D%E4%BC%A0%E6%84%9F%E5%99%A8%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FHCSRF04%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D%E4%BC%A0%E6%84%9F%E5%99%A8%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘HC-SRF04è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨æ•°ç ç®¡æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘HC-SRF04è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨æ•°ç ç®¡æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘HC-SRF04è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨æ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘HC-SRF04è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨æ•°ç ç®¡æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘HC-SRF04è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨æ•°ç ç®¡æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘HC-SRF04è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨æ•°ç ç®¡æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘HC-SRF04è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨æ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘HC-SRF04è¶…å£°æ³¢æµ‹è·ä¼ æ„Ÿå™¨æ•°ç ç®¡æ˜¾ç¤º</h3><ul><li>VSM Studio Proteusä»¿çœŸæ¼”ç¤º</li><li>å®éªŒåŸºäºVSM Studioä»£ç ç¼–è¯‘å’Œä»¿çœŸä¸€ä½“ï¼Œå¯ä»¥ä¸ä¾èµ–å¤–éƒ¨å¯¼å…¥Hexæ–‡ä»¶è¿›è¡Œä»¿çœŸï¼Œæœ¬å®éªŒåŒæ—¶ä¿ç•™Keilå·¥ç¨‹ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/b796012f7bd044e6bd0c9c505ca49365.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;reg52.h&gt;</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line"> </span><br><span class="line">typedef unsigned char uchar;</span><br><span class="line">typedef unsigned int  uint;</span><br><span class="line"> </span><br><span class="line">sbit Tr=P1^0;//è§¦å‘ä¿¡å·</span><br><span class="line">sbit Ec=P1^1;//å›å“ä¿¡å·</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">void Delay10us(void);//10uså»¶æ—¶å‡½æ•°</span><br><span class="line">void Delayms(unsigned int z);//mså»¶æ—¶å‡½æ•°</span><br><span class="line">uint Read_value(void);//è¯»å€¼å‡½æ•°</span><br><span class="line">void InitTimer0(void);//å®šæ—¶å™¨0åˆå§‹åŒ–</span><br><span class="line">void show(uint Out);//æ˜¾ç¤ºå‡½æ•°</span><br><span class="line"> </span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">Tr=0;//å‡ºå‘å¼•è„šé¦–å…ˆæ‹‰ä½</span><br><span class="line">InitTimer0();//åˆå§‹åŒ–å®šæ—¶å™¨0</span><br><span class="line">while(1)&#123;</span><br><span class="line">show(Read_value());//æ˜¾ç¤ºè·ç¦»</span><br><span class="line">Delayms(5);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">/********************è¯»å€¼å‡½æ•°***********************/</span><br><span class="line">uint Read_value()</span><br><span class="line">&#123;</span><br><span class="line">uint result;</span><br><span class="line">Tr=1;//è§¦å‘å¼•è„šå‘å‡º11usçš„è§¦å‘ä¿¡å·ï¼ˆè‡³å°‘10usï¼‰</span><br><span class="line">Delay10us();</span><br><span class="line">Tr=0;</span><br><span class="line">while(!Ec);//åº¦è¿‡å›å“ä¿¡å·çš„ä½ç”µå¹³</span><br><span class="line">TR0=1;//å¼€å¯å®šæ—¶å™¨0</span><br><span class="line">while(Ec);//åº¦è¿‡å›å“ä¿¡å·é«˜ç”µå¹³</span><br><span class="line">TR0=0;//å…³é—­å®šæ—¶å™¨0</span><br><span class="line">result=((TH0*256+TL0)*0.034)/2;// è·ç¦»cm=ï¼ˆæ—¶é—´us * é€Ÿåº¦cm/usï¼‰/2</span><br><span class="line">return result + 1;//+1ä¿®æ­£è¡¥å¿</span><br><span class="line">&#125;</span><br><span class="line">/***********************10uså»¶æ—¶å‡½æ•°*****************************/</span><br><span class="line">void Delay10us()</span><br><span class="line">&#123;</span><br><span class="line">TL0=0xF6;</span><br><span class="line">TH0=0xFF;</span><br><span class="line">TR0=1;</span><br><span class="line">while (TF0==0);</span><br><span class="line">TR0=0;</span><br><span class="line">TF0=0;</span><br><span class="line">      </span><br><span class="line">&#125;</span><br><span class="line">/***********************mså»¶æ—¶å‡½æ•°*****************************/</span><br><span class="line">void Delayms(unsigned int z)   </span><br><span class="line">&#123;</span><br><span class="line">uint i,j;</span><br><span class="line">for(i=0;i&lt;z;i++)</span><br><span class="line">for(j=0;j&lt;112;j++);</span><br><span class="line">//å»¶æ—¶å‡½æ•°</span><br><span class="line">&#125;</span><br><span class="line">/************************å®šæ—¶å™¨0åˆå§‹åŒ–*****************************/</span><br><span class="line">void InitTimer0(void)</span><br><span class="line">&#123;// é€‰æ‹©å®šæ—¶å™¨0ï¼Œå¹¶ä¸”ç¡®å®šæ˜¯å·¥ä½œæ–¹å¼1ï¼ˆä¸ºäº†è¶…å£°æ³¢æ¨¡å—æµ‹é‡è·ç¦»è®¡æ—¶ç”¨çš„ï¼‰</span><br><span class="line">    TMOD = 0x01;</span><br><span class="line">    TH0 = 0x00;</span><br><span class="line">    TL0 = 0x00;</span><br><span class="line">    TR0 = 0;//å…ˆå…³é—­å®šæ—¶å™¨0</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">/**********************æ˜¾ç¤ºå‡½æ•°*************************************/</span><br><span class="line">void Show(uint Out)</span><br><span class="line">&#123;</span><br><span class="line">char duan[10]=&#123;0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90&#125;;//æ®µç </span><br><span class="line">P2=0x01;//ç¬¬å››ä½ï¼ˆä¸ªä½ï¼‰</span><br><span class="line">Delay10us();</span><br><span class="line">P0=duan[Out%1000%100%10];</span><br><span class="line">Delayms(1);</span><br><span class="line">P0=0xff;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">P2=0x02;//ç¬¬ä¸‰ä½ï¼ˆåä½ï¼‰</span><br><span class="line">Delay10us();</span><br><span class="line">P0=duan[Out%1000%100/10];</span><br><span class="line">Delayms(1);</span><br><span class="line">P0=0xff;</span><br><span class="line"> </span><br><span class="line">P2=0x04;//ç¬¬äºŒä½ï¼ˆç™¾ä½ï¼‰</span><br><span class="line">Delay10us();</span><br><span class="line">P0=duan[Out%1000/100];</span><br><span class="line">Delayms(1);</span><br><span class="line">P0=0xff;</span><br><span class="line"> </span><br><span class="line">P2=0x08;//ç¬¬ä¸€ä½ï¼ˆåƒä½ï¼‰</span><br><span class="line">Delay10us();</span><br><span class="line">P0=duan[Out/1000];</span><br><span class="line">Delayms(1);</span><br><span class="line">P0=0xff;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include&lt;reg52.h&gt;<br>#include&lt;intrins.h&gt;</p><p>typedef unsigned char uchar;<br>typedef unsigned int  uint;</p><p>sbit Tr&#x3D;P1^0;&#x2F;&#x2F;è§¦å‘ä¿¡å·<br>sbit Ec&#x3D;P1^1;&#x2F;&#x2F;å›å“ä¿¡å·</p><p>void Delay10us(void);&#x2F;&#x2F;10uså»¶æ—¶å‡½æ•°<br>void Delayms(unsigned int z);&#x2F;&#x2F;mså»¶æ—¶å‡½æ•°<br>uint Read_value(void);&#x2F;&#x2F;è¯»å€¼å‡½æ•°<br>void InitTimer0(void);&#x2F;&#x2F;å®šæ—¶å™¨0åˆå§‹åŒ–<br>void show(uint Out);&#x2F;&#x2F;æ˜¾ç¤ºå‡½æ•°</p><p>void main()<br>{<br>    Tr&#x3D;0;&#x2F;&#x2F;å‡ºå‘å¼•è„šé¦–å…ˆæ‹‰ä½<br>    InitTimer0();&#x2F;&#x2F;åˆå§‹åŒ–å®šæ—¶å™¨0<br>    while(1){<br>    show(Read_value());&#x2F;&#x2F;æ˜¾ç¤ºè·ç¦»<br>        Delayms(5);<br>    }<br>}</p><p>&#x2F;<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>è¯»å€¼å‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong><em>**&#x2F;<br>uint Read_value()<br>{<br>    uint result;<br>    Tr&#x3D;1;&#x2F;&#x2F;è§¦å‘å¼•è„šå‘å‡º11usçš„è§¦å‘ä¿¡å·ï¼ˆè‡³å°‘10usï¼‰<br>    Delay10us();<br>    Tr&#x3D;0;<br>    while(!Ec);&#x2F;&#x2F;åº¦è¿‡å›å“ä¿¡å·çš„ä½ç”µå¹³<br>    TR0&#x3D;1;&#x2F;&#x2F;å¼€å¯å®šæ—¶å™¨0<br>    while(Ec);&#x2F;&#x2F;åº¦è¿‡å›å“ä¿¡å·é«˜ç”µå¹³<br>    TR0&#x3D;0;&#x2F;&#x2F;å…³é—­å®šæ—¶å™¨0<br>    result&#x3D;((TH0<em>256+TL0)<em>0.034)&#x2F;2;&#x2F;&#x2F; è·ç¦»cm&#x3D;ï¼ˆæ—¶é—´us * é€Ÿåº¦cm&#x2F;usï¼‰&#x2F;2<br>    return result + 1;&#x2F;&#x2F;+1ä¿®æ­£è¡¥å¿<br>}<br>&#x2F;<em><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>10uså»¶æ—¶å‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em></em></em></em>***&#x2F;<br>void Delay10us()<br>{<br>    TL0&#x3D;0xF6;<br>    TH0&#x3D;0xFF;<br>    TR0&#x3D;1;<br>    while (TF0&#x3D;&#x3D;0);<br>    TR0&#x3D;0;<br>    TF0&#x3D;0;</p><p>}<br>&#x2F;<em><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>mså»¶æ—¶å‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em>******&#x2F;<br>void Delayms(unsigned int z)<br>{<br>    uint i,j;<br>    for(i&#x3D;0;i&lt;z;i++)<br>        for(j&#x3D;0;j&lt;112;j++);<br>    &#x2F;&#x2F;å»¶æ—¶å‡½æ•°<br>}<br>&#x2F;<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>å®šæ—¶å™¨0åˆå§‹åŒ–</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>*****&#x2F;<br>void InitTimer0(void)<br>{&#x2F;&#x2F; é€‰æ‹©å®šæ—¶å™¨0ï¼Œå¹¶ä¸”ç¡®å®šæ˜¯å·¥ä½œæ–¹å¼1ï¼ˆä¸ºäº†è¶…å£°æ³¢æ¨¡å—æµ‹é‡è·ç¦»è®¡æ—¶ç”¨çš„ï¼‰<br>    TMOD &#x3D; 0x01;<br>    TH0 &#x3D; 0x00;<br>    TL0 &#x3D; 0x00;<br>    TR0 &#x3D; 0;&#x2F;&#x2F;å…ˆå…³é—­å®šæ—¶å™¨0<br>}</p><p>&#x2F;<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>æ˜¾ç¤ºå‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>***************&#x2F;<br>void Show(uint Out)<br>{<br>    char duan[10]&#x3D;{0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};&#x2F;&#x2F;æ®µç <br>        P2&#x3D;0x01;&#x2F;&#x2F;ç¬¬å››ä½ï¼ˆä¸ªä½ï¼‰<br>        Delay10us();<br>        P0&#x3D;duan[Out%1000%100%10];<br>        Delayms(1);<br>        P0&#x3D;0xff;</p><pre><code>    P2=0x02;//ç¬¬ä¸‰ä½ï¼ˆåä½ï¼‰    Delay10us();    P0=duan[Out%1000%100/10];    Delayms(1);    P0=0xff;    P2=0x04;//ç¬¬äºŒä½ï¼ˆç™¾ä½ï¼‰    Delay10us();    P0=duan[Out%1000/100];    Delayms(1);    P0=0xff;    P2=0x08;//ç¬¬ä¸€ä½ï¼ˆåƒä½ï¼‰    Delay10us();    P0=duan[Out/1000];    Delayms(1);    P0=0xff;</code></pre><p>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1kc54kzA6tlY83FIPMqALmg </span><br><span class="line">æå–ç ï¼šujr2</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1kc54kzA6tlY83FIPMqALmg  æå–ç ï¼šujr2</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘LCD1602å­—ç¬¦æ»šåŠ¨æ˜¾ç¤ºç¤ºä¾‹</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FLCD1602%E5%AD%97%E7%AC%A6%E6%BB%9A%E5%8A%A8%E6%98%BE%E7%A4%BA%E7%A4%BA%E4%BE%8B/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FLCD1602%E5%AD%97%E7%AC%A6%E6%BB%9A%E5%8A%A8%E6%98%BE%E7%A4%BA%E7%A4%BA%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘LCD1602å­—ç¬¦æ»šåŠ¨æ˜¾ç¤ºç¤ºä¾‹"><a href="#ã€Proteusä»¿çœŸã€‘LCD1602å­—ç¬¦æ»šåŠ¨æ˜¾ç¤ºç¤ºä¾‹" class="headerlink" title="ã€Proteusä»¿çœŸã€‘LCD1602å­—ç¬¦æ»šåŠ¨æ˜¾ç¤ºç¤ºä¾‹"></a>ã€Proteusä»¿çœŸã€‘LCD1602å­—ç¬¦æ»šåŠ¨æ˜¾ç¤ºç¤ºä¾‹</h1><h3 id="ã€Proteusä»¿çœŸã€‘LCD1602å­—ç¬¦æ»šåŠ¨æ˜¾ç¤ºç¤ºä¾‹-1"><a href="#ã€Proteusä»¿çœŸã€‘LCD1602å­—ç¬¦æ»šåŠ¨æ˜¾ç¤ºç¤ºä¾‹-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘LCD1602å­—ç¬¦æ»šåŠ¨æ˜¾ç¤ºç¤ºä¾‹"></a>ã€Proteusä»¿çœŸã€‘LCD1602å­—ç¬¦æ»šåŠ¨æ˜¾ç¤ºç¤ºä¾‹</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/eb0d77650dd74378818c62a5778685ca.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/**************************************************************************************</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹åç§°ï¼šLCD1602æ»šåŠ¨æ˜¾ç¤º</span><br><span class="line">  </span><br><span class="line">***************************************************************************************/</span><br><span class="line">#include &quot;public.h&quot;</span><br><span class="line">#include &quot;lcd1602.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extern void lcd1602_write_cmd(u8 cmd);</span><br><span class="line">extern void lcd1602_write_data(u8 dat); </span><br><span class="line">/*******************************************************************************</span><br><span class="line">* å‡½ æ•° å       : main</span><br><span class="line">* å‡½æ•°åŠŸèƒ½ : ä¸»å‡½æ•°</span><br><span class="line">* è¾“    å…¥       : æ— </span><br><span class="line">* è¾“    å‡º     : æ— </span><br><span class="line">*******************************************************************************/</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">u8 i=0;</span><br><span class="line">code u8 gshowbufa[]=&quot; LCD1602 scroll... &quot;;</span><br><span class="line">code u8 gshowbufb[]=&quot;perseverance51&quot;;</span><br><span class="line"></span><br><span class="line">lcd1602_init();</span><br><span class="line">lcd1602_show_string(0,0,gshowbufa);</span><br><span class="line">lcd1602_show_string(0,1,gshowbufb);</span><br><span class="line">lcd1602_write_cmd(0x07);//æ¯å†™ä¸€ä¸ªæ•°æ®å±å¹•å°±è¦å³ç§»ä¸€ä½ï¼Œå°±ç›¸å¯¹äºæ•°æ®æ¥è¯´å°±æ˜¯å·¦ç§»äº†</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">lcd1602_write_cmd(0x80);</span><br><span class="line">for(i=0;i&lt;16;i++)</span><br><span class="line">&#123;</span><br><span class="line">lcd1602_write_data(gshowbufa[i]);</span><br><span class="line">delay_ms(300);//æ»šåŠ¨æ—¶é€Ÿåº¦è°ƒèŠ‚</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;**************************************************************************************</p><p>ç¤ºä¾‹åç§°ï¼šLCD1602æ»šåŠ¨æ˜¾ç¤º</p><p>***************************************************************************************&#x2F;<br>#include â€œpublic.hâ€<br>#include â€œlcd1602.hâ€</p><p>extern void lcd1602_write_cmd(u8 cmd);<br>extern void lcd1602_write_data(u8 dat);<br>&#x2F;*******************************************************************************</p><ul><li><p>å‡½ æ•° å       : main</p></li><li><p>å‡½æ•°åŠŸèƒ½ : ä¸»å‡½æ•°</p></li><li><p>è¾“    å…¥       : æ— </p></li><li><p>è¾“    å‡º     : æ— <br>*******************************************************************************&#x2F;<br>void main()<br>{<br>  u8 i&#x3D;0;<br>code u8 gshowbufa[]&#x3D;â€ LCD1602 scrollâ€¦ â€œ;<br>code u8 gshowbufb[]&#x3D;â€perseverance51â€;</p><p>  lcd1602_init();<br>  lcd1602_show_string(0,0,gshowbufa);<br>  lcd1602_show_string(0,1,gshowbufb);<br>  lcd1602_write_cmd(0x07);&#x2F;&#x2F;æ¯å†™ä¸€ä¸ªæ•°æ®å±å¹•å°±è¦å³ç§»ä¸€ä½ï¼Œå°±ç›¸å¯¹äºæ•°æ®æ¥è¯´å°±æ˜¯å·¦ç§»äº†<br>  while(1)<br>  {<br>  lcd1602_write_cmd(0x80);<br>  for(i&#x3D;0;i&lt;16;i++)<br>  {<br>      lcd1602_write_data(gshowbufa[i]);<br>      delay_ms(300);&#x2F;&#x2F;æ»šåŠ¨æ—¶é€Ÿåº¦è°ƒèŠ‚<br>  }<br>  }</p></li></ul><p>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1raps-9mhwa66XO_n0CjMcQ </span><br><span class="line">æå–ç ï¼šwblz</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1raps-9mhwa66XO_n0CjMcQ  æå–ç ï¼šwblz</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘L297é©±åŠ¨æ­¥è¿›ç”µæœº</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FL297%E9%A9%B1%E5%8A%A8%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FL297%E9%A9%B1%E5%8A%A8%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘L297é©±åŠ¨æ­¥è¿›ç”µæœº"><a href="#ã€Proteusä»¿çœŸã€‘L297é©±åŠ¨æ­¥è¿›ç”µæœº" class="headerlink" title="ã€Proteusä»¿çœŸã€‘L297é©±åŠ¨æ­¥è¿›ç”µæœº"></a>ã€Proteusä»¿çœŸã€‘L297é©±åŠ¨æ­¥è¿›ç”µæœº</h1><h3 id="ã€Proteusä»¿çœŸã€‘L297é©±åŠ¨æ­¥è¿›ç”µæœº-1"><a href="#ã€Proteusä»¿çœŸã€‘L297é©±åŠ¨æ­¥è¿›ç”µæœº-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘L297é©±åŠ¨æ­¥è¿›ç”µæœº"></a>ã€Proteusä»¿çœŸã€‘L297é©±åŠ¨æ­¥è¿›ç”µæœº</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/e94a412ae3b34aceb851ede765e5824f.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="L297å¼•è„šåŠŸèƒ½ç®€ä»‹"><a href="#L297å¼•è„šåŠŸèƒ½ç®€ä»‹" class="headerlink" title="L297å¼•è„šåŠŸèƒ½ç®€ä»‹"></a>L297å¼•è„šåŠŸèƒ½ç®€ä»‹</h4><p><img src="https://img-blog.csdnimg.cn/74c9d74ebc014ad5a45fdd0196161c6a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li><p>1 è„š(SYNG)â€”â€”æ–©æ³¢å™¨è¾“å‡ºç«¯ã€‚å¦‚å¤šä¸ª 297 åŒæ­¥æ§åˆ¶ï¼Œæ‰€æœ‰çš„ SYNC ç«¯éƒ½è¦è¿åœ¨ä¸€èµ·ï¼Œå…±ç”¨ä¸€å¥—æŒ¯è¡å…ƒä»¶ã€‚å¦‚æœä½¿ç”¨å¤–éƒ¨æ—¶é’Ÿæºï¼Œåˆ™æ—¶é’Ÿä¿¡å·æ¥åˆ°æ­¤å¼•è„šä¸Šã€‚</p></li><li><p>2 è„š(GND)â€”â€”æ¥åœ°ç«¯ã€‚</p></li><li><p>3 è„š(HOME)â€”â€”é›†ç”µæå¼€è·¯è¾“å‡ºç«¯ã€‚å½“ L297 åœ¨åˆå§‹çŠ¶æ€(ABCD&#x3D;0101)æ—¶ï¼Œæ­¤ç«¯æœ‰æŒ‡ç¤ºã€‚å½“æ­¤å¼•è„šæœ‰æ•ˆæ—¶ï¼Œæ™¶ä½“ç®¡å¼€è·¯ã€‚</p></li><li><p>4 è„š(A)â€”â€”A ç›¸é©±åŠ¨ä¿¡å·ã€‚</p></li><li><p>5 è„š(  </p><pre><code>     INH1             â€¾              \overline&#123;\text&#123;INH1&#125;&#125;    </code></pre><p>   INH1)â€”â€”æ§åˆ¶ A ç›¸å’Œ B ç›¸çš„é©±åŠ¨æã€‚å½“æ­¤å¼•è„šä¸ºä½ç”µå¹³æ—¶ï¼ŒA ç›¸ã€B ç›¸é©±åŠ¨æ§åˆ¶è¢«ç¦æ­¢ï¼›å½“çº¿åœˆçº§æ–­ç”µæ—¶ï¼ŒåŒææ€§æ¡¥ç”¨è¿™ä¸ªä¿¡å·ä½¿è´Ÿè½½ç”µæºå¿«é€Ÿè¡°å‡ã€‚è‹¥ CONTROL ç«¯è¾“å…¥æ˜¯ä½ç”µå¹³æ—¶ï¼Œç”¨æ–©æ³¢å™¨è°ƒèŠ‚è´Ÿè½½ç”µæµã€‚</p></li><li><p>6 è„š(B)â€”â€”B ç›¸é©±åŠ¨ä¿¡å·ã€‚</p></li><li><p>7 è„šÂ©â€”â€”C ç›¸é©±åŠ¨ä¿¡å·ã€‚</p></li><li><p>8 è„š(  </p><pre><code>     INH2             â€¾              \overline&#123;\text&#123;INH2&#125;&#125;    </code></pre><p>   INH2)â€”â€”æ§åˆ¶ C ç›¸å’Œ D ç›¸çš„é©±åŠ¨çº§ã€‚ä½œç”¨åŒ INH1 ç›¸åŒã€‚</p></li><li><p>9 è„š(D)â€”â€”D ç›¸é©±åŠ¨ä¿¡å·ã€‚</p></li><li><p>10 è„š(ENABLE)â€”â€”L297 çš„ä½¿èƒ½è¾“å…¥ç«¯ã€‚å½“å®ƒä¸ºä½ç”µå¹³æ—¶ï¼ŒINH1ï¼ŒINH2ï¼ŒAï¼ŒBï¼ŒCï¼ŒD éƒ½ä¸ºä½ç”µå¹³ã€‚å½“ç³»ç»Ÿè¢«å¤ä½æ—¶ç”¨æ¥é˜»æ­¢ç”µæœºé©±åŠ¨ã€‚</p></li><li><p>11 è„š(CONTROL)â€”â€”æ–©æ³¢å™¨åŠŸèƒ½æ§åˆ¶ç«¯ã€‚ä½ç”µå¹³æ—¶ä½¿INH1å’ŒINH2èµ·ä½œç”¨ï¼Œé«˜ç”µå¹³æ—¶ä½¿ Aï¼ŒBï¼ŒCï¼ŒD èµ·ä½œç”¨ã€‚</p></li><li><p>12 è„š(Vcc)â€”â€”+5V ç”µæºè¾“å…¥ç«¯ã€‚</p></li><li><p>13 è„š(SENS2)â€”â€”C ç›¸ã€D ç›¸ç»•ç»„ç”µæµæ£€æµ‹ç”µå‹åé¦ˆè¾“å…¥ç«¯ã€‚</p></li><li><p>14 è„š(SENS1)â€”â€”A ç›¸ã€B ç›¸ç»•ç»„ç”µæµæ£€æµ‹ç”µå‹åé¦ˆè¾“å…¥ç«¯ã€‚</p></li><li><p>15 è„š(Vref )â€”â€”æ–©æ³¢å™¨åŸºå‡†ç”µå‹è¾“å…¥ç«¯ã€‚åŠ åˆ°æ­¤å¼•è„šçš„ç”µå‹å†³å®šç»•ç»„ç”µæµçš„å³°å€¼ã€‚</p></li><li><p>16 è„š(OSC)â€”â€”æ–©æ³¢å™¨é¢‘ç‡è¾“å…¥ç«¯ã€‚ä¸€ä¸ª RC ç½‘ç»œæ¥è‡³æ­¤å¼•è§’ä»¥å†³å®šæ–©æ³¢å™¨é¢‘ç‡ï¼Œåœ¨å¤šä¸ª L297 åŒæ­¥å·¥ä½œæ—¶å…¶ä¸­ä¸€ä¸ªæ¥åˆ° RC ç½‘ç»œï¼Œå…¶ä½™çš„æ­¤å¼•è§’æ¥åœ°ï¼Œå„ä¸ªå™¨ä»¶çš„è„š I (SYNC)åº”è¿æ¥åˆ°ä¸€èµ·è¿™æ ·å¯æ‚æ³¢çš„å¼•å…¥é—®é¢˜å¦‚å›¾ 5 æ‰€ç¤ºã€‚</p></li><li><p>17 è„š(CW&#x2F;  </p><pre><code>     CCW             â€¾              \overline&#123;\text&#123;CCW&#125;&#125;    </code></pre><p>   CCW)â€”æ–¹å‘æ§åˆ¶ç«¯ã€‚æ­¥è¿›ç”µæœºå®é™…æ—‹è½¬æ–¹å‘ç”±ç»•ç»„çš„è¿æ¥æ–¹æ³•å†³å®šã€‚å½“æ”¹å˜æ­¤å¼•è„šçš„ç”µå¹³çŠ¶æ€æ—¶ï¼Œæ­¥è¿›ç”µæœºåå‘æ—‹è½¬ã€‚</p></li><li><p>18 è„š(CLOCK)â€”â€”æ­¥è¿›æ—¶é’Ÿè¾“å…¥ç«¯ã€‚è¯¥å¼•è„šè¾“å…¥è´Ÿè„‰å†²æ—¶æ­¥è¿›ç”µæœºå‘å‰æ­¥è¿›ä¸€ä¸ªå¢é‡ï¼Œè¯¥æ­¥è¿›æ˜¯åœ¨ä¿¡å· çš„ä¸Šå‡æ²¿äº§ç”Ÿã€‚</p></li><li><p>19 è„š(HALF&#x2F;  </p><pre><code>     FULL             â€¾              \overline&#123;\text&#123;FULL&#125;&#125;    </code></pre><p>   FULL)â€”â€”åŠæ­¥ã€å…¨æ­¥æ–¹å¼ é€‰æ‹©ç«¯ã€‚æ­¤å¼•è„šè¾“å…¥é«˜ç”µå¹³æ—¶ä¸ºåŠæ­¥æ–¹å¼(å››ç›¸å…«æ‹)ï¼Œä½ç”µå¹³æ—¶ä¸ºå…¨æ­¥æ–¹å¼ã€‚å¦‚é€‰æ‹©å…¨æ­¥æ–¹å¼æ—¶å˜æ¢å™¨åœ¨å¥‡æ•°çŠ¶æ€ï¼Œä¼šå¾—åˆ°å•ç›¸å·¥ä½œæ–¹å¼(å•å››æ‹)ã€‚</p></li><li><p>20 è„š(  </p><pre><code>     RESET             â€¾              \overline&#123;\text&#123;RESET&#125;&#125;    </code></pre><p>   RESET)â€”â€”å¤ä½è¾“å…¥ç«¯ã€‚æ­¤å¼•è„šè¾“å…¥è´Ÿè„‰å†²æ—¶ï¼Œå˜æ¢å™¨æ¢å¤åˆå§‹çŠ¶æ€ (ABCD&#x3D;0101)ã€‚</p></li></ul><h4 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h4><ul><li>L297 é©±åŠ¨ç›¸åºçš„äº§ç”Ÿ</li></ul><p>L297 èƒ½äº§ç”Ÿå•å››æ‹ã€åŒå››æ‹å’Œå››ç›¸å…«æ‹å·¥ä½œæ‰€éœ€çš„é€‚å½“ç›¸åºã€‚3 ç§æ–¹å¼çš„é©±åŠ¨ç›¸åºéƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°æ ¹æ®å˜æ¢å™¨è¾“å‡ºçš„æ ¼é›·ç çš„é¡ºåºäº§ç”Ÿï¼Œæ ¼é›·ç çš„é¡ºåºç›´æ¥ä¸å››å…«æ‹(åŠæ­¥æ–¹å¼)ç›¸ç¬¦åˆ ï¼Œåªè¦åœ¨è„š 19 è¾“å…¥ä¸€é«˜ç”µå¹³å³å¯å¾—åˆ°.</p><ul><li>é€šè¿‡äº¤æ›¿è·³è¿‡åœ¨å…«æ­¥é¡ºåºä¸­çš„çŠ¶æ€å°±å¯ä»¥å¾—åˆ°å…¨æ­¥å·¥ä½œæ–¹å¼ï¼Œæ­¤æ—¶éœ€åœ¨è„š 19 æ¥ä¸€ä½ç”µå¹³ï¼Œå‰å·²è¿°åŠæ ¹æ®å˜æ¢å™¨çš„çŠ¶æ€å¯å¾—åˆ°å››æ‹æˆ–åŒå››æ‹ 2 ç§å·¥ä½œæ¨¡å¼</li></ul><h4 id="ä»¿çœŸè¯´æ˜"><a href="#ä»¿çœŸè¯´æ˜" class="headerlink" title="ä»¿çœŸè¯´æ˜"></a>ä»¿çœŸè¯´æ˜</h4><p>æ³¨æ„L297çš„è¾“å‡ºå¼•è„šæ¥æ­¥è¿›ç”µæœºçš„ç›¸åºï¼Œä¸å…¶ä»–çš„é©±åŠ¨ç›¸åºæœ‰æ‰€å·®å¼‚ï¼Œå¦‚æœç›¸åºä¸æ˜¯æŒ‰ç…§æ­¤æ¥æ³•ï¼Œä»¿çœŸæ—¶ï¼Œç”µæœºæ˜¯æ­£åä¸€å®šè§’åº¦çš„æ‘†åŠ¨æ•ˆæœï¼Œè€Œä¸æ˜¯åšåœ†å‘¨è¿åŠ¨çš„æ•ˆæœã€‚</p><h4 id="ç¨‹åºä»£ç "><a href="#ç¨‹åºä»£ç " class="headerlink" title="ç¨‹åºä»£ç "></a>ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">/********************************************************************</span><br><span class="line"> L297é©±åŠ¨æ­¥è¿›ç”µæœº</span><br><span class="line">*********************************************************************/</span><br><span class="line">#include&lt;reg52.h&gt; </span><br><span class="line"></span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line"></span><br><span class="line">/********************************************************</span><br><span class="line"> æ§åˆ¶ä½å®šä¹‰</span><br><span class="line">********************************************************/</span><br><span class="line"></span><br><span class="line">sbit shi_neng=P2^0;  //ä½¿èƒ½æ§åˆ¶ä½</span><br><span class="line">sbit fang_shi=P2^1;  //å·¥ä½œæ–¹å¼æ§åˆ¶ä½ï¼ŒåŠæ­¥ã€å…¨æ­¥æ–¹å¼ é€‰æ‹©ç«¯ã€‚æ­¤å¼•è„šè¾“å…¥é«˜ç”µå¹³æ—¶ä¸ºåŠæ­¥æ–¹å¼(å››ç›¸å…«æ‹)ï¼Œ</span><br><span class="line">//ä½ç”µå¹³æ—¶ä¸ºå…¨æ­¥æ–¹å¼ã€‚å¦‚é€‰æ‹©å…¨æ­¥æ–¹å¼æ—¶å˜æ¢å™¨åœ¨å¥‡æ•°çŠ¶æ€ï¼Œä¼šå¾—åˆ°å•ç›¸å·¥ä½œæ–¹å¼(å•å››æ‹)ã€‚</span><br><span class="line">sbit fang_xiang=P2^2;//æ—‹è½¬æ–¹å‘æ§åˆ¶ä½</span><br><span class="line">sbit mai_chong=P2^3; // è„‰å†²æ§åˆ¶ä½</span><br><span class="line"></span><br><span class="line">/********************************************************</span><br><span class="line"> å»¶æ—¶å‡½æ•°</span><br><span class="line">********************************************************/</span><br><span class="line">void delay(uint i)//å»¶æ—¶å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">uchar j,k;</span><br><span class="line">for(j=0;j&lt;i;j++)</span><br><span class="line">for(k=0;k&lt;250;k++);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/********************************************************</span><br><span class="line"> å»¶æ—¶å‡½æ•°</span><br><span class="line">********************************************************/</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">shi_neng=1;  //ä½¿èƒ½æ§åˆ¶ä½</span><br><span class="line">fang_shi=0;  //å·¥ä½œæ–¹å¼æ§åˆ¶ä½,é«˜ç”µå¹³æ—¶ä¸ºåŠæ­¥æ–¹å¼(å››ç›¸å…«æ‹)ï¼Œä½ç”µå¹³æ—¶ä¸ºå…¨æ­¥æ–¹å¼</span><br><span class="line">fang_xiang=1;//æ—‹è½¬æ–¹å‘æ§åˆ¶ä½</span><br><span class="line">mai_chong=1; // è„‰å†²æ§åˆ¶ä½</span><br><span class="line"></span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">mai_chong=~mai_chong; //è¾“å‡ºæ—¶é’Ÿè„‰å†²</span><br><span class="line">delay(15);  //å»¶æ—¶  (æ‹¬å·å†…æ•°å€¼è¶Šå°ï¼Œç”µæœºè½¬åŠ¨é€Ÿåº¦è¶Šå¿«)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;********************************************************************<br> L297é©±åŠ¨æ­¥è¿›ç”µæœº<br>*********************************************************************&#x2F;<br>#include&lt;reg52.h&gt; </p><p>#define uchar unsigned char<br>#define uint unsigned int</p><p>&#x2F;********************************************************<br>                         æ§åˆ¶ä½å®šä¹‰<br>********************************************************&#x2F;</p><p>sbit shi_neng&#x3D;P2^0;  &#x2F;&#x2F;ä½¿èƒ½æ§åˆ¶ä½<br>sbit fang_shi&#x3D;P2^1;  &#x2F;&#x2F;å·¥ä½œæ–¹å¼æ§åˆ¶ä½ï¼ŒåŠæ­¥ã€å…¨æ­¥æ–¹å¼ é€‰æ‹©ç«¯ã€‚æ­¤å¼•è„šè¾“å…¥é«˜ç”µå¹³æ—¶ä¸ºåŠæ­¥æ–¹å¼(å››ç›¸å…«æ‹)ï¼Œ<br>&#x2F;&#x2F;ä½ç”µå¹³æ—¶ä¸ºå…¨æ­¥æ–¹å¼ã€‚å¦‚é€‰æ‹©å…¨æ­¥æ–¹å¼æ—¶å˜æ¢å™¨åœ¨å¥‡æ•°çŠ¶æ€ï¼Œä¼šå¾—åˆ°å•ç›¸å·¥ä½œæ–¹å¼(å•å››æ‹)ã€‚<br>sbit fang_xiang&#x3D;P2^2;&#x2F;&#x2F;æ—‹è½¬æ–¹å‘æ§åˆ¶ä½<br>sbit mai_chong&#x3D;P2^3; &#x2F;&#x2F; è„‰å†²æ§åˆ¶ä½</p><p>&#x2F;********************************************************<br>                         å»¶æ—¶å‡½æ•°<br>********************************************************&#x2F;<br>void delay(uint i)&#x2F;&#x2F;å»¶æ—¶å‡½æ•°<br>{<br>    uchar j,k;<br>    for(j&#x3D;0;j&lt;i;j++)<br>    for(k&#x3D;0;k&lt;250;k++);<br>}</p><p>&#x2F;********************************************************<br>                         å»¶æ—¶å‡½æ•°<br>********************************************************&#x2F;</p><p>void main()<br>{<br>    shi_neng&#x3D;1;  &#x2F;&#x2F;ä½¿èƒ½æ§åˆ¶ä½<br>    fang_shi&#x3D;0;  &#x2F;&#x2F;å·¥ä½œæ–¹å¼æ§åˆ¶ä½,é«˜ç”µå¹³æ—¶ä¸ºåŠæ­¥æ–¹å¼(å››ç›¸å…«æ‹)ï¼Œä½ç”µå¹³æ—¶ä¸ºå…¨æ­¥æ–¹å¼<br>    fang_xiang&#x3D;1;&#x2F;&#x2F;æ—‹è½¬æ–¹å‘æ§åˆ¶ä½<br>    mai_chong&#x3D;1; &#x2F;&#x2F; è„‰å†²æ§åˆ¶ä½</p><pre><code>while(1)&#123;    mai_chong=~mai_chong; //è¾“å‡ºæ—¶é’Ÿè„‰å†²    delay(15);  //å»¶æ—¶  (æ‹¬å·å†…æ•°å€¼è¶Šå°ï¼Œç”µæœºè½¬åŠ¨é€Ÿåº¦è¶Šå¿«)&#125;</code></pre><p>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1-EAthEFP_O7cM3xziU1MUg </span><br><span class="line">æå–ç ï¼šmnlm</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1-EAthEFP_O7cM3xziU1MUg  æå–ç ï¼šmnlm</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘NE555å»¶æ—¶ç”µè·¯</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FNE555%E5%BB%B6%E6%97%B6%E7%94%B5%E8%B7%AF/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FNE555%E5%BB%B6%E6%97%B6%E7%94%B5%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘NE555å»¶æ—¶ç”µè·¯"><a href="#ã€Proteusä»¿çœŸã€‘NE555å»¶æ—¶ç”µè·¯" class="headerlink" title="ã€Proteusä»¿çœŸã€‘NE555å»¶æ—¶ç”µè·¯"></a>ã€Proteusä»¿çœŸã€‘NE555å»¶æ—¶ç”µè·¯</h1><h3 id="ã€Proteusä»¿çœŸã€‘NE555å»¶æ—¶ç”µè·¯-1"><a href="#ã€Proteusä»¿çœŸã€‘NE555å»¶æ—¶ç”µè·¯-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘NE555å»¶æ—¶ç”µè·¯"></a>ã€Proteusä»¿çœŸã€‘NE555å»¶æ—¶ç”µè·¯</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/a75e4a3b436147d8af48eb344e85f936.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#define uchar unsigned char</span><br><span class="line"></span><br><span class="line">sbit Signal = P1^0;</span><br><span class="line">sbit BEEP = P3^7;//èœ‚é¸£å™¨</span><br><span class="line"></span><br><span class="line">void Delay(uint x)</span><br><span class="line">&#123;</span><br><span class="line"> uchar i;</span><br><span class="line">while(x--)</span><br><span class="line">&#123;</span><br><span class="line"> for(i=0;i&lt;80;i++);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> while(1)</span><br><span class="line">&#123;</span><br><span class="line"> if(Signal)</span><br><span class="line">&#123;</span><br><span class="line">BEEP=~BEEP;</span><br><span class="line">Delay(4);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#define uint unsigned int<br>#define uchar unsigned char</p><p>sbit Signal &#x3D; P1^0;<br>sbit BEEP &#x3D; P3^7;&#x2F;&#x2F;èœ‚é¸£å™¨</p><p>void Delay(uint x)<br>{<br>     uchar i;<br>    while(xâ€“)<br>    {<br>     for(i&#x3D;0;i&lt;80;i++);<br>    }<br>}</p><p>void main()<br>{<br>     while(1)<br>    {<br>     if(Signal)<br>        {<br>            BEEP&#x3D;~BEEP;<br>            Delay(4);<br>        }<br>    }<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åº"><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åº" class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åº"></a>ä»¿çœŸèµ„æºå’Œç¨‹åº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1dJKss-03T9zR-w4M2o0gjw </span><br><span class="line">æå–ç ï¼šqgsg</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1dJKss-03T9zR-w4M2o0gjw  æå–ç ï¼šqgsg</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘T6963Cé©±åŠ¨PG12864ç¤ºä¾‹ï¼ˆå¸¦ä¸­è‹±æ–‡æ˜¾ç¤ºï¼‰</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FT6963C%E9%A9%B1%E5%8A%A8PG12864%E7%A4%BA%E4%BE%8B%E5%B8%A6%E4%B8%AD%E8%8B%B1%E6%96%87%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FT6963C%E9%A9%B1%E5%8A%A8PG12864%E7%A4%BA%E4%BE%8B%E5%B8%A6%E4%B8%AD%E8%8B%B1%E6%96%87%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘T6963Cé©±åŠ¨PG12864ç¤ºä¾‹ï¼ˆå¸¦ä¸­è‹±æ–‡æ˜¾ç¤ºï¼‰"><a href="#ã€Proteusä»¿çœŸã€‘T6963Cé©±åŠ¨PG12864ç¤ºä¾‹ï¼ˆå¸¦ä¸­è‹±æ–‡æ˜¾ç¤ºï¼‰" class="headerlink" title="ã€Proteusä»¿çœŸã€‘T6963Cé©±åŠ¨PG12864ç¤ºä¾‹ï¼ˆå¸¦ä¸­è‹±æ–‡æ˜¾ç¤ºï¼‰"></a>ã€Proteusä»¿çœŸã€‘T6963Cé©±åŠ¨PG12864ç¤ºä¾‹ï¼ˆå¸¦ä¸­è‹±æ–‡æ˜¾ç¤ºï¼‰</h1><h3 id="ã€Proteusä»¿çœŸã€‘T6963Cé©±åŠ¨PG12864ç¤ºä¾‹ï¼ˆå¸¦ä¸­è‹±æ–‡æ˜¾ç¤ºï¼‰-1"><a href="#ã€Proteusä»¿çœŸã€‘T6963Cé©±åŠ¨PG12864ç¤ºä¾‹ï¼ˆå¸¦ä¸­è‹±æ–‡æ˜¾ç¤ºï¼‰-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘T6963Cé©±åŠ¨PG12864ç¤ºä¾‹ï¼ˆå¸¦ä¸­è‹±æ–‡æ˜¾ç¤ºï¼‰"></a>ã€Proteusä»¿çœŸã€‘T6963Cé©±åŠ¨PG12864ç¤ºä¾‹ï¼ˆå¸¦ä¸­è‹±æ–‡æ˜¾ç¤ºï¼‰</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li><li>å±å¹•ä¸ºT6963Cé©±åŠ¨æ§åˆ¶çš„</li></ul><p><img src="https://img-blog.csdnimg.cn/25617256699f470fbd1c0f767d498026.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>T6963C</code></p><p><img src="https://img-blog.csdnimg.cn/43a3e1e6b8d94a3fa734deba3dd0fb60.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ±‰å­—å–æ¨¡å·¥å…·å’Œæ–¹å¼"><a href="#æ±‰å­—å–æ¨¡å·¥å…·å’Œæ–¹å¼" class="headerlink" title="æ±‰å­—å–æ¨¡å·¥å…·å’Œæ–¹å¼"></a>æ±‰å­—å–æ¨¡å·¥å…·å’Œæ–¹å¼</h4><ul><li>å–æ¨¡è½¯ä»¶ï¼šPCtoLCD2002</li><li>å–æ¨¡æ–¹å¼;é˜´ç ã€è¡Œåˆ—å¼ã€é¡ºå‘ã€C51æ ¼å¼</li><li>å–æ¨¡æ–¹å¼;é˜´ç ã€è¡Œåˆ—å¼ã€é¡ºå‘ã€C51æ ¼å¼</li><li>ä»¿çœŸä»¥åŠç›¸å…³è¯´æ˜</li></ul><p><code>PCtoLCD2002</code></p><ul><li>å–æ¨¡æ–¹å¼;é˜´ç ã€è¡Œåˆ—å¼ã€é¡ºå‘ã€C51æ ¼å¼</li></ul><p><img src="https://img-blog.csdnimg.cn/a0fcb71a1c244d01936c7b0bd33e7e50.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¦‚æœP0æ¥å…¥äº†ä¸Šæ‹‰ç”µé˜»ï¼Œåˆ™å¯åŠ¨è¿è¡Œä»¿çœŸæ—¶ï¼Œæ˜¾ç¤ºæ¯”è¾ƒæ…¢å¤§æ¦‚ç­‰å¾…15ç§’å·¦å³ï¼Œ.åœ¨å®é™…é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­å°½é‡æ”¾å¼ƒä½¿ç”¨è¿™ç§å±å¹•ï¼Œä¸»è¦æ˜¯å› ä¸ºè¿™ä¸ªå±å¹•ä»·æ ¼å¤ªè´µï¼Œèµ„æ–™å¤ªå°‘ã€‚ä¸æ¨å´‡ä½¿ç”¨ï¼Œè¿™é‡Œä»…ä»…æ˜¯ä»¿çœŸæ¼”ç¤ºä½¿ç”¨ã€‚</p><ul><li>P0å£ä½œä¸ºæ€»çº¿æ‰©å±•ç”¨æ—¶ï¼Œä¸ç”¨åŠ ä¸Šæ‹‰,åœ¨ä»¿çœŸæ—¶å¦‚æœæ²¡æœ‰åŠ ä¸Šæ‹‰ï¼Œå¯åŠ¨è¿è¡Œä»¿çœŸï¼Œæ˜¾ç¤ºç”»é¢å¾ˆå¿«å°±å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ã€‚</li></ul><p><code>P0</code></p><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">//é™„å½• B æ–‡æœ¬æ–¹å¼æ˜¾ç¤ºæ±‰å­—ç¨‹åº</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line">#include&lt;reg52.h&gt;</span><br><span class="line">#include&lt;T6963C.h&gt;</span><br><span class="line">#include&lt;DATA.h&gt;</span><br><span class="line">#define lcmcom XBYTE[0x3fff] /*T6963C å†™å‘½ä»¤å£åœ°å€ï¼Œè¯»æ•°æ®å£åœ°å€*/</span><br><span class="line">#define lcmdata XBYTE[0x3eff] /*T6963C å†™æ•°æ®å£åœ°å€*/</span><br><span class="line"></span><br><span class="line">void DelayMs(unsigned int n)</span><br><span class="line">&#123;</span><br><span class="line">unsigned char j;</span><br><span class="line">while(n--)</span><br><span class="line">&#123;</span><br><span class="line">for(j=0;j&lt;113;j++)</span><br><span class="line">;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">init_lcm(); //LCM åˆå§‹åŒ–</span><br><span class="line"></span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">clear_lcm(); //LCM æ¸…å±</span><br><span class="line">display_c(0,1,0,5);//ä»table[0]ï¼Œä»ç¬¬0è¡Œçš„1ä½ç½®å¼€å§‹æ˜¾ç¤ºï¼Œæ˜¾ç¤º5ä¸ªæ±‰å­—(16X16)</span><br><span class="line">display_c(5,1,1,5);//æ•°å­—8X16ï¼Œæ˜¾ç¤º:0-9</span><br><span class="line">display_c(9,0,2,8);//DATA.Hå­—æ¨¡ä¸ä¸Šé¢çš„æœ€åä¸¤ä¸ªé‡å ,æ˜¾ç¤ºï¼š89abc..</span><br><span class="line">display_c(17,0,3,5);</span><br><span class="line">DelayMs(2000);</span><br><span class="line">clear_lcm(); //LCM æ¸…å±</span><br><span class="line">display_c(22,0,1,8);</span><br><span class="line">display_c(30,0,2,7);</span><br><span class="line">DelayMs(2000);</span><br><span class="line">&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;&#x2F;é™„å½• B æ–‡æœ¬æ–¹å¼æ˜¾ç¤ºæ±‰å­—ç¨‹åº<br>#include&lt;intrins.h&gt;<br>#include&lt;reg52.h&gt;<br>#include&lt;T6963C.h&gt;<br>#include&lt;DATA.h&gt;<br>#define lcmcom XBYTE[0x3fff] &#x2F;<em>T6963C å†™å‘½ä»¤å£åœ°å€ï¼Œè¯»æ•°æ®å£åœ°å€</em>&#x2F;<br>#define lcmdata XBYTE[0x3eff] &#x2F;<em>T6963C å†™æ•°æ®å£åœ°å€</em>&#x2F;</p><p>void DelayMs(unsigned int n)<br>{<br>    unsigned char j;<br>    while(nâ€“)<br>    {<br>        for(j&#x3D;0;j&lt;113;j++)<br>        ;<br>    }</p><p>}</p><p>void main()<br>{<br>    init_lcm(); &#x2F;&#x2F;LCM åˆå§‹åŒ–</p><pre><code>while(1)&#123;    clear_lcm(); //LCM æ¸…å±    display_c(0,1,0,5);//ä»table[0]ï¼Œä»ç¬¬0è¡Œçš„1ä½ç½®å¼€å§‹æ˜¾ç¤ºï¼Œæ˜¾ç¤º5ä¸ªæ±‰å­—(16X16)    display_c(5,1,1,5);//æ•°å­—8X16ï¼Œæ˜¾ç¤º:0-9    display_c(9,0,2,8);//DATA.Hå­—æ¨¡ä¸ä¸Šé¢çš„æœ€åä¸¤ä¸ªé‡å ,æ˜¾ç¤ºï¼š89abc..    display_c(17,0,3,5);    DelayMs(2000);    clear_lcm(); //LCM æ¸…å±    display_c(22,0,1,8);    display_c(30,0,2,7);    DelayMs(2000);&#125;</code></pre><p> }&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1T-M-ZU4HG9XAPJXMXtT2JA </span><br><span class="line">æå–ç ï¼š4rah</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1T-M-ZU4HG9XAPJXMXtT2JA  æå–ç ï¼š4rah</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœº+æŒ‰é”®æ­£åè½¬æ§åˆ¶</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E4%B8%89%E6%9E%81%E7%AE%A1%E7%BB%84%E6%88%90%E7%9A%84H%E6%A1%A5%E9%A9%B1%E5%8A%A8%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%8C%89%E9%94%AE%E6%AD%A3%E5%8F%8D%E8%BD%AC%E6%8E%A7%E5%88%B6/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E4%B8%89%E6%9E%81%E7%AE%A1%E7%BB%84%E6%88%90%E7%9A%84H%E6%A1%A5%E9%A9%B1%E5%8A%A8%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%8C%89%E9%94%AE%E6%AD%A3%E5%8F%8D%E8%BD%AC%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœº-æŒ‰é”®æ­£åè½¬æ§åˆ¶"><a href="#ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœº-æŒ‰é”®æ­£åè½¬æ§åˆ¶" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœº+æŒ‰é”®æ­£åè½¬æ§åˆ¶"></a>ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœº+æŒ‰é”®æ­£åè½¬æ§åˆ¶</h1><h3 id="ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœº-æŒ‰é”®æ­£åè½¬æ§åˆ¶-1"><a href="#ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœº-æŒ‰é”®æ­£åè½¬æ§åˆ¶-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœº+æŒ‰é”®æ­£åè½¬æ§åˆ¶"></a>ã€Proteusä»¿çœŸã€‘ä¸‰æç®¡ç»„æˆçš„Hæ¡¥é©±åŠ¨ç›´æµç”µæœº+æŒ‰é”®æ­£åè½¬æ§åˆ¶</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/28f361b10a27484da2f1d1bd1c46321c.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">sbit K1   = P3^0;//æ­£è½¬</span><br><span class="line">sbit K2   = P3^1;//åè½¬</span><br><span class="line">sbit K3   = P3^2;//åœæ­¢</span><br><span class="line">sbit LED1 = P0^0;//æ­£è½¬æŒ‡ç¤ºç¯</span><br><span class="line">sbit LED2 = P0^1;//åè½¬æŒ‡ç¤ºç¯</span><br><span class="line">sbit LED3 = P0^2;//åœæ­¢æŒ‡ç¤ºç¯</span><br><span class="line">sbit MA   = P1^0;//ç”µæœºé©±åŠ¨å¼•è„š</span><br><span class="line">sbit MB   = P1^1;//ç”µæœºé©±åŠ¨å¼•è„š</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">LED1 = 1;</span><br><span class="line">LED2 = 1;</span><br><span class="line">LED3 = 0;</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line"> if(K1 == 0)</span><br><span class="line">&#123;</span><br><span class="line"> while(K1 == 0);</span><br><span class="line">LED1 = 0;</span><br><span class="line">LED2 = 1;</span><br><span class="line">LED3 = 1;</span><br><span class="line">MA   = 0;</span><br><span class="line">MB   = 1;</span><br><span class="line">&#125;</span><br><span class="line">if(K2 == 0)</span><br><span class="line">&#123;</span><br><span class="line"> while(K1 == 0);</span><br><span class="line">LED1 = 1;</span><br><span class="line">LED2 = 0;</span><br><span class="line">LED3 = 1;</span><br><span class="line">MA   = 1;</span><br><span class="line">MB   = 0;</span><br><span class="line">&#125;</span><br><span class="line">if(K3 == 0)</span><br><span class="line">&#123;</span><br><span class="line"> while(K1 == 0);</span><br><span class="line">LED1 = 1;</span><br><span class="line">LED2 = 1;</span><br><span class="line">LED3 = 0;</span><br><span class="line">MA   = 0;</span><br><span class="line">MB   = 0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;<br>#define uint unsigned int<br>#define uchar unsigned char<br>sbit K1   &#x3D; P3^0;&#x2F;&#x2F;æ­£è½¬<br>sbit K2   &#x3D; P3^1;&#x2F;&#x2F;åè½¬<br>sbit K3   &#x3D; P3^2;&#x2F;&#x2F;åœæ­¢<br>sbit LED1 &#x3D; P0^0;&#x2F;&#x2F;æ­£è½¬æŒ‡ç¤ºç¯<br>sbit LED2 &#x3D; P0^1;&#x2F;&#x2F;åè½¬æŒ‡ç¤ºç¯<br>sbit LED3 &#x3D; P0^2;&#x2F;&#x2F;åœæ­¢æŒ‡ç¤ºç¯<br>sbit MA   &#x3D; P1^0;&#x2F;&#x2F;ç”µæœºé©±åŠ¨å¼•è„š<br>sbit MB   &#x3D; P1^1;&#x2F;&#x2F;ç”µæœºé©±åŠ¨å¼•è„š</p><p>void main(void)<br>{<br>    LED1 &#x3D; 1;<br>    LED2 &#x3D; 1;<br>    LED3 &#x3D; 0;<br>    while(1)<br>    {<br>     if(K1 &#x3D;&#x3D; 0)<br>        {<br>         while(K1 &#x3D;&#x3D; 0);<br>            LED1 &#x3D; 0;<br>            LED2 &#x3D; 1;<br>            LED3 &#x3D; 1;<br>            MA   &#x3D; 0;<br>            MB   &#x3D; 1;<br>        }<br>        if(K2 &#x3D;&#x3D; 0)<br>        {<br>         while(K1 &#x3D;&#x3D; 0);<br>            LED1 &#x3D; 1;<br>            LED2 &#x3D; 0;<br>            LED3 &#x3D; 1;<br>            MA   &#x3D; 1;<br>            MB   &#x3D; 0;<br>        }<br>        if(K3 &#x3D;&#x3D; 0)<br>        {<br>         while(K1 &#x3D;&#x3D; 0);<br>            LED1 &#x3D; 1;<br>            LED2 &#x3D; 1;<br>            LED3 &#x3D; 0;<br>            MA   &#x3D; 0;<br>            MB   &#x3D; 0;<br>        }<br>    }<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1hXPC5K-YvIjtYsLc98CzeQ </span><br><span class="line">æå–ç ï¼špo90</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1hXPC5K-YvIjtYsLc98CzeQ  æå–ç ï¼špo90</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘åˆ©ç”¨åŠ æ³•è®¡æ•°å™¨74XX160çš„çº§è”å®ç°2ä½è®¡æ•°</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%88%A9%E7%94%A8%E5%8A%A0%E6%B3%95%E8%AE%A1%E6%95%B0%E5%99%A874XX160%E7%9A%84%E7%BA%A7%E8%81%94%E5%AE%9E%E7%8E%B02%E4%BD%8D%E8%AE%A1%E6%95%B0/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%88%A9%E7%94%A8%E5%8A%A0%E6%B3%95%E8%AE%A1%E6%95%B0%E5%99%A874XX160%E7%9A%84%E7%BA%A7%E8%81%94%E5%AE%9E%E7%8E%B02%E4%BD%8D%E8%AE%A1%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘åˆ©ç”¨åŠ æ³•è®¡æ•°å™¨74XX160çš„çº§è”å®ç°2ä½è®¡æ•°"><a href="#ã€Proteusä»¿çœŸã€‘åˆ©ç”¨åŠ æ³•è®¡æ•°å™¨74XX160çš„çº§è”å®ç°2ä½è®¡æ•°" class="headerlink" title="ã€Proteusä»¿çœŸã€‘åˆ©ç”¨åŠ æ³•è®¡æ•°å™¨74XX160çš„çº§è”å®ç°2ä½è®¡æ•°"></a>ã€Proteusä»¿çœŸã€‘åˆ©ç”¨åŠ æ³•è®¡æ•°å™¨74XX160çš„çº§è”å®ç°2ä½è®¡æ•°</h1><h3 id="ã€Proteusä»¿çœŸã€‘åˆ©ç”¨åŠ æ³•è®¡æ•°å™¨74XX160çš„çº§è”å®ç°2ä½è®¡æ•°-1"><a href="#ã€Proteusä»¿çœŸã€‘åˆ©ç”¨åŠ æ³•è®¡æ•°å™¨74XX160çš„çº§è”å®ç°2ä½è®¡æ•°-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘åˆ©ç”¨åŠ æ³•è®¡æ•°å™¨74XX160çš„çº§è”å®ç°2ä½è®¡æ•°"></a>ã€Proteusä»¿çœŸã€‘åˆ©ç”¨åŠ æ³•è®¡æ•°å™¨74XX160çš„çº§è”å®ç°2ä½è®¡æ•°</h3><ul><li>Proteusä»¿çœŸ</li></ul><p>è®¡æ•°åˆ°24å½’é›¶</p><p><img src="https://img-blog.csdnimg.cn/9824cba916b04d3380d9dffff3b1b832.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>è‡ªå·±æ­å»ºç”µè·¯æ³¨æ„ä¸ªCLKå¼•è„šä¸€ä¸ªä¹°å“¦è„‰å†²ä¿¡å·ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/0d5c97e17e3c41a4a36dad95bb1294fc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç”µè·¯é›¶ä»¶æ¸…å•"><a href="#ç”µè·¯é›¶ä»¶æ¸…å•" class="headerlink" title="ç”µè·¯é›¶ä»¶æ¸…å•"></a>ç”µè·¯é›¶ä»¶æ¸…å•</h4><p><img src="https://img-blog.csdnimg.cn/d627ee8d5ef44f12bd4343f4376f3297.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/eb707e64fa6f4191bd28d35910151aa1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.9å¹³å°</p><p><code>Proteus8.9</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1wDLiKBCxrmEW9rWTRJAPDQ </span><br><span class="line">æå–ç ï¼še3st</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1wDLiKBCxrmEW9rWTRJAPDQ  æå–ç ï¼še3st</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘åœ¨AT24C04çš„è¿ç»­åœ°å€ä¸­å†™å…¥æ•°æ®å¹¶å¾ªç¯è¯»å–</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%9C%A8AT24C04%E7%9A%84%E8%BF%9E%E7%BB%AD%E5%9C%B0%E5%9D%80%E4%B8%AD%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE%E5%B9%B6%E5%BE%AA%E7%8E%AF%E8%AF%BB%E5%8F%96/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%9C%A8AT24C04%E7%9A%84%E8%BF%9E%E7%BB%AD%E5%9C%B0%E5%9D%80%E4%B8%AD%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE%E5%B9%B6%E5%BE%AA%E7%8E%AF%E8%AF%BB%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘åœ¨AT24C04çš„è¿ç»­åœ°å€ä¸­å†™å…¥æ•°æ®å¹¶å¾ªç¯è¯»å–"><a href="#ã€Proteusä»¿çœŸã€‘åœ¨AT24C04çš„è¿ç»­åœ°å€ä¸­å†™å…¥æ•°æ®å¹¶å¾ªç¯è¯»å–" class="headerlink" title="ã€Proteusä»¿çœŸã€‘åœ¨AT24C04çš„è¿ç»­åœ°å€ä¸­å†™å…¥æ•°æ®å¹¶å¾ªç¯è¯»å–"></a>ã€Proteusä»¿çœŸã€‘åœ¨AT24C04çš„è¿ç»­åœ°å€ä¸­å†™å…¥æ•°æ®å¹¶å¾ªç¯è¯»å–</h1><h3 id="ã€Proteusä»¿çœŸã€‘åœ¨AT24C04çš„è¿ç»­åœ°å€ä¸­å†™å…¥æ•°æ®å¹¶å¾ªç¯è¯»å–-1"><a href="#ã€Proteusä»¿çœŸã€‘åœ¨AT24C04çš„è¿ç»­åœ°å€ä¸­å†™å…¥æ•°æ®å¹¶å¾ªç¯è¯»å–-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘åœ¨AT24C04çš„è¿ç»­åœ°å€ä¸­å†™å…¥æ•°æ®å¹¶å¾ªç¯è¯»å–"></a>ã€Proteusä»¿çœŸã€‘åœ¨AT24C04çš„è¿ç»­åœ°å€ä¸­å†™å…¥æ•°æ®å¹¶å¾ªç¯è¯»å–</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/67c4f7d734484634ad0cc67215f0b461.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å®éªŒè¯´æ˜"><a href="#å®éªŒè¯´æ˜" class="headerlink" title="å®éªŒè¯´æ˜"></a>å®éªŒè¯´æ˜</h4><p>åœ¨AT24C04çš„åœ°å€0-9ä¸­åˆ†åˆ«å†™å…¥æ•°æ®ï¼Œç„¶ååœ¨whileå¾ªç¯é‡Œé¢å¾ªç¯ä»AT24C04çš„åœ°å€0-9è¯»å–æ•°æ®ï¼Œå¹¶é€šè¿‡æ•°ç ç®¡æ˜¾ç¤ºæ•°å‡ºæ¥ï¼Œæ¥éªŒè¯æ•°æ®çš„å†™å…¥å’Œè¯»å–æ˜¯å¦æˆåŠŸã€‚</p><p><code>while</code></p><ul><li>æœ¬ç¤ºä¾‹æ˜¯å±•ç¤ºå¦‚ä½•å°†æ•°æ®å†™å…¥åˆ°AT24C04å½“ä¸­ï¼Œå¹¶è¯»å–æ•°æ®ï¼Œå¯ä»¥ç”¨äºç§»æ¤åˆ°æœ‰éœ€è¦çš„ç›¸å…³é¡¹ç›®å½“ä¸­ã€‚</li></ul><h4 id="ç¨‹åºä»£ç "><a href="#ç¨‹åºä»£ç " class="headerlink" title="ç¨‹åºä»£ç "></a>ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#define NOP4() &#123;_nop_();_nop_();_nop_();_nop_();&#125;</span><br><span class="line"></span><br><span class="line">sbit SCL = P1^0;</span><br><span class="line">sbit SDA = P1^1;</span><br><span class="line"></span><br><span class="line">uchar code DSY_CODE[]=</span><br><span class="line">&#123;</span><br><span class="line"> 0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">uchar DISP_Buffer[]=&#123;0,0,0&#125;;</span><br><span class="line">uchar Count = 0;</span><br><span class="line"></span><br><span class="line">void DelayMS(uint x)</span><br><span class="line">&#123;</span><br><span class="line">uchar t;</span><br><span class="line">while(x--)</span><br><span class="line">&#123;</span><br><span class="line"> for(t=120;t&gt;0;t--);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Start()</span><br><span class="line">&#123;</span><br><span class="line"> SDA=1;SCL=1;NOP4();SDA=0;NOP4();SCL=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Stop()</span><br><span class="line">&#123;</span><br><span class="line"> SDA=0;SCL=0;NOP4();SCL=1;NOP4();SDA=1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void RACK()</span><br><span class="line">&#123;</span><br><span class="line"> SDA=1;NOP4();SCL=1;NOP4();SCL=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void NO_ACK()</span><br><span class="line">&#123;</span><br><span class="line"> SDA=1;SCL=1;NOP4();SCL=0;SDA=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Write_A_Byte(uchar b)</span><br><span class="line">&#123;</span><br><span class="line"> uchar i;</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">&#123;</span><br><span class="line"> b&lt;&lt;=1;SDA=CY;_nop_();SCL=1;NOP4();SCL=0;</span><br><span class="line">&#125;</span><br><span class="line">RACK();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uchar Receive_A_Byte()</span><br><span class="line">&#123;</span><br><span class="line"> uchar i,d;</span><br><span class="line">for(i=0;i&lt;8;i++)</span><br><span class="line">&#123;</span><br><span class="line"> SCL=1;d&lt;&lt;=1;d|=SDA;SCL=0;</span><br><span class="line">&#125;</span><br><span class="line">return d;</span><br><span class="line">&#125;</span><br><span class="line">/*åœ°å€ä½å†™æ•°æ®*/</span><br><span class="line">void Write_Random_Address_Byte(uchar add,uchar dat)</span><br><span class="line">&#123;</span><br><span class="line"> Start();</span><br><span class="line">Write_A_Byte(0xa0);</span><br><span class="line">Write_A_Byte(add);</span><br><span class="line">Write_A_Byte(dat);</span><br><span class="line">Stop();</span><br><span class="line">DelayMS(10);</span><br><span class="line">&#125;</span><br><span class="line">/*è¯»æ•°æ®*/</span><br><span class="line">uchar Read_Current_Address_Data()</span><br><span class="line">&#123;</span><br><span class="line"> uchar d;</span><br><span class="line">Start();</span><br><span class="line">Write_A_Byte(0xa1);</span><br><span class="line">d=Receive_A_Byte();</span><br><span class="line">NO_ACK();</span><br><span class="line">Stop();</span><br><span class="line">return d;</span><br><span class="line">&#125;</span><br><span class="line">/*åœ°å€ä½è¯»æ•°æ®*/</span><br><span class="line">uchar Random_Read(uchar addr)</span><br><span class="line">&#123;</span><br><span class="line"> Start();</span><br><span class="line">Write_A_Byte(0xa0);</span><br><span class="line">Write_A_Byte(addr);</span><br><span class="line">Stop();</span><br><span class="line">return Read_Current_Address_Data();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Convert_And_Display()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">unsigned char k =0,j=0,z=0;</span><br><span class="line">for(z=0;z&lt;10;z++)&#123;</span><br><span class="line">for(j=0;j&lt;120;j++)&#123;</span><br><span class="line">Count = Random_Read(k);//ä»AT24C04ä¸­è¯»æ•°æ®</span><br><span class="line"> DISP_Buffer[2] = Count/100;</span><br><span class="line">DISP_Buffer[1] = Count%100/10;</span><br><span class="line">DISP_Buffer[0] = Count%100%10;</span><br><span class="line">//if(DISP_Buffer[2] == 0)</span><br><span class="line">//&#123;</span><br><span class="line">// DISP_Buffer[2] = 10;</span><br><span class="line">//if(DISP_Buffer[1] == 0)</span><br><span class="line">//&#123;</span><br><span class="line">// DISP_Buffer[1] = 10;</span><br><span class="line">//&#125;</span><br><span class="line">//&#125;</span><br><span class="line">P2 = 0x80;</span><br><span class="line">P0 = DSY_CODE[DISP_Buffer[0]];</span><br><span class="line">DelayMS(2);</span><br><span class="line">P2 = 0x40;</span><br><span class="line">P0 = DSY_CODE[DISP_Buffer[1]];</span><br><span class="line">DelayMS(2);</span><br><span class="line">P2 = 0x20;</span><br><span class="line">P0 = DSY_CODE[DISP_Buffer[2]];</span><br><span class="line">DelayMS(2); </span><br><span class="line">&#125;</span><br><span class="line">k++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i=0;</span><br><span class="line"> //Count = Random_Read(0x00) + 1;</span><br><span class="line">//Write_Random_Address_Byte(0x00,Count);</span><br><span class="line">for(i=0;i&lt;10;i++)&#123;</span><br><span class="line">Write_Random_Address_Byte(i,111+i);//æŒ‡å®šåœ°å€å†™æ•°æ®</span><br><span class="line">&#125;</span><br><span class="line">while(1)&#123;</span><br><span class="line">Convert_And_Display();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;<br>#include &lt;intrins.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int<br>#define NOP4() {<em>nop</em>();<em>nop</em>();<em>nop</em>();<em>nop</em>();}</p><p>sbit SCL &#x3D; P1^0;<br>sbit SDA &#x3D; P1^1;</p><p>uchar code DSY_CODE[]&#x3D;<br>{<br>     0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90<br>};</p><p>uchar DISP_Buffer[]&#x3D;{0,0,0};<br>uchar Count &#x3D; 0;</p><p>void DelayMS(uint x)<br>{<br>    uchar t;<br>    while(xâ€“)<br>    {<br>     for(t&#x3D;120;t&gt;0;tâ€“);<br>    }<br>}</p><p>void Start()<br>{<br>     SDA&#x3D;1;SCL&#x3D;1;NOP4();SDA&#x3D;0;NOP4();SCL&#x3D;0;<br>}</p><p>void Stop()<br>{<br>     SDA&#x3D;0;SCL&#x3D;0;NOP4();SCL&#x3D;1;NOP4();SDA&#x3D;1;<br>}</p><p>void RACK()<br>{<br>     SDA&#x3D;1;NOP4();SCL&#x3D;1;NOP4();SCL&#x3D;0;<br>}</p><p>void NO_ACK()<br>{<br>     SDA&#x3D;1;SCL&#x3D;1;NOP4();SCL&#x3D;0;SDA&#x3D;0;<br>}</p><p>void Write_A_Byte(uchar b)<br>{<br>     uchar i;<br>    for(i&#x3D;0;i&lt;8;i++)<br>    {<br>     b&lt;&lt;&#x3D;1;SDA&#x3D;CY;<em>nop</em>();SCL&#x3D;1;NOP4();SCL&#x3D;0;<br>    }<br>    RACK();<br>}</p><p>uchar Receive_A_Byte()<br>{<br>     uchar i,d;<br>    for(i&#x3D;0;i&lt;8;i++)<br>    {<br>     SCL&#x3D;1;d&lt;&lt;&#x3D;1;d|&#x3D;SDA;SCL&#x3D;0;<br>    }<br>    return d;<br>}<br>&#x2F;<em>åœ°å€ä½å†™æ•°æ®</em>&#x2F;<br>void Write_Random_Address_Byte(uchar add,uchar dat)<br>{<br>     Start();<br>    Write_A_Byte(0xa0);<br>    Write_A_Byte(add);<br>    Write_A_Byte(dat);<br>    Stop();<br>    DelayMS(10);<br>}<br>&#x2F;<em>è¯»æ•°æ®</em>&#x2F;<br>uchar Read_Current_Address_Data()<br>{<br>     uchar d;<br>    Start();<br>    Write_A_Byte(0xa1);<br>    d&#x3D;Receive_A_Byte();<br>    NO_ACK();<br>    Stop();<br>    return d;<br>}<br>&#x2F;<em>åœ°å€ä½è¯»æ•°æ®</em>&#x2F;<br>uchar Random_Read(uchar addr)<br>{<br>     Start();<br>    Write_A_Byte(0xa0);<br>    Write_A_Byte(addr);<br>    Stop();<br>    return Read_Current_Address_Data();<br>}</p><p>void Convert_And_Display()<br>{</p><pre><code>unsigned char k =0,j=0,z=0;for(z=0;z&lt;10;z++)&#123;        for(j=0;j&lt;120;j++)&#123;Count = Random_Read(k);//ä»AT24C04ä¸­è¯»æ•°æ® DISP_Buffer[2] = Count/100;DISP_Buffer[1] = Count%100/10;DISP_Buffer[0] = Count%100%10;</code></pre><p>&#x2F;&#x2F;if(DISP_Buffer[2] &#x3D;&#x3D; 0)<br>&#x2F;&#x2F;{<br>&#x2F;&#x2F; DISP_Buffer[2] &#x3D; 10;<br>&#x2F;&#x2F;if(DISP_Buffer[1] &#x3D;&#x3D; 0)<br>&#x2F;&#x2F;{<br>&#x2F;&#x2F; DISP_Buffer[1] &#x3D; 10;<br>&#x2F;&#x2F;}<br>&#x2F;&#x2F;}<br>    P2 &#x3D; 0x80;<br>    P0 &#x3D; DSY_CODE[DISP_Buffer[0]];<br>    DelayMS(2);<br>    P2 &#x3D; 0x40;<br>    P0 &#x3D; DSY_CODE[DISP_Buffer[1]];<br>    DelayMS(2);<br>    P2 &#x3D; 0x20;<br>    P0 &#x3D; DSY_CODE[DISP_Buffer[2]];<br>    DelayMS(2);<br>}<br>                    k++;<br>    }<br>}</p><p>void main()<br>{<br>    unsigned char i&#x3D;0;<br> &#x2F;&#x2F;Count &#x3D; Random_Read(0x00) + 1;<br>&#x2F;&#x2F;Write_Random_Address_Byte(0x00,Count);<br>    for(i&#x3D;0;i&lt;10;i++){<br>        Write_Random_Address_Byte(i,111+i);&#x2F;&#x2F;æŒ‡å®šåœ°å€å†™æ•°æ®<br>    }<br>    while(1){<br>        Convert_And_Display();<br>    }<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1TCEXVLOZqa_KnJ-1tiTKAw </span><br><span class="line">æå–ç ï¼šk0kq</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1TCEXVLOZqa_KnJ-1tiTKAw  æå–ç ï¼šk0kq</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘åŸºäº74LS148+74LS279+74LS48çš„å››è·¯æŠ¢ç­”å™¨</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%9F%BA%E4%BA%8E74LS14874LS27974LS48%E7%9A%84%E5%9B%9B%E8%B7%AF%E6%8A%A2%E7%AD%94%E5%99%A8/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%9F%BA%E4%BA%8E74LS14874LS27974LS48%E7%9A%84%E5%9B%9B%E8%B7%AF%E6%8A%A2%E7%AD%94%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘åŸºäº74LS148-74LS279-74LS48çš„å››è·¯æŠ¢ç­”å™¨"><a href="#ã€Proteusä»¿çœŸã€‘åŸºäº74LS148-74LS279-74LS48çš„å››è·¯æŠ¢ç­”å™¨" class="headerlink" title="ã€Proteusä»¿çœŸã€‘åŸºäº74LS148+74LS279+74LS48çš„å››è·¯æŠ¢ç­”å™¨"></a>ã€Proteusä»¿çœŸã€‘åŸºäº74LS148+74LS279+74LS48çš„å››è·¯æŠ¢ç­”å™¨</h1><h3 id="ã€Proteusä»¿çœŸã€‘åŸºäº74LS148-74LS279-74LS48çš„å››è·¯æŠ¢ç­”å™¨-1"><a href="#ã€Proteusä»¿çœŸã€‘åŸºäº74LS148-74LS279-74LS48çš„å››è·¯æŠ¢ç­”å™¨-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘åŸºäº74LS148+74LS279+74LS48çš„å››è·¯æŠ¢ç­”å™¨"></a>ã€Proteusä»¿çœŸã€‘åŸºäº74LS148+74LS279+74LS48çš„å››è·¯æŠ¢ç­”å™¨</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/7658dc5b65c448d3a3709ae09fec93d3.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="74LS148"><a href="#74LS148" class="headerlink" title="74LS148"></a>74LS148</h4><p>74LS148 æ˜¯8 çº¿ï¼3 çº¿ä¼˜å…ˆç¼–ç å™¨ï¼Œå…±æœ‰ 54&#x2F;74148 å’Œ 54&#x2F;74LS148 ä¸¤ç§çº¿è·¯ç»“æ„å‹å¼ï¼Œå°† 8 æ¡æ•°æ®çº¿ï¼ˆ0ï¼7ï¼‰è¿›è¡Œ 3 çº¿(4-2-1)äºŒè¿›åˆ¶ï¼ˆå…«è¿›åˆ¶ï¼‰ä¼˜å…ˆç¼–ç ï¼Œå³å¯¹æœ€é«˜ä½æ•°æ®çº¿è¿›è¡Œè¯‘ç ã€‚åˆ©ç”¨é€‰é€šç«¯ï¼ˆEIï¼‰å’Œè¾“å‡ºé€‰é€šç«¯ï¼ˆEOï¼‰å¯è¿›è¡Œå…«è¿›åˆ¶æ‰©å±•ã€‚</p><h4 id="74LS279"><a href="#74LS279" class="headerlink" title="74LS279"></a>74LS279</h4><p>74LS279 æ˜¯ 4è·¯R-S è§¦å‘å™¨ã€‚</p><h4 id="74LS48"><a href="#74LS48" class="headerlink" title="74LS48"></a>74LS48</h4><p>ä¸ƒæ®µå…±é˜´æ•°ç ç®¡è¯‘ç å™¨é©±åŠ¨å™¨.</p><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬å®ä¾‹åŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/18WtXijHmoeCg1kKb9DrVbA </span><br><span class="line">æå–ç ï¼ši8zn</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/18WtXijHmoeCg1kKb9DrVbA  æå–ç ï¼ši8zn</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨0ä½œä¸º16ä½è®¡æ•°å™¨ä½¿ç”¨ç¤ºä¾‹</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%AE%9A%E6%97%B6%E5%99%A80%E4%BD%9C%E4%B8%BA16%E4%BD%8D%E8%AE%A1%E6%95%B0%E5%99%A8%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%AE%9A%E6%97%B6%E5%99%A80%E4%BD%9C%E4%B8%BA16%E4%BD%8D%E8%AE%A1%E6%95%B0%E5%99%A8%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨0ä½œä¸º16ä½è®¡æ•°å™¨ä½¿ç”¨ç¤ºä¾‹"><a href="#ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨0ä½œä¸º16ä½è®¡æ•°å™¨ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨0ä½œä¸º16ä½è®¡æ•°å™¨ä½¿ç”¨ç¤ºä¾‹"></a>ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨0ä½œä¸º16ä½è®¡æ•°å™¨ä½¿ç”¨ç¤ºä¾‹</h1><h3 id="ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨0ä½œä¸ºå¤–éƒ¨16ä½è®¡æ•°å™¨ä½¿ç”¨ç¤ºä¾‹"><a href="#ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨0ä½œä¸ºå¤–éƒ¨16ä½è®¡æ•°å™¨ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨0ä½œä¸ºå¤–éƒ¨16ä½è®¡æ•°å™¨ä½¿ç”¨ç¤ºä¾‹"></a>ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨0ä½œä¸ºå¤–éƒ¨16ä½è®¡æ•°å™¨ä½¿ç”¨ç¤ºä¾‹</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/ff2659d9bd9b4c33a3a7e162895a7f19.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="åŠŸèƒ½è¯´æ˜"><a href="#åŠŸèƒ½è¯´æ˜" class="headerlink" title="åŠŸèƒ½è¯´æ˜"></a>åŠŸèƒ½è¯´æ˜</h4><p>å°†å®šæ—¶å™¨0ä½œä¸ºå¤–éƒ¨16ä½è®¡æ•°å™¨ä½¿ç”¨ï¼Œå½“å¤–éƒ¨å¼•è„šP34å¼•è„šè§¦å‘æ—¶ï¼Œè®¡æ•°å™¨0å¯„å­˜å™¨+1ï¼Œç„¶åï¼Œé€šè¿‡ä¸²å£å°†å®šæ—¶å™¨0å¯„å­˜å™¨å€¼ï¼ˆTH0ï¼ŒTH0ï¼‰æ‰“å°å‡ºæ¥.ï¼ˆå¹³æ—¶ä¸€èˆ¬ç”¨ä½œå®šæ—¶å™¨åŠŸèƒ½æ¯”è¾ƒå¤šã€‚ï¼‰</p><ul><li>ç¤ºä¾‹ä»£ç æ¥æºKeilå®˜æ–¹ç¤ºä¾‹â€œ8051 Counter 0 Example Programâ€ä¿®æ”¹å¾—æ¥ï¼š<a href="https://www.keil.com/download/list/c51.htm">https://www.keil.com/download/list/c51.htm</a></li></ul><p><code>Keil</code></p><p><a href="https://www.keil.com/download/list/c51.htm">https://www.keil.com/download/list/c51.htm</a></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨äº” 6æœˆ 24 2022</span><br><span class="line"> * Processor: AT89C51</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;reg51.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">static volatile unsigned char cnt=0;</span><br><span class="line">sbit led = P1^0;</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">MAIN C function</span><br><span class="line">b,h,læ¥å¯¹è¾“å…¥å­—èŠ‚å®½çš„è®¾ç½®</span><br><span class="line">ä¸€ä¸ªå•å­—èŠ‚å˜é‡æ—¶è¦ä½¿ç”¨%bd</span><br><span class="line">1.bå…«ä½</span><br><span class="line">2.håå…­ä½</span><br><span class="line">3.lä¸‰åäºŒä½</span><br><span class="line">%dä¸¤ä¸ªå­—èŠ‚å˜é‡int</span><br><span class="line">%bdå•å­—èŠ‚å˜é‡char</span><br><span class="line">%ldå››å­—èŠ‚å˜é‡long int</span><br><span class="line">%x   unsigned int</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void main (void)</span><br><span class="line">&#123;</span><br><span class="line">/*--------------------------------------</span><br><span class="line">Set serial port for 9600 baud at</span><br><span class="line">11.0592 MHz.  Note that we use Timer 1</span><br><span class="line">for the baud rate generator.</span><br><span class="line">--------------------------------------*/</span><br><span class="line">SCON  = 0x50;</span><br><span class="line">TMOD |= 0x20;</span><br><span class="line">TH1   = 0xFA;</span><br><span class="line">TR1   = 1;</span><br><span class="line">TI    = 1;</span><br><span class="line"></span><br><span class="line">PCON |= 0x80;</span><br><span class="line"></span><br><span class="line">printf (&quot;\r\nCounter 0 Example Program\r\n&quot;);</span><br><span class="line">printf (&quot;\r\nStart toggling P3.4 (T0 input)\r\n\r\n&quot;);</span><br><span class="line"></span><br><span class="line">/*--------------------------------------</span><br><span class="line">Set Timer0 for 16-bit counter mode.</span><br><span class="line">Set the Timer0 Run control bit.</span><br><span class="line">--------------------------------------*/</span><br><span class="line">TMOD = (TMOD &amp; 0xF0) | 0x05;</span><br><span class="line">TR0 = 1;</span><br><span class="line"></span><br><span class="line">/*--------------------------------------</span><br><span class="line">Output the value of the counter.  As you</span><br><span class="line">toggle P3.4, the timer/counter 0 value</span><br><span class="line">will increase.</span><br><span class="line">--------------------------------------*/</span><br><span class="line">while (1)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">if(cnt != TL0)</span><br><span class="line">&#123;</span><br><span class="line"> printf (&quot;\rCounter 0 = %2.2bX%2.2bXh&quot;, TH0, TL0);//Counter 0 = 0000h</span><br><span class="line">led = ! led  ;    //work LED flash</span><br><span class="line">cnt = TL0;</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨äº” 6æœˆ 24 2022</li><li>Processor: AT89C51</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include &lt;reg51.h&gt;<br>#include &lt;stdio.h&gt;<br>static volatile unsigned char cnt&#x3D;0;<br>sbit led &#x3D; P1^0;</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>MAIN C function<br>b,h,læ¥å¯¹è¾“å…¥å­—èŠ‚å®½çš„è®¾ç½®<br>ä¸€ä¸ªå•å­—èŠ‚å˜é‡æ—¶è¦ä½¿ç”¨%bd<br>1.bå…«ä½<br>2.håå…­ä½<br>3.lä¸‰åäºŒä½<br>%dä¸¤ä¸ªå­—èŠ‚å˜é‡int<br>%bdå•å­—èŠ‚å˜é‡char<br>%ldå››å­—èŠ‚å˜é‡long int<br>%x   unsigned int<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void main (void)<br>{<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br>Set serial port for 9600 baud at<br>11.0592 MHz.  Note that we use Timer 1<br>for the baud rate generator.<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</em>&#x2F;<br>SCON  &#x3D; 0x50;<br>TMOD |&#x3D; 0x20;<br>TH1   &#x3D; 0xFA;<br>TR1   &#x3D; 1;<br>TI    &#x3D; 1;</p><p>PCON |&#x3D; 0x80;</p><p>printf (â€œ\r\nCounter 0 Example Program\r\nâ€);<br>printf (â€œ\r\nStart toggling P3.4 (T0 input)\r\n\r\nâ€);</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br>Set Timer0 for 16-bit counter mode.<br>Set the Timer0 Run control bit.<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</em>&#x2F;<br>TMOD &#x3D; (TMOD &amp; 0xF0) | 0x05;<br>TR0 &#x3D; 1;</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br>Output the value of the counter.  As you<br>toggle P3.4, the timer&#x2F;counter 0 value<br>will increase.<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</em>&#x2F;<br>while (1)<br>  {</p><p>if(cnt !&#x3D; TL0)<br>{<br>         printf (â€œ\rCounter 0 &#x3D; %2.2bX%2.2bXhâ€, TH0, TL0);&#x2F;&#x2F;Counter 0 &#x3D; 0000h<br>            led &#x3D; ! led  ;    &#x2F;&#x2F;work LED flash<br>            cnt &#x3D; TL0;<br>}<br>  }<br>}&#96;</p><h4 id="ç¤ºä¾‹ä»£ç å’Œä»¿çœŸèµ„æº"><a href="#ç¤ºä¾‹ä»£ç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¤ºä¾‹ä»£ç å’Œä»¿çœŸèµ„æº"></a>ç¤ºä¾‹ä»£ç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1xNy0uIOxpSA-d-W1rZXWbA </span><br><span class="line">æå–ç ï¼šdiqn</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1xNy0uIOxpSA-d-W1rZXWbA  æå–ç ï¼šdiqn</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨1å¤–éƒ¨è®¡æ•°ä¸­æ–­</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%AE%9A%E6%97%B6%E5%99%A81%E5%A4%96%E9%83%A8%E8%AE%A1%E6%95%B0%E4%B8%AD%E6%96%AD/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%AE%9A%E6%97%B6%E5%99%A81%E5%A4%96%E9%83%A8%E8%AE%A1%E6%95%B0%E4%B8%AD%E6%96%AD/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨1å¤–éƒ¨è®¡æ•°ä¸­æ–­"><a href="#ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨1å¤–éƒ¨è®¡æ•°ä¸­æ–­" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨1å¤–éƒ¨è®¡æ•°ä¸­æ–­"></a>ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨1å¤–éƒ¨è®¡æ•°ä¸­æ–­</h1><h3 id="ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨1å¤–éƒ¨è®¡æ•°ä¸­æ–­-1"><a href="#ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨1å¤–éƒ¨è®¡æ•°ä¸­æ–­-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨1å¤–éƒ¨è®¡æ•°ä¸­æ–­"></a>ã€Proteusä»¿çœŸã€‘å®šæ—¶å™¨1å¤–éƒ¨è®¡æ•°ä¸­æ–­</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/689dfde1400c4996937d0480006c94ea.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¨‹åºä»£ç "><a href="#ç¨‹åºä»£ç " class="headerlink" title="ç¨‹åºä»£ç "></a>ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨ä¸€ 6æœˆ 27 2022</span><br><span class="line"> * Processor: AT89C51</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include&lt;reg52.h&gt; //åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</span><br><span class="line"></span><br><span class="line">sbit LED=P1^2;    //å®šä¹‰LEDç«¯å£</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Init_Timer1(void)</span><br><span class="line">&#123;</span><br><span class="line"> TMOD |= 0x10 | 0x40;  //ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½è®¡æ•°å™¨ï¼Œä½¿ç”¨&quot;|&quot;ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“     </span><br><span class="line"> TH1=0xFF;      //ç»™å®šåˆå€¼</span><br><span class="line"> TL1=252;         //ä»245è®¡æ•°åˆ°255 </span><br><span class="line"> EA=1;            //æ€»ä¸­æ–­æ‰“å¼€</span><br><span class="line"> ET1=1;           //å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€</span><br><span class="line"> TR1=1;           //å®šæ—¶å™¨å¼€å…³æ‰“å¼€</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    ä¸»ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> Init_Timer1();</span><br><span class="line"> while(1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Timer1_isr(void) interrupt 3 </span><br><span class="line">&#123;</span><br><span class="line"> TH1=0xFF;      //é‡æ–°ç»™å®šåˆå€¼</span><br><span class="line"> TL1=252; </span><br><span class="line"> LED=~LED;        //æŒ‡ç¤ºç¯åç›¸ï¼Œå¯ä»¥çœ‹åˆ°é—ªçƒ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨ä¸€ 6æœˆ 27 2022</li><li>Processor: AT89C51</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include&lt;reg52.h&gt; &#x2F;&#x2F;åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</p><p>sbit LED&#x3D;P1^2;    &#x2F;&#x2F;å®šä¹‰LEDç«¯å£</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Init_Timer1(void)<br>{<br> TMOD |&#x3D; 0x10 | 0x40;  &#x2F;&#x2F;ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½è®¡æ•°å™¨ï¼Œä½¿ç”¨â€|â€ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“<br> TH1&#x3D;0xFF;      &#x2F;&#x2F;ç»™å®šåˆå€¼<br> TL1&#x3D;252;         &#x2F;&#x2F;ä»245è®¡æ•°åˆ°255<br> EA&#x3D;1;            &#x2F;&#x2F;æ€»ä¸­æ–­æ‰“å¼€<br> ET1&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€<br> TR1&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨å¼€å…³æ‰“å¼€<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    ä¸»ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void main()<br>{<br> Init_Timer1();<br> while(1);<br>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Timer1_isr(void) interrupt 3<br>{<br> TH1&#x3D;0xFF;      &#x2F;&#x2F;é‡æ–°ç»™å®šåˆå€¼<br> TL1&#x3D;252;<br> LED&#x3D;~LED;        &#x2F;&#x2F;æŒ‡ç¤ºç¯åç›¸ï¼Œå¯ä»¥çœ‹åˆ°é—ªçƒ<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1sp9LLXfxGzN5c7i4JGUqRw </span><br><span class="line">æå–ç ï¼šeinh</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1sp9LLXfxGzN5c7i4JGUqRw  æå–ç ï¼šeinh</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡+4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%95%B0%E7%A0%81%E7%AE%A14x4%E9%94%AE%E7%9B%98%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE%E7%AE%80%E6%98%93%E8%AE%A1%E7%AE%97%E5%99%A8/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%95%B0%E7%A0%81%E7%AE%A14x4%E9%94%AE%E7%9B%98%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE%E7%AE%80%E6%98%93%E8%AE%A1%E7%AE%97%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡-4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨"><a href="#ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡-4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡+4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨"></a>ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡+4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨</h1><h3 id="ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡-4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨-1"><a href="#ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡-4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡+4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨"></a>ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡+4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/1e56bce4ea044fd98e709dfd80b88f6e.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä»¿çœŸå™¨ä»¶"><a href="#ä»¿çœŸå™¨ä»¶" class="headerlink" title="ä»¿çœŸå™¨ä»¶"></a>ä»¿çœŸå™¨ä»¶</h4><ul><li>74HC573æ•°æ®ç¼“å†²å™¨</li><li>8ä½å…±é˜´æ•°ç ç®¡</li></ul><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">/*-----------------------------------------------</span><br><span class="line">4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨</span><br><span class="line">  å†…å®¹ï¼šæ•´æ•°ä¹‹é—´è¿ç®—ï¼Œæ²¡æœ‰å°æ•°æ‰€æœ‰é™¤æ³•å¾—å‡ºçš„ç»“æœä¸æ­£ç¡®ï¼Œæœ‰è´Ÿå·è¿ç®—ï¼Œ</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">#include&lt;reg52.h&gt; //åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</span><br><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&quot;display.h&quot;</span><br><span class="line">#include&quot;delay.h&quot;</span><br><span class="line">#include&quot;keyboard.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    ä¸»ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> unsigned char num,i,sign;                   </span><br><span class="line"> unsigned char temp[8];        //æœ€å¤§è¾“å…¥8ä¸ª</span><br><span class="line"> bit firstflag;</span><br><span class="line"> int a=0,b=0;</span><br><span class="line"> unsigned char s;</span><br><span class="line"></span><br><span class="line"> Init_Timer0();   //åˆå§‹åŒ–å®šæ—¶å™¨0</span><br><span class="line">while (1)         //ä¸»å¾ªç¯</span><br><span class="line">  &#123;</span><br><span class="line"> num=KeyPro();  //æ‰«æé”®ç›˜</span><br><span class="line"> if(num!=0xff)  //å¦‚æœæ‰«ææ˜¯æŒ‰é”®æœ‰æ•ˆå€¼åˆ™è¿›è¡Œå¤„ç†</span><br><span class="line">   &#123; </span><br><span class="line">    if(i==0)    //è¾“å…¥æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æ—¶å€™éœ€è¦æŠŠæ”¹è¡Œæ¸…ç©ºï¼Œæ–¹ä¾¿è§‚çœ‹</span><br><span class="line">  &#123;</span><br><span class="line">  for(s=0;s&lt;8;s++) //èµ‹å€¼å®ŒæˆåæŠŠç¼“å†²åŒºæ¸…é›¶ï¼Œé˜²æ­¢ä¸‹æ¬¡è¾“å…¥å½±å“ç»“æœ</span><br><span class="line">  TempData[s]=0;</span><br><span class="line">  &#125;</span><br><span class="line">if((&#x27;+&#x27;==num)|| (i==8) || (&#x27;-&#x27;==num) || (&#x27;x&#x27;==num)|| (&#x27;/&#x27;==num) || (&#x27;=&#x27;==num))//è¾“å…¥æ•°å­—æœ€å¤§å€¼8ï¼Œè¾“å…¥ç¬¦å·è¡¨ç¤ºè¾“å…¥ç»“æŸ</span><br><span class="line">  &#123;</span><br><span class="line">  i=0;  //è®¡æ•°å™¨å¤ä½</span><br><span class="line"></span><br><span class="line"> if(firstflag==0)  //å¦‚æœæ˜¯è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œèµ‹å€¼ç»™aï¼Œå¹¶æŠŠæ ‡å¿—ä½ç½®1ï¼Œåˆ°ä¸‹ä¸€ä¸ªæ•°æ®è¾“å…¥æ—¶å¯ä»¥è·³è½¬èµ‹å€¼ç»™b</span><br><span class="line">     &#123;</span><br><span class="line">     sscanf(temp,&quot;%d&quot;,&amp;a);//ä»ä¸€ä¸ªå­—ç¬¦ä¸²è¾“å…¥åˆ°å˜é‡</span><br><span class="line">         firstflag=1;</span><br><span class="line"> &#125;</span><br><span class="line">  else  </span><br><span class="line">     sscanf(temp,&quot;%d&quot;,&amp;b);</span><br><span class="line">  for(s=0;s&lt;8;s++) //èµ‹å€¼å®ŒæˆåæŠŠç¼“å†²åŒºæ¸…é›¶ï¼Œé˜²æ­¢ä¸‹æ¬¡è¾“å…¥å½±å“ç»“æœ</span><br><span class="line">    temp[s]=0;</span><br><span class="line">      </span><br><span class="line">  if(num!=&#x27;=&#x27;)      //åˆ¤æ–­å½“å‰ç¬¦å·ä½å¹¶åšç›¸åº”å¤„ç†</span><br><span class="line">     sign=num;      //å¦‚æœä¸æ˜¯ç­‰å·è®°ä¸‹æ ‡å¿—ä½</span><br><span class="line">  else</span><br><span class="line">     &#123;  </span><br><span class="line"> firstflag=0;   //æ£€æµ‹åˆ°è¾“å…¥=å·ï¼Œåˆ¤æ–­ä¸Šæ¬¡è¯»å…¥çš„ç¬¦åˆ</span><br><span class="line">         switch(sign)</span><br><span class="line">       &#123;</span><br><span class="line">    case &#x27;+&#x27;:a=a+b;</span><br><span class="line">break;</span><br><span class="line">case &#x27;-&#x27;:a=a-b;</span><br><span class="line">break;</span><br><span class="line">case &#x27;x&#x27;:a=a*b;</span><br><span class="line">break;</span><br><span class="line">case &#x27;/&#x27;:a=a/b;</span><br><span class="line">break;</span><br><span class="line">default:break;</span><br><span class="line">   &#125;</span><br><span class="line"> sprintf(temp,&quot;%d&quot;,a);  //æ‰“å°åè¿›åˆ¶åˆ°ä¸´æ—¶ç¼“å†²åŒº</span><br><span class="line">  for(s=0;s&lt;8;s++)       //ç”±äºæ‰“å°çš„æ˜¯ASCIIç å€¼</span><br><span class="line">    &#123; </span><br><span class="line">if(temp[s]==0)      //æ‰€ä»¥éœ€è¦è½¬æ¢ï¼Œå¦‚æœä¸º0è¡¨ç¤ºnull æ•°ç ç®¡ä¸Šåˆ™ä¸èƒ½æ˜¾ç¤ºï¼Œæ‰€ä»¥èµ‹å€¼0</span><br><span class="line">                TempData[s]=0;</span><br><span class="line">else if(temp[s]==0x2d)//è¡¨ç¤ºè´Ÿå·ï¼Œæ•°ç ç®¡æ˜¾ç¤ºè´Ÿå· 0x40</span><br><span class="line">     TempData[s]=0x40;</span><br><span class="line">    else </span><br><span class="line">         TempData[s]=dofly_DuanMa[temp[s]-&#x27;0&#x27;];//å…¶ä»–0-9è´Ÿå·åˆ™è¿›è¡ŒASCII åˆ° æ•°å­—å¤„ç†ï¼Œå¦‚å½“å‰æ˜¯&#x27;3&#x27;ï¼Œç”¨&#x27;3&#x27;-&#x27;0&#x27;=3</span><br><span class="line">                                       //&#x27;3&#x27;çš„16è¿›åˆ¶æ˜¯0x33,&#x27;0&#x27;çš„16è¿›åˆ¶æ˜¯0x30     </span><br><span class="line">&#125;</span><br><span class="line"> sign=0;a=b=0;            //ç”¨å®Œåæ‰€æœ‰æ•°æ®æ¸…é›¶</span><br><span class="line"> for(s=0;s&lt;8;s++)</span><br><span class="line">    temp[s]=0;</span><br><span class="line"> &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   elseif(i&lt;16)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">         temp[i]=num+&#x27;0&#x27;; </span><br><span class="line">         TempData[i]=dofly_DuanMa[num];//è¾“å‡ºæ•°æ®</span><br><span class="line">     i++;   //è¾“å…¥æ•°å€¼ç´¯åŠ </span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br>    4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ç®€æ˜“è®¡ç®—å™¨<br>  å†…å®¹ï¼šæ•´æ•°ä¹‹é—´è¿ç®—ï¼Œæ²¡æœ‰å°æ•°æ‰€æœ‰é™¤æ³•å¾—å‡ºçš„ç»“æœä¸æ­£ç¡®ï¼Œæœ‰è´Ÿå·è¿ç®—ï¼Œ<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>#include&lt;reg52.h&gt; &#x2F;&#x2F;åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰<br>#include&lt;stdio.h&gt;<br>#includeâ€display.hâ€<br>#includeâ€delay.hâ€<br>#includeâ€keyboard.hâ€</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    ä¸»ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void main()<br>{<br> unsigned char num,i,sign;<br> unsigned char temp[8];        &#x2F;&#x2F;æœ€å¤§è¾“å…¥8ä¸ª<br> bit firstflag;<br> int a&#x3D;0,b&#x3D;0;<br> unsigned char s;</p><p> Init_Timer0();   &#x2F;&#x2F;åˆå§‹åŒ–å®šæ—¶å™¨0<br>while (1)         &#x2F;&#x2F;ä¸»å¾ªç¯<br>  {<br> num&#x3D;KeyPro();  &#x2F;&#x2F;æ‰«æé”®ç›˜<br> if(num!&#x3D;0xff)  &#x2F;&#x2F;å¦‚æœæ‰«ææ˜¯æŒ‰é”®æœ‰æ•ˆå€¼åˆ™è¿›è¡Œå¤„ç†<br>   {<br>    if(i&#x3D;&#x3D;0)    &#x2F;&#x2F;è¾“å…¥æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æ—¶å€™éœ€è¦æŠŠæ”¹è¡Œæ¸…ç©ºï¼Œæ–¹ä¾¿è§‚çœ‹<br>      {<br>      for(s&#x3D;0;s&lt;8;s++) &#x2F;&#x2F;èµ‹å€¼å®ŒæˆåæŠŠç¼“å†²åŒºæ¸…é›¶ï¼Œé˜²æ­¢ä¸‹æ¬¡è¾“å…¥å½±å“ç»“æœ<br>          TempData[s]&#x3D;0;<br>      }<br>    if((â€˜+â€™&#x3D;&#x3D;num)|| (i&#x3D;&#x3D;8) || (â€˜-â€˜&#x3D;&#x3D;num) || (â€˜xâ€™&#x3D;&#x3D;num)|| (â€˜&#x2F;â€˜&#x3D;&#x3D;num) || (â€˜&#x3D;â€™&#x3D;&#x3D;num))&#x2F;&#x2F;è¾“å…¥æ•°å­—æœ€å¤§å€¼8ï¼Œè¾“å…¥ç¬¦å·è¡¨ç¤ºè¾“å…¥ç»“æŸ<br>      {<br>      i&#x3D;0;  &#x2F;&#x2F;è®¡æ•°å™¨å¤ä½</p><pre><code> if(firstflag==0)  //å¦‚æœæ˜¯è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œèµ‹å€¼ç»™aï¼Œå¹¶æŠŠæ ‡å¿—ä½ç½®1ï¼Œåˆ°ä¸‹ä¸€ä¸ªæ•°æ®è¾“å…¥æ—¶å¯ä»¥è·³è½¬èµ‹å€¼ç»™b     &#123;     sscanf(temp,&quot;%d&quot;,&amp;a);//ä»ä¸€ä¸ªå­—ç¬¦ä¸²è¾“å…¥åˆ°å˜é‡     firstflag=1;     &#125;  else       sscanf(temp,&quot;%d&quot;,&amp;b);  for(s=0;s&lt;8;s++) //èµ‹å€¼å®ŒæˆåæŠŠç¼“å†²åŒºæ¸…é›¶ï¼Œé˜²æ­¢ä¸‹æ¬¡è¾“å…¥å½±å“ç»“æœ        temp[s]=0;    if(num!=&#39;=&#39;)      //åˆ¤æ–­å½“å‰ç¬¦å·ä½å¹¶åšç›¸åº”å¤„ç†     sign=num;      //å¦‚æœä¸æ˜¯ç­‰å·è®°ä¸‹æ ‡å¿—ä½  else     &#123;       firstflag=0;   //æ£€æµ‹åˆ°è¾“å…¥=å·ï¼Œåˆ¤æ–­ä¸Šæ¬¡è¯»å…¥çš„ç¬¦åˆ     switch(sign)       &#123;        case &#39;+&#39;:a=a+b;        break;        case &#39;-&#39;:a=a-b;        break;        case &#39;x&#39;:a=a*b;        break;        case &#39;/&#39;:a=a/b;        break;        default:break;       &#125;     sprintf(temp,&quot;%d&quot;,a);  //æ‰“å°åè¿›åˆ¶åˆ°ä¸´æ—¶ç¼“å†²åŒº      for(s=0;s&lt;8;s++)       //ç”±äºæ‰“å°çš„æ˜¯ASCIIç å€¼        &#123;         if(temp[s]==0)      //æ‰€ä»¥éœ€è¦è½¬æ¢ï¼Œå¦‚æœä¸º0è¡¨ç¤ºnull æ•°ç ç®¡ä¸Šåˆ™ä¸èƒ½æ˜¾ç¤ºï¼Œæ‰€ä»¥èµ‹å€¼0            TempData[s]=0;        else if(temp[s]==0x2d)//è¡¨ç¤ºè´Ÿå·ï¼Œæ•°ç ç®¡æ˜¾ç¤ºè´Ÿå· 0x40             TempData[s]=0x40;    else              TempData[s]=dofly_DuanMa[temp[s]-&#39;0&#39;];//å…¶ä»–0-9è´Ÿå·åˆ™è¿›è¡ŒASCII åˆ° æ•°å­—å¤„ç†ï¼Œå¦‚å½“å‰æ˜¯&#39;3&#39;ï¼Œç”¨&#39;3&#39;-&#39;0&#39;=3                                                   //&#39;3&#39;çš„16è¿›åˆ¶æ˜¯0x33,&#39;0&#39;çš„16è¿›åˆ¶æ˜¯0x30             &#125;     sign=0;a=b=0;            //ç”¨å®Œåæ‰€æœ‰æ•°æ®æ¸…é›¶     for(s=0;s&lt;8;s++)        temp[s]=0;     &#125;  &#125;</code></pre><p>   elseif(i&lt;16)<br>      {</p><pre><code>     temp[i]=num+&#39;0&#39;;      TempData[i]=dofly_DuanMa[num];//è¾“å‡ºæ•°æ®     i++;   //è¾“å…¥æ•°å€¼ç´¯åŠ    &#125;&#125;</code></pre><p>  }<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1GUj3y7ChSbSJMaSFNhp4cQ </span><br><span class="line">æå–ç ï¼š3p1t</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1GUj3y7ChSbSJMaSFNhp4cQ  æå–ç ï¼š3p1t</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡é€’åŠ /é€’å‡å¸¦é—ªçƒæ¶ˆéšæ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%95%B0%E7%A0%81%E7%AE%A1%E9%80%92%E5%8A%A0%E9%80%92%E5%87%8F%E5%B8%A6%E9%97%AA%E7%83%81%E6%B6%88%E9%9A%90%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%95%B0%E7%A0%81%E7%AE%A1%E9%80%92%E5%8A%A0%E9%80%92%E5%87%8F%E5%B8%A6%E9%97%AA%E7%83%81%E6%B6%88%E9%9A%90%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡é€’åŠ -é€’å‡å¸¦é—ªçƒæ¶ˆéšæ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡é€’åŠ -é€’å‡å¸¦é—ªçƒæ¶ˆéšæ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡é€’åŠ &#x2F;é€’å‡å¸¦é—ªçƒæ¶ˆéšæ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡é€’åŠ &#x2F;é€’å‡å¸¦é—ªçƒæ¶ˆéšæ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡é€’åŠ -é€’å‡å¸¦é—ªçƒæ¶ˆéšæ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡é€’åŠ -é€’å‡å¸¦é—ªçƒæ¶ˆéšæ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡é€’åŠ &#x2F;é€’å‡å¸¦é—ªçƒæ¶ˆéšæ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘æ•°ç ç®¡é€’åŠ &#x2F;é€’å‡å¸¦é—ªçƒæ¶ˆéšæ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/f12ed9caa6df4ceb95583df3f45188a4.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ•°ç ç®¡ä¸€æ®µé€’å¢æ˜¾ç¤ºï¼Œå¦ä¸€ç«¯é€’å‡æ˜¾ç¤ºï¼Œä¸­é—´ä¸¤æ®µé—ªçƒã€‚</p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">/*-----------------------------------------------</span><br><span class="line">  åç§°ï¼šå¤šä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®</span><br><span class="line">  å†…å®¹ï¼šå¤šä½æ•°ç ç®¡åˆ†åˆ«æ˜¾ç¤ºä¸åŒæ•°å­—ï¼Œè¿™ç§æ‰«ææ˜¾ç¤ºæ–¹å¼æˆä¸ºåŠ¨æ€æ‰«æï¼Œå¹¶ä¸åœå˜åŒ–èµ‹å€¼</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">#include&lt;reg52.h&gt; //åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</span><br><span class="line"></span><br><span class="line">#define DataPort P0 //å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢</span><br><span class="line">sbit LATCH1=P2^2;//å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜</span><br><span class="line">sbit LATCH2=P2^3;//                 ä½é”å­˜</span><br><span class="line"></span><br><span class="line">unsigned char code DuanMa[10]=&#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f&#125;;// æ˜¾ç¤ºæ®µç å€¼0~9</span><br><span class="line">unsigned char code WeiMa[]=&#123;0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f&#125;;//åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç </span><br><span class="line">unsigned char TempData[8]; //å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡</span><br><span class="line">void Delay(unsigned int t); //å‡½æ•°å£°æ˜</span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num);</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    ä¸»å‡½æ•°</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> unsigned int numA=999,numB=0;</span><br><span class="line"> unsigned int j;</span><br><span class="line"> bit FlashFlag;</span><br><span class="line"> while(1)</span><br><span class="line">      &#123;</span><br><span class="line">   j++;</span><br><span class="line">   if(j==20)  //æ£€æµ‹å½“å‰æ•°å€¼æ˜¾ç¤ºäº†ä¸€å°æ®µæ—¶é—´åï¼Œ</span><br><span class="line">              //éœ€è¦æ˜¾ç¤ºçš„æ•°å€¼ï¼Œå®ç°æ•°æ®æ˜¾ç¤ºçš„å˜åŒ–</span><br><span class="line">     &#123;</span><br><span class="line">  j=0;</span><br><span class="line">  FlashFlag=!FlashFlag;</span><br><span class="line">  numB++;</span><br><span class="line">  if(numA&gt;0)//ç”¨äºæ˜¾ç¤º0~999</span><br><span class="line">    numA--;</span><br><span class="line">  else</span><br><span class="line">    numA=999;</span><br><span class="line">          if(numB==1000)</span><br><span class="line">    numB=0;</span><br><span class="line"> &#125;</span><br><span class="line">   //é€’å‡çš„ä¸‰ä½æ•°ç ç®¡ï¼Œå¸¦æ¶ˆéš</span><br><span class="line">       //åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œå¦‚è¦æ˜¾ç¤º68ï¼Œåˆ™68/10=6  68%10=8  </span><br><span class="line">    TempData[0] = DuanMa[numA/100];</span><br><span class="line">     TempData[1] = DuanMa[(numA%100)/10];</span><br><span class="line">     TempData[2] = DuanMa[(numA%100)%10];</span><br><span class="line">       //ä¸­é—´2ä½æ•°ç ç®¡ä¸æ˜¾ç¤ºï¼Œèµ‹å€¼0</span><br><span class="line">  if(FlashFlag)</span><br><span class="line">    &#123;</span><br><span class="line">         TempData[3]=0x40; //æ˜¾ç¤º&quot;-&quot;</span><br><span class="line">     TempData[4]=0x40; </span><br><span class="line"> &#125;</span><br><span class="line">  else</span><br><span class="line">    &#123;</span><br><span class="line">     TempData[3]=0; </span><br><span class="line">     TempData[4]=0; </span><br><span class="line">    &#125;</span><br><span class="line">       //é€’å¢çš„ä¸‰ä½æ•°ç ç®¡ï¼Œå¸¦æ¶ˆéš</span><br><span class="line">   //åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œå¦‚è¦æ˜¾ç¤º68ï¼Œåˆ™68/10=6  68%10=8</span><br><span class="line">    TempData[5]= DuanMa[numB/100];  </span><br><span class="line">     TempData[6]= DuanMa[(numB%100)/10];</span><br><span class="line">     TempData[7]= DuanMa[(numB%100)%10];</span><br><span class="line"></span><br><span class="line">   Display(0,8);//ä»ç¬¬ä¸€ä½æ˜¾ç¤ºï¼Œå…±æ˜¾ç¤º8ä½</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> å»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned int tï¼Œæ— è¿”å›å€¼</span><br><span class="line"> unsigned int æ˜¯å®šä¹‰æ— ç¬¦å·æ•´å½¢å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯</span><br><span class="line"> 0~65535</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Delay(unsigned int t)</span><br><span class="line">&#123;</span><br><span class="line"> while(--t);</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡</span><br><span class="line"> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤ºä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º</span><br><span class="line"> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚</span><br><span class="line"> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num)</span><br><span class="line">&#123;</span><br><span class="line">      unsigned char i;</span><br><span class="line">  </span><br><span class="line">  for(i=0;i&lt;Num;i++)</span><br><span class="line">   &#123; </span><br><span class="line">   DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±</span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line"></span><br><span class="line">       DataPort= WeiMa[i+FirstBit]; //å–ä½ç  </span><br><span class="line">       LATCH2=1;     //ä½é”å­˜</span><br><span class="line">       LATCH2=0;</span><br><span class="line"></span><br><span class="line">       DataPort=TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç </span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line">       </span><br><span class="line">   Delay(200); // æ‰«æé—´éš™å»¶æ—¶ï¼Œæ—¶é—´å¤ªé•¿ä¼šé—ªçƒï¼Œå¤ªçŸ­ä¼šé€ æˆé‡å½±</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br>  åç§°ï¼šå¤šä½æ•°ç ç®¡åŠ¨æ€æ‰«ææ˜¾ç¤ºå˜åŒ–æ•°æ®<br>  å†…å®¹ï¼šå¤šä½æ•°ç ç®¡åˆ†åˆ«æ˜¾ç¤ºä¸åŒæ•°å­—ï¼Œè¿™ç§æ‰«ææ˜¾ç¤ºæ–¹å¼æˆä¸ºåŠ¨æ€æ‰«æï¼Œå¹¶ä¸åœå˜åŒ–èµ‹å€¼<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>#include&lt;reg52.h&gt; &#x2F;&#x2F;åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</p><p>#define DataPort P0 &#x2F;&#x2F;å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢<br>sbit LATCH1&#x3D;P2^2;&#x2F;&#x2F;å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜<br>sbit LATCH2&#x3D;P2^3;&#x2F;&#x2F;                 ä½é”å­˜</p><p>unsigned char code DuanMa[10]&#x3D;{0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};&#x2F;&#x2F; æ˜¾ç¤ºæ®µç å€¼0<del>9<br>unsigned char code WeiMa[]&#x3D;{0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};&#x2F;&#x2F;åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç <br>unsigned char TempData[8]; &#x2F;&#x2F;å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡<br>void Delay(unsigned int t); &#x2F;&#x2F;å‡½æ•°å£°æ˜<br>void Display(unsigned char FirstBit,unsigned char Num);<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    ä¸»å‡½æ•°<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void main()<br>{<br> unsigned int numA&#x3D;999,numB&#x3D;0;<br> unsigned int j;<br> bit FlashFlag;<br> while(1)<br>      {<br>       j++;<br>       if(j&#x3D;&#x3D;20)  &#x2F;&#x2F;æ£€æµ‹å½“å‰æ•°å€¼æ˜¾ç¤ºäº†ä¸€å°æ®µæ—¶é—´åï¼Œ<br>              &#x2F;&#x2F;éœ€è¦æ˜¾ç¤ºçš„æ•°å€¼ï¼Œå®ç°æ•°æ®æ˜¾ç¤ºçš„å˜åŒ–<br>         {<br>          j&#x3D;0;<br>          FlashFlag&#x3D;!FlashFlag;<br>          numB++;<br>          if(numA&gt;0)&#x2F;&#x2F;ç”¨äºæ˜¾ç¤º0</del>999<br>            numAâ€“;<br>          else<br>            numA&#x3D;999;<br>          if(numB&#x3D;&#x3D;1000)<br>            numB&#x3D;0;<br>         }<br>       &#x2F;&#x2F;é€’å‡çš„ä¸‰ä½æ•°ç ç®¡ï¼Œå¸¦æ¶ˆéš<br>       &#x2F;&#x2F;åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œå¦‚è¦æ˜¾ç¤º68ï¼Œåˆ™68&#x2F;10&#x3D;6  68%10&#x3D;8<br>        TempData[0] &#x3D; DuanMa[numA&#x2F;100];<br>         TempData[1] &#x3D; DuanMa[(numA%100)&#x2F;10];<br>         TempData[2] &#x3D; DuanMa[(numA%100)%10];<br>       &#x2F;&#x2F;ä¸­é—´2ä½æ•°ç ç®¡ä¸æ˜¾ç¤ºï¼Œèµ‹å€¼0<br>      if(FlashFlag)<br>        {<br>         TempData[3]&#x3D;0x40; &#x2F;&#x2F;æ˜¾ç¤ºâ€-â€œ<br>         TempData[4]&#x3D;0x40;<br>         }<br>      else<br>        {<br>         TempData[3]&#x3D;0;<br>         TempData[4]&#x3D;0;<br>        }<br>       &#x2F;&#x2F;é€’å¢çš„ä¸‰ä½æ•°ç ç®¡ï¼Œå¸¦æ¶ˆéš<br>       &#x2F;&#x2F;åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œå¦‚è¦æ˜¾ç¤º68ï¼Œåˆ™68&#x2F;10&#x3D;6  68%10&#x3D;8<br>        TempData[5]&#x3D; DuanMa[numB&#x2F;100];<br>         TempData[6]&#x3D; DuanMa[(numB%100)&#x2F;10];<br>         TempData[7]&#x3D; DuanMa[(numB%100)%10];</p><pre><code>   Display(0,8);//ä»ç¬¬ä¸€ä½æ˜¾ç¤ºï¼Œå…±æ˜¾ç¤º8ä½  &#125;</code></pre><p>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> å»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned int tï¼Œæ— è¿”å›å€¼<br> unsigned int æ˜¯å®šä¹‰æ— ç¬¦å·æ•´å½¢å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯<br> 0~65535<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Delay(unsigned int t)<br>{<br> while(â€“t);<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡<br> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤ºä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º<br> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚<br> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Display(unsigned char FirstBit,unsigned char Num)<br>{<br>      unsigned char i;</p><pre><code>  for(i=0;i&lt;Num;i++)   &#123;    DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±   LATCH1=1;     //æ®µé”å­˜   LATCH1=0;   DataPort= WeiMa[i+FirstBit]; //å–ä½ç     LATCH2=1;     //ä½é”å­˜   LATCH2=0;   DataPort=TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç    LATCH1=1;     //æ®µé”å­˜   LATCH1=0;      Delay(200); // æ‰«æé—´éš™å»¶æ—¶ï¼Œæ—¶é—´å¤ªé•¿ä¼šé—ªçƒï¼Œå¤ªçŸ­ä¼šé€ æˆé‡å½±   &#125;</code></pre><p>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚å¯ä»¥åŸºäºVSM Studioç‹¬ç«‹ä»¿çœŸï¼Œä¸ä¾èµ–Keilå·¥ç¨‹ç¼–è¯‘çš„hexæ–‡ä»¶ã€‚</p><p><code>Proteus8.12</code></p><p><code>VSM Studio</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1kpJpGytctmI1n7jNZK5rsQ </span><br><span class="line">æå–ç ï¼šyy90</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1kpJpGytctmI1n7jNZK5rsQ  æå–ç ï¼šyy90</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘æ­¥è¿›ç”µæœºè½¬é€Ÿæ•°ç ç®¡æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E8%BD%AC%E9%80%9F%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E8%BD%AC%E9%80%9F%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘æ­¥è¿›ç”µæœºè½¬é€Ÿæ•°ç ç®¡æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘æ­¥è¿›ç”µæœºè½¬é€Ÿæ•°ç ç®¡æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æ­¥è¿›ç”µæœºè½¬é€Ÿæ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘æ­¥è¿›ç”µæœºè½¬é€Ÿæ•°ç ç®¡æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘æ­¥è¿›ç”µæœºè½¬é€Ÿæ•°ç ç®¡æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘æ­¥è¿›ç”µæœºè½¬é€Ÿæ•°ç ç®¡æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘æ­¥è¿›ç”µæœºè½¬é€Ÿæ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘æ­¥è¿›ç”µæœºè½¬é€Ÿæ•°ç ç®¡æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/714d62cca1814549a6f0a802c8c9bb1e.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é‡‡ç”¨4ç›¸8æ‹,æ•°ç ç®¡æ˜¾ç¤º 40-90é€Ÿåº¦ç­‰çº§ï¼Œæ•°å­—è¶Šå¤§ï¼Œé€Ÿåº¦è¶Šæ…¢ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨äºŒ 6æœˆ 28 2022</span><br><span class="line"> * Processor: AT89C51</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line">/*-----------------------------------------------</span><br><span class="line">  åç§°ï¼šæ­¥è¿›ç”µæœº</span><br><span class="line">  å†…å®¹ï¼šæœ¬ç¨‹åºç”¨äºæµ‹è¯•4ç›¸æ­¥è¿›ç”µæœºå¸¸è§„é©±åŠ¨ </span><br><span class="line">        ä½¿ç”¨1-2ç›¸åŠ±ç£</span><br><span class="line">        1-2ç›¸æ¿€åŠ±åŠŸç‡å¢å€ï¼Œæ­¥è¿›è§’åº¦å‡åŠï¼ŒæŠ–åŠ¨å‡å°‘</span><br><span class="line">        é¡ºåºå¦‚ä¸‹ a-ab-b-bc-c-cd-d-da   åˆç§°4ç›¸8æ‹</span><br><span class="line">æ•°ç ç®¡æ˜¾ç¤º 40-90é€Ÿåº¦ç­‰çº§ï¼Œæ•°å­—è¶Šå¤§ï¼Œé€Ÿåº¦è¶Šæ…¢</span><br><span class="line"> ------------------------------------------------*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">typedef unsigned char   uchar;</span><br><span class="line">typedef unsigned int    uint;</span><br><span class="line">#define DataPort P0 //å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢</span><br><span class="line">#define out_port  (P1)</span><br><span class="line">sbit LATCH1=P2^2;//å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜</span><br><span class="line">sbit LATCH2=P2^3;//                 ä½é”å­˜</span><br><span class="line">uchar const sequence[8] = &#123;0x02,0x06,0x04,0x0c,0x08,0x09,0x01,0x03&#125;;</span><br><span class="line">unsigned char code  DuanMa[10]=&#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f&#125;;// æ˜¾ç¤ºæ®µç å€¼0~9</span><br><span class="line">unsigned char code  WeiMa[]=&#123;0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f&#125;;//åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç </span><br><span class="line">unsigned char TempData[8]; //å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡</span><br><span class="line"></span><br><span class="line">sbit A1=P1^0; //å®šä¹‰æ­¥è¿›ç”µæœºè¿æ¥ç«¯å£</span><br><span class="line">sbit B1=P1^1;</span><br><span class="line">sbit C1=P1^2;</span><br><span class="line">sbit D1=P1^3;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unsigned char Speed;</span><br><span class="line"></span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num);</span><br><span class="line">void Init_Timer0(void);</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> mSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼</span><br><span class="line"> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯</span><br><span class="line"> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void DelayMs(uint j)</span><br><span class="line">&#123;</span><br><span class="line">uchar i;</span><br><span class="line">   for(; j&gt;0; j--)</span><br><span class="line">    &#123; i = 120;</span><br><span class="line">      while (i--);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    ä¸»å‡½æ•°</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void main()</span><br><span class="line">&#123;uchar i;</span><br><span class="line"> Init_Timer0();</span><br><span class="line"> EA=1;          //å…¨å±€ä¸­æ–­å¼€</span><br><span class="line"> EX0=1;         //å¤–éƒ¨ä¸­æ–­0å¼€</span><br><span class="line"> IT0=1;         //1è¡¨ç¤ºè¾¹æ²¿è§¦å‘</span><br><span class="line"></span><br><span class="line"> Speed=40;</span><br><span class="line"> TempData[0]= DuanMa[Speed/10];//åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œå¦‚è¦æ˜¾ç¤º68ï¼Œ </span><br><span class="line"> TempData[1]= DuanMa[Speed%10];//åˆ™68/10=6  68%10=8 </span><br><span class="line">  out_port = 0x03;</span><br><span class="line">   while(1)</span><br><span class="line">    &#123; </span><br><span class="line">i = i&lt;8 ? i+1 : 0;</span><br><span class="line">     out_port = sequence[i];    </span><br><span class="line">     DelayMs(Speed);         //æ”¹å˜è¿™ä¸ªå‚æ•°å¯ä»¥è°ƒæ•´ç”µæœºè½¬é€Ÿ ,</span><br><span class="line">                             //æ•°å­—è¶Šå°ï¼Œè½¬é€Ÿè¶Šå¤§,åŠ›çŸ©è¶Šå°</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                 å¤–éƒ¨ä¸­æ–­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void ISR_INT0(void) interrupt 0 </span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line"> if(!INT0)</span><br><span class="line">   &#123;</span><br><span class="line">   DelayMs(10);//åœ¨æ­¤å¤„å¯ä»¥æ·»åŠ å»æŠ–åŠ¨ç¨‹åºï¼Œé˜²æ­¢æŒ‰é”®æŠ–åŠ¨é€ æˆé”™è¯¯</span><br><span class="line">   if(!INT0)</span><br><span class="line">   //while(!INT1);//ç­‰å¾…æŒ‰é”®é‡Šæ”¾</span><br><span class="line">     &#123;</span><br><span class="line">     Speed +=10;   </span><br><span class="line"> if(Speed==100)</span><br><span class="line">   Speed=40;</span><br><span class="line">    TempData[0]= DuanMa[Speed/10];//åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œå¦‚è¦æ˜¾ç¤º68ï¼Œ  </span><br><span class="line"> TempData[1]= DuanMa[Speed%10];//åˆ™68/10=6  68%10=8</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡</span><br><span class="line"> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤ºä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º</span><br><span class="line"> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚</span><br><span class="line"> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num)</span><br><span class="line">&#123;</span><br><span class="line">      static unsigned char i=0;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">   DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±</span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line"></span><br><span class="line">       DataPort= WeiMa[i+FirstBit]; //å–ä½ç  </span><br><span class="line">       LATCH2=1;     //ä½é”å­˜</span><br><span class="line">       LATCH2=0;</span><br><span class="line"></span><br><span class="line">       DataPort=TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç </span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line">       </span><br><span class="line">   i++;</span><br><span class="line">       if(i==Num)</span><br><span class="line">      i=0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Init_Timer0(void)</span><br><span class="line">&#123;</span><br><span class="line"> TMOD |= 0x01;  //ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½å®šæ—¶å™¨ï¼Œä½¿ç”¨&quot;|&quot;ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“     </span><br><span class="line"> //TH0=0x00;      //ç»™å®šåˆå€¼</span><br><span class="line"> //TL0=0x00;</span><br><span class="line"> EA=1;            //æ€»ä¸­æ–­æ‰“å¼€</span><br><span class="line"> ET0=1;           //å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€</span><br><span class="line"> TR0=1;           //å®šæ—¶å™¨å¼€å…³æ‰“å¼€</span><br><span class="line"> PT0=1;           //ä¼˜å…ˆçº§æ‰“å¼€</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Timer0_isr(void) interrupt 1 </span><br><span class="line">&#123;</span><br><span class="line"> TH0=(65536-2000)/256;  //é‡æ–°èµ‹å€¼ 2ms</span><br><span class="line"> TL0=(65536-2000)%256;</span><br><span class="line"> </span><br><span class="line"> Display(0,8);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨äºŒ 6æœˆ 28 2022</li><li>Processor: AT89C51</li><li>Compiler:  Keil for 8051<br> <em>&#x2F;<br>&#x2F;</em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</li></ul><p>  åç§°ï¼šæ­¥è¿›ç”µæœº<br>  å†…å®¹ï¼šæœ¬ç¨‹åºç”¨äºæµ‹è¯•4ç›¸æ­¥è¿›ç”µæœºå¸¸è§„é©±åŠ¨<br>        ä½¿ç”¨1-2ç›¸åŠ±ç£<br>        1-2ç›¸æ¿€åŠ±åŠŸç‡å¢å€ï¼Œæ­¥è¿›è§’åº¦å‡åŠï¼ŒæŠ–åŠ¨å‡å°‘<br>        é¡ºåºå¦‚ä¸‹ a-ab-b-bc-c-cd-d-da   åˆç§°4ç›¸8æ‹<br>        æ•°ç ç®¡æ˜¾ç¤º 40-90é€Ÿåº¦ç­‰çº§ï¼Œæ•°å­—è¶Šå¤§ï¼Œé€Ÿåº¦è¶Šæ…¢<br> â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*&#x2F;</p><p>#include &lt;reg52.h&gt;<br>typedef unsigned char   uchar;<br>typedef unsigned int    uint;<br>#define DataPort P0 &#x2F;&#x2F;å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢<br>#define out_port  (P1)<br>sbit LATCH1&#x3D;P2^2;&#x2F;&#x2F;å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜<br>sbit LATCH2&#x3D;P2^3;&#x2F;&#x2F;                 ä½é”å­˜<br>uchar const sequence[8] &#x3D; {0x02,0x06,0x04,0x0c,0x08,0x09,0x01,0x03};<br>unsigned char code  DuanMa[10]&#x3D;{0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};&#x2F;&#x2F; æ˜¾ç¤ºæ®µç å€¼0~9<br>unsigned char code  WeiMa[]&#x3D;{0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};&#x2F;&#x2F;åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç <br>unsigned char TempData[8]; &#x2F;&#x2F;å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡</p><p>sbit A1&#x3D;P1^0; &#x2F;&#x2F;å®šä¹‰æ­¥è¿›ç”µæœºè¿æ¥ç«¯å£<br>sbit B1&#x3D;P1^1;<br>sbit C1&#x3D;P1^2;<br>sbit D1&#x3D;P1^3;</p><p>unsigned char Speed;</p><p>void Display(unsigned char FirstBit,unsigned char Num);<br>void Init_Timer0(void);</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> mSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼<br> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯<br> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void DelayMs(uint j)<br>{<br>    uchar i;<br>   for(; j&gt;0; jâ€“)<br>    { i &#x3D; 120;<br>      while (iâ€“);<br>    }<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    ä¸»å‡½æ•°<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void main()<br>{uchar i;<br> Init_Timer0();<br> EA&#x3D;1;          &#x2F;&#x2F;å…¨å±€ä¸­æ–­å¼€<br> EX0&#x3D;1;         &#x2F;&#x2F;å¤–éƒ¨ä¸­æ–­0å¼€<br> IT0&#x3D;1;         &#x2F;&#x2F;1è¡¨ç¤ºè¾¹æ²¿è§¦å‘</p><p> Speed&#x3D;40;<br> TempData[0]&#x3D; DuanMa[Speed&#x2F;10];&#x2F;&#x2F;åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œå¦‚è¦æ˜¾ç¤º68ï¼Œ<br> TempData[1]&#x3D; DuanMa[Speed%10];&#x2F;&#x2F;åˆ™68&#x2F;10&#x3D;6  68%10&#x3D;8<br>  out_port &#x3D; 0x03;<br>   while(1)<br>    {<br>    i &#x3D; i&lt;8 ? i+1 : 0;<br>     out_port &#x3D; sequence[i];<br>     DelayMs(Speed);         &#x2F;&#x2F;æ”¹å˜è¿™ä¸ªå‚æ•°å¯ä»¥è°ƒæ•´ç”µæœºè½¬é€Ÿ ,<br>                             &#x2F;&#x2F;æ•°å­—è¶Šå°ï¼Œè½¬é€Ÿè¶Šå¤§,åŠ›çŸ©è¶Šå°<br>  }<br>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                 å¤–éƒ¨ä¸­æ–­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void ISR_INT0(void) interrupt 0<br>{</p><p> if(!INT0)<br>   {<br>   DelayMs(10);&#x2F;&#x2F;åœ¨æ­¤å¤„å¯ä»¥æ·»åŠ å»æŠ–åŠ¨ç¨‹åºï¼Œé˜²æ­¢æŒ‰é”®æŠ–åŠ¨é€ æˆé”™è¯¯<br>   if(!INT0)<br>   &#x2F;&#x2F;while(!INT1);&#x2F;&#x2F;ç­‰å¾…æŒ‰é”®é‡Šæ”¾<br>     {<br>     Speed +&#x3D;10;<br>     if(Speed&#x3D;&#x3D;100)<br>       Speed&#x3D;40;<br>        TempData[0]&#x3D; DuanMa[Speed&#x2F;10];&#x2F;&#x2F;åˆ†è§£æ˜¾ç¤ºä¿¡æ¯ï¼Œå¦‚è¦æ˜¾ç¤º68ï¼Œ<br>     TempData[1]&#x3D; DuanMa[Speed%10];&#x2F;&#x2F;åˆ™68&#x2F;10&#x3D;6  68%10&#x3D;8<br>     }<br>   }<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡<br> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤ºä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º<br> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚<br> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Display(unsigned char FirstBit,unsigned char Num)<br>{<br>      static unsigned char i&#x3D;0;</p><pre><code>   DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±   LATCH1=1;     //æ®µé”å­˜   LATCH1=0;   DataPort= WeiMa[i+FirstBit]; //å–ä½ç     LATCH2=1;     //ä½é”å­˜   LATCH2=0;   DataPort=TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç    LATCH1=1;     //æ®µé”å­˜   LATCH1=0;      i++;   if(i==Num)      i=0;</code></pre><p>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Init_Timer0(void)<br>{<br> TMOD |&#x3D; 0x01;  &#x2F;&#x2F;ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½å®šæ—¶å™¨ï¼Œä½¿ç”¨â€|â€ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“<br> &#x2F;&#x2F;TH0&#x3D;0x00;      &#x2F;&#x2F;ç»™å®šåˆå€¼<br> &#x2F;&#x2F;TL0&#x3D;0x00;<br> EA&#x3D;1;            &#x2F;&#x2F;æ€»ä¸­æ–­æ‰“å¼€<br> ET0&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€<br> TR0&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨å¼€å…³æ‰“å¼€<br> PT0&#x3D;1;           &#x2F;&#x2F;ä¼˜å…ˆçº§æ‰“å¼€<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Timer0_isr(void) interrupt 1<br>{<br> TH0&#x3D;(65536-2000)&#x2F;256;  &#x2F;&#x2F;é‡æ–°èµ‹å€¼ 2ms<br> TL0&#x3D;(65536-2000)%256;</p><p> Display(0,8);</p><p>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1weDjea_J5ZyeEZ4IbRBP9Q </span><br><span class="line">æå–ç ï¼š24d3</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1weDjea_J5ZyeEZ4IbRBP9Q  æå–ç ï¼š24d3</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘ç›´æµç”µæœºæ–¹å‘å’Œé€Ÿåº¦æŒ‰é”®æ§åˆ¶</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%96%B9%E5%90%91%E5%92%8C%E9%80%9F%E5%BA%A6%E6%8C%89%E9%94%AE%E6%8E%A7%E5%88%B6/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BA%E6%96%B9%E5%90%91%E5%92%8C%E9%80%9F%E5%BA%A6%E6%8C%89%E9%94%AE%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘ç›´æµç”µæœºæ–¹å‘å’Œé€Ÿåº¦æŒ‰é”®æ§åˆ¶"><a href="#ã€Proteusä»¿çœŸã€‘ç›´æµç”µæœºæ–¹å‘å’Œé€Ÿåº¦æŒ‰é”®æ§åˆ¶" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ç›´æµç”µæœºæ–¹å‘å’Œé€Ÿåº¦æŒ‰é”®æ§åˆ¶"></a>ã€Proteusä»¿çœŸã€‘ç›´æµç”µæœºæ–¹å‘å’Œé€Ÿåº¦æŒ‰é”®æ§åˆ¶</h1><h3 id="ã€Proteusä»¿çœŸã€‘ç›´æµç”µæœºæ–¹å‘å’Œé€Ÿåº¦æŒ‰é”®æ§åˆ¶-1"><a href="#ã€Proteusä»¿çœŸã€‘ç›´æµç”µæœºæ–¹å‘å’Œé€Ÿåº¦æŒ‰é”®æ§åˆ¶-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ç›´æµç”µæœºæ–¹å‘å’Œé€Ÿåº¦æŒ‰é”®æ§åˆ¶"></a>ã€Proteusä»¿çœŸã€‘ç›´æµç”µæœºæ–¹å‘å’Œé€Ÿåº¦æŒ‰é”®æ§åˆ¶</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/3383bc098acf4c49beb438c31912354e.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">//*************************************************************************************************</span><br><span class="line">//*************************************************************************************************</span><br><span class="line">//**&lt;ç¨‹åºå&gt;ï¼šé”®ç›˜æ§åˆ¶ç›´æµç”µæœºè¿è½¬ã€‚  **</span><br><span class="line">//**&lt;åŠŸèƒ½&gt;ï¼šé€šè¿‡æŒ‰é”®æ§åˆ¶ç›´æµç”µæœºè¿è½¬å¹¶åœ¨LCDä¸Šæ˜¾ç¤ºè¿è¡ŒçŠ¶æ€ã€‚ **</span><br><span class="line">//*************************************************************************************************</span><br><span class="line">//*************************************************************************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#include &quot;includes.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#define TIME0H 0xFF</span><br><span class="line">#define TIME0L 0x9C//å®šæ—¶å™¨0æº¢å‡ºæ—¶é—´ï¼š0.1ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#define TIME1H 0x3C</span><br><span class="line">#define TIME1L 0xB0//å®šæ—¶å™¨1æº¢å‡ºæ—¶é—´ï¼š50ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;PWMè°ƒåˆ¶è®¡æ•°&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">unsigned char uc_MoCount=0;</span><br><span class="line">unsigned char uc_MoChange=128;</span><br><span class="line"></span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;é˜²æŠ–åŠ¨æ ‡å¿—&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">bit b_KeyShock=0;  //é”®ç›˜é˜²æŠ–åŠ¨æ ‡å¿—ä½ã€‚</span><br><span class="line">//å½“æŒ‰é”®ä¸­æ–­äº§ç”Ÿæ—¶ï¼Œé¦–å…ˆåˆ¤æ–­æ­¤ä½ã€‚</span><br><span class="line">//0--æ‰§è¡Œé”®ç›˜æ‰«æåŠé”®ç å¤„ç†ç¨‹åºï¼›1--ä¸æ‰§è¡Œã€‚</span><br><span class="line"></span><br><span class="line">bit b_KillShock=0;//é˜²æŠ–æ ‡å¿—æ¸…é™¤ä½ï¼š0--ä¸æ¸…é™¤ï¼›1--æ¸…é™¤ã€‚</span><br><span class="line"></span><br><span class="line">unsigned char uc_KillCount=1;//æŠ–åŠ¨æ ‡å¿—æ¸…é™¤è®¡æ•°ï¼Œä½¿ç”¨å®šæ—¶å™¨1ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;é”®ç›˜æ‰«æå¼€å¯æ ‡å¿—&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">bit b_KeyScan=0;//0--ä¸æ‰«æï¼›</span><br><span class="line">//1--æ‰«æã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">vdInitialize();</span><br><span class="line"></span><br><span class="line">vWriteCMD(0x80);</span><br><span class="line">vShowChar(&quot;Motor Run Status&quot;);</span><br><span class="line">vWriteCMD(0xC4);</span><br><span class="line">vShowChar(&quot;Stop&quot;);</span><br><span class="line">vWriteCMD(0xCC);</span><br><span class="line">vShowNumber(uc_MoChange);</span><br><span class="line"></span><br><span class="line">SCANPORT=0x0F;</span><br><span class="line"></span><br><span class="line">MOTORPORT=MO_STOP;</span><br><span class="line"></span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;å¤–éƒ¨ä¸­æ–­0ï¼Œç”¨äºå¼€å¯é”®ç›˜æ‰«æåŠé”®ç å¤„ç†æ ‡å¿—&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">IT0=1; //ä¸­æ–­æ–¹å¼ï¼šä¸‹é™æ²¿ã€‚</span><br><span class="line">EX0=1; //å¼€å¯å¤–éƒ¨ä¸­æ–­ã€‚</span><br><span class="line"></span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;å®šæ—¶å™¨0ï¼Œå®šæ—¶å™¨0ä¸­æ–­ï¼Œç”¨äºPWMè°ƒåˆ¶è®¡æ•° &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">TMOD=0x11;</span><br><span class="line"></span><br><span class="line">TH0=TIME0H;</span><br><span class="line">TL0=TIME0L;</span><br><span class="line">TR0=1;</span><br><span class="line">ET0=1;</span><br><span class="line"></span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;å®šæ—¶å™¨1ï¼Œç”¨äºé˜²æŠ–åŠ¨æ ‡å¿—æ¸…é™¤ &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">TH1=TIME1H;</span><br><span class="line">TL1=TIME1L;</span><br><span class="line">TR1=1; //å¼€å¯å®šæ—¶å™¨1</span><br><span class="line">ET1=1; //å¼€å®šæ—¶å™¨1ä¸­æ–­</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EA=1;</span><br><span class="line"></span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">if(b_KeyScan==1)   //å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œåˆ™è¿›è¡ŒæŒ‰é”®æ‰«æå’Œé”®ç å¤„ç†ã€‚</span><br><span class="line">&#123;</span><br><span class="line">b_KeyScan=0;</span><br><span class="line">vKeyProcess(ucKeyScan());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//*************************************************************************************************</span><br><span class="line">//*  *</span><br><span class="line">//*******************************å¤–éƒ¨ä¸­æ–­0ï¼Œç”¨äºå¼€å¯é”®ç›˜æ‰«æåŠé”®ç å¤„ç†******************  *</span><br><span class="line">//*  *</span><br><span class="line">//*************************************************************************************************</span><br><span class="line">void vINT0(void) interrupt 0</span><br><span class="line">&#123;</span><br><span class="line">if(b_KeyShock==0)</span><br><span class="line">&#123;</span><br><span class="line">b_KeyScan=1;//å¼€å¯é”®ç›˜æ‰«ææ ‡å¿—ã€‚</span><br><span class="line">b_KeyShock=1;//è®¾ç½®é˜²æŠ–åŠ¨æ ‡å¿—ã€‚</span><br><span class="line">&#125;</span><br><span class="line">else b_KeyShock=0;//å¦‚æœæœ‰æŠ–åŠ¨åˆ™ä¸æ‰§è¡Œé”®æ‰«æï¼Œæ¢å¤é˜²æŠ–åŠ¨æ ‡å¿—ã€‚</span><br><span class="line"></span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;è®¾ç½®é˜²æŠ–åŠ¨æ¸…é™¤æ ‡å¿—ä½ &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">if(b_KeyShock==1)</span><br><span class="line">b_KillShock=1;//å¦‚æœé˜²æŠ–åŠ¨æ ‡å¿—ä½å¼€å¯åˆ™å¼€å¯é˜²æŠ–åŠ¨æ ‡å¿—æ¸…é™¤ä½ï¼Œ</span><br><span class="line">//300msåæ¸…é™¤é˜²æŠ–åŠ¨æ ‡å¿—ã€‚</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//*************************************************************************************************</span><br><span class="line">//*  *</span><br><span class="line">//*****************************å®šæ—¶å™¨0ä¸­æ–­ï¼Œç”¨äºPWMè°ƒåˆ¶è®¡æ•°****************************  *</span><br><span class="line">//*  *</span><br><span class="line">//*************************************************************************************************</span><br><span class="line">void vTimer0() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">if(uc_MoChange&gt;128)  //æ­£å‘ã€‚</span><br><span class="line">&#123;</span><br><span class="line">if(uc_MoCount&lt;uc_MoChange)</span><br><span class="line">MOTORPORT=MO_COMMON;</span><br><span class="line">else</span><br><span class="line">MOTORPORT=MO_CUTOFF;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">if(uc_MoChange&lt;127) //åå‘ã€‚</span><br><span class="line">&#123;</span><br><span class="line">if(uc_MoCount&gt;uc_MoChange)</span><br><span class="line">MOTORPORT=MO_OPPOSE;</span><br><span class="line">else</span><br><span class="line">MOTORPORT=MO_CUTOFF;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">MOTORPORT=MO_STOP;//åœæ­¢</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(uc_MoCount&lt;255)</span><br><span class="line">uc_MoCount++;</span><br><span class="line">else</span><br><span class="line">uc_MoCount=0;</span><br><span class="line"></span><br><span class="line">TH0=TIME0H;</span><br><span class="line">TL0=TIME0L;</span><br><span class="line">&#125;</span><br><span class="line">//*************************************************************************************************</span><br><span class="line">//*  *</span><br><span class="line">//*****************å®šæ—¶å™¨1ä¸­æ–­ï¼Œç”¨äºè®¡æ—¶åŠŸèƒ½å’Œé˜²æŠ–åŠ¨æ ‡å¿—æ¸…é™¤ä»¥åŠæ˜¾ç¤ºæŠ¥å‘Š****************  *</span><br><span class="line">//*  *</span><br><span class="line">//*************************************************************************************************</span><br><span class="line">void vTimer1(void) interrupt 3</span><br><span class="line">&#123;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;é˜²æŠ–åŠ¨æ ‡å¿—æ¸…é™¤&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">if(b_KillShock==1)</span><br><span class="line">&#123;</span><br><span class="line">if(uc_KillCount==5) //å½“é˜²æŠ–åŠ¨æ ‡å¿—ä½ä¸º1æ—¶ï¼Œè®¡æ—¶300msåæ¸…é™¤æŠ–åŠ¨æ ‡å¿—ä½ã€‚</span><br><span class="line">&#123;</span><br><span class="line">b_KeyShock=0;</span><br><span class="line">b_KillShock=0;</span><br><span class="line">uc_KillCount=1;</span><br><span class="line">&#125;</span><br><span class="line">else uc_KillCount++;</span><br><span class="line">&#125;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;æ¢å¤å®šæ—¶å™¨1æº¢å‡ºæ—¶é—´&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">//&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br><span class="line">TH1=TIME1H;</span><br><span class="line">TL1=TIME1L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;&#x2F;*************************************************************************************************<br>&#x2F;&#x2F;*************************************************************************************************<br>&#x2F;&#x2F;<strong>&lt;ç¨‹åºå&gt;ï¼šé”®ç›˜æ§åˆ¶ç›´æµç”µæœºè¿è½¬ã€‚  **<br>&#x2F;&#x2F;</strong>&lt;åŠŸèƒ½&gt;ï¼šé€šè¿‡æŒ‰é”®æ§åˆ¶ç›´æµç”µæœºè¿è½¬å¹¶åœ¨LCDä¸Šæ˜¾ç¤ºè¿è¡ŒçŠ¶æ€ã€‚ **<br>&#x2F;&#x2F;*************************************************************************************************<br>&#x2F;&#x2F;*************************************************************************************************</p><p>#include â€œincludes.hâ€</p><p>#define TIME0H 0xFF<br>#define TIME0L 0x9C&#x2F;&#x2F;å®šæ—¶å™¨0æº¢å‡ºæ—¶é—´ï¼š0.1ms</p><p>#define TIME1H 0x3C<br>#define TIME1L 0xB0&#x2F;&#x2F;å®šæ—¶å™¨1æº¢å‡ºæ—¶é—´ï¼š50ms</p><p>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;PWMè°ƒåˆ¶è®¡æ•°&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>unsigned char uc_MoCount&#x3D;0;<br>unsigned char uc_MoChange&#x3D;128;</p><p>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;é˜²æŠ–åŠ¨æ ‡å¿—&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>bit b_KeyShock&#x3D;0;  &#x2F;&#x2F;é”®ç›˜é˜²æŠ–åŠ¨æ ‡å¿—ä½ã€‚<br>                                    &#x2F;&#x2F;å½“æŒ‰é”®ä¸­æ–­äº§ç”Ÿæ—¶ï¼Œé¦–å…ˆåˆ¤æ–­æ­¤ä½ã€‚<br>                                    &#x2F;&#x2F;0â€“æ‰§è¡Œé”®ç›˜æ‰«æåŠé”®ç å¤„ç†ç¨‹åºï¼›1â€“ä¸æ‰§è¡Œã€‚</p><p>bit b_KillShock&#x3D;0;&#x2F;&#x2F;é˜²æŠ–æ ‡å¿—æ¸…é™¤ä½ï¼š0â€“ä¸æ¸…é™¤ï¼›1â€“æ¸…é™¤ã€‚</p><p>unsigned char uc_KillCount&#x3D;1;&#x2F;&#x2F;æŠ–åŠ¨æ ‡å¿—æ¸…é™¤è®¡æ•°ï¼Œä½¿ç”¨å®šæ—¶å™¨1ã€‚</p><p>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;é”®ç›˜æ‰«æå¼€å¯æ ‡å¿—&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>bit b_KeyScan&#x3D;0;&#x2F;&#x2F;0â€“ä¸æ‰«æï¼›<br>                                    &#x2F;&#x2F;1â€“æ‰«æã€‚</p><p>void main()<br>{<br>    vdInitialize();</p><pre><code>vWriteCMD(0x80);vShowChar(&quot;Motor Run Status&quot;);vWriteCMD(0xC4);vShowChar(&quot;Stop&quot;);vWriteCMD(0xCC);vShowNumber(uc_MoChange);SCANPORT=0x0F;MOTORPORT=MO_STOP;</code></pre><p>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;å¤–éƒ¨ä¸­æ–­0ï¼Œç”¨äºå¼€å¯é”®ç›˜æ‰«æåŠé”®ç å¤„ç†æ ‡å¿—&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>    IT0&#x3D;1; &#x2F;&#x2F;ä¸­æ–­æ–¹å¼ï¼šä¸‹é™æ²¿ã€‚<br>    EX0&#x3D;1; &#x2F;&#x2F;å¼€å¯å¤–éƒ¨ä¸­æ–­ã€‚</p><p>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;å®šæ—¶å™¨0ï¼Œå®šæ—¶å™¨0ä¸­æ–­ï¼Œç”¨äºPWMè°ƒåˆ¶è®¡æ•° &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>    TMOD&#x3D;0x11;</p><pre><code>TH0=TIME0H;TL0=TIME0L;TR0=1;ET0=1;</code></pre><p>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;å®šæ—¶å™¨1ï¼Œç”¨äºé˜²æŠ–åŠ¨æ ‡å¿—æ¸…é™¤ &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>    TH1&#x3D;TIME1H;<br>    TL1&#x3D;TIME1L;<br>    TR1&#x3D;1; &#x2F;&#x2F;å¼€å¯å®šæ—¶å™¨1<br>    ET1&#x3D;1; &#x2F;&#x2F;å¼€å®šæ—¶å™¨1ä¸­æ–­</p><pre><code>EA=1;while(1)&#123;if(b_KeyScan==1)   //å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œåˆ™è¿›è¡ŒæŒ‰é”®æ‰«æå’Œé”®ç å¤„ç†ã€‚    &#123;    b_KeyScan=0;    vKeyProcess(ucKeyScan());    &#125;&#125;</code></pre><p>}</p><p>&#x2F;&#x2F;*************************************************************************************************<br>&#x2F;&#x2F;*  *<br>&#x2F;&#x2F;*<em><strong><strong><strong><strong><strong><em><strong><strong><strong><strong><strong><strong><strong><strong><strong>å¤–éƒ¨ä¸­æ–­0ï¼Œç”¨äºå¼€å¯é”®ç›˜æ‰«æåŠé”®ç å¤„ç†</strong></strong></strong></strong></strong></strong></strong></strong></strong>  *<br>&#x2F;&#x2F;</em>  *<br>&#x2F;&#x2F;</strong></strong></strong></strong></strong></em>**************************************************************************************<br>void vINT0(void) interrupt 0<br>{<br>    if(b_KeyShock&#x3D;&#x3D;0)<br>        {<br>            b_KeyScan&#x3D;1;&#x2F;&#x2F;å¼€å¯é”®ç›˜æ‰«ææ ‡å¿—ã€‚<br>            b_KeyShock&#x3D;1;&#x2F;&#x2F;è®¾ç½®é˜²æŠ–åŠ¨æ ‡å¿—ã€‚<br>        }<br>    else b_KeyShock&#x3D;0;&#x2F;&#x2F;å¦‚æœæœ‰æŠ–åŠ¨åˆ™ä¸æ‰§è¡Œé”®æ‰«æï¼Œæ¢å¤é˜²æŠ–åŠ¨æ ‡å¿—ã€‚</p><p>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;è®¾ç½®é˜²æŠ–åŠ¨æ¸…é™¤æ ‡å¿—ä½ &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>    if(b_KeyShock&#x3D;&#x3D;1)<br>        b_KillShock&#x3D;1;&#x2F;&#x2F;å¦‚æœé˜²æŠ–åŠ¨æ ‡å¿—ä½å¼€å¯åˆ™å¼€å¯é˜²æŠ–åŠ¨æ ‡å¿—æ¸…é™¤ä½ï¼Œ<br>                                    &#x2F;&#x2F;300msåæ¸…é™¤é˜²æŠ–åŠ¨æ ‡å¿—ã€‚</p><p>}</p><p>&#x2F;&#x2F;*************************************************************************************************<br>&#x2F;&#x2F;*  *<br>&#x2F;&#x2F;*<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>å®šæ—¶å™¨0ä¸­æ–­ï¼Œç”¨äºPWMè°ƒåˆ¶è®¡æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>  *<br>&#x2F;&#x2F;*  *<br>&#x2F;&#x2F;*************************************************************************************************<br>void vTimer0() interrupt 1<br>{</p><pre><code>if(uc_MoChange&gt;128)  //æ­£å‘ã€‚    &#123;    if(uc_MoCount&lt;uc_MoChange)        MOTORPORT=MO_COMMON;    else        MOTORPORT=MO_CUTOFF;    &#125;else    &#123;    if(uc_MoChange&lt;127) //åå‘ã€‚        &#123;        if(uc_MoCount&gt;uc_MoChange)            MOTORPORT=MO_OPPOSE;        else            MOTORPORT=MO_CUTOFF;        &#125;    else        MOTORPORT=MO_STOP;//åœæ­¢    &#125;if(uc_MoCount&lt;255)    uc_MoCount++;else    uc_MoCount=0;TH0=TIME0H;TL0=TIME0L;</code></pre><p>}<br>&#x2F;&#x2F;*************************************************************************************************<br>&#x2F;&#x2F;*  *<br>&#x2F;&#x2F;*<strong><strong><strong><strong><strong><strong><strong><strong>å®šæ—¶å™¨1ä¸­æ–­ï¼Œç”¨äºè®¡æ—¶åŠŸèƒ½å’Œé˜²æŠ–åŠ¨æ ‡å¿—æ¸…é™¤ä»¥åŠæ˜¾ç¤ºæŠ¥å‘Š</strong></strong></strong></strong></strong></strong></strong></strong>  *<br>&#x2F;&#x2F;*  *<br>&#x2F;&#x2F;*************************************************************************************************<br>void vTimer1(void) interrupt 3<br>{<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;é˜²æŠ–åŠ¨æ ‡å¿—æ¸…é™¤&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>    if(b_KillShock&#x3D;&#x3D;1)<br>        {<br>        if(uc_KillCount&#x3D;&#x3D;5) &#x2F;&#x2F;å½“é˜²æŠ–åŠ¨æ ‡å¿—ä½ä¸º1æ—¶ï¼Œè®¡æ—¶300msåæ¸…é™¤æŠ–åŠ¨æ ‡å¿—ä½ã€‚<br>            {<br>            b_KeyShock&#x3D;0;<br>            b_KillShock&#x3D;0;<br>            uc_KillCount&#x3D;1;<br>            }<br>        else uc_KillCount++;<br>        }<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;æ¢å¤å®šæ—¶å™¨1æº¢å‡ºæ—¶é—´&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>&#x2F;&#x2F;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>    TH1&#x3D;TIME1H;<br>    TL1&#x3D;TIME1L;<br>}&#96;</p><ul><li>å·¥ç¨‹æ¶æ„</li><li>æ·»åŠ å¤´æ–‡ä»¶æ–¹æ³•</li></ul><p><img src="https://img-blog.csdnimg.cn/3c2b75c654a84649a77e7f5fed526f52.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/2bf5d110ff294ca2aa09186645420b11.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¨‹åºä»£ç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºä»£ç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºä»£ç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºä»£ç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.9SP2å¹³å°</p><p><code>Proteus8.9SP2</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1NLJJy2qP8ErFIc42lbsxJQ </span><br><span class="line">æå–ç ï¼šaeyl</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1NLJJy2qP8ErFIc42lbsxJQ  æå–ç ï¼šaeyl</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98%E4%B8%AD%E6%96%AD%E6%89%AB%E6%8F%8F/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98%E4%B8%AD%E6%96%AD%E6%89%AB%E6%8F%8F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ"><a href="#ã€Proteusä»¿çœŸã€‘çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ" class="headerlink" title="ã€Proteusä»¿çœŸã€‘çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ"></a>ã€Proteusä»¿çœŸã€‘çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ</h1><h3 id="ã€Proteusä»¿çœŸã€‘çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ-1"><a href="#ã€Proteusä»¿çœŸã€‘çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ"></a>ã€Proteusä»¿çœŸã€‘çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/58392d855c71424c829ad420358af437.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><span class="line">/*-----------------------------------------------</span><br><span class="line">  åç§°ï¼šçŸ©é˜µé”®ç›˜ä¾æ¬¡è¾“å…¥æ§åˆ¶ ä½¿ç”¨è¡Œåˆ—é€çº§æ‰«æ ä¸­æ–­æ–¹å¼</span><br><span class="line">  å†…å®¹ï¼šå¦‚è®¡ç®—å™¨è¾“å…¥æ•°æ®å½¢å¼ç›¸åŒ ä»å³è‡³å·¦ ä½¿ç”¨è¡Œåˆ—æ‰«ææ–¹æ³•</span><br><span class="line">        ä¸­æ–­æ–¹å¼å¯ä»¥æœ‰æ•ˆæä¾›cpuå·¥ä½œæ•ˆç‡ï¼Œåœ¨æœ‰æŒ‰é”®åŠ¨ä½œæ—¶æ‰æ‰«æï¼Œå¹³æ—¶ä¸è¿›è¡Œæ‰«æå·¥ä½œ</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">#include&lt;reg52.h&gt; //åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#define DataPort P0 //å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢</span><br><span class="line">#define KeyPort  P1</span><br><span class="line"></span><br><span class="line">sbit LATCH1=P2^2;//å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜</span><br><span class="line">sbit LATCH2=P2^3;//                 ä½é”å­˜</span><br><span class="line"></span><br><span class="line">bit KeyPressFlag;//å®šä¹‰æŒ‰é”®æ ‡å¿—ä½</span><br><span class="line"></span><br><span class="line">unsigned char code DuanMa[]=&#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,</span><br><span class="line">                           0x77,0x7c,0x39,0x5e,0x79,0x71&#125;;// æ˜¾ç¤ºæ®µç å€¼0~F</span><br><span class="line">unsigned char code WeiMa[]=&#123;0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f&#125;;//åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç </span><br><span class="line">unsigned char TempData[10]; //å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡</span><br><span class="line"></span><br><span class="line">void DelayUs2x(unsigned char t);//usçº§å»¶æ—¶å‡½æ•°å£°æ˜ </span><br><span class="line">void DelayMs(unsigned char t); //msçº§å»¶æ—¶</span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num);//æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°</span><br><span class="line">unsigned char KeyScan(void);//é”®ç›˜æ‰«æ</span><br><span class="line">unsigned char KeyPro(void);</span><br><span class="line">void Init_Timer0(void);//å®šæ—¶å™¨åˆå§‹åŒ–</span><br><span class="line">void Init_INT0(void);  //å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–å’Œ</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    ä¸»å‡½æ•°</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void main (void)</span><br><span class="line">&#123;</span><br><span class="line">unsigned char num,i,j;                  </span><br><span class="line">unsigned char temp[8];</span><br><span class="line">Init_Timer0();</span><br><span class="line">Init_INT0();</span><br><span class="line">while (1)         //ä¸»å¾ªç¯</span><br><span class="line">  &#123;</span><br><span class="line">  KeyPort=0xf0;// èµ‹å€¼ç”¨äºä¸­æ–­æ£€æµ‹</span><br><span class="line"> if(KeyPressFlag==1)</span><br><span class="line"> &#123;</span><br><span class="line">  KeyPressFlag=0;  //æŒ‰é”®æ ‡å¿—æ¸…é›¶ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ£€æµ‹</span><br><span class="line">  num=KeyPro();    </span><br><span class="line">  if(num!=0xff)</span><br><span class="line">   &#123;</span><br><span class="line">    if(i&lt;8)</span><br><span class="line">      &#123;</span><br><span class="line">       temp[i]=DuanMa[num];</span><br><span class="line">   for(j=0;j&lt;=i;j++)</span><br><span class="line">          TempData[7-i+j]=temp[j];</span><br><span class="line">       &#125;</span><br><span class="line">i++;</span><br><span class="line">if(i==9)//å¤šå‡ºä¸€ä¸ªæŒ‰é”®è¾“å…¥ä¸ºäº†æ¸…å± åŸæœ¬åº”è¯¥ä¸º8</span><br><span class="line">      &#123;</span><br><span class="line">  i=0;</span><br><span class="line">      for(j=0;j&lt;8;j++)//æ¸…å±</span><br><span class="line">         TempData[j]=0;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> uSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼</span><br><span class="line"> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯</span><br><span class="line"> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–,å¤§è‡´å»¶æ—¶</span><br><span class="line"> é•¿åº¦å¦‚ä¸‹ T=tx2+5 uS </span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void DelayUs2x(unsigned char t)</span><br><span class="line">&#123;   </span><br><span class="line"> while(--t);</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> mSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼</span><br><span class="line"> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯</span><br><span class="line"> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void DelayMs(unsigned char t)</span><br><span class="line">&#123;</span><br><span class="line">     </span><br><span class="line"> while(t--)</span><br><span class="line"> &#123;</span><br><span class="line">     //å¤§è‡´å»¶æ—¶1mS</span><br><span class="line">     DelayUs2x(245);</span><br><span class="line"> DelayUs2x(245);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡</span><br><span class="line"> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤ºä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º</span><br><span class="line"> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚</span><br><span class="line"> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Display(unsigned char FirstBit,unsigned char Num)</span><br><span class="line">&#123;</span><br><span class="line">      static unsigned char i=0;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">   DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±</span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line"></span><br><span class="line">       DataPort = WeiMa[i+FirstBit]; //å–ä½ç  </span><br><span class="line">       LATCH2=1;     //ä½é”å­˜</span><br><span class="line">       LATCH2=0;</span><br><span class="line"></span><br><span class="line">       DataPort=TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç </span><br><span class="line">       LATCH1=1;     //æ®µé”å­˜</span><br><span class="line">       LATCH1=0;</span><br><span class="line">       </span><br><span class="line">   i++;</span><br><span class="line">       if(i==Num)</span><br><span class="line">      i=0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Init_Timer0(void)</span><br><span class="line">&#123;</span><br><span class="line"> TMOD |= 0x01;  //ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½å®šæ—¶å™¨ï¼Œä½¿ç”¨&quot;|&quot;ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“     </span><br><span class="line"> //TH0=0x00;      //ç»™å®šåˆå€¼</span><br><span class="line"> //TL0=0x00;</span><br><span class="line"> EA=1;            //æ€»ä¸­æ–­æ‰“å¼€</span><br><span class="line"> ET0=1;           //å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€</span><br><span class="line"> TR0=1;           //å®šæ—¶å™¨å¼€å…³æ‰“å¼€</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Timer0_isr(void) interrupt 1 </span><br><span class="line">&#123;</span><br><span class="line"> TH0=(65536-2000)/256;  //é‡æ–°èµ‹å€¼ 2ms</span><br><span class="line"> TL0=(65536-2000)%256;</span><br><span class="line"> </span><br><span class="line"> Display(0,8);       // è°ƒç”¨æ•°ç ç®¡æ‰«æ</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">æŒ‰é”®æ‰«æå‡½æ•°ï¼Œè¿”å›æ‰«æé”®å€¼</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">unsigned char KeyScan(void)  //é”®ç›˜æ‰«æå‡½æ•°ï¼Œä½¿ç”¨è¡Œåˆ—é€çº§æ‰«ææ³•</span><br><span class="line">&#123;</span><br><span class="line"> unsigned char Val;</span><br><span class="line"> KeyPort=0xf0;//é«˜å››ä½ç½®é«˜ï¼Œä½å››ä½æ‹‰ä½</span><br><span class="line"> if(KeyPort!=0xf0)//è¡¨ç¤ºæœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">   &#123;</span><br><span class="line">    DelayMs(10);  //å»æŠ–</span><br><span class="line">if(KeyPort!=0xf0)</span><br><span class="line">  &#123;           //è¡¨ç¤ºæœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    KeyPort=0xfe; //æ£€æµ‹ç¬¬ä¸€è¡Œ</span><br><span class="line">if(KeyPort!=0xfe)</span><br><span class="line">  &#123;</span><br><span class="line">  Val=KeyPort&amp;0xf0;</span><br><span class="line">        Val+=0x0e;</span><br><span class="line">    while(KeyPort!=0xfe);</span><br><span class="line">  DelayMs(10); //å»æŠ–</span><br><span class="line">  while(KeyPort!=0xfe);</span><br><span class="line">       return Val;</span><br><span class="line">        &#125;</span><br><span class="line">        KeyPort=0xfd; //æ£€æµ‹ç¬¬äºŒè¡Œ</span><br><span class="line">if(KeyPort!=0xfd)</span><br><span class="line">  &#123;</span><br><span class="line">  Val=KeyPort&amp;0xf0;</span><br><span class="line">        Val+=0x0d;</span><br><span class="line">    while(KeyPort!=0xfd);</span><br><span class="line">  DelayMs(10); //å»æŠ–</span><br><span class="line">  while(KeyPort!=0xfd);</span><br><span class="line">       return Val;</span><br><span class="line">        &#125;</span><br><span class="line">    KeyPort=0xfb; //æ£€æµ‹ç¬¬ä¸‰è¡Œ</span><br><span class="line">if(KeyPort!=0xfb)</span><br><span class="line">  &#123;</span><br><span class="line">  Val=KeyPort&amp;0xf0;</span><br><span class="line">        Val+=0x0b;</span><br><span class="line">    while(KeyPort!=0xfb);</span><br><span class="line">  DelayMs(10); //å»æŠ–</span><br><span class="line">  while(KeyPort!=0xfb);</span><br><span class="line">       return Val;</span><br><span class="line">        &#125;</span><br><span class="line">    KeyPort=0xf7; //æ£€æµ‹ç¬¬å››è¡Œ</span><br><span class="line">if(KeyPort!=0xf7)</span><br><span class="line">  &#123;</span><br><span class="line">  Val=KeyPort&amp;0xf0;</span><br><span class="line">        Val+=0x07;</span><br><span class="line">    while(KeyPort!=0xf7);</span><br><span class="line">  DelayMs(10); //å»æŠ–</span><br><span class="line">  while(KeyPort!=0xf7);</span><br><span class="line">       return Val;</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">  return 0xff;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">æŒ‰é”®å€¼å¤„ç†å‡½æ•°ï¼Œè¿”å›æ‰«é”®å€¼</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">unsigned char KeyPro(void)</span><br><span class="line">&#123;</span><br><span class="line"> switch(KeyScan())</span><br><span class="line"> &#123;</span><br><span class="line">  case 0x7e:return 0;break;//0 æŒ‰ä¸‹ç›¸åº”çš„é”®æ˜¾ç¤ºç›¸å¯¹åº”çš„ç å€¼</span><br><span class="line">  case 0x7d:return 1;break;//1</span><br><span class="line">  case 0x7b:return 2;break;//2</span><br><span class="line">  case 0x77:return 3;break;//3</span><br><span class="line">  case 0xbe:return 4;break;//4</span><br><span class="line">  case 0xbd:return 5;break;//5</span><br><span class="line">  case 0xbb:return 6;break;//6</span><br><span class="line">  case 0xb7:return 7;break;//7</span><br><span class="line">  case 0xde:return 8;break;//8</span><br><span class="line">  case 0xdd:return 9;break;//9</span><br><span class="line">  case 0xdb:return 10;break;//a</span><br><span class="line">  case 0xd7:return 11;break;//b</span><br><span class="line">  case 0xee:return 12;break;//c</span><br><span class="line">  case 0xed:return 13;break;//d</span><br><span class="line">  case 0xeb:return 14;break;//e</span><br><span class="line">  case 0xe7:return 15;break;//f</span><br><span class="line">  default:return 0xff;break;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">           å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Init_INT0(void)</span><br><span class="line">&#123;</span><br><span class="line">  EA=1;          //å…¨å±€ä¸­æ–­å¼€</span><br><span class="line">  EX0=1;         //å¤–éƒ¨ä¸­æ–­0å¼€</span><br><span class="line">  IT0=1;         //è¾¹æ²¿è§¦å‘</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                 å¤–éƒ¨ä¸­æ–­0ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void ISR_INT0(void) interrupt 0 </span><br><span class="line">&#123;</span><br><span class="line"> KeyPressFlag=1;   //è¡¨æ˜æŒ‰é”®æœ‰åŠ¨ä½œï¼Œå¯ä»¥è¿›è¡ŒæŒ‰é”®æ‰«æ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br>  åç§°ï¼šçŸ©é˜µé”®ç›˜ä¾æ¬¡è¾“å…¥æ§åˆ¶ ä½¿ç”¨è¡Œåˆ—é€çº§æ‰«æ ä¸­æ–­æ–¹å¼<br>  å†…å®¹ï¼šå¦‚è®¡ç®—å™¨è¾“å…¥æ•°æ®å½¢å¼ç›¸åŒ ä»å³è‡³å·¦ ä½¿ç”¨è¡Œåˆ—æ‰«ææ–¹æ³•<br>        ä¸­æ–­æ–¹å¼å¯ä»¥æœ‰æ•ˆæä¾›cpuå·¥ä½œæ•ˆç‡ï¼Œåœ¨æœ‰æŒ‰é”®åŠ¨ä½œæ—¶æ‰æ‰«æï¼Œå¹³æ—¶ä¸è¿›è¡Œæ‰«æå·¥ä½œ<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>#include&lt;reg52.h&gt; &#x2F;&#x2F;åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</p><p>#define DataPort P0 &#x2F;&#x2F;å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢<br>#define KeyPort  P1</p><p>sbit LATCH1&#x3D;P2^2;&#x2F;&#x2F;å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜<br>sbit LATCH2&#x3D;P2^3;&#x2F;&#x2F;                 ä½é”å­˜</p><p>bit KeyPressFlag;&#x2F;&#x2F;å®šä¹‰æŒ‰é”®æ ‡å¿—ä½</p><p>unsigned char code DuanMa[]&#x3D;{0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,<br>                                   0x77,0x7c,0x39,0x5e,0x79,0x71};&#x2F;&#x2F; æ˜¾ç¤ºæ®µç å€¼0~F<br>unsigned char code WeiMa[]&#x3D;{0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};&#x2F;&#x2F;åˆ†åˆ«å¯¹åº”ç›¸åº”çš„æ•°ç ç®¡ç‚¹äº®,å³ä½ç <br>unsigned char TempData[10]; &#x2F;&#x2F;å­˜å‚¨æ˜¾ç¤ºå€¼çš„å…¨å±€å˜é‡</p><p>void DelayUs2x(unsigned char t);&#x2F;&#x2F;usçº§å»¶æ—¶å‡½æ•°å£°æ˜<br>void DelayMs(unsigned char t); &#x2F;&#x2F;msçº§å»¶æ—¶<br>void Display(unsigned char FirstBit,unsigned char Num);&#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°<br>unsigned char KeyScan(void);&#x2F;&#x2F;é”®ç›˜æ‰«æ<br>unsigned char KeyPro(void);<br>void Init_Timer0(void);&#x2F;&#x2F;å®šæ—¶å™¨åˆå§‹åŒ–<br>void Init_INT0(void);  &#x2F;&#x2F;å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–å’Œ<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    ä¸»å‡½æ•°<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void main (void)<br>{<br>unsigned char num,i,j;<br>unsigned char temp[8];<br>Init_Timer0();<br>Init_INT0();<br>while (1)         &#x2F;&#x2F;ä¸»å¾ªç¯<br>  {<br>  KeyPort&#x3D;0xf0;&#x2F;&#x2F; èµ‹å€¼ç”¨äºä¸­æ–­æ£€æµ‹<br> if(KeyPressFlag&#x3D;&#x3D;1)<br> {<br>  KeyPressFlag&#x3D;0;  &#x2F;&#x2F;æŒ‰é”®æ ‡å¿—æ¸…é›¶ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ£€æµ‹<br>  num&#x3D;KeyPro();<br>  if(num!&#x3D;0xff)<br>   {<br>    if(i&lt;8)<br>      {<br>       temp[i]&#x3D;DuanMa[num];<br>       for(j&#x3D;0;j&lt;&#x3D;i;j++)<br>          TempData[7-i+j]&#x3D;temp[j];<br>       }<br>    i++;<br>    if(i&#x3D;&#x3D;9)&#x2F;&#x2F;å¤šå‡ºä¸€ä¸ªæŒ‰é”®è¾“å…¥ä¸ºäº†æ¸…å± åŸæœ¬åº”è¯¥ä¸º8<br>      {<br>      i&#x3D;0;<br>      for(j&#x3D;0;j&lt;8;j++)&#x2F;&#x2F;æ¸…å±<br>         TempData[j]&#x3D;0;<br>       }<br>     }<br>    }<br> }<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> uSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼<br> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯<br> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–,å¤§è‡´å»¶æ—¶<br> é•¿åº¦å¦‚ä¸‹ T&#x3D;tx2+5 uS<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void DelayUs2x(unsigned char t)<br>{<br> while(â€“t);<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> mSå»¶æ—¶å‡½æ•°ï¼Œå«æœ‰è¾“å…¥å‚æ•° unsigned char tï¼Œæ— è¿”å›å€¼<br> unsigned char æ˜¯å®šä¹‰æ— ç¬¦å·å­—ç¬¦å˜é‡ï¼Œå…¶å€¼çš„èŒƒå›´æ˜¯<br> 0~255 è¿™é‡Œä½¿ç”¨æ™¶æŒ¯12Mï¼Œç²¾ç¡®å»¶æ—¶è¯·ä½¿ç”¨æ±‡ç¼–<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void DelayMs(unsigned char t)<br>{</p><p> while(tâ€“)<br> {<br>     &#x2F;&#x2F;å¤§è‡´å»¶æ—¶1mS<br>     DelayUs2x(245);<br>     DelayUs2x(245);<br> }<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> æ˜¾ç¤ºå‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰«ææ•°ç ç®¡<br> è¾“å…¥å‚æ•° FirstBit è¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ç¬¬ä¸€ä½ï¼Œå¦‚èµ‹å€¼2è¡¨ç¤ºä»ç¬¬ä¸‰ä¸ªæ•°ç ç®¡å¼€å§‹æ˜¾ç¤º<br> å¦‚è¾“å…¥0è¡¨ç¤ºä»ç¬¬ä¸€ä¸ªæ˜¾ç¤ºã€‚<br> Numè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„ä½æ•°ï¼Œå¦‚éœ€è¦æ˜¾ç¤º99ä¸¤ä½æ•°å€¼åˆ™è¯¥å€¼è¾“å…¥2<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Display(unsigned char FirstBit,unsigned char Num)<br>{<br>      static unsigned char i&#x3D;0;</p><pre><code>   DataPort=0;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±   LATCH1=1;     //æ®µé”å­˜   LATCH1=0;   DataPort = WeiMa[i+FirstBit]; //å–ä½ç     LATCH2=1;     //ä½é”å­˜   LATCH2=0;   DataPort=TempData[i]; //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç    LATCH1=1;     //æ®µé”å­˜   LATCH1=0;      i++;   if(i==Num)      i=0;</code></pre><p>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Init_Timer0(void)<br>{<br> TMOD |&#x3D; 0x01;  &#x2F;&#x2F;ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½å®šæ—¶å™¨ï¼Œä½¿ç”¨â€|â€ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“<br> &#x2F;&#x2F;TH0&#x3D;0x00;      &#x2F;&#x2F;ç»™å®šåˆå€¼<br> &#x2F;&#x2F;TL0&#x3D;0x00;<br> EA&#x3D;1;            &#x2F;&#x2F;æ€»ä¸­æ–­æ‰“å¼€<br> ET0&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€<br> TR0&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨å¼€å…³æ‰“å¼€<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Timer0_isr(void) interrupt 1<br>{<br> TH0&#x3D;(65536-2000)&#x2F;256;  &#x2F;&#x2F;é‡æ–°èµ‹å€¼ 2ms<br> TL0&#x3D;(65536-2000)%256;</p><p> Display(0,8);       &#x2F;&#x2F; è°ƒç”¨æ•°ç ç®¡æ‰«æ</p><p>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>æŒ‰é”®æ‰«æå‡½æ•°ï¼Œè¿”å›æ‰«æé”®å€¼<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>unsigned char KeyScan(void)  &#x2F;&#x2F;é”®ç›˜æ‰«æå‡½æ•°ï¼Œä½¿ç”¨è¡Œåˆ—é€çº§æ‰«ææ³•<br>{<br> unsigned char Val;<br> KeyPort&#x3D;0xf0;&#x2F;&#x2F;é«˜å››ä½ç½®é«˜ï¼Œä½å››ä½æ‹‰ä½<br> if(KeyPort!&#x3D;0xf0)&#x2F;&#x2F;è¡¨ç¤ºæœ‰æŒ‰é”®æŒ‰ä¸‹<br>   {<br>    DelayMs(10);  &#x2F;&#x2F;å»æŠ–<br>    if(KeyPort!&#x3D;0xf0)<br>      {           &#x2F;&#x2F;è¡¨ç¤ºæœ‰æŒ‰é”®æŒ‰ä¸‹<br>        KeyPort&#x3D;0xfe; &#x2F;&#x2F;æ£€æµ‹ç¬¬ä¸€è¡Œ<br>        if(KeyPort!&#x3D;0xfe)<br>      {<br>              Val&#x3D;KeyPort&0xf0;<br>            Val+&#x3D;0x0e;<br>        while(KeyPort!&#x3D;0xfe);<br>              DelayMs(10); &#x2F;&#x2F;å»æŠ–<br>              while(KeyPort!&#x3D;0xfe);<br>           return Val;<br>            }<br>        KeyPort&#x3D;0xfd; &#x2F;&#x2F;æ£€æµ‹ç¬¬äºŒè¡Œ<br>        if(KeyPort!&#x3D;0xfd)<br>      {<br>              Val&#x3D;KeyPort&0xf0;<br>            Val+&#x3D;0x0d;<br>        while(KeyPort!&#x3D;0xfd);<br>              DelayMs(10); &#x2F;&#x2F;å»æŠ–<br>              while(KeyPort!&#x3D;0xfd);<br>           return Val;<br>            }<br>        KeyPort&#x3D;0xfb; &#x2F;&#x2F;æ£€æµ‹ç¬¬ä¸‰è¡Œ<br>        if(KeyPort!&#x3D;0xfb)<br>      {<br>              Val&#x3D;KeyPort&0xf0;<br>            Val+&#x3D;0x0b;<br>        while(KeyPort!&#x3D;0xfb);<br>              DelayMs(10); &#x2F;&#x2F;å»æŠ–<br>              while(KeyPort!&#x3D;0xfb);<br>           return Val;<br>            }<br>        KeyPort&#x3D;0xf7; &#x2F;&#x2F;æ£€æµ‹ç¬¬å››è¡Œ<br>        if(KeyPort!&#x3D;0xf7)<br>      {<br>              Val&#x3D;KeyPort&0xf0;<br>            Val+&#x3D;0x07;<br>        while(KeyPort!&#x3D;0xf7);<br>              DelayMs(10); &#x2F;&#x2F;å»æŠ–<br>              while(KeyPort!&#x3D;0xf7);<br>           return Val;<br>            }<br>     }<br>   }<br>  return 0xff;<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>æŒ‰é”®å€¼å¤„ç†å‡½æ•°ï¼Œè¿”å›æ‰«é”®å€¼<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>unsigned char KeyPro(void)<br>{<br> switch(KeyScan())<br> {<br>  case 0x7e:return 0;break;&#x2F;&#x2F;0 æŒ‰ä¸‹ç›¸åº”çš„é”®æ˜¾ç¤ºç›¸å¯¹åº”çš„ç å€¼<br>  case 0x7d:return 1;break;&#x2F;&#x2F;1<br>  case 0x7b:return 2;break;&#x2F;&#x2F;2<br>  case 0x77:return 3;break;&#x2F;&#x2F;3<br>  case 0xbe:return 4;break;&#x2F;&#x2F;4<br>  case 0xbd:return 5;break;&#x2F;&#x2F;5<br>  case 0xbb:return 6;break;&#x2F;&#x2F;6<br>  case 0xb7:return 7;break;&#x2F;&#x2F;7<br>  case 0xde:return 8;break;&#x2F;&#x2F;8<br>  case 0xdd:return 9;break;&#x2F;&#x2F;9<br>  case 0xdb:return 10;break;&#x2F;&#x2F;a<br>  case 0xd7:return 11;break;&#x2F;&#x2F;b<br>  case 0xee:return 12;break;&#x2F;&#x2F;c<br>  case 0xed:return 13;break;&#x2F;&#x2F;d<br>  case 0xeb:return 14;break;&#x2F;&#x2F;e<br>  case 0xe7:return 15;break;&#x2F;&#x2F;f<br>  default:return 0xff;break;<br> }<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>           å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Init_INT0(void)<br>{<br>  EA&#x3D;1;          &#x2F;&#x2F;å…¨å±€ä¸­æ–­å¼€<br>  EX0&#x3D;1;         &#x2F;&#x2F;å¤–éƒ¨ä¸­æ–­0å¼€<br>  IT0&#x3D;1;         &#x2F;&#x2F;è¾¹æ²¿è§¦å‘<br>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                 å¤–éƒ¨ä¸­æ–­0ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void ISR_INT0(void) interrupt 0<br>{<br> KeyPressFlag&#x3D;1;   &#x2F;&#x2F;è¡¨æ˜æŒ‰é”®æœ‰åŠ¨ä½œï¼Œå¯ä»¥è¿›è¡ŒæŒ‰é”®æ‰«æ<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚å¯ä»¥åŸºäºVSM Studioç‹¬ç«‹ä»¿çœŸï¼Œä¸ä¾èµ–Keilå·¥ç¨‹ç¼–è¯‘çš„hexæ–‡ä»¶ã€‚</p><p><code>Proteus8.12</code></p><p><code>VSM Studio</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1vcQSNOkXymwkWJ3DnRH2VQ </span><br><span class="line">æå–ç ï¼šjlo8</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1vcQSNOkXymwkWJ3DnRH2VQ  æå–ç ï¼šjlo8</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘ç®€æ˜“æ•°ç ç®¡å®šæ—¶å™¨æ—¶é’Ÿ</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%AE%80%E6%98%93%E6%95%B0%E7%A0%81%E7%AE%A1%E5%AE%9A%E6%97%B6%E5%99%A8%E6%97%B6%E9%92%9F/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%AE%80%E6%98%93%E6%95%B0%E7%A0%81%E7%AE%A1%E5%AE%9A%E6%97%B6%E5%99%A8%E6%97%B6%E9%92%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘ç®€æ˜“æ•°ç ç®¡å®šæ—¶å™¨æ—¶é’Ÿ"><a href="#ã€Proteusä»¿çœŸã€‘ç®€æ˜“æ•°ç ç®¡å®šæ—¶å™¨æ—¶é’Ÿ" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ç®€æ˜“æ•°ç ç®¡å®šæ—¶å™¨æ—¶é’Ÿ"></a>ã€Proteusä»¿çœŸã€‘ç®€æ˜“æ•°ç ç®¡å®šæ—¶å™¨æ—¶é’Ÿ</h1><h3 id="ã€Proteusä»¿çœŸã€‘ç®€æ˜“æ•°ç ç®¡å®šæ—¶å™¨æ—¶é’Ÿ-1"><a href="#ã€Proteusä»¿çœŸã€‘ç®€æ˜“æ•°ç ç®¡å®šæ—¶å™¨æ—¶é’Ÿ-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ç®€æ˜“æ•°ç ç®¡å®šæ—¶å™¨æ—¶é’Ÿ"></a>ã€Proteusä»¿çœŸã€‘ç®€æ˜“æ•°ç ç®¡å®šæ—¶å™¨æ—¶é’Ÿ</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/2737283b158344c0a2fc311de5af3401.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">/**************************************************************************************</span><br><span class="line"></span><br><span class="line">å®éªŒåç§°ï¼šè®¡æ—¶å™¨ï¼ˆæ•°ç ç®¡æ˜¾ç¤ºï¼‰</span><br><span class="line">æ¥çº¿è¯´æ˜ï¼š</span><br><span class="line">å®éªŒç°è±¡ï¼šä¸‹è½½ç¨‹åºåï¼ŒæŒ‰ä¸‹K1é”®å¼€å§‹è®¡æ—¶ï¼Œå†æ¬¡æŒ‰ä¸‹K1é”®åœæ­¢è®¡æ—¶ï¼ŒæŒ‰ä¸‹K2é”®æ¸…é›¶</span><br><span class="line">æ³¨æ„äº‹é¡¹ï¼š  </span><br><span class="line">***************************************************************************************/</span><br><span class="line">#include &quot;public.h&quot;</span><br><span class="line">#include &quot;key.h&quot;</span><br><span class="line">#include &quot;beep.h&quot;</span><br><span class="line">#include &quot;smg.h&quot;</span><br><span class="line">#include &quot;time.h&quot;</span><br><span class="line"></span><br><span class="line">/*******************************************************************************</span><br><span class="line">* å‡½ æ•° å       : main</span><br><span class="line">* å‡½æ•°åŠŸèƒ½ : ä¸»å‡½æ•°</span><br><span class="line">* è¾“    å…¥       : æ— </span><br><span class="line">* è¾“    å‡º     : æ— </span><br><span class="line">*******************************************************************************/</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">u8 key=0;</span><br><span class="line">u8 time_buf[8];</span><br><span class="line">u8 time_flag=0;</span><br><span class="line"></span><br><span class="line">time0_init();</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">key=key_scan(0);</span><br><span class="line">if(key==KEY1_PRESS)//å¼€å§‹å’Œåœæ­¢è®¡æ—¶</span><br><span class="line">&#123;</span><br><span class="line">time_flag=!time_flag;</span><br><span class="line">beep_alarm(1000,25);//çŸ­æš‚æç¤ºéŸ³</span><br><span class="line">&#125;</span><br><span class="line">else if(key==KEY2_PRESS)//æ¸…é™¤è®¡æ—¶</span><br><span class="line">&#123;</span><br><span class="line">time0_stop();</span><br><span class="line">time_flag=0;</span><br><span class="line">gmin=0;</span><br><span class="line">gsec=0;</span><br><span class="line">gmsec=0;</span><br><span class="line">beep_alarm(1000,25);//çŸ­æš‚æç¤ºéŸ³</span><br><span class="line">&#125;</span><br><span class="line">if(time_flag)</span><br><span class="line">time0_start();//å¼€å§‹è®¡æ—¶</span><br><span class="line">else</span><br><span class="line">time0_stop();//åœæ­¢è®¡æ—¶</span><br><span class="line"></span><br><span class="line">time_buf[0]=gsmg_code[gmin/10];</span><br><span class="line">time_buf[1]=gsmg_code[gmin%10];//åˆ†</span><br><span class="line">time_buf[2]=0x40;//-</span><br><span class="line">time_buf[3]=gsmg_code[gsec/10];</span><br><span class="line">time_buf[4]=gsmg_code[gsec%10];//ç§’</span><br><span class="line">time_buf[5]=0x40;//-</span><br><span class="line">time_buf[6]=gsmg_code[gmsec/10];</span><br><span class="line">time_buf[7]=gsmg_code[gmsec%10];//æ¯«ç§’</span><br><span class="line">smg_display(time_buf,1);//æ˜¾ç¤º</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;**************************************************************************************</p><p>å®éªŒåç§°ï¼šè®¡æ—¶å™¨ï¼ˆæ•°ç ç®¡æ˜¾ç¤ºï¼‰<br>æ¥çº¿è¯´æ˜ï¼š<br>å®éªŒç°è±¡ï¼šä¸‹è½½ç¨‹åºåï¼ŒæŒ‰ä¸‹K1é”®å¼€å§‹è®¡æ—¶ï¼Œå†æ¬¡æŒ‰ä¸‹K1é”®åœæ­¢è®¡æ—¶ï¼ŒæŒ‰ä¸‹K2é”®æ¸…é›¶<br>æ³¨æ„äº‹é¡¹ï¼š<br>***************************************************************************************&#x2F;<br>#include â€œpublic.hâ€<br>#include â€œkey.hâ€<br>#include â€œbeep.hâ€<br>#include â€œsmg.hâ€<br>#include â€œtime.hâ€</p><p>&#x2F;*******************************************************************************</p><ul><li><p>å‡½ æ•° å       : main</p></li><li><p>å‡½æ•°åŠŸèƒ½ : ä¸»å‡½æ•°</p></li><li><p>è¾“    å…¥       : æ— </p></li><li><p>è¾“    å‡º     : æ— <br>*******************************************************************************&#x2F;<br>void main()<br>{<br>  u8 key&#x3D;0;<br>  u8 time_buf[8];<br>  u8 time_flag&#x3D;0;</p><p>  time0_init();<br>  while(1)<br>  {<br>  key&#x3D;key_scan(0);<br>  if(key&#x3D;&#x3D;KEY1_PRESS)&#x2F;&#x2F;å¼€å§‹å’Œåœæ­¢è®¡æ—¶<br>  {<br>      time_flag&#x3D;!time_flag;<br>      beep_alarm(1000,25);&#x2F;&#x2F;çŸ­æš‚æç¤ºéŸ³<br>  }<br>  else if(key&#x3D;&#x3D;KEY2_PRESS)&#x2F;&#x2F;æ¸…é™¤è®¡æ—¶<br>  {<br>      time0_stop();<br>      time_flag&#x3D;0;<br>      gmin&#x3D;0;<br>      gsec&#x3D;0;<br>      gmsec&#x3D;0;<br>      beep_alarm(1000,25);&#x2F;&#x2F;çŸ­æš‚æç¤ºéŸ³<br>  }<br>  if(time_flag)<br>      time0_start();&#x2F;&#x2F;å¼€å§‹è®¡æ—¶<br>  else<br>      time0_stop();&#x2F;&#x2F;åœæ­¢è®¡æ—¶<br><br>  time_buf[0]&#x3D;gsmg_code[gmin&#x2F;10];<br>  time_buf[1]&#x3D;gsmg_code[gmin%10];&#x2F;&#x2F;åˆ†<br>  time_buf[2]&#x3D;0x40;&#x2F;&#x2F;-<br>  time_buf[3]&#x3D;gsmg_code[gsec&#x2F;10];<br>  time_buf[4]&#x3D;gsmg_code[gsec%10];&#x2F;&#x2F;ç§’<br>  time_buf[5]&#x3D;0x40;&#x2F;&#x2F;-<br>  time_buf[6]&#x3D;gsmg_code[gmsec&#x2F;10];<br>  time_buf[7]&#x3D;gsmg_code[gmsec%10];&#x2F;&#x2F;æ¯«ç§’<br>  smg_display(time_buf,1);&#x2F;&#x2F;æ˜¾ç¤º<br>  }</p></li></ul><p>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1R9WzkThUx-z4CB-HVJFByQ </span><br><span class="line">æå–ç ï¼šujzg</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1R9WzkThUx-z4CB-HVJFByQ  æå–ç ï¼šujzg</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘è®¡æ•°é€»è¾‘ç»„æˆçš„æ•°å­—é’Ÿ</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E8%AE%A1%E6%95%B0%E9%80%BB%E8%BE%91%E7%BB%84%E6%88%90%E7%9A%84%E6%95%B0%E5%AD%97%E9%92%9F/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E8%AE%A1%E6%95%B0%E9%80%BB%E8%BE%91%E7%BB%84%E6%88%90%E7%9A%84%E6%95%B0%E5%AD%97%E9%92%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘è®¡æ•°é€»è¾‘ç»„æˆçš„æ•°å­—é’Ÿ"><a href="#ã€Proteusä»¿çœŸã€‘è®¡æ•°é€»è¾‘ç»„æˆçš„æ•°å­—é’Ÿ" class="headerlink" title="ã€Proteusä»¿çœŸã€‘è®¡æ•°é€»è¾‘ç»„æˆçš„æ•°å­—é’Ÿ"></a>ã€Proteusä»¿çœŸã€‘è®¡æ•°é€»è¾‘ç»„æˆçš„æ•°å­—é’Ÿ</h1><h3 id="ã€Proteusä»¿çœŸã€‘è®¡æ•°é€»è¾‘ç»„æˆçš„æ•°å­—é’Ÿ-1"><a href="#ã€Proteusä»¿çœŸã€‘è®¡æ•°é€»è¾‘ç»„æˆçš„æ•°å­—é’Ÿ-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘è®¡æ•°é€»è¾‘ç»„æˆçš„æ•°å­—é’Ÿ"></a>ã€Proteusä»¿çœŸã€‘è®¡æ•°é€»è¾‘ç»„æˆçš„æ•°å­—é’Ÿ</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/5ddd238af3c04c1e995773f0d138e13f.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="å™¨ä»¶æ¸…å•"><a href="#å™¨ä»¶æ¸…å•" class="headerlink" title="å™¨ä»¶æ¸…å•"></a>å™¨ä»¶æ¸…å•</h4><p><img src="https://img-blog.csdnimg.cn/4775f6cb23034a1689bd7ece6d856366.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/218f3cc8448349debe98537c309f97d1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>å®éªŒåŸºäºProteus8.9SP2å¹³å°</p><p><code>Proteus8.9SP2</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1sCZfKC0vTYA-KmtERpxpfQ </span><br><span class="line">æå–ç ï¼šqotn</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1sCZfKC0vTYA-KmtERpxpfQ  æå–ç ï¼šqotn</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘è¶…å£°æ³¢æ¨¡å—HC-SR04æµ‹è·</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%A8%A1%E5%9D%97HCSR04%E6%B5%8B%E8%B7%9D/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%A8%A1%E5%9D%97HCSR04%E6%B5%8B%E8%B7%9D/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘è¶…å£°æ³¢æ¨¡å—HC-SR04æµ‹è·"><a href="#ã€Proteusä»¿çœŸã€‘è¶…å£°æ³¢æ¨¡å—HC-SR04æµ‹è·" class="headerlink" title="ã€Proteusä»¿çœŸã€‘è¶…å£°æ³¢æ¨¡å—HC-SR04æµ‹è·"></a>ã€Proteusä»¿çœŸã€‘è¶…å£°æ³¢æ¨¡å—HC-SR04æµ‹è·</h1><h3 id="ã€Proteusä»¿çœŸã€‘è¶…å£°æ³¢æ¨¡å—HC-SR04æµ‹è·-1"><a href="#ã€Proteusä»¿çœŸã€‘è¶…å£°æ³¢æ¨¡å—HC-SR04æµ‹è·-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘è¶…å£°æ³¢æ¨¡å—HC-SR04æµ‹è·"></a>ã€Proteusä»¿çœŸã€‘è¶…å£°æ³¢æ¨¡å—HC-SR04æµ‹è·</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/77c33a512d37419bbad8894a1de76dd2.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æµ‹è·å®ç°ä»£ç "><a href="#æµ‹è·å®ç°ä»£ç " class="headerlink" title="æµ‹è·å®ç°ä»£ç "></a>æµ‹è·å®ç°ä»£ç </h4><ul><li>è§¦å‘å¼•è„šé—´éš”æ—¶é—´10us,å¾ˆå…³é”®ã€‚</li></ul><p><code>10us</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/********************è¯»å€¼å‡½æ•°***********************/</span><br><span class="line">unsigned int Read_value()</span><br><span class="line">&#123;</span><br><span class="line">uint result;</span><br><span class="line">Tr=1;//è§¦å‘å¼•è„šå‘å‡º11usçš„è§¦å‘ä¿¡å·ï¼ˆè‡³å°‘10usï¼‰</span><br><span class="line">Delay10us();</span><br><span class="line">Tr=0;</span><br><span class="line">while(!Ec);//åº¦è¿‡å›å“ä¿¡å·çš„ä½ç”µå¹³</span><br><span class="line">TR0=1;//å¼€å¯å®šæ—¶å™¨0</span><br><span class="line">while(Ec);//åº¦è¿‡å›å“ä¿¡å·é«˜ç”µå¹³</span><br><span class="line">TR0=0;//å…³é—­å®šæ—¶å™¨0</span><br><span class="line">result=((TH0*256+TL0)*0.034)/2;// è·ç¦»cm=ï¼ˆæ—¶é—´us * é€Ÿåº¦cm/usï¼‰/2</span><br><span class="line">return result + 2;//+2ä¿®æ­£è¡¥å¿</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>/********************è¯»å€¼å‡½æ•°***********************/ unsigned int Read_value() &#123;     uint result;     Tr=1;//è§¦å‘å¼•è„šå‘å‡º11usçš„è§¦å‘ä¿¡å·ï¼ˆè‡³å°‘10usï¼‰     Delay10us();     Tr=0;     while(!Ec);//åº¦è¿‡å›å“ä¿¡å·çš„ä½ç”µå¹³     TR0=1;//å¼€å¯å®šæ—¶å™¨0     while(Ec);//åº¦è¿‡å›å“ä¿¡å·é«˜ç”µå¹³     TR0=0;//å…³é—­å®šæ—¶å™¨0     result=((TH0*256+TL0)*0.034)/2;// è·ç¦»cm=ï¼ˆæ—¶é—´us * é€Ÿåº¦cm/usï¼‰/2     return result + 2;//+2ä¿®æ­£è¡¥å¿ &#125;</code></p><h4 id="ä»¿çœŸè®¾ç½®"><a href="#ä»¿çœŸè®¾ç½®" class="headerlink" title="ä»¿çœŸè®¾ç½®"></a>ä»¿çœŸè®¾ç½®</h4><ul><li>ä¸»æ§é¢‘ç‡é€‰æ‹©12MHz</li><li>VSM Studioä¸­åŒ…å«ä»£ç ï¼Œå¯ä»¥ä¸ä¾èµ–å¯åŠ¨Keilå·¥ç¨‹æ¥ç¼–è¯‘ç”ŸæˆHexæ–‡ä»¶ï¼Œåœ¨VSM Studioç•Œé¢ç›´æ¥ç‚¹å‡»ä»¿çœŸå¯åŠ¨æŒ‰é’®ä¼šç›´æ¥ç¼–è¯‘å¹¶è¿è¡Œä»£ç ã€‚(å‰ææ˜¯å®‰è£…äº†Keilç¼–è¯‘å™¨)</li><li>å·¥ç¨‹è®¾ç½®</li></ul><p><img src="https://img-blog.csdnimg.cn/e7c243585dee4a6091cfae88ac955b85.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/a1f97debf68b418ea2ae8774c3bb0a61.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/adeea7d1a7fa40fc911444fe4723bd3b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åº"><a href="#ä¸»ç¨‹åº" class="headerlink" title="ä¸»ç¨‹åº"></a>ä¸»ç¨‹åº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;STC89C5xRC.H&gt;</span><br><span class="line">#include &quot;LCD1602.h&quot;</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line">typedef unsigned char uchar;</span><br><span class="line">typedef unsigned int  uint;</span><br><span class="line"></span><br><span class="line">sbit Tr=P1^0;//è§¦å‘ä¿¡å·</span><br><span class="line">sbit Ec=P1^1;//å›å“ä¿¡å·</span><br><span class="line">unsigned char  ge,shi,bai;  //è‡ªå®šä¹‰å¯„å­˜å™¨</span><br><span class="line">unsigned int distance,tmp;</span><br><span class="line">void Delay10us(void);//10uså»¶æ—¶å‡½æ•°</span><br><span class="line">void Delayms(unsigned int z) ;//mså»¶æ—¶å‡½æ•°</span><br><span class="line">unsigned int Read_value(void);//è¯»å€¼å‡½æ•°</span><br><span class="line">void InitTimer0(void);//å®šæ—¶å™¨0åˆå§‹åŒ–</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">Tr=0;//å‡ºå‘å¼•è„šé¦–å…ˆæ‹‰ä½</span><br><span class="line">InitTimer0();//åˆå§‹åŒ–å®šæ—¶å™¨0</span><br><span class="line">    LCD1602_Init();//åˆå§‹åŒ–LCD1602</span><br><span class="line">    LCD1602_delay_ms(1);</span><br><span class="line">    LCD1602_set_position(0,4);//æŒ‡é’ˆè®¾ç½®åˆ°ç¬¬ä¸€è¡Œç¬¬4åˆ—</span><br><span class="line">    LCD1602_prints(&quot;Distance:&quot;);</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">tmp = Read_value();//è¯»å€¼</span><br><span class="line">LCD1602_set_position(1,4);</span><br><span class="line">LcdPrintNum(tmp);</span><br><span class="line">Delayms(800) ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/********************è¯»å€¼å‡½æ•°***********************/</span><br><span class="line">unsigned int Read_value()</span><br><span class="line">&#123;</span><br><span class="line">uint result;</span><br><span class="line">Tr=1;//è§¦å‘å¼•è„šå‘å‡º11usçš„è§¦å‘ä¿¡å·ï¼ˆè‡³å°‘10usï¼‰</span><br><span class="line">Delay10us();</span><br><span class="line">//Delayms(1);</span><br><span class="line">Tr=0;</span><br><span class="line">while(!Ec);//åº¦è¿‡å›å“ä¿¡å·çš„ä½ç”µå¹³</span><br><span class="line">TR0=1;//å¼€å¯å®šæ—¶å™¨0</span><br><span class="line">while(Ec);//åº¦è¿‡å›å“ä¿¡å·é«˜ç”µå¹³</span><br><span class="line">TR0=0;//å…³é—­å®šæ—¶å™¨0</span><br><span class="line">result=((TH0*256+TL0)*0.034)/2;// è·ç¦»cm=ï¼ˆæ—¶é—´us * é€Ÿåº¦cm/usï¼‰/2</span><br><span class="line">return result + 2;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/***********************10uså»¶æ—¶å‡½æ•°*****************************/</span><br><span class="line">void Delay10us()</span><br><span class="line">&#123;</span><br><span class="line">TL0=0xF5;</span><br><span class="line">TH0=0xFF;</span><br><span class="line">TR0=1;</span><br><span class="line">while (TF0==0);</span><br><span class="line">TR0=0;</span><br><span class="line">TF0=0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/***********************1mså»¶æ—¶å‡½æ•°*****************************/</span><br><span class="line">void Delayms(unsigned int z)   //è¯¯å·® 0us</span><br><span class="line">&#123;</span><br><span class="line">uint i,j;</span><br><span class="line">for(i=0;i&lt;z;i++)</span><br><span class="line">for(j=0;j&lt;112;j++);</span><br><span class="line">//å»¶æ—¶å‡½æ•°</span><br><span class="line">&#125;</span><br><span class="line">/************************å®šæ—¶å™¨0åˆå§‹åŒ–*****************************/</span><br><span class="line">void InitTimer0(void)</span><br><span class="line">&#123;</span><br><span class="line">    TMOD = 0x01;</span><br><span class="line">    TH0 = 0x00;</span><br><span class="line">    TL0 = 0x00;</span><br><span class="line">    TR0 = 0;//å…ˆå…³é—­å®šæ—¶å™¨0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;STC89C5xRC.H&gt;<br>#include â€œLCD1602.hâ€<br>#include&lt;intrins.h&gt;<br>typedef unsigned char uchar;<br>typedef unsigned int  uint;</p><p>sbit Tr&#x3D;P1^0;&#x2F;&#x2F;è§¦å‘ä¿¡å·<br>sbit Ec&#x3D;P1^1;&#x2F;&#x2F;å›å“ä¿¡å·<br>unsigned char  ge,shi,bai;  &#x2F;&#x2F;è‡ªå®šä¹‰å¯„å­˜å™¨<br>unsigned int distance,tmp;<br>void Delay10us(void);&#x2F;&#x2F;10uså»¶æ—¶å‡½æ•°<br>void Delayms(unsigned int z) ;&#x2F;&#x2F;mså»¶æ—¶å‡½æ•°<br>unsigned int Read_value(void);&#x2F;&#x2F;è¯»å€¼å‡½æ•°<br>void InitTimer0(void);&#x2F;&#x2F;å®šæ—¶å™¨0åˆå§‹åŒ–</p><p>void main()<br>{</p><pre><code>Tr=0;//å‡ºå‘å¼•è„šé¦–å…ˆæ‹‰ä½InitTimer0();//åˆå§‹åŒ–å®šæ—¶å™¨0LCD1602_Init();//åˆå§‹åŒ–LCD1602LCD1602_delay_ms(1);LCD1602_set_position(0,4);//æŒ‡é’ˆè®¾ç½®åˆ°ç¬¬ä¸€è¡Œç¬¬4åˆ—LCD1602_prints(&quot;Distance:&quot;);while(1)&#123;    tmp = Read_value();//è¯»å€¼    LCD1602_set_position(1,4);    LcdPrintNum(tmp);        Delayms(800) ;&#125;</code></pre><p>}</p><p>&#x2F;<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>è¯»å€¼å‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>***&#x2F;<br>unsigned int Read_value()<br>{<br>    uint result;<br>    Tr&#x3D;1;&#x2F;&#x2F;è§¦å‘å¼•è„šå‘å‡º11usçš„è§¦å‘ä¿¡å·ï¼ˆè‡³å°‘10usï¼‰<br>    Delay10us();<br>    &#x2F;&#x2F;Delayms(1);<br>    Tr&#x3D;0;<br>    while(!Ec);&#x2F;&#x2F;åº¦è¿‡å›å“ä¿¡å·çš„ä½ç”µå¹³<br>    TR0&#x3D;1;&#x2F;&#x2F;å¼€å¯å®šæ—¶å™¨0<br>    while(Ec);&#x2F;&#x2F;åº¦è¿‡å›å“ä¿¡å·é«˜ç”µå¹³<br>    TR0&#x3D;0;&#x2F;&#x2F;å…³é—­å®šæ—¶å™¨0<br>    result&#x3D;((TH0*256+TL0)*0.034)&#x2F;2;&#x2F;&#x2F; è·ç¦»cm&#x3D;ï¼ˆæ—¶é—´us * é€Ÿåº¦cm&#x2F;usï¼‰&#x2F;2<br>    return result + 2;</p><p>}<br>&#x2F;<em><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>10uså»¶æ—¶å‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em>******&#x2F;<br>void Delay10us()<br>{<br>    TL0&#x3D;0xF5;<br>    TH0&#x3D;0xFF;<br>    TR0&#x3D;1;<br>    while (TF0&#x3D;&#x3D;0);<br>    TR0&#x3D;0;<br>    TF0&#x3D;0;<br>}</p><p>&#x2F;<em><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>1mså»¶æ—¶å‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em>******&#x2F;<br>void Delayms(unsigned int z)   &#x2F;&#x2F;è¯¯å·® 0us<br>{<br>    uint i,j;<br>    for(i&#x3D;0;i&lt;z;i++)<br>        for(j&#x3D;0;j&lt;112;j++);<br>    &#x2F;&#x2F;å»¶æ—¶å‡½æ•°<br>}<br>&#x2F;<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>å®šæ—¶å™¨0åˆå§‹åŒ–</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong>*****&#x2F;<br>void InitTimer0(void)<br>{<br>    TMOD &#x3D; 0x01;<br>    TH0 &#x3D; 0x00;<br>    TL0 &#x3D; 0x00;<br>    TR0 &#x3D; 0;&#x2F;&#x2F;å…ˆå…³é—­å®šæ—¶å™¨0<br>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1SmpqBhbqrFPM_jwih-_kFw </span><br><span class="line">æå–ç ï¼šo7c2</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1SmpqBhbqrFPM_jwih-_kFw  æå–ç ï¼šo7c2</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ+LCD128x64æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E9%94%AE%E7%9B%98%E7%9F%A9%E9%98%B5%E6%89%AB%E6%8F%8FLCD128x64%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E9%94%AE%E7%9B%98%E7%9F%A9%E9%98%B5%E6%89%AB%E6%8F%8FLCD128x64%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ-LCD128x64æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ-LCD128x64æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ+LCD128x64æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ+LCD128x64æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ-LCD128x64æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ-LCD128x64æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ+LCD128x64æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ+LCD128x64æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/ceff7fbd59464103bc37c47b0df1fbf8.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ±‰å­—å–æ¨¡å·¥å…·å’Œå–æ¨¡æ–¹å¼"><a href="#æ±‰å­—å–æ¨¡å·¥å…·å’Œå–æ¨¡æ–¹å¼" class="headerlink" title="æ±‰å­—å–æ¨¡å·¥å…·å’Œå–æ¨¡æ–¹å¼"></a>æ±‰å­—å–æ¨¡å·¥å…·å’Œå–æ¨¡æ–¹å¼</h4><ul><li>å–æ¨¡å·¥å…·ï¼šPCtoLCD2002</li><li>å–æ¨¡æ–¹å¼ï¼šé˜´ç ã€é€†å‘ã€åˆ—è¡Œå¼ã€C51æ ¼å¼ã€</li></ul><p><code>PCtoLCD2002</code></p><p><img src="https://img-blog.csdnimg.cn/086058426d0b4503953c888b443edb69.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg51.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#include &quot;LCD_12864.H&quot;</span><br><span class="line">#include &quot;KeyPad.H&quot;</span><br><span class="line">#include &quot;DotMatri.H&quot;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line"></span><br><span class="line">//é”®ç›˜æ‰«æå¼€å¯æ ‡å¿—î€å…¶å€¼ç”±å¤–éƒ¨ä¸­æ–­ 0 æ§åˆ¶</span><br><span class="line">bit KeyPressDown = 0;</span><br><span class="line">uchar T_Count = 0;</span><br><span class="line">sbit SPK = P3^7;</span><br><span class="line">//Keybord_Chars ä¸­æ•°å­—ä¸ç¬¦å·ç¼–ç ä¸é”®ç›˜æŒ‰é”®å¯¹ç…§è¡¨</span><br><span class="line">uchar code KeyPosTable[]=</span><br><span class="line">&#123;</span><br><span class="line">    7,8,9,10,</span><br><span class="line">    4,5,6,11,</span><br><span class="line">    1,2,3,12,</span><br><span class="line">    15,0,14,13</span><br><span class="line">&#125;;</span><br><span class="line">//èœ‚é¸£å™¨å‘å£°</span><br><span class="line">void Beep()</span><br><span class="line">&#123;</span><br><span class="line">    uchar i,x=20;</span><br><span class="line">    while (x--)</span><br><span class="line">    &#123;</span><br><span class="line">        for(i=0; i&lt;120; i++);</span><br><span class="line">        SPK=~SPK;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//ä¸»ç¨‹åº</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    uchar i;</span><br><span class="line">    LCD_Initialize(); //åˆå§‹åŒ– LCD</span><br><span class="line">    for (i=0; i&lt;7; i++) //ä»ç¬¬ä¸€é¡µå¼€å§‹î€å·¦è¾¹è· 16 ç‚¹î€æ˜¾ç¤º 7 ä¸ª 16*16 ç‚¹é˜µçš„ä¸­æ–‡æç¤ºä¿¡æ¯</span><br><span class="line">    Display_A_WORD_String (1,16*(i+1),1,Word_String[i]);</span><br><span class="line">    P1=0x0f;</span><br><span class="line">    IE=0x83; //å…è®¸å¤–éƒ¨ 0 å’Œå®šæ—¶å™¨ 0 ä¸­æ–­</span><br><span class="line">    IT0=1; //è®¾ä¸ºä¸‹é™æ²¿ä¸­æ–­æ–¹å¼î€å¤–éƒ¨ä¸­æ–­ 0 ç”¨äºå¯åœé”®ç›˜</span><br><span class="line">    TH0=(65536-5000)/256;//50ms å®šæ—¶</span><br><span class="line">    TL0=(65536-5000)%256;</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">//å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹åˆ™å¤„ç†æŒ‰é”®</span><br><span class="line">        if(KeyPressDown==1)</span><br><span class="line">        &#123;//æ‰«æå¤„ç†</span><br><span class="line">            Beep();</span><br><span class="line">            KeyPressDown=0;</span><br><span class="line">            Display_A_char(4,55,Keyboard_Chars[KeyPosTable[KeyScan()] ]);</span><br><span class="line">            TR0=0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//å¤–éƒ¨ä¸­æ–­ 0 æ§åˆ¶æ¶ˆæŠ–å»¶æ—¶</span><br><span class="line">void EX0_INT() interrupt 0</span><br><span class="line">&#123;</span><br><span class="line">    TR0=1;//å¼€å¯å®šæ—¶å™¨ 0î€å»¶æ—¶ 300ms æ¶ˆæŠ–</span><br><span class="line">&#125;</span><br><span class="line">//å®šæ—¶å™¨ç”¨äºæ¶ˆæŠ–å¹¶ç¡®è®¤æœ‰é”®æŒ‰ä¸‹î€å¯åŠ¨ä¸»ç¨‹åºä¸­çš„æŒ‰é”®æ‰«æ</span><br><span class="line">void T0_INT() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    if(++T_Count==6) //50*6=300ms å»¶æ—¶æŠ–åŠ¨</span><br><span class="line">    &#123;</span><br><span class="line">        T_Count=0;</span><br><span class="line">        KeyPressDown=1; //ç¡®å®šæœ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#125;</span><br><span class="line">    TH0=(65526-50000)/256; //50ms å®šæ—¶</span><br><span class="line">    TL0=(65526-50000)%256;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg51.h&gt;<br>#include &lt;intrins.h&gt;<br>#include â€œLCD_12864.Hâ€<br>#include â€œKeyPad.Hâ€<br>#include â€œDotMatri.Hâ€<br>#define uchar unsigned char<br>#define uint unsigned int</p><p>&#x2F;&#x2F;é”®ç›˜æ‰«æå¼€å¯æ ‡å¿—î€å…¶å€¼ç”±å¤–éƒ¨ä¸­æ–­ 0 æ§åˆ¶<br>bit KeyPressDown &#x3D; 0;<br>uchar T_Count &#x3D; 0;<br>sbit SPK &#x3D; P3^7;<br>&#x2F;&#x2F;Keybord_Chars ä¸­æ•°å­—ä¸ç¬¦å·ç¼–ç ä¸é”®ç›˜æŒ‰é”®å¯¹ç…§è¡¨<br>uchar code KeyPosTable[]&#x3D;<br>{<br>    7,8,9,10,<br>    4,5,6,11,<br>    1,2,3,12,<br>    15,0,14,13<br>};<br>&#x2F;&#x2F;èœ‚é¸£å™¨å‘å£°<br>void Beep()<br>{<br>    uchar i,x&#x3D;20;<br>    while (xâ€“)<br>    {<br>        for(i&#x3D;0; i&lt;120; i++);<br>        SPK&#x3D;~SPK;<br>    }<br>}<br>&#x2F;&#x2F;ä¸»ç¨‹åº<br>void main()<br>{<br>    uchar i;<br>    LCD_Initialize(); &#x2F;&#x2F;åˆå§‹åŒ– LCD<br>    for (i&#x3D;0; i&lt;7; i++) &#x2F;&#x2F;ä»ç¬¬ä¸€é¡µå¼€å§‹î€å·¦è¾¹è· 16 ç‚¹î€æ˜¾ç¤º 7 ä¸ª 16<em>16 ç‚¹é˜µçš„ä¸­æ–‡æç¤ºä¿¡æ¯<br>    Display_A_WORD_String (1,16</em>(i+1),1,Word_String[i]);<br>    P1&#x3D;0x0f;<br>    IE&#x3D;0x83; &#x2F;&#x2F;å…è®¸å¤–éƒ¨ 0 å’Œå®šæ—¶å™¨ 0 ä¸­æ–­<br>    IT0&#x3D;1; &#x2F;&#x2F;è®¾ä¸ºä¸‹é™æ²¿ä¸­æ–­æ–¹å¼î€å¤–éƒ¨ä¸­æ–­ 0 ç”¨äºå¯åœé”®ç›˜<br>    TH0&#x3D;(65536-5000)&#x2F;256;&#x2F;&#x2F;50ms å®šæ—¶<br>    TL0&#x3D;(65536-5000)%256;<br>    while(1)<br>    {<br>&#x2F;&#x2F;å¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹åˆ™å¤„ç†æŒ‰é”®<br>        if(KeyPressDown&#x3D;&#x3D;1)<br>        {&#x2F;&#x2F;æ‰«æå¤„ç†<br>            Beep();<br>            KeyPressDown&#x3D;0;<br>            Display_A_char(4,55,Keyboard_Chars[KeyPosTable[KeyScan()] ]);<br>            TR0&#x3D;0;<br>        }<br>    }<br>}<br>&#x2F;&#x2F;å¤–éƒ¨ä¸­æ–­ 0 æ§åˆ¶æ¶ˆæŠ–å»¶æ—¶<br>void EX0_INT() interrupt 0<br>{<br>    TR0&#x3D;1;&#x2F;&#x2F;å¼€å¯å®šæ—¶å™¨ 0î€å»¶æ—¶ 300ms æ¶ˆæŠ–<br>}<br>&#x2F;&#x2F;å®šæ—¶å™¨ç”¨äºæ¶ˆæŠ–å¹¶ç¡®è®¤æœ‰é”®æŒ‰ä¸‹î€å¯åŠ¨ä¸»ç¨‹åºä¸­çš„æŒ‰é”®æ‰«æ<br>void T0_INT() interrupt 1<br>{<br>    if(++T_Count&#x3D;&#x3D;6) &#x2F;&#x2F;50*6&#x3D;300ms å»¶æ—¶æŠ–åŠ¨<br>    {<br>        T_Count&#x3D;0;<br>        KeyPressDown&#x3D;1; &#x2F;&#x2F;ç¡®å®šæœ‰é”®æŒ‰ä¸‹<br>    }<br>    TH0&#x3D;(65526-50000)&#x2F;256; &#x2F;&#x2F;50ms å®šæ—¶<br>    TL0&#x3D;(65526-50000)%256;<br>}&#96;</p><ul><li>å·¥ç¨‹æ¶æ„ä»¥åŠç¼–è¯‘ä¿¡æ¯</li></ul><p><img src="https://img-blog.csdnimg.cn/625ea24d0e8f41a7a43b33bde7383709.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1qdwGTMi5dLT55ZdDuTKYjA </span><br><span class="line">æå–ç ï¼š4vtv</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1qdwGTMi5dLT55ZdDuTKYjA  æå–ç ï¼š4vtv</code></p><p><img src="https://img-blog.csdnimg.cn/cc0fc833ca8c4f63a7d2c6dd8c889293.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusã€‘åŸºäºVSM Studioé©±åŠ¨LM016é©±åŠ¨æ¨¡æ¿</title>
      <link href="/2024/03/Proteus-Proteus%E5%9F%BA%E4%BA%8EVSM-Studio%E9%A9%B1%E5%8A%A8LM016%E9%A9%B1%E5%8A%A8%E6%A8%A1%E6%9D%BF/"/>
      <url>/2024/03/Proteus-Proteus%E5%9F%BA%E4%BA%8EVSM-Studio%E9%A9%B1%E5%8A%A8LM016%E9%A9%B1%E5%8A%A8%E6%A8%A1%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusã€‘åŸºäºVSM-Studioé©±åŠ¨LM016é©±åŠ¨æ¨¡æ¿"><a href="#ã€Proteusã€‘åŸºäºVSM-Studioé©±åŠ¨LM016é©±åŠ¨æ¨¡æ¿" class="headerlink" title="ã€Proteusã€‘åŸºäºVSM Studioé©±åŠ¨LM016é©±åŠ¨æ¨¡æ¿"></a>ã€Proteusã€‘åŸºäºVSM Studioé©±åŠ¨LM016é©±åŠ¨æ¨¡æ¿</h1><h3 id="ã€Proteusã€‘åŸºäºVSM-Studioé©±åŠ¨LM016é©±åŠ¨æ¨¡æ¿-1"><a href="#ã€Proteusã€‘åŸºäºVSM-Studioé©±åŠ¨LM016é©±åŠ¨æ¨¡æ¿-1" class="headerlink" title="ã€Proteusã€‘åŸºäºVSM Studioé©±åŠ¨LM016é©±åŠ¨æ¨¡æ¿"></a>ã€Proteusã€‘åŸºäºVSM Studioé©±åŠ¨LM016é©±åŠ¨æ¨¡æ¿</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/76561b22418a4832b752850119ff857f.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åºä»£ç "><a href="#ä¸»ç¨‹åºä»£ç " class="headerlink" title="ä¸»ç¨‹åºä»£ç "></a>ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨æ—¥ 6æœˆ 5 2022</span><br><span class="line"> * Processor: AT89C52</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">//#include &lt;stdio.h&gt;</span><br><span class="line">#include &quot;LCD1602driver.h&quot;</span><br><span class="line">unsigned int Result=0;</span><br><span class="line">void main(void)</span><br><span class="line"> &#123; </span><br><span class="line"></span><br><span class="line">LCD_Init();</span><br><span class="line">   while (1)&#123;</span><br><span class="line">Result++;</span><br><span class="line">Delay(800);</span><br><span class="line">LCD_ShowNum(1,1,Result,3);//æ˜¾ç¤º3ä½è®¡æ•°</span><br><span class="line">LCD_ShowString(1,5,&quot;Perseverance&quot;);//æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">LCD_ShowSignedNum(2,1,9527,4);// æ˜¾ç¤º4ä½æ•´å‹æ•°</span><br><span class="line">LCD_ShowChar(2,6,0XDF);//æ˜¾ç¤ºâ€˜ Â°â€™</span><br><span class="line">LCD_ShowChar(2,7,&#x27;C&#x27;);//æ˜¾ç¤ºâ€˜Câ€™</span><br><span class="line">LCD_ShowHexNum(2,9,255,2);//æ˜¾ç¤º&#x27;FF&#x27;</span><br><span class="line">LCD_ShowBinNum(2,12,15,4);//æ˜¾ç¤ºâ€˜1111â€™</span><br><span class="line"></span><br><span class="line">//LCD_WriteCommand(0x01);//å…‰æ ‡å¤ä½ï¼Œæ¸…å±</span><br><span class="line">&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨æ—¥ 6æœˆ 5 2022</li><li>Processor: AT89C52</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include &lt;reg52.h&gt;<br>&#x2F;&#x2F;#include &lt;stdio.h&gt;<br>#include â€œLCD1602driver.hâ€<br>unsigned int Result&#x3D;0;<br>void main(void)<br> { </p><pre><code>LCD_Init();</code></pre><p>   while (1){<br>        Result++;<br>        Delay(800);<br>        LCD_ShowNum(1,1,Result,3);&#x2F;&#x2F;æ˜¾ç¤º3ä½è®¡æ•°<br>        LCD_ShowString(1,5,â€Perseveranceâ€);&#x2F;&#x2F;æ˜¾ç¤ºå­—ç¬¦ä¸²<br>        LCD_ShowSignedNum(2,1,9527,4);&#x2F;&#x2F; æ˜¾ç¤º4ä½æ•´å‹æ•°<br>        LCD_ShowChar(2,6,0XDF);&#x2F;&#x2F;æ˜¾ç¤ºâ€˜ Â°â€™<br>        LCD_ShowChar(2,7,â€™Câ€™);&#x2F;&#x2F;æ˜¾ç¤ºâ€˜Câ€™<br>        LCD_ShowHexNum(2,9,255,2);&#x2F;&#x2F;æ˜¾ç¤ºâ€™FFâ€™<br>        LCD_ShowBinNum(2,12,15,4);&#x2F;&#x2F;æ˜¾ç¤ºâ€˜1111â€™</p><p>&#x2F;&#x2F;LCD_WriteCommand(0x01);&#x2F;&#x2F;å…‰æ ‡å¤ä½ï¼Œæ¸…å±<br>}<br> }&#96;</p><h4 id="èµ„æºæ–‡ä»¶"><a href="#èµ„æºæ–‡ä»¶" class="headerlink" title="èµ„æºæ–‡ä»¶"></a>èµ„æºæ–‡ä»¶</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1w1o8fhwLRJSHTfBD_JniNQ </span><br><span class="line">æå–ç ï¼š0ohu</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1w1o8fhwLRJSHTfBD_JniNQ  æå–ç ï¼š0ohu</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶</title>
      <link href="/2024/03/VSM-VSM-Studio-uln2003%E9%A9%B1%E5%8A%A8%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E5%8D%95%E6%8C%89%E9%94%AE%E5%90%AF%E4%BF%9D%E5%81%9C%E6%AD%A3%E5%8F%8D%E8%BD%AC%E5%85%AB%E6%8B%8D%E6%8E%A7%E5%88%B6/"/>
      <url>/2024/03/VSM-VSM-Studio-uln2003%E9%A9%B1%E5%8A%A8%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E5%8D%95%E6%8C%89%E9%94%AE%E5%90%AF%E4%BF%9D%E5%81%9C%E6%AD%A3%E5%8F%8D%E8%BD%AC%E5%85%AB%E6%8B%8D%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="VSM-Studio-uln2003é©±åŠ¨æ­¥è¿›ç”µæœº-å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶"><a href="#VSM-Studio-uln2003é©±åŠ¨æ­¥è¿›ç”µæœº-å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶" class="headerlink" title="VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶"></a>VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶</h1><h3 id="VSM-Studio-uln2003é©±åŠ¨æ­¥è¿›ç”µæœº-å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶-1"><a href="#VSM-Studio-uln2003é©±åŠ¨æ­¥è¿›ç”µæœº-å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶-1" class="headerlink" title="VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶"></a>VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/a67509c804d444f0bc97a75b8f5cfe44.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="åŸºäº51å•ç‰‡æœºï¼Œæ­¥è¿›ç”µæœºé‡‡ç”¨8èŠ‚æ‹æ§åˆ¶"><a href="#åŸºäº51å•ç‰‡æœºï¼Œæ­¥è¿›ç”µæœºé‡‡ç”¨8èŠ‚æ‹æ§åˆ¶" class="headerlink" title="åŸºäº51å•ç‰‡æœºï¼Œæ­¥è¿›ç”µæœºé‡‡ç”¨8èŠ‚æ‹æ§åˆ¶"></a>åŸºäº51å•ç‰‡æœºï¼Œæ­¥è¿›ç”µæœºé‡‡ç”¨8èŠ‚æ‹æ§åˆ¶</h5><h4 id="VSM-Studioä»£ç "><a href="#VSM-Studioä»£ç " class="headerlink" title="VSM Studioä»£ç "></a>VSM Studioä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨äºŒ 6æœˆ 7 2022</span><br><span class="line"> * Processor: AT89C51</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line">#include &lt;REGX52.H&gt;</span><br><span class="line">typedef unsigned char   uchar;</span><br><span class="line">typedef unsigned int    uint;</span><br><span class="line">sbit LED = P1^0;</span><br><span class="line">uchar const sequence[8] = &#123;0x02,0x06,0x04,0x0c,0x08,0x09,0x01,0x03&#125;;//8æ‹æ§åˆ¶</span><br><span class="line">#define out_port  (P2)</span><br><span class="line">sbit  interruptPin = P3^2;</span><br><span class="line">#define HIGH  (1)</span><br><span class="line">#define LOW (0)</span><br><span class="line">#define  Speed 120//é€Ÿåº¦</span><br><span class="line">#define FOSC 12000000L</span><br><span class="line">#define T1MS (65536-FOSC/12/1000)   //1ms timer calculation method in 12T mode</span><br><span class="line">static volatile unsigned char keyFlag = 0  ;//æŒ‰é”®çŠ¶æ€</span><br><span class="line">void fanzhuan();</span><br><span class="line">void zhengzhuan();</span><br><span class="line">void Stop();</span><br><span class="line"></span><br><span class="line">void exint0() interrupt 0           //(location at 0003H)</span><br><span class="line">&#123;</span><br><span class="line">     keyFlag++;</span><br><span class="line">keyFlag%=3;</span><br><span class="line">&#125;</span><br><span class="line">/* Timer0 å»¶æ—¶ */</span><br><span class="line">void delay(unsigned int t)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int count = 0;</span><br><span class="line">  TMOD |= 0x01;</span><br><span class="line">  TH0 = 0xFC;</span><br><span class="line">  TL0 = 0x66;</span><br><span class="line">  TR0 = 1;</span><br><span class="line">  while (1)</span><br><span class="line">  &#123;</span><br><span class="line">    if (TF0 == 1)</span><br><span class="line">    &#123;</span><br><span class="line">      count++;</span><br><span class="line">      TF0 = 0;</span><br><span class="line">      TH0 = 0xFC;</span><br><span class="line">      TL0 = 0x66;</span><br><span class="line">    &#125;</span><br><span class="line">    if (count &gt;= t)</span><br><span class="line">    &#123;</span><br><span class="line">      break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line"> IT0 = 1;                        //set INT0 int type (1:Falling 0:Low level)</span><br><span class="line">    EX0 = 1;                        //enable INT0 interrupt</span><br><span class="line">    EA = 1;                         //open global interrupt switch</span><br><span class="line">   out_port = 0x03;</span><br><span class="line">while(1)</span><br><span class="line"> &#123;</span><br><span class="line"> if(keyFlag)keyFlag==1? zhengzhuan():fanzhuan(); else  Stop();</span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Stop()&#123;</span><br><span class="line">  //è¿™é‡Œå¯ä»¥å¡«å†™å…¶ä»–æ§åˆ¶ä»£ç </span><br><span class="line">     out_port = 0X0f;</span><br><span class="line">     LED= LOW;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">void zhengzhuan()&#123; </span><br><span class="line">static unsigned char i=0;</span><br><span class="line">i = i&lt;8 ? i+1 : 0;</span><br><span class="line">         out_port = sequence[i];</span><br><span class="line">LED = !LED;</span><br><span class="line">delay(Speed);//æ­¤æ•°å€¼å¿…é¡»å¤§äº100ï¼Œå¦åˆ™ä»¿çœŸçš„æ—¶å€™ä¼šæŠ–åŠ¨ .</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">void fanzhuan()&#123;</span><br><span class="line">static unsigned char k=0;</span><br><span class="line">k = k&gt;0 ? k-1 : 7;</span><br><span class="line">   out_port = sequence[k];</span><br><span class="line">     LED= !LED;</span><br><span class="line">delay(Speed);//æ­¤æ•°å€¼å¿…é¡»å¤§äº100ï¼Œå¦åˆ™ä»¿çœŸçš„æ—¶å€™ä¼šæŠ–åŠ¨ .</span><br><span class="line"></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨äºŒ 6æœˆ 7 2022</li><li>Processor: AT89C51</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include &lt;REGX52.H&gt;<br>typedef unsigned char   uchar;<br>typedef unsigned int    uint;<br>sbit LED &#x3D; P1^0;<br>uchar const sequence[8] &#x3D; {0x02,0x06,0x04,0x0c,0x08,0x09,0x01,0x03};&#x2F;&#x2F;8æ‹æ§åˆ¶<br>#define out_port  (P2)<br>sbit  interruptPin &#x3D; P3^2;<br>#define HIGH  (1)<br>#define LOW (0)<br>#define  Speed 120&#x2F;&#x2F;é€Ÿåº¦<br>#define FOSC 12000000L<br>#define T1MS (65536-FOSC&#x2F;12&#x2F;1000)   &#x2F;&#x2F;1ms timer calculation method in 12T mode<br>static volatile unsigned char keyFlag &#x3D; 0  ;&#x2F;&#x2F;æŒ‰é”®çŠ¶æ€<br>void fanzhuan();<br>void zhengzhuan();<br>void Stop();</p><p>void exint0() interrupt 0           &#x2F;&#x2F;(location at 0003H)<br>{<br>     keyFlag++;<br>        keyFlag%&#x3D;3;<br>}<br>&#x2F;* Timer0 å»¶æ—¶ *&#x2F;<br>void delay(unsigned int t)<br>{<br>  unsigned int count &#x3D; 0;<br>  TMOD |&#x3D; 0x01;<br>  TH0 &#x3D; 0xFC;<br>  TL0 &#x3D; 0x66;<br>  TR0 &#x3D; 1;<br>  while (1)<br>  {<br>    if (TF0 &#x3D;&#x3D; 1)<br>    {<br>      count++;<br>      TF0 &#x3D; 0;<br>      TH0 &#x3D; 0xFC;<br>      TL0 &#x3D; 0x66;<br>    }<br>    if (count &gt;&#x3D; t)<br>    {<br>      break;<br>    }<br>  }<br>}</p><p>void main() {<br>     IT0 &#x3D; 1;                        &#x2F;&#x2F;set INT0 int type (1:Falling 0:Low level)<br>    EX0 &#x3D; 1;                        &#x2F;&#x2F;enable INT0 interrupt<br>    EA &#x3D; 1;                         &#x2F;&#x2F;open global interrupt switch<br>       out_port &#x3D; 0x03;<br>    while(1)<br> {<br>     if(keyFlag)keyFlag&#x3D;&#x3D;1? zhengzhuan():fanzhuan(); else  Stop();<br> }<br>}</p><p>void Stop(){<br>  &#x2F;&#x2F;è¿™é‡Œå¯ä»¥å¡«å†™å…¶ä»–æ§åˆ¶ä»£ç <br>     out_port &#x3D; 0X0f;<br>     LED&#x3D; LOW;<br>  }</p><p>void zhengzhuan(){<br>                    static unsigned char i&#x3D;0;<br>                i &#x3D; i&lt;8 ? i+1 : 0;<br>         out_port &#x3D; sequence[i];<br>                    LED &#x3D; !LED;<br>delay(Speed);&#x2F;&#x2F;æ­¤æ•°å€¼å¿…é¡»å¤§äº100ï¼Œå¦åˆ™ä»¿çœŸçš„æ—¶å€™ä¼šæŠ–åŠ¨ .</p><pre><code>  &#125;</code></pre><p>void fanzhuan(){<br>    static unsigned char k&#x3D;0;<br>    k &#x3D; k&gt;0 ? k-1 : 7;<br>       out_port &#x3D; sequence[k];<br>     LED&#x3D; !LED;<br>delay(Speed);&#x2F;&#x2F;æ­¤æ•°å€¼å¿…é¡»å¤§äº100ï¼Œå¦åˆ™ä»¿çœŸçš„æ—¶å€™ä¼šæŠ–åŠ¨ .</p><pre><code> &#125;`</code></pre><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1lNtEvPjskcgceoOEQsCiHw </span><br><span class="line">æå–ç ï¼šnwpt</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1lNtEvPjskcgceoOEQsCiHw  æå–ç ï¼šnwpt</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å››æ‹æ§åˆ¶</title>
      <link href="/2024/03/VSM-VSM-Studio-uln2003%E9%A9%B1%E5%8A%A8%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E5%8D%95%E6%8C%89%E9%94%AE%E5%90%AF%E4%BF%9D%E5%81%9C%E6%AD%A3%E5%8F%8D%E8%BD%AC%E5%9B%9B%E6%8B%8D%E6%8E%A7%E5%88%B6/"/>
      <url>/2024/03/VSM-VSM-Studio-uln2003%E9%A9%B1%E5%8A%A8%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E5%8D%95%E6%8C%89%E9%94%AE%E5%90%AF%E4%BF%9D%E5%81%9C%E6%AD%A3%E5%8F%8D%E8%BD%AC%E5%9B%9B%E6%8B%8D%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="VSM-Studio-uln2003é©±åŠ¨æ­¥è¿›ç”µæœº-å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å››æ‹æ§åˆ¶"><a href="#VSM-Studio-uln2003é©±åŠ¨æ­¥è¿›ç”µæœº-å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å››æ‹æ§åˆ¶" class="headerlink" title="VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å››æ‹æ§åˆ¶"></a>VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å››æ‹æ§åˆ¶</h1><h3 id="VSM-Studio-uln2003é©±åŠ¨æ­¥è¿›ç”µæœº-å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å››æ‹æ§åˆ¶-1"><a href="#VSM-Studio-uln2003é©±åŠ¨æ­¥è¿›ç”µæœº-å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å››æ‹æ§åˆ¶-1" class="headerlink" title="VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å››æ‹æ§åˆ¶"></a>VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å››æ‹æ§åˆ¶</h3><ul><li>ç›¸å…³ç¯‡ã€ŠVSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶ã€‹</li><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/125171917">VSM Studio uln2003é©±åŠ¨æ­¥è¿›ç”µæœº+å•æŒ‰é”®å¯ä¿åœæ­£åè½¬å…«æ‹æ§åˆ¶</a></p><p><img src="https://img-blog.csdnimg.cn/ecba01f0e67443dc9e81e6759d076c95.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="åŸºäº51å•ç‰‡æœºï¼Œæ­¥è¿›ç”µæœºé‡‡ç”¨4èŠ‚æ‹æ§åˆ¶"><a href="#åŸºäº51å•ç‰‡æœºï¼Œæ­¥è¿›ç”µæœºé‡‡ç”¨4èŠ‚æ‹æ§åˆ¶" class="headerlink" title="åŸºäº51å•ç‰‡æœºï¼Œæ­¥è¿›ç”µæœºé‡‡ç”¨4èŠ‚æ‹æ§åˆ¶"></a>åŸºäº51å•ç‰‡æœºï¼Œæ­¥è¿›ç”µæœºé‡‡ç”¨4èŠ‚æ‹æ§åˆ¶</h5><h4 id="VSM-Studioä»£ç "><a href="#VSM-Studioä»£ç " class="headerlink" title="VSM Studioä»£ç "></a>VSM Studioä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨äºŒ 6æœˆ 7 2022</span><br><span class="line"> * Processor: AT89C52</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line">#include &lt;REGX52.H&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">typedef unsigned char   uchar;</span><br><span class="line">typedef unsigned int    uint;</span><br><span class="line">sbit LED = P1^0;</span><br><span class="line">uchar const sequence[4] = &#123;0x06,0x0c,0x09,0x03&#125;;//4èŠ‚æ‹æ§åˆ¶</span><br><span class="line">#define out_port  (P2)</span><br><span class="line">sbit  interruptPin = P3^2;</span><br><span class="line">#define HIGH  (1)</span><br><span class="line">#define LOW (0)</span><br><span class="line">#define  Speed 120//é€Ÿåº¦</span><br><span class="line">static volatile unsigned char keyFlag = 0  ;//æŒ‰é”®çŠ¶æ€</span><br><span class="line"></span><br><span class="line">void fanzhuan();</span><br><span class="line">void zhengzhuan();</span><br><span class="line">void Stop();</span><br><span class="line">void delay(unsigned int t);</span><br><span class="line"></span><br><span class="line">void exint0() interrupt 0           //(location at 0003H)</span><br><span class="line">&#123;</span><br><span class="line">     keyFlag++;</span><br><span class="line"> keyFlag%=3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void delay(unsigned int t)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int count = 0;</span><br><span class="line">  TMOD |= 0x01;</span><br><span class="line">  TH0 = 0xFC;</span><br><span class="line">  TL0 = 0x66;</span><br><span class="line">  TR0 = 1;</span><br><span class="line">  while (1)</span><br><span class="line">  &#123;</span><br><span class="line">    if (TF0 == 1)</span><br><span class="line">    &#123;</span><br><span class="line">      count++;</span><br><span class="line">      TF0 = 0;</span><br><span class="line">      TH0 = 0xFC;</span><br><span class="line">      TL0 = 0x66;</span><br><span class="line">    &#125;</span><br><span class="line">    if (count &gt;= t)</span><br><span class="line">    &#123;</span><br><span class="line">      break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">void main() &#123;</span><br><span class="line"> IT0 = 1;                        //set INT0 int type (1:Falling 0:Low level)</span><br><span class="line">    EX0 = 1;                        //enable INT0 interrupt</span><br><span class="line">    EA = 1;                         //open global interrupt switch</span><br><span class="line">out_port = 0x03;</span><br><span class="line">while(1)</span><br><span class="line"> &#123;</span><br><span class="line"> if(keyFlag)keyFlag==1? zhengzhuan():fanzhuan(); else  Stop();</span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Stop()&#123;</span><br><span class="line">  //è¿™é‡Œå¯ä»¥å¡«å†™å…¶ä»–æ§åˆ¶ä»£ç </span><br><span class="line">     out_port = 0X0f;</span><br><span class="line">     LED= LOW;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">void zhengzhuan()&#123; </span><br><span class="line">static unsigned char i=0;</span><br><span class="line">i = i&lt;8 ? i+1 : 0;</span><br><span class="line">         out_port = sequence[i];</span><br><span class="line">LED = !LED;</span><br><span class="line">delay(Speed);//æ­¤æ•°å€¼å¿…é¡»å¤§äº100ï¼Œå¦åˆ™ä»¿çœŸçš„æ—¶å€™ä¼šæŠ–åŠ¨ .</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">void fanzhuan()&#123;</span><br><span class="line">static unsigned char k=0;</span><br><span class="line">k = k&gt;0 ? k-1 : 7;</span><br><span class="line">   out_port = sequence[k];</span><br><span class="line">     LED= !LED;</span><br><span class="line">delay(Speed);//æ­¤æ•°å€¼å¿…é¡»å¤§äº100ï¼Œå¦åˆ™ä»¿çœŸçš„æ—¶å€™ä¼šæŠ–åŠ¨ .</span><br><span class="line"></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨äºŒ 6æœˆ 7 2022</li><li>Processor: AT89C52</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include &lt;REGX52.H&gt;<br>#include &lt;intrins.h&gt;<br>typedef unsigned char   uchar;<br>typedef unsigned int    uint;<br>sbit LED &#x3D; P1^0;<br>uchar const sequence[4] &#x3D; {0x06,0x0c,0x09,0x03};&#x2F;&#x2F;4èŠ‚æ‹æ§åˆ¶<br>#define out_port  (P2)<br>sbit  interruptPin &#x3D; P3^2;<br>#define HIGH  (1)<br>#define LOW (0)<br>#define  Speed 120&#x2F;&#x2F;é€Ÿåº¦<br>static volatile unsigned char keyFlag &#x3D; 0  ;&#x2F;&#x2F;æŒ‰é”®çŠ¶æ€</p><p>void fanzhuan();<br>void zhengzhuan();<br>void Stop();<br>void delay(unsigned int t);</p><p>void exint0() interrupt 0           &#x2F;&#x2F;(location at 0003H)<br>{<br>     keyFlag++;<br>     keyFlag%&#x3D;3;<br>}</p><p>void delay(unsigned int t)<br>{<br>  unsigned int count &#x3D; 0;<br>  TMOD |&#x3D; 0x01;<br>  TH0 &#x3D; 0xFC;<br>  TL0 &#x3D; 0x66;<br>  TR0 &#x3D; 1;<br>  while (1)<br>  {<br>    if (TF0 &#x3D;&#x3D; 1)<br>    {<br>      count++;<br>      TF0 &#x3D; 0;<br>      TH0 &#x3D; 0xFC;<br>      TL0 &#x3D; 0x66;<br>    }<br>    if (count &gt;&#x3D; t)<br>    {<br>      break;<br>    }<br>  }<br>}<br>void main() {<br>     IT0 &#x3D; 1;                        &#x2F;&#x2F;set INT0 int type (1:Falling 0:Low level)<br>    EX0 &#x3D; 1;                        &#x2F;&#x2F;enable INT0 interrupt<br>    EA &#x3D; 1;                         &#x2F;&#x2F;open global interrupt switch<br>out_port &#x3D; 0x03;<br>    while(1)<br> {<br>     if(keyFlag)keyFlag&#x3D;&#x3D;1? zhengzhuan():fanzhuan(); else  Stop();<br> }<br>}</p><p>void Stop(){<br>  &#x2F;&#x2F;è¿™é‡Œå¯ä»¥å¡«å†™å…¶ä»–æ§åˆ¶ä»£ç <br>     out_port &#x3D; 0X0f;<br>     LED&#x3D; LOW;<br>  }</p><p>void zhengzhuan(){<br>        static unsigned char i&#x3D;0;<br>                i &#x3D; i&lt;8 ? i+1 : 0;<br>         out_port &#x3D; sequence[i];<br>                    LED &#x3D; !LED;<br>delay(Speed);&#x2F;&#x2F;æ­¤æ•°å€¼å¿…é¡»å¤§äº100ï¼Œå¦åˆ™ä»¿çœŸçš„æ—¶å€™ä¼šæŠ–åŠ¨ .</p><pre><code>  &#125;</code></pre><p>void fanzhuan(){<br>    static unsigned char k&#x3D;0;<br>    k &#x3D; k&gt;0 ? k-1 : 7;<br>       out_port &#x3D; sequence[k];<br>     LED&#x3D; !LED;<br>delay(Speed);&#x2F;&#x2F;æ­¤æ•°å€¼å¿…é¡»å¤§äº100ï¼Œå¦åˆ™ä»¿çœŸçš„æ—¶å€™ä¼šæŠ–åŠ¨ .</p><pre><code> &#125;`</code></pre><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1g8WmQTIR5M5ynU8NPrpxjg </span><br><span class="line">æå–ç ï¼šr7ri</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1g8WmQTIR5M5ynU8NPrpxjg  æå–ç ï¼šr7ri</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>VSM Studio ç›´æµç”µæœºHæ¡¥é©±åŠ¨PWM å•å‘æ§åˆ¶</title>
      <link href="/2024/03/VSM-VSM-Studio-%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BAH%E6%A1%A5%E9%A9%B1%E5%8A%A8PWM-%E5%8D%95%E5%90%91%E6%8E%A7%E5%88%B6/"/>
      <url>/2024/03/VSM-VSM-Studio-%E7%9B%B4%E6%B5%81%E7%94%B5%E6%9C%BAH%E6%A1%A5%E9%A9%B1%E5%8A%A8PWM-%E5%8D%95%E5%90%91%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="VSM-Studio-ç›´æµç”µæœºHæ¡¥é©±åŠ¨PWM-å•å‘æ§åˆ¶"><a href="#VSM-Studio-ç›´æµç”µæœºHæ¡¥é©±åŠ¨PWM-å•å‘æ§åˆ¶" class="headerlink" title="VSM Studio ç›´æµç”µæœºHæ¡¥é©±åŠ¨PWM å•å‘æ§åˆ¶"></a>VSM Studio ç›´æµç”µæœºHæ¡¥é©±åŠ¨PWM å•å‘æ§åˆ¶</h1><h3 id="VSM-Studio-ç›´æµç”µæœºHæ¡¥é©±åŠ¨PWM-å•å‘æ§åˆ¶-1"><a href="#VSM-Studio-ç›´æµç”µæœºHæ¡¥é©±åŠ¨PWM-å•å‘æ§åˆ¶-1" class="headerlink" title="VSM Studio ç›´æµç”µæœºHæ¡¥é©±åŠ¨PWM å•å‘æ§åˆ¶"></a>VSM Studio ç›´æµç”µæœºHæ¡¥é©±åŠ¨PWM å•å‘æ§åˆ¶</h3><ul><li>Proteusä»¿çœŸ</li></ul><p><img src="https://img-blog.csdnimg.cn/925eb23e77624a44ba389afff8642565.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="VSM-Studio-ä»£ç "><a href="#VSM-Studio-ä»£ç " class="headerlink" title="VSM Studio ä»£ç "></a>VSM Studio ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨äºŒ 6æœˆ 7 2022</span><br><span class="line"> * Processor: AT89C52</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;REGX52.H&gt;</span><br><span class="line">#include &lt;intrins.H&gt;</span><br><span class="line"></span><br><span class="line">// Define P3 pins</span><br><span class="line">sbit Inc =P3^4; </span><br><span class="line">sbit Dec  = P3^5;</span><br><span class="line">sbit Dir =  P3^6 ;</span><br><span class="line">sbit PWM  = P3^7;</span><br><span class="line"></span><br><span class="line">// Define new types</span><br><span class="line">typedef unsigned char   uchar;</span><br><span class="line">typedef unsigned int    uint;</span><br><span class="line"></span><br><span class="line">void delay(uint);</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line"> &#123; </span><br><span class="line"> int speed;</span><br><span class="line">   // Select initial direction and speed.</span><br><span class="line">   Dir = 1;</span><br><span class="line">   if (Dir)</span><br><span class="line">      speed = 400;</span><br><span class="line">   else</span><br><span class="line">      speed = 100;</span><br><span class="line">   while(1)</span><br><span class="line">    &#123; if(!Inc)</span><br><span class="line">      // Increase speed   </span><br><span class="line">         speed = speed &gt; 0 ? speed - 1 : 0;</span><br><span class="line">      if(!Dec)</span><br><span class="line">      // Decrease speed</span><br><span class="line">         speed = speed &lt; 500 ? speed + 1 : 500;</span><br><span class="line">      </span><br><span class="line">      // Drive a PWM signal out. </span><br><span class="line">      PWM=1;</span><br><span class="line">      delay(speed);</span><br><span class="line">      PWM=0;</span><br><span class="line">      delay(500-speed);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">void delay(uint j)</span><br><span class="line"> &#123; for(; j&gt;0; j--)</span><br><span class="line">    &#123; </span><br><span class="line">_nop_();</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨äºŒ 6æœˆ 7 2022</li><li>Processor: AT89C52</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include &lt;REGX52.H&gt;<br>#include &lt;intrins.H&gt;</p><p>&#x2F;&#x2F; Define P3 pins<br>sbit Inc &#x3D;P3^4;<br>sbit Dec  &#x3D; P3^5;<br>sbit Dir &#x3D;  P3^6 ;<br>sbit PWM  &#x3D; P3^7;</p><p>&#x2F;&#x2F; Define new types<br>typedef unsigned char   uchar;<br>typedef unsigned int    uint;</p><p>void delay(uint);</p><p>void main(void)<br> {<br>     int speed;<br>   &#x2F;&#x2F; Select initial direction and speed.<br>   Dir &#x3D; 1;<br>   if (Dir)<br>      speed &#x3D; 400;<br>   else<br>      speed &#x3D; 100;<br>   while(1)<br>    { if(!Inc)<br>      &#x2F;&#x2F; Increase speed<br>         speed &#x3D; speed &gt; 0 ? speed - 1 : 0;<br>      if(!Dec)<br>      &#x2F;&#x2F; Decrease speed<br>         speed &#x3D; speed &lt; 500 ? speed + 1 : 500;</p><pre><code>  // Drive a PWM signal out.   PWM=1;  delay(speed);  PWM=0;  delay(500-speed);&#125;</code></pre><p> }</p><p>void delay(uint j)<br> { for(; j&gt;0; jâ€“)<br>    {<br>            <em>nop</em>();<br>    }<br> }&#96;</p><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1a1oIn0mIsth85X3W7tAbRg </span><br><span class="line">æå–ç ï¼šukg5</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1a1oIn0mIsth85X3W7tAbRg  æå–ç ï¼šukg5</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„åŠ å‡è¿ç®—</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F4X4%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE%E6%89%AB%E6%8F%8F%E7%BB%84%E6%88%90%E7%9A%84%E5%8A%A0%E5%87%8F%E8%BF%90%E7%AE%97/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F4X4%E7%9F%A9%E9%98%B5%E6%8C%89%E9%94%AE%E6%89%AB%E6%8F%8F%E7%BB%84%E6%88%90%E7%9A%84%E5%8A%A0%E5%87%8F%E8%BF%90%E7%AE%97/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„åŠ å‡è¿ç®—"><a href="#ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„åŠ å‡è¿ç®—" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„åŠ å‡è¿ç®—"></a>ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„åŠ å‡è¿ç®—</h1><h3 id="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„åŠ å‡è¿ç®—-1"><a href="#ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„åŠ å‡è¿ç®—-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„åŠ å‡è¿ç®—"></a>ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„åŠ å‡è¿ç®—</h3><ul><li>ã€Šã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨ã€‹</li><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/125290001">ã€Proteusä»¿çœŸã€‘4X4çŸ©é˜µæŒ‰é”®æ‰«æç»„æˆçš„ç®€æ˜“åŠ æ³•å™¨</a></p><p><img src="https://img-blog.csdnimg.cn/345e5b32caaa4bf1a5d27f58a7b34773.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="æ“ä½œè¯´æ˜"><a href="#æ“ä½œè¯´æ˜" class="headerlink" title="æ“ä½œè¯´æ˜"></a>æ“ä½œè¯´æ˜</h4><p>æ”¯æŒåŠ å’Œå‡è¿ç®—ï¼Œä½†ä¸æ”¯æŒè¿ç»­åŠ å‡æ“ä½œã€‚</p><h4 id="VSM-Studioä»£ç "><a href="#VSM-Studioä»£ç " class="headerlink" title="VSM Studioä»£ç "></a>VSM Studioä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line"></span><br><span class="line">sbit ADDR0 = P1^0;</span><br><span class="line">sbit ADDR1 = P1^1;</span><br><span class="line">sbit ADDR2 = P1^2;</span><br><span class="line">sbit ADDR3 = P1^3;</span><br><span class="line">sbit ENLED = P1^4;</span><br><span class="line">sbit KEY_IN_1  = P2^4;</span><br><span class="line">sbit KEY_IN_2  = P2^5;</span><br><span class="line">sbit KEY_IN_3  = P2^6;</span><br><span class="line">sbit KEY_IN_4  = P2^7;</span><br><span class="line">sbit KEY_OUT_1 = P2^3;</span><br><span class="line">sbit KEY_OUT_2 = P2^2;</span><br><span class="line">sbit KEY_OUT_3 = P2^1;</span><br><span class="line">sbit KEY_OUT_4 = P2^0;</span><br><span class="line"></span><br><span class="line">unsigned char code LedChar[] = &#123;  //æ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦è½¬æ¢è¡¨</span><br><span class="line">    0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8,</span><br><span class="line">    0x80, 0x90, 0x88, 0x83, 0xC6, 0xA1, 0x86, 0x8E</span><br><span class="line">&#125;;</span><br><span class="line">unsigned char LedBuff[6] = &#123;  //æ•°ç ç®¡æ˜¾ç¤ºç¼“å†²åŒº</span><br><span class="line">    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF</span><br><span class="line">&#125;;</span><br><span class="line">unsigned char code KeyCodeMap[4][4] = &#123; //çŸ©é˜µæŒ‰é”®ç¼–å·åˆ°æ ‡å‡†é”®ç›˜é”®ç çš„æ˜ å°„è¡¨</span><br><span class="line">    &#123; 0x31, 0x32, 0x33, 0x26 &#125;, //æ•°å­—é”®1ã€æ•°å­—é”®2ã€æ•°å­—é”®3ã€å‘ä¸Šé”®</span><br><span class="line">    &#123; 0x34, 0x35, 0x36, 0x25 &#125;, //æ•°å­—é”®4ã€æ•°å­—é”®5ã€æ•°å­—é”®6ã€å‘å·¦é”®</span><br><span class="line">    &#123; 0x37, 0x38, 0x39, 0x28 &#125;, //æ•°å­—é”®7ã€æ•°å­—é”®8ã€æ•°å­—é”®9ã€å‘ä¸‹é”®</span><br><span class="line">    &#123; 0x30, 0x1B, 0x0D, 0x27 &#125;  //æ•°å­—é”®0ã€ESCé”®ã€  å›è½¦é”®ã€ å‘å³é”®</span><br><span class="line">&#125;;</span><br><span class="line">unsigned char KeySta[4][4] = &#123;  //å…¨éƒ¨çŸ©é˜µæŒ‰é”®çš„å½“å‰çŠ¶æ€</span><br><span class="line">    &#123;1, 1, 1, 1&#125;,  &#123;1, 1, 1, 1&#125;,  &#123;1, 1, 1, 1&#125;,  &#123;1, 1, 1, 1&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void KeyDriver();</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    EA = 1;       //ä½¿èƒ½æ€»ä¸­æ–­</span><br><span class="line">    ENLED = 0;    //é€‰æ‹©æ•°ç ç®¡è¿›è¡Œæ˜¾ç¤º</span><br><span class="line">    ADDR3 = 1;</span><br><span class="line">    TMOD = 0x01;  //è®¾ç½®T0ä¸ºæ¨¡å¼1</span><br><span class="line">    TH0  = 0xFC;  //ä¸ºT0èµ‹åˆå€¼0xFC67ï¼Œå®šæ—¶1ms</span><br><span class="line">    TL0  = 0x67;</span><br><span class="line">    ET0  = 1;     //ä½¿èƒ½T0ä¸­æ–­</span><br><span class="line">    TR0  = 1;     //å¯åŠ¨T0</span><br><span class="line">    LedBuff[0] = LedChar[0];  //ä¸Šç”µæ˜¾ç¤º0</span><br><span class="line"></span><br><span class="line">    while (1)</span><br><span class="line">    &#123;</span><br><span class="line">        KeyDriver();   //è°ƒç”¨æŒ‰é”®é©±åŠ¨å‡½æ•°</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/* å°†ä¸€ä¸ªæœ‰ç¬¦å·é•¿æ•´å‹çš„æ•°å­—æ˜¾ç¤ºåˆ°æ•°ç ç®¡ä¸Šï¼Œnum-å¾…æ˜¾ç¤ºæ•°å­— */</span><br><span class="line">void ShowNumber(long num)</span><br><span class="line">&#123;</span><br><span class="line">    signed char i;</span><br><span class="line">    unsigned char sign;</span><br><span class="line">    unsigned char buf[6];</span><br><span class="line">    </span><br><span class="line">    if (num &lt; 0)  //é¦–å…ˆæå–å¹¶æš‚å­˜ç¬¦å·ä½</span><br><span class="line">    &#123;</span><br><span class="line">        sign = 1;</span><br><span class="line">        num = -num;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        sign = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    for (i=0; i&lt;6; i++)   //æŠŠé•¿æ•´å‹æ•°è½¬æ¢ä¸º6ä½åè¿›åˆ¶çš„æ•°ç»„</span><br><span class="line">    &#123;</span><br><span class="line">        buf[i] = num % 10;</span><br><span class="line">        num = num / 10;</span><br><span class="line">    &#125;</span><br><span class="line">    for (i=5; i&gt;=1; i--)  //ä»æœ€é«˜ä½èµ·ï¼Œé‡åˆ°0è½¬æ¢ä¸ºç©ºæ ¼ï¼Œé‡åˆ°é0åˆ™é€€å‡ºå¾ªç¯</span><br><span class="line">    &#123;</span><br><span class="line">        if (buf[i] == 0)</span><br><span class="line">            LedBuff[i] = 0xFF;</span><br><span class="line">        else</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    if (sign != 0)        //è´Ÿæ•°æ—¶ï¼Œéœ€åœ¨æœ€å‰é¢æ·»åŠ è´Ÿå·</span><br><span class="line">    &#123;</span><br><span class="line">        if (i &lt; 5)        //å½“æœ‰æ•ˆä½æ•°å°äº6ä½æ—¶æ·»åŠ è´Ÿå·ï¼Œå¦åˆ™æ˜¾ç¤ºç»“æœå°†æ˜¯é”™çš„</span><br><span class="line">        &#123;</span><br><span class="line">            LedBuff[i+1] = 0xBF;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    for ( ; i&gt;=0; i--)    //å‰©ä½™ä½ä½éƒ½å¦‚å®è½¬æ¢ä¸ºæ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦</span><br><span class="line">    &#123;</span><br><span class="line">        LedBuff[i] = LedChar[buf[i]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/* æŒ‰é”®åŠ¨ä½œå‡½æ•°ï¼Œæ ¹æ®é”®ç æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œkeycode-æŒ‰é”®é”®ç  */</span><br><span class="line">void KeyAction(unsigned char keycode)</span><br><span class="line">&#123;</span><br><span class="line">    static char oprt = 0;    //ç”¨äºä¿å­˜åŠ å‡è¿ç®—ç¬¦</span><br><span class="line">    static long result = 0;  //ç”¨äºä¿å­˜è¿ç®—ç»“æœ</span><br><span class="line">    static long addend = 0;  //ç”¨äºä¿å­˜è¾“å…¥çš„åŠ æ•°</span><br><span class="line">    </span><br><span class="line">    if ((keycode&gt;=0x30) &amp;&amp; (keycode&lt;=0x39))  //è¾“å…¥0-9çš„æ•°å­—</span><br><span class="line">    &#123;</span><br><span class="line">        addend = (addend*10)+(keycode-0x30); //æ•´ä½“åè¿›åˆ¶å·¦ç§»ï¼Œæ–°æ•°å­—è¿›å…¥ä¸ªä½</span><br><span class="line">        ShowNumber(addend);    //è¿ç®—ç»“æœæ˜¾ç¤ºåˆ°æ•°ç ç®¡</span><br><span class="line">    &#125;</span><br><span class="line">    else if (keycode == 0x26)  //å‘ä¸Šé”®ç”¨ä½œåŠ å·</span><br><span class="line">    &#123;</span><br><span class="line">        oprt = 0;              //è®¾ç½®è¿ç®—ç¬¦å˜é‡</span><br><span class="line">        result = addend;       //è¿ç®—æ•°å­˜åˆ°ç»“æœä¸­ï¼Œå‡†å¤‡è¿›è¡ŒåŠ å‡</span><br><span class="line">        addend = 0;            //æ¸…é›¶è¿ç®—æ•°ï¼Œå‡†å¤‡æ¥æ”¶ä¸‹ä¸€ä¸ªè¿ç®—æ•°</span><br><span class="line">        ShowNumber(addend);    //åˆ·æ–°æ•°ç ç®¡æ˜¾ç¤º</span><br><span class="line">    &#125;</span><br><span class="line">    else if (keycode == 0x28)  //å‘ä¸‹é”®ç”¨ä½œå‡å·</span><br><span class="line">    &#123;</span><br><span class="line">        oprt = 1;              //è®¾ç½®è¿ç®—ç¬¦å˜é‡</span><br><span class="line">        result = addend;       //è¿ç®—æ•°å­˜åˆ°ç»“æœä¸­ï¼Œå‡†å¤‡è¿›è¡ŒåŠ å‡</span><br><span class="line">        addend = 0;            //æ¸…é›¶è¿ç®—æ•°ï¼Œå‡†å¤‡æ¥æ”¶ä¸‹ä¸€ä¸ªè¿ç®—æ•°</span><br><span class="line">        ShowNumber(addend);    //åˆ·æ–°æ•°ç ç®¡æ˜¾ç¤º</span><br><span class="line">    &#125;</span><br><span class="line">    else if (keycode == 0x0D)  //å›è½¦é”®ï¼Œæ‰§è¡ŒåŠ å‡è¿ç®—</span><br><span class="line">    &#123;</span><br><span class="line">        if (oprt == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            result += addend;  //è¿›è¡ŒåŠ æ³•è¿ç®—</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            result -= addend;  //è¿›è¡Œå‡æ³•è¿ç®—</span><br><span class="line">        &#125;</span><br><span class="line">        addend = 0;</span><br><span class="line">        ShowNumber(result);    //è¿ç®—ç»“æœæ˜¾ç¤ºåˆ°æ•°ç ç®¡</span><br><span class="line">    &#125;</span><br><span class="line">    else if (keycode == 0x1B)  //Escé”®ï¼Œæ¸…é›¶ç»“æœ</span><br><span class="line">    &#123;</span><br><span class="line">        addend = 0;</span><br><span class="line">        result = 0;</span><br><span class="line">        ShowNumber(addend);    //æ¸…é›¶åçš„åŠ æ•°æ˜¾ç¤ºåˆ°æ•°ç ç®¡</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/* æŒ‰é”®é©±åŠ¨å‡½æ•°ï¼Œæ£€æµ‹æŒ‰é”®åŠ¨ä½œï¼Œè°ƒåº¦ç›¸åº”åŠ¨ä½œå‡½æ•°ï¼Œéœ€åœ¨ä¸»å¾ªç¯ä¸­è°ƒç”¨ */</span><br><span class="line">void KeyDriver()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char i, j;</span><br><span class="line">    static unsigned char backup[4][4] = &#123;  //æŒ‰é”®å€¼å¤‡ä»½ï¼Œä¿å­˜å‰ä¸€æ¬¡çš„å€¼</span><br><span class="line">        &#123;1, 1, 1, 1&#125;,  &#123;1, 1, 1, 1&#125;,  &#123;1, 1, 1, 1&#125;,  &#123;1, 1, 1, 1&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    for (i=0; i&lt;4; i++)  //å¾ªç¯æ£€æµ‹4*4çš„çŸ©é˜µæŒ‰é”®</span><br><span class="line">    &#123;</span><br><span class="line">        for (j=0; j&lt;4; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            if (backup[i][j] != KeySta[i][j])    //æ£€æµ‹æŒ‰é”®åŠ¨ä½œ</span><br><span class="line">            &#123;</span><br><span class="line">                if (backup[i][j] != 0)           //æŒ‰é”®æŒ‰ä¸‹æ—¶æ‰§è¡ŒåŠ¨ä½œ</span><br><span class="line">                &#123;</span><br><span class="line">                    KeyAction(KeyCodeMap[i][j]); //è°ƒç”¨æŒ‰é”®åŠ¨ä½œå‡½æ•°</span><br><span class="line">                &#125;</span><br><span class="line">                backup[i][j] = KeySta[i][j];     //åˆ·æ–°å‰ä¸€æ¬¡çš„å¤‡ä»½å€¼</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/* æŒ‰é”®æ‰«æå‡½æ•°ï¼Œéœ€åœ¨å®šæ—¶ä¸­æ–­ä¸­è°ƒç”¨ï¼Œæ¨èè°ƒç”¨é—´éš”1ms */</span><br><span class="line">void KeyScan()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char i;</span><br><span class="line">    static unsigned char keyout = 0;   //çŸ©é˜µæŒ‰é”®æ‰«æè¾“å‡ºç´¢å¼•</span><br><span class="line">    static unsigned char keybuf[4][4] = &#123;  //çŸ©é˜µæŒ‰é”®æ‰«æç¼“å†²åŒº</span><br><span class="line">        &#123;0xFF, 0xFF, 0xFF, 0xFF&#125;,  &#123;0xFF, 0xFF, 0xFF, 0xFF&#125;,</span><br><span class="line">        &#123;0xFF, 0xFF, 0xFF, 0xFF&#125;,  &#123;0xFF, 0xFF, 0xFF, 0xFF&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //å°†ä¸€è¡Œçš„4ä¸ªæŒ‰é”®å€¼ç§»å…¥ç¼“å†²åŒº</span><br><span class="line">    keybuf[keyout][0] = (keybuf[keyout][0] &lt;&lt; 1) | KEY_IN_1;</span><br><span class="line">    keybuf[keyout][1] = (keybuf[keyout][1] &lt;&lt; 1) | KEY_IN_2;</span><br><span class="line">    keybuf[keyout][2] = (keybuf[keyout][2] &lt;&lt; 1) | KEY_IN_3;</span><br><span class="line">    keybuf[keyout][3] = (keybuf[keyout][3] &lt;&lt; 1) | KEY_IN_4;</span><br><span class="line">    //æ¶ˆæŠ–åæ›´æ–°æŒ‰é”®çŠ¶æ€</span><br><span class="line">    for (i=0; i&lt;4; i++)  //æ¯è¡Œ4ä¸ªæŒ‰é”®ï¼Œæ‰€ä»¥å¾ªç¯4æ¬¡</span><br><span class="line">    &#123;</span><br><span class="line">        if ((keybuf[keyout][i] &amp; 0x0F) == 0x00)</span><br><span class="line">        &#123;   //è¿ç»­4æ¬¡æ‰«æå€¼ä¸º0ï¼Œå³4*4mså†…éƒ½æ˜¯æŒ‰ä¸‹çŠ¶æ€æ—¶ï¼Œå¯è®¤ä¸ºæŒ‰é”®å·²ç¨³å®šçš„æŒ‰ä¸‹</span><br><span class="line">            KeySta[keyout][i] = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        else if ((keybuf[keyout][i] &amp; 0x0F) == 0x0F)</span><br><span class="line">        &#123;   //è¿ç»­4æ¬¡æ‰«æå€¼ä¸º1ï¼Œå³4*4mså†…éƒ½æ˜¯å¼¹èµ·çŠ¶æ€æ—¶ï¼Œå¯è®¤ä¸ºæŒ‰é”®å·²ç¨³å®šçš„å¼¹èµ·</span><br><span class="line">            KeySta[keyout][i] = 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //æ‰§è¡Œä¸‹ä¸€æ¬¡çš„æ‰«æè¾“å‡º</span><br><span class="line">    keyout++;                //è¾“å‡ºç´¢å¼•é€’å¢</span><br><span class="line">    keyout = keyout &amp; 0x03;  //ç´¢å¼•å€¼åŠ åˆ°4å³å½’é›¶</span><br><span class="line">    switch (keyout)          //æ ¹æ®ç´¢å¼•ï¼Œé‡Šæ”¾å½“å‰è¾“å‡ºå¼•è„šï¼Œæ‹‰ä½ä¸‹æ¬¡çš„è¾“å‡ºå¼•è„š</span><br><span class="line">    &#123;</span><br><span class="line">        case 0: KEY_OUT_4 = 1; KEY_OUT_1 = 0; break;</span><br><span class="line">        case 1: KEY_OUT_1 = 1; KEY_OUT_2 = 0; break;</span><br><span class="line">        case 2: KEY_OUT_2 = 1; KEY_OUT_3 = 0; break;</span><br><span class="line">        case 3: KEY_OUT_3 = 1; KEY_OUT_4 = 0; break;</span><br><span class="line">        default: break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/* æ•°ç ç®¡åŠ¨æ€æ‰«æåˆ·æ–°å‡½æ•°ï¼Œéœ€åœ¨å®šæ—¶ä¸­æ–­ä¸­è°ƒç”¨ */</span><br><span class="line">void LedScan()</span><br><span class="line">&#123;</span><br><span class="line">    static unsigned char i = 0;  //åŠ¨æ€æ‰«æçš„ç´¢å¼•</span><br><span class="line">    </span><br><span class="line">    P0 = 0xFF;   //æ˜¾ç¤ºæ¶ˆéš</span><br><span class="line">    switch (i)</span><br><span class="line">    &#123;</span><br><span class="line">        case 0: ADDR2=0; ADDR1=0; ADDR0=0; i++; P0=LedBuff[0]; break;</span><br><span class="line">        case 1: ADDR2=0; ADDR1=0; ADDR0=1; i++; P0=LedBuff[1]; break;</span><br><span class="line">        case 2: ADDR2=0; ADDR1=1; ADDR0=0; i++; P0=LedBuff[2]; break;</span><br><span class="line">        case 3: ADDR2=0; ADDR1=1; ADDR0=1; i++; P0=LedBuff[3]; break;</span><br><span class="line">        case 4: ADDR2=1; ADDR1=0; ADDR0=0; i++; P0=LedBuff[4]; break;</span><br><span class="line">        case 5: ADDR2=1; ADDR1=0; ADDR0=1; i=0; P0=LedBuff[5]; break;</span><br><span class="line">        default: break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/* T0ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œç”¨äºæ•°ç ç®¡æ˜¾ç¤ºæ‰«æä¸æŒ‰é”®æ‰«æ */</span><br><span class="line">void InterruptTimer0() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    TH0 = 0xFC;  //é‡æ–°åŠ è½½åˆå€¼</span><br><span class="line">    TL0 = 0x67;</span><br><span class="line">    LedScan();   //è°ƒç”¨æ•°ç ç®¡æ˜¾ç¤ºæ‰«æå‡½æ•°</span><br><span class="line">    KeyScan();   //è°ƒç”¨æŒ‰é”®æ‰«æå‡½æ•°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;reg52.h&gt;</p><p>sbit ADDR0 &#x3D; P1^0;<br>sbit ADDR1 &#x3D; P1^1;<br>sbit ADDR2 &#x3D; P1^2;<br>sbit ADDR3 &#x3D; P1^3;<br>sbit ENLED &#x3D; P1^4;<br>sbit KEY_IN_1  &#x3D; P2^4;<br>sbit KEY_IN_2  &#x3D; P2^5;<br>sbit KEY_IN_3  &#x3D; P2^6;<br>sbit KEY_IN_4  &#x3D; P2^7;<br>sbit KEY_OUT_1 &#x3D; P2^3;<br>sbit KEY_OUT_2 &#x3D; P2^2;<br>sbit KEY_OUT_3 &#x3D; P2^1;<br>sbit KEY_OUT_4 &#x3D; P2^0;</p><p>unsigned char code LedChar[] &#x3D; {  &#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦è½¬æ¢è¡¨<br>    0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8,<br>    0x80, 0x90, 0x88, 0x83, 0xC6, 0xA1, 0x86, 0x8E<br>};<br>unsigned char LedBuff[6] &#x3D; {  &#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºç¼“å†²åŒº<br>    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF<br>};<br>unsigned char code KeyCodeMap[4][4] &#x3D; { &#x2F;&#x2F;çŸ©é˜µæŒ‰é”®ç¼–å·åˆ°æ ‡å‡†é”®ç›˜é”®ç çš„æ˜ å°„è¡¨<br>    { 0x31, 0x32, 0x33, 0x26 }, &#x2F;&#x2F;æ•°å­—é”®1ã€æ•°å­—é”®2ã€æ•°å­—é”®3ã€å‘ä¸Šé”®<br>    { 0x34, 0x35, 0x36, 0x25 }, &#x2F;&#x2F;æ•°å­—é”®4ã€æ•°å­—é”®5ã€æ•°å­—é”®6ã€å‘å·¦é”®<br>    { 0x37, 0x38, 0x39, 0x28 }, &#x2F;&#x2F;æ•°å­—é”®7ã€æ•°å­—é”®8ã€æ•°å­—é”®9ã€å‘ä¸‹é”®<br>    { 0x30, 0x1B, 0x0D, 0x27 }  &#x2F;&#x2F;æ•°å­—é”®0ã€ESCé”®ã€  å›è½¦é”®ã€ å‘å³é”®<br>};<br>unsigned char KeySta[4][4] &#x3D; {  &#x2F;&#x2F;å…¨éƒ¨çŸ©é˜µæŒ‰é”®çš„å½“å‰çŠ¶æ€<br>    {1, 1, 1, 1},  {1, 1, 1, 1},  {1, 1, 1, 1},  {1, 1, 1, 1}<br>};</p><p>void KeyDriver();</p><p>void main()<br>{<br>    EA &#x3D; 1;       &#x2F;&#x2F;ä½¿èƒ½æ€»ä¸­æ–­<br>    ENLED &#x3D; 0;    &#x2F;&#x2F;é€‰æ‹©æ•°ç ç®¡è¿›è¡Œæ˜¾ç¤º<br>    ADDR3 &#x3D; 1;<br>    TMOD &#x3D; 0x01;  &#x2F;&#x2F;è®¾ç½®T0ä¸ºæ¨¡å¼1<br>    TH0  &#x3D; 0xFC;  &#x2F;&#x2F;ä¸ºT0èµ‹åˆå€¼0xFC67ï¼Œå®šæ—¶1ms<br>    TL0  &#x3D; 0x67;<br>    ET0  &#x3D; 1;     &#x2F;&#x2F;ä½¿èƒ½T0ä¸­æ–­<br>    TR0  &#x3D; 1;     &#x2F;&#x2F;å¯åŠ¨T0<br>    LedBuff[0] &#x3D; LedChar[0];  &#x2F;&#x2F;ä¸Šç”µæ˜¾ç¤º0</p><pre><code>while (1)&#123;    KeyDriver();   //è°ƒç”¨æŒ‰é”®é©±åŠ¨å‡½æ•°&#125;</code></pre><p>}<br>&#x2F;* å°†ä¸€ä¸ªæœ‰ç¬¦å·é•¿æ•´å‹çš„æ•°å­—æ˜¾ç¤ºåˆ°æ•°ç ç®¡ä¸Šï¼Œnum-å¾…æ˜¾ç¤ºæ•°å­— *&#x2F;<br>void ShowNumber(long num)<br>{<br>    signed char i;<br>    unsigned char sign;<br>    unsigned char buf[6];</p><pre><code>if (num &lt; 0)  //é¦–å…ˆæå–å¹¶æš‚å­˜ç¬¦å·ä½&#123;    sign = 1;    num = -num;&#125;else&#123;    sign = 0;&#125;for (i=0; i&lt;6; i++)   //æŠŠé•¿æ•´å‹æ•°è½¬æ¢ä¸º6ä½åè¿›åˆ¶çš„æ•°ç»„&#123;    buf[i] = num % 10;    num = num / 10;&#125;for (i=5; i&gt;=1; i--)  //ä»æœ€é«˜ä½èµ·ï¼Œé‡åˆ°0è½¬æ¢ä¸ºç©ºæ ¼ï¼Œé‡åˆ°é0åˆ™é€€å‡ºå¾ªç¯&#123;    if (buf[i] == 0)        LedBuff[i] = 0xFF;    else        break;&#125;if (sign != 0)        //è´Ÿæ•°æ—¶ï¼Œéœ€åœ¨æœ€å‰é¢æ·»åŠ è´Ÿå·&#123;    if (i &lt; 5)        //å½“æœ‰æ•ˆä½æ•°å°äº6ä½æ—¶æ·»åŠ è´Ÿå·ï¼Œå¦åˆ™æ˜¾ç¤ºç»“æœå°†æ˜¯é”™çš„    &#123;        LedBuff[i+1] = 0xBF;    &#125;&#125;for ( ; i&gt;=0; i--)    //å‰©ä½™ä½ä½éƒ½å¦‚å®è½¬æ¢ä¸ºæ•°ç ç®¡æ˜¾ç¤ºå­—ç¬¦&#123;    LedBuff[i] = LedChar[buf[i]];&#125;</code></pre><p>}<br>&#x2F;* æŒ‰é”®åŠ¨ä½œå‡½æ•°ï¼Œæ ¹æ®é”®ç æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œkeycode-æŒ‰é”®é”®ç  *&#x2F;<br>void KeyAction(unsigned char keycode)<br>{<br>    static char oprt &#x3D; 0;    &#x2F;&#x2F;ç”¨äºä¿å­˜åŠ å‡è¿ç®—ç¬¦<br>    static long result &#x3D; 0;  &#x2F;&#x2F;ç”¨äºä¿å­˜è¿ç®—ç»“æœ<br>    static long addend &#x3D; 0;  &#x2F;&#x2F;ç”¨äºä¿å­˜è¾“å…¥çš„åŠ æ•°</p><pre><code>if ((keycode&gt;=0x30) &amp;&amp; (keycode&lt;=0x39))  //è¾“å…¥0-9çš„æ•°å­—&#123;    addend = (addend*10)+(keycode-0x30); //æ•´ä½“åè¿›åˆ¶å·¦ç§»ï¼Œæ–°æ•°å­—è¿›å…¥ä¸ªä½    ShowNumber(addend);    //è¿ç®—ç»“æœæ˜¾ç¤ºåˆ°æ•°ç ç®¡&#125;else if (keycode == 0x26)  //å‘ä¸Šé”®ç”¨ä½œåŠ å·&#123;    oprt = 0;              //è®¾ç½®è¿ç®—ç¬¦å˜é‡    result = addend;       //è¿ç®—æ•°å­˜åˆ°ç»“æœä¸­ï¼Œå‡†å¤‡è¿›è¡ŒåŠ å‡    addend = 0;            //æ¸…é›¶è¿ç®—æ•°ï¼Œå‡†å¤‡æ¥æ”¶ä¸‹ä¸€ä¸ªè¿ç®—æ•°    ShowNumber(addend);    //åˆ·æ–°æ•°ç ç®¡æ˜¾ç¤º&#125;else if (keycode == 0x28)  //å‘ä¸‹é”®ç”¨ä½œå‡å·&#123;    oprt = 1;              //è®¾ç½®è¿ç®—ç¬¦å˜é‡    result = addend;       //è¿ç®—æ•°å­˜åˆ°ç»“æœä¸­ï¼Œå‡†å¤‡è¿›è¡ŒåŠ å‡    addend = 0;            //æ¸…é›¶è¿ç®—æ•°ï¼Œå‡†å¤‡æ¥æ”¶ä¸‹ä¸€ä¸ªè¿ç®—æ•°    ShowNumber(addend);    //åˆ·æ–°æ•°ç ç®¡æ˜¾ç¤º&#125;else if (keycode == 0x0D)  //å›è½¦é”®ï¼Œæ‰§è¡ŒåŠ å‡è¿ç®—&#123;    if (oprt == 0)    &#123;        result += addend;  //è¿›è¡ŒåŠ æ³•è¿ç®—    &#125;    else    &#123;        result -= addend;  //è¿›è¡Œå‡æ³•è¿ç®—    &#125;    addend = 0;    ShowNumber(result);    //è¿ç®—ç»“æœæ˜¾ç¤ºåˆ°æ•°ç ç®¡&#125;else if (keycode == 0x1B)  //Escé”®ï¼Œæ¸…é›¶ç»“æœ&#123;    addend = 0;    result = 0;    ShowNumber(addend);    //æ¸…é›¶åçš„åŠ æ•°æ˜¾ç¤ºåˆ°æ•°ç ç®¡&#125;</code></pre><p>}<br>&#x2F;* æŒ‰é”®é©±åŠ¨å‡½æ•°ï¼Œæ£€æµ‹æŒ‰é”®åŠ¨ä½œï¼Œè°ƒåº¦ç›¸åº”åŠ¨ä½œå‡½æ•°ï¼Œéœ€åœ¨ä¸»å¾ªç¯ä¸­è°ƒç”¨ *&#x2F;<br>void KeyDriver()<br>{<br>    unsigned char i, j;<br>    static unsigned char backup[4][4] &#x3D; {  &#x2F;&#x2F;æŒ‰é”®å€¼å¤‡ä»½ï¼Œä¿å­˜å‰ä¸€æ¬¡çš„å€¼<br>        {1, 1, 1, 1},  {1, 1, 1, 1},  {1, 1, 1, 1},  {1, 1, 1, 1}<br>    };</p><pre><code>for (i=0; i&lt;4; i++)  //å¾ªç¯æ£€æµ‹4*4çš„çŸ©é˜µæŒ‰é”®&#123;    for (j=0; j&lt;4; j++)    &#123;        if (backup[i][j] != KeySta[i][j])    //æ£€æµ‹æŒ‰é”®åŠ¨ä½œ        &#123;            if (backup[i][j] != 0)           //æŒ‰é”®æŒ‰ä¸‹æ—¶æ‰§è¡ŒåŠ¨ä½œ            &#123;                KeyAction(KeyCodeMap[i][j]); //è°ƒç”¨æŒ‰é”®åŠ¨ä½œå‡½æ•°            &#125;            backup[i][j] = KeySta[i][j];     //åˆ·æ–°å‰ä¸€æ¬¡çš„å¤‡ä»½å€¼        &#125;    &#125;&#125;</code></pre><p>}<br>&#x2F;* æŒ‰é”®æ‰«æå‡½æ•°ï¼Œéœ€åœ¨å®šæ—¶ä¸­æ–­ä¸­è°ƒç”¨ï¼Œæ¨èè°ƒç”¨é—´éš”1ms *&#x2F;<br>void KeyScan()<br>{<br>    unsigned char i;<br>    static unsigned char keyout &#x3D; 0;   &#x2F;&#x2F;çŸ©é˜µæŒ‰é”®æ‰«æè¾“å‡ºç´¢å¼•<br>    static unsigned char keybuf[4][4] &#x3D; {  &#x2F;&#x2F;çŸ©é˜µæŒ‰é”®æ‰«æç¼“å†²åŒº<br>        {0xFF, 0xFF, 0xFF, 0xFF},  {0xFF, 0xFF, 0xFF, 0xFF},<br>        {0xFF, 0xFF, 0xFF, 0xFF},  {0xFF, 0xFF, 0xFF, 0xFF}<br>    };</p><pre><code>//å°†ä¸€è¡Œçš„4ä¸ªæŒ‰é”®å€¼ç§»å…¥ç¼“å†²åŒºkeybuf[keyout][0] = (keybuf[keyout][0] &lt;&lt; 1) | KEY_IN_1;keybuf[keyout][1] = (keybuf[keyout][1] &lt;&lt; 1) | KEY_IN_2;keybuf[keyout][2] = (keybuf[keyout][2] &lt;&lt; 1) | KEY_IN_3;keybuf[keyout][3] = (keybuf[keyout][3] &lt;&lt; 1) | KEY_IN_4;//æ¶ˆæŠ–åæ›´æ–°æŒ‰é”®çŠ¶æ€for (i=0; i&lt;4; i++)  //æ¯è¡Œ4ä¸ªæŒ‰é”®ï¼Œæ‰€ä»¥å¾ªç¯4æ¬¡&#123;    if ((keybuf[keyout][i] &amp; 0x0F) == 0x00)    &#123;   //è¿ç»­4æ¬¡æ‰«æå€¼ä¸º0ï¼Œå³4*4mså†…éƒ½æ˜¯æŒ‰ä¸‹çŠ¶æ€æ—¶ï¼Œå¯è®¤ä¸ºæŒ‰é”®å·²ç¨³å®šçš„æŒ‰ä¸‹        KeySta[keyout][i] = 0;    &#125;    else if ((keybuf[keyout][i] &amp; 0x0F) == 0x0F)    &#123;   //è¿ç»­4æ¬¡æ‰«æå€¼ä¸º1ï¼Œå³4*4mså†…éƒ½æ˜¯å¼¹èµ·çŠ¶æ€æ—¶ï¼Œå¯è®¤ä¸ºæŒ‰é”®å·²ç¨³å®šçš„å¼¹èµ·        KeySta[keyout][i] = 1;    &#125;&#125;//æ‰§è¡Œä¸‹ä¸€æ¬¡çš„æ‰«æè¾“å‡ºkeyout++;                //è¾“å‡ºç´¢å¼•é€’å¢keyout = keyout &amp; 0x03;  //ç´¢å¼•å€¼åŠ åˆ°4å³å½’é›¶switch (keyout)          //æ ¹æ®ç´¢å¼•ï¼Œé‡Šæ”¾å½“å‰è¾“å‡ºå¼•è„šï¼Œæ‹‰ä½ä¸‹æ¬¡çš„è¾“å‡ºå¼•è„š&#123;    case 0: KEY_OUT_4 = 1; KEY_OUT_1 = 0; break;    case 1: KEY_OUT_1 = 1; KEY_OUT_2 = 0; break;    case 2: KEY_OUT_2 = 1; KEY_OUT_3 = 0; break;    case 3: KEY_OUT_3 = 1; KEY_OUT_4 = 0; break;    default: break;&#125;</code></pre><p>}<br>&#x2F;* æ•°ç ç®¡åŠ¨æ€æ‰«æåˆ·æ–°å‡½æ•°ï¼Œéœ€åœ¨å®šæ—¶ä¸­æ–­ä¸­è°ƒç”¨ *&#x2F;<br>void LedScan()<br>{<br>    static unsigned char i &#x3D; 0;  &#x2F;&#x2F;åŠ¨æ€æ‰«æçš„ç´¢å¼•</p><pre><code>P0 = 0xFF;   //æ˜¾ç¤ºæ¶ˆéšswitch (i)&#123;    case 0: ADDR2=0; ADDR1=0; ADDR0=0; i++; P0=LedBuff[0]; break;    case 1: ADDR2=0; ADDR1=0; ADDR0=1; i++; P0=LedBuff[1]; break;    case 2: ADDR2=0; ADDR1=1; ADDR0=0; i++; P0=LedBuff[2]; break;    case 3: ADDR2=0; ADDR1=1; ADDR0=1; i++; P0=LedBuff[3]; break;    case 4: ADDR2=1; ADDR1=0; ADDR0=0; i++; P0=LedBuff[4]; break;    case 5: ADDR2=1; ADDR1=0; ADDR0=1; i=0; P0=LedBuff[5]; break;    default: break;&#125;</code></pre><p>}<br>&#x2F;* T0ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œç”¨äºæ•°ç ç®¡æ˜¾ç¤ºæ‰«æä¸æŒ‰é”®æ‰«æ *&#x2F;<br>void InterruptTimer0() interrupt 1<br>{<br>    TH0 &#x3D; 0xFC;  &#x2F;&#x2F;é‡æ–°åŠ è½½åˆå€¼<br>    TL0 &#x3D; 0x67;<br>    LedScan();   &#x2F;&#x2F;è°ƒç”¨æ•°ç ç®¡æ˜¾ç¤ºæ‰«æå‡½æ•°<br>    KeyScan();   &#x2F;&#x2F;è°ƒç”¨æŒ‰é”®æ‰«æå‡½æ•°<br>}&#96;</p><ul><li>VSM Studio</li></ul><p><img src="https://img-blog.csdnimg.cn/3d41f07dc2214f468b813cca03422f46.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°ã€‚æœ¬ç¤ºä¾‹åªæœ‰åŸºäºVSM Studioä»£ç ï¼Œæ²¡æœ‰Keilå·¥ç¨‹ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1yKxiRrMpyy75w81WzB4iPA </span><br><span class="line">æå–ç ï¼š0wcd</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1yKxiRrMpyy75w81WzB4iPA  æå–ç ï¼š0wcd</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘LCD1602+DS1307æŒ‰é”®è®¾ç½®ç®€æ˜“æ—¶é’Ÿ</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FLCD1602DS1307%E6%8C%89%E9%94%AE%E8%AE%BE%E7%BD%AE%E7%AE%80%E6%98%93%E6%97%B6%E9%92%9F/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FLCD1602DS1307%E6%8C%89%E9%94%AE%E8%AE%BE%E7%BD%AE%E7%AE%80%E6%98%93%E6%97%B6%E9%92%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘LCD1602-DS1307æŒ‰é”®è®¾ç½®ç®€æ˜“æ—¶é’Ÿ"><a href="#ã€Proteusä»¿çœŸã€‘LCD1602-DS1307æŒ‰é”®è®¾ç½®ç®€æ˜“æ—¶é’Ÿ" class="headerlink" title="ã€Proteusä»¿çœŸã€‘LCD1602+DS1307æŒ‰é”®è®¾ç½®ç®€æ˜“æ—¶é’Ÿ"></a>ã€Proteusä»¿çœŸã€‘LCD1602+DS1307æŒ‰é”®è®¾ç½®ç®€æ˜“æ—¶é’Ÿ</h1><h3 id="ã€Proteusä»¿çœŸã€‘LCD1602-DS1307æŒ‰é”®è®¾ç½®ç®€æ˜“æ—¶é’Ÿ-1"><a href="#ã€Proteusä»¿çœŸã€‘LCD1602-DS1307æŒ‰é”®è®¾ç½®ç®€æ˜“æ—¶é’Ÿ-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘LCD1602+DS1307æŒ‰é”®è®¾ç½®ç®€æ˜“æ—¶é’Ÿ"></a>ã€Proteusä»¿çœŸã€‘LCD1602+DS1307æŒ‰é”®è®¾ç½®ç®€æ˜“æ—¶é’Ÿ</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/1618556297e24526ab5d0c31b7fa670b.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="åŠŸèƒ½è¯´æ˜"><a href="#åŠŸèƒ½è¯´æ˜" class="headerlink" title="åŠŸèƒ½è¯´æ˜"></a>åŠŸèƒ½è¯´æ˜</h4><p>é€šè¿‡æŒ‰é”®è®¾ç½®å½“å‰æ—¶é—´ï¼ŒæŒ‰é”®è°ƒæ•´æ—¶é—´åªå®ç°äº†å¯¹æ—¶åˆ†ç§’çš„è®¾ç½®ï¼Œå¹´æœˆæ—¥ä»¥åŠæ˜ŸæœŸæ˜¯ç¨‹åºä»£ç å†™å…¥çš„ï¼ŒæŒ‰é”®ä¸èƒ½è¿›è¡Œè°ƒæ•´ï¼ŒåŠŸèƒ½éœ€è‡ªè¡Œå®Œå–„ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨å›› 6æœˆ 23 2022</span><br><span class="line"> * Processor: AT89C51</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/****************************************************</span><br><span class="line"></span><br><span class="line">ç”µè·¯å›¾è¯´æ˜ï¼š</span><br><span class="line">å°†å•ç‰‡æœºP2.7å’ŒP1.0åˆ†åˆ«ä¸RTCï¼ˆå®æ—¶æ—¶é’Ÿï¼‰çš„æ—¶é’Ÿä¿¡å·SCLç«¯</span><br><span class="line">å’Œæ•°æ®ä¿¡å·SDAç«¯ç›¸è¿ï¼Œ RTCçš„soutå¼•è„šä¸å•ç‰‡æœºP3.2ç›¸è¿ï¼ŒRTCçš„</span><br><span class="line">åœ°å€æ˜¯11010000(0xD0)ç‹¬ç«‹é”®ç›˜k0~K3æ¥P1.1~P1.3</span><br><span class="line">ç¨‹åºåŠŸèƒ½ï¼š</span><br><span class="line">  ä½¿ç”¨æ—¶é’ŸèŠ¯ç‰‡ds1307åˆ¶ä½œä¸€ä¸ªå®æ—¶æ—¶é’Ÿ</span><br><span class="line">******************************************************/</span><br><span class="line">#include &lt;reg52.h&gt;</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line">//å®æ—¶æ—¶é’Ÿä¸¤ä¿¡å·çº¿</span><br><span class="line">sbit scl=P2^7;</span><br><span class="line">sbit sda=P1^0;</span><br><span class="line">//ç‹¬ç«‹é”®ç›˜æ‰«æä½</span><br><span class="line">sbit k0=P1^1;</span><br><span class="line">sbit k1=P1^2;</span><br><span class="line">sbit k2=P1^3;</span><br><span class="line">//æ¶²æ™¶æ˜¾ç¤ºå™¨æ§åˆ¶ä½</span><br><span class="line">sbit lcd_rs=P3^4;</span><br><span class="line">sbit lcd_e=P3^5;</span><br><span class="line">void init();//åˆå§‹åŒ–IICæ€»çº¿ï¼Œä½¿æ€»çº¿å¤„äºå¤‡ç”¨çŠ¶æ€,</span><br><span class="line">//åˆå§‹åŒ–lcdå¹¶æ˜¾ç¤ºä¸Šé¢table1å’Œtable2çš„å€¼ï¼Œåˆå§‹åŒ–å®šæ—¶å™¨0ï¼Œåˆå§‹åŒ–å˜é‡æ—¶åˆ†ç§’</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/****************IICæ€»çº¿æ§åˆ¶å‡½æ•°***************************/</span><br><span class="line">void IIC_start();//IICé€šä¿¡å¼€å§‹ä¿¡å·</span><br><span class="line">void IIC_stop();//IICé€šä¿¡åœæ­¢ä¿¡å·</span><br><span class="line">void IIC_un_ack();//å•ç‰‡æœºå‘é€éåº”ç­”ä½</span><br><span class="line">//void IIC_ack();//å•ç‰‡æœºå‘é€åº”ç­”ä½</span><br><span class="line">void IIC_check_ack();//å•ç‰‡æœºæ£€æŸ¥åº”ç­”ä½</span><br><span class="line">void IIC_write_byte(uchar);//å‘é€ä¸€å­—èŠ‚æ•°æ®</span><br><span class="line">uchar IIC_read_byte();//æ¥æ”¶ä¸€å­—èŠ‚æ•°æ®</span><br><span class="line">void nop();//5usç©ºæ“ä½œå»¶è¿Ÿ</span><br><span class="line">/**********************************/</span><br><span class="line">/**********ds1307è¯»å†™å‡½æ•°*******************/</span><br><span class="line">void ds1307_write_date(uchar ,uchar ,uchar);//å‘æŒ‡å®šå™¨ä»¶å†™ä¸€å­—èŠ‚æ•°æ®</span><br><span class="line">//å‚æ•°1å™¨ä»¶åœ°å€ï¼Œå‚æ•°2è¦å­˜çš„æ•°æ®å­˜æ”¾ä½ç½®8ä½åœ°å€</span><br><span class="line">//å‚æ•°3è¦å†™çš„æ•°æ®</span><br><span class="line"></span><br><span class="line">uchar ds1307_read_date(uchar ,uchar );//ä»æŒ‡å®šå™¨ä»¶è¯»ä¸€å­—èŠ‚æ•°æ®ï¼Œ</span><br><span class="line">//å‚æ•°1è¢«é€šä¿¡å™¨ä»¶åœ°å€ï¼Œå‚æ•°2è¦è¯»çš„æ•°æ®å­˜æ”¾ä½ç½®8ä½åœ°å€</span><br><span class="line">//å‡½æ•°è¿”å›è¯»å–çš„æ•°æ®ã€‚</span><br><span class="line">void delay(uint);//åŸºæ•°1mså»¶è¿Ÿç¨‹åº</span><br><span class="line">/***********************************/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**************LCDæ“ä½œå‡½æ•°**************************/</span><br><span class="line"></span><br><span class="line">uchar hour,minute,second,k0_num;//æ—¶åˆ†ç§’å˜é‡ï¼Œèœå•é”®k0ç¬¬å‡ æ¬¡æŒ‰ä¸‹è®¡æ•°ï¼Œds1307è·Ÿæ–°æ ‡å¿—</span><br><span class="line">//æ—¶é’Ÿåˆæ˜¾ç¤º</span><br><span class="line">uchar code table1[]=&quot;2022-06-23 Thu&quot;;</span><br><span class="line">uchar code table2[]=&quot;    16:31:15 &quot;;//2022å¹´6æœˆ23æ—¥16:31:15</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void lcd_write_com(uchar);//å‘æ¶²æ™¶æ˜¾ç¤ºå™¨å†™æŒ‡ä»¤è®¾ç½®å…¶æ˜¾ç¤ºçš„æ ¼å¼</span><br><span class="line">void lcd_write_date(uchar);//å‘æ¶²æ™¶æ˜¾ç¤ºå™¨å†™æ˜¾ç¤ºçš„æ•°æ®</span><br><span class="line"></span><br><span class="line">/**********************************************/</span><br><span class="line"></span><br><span class="line">/**************æ—¶é’Ÿå‡½æ•°*******************/</span><br><span class="line">void lcd_write_second(uchar);//å‘lcdå†™ç§’</span><br><span class="line">void lcd_write_minute(uchar);//å‘lcdå†™åˆ†</span><br><span class="line">void lcd_write_hour(uchar);//å‘lcdå†™æ—¶</span><br><span class="line">void run_time();//æ—¶é’Ÿèµ°åŠ¨æ˜¾ç¤º</span><br><span class="line">void keyscan();//èœå•é”®æ‰«æ</span><br><span class="line">/****************************************/</span><br><span class="line"></span><br><span class="line">/*********åè¿›å€¼ä¸BCDç ä¹‹é—´äº’æ¢**********/</span><br><span class="line">uchar b_second,b_minute,b_hour;</span><br><span class="line">uchar dectobcd(uchar);//åè¿›å€¼è½¬bcdç </span><br><span class="line">uchar bcdtodec(uchar);//bcdç è½¬åè¿›å€¼</span><br><span class="line">/****************************************/</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">init();</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">keyscan();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void nop()</span><br><span class="line">&#123;</span><br><span class="line">_nop_();_nop_();_nop_();</span><br><span class="line">_nop_();_nop_();_nop_();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void init()</span><br><span class="line">&#123;</span><br><span class="line">uchar i;</span><br><span class="line">//å°†æ•°æ®çº¿å’Œæ—¶é’Ÿçº¿æ‹‰é«˜ï¼Œå¤„äºå¤‡ç”¨çŠ¶æ€å³éå¿™</span><br><span class="line">sda=1;</span><br><span class="line">nop();</span><br><span class="line">scl=1;</span><br><span class="line">nop();</span><br><span class="line"></span><br><span class="line">//åˆå§‹åŒ–å†™å…¥LCDçš„æ—¶åˆ†ç§’</span><br><span class="line">        second=16;</span><br><span class="line">        minute=23;</span><br><span class="line">        hour=16;</span><br><span class="line">//åˆå§‹åŒ–ds1307</span><br><span class="line">ds1307_write_date(0xd0,0x07,0x10);//åˆå§‹åŒ–1307çš„æ§åˆ¶å­—ï¼Œä½¿å…¶SOUTå¼•è„šè¾“å‡º1Hzçš„æ–¹æ³¢ã€‚</span><br><span class="line">//åˆå§‹åŒ–1307çš„æ—¶é—´</span><br><span class="line">ds1307_write_date(0xd0,6,0x14); </span><br><span class="line">ds1307_write_date(0xd0,5,0x06);   </span><br><span class="line">ds1307_write_date(0xd0,4,0x09);</span><br><span class="line">ds1307_write_date(0xd0,3,0x00);</span><br><span class="line">ds1307_write_date(0xd0,2,0x23);</span><br><span class="line">ds1307_write_date(0xd0,1,0x59);</span><br><span class="line">ds1307_write_date(0xd0,0,0x55);</span><br><span class="line"></span><br><span class="line">//åˆå§‹åŒ–æ¶²æ™¶æ˜¾ç¤ºå™¨</span><br><span class="line">lcd_write_com(0x38);//è®¾ç½®16*2è¡Œï¼Œ5*7ç‚¹é˜µï¼Œ8ä½æ•°æ®æ¥å£</span><br><span class="line">lcd_write_com(0x06);//å†™å­—ç¬¦æŒ‡é’ˆå’Œå…‰æ ‡è‡ªåŠ¨å‘å³ç§»åŠ¨</span><br><span class="line">lcd_write_com(0x0c);//å¼€æ˜¾ç¤ºï¼Œä¸æ˜¾ç¤ºå…‰æ ‡ï¼Œå…‰æ ‡ä¸é—ªçƒ</span><br><span class="line">lcd_write_com(0x01);//æ˜¾ç¤ºæ¸…å±</span><br><span class="line">for(i=0;i&lt;15;i++)</span><br><span class="line">&#123;</span><br><span class="line">lcd_write_date(table1[i]);</span><br><span class="line">&#125;</span><br><span class="line">lcd_write_com(0x80+0x40);</span><br><span class="line">for(i=0;i&lt;10;i++)</span><br><span class="line">&#123;</span><br><span class="line">lcd_write_date(table2[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å¼€å¯å¤–éƒ¨ä¸­æ–­0</span><br><span class="line">EA=1;</span><br><span class="line">EX0=1;</span><br><span class="line">IT0=1;</span><br><span class="line">&#125;</span><br><span class="line">void IIC_start()</span><br><span class="line">&#123;</span><br><span class="line">//åœ¨æ—¶é’Ÿä¿¡å·æœ‰æ•ˆscl=1æ—¶ï¼Œæ•°æ®çº¿è´Ÿè·³å˜</span><br><span class="line">sda=1;</span><br><span class="line">nop();</span><br><span class="line">scl=1;</span><br><span class="line">nop();</span><br><span class="line">sda=0;</span><br><span class="line">nop();</span><br><span class="line">scl=0;//æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡</span><br><span class="line">nop();</span><br><span class="line">&#125;</span><br><span class="line">void IIC_stop()</span><br><span class="line">&#123;</span><br><span class="line">//åœ¨æ—¶é’Ÿä¿¡å·æœ‰æ•ˆscl=1æ—¶ï¼Œæ•°æ®çº¿æ­£è·³å˜ï¼Œé‡Šæ”¾æ€»çº¿,ä½¿æ€»çº¿å¤„äºå¤‡ç”¨çŠ¶æ€å³éå¿™</span><br><span class="line">sda=0;</span><br><span class="line">nop();</span><br><span class="line">scl=1;</span><br><span class="line">nop();</span><br><span class="line">sda=1;</span><br><span class="line">nop();</span><br><span class="line">nop();</span><br><span class="line">nop();</span><br><span class="line">&#125;</span><br><span class="line">void IIC_un_ack()</span><br><span class="line">&#123;</span><br><span class="line">//æ—¶é’Ÿä¿¡å·æœ‰æ•ˆæ—¶ï¼Œsdaç»™1ï¼Œç»™å‡ºéåº”ç­”</span><br><span class="line">sda=1;</span><br><span class="line">nop();</span><br><span class="line">scl=1;</span><br><span class="line">nop();</span><br><span class="line">scl=0;//æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡</span><br><span class="line">nop();</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line">void IIC_ack()</span><br><span class="line">&#123;</span><br><span class="line">//æ—¶é’Ÿä¿¡å·æœ‰æ•ˆæ—¶ï¼Œsdaç»™0ï¼Œç»™å‡ºåº”ç­”</span><br><span class="line">sda=0;</span><br><span class="line">nop();</span><br><span class="line">scl=1;</span><br><span class="line">nop();</span><br><span class="line">scl=0;//æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡</span><br><span class="line">nop();</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line">void IIC_check_ack()</span><br><span class="line">&#123;</span><br><span class="line">//uchar i;</span><br><span class="line">//æ—¶é’Ÿä¿¡å·æœ‰æ•ˆæ—¶ï¼Œæ£€æµ‹æ•°æ®ä¿¡å·sdaæ˜¯å¦ä¸º0ï¼Œç»™0è¯´æ˜æœ‰åº”ç­”ä¿¡å·</span><br><span class="line">scl=1;</span><br><span class="line">//while((sda==1)&amp;&amp;(i&lt;255)) i++;</span><br><span class="line">nop();</span><br><span class="line">scl=0;//æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡</span><br><span class="line">nop();</span><br><span class="line">&#125;</span><br><span class="line">uchar IIC_read_byte( )</span><br><span class="line">&#123;</span><br><span class="line">uchar i,temp;//tempç”¨äºå­˜æ”¾ä»æ•°æ®çº¿è¯»åˆ°çš„æ•°æ®</span><br><span class="line"></span><br><span class="line">for(i=0;i&lt;8;i++)//ä»æ•°æ®çº¿è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰</span><br><span class="line">&#123;</span><br><span class="line">scl=1;</span><br><span class="line">nop();</span><br><span class="line">temp=(temp&lt;&lt;1)|sda;//tempå·¦ç§»ï¼Œè…¾å‡ºç¬¬0ä½ï¼Œç„¶åå°†æ•°æ®çº¿ä¸Šçš„ä¸€ä½æ•°ç”¨æˆ–</span><br><span class="line"> //è¿ç®—å­˜æ”¾åˆ°tempçš„ç¬¬0ä½</span><br><span class="line">scl=0;//æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡</span><br><span class="line">nop();</span><br><span class="line">&#125;</span><br><span class="line">return temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void IIC_write_byte(uchar byte)</span><br><span class="line">&#123;</span><br><span class="line">uchar i;</span><br><span class="line">for(i=0;i&lt;8;i++)//å‘æ•°æ®çº¿å†™ä¸€ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰</span><br><span class="line">&#123;</span><br><span class="line">byte=byte&lt;&lt;1;//å·¦ç§»ä½ï¼Œå°†byteç¬¬7ä½ç§»åˆ°PSWä¸­çš„è¿›ä½æ ‡å¿—ä½CYä¸­</span><br><span class="line">sda=CY;</span><br><span class="line">nop();</span><br><span class="line">scl=1;</span><br><span class="line">nop();</span><br><span class="line">scl=0;//æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡</span><br><span class="line">nop();</span><br><span class="line">&#125;</span><br><span class="line">sda=1;//é‡Šæ”¾æ€»çº¿ï¼Œå‡†å¤‡æ¥æ”¶è¢«æ§è®¾å¤‡åº”ç­”ä¿¡å·</span><br><span class="line">nop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void ds1307_write_date(uchar d_address,uchar r_address,uchar date)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">IIC_start();</span><br><span class="line">IIC_write_byte(d_address &amp; (~0x01));//å†™å™¨ä»¶åœ°å€,æ–¹å‘æ˜¯å†™,æ‰€ä»¥æˆ–ä¸Š0x00</span><br><span class="line">IIC_check_ack();//ç­‰å¾…åº”ç­”</span><br><span class="line">IIC_write_byte(r_address);//å†™å­˜å‚¨å™¨æ•°æ®å­˜æ”¾çš„8ä½åœ°å€</span><br><span class="line">IIC_check_ack();//ç­‰å¾…åº”ç­”</span><br><span class="line">IIC_write_byte(date);//å†™ä¸€å­—èŠ‚æ•°æ®</span><br><span class="line">IIC_check_ack();//ç­‰å¾…åº”ç­”</span><br><span class="line">IIC_stop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uchar ds1307_read_date(uchar d_address,uchar r_address)</span><br><span class="line">&#123;</span><br><span class="line">uchar r;</span><br><span class="line">IIC_start();</span><br><span class="line">IIC_write_byte(d_address &amp; (~0x01));//å†™å™¨ä»¶åœ°å€ï¼Œæ–¹å‘æ˜¯å†™</span><br><span class="line">IIC_check_ack();//ç­‰å¾…åº”ç­”</span><br><span class="line">IIC_write_byte(r_address);//å†™å­˜å‚¨å™¨æ•°æ®å­˜æ”¾çš„8ä½åœ°å€</span><br><span class="line">IIC_check_ack();//ç­‰å¾…åº”ç­”</span><br><span class="line"></span><br><span class="line">//æ¢æ–¹å‘</span><br><span class="line">IIC_start();</span><br><span class="line">IIC_write_byte(d_address|0x01);//å†™å™¨ä»¶åœ°å€ï¼Œæ–¹å‘æ˜¯è¯»ï¼Œæ‰€ä»¥æˆ–ä¸Š1</span><br><span class="line">    IIC_check_ack();</span><br><span class="line">r=IIC_read_byte();//è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°æ®</span><br><span class="line">IIC_un_ack();</span><br><span class="line">IIC_stop();</span><br><span class="line">return r;//å°†è¯»åˆ°çš„æ•°æ®è¿”å›</span><br><span class="line">&#125;</span><br><span class="line">void delay(uint z)//æ™¶æŒ¯é¢‘ç‡12MHzæ—¶ï¼Œz=1æ—¶å»¶è¿Ÿ1ms</span><br><span class="line">&#123;</span><br><span class="line">uint a,b;</span><br><span class="line">for(a=z;a&gt;0;a--)</span><br><span class="line">for(b=110;b&gt;0;b--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void lcd_write_com(uchar com)//lcdå†™æŒ‡ä»¤å‡½æ•°å®šä¹‰</span><br><span class="line">&#123;</span><br><span class="line">lcd_rs=0;</span><br><span class="line">P0=com;</span><br><span class="line">delay(1);</span><br><span class="line">lcd_e=1;</span><br><span class="line">lcd_e=0;</span><br><span class="line">delay(2);</span><br><span class="line">&#125;</span><br><span class="line">void lcd_write_date(uchar date)//lcdå†™æ•°æ®å‡½æ•°å®šä¹‰</span><br><span class="line">&#123;</span><br><span class="line">lcd_rs=1;</span><br><span class="line">P0=date;</span><br><span class="line">delay(1);</span><br><span class="line">lcd_e=1;</span><br><span class="line">lcd_e=0;</span><br><span class="line">delay(2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void lcd_write_second(uchar sec)//å‘lcdå†™ç§’</span><br><span class="line">&#123;</span><br><span class="line">uchar h,l;</span><br><span class="line">h=sec/10;</span><br><span class="line">l=sec%10;</span><br><span class="line">lcd_write_com(0x80+0x40+10);</span><br><span class="line">lcd_write_date(0x30+h);</span><br><span class="line">lcd_write_date(0x30+l);</span><br><span class="line">&#125;</span><br><span class="line">void lcd_write_minute(uchar min)//å‘lcdå†™åˆ†</span><br><span class="line">&#123;</span><br><span class="line">uchar h,l;</span><br><span class="line">h=min/10;</span><br><span class="line">l=min%10;</span><br><span class="line">lcd_write_com(0x80+0x40+7);</span><br><span class="line">lcd_write_date(0x30+h);</span><br><span class="line">lcd_write_date(0x30+l);</span><br><span class="line">&#125;</span><br><span class="line">void lcd_write_hour(uchar hou)//å‘lcdå†™æ—¶</span><br><span class="line">&#123;</span><br><span class="line">uchar h,l;</span><br><span class="line">h=hou/10;</span><br><span class="line">l=hou%10;</span><br><span class="line">lcd_write_com(0x80+0x40+4);</span><br><span class="line">lcd_write_date(0x30+h);</span><br><span class="line">lcd_write_date(0x30+l);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void inter0()interrupt 0</span><br><span class="line">&#123;</span><br><span class="line">run_time();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void run_time()//æ—¶é’Ÿèµ°åŠ¨å‡½æ•°å®šä¹‰</span><br><span class="line">&#123;</span><br><span class="line">//ä»1307ä¸­è¯»å‡ºæ—¶é—´</span><br><span class="line">b_second=ds1307_read_date(0xd0,0);//è¿”å›å‡½æ•°rå€¼ç§’</span><br><span class="line">b_minute=ds1307_read_date(0xd0,1);</span><br><span class="line">b_hour=ds1307_read_date(0xd0,2);</span><br><span class="line">//å°†è¯»å‡ºçš„æ—¶é—´è½¬æ¢æˆåè¿›å€¼</span><br><span class="line">second=bcdtodec(b_second);</span><br><span class="line">minute=bcdtodec(b_minute);</span><br><span class="line">hour=bcdtodec(b_hour);</span><br><span class="line">//æ›´æ–°lcdæ˜¾ç¤ºæ—¶é—´</span><br><span class="line">lcd_write_second(second);</span><br><span class="line">lcd_write_minute(minute);</span><br><span class="line">lcd_write_hour(hour);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uchar dectobcd(uchar dec)//åè¿›å€¼åˆ°BCDç </span><br><span class="line">&#123;</span><br><span class="line">uchar x,y;</span><br><span class="line">x=dec/10;//å¾—åˆ°bcdçš„åä½æ•°</span><br><span class="line">y=dec%10;//å¾—åˆ°bcdçš„ä¸ªä½æ•°</span><br><span class="line">y=(x&lt;&lt;4)|y;</span><br><span class="line">return y;</span><br><span class="line">&#125;</span><br><span class="line">uchar bcdtodec(uchar bcd)//bcdç è½¬åè¿›å€¼</span><br><span class="line">&#123;</span><br><span class="line">uchar x,y;</span><br><span class="line">y=bcd/16;//å¾—åˆ°åè¿›åˆ¶çš„åä½æ•°</span><br><span class="line">x=bcd%16;//å¾—åˆ°åè¿›åˆ¶çš„ä¸ªä½æ•°</span><br><span class="line">y=y*10+x;</span><br><span class="line">return y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void keyscan()//èœå•é”®æŒ‰ä¸‹æ‰«æå‡½æ•°å®šä¹‰</span><br><span class="line">&#123;</span><br><span class="line">k0=1;</span><br><span class="line">k1=1;</span><br><span class="line">k2=1;</span><br><span class="line">//åˆ¤æ–­èœå•é”®k0æ˜¯å¦æŒ‰ä¸‹</span><br><span class="line">if(k0==0)</span><br><span class="line">&#123;</span><br><span class="line">delay(5);</span><br><span class="line">if(k0==0)</span><br><span class="line">&#123;</span><br><span class="line">while(!k0);//æ¾æ‰‹æ£€æµ‹</span><br><span class="line">k0_num++;//è®°å½•èœå•é”®k0æ˜¯ç¬¬å‡ æ¬¡æŒ‰ä¸‹ï¼Œè€Œåˆ¤æ–­æ˜¯è°ƒèŠ‚ç§’ã€åˆ†è¿˜æ˜¯æ—¶ã€‚</span><br><span class="line">if(k0_num==1)//æŒ‡ç¤ºè°ƒèŠ‚ç§’</span><br><span class="line">&#123;</span><br><span class="line">EX0=0;//å…³é—­å¤–éƒ¨ä¸­æ–­0ï¼Œä½¿æ—¶é—´èµ°åŠ¨åœæ­¢ï¼Œå‡†å¤‡è°ƒæ—¶é—´</span><br><span class="line">ds1307_write_date(0xd0,0,0x80|b_second);</span><br><span class="line">lcd_write_com(0x80+0x40+11);//æ•°æ®æŒ‡é’ˆå’Œå…‰æ ‡ç§»åŠ¨ç§’å‡º</span><br><span class="line">lcd_write_com(0x0f);//ä½¿å…‰æ ‡æ˜¾ç¤ºï¼Œå¹¶å…‰æ ‡å¤„å­—ç¬¦æ ¼ç¬¦é—ªçƒï¼Œç”¨æ¥æç¤ºç”¨æˆ·æ­¤æ—¶å¯ä»¥è°ƒèŠ‚</span><br><span class="line"> //ä»€ä¹ˆï¼Ÿæ˜¯ç§’ï¼Œæ˜¯åˆ†è¿˜æ˜¯æ—¶ã€‚</span><br><span class="line">&#125;</span><br><span class="line">if(k0_num==2)//æŒ‡ç¤ºè°ƒèŠ‚åˆ†</span><br><span class="line">&#123;</span><br><span class="line">lcd_write_com(0x80+0x40+8);//æ•°æ®æŒ‡é’ˆå’Œå…‰æ ‡ç§»åŠ¨åˆ†å‡º</span><br><span class="line">&#125;</span><br><span class="line">if(k0_num==3)//æŒ‡ç¤ºè°ƒèŠ‚æ—¶</span><br><span class="line">&#123;</span><br><span class="line">lcd_write_com(0x80+0x40+5);//æ•°æ®æŒ‡é’ˆå’Œå…‰æ ‡ç§»åŠ¨æ—¶å‡º</span><br><span class="line">&#125;</span><br><span class="line">if(k0_num==4)//é€€å‡ºæ—¶é—´è°ƒèŠ‚èœå•</span><br><span class="line">&#123;</span><br><span class="line">k0_num=0;//èœå•é”®k0æŒ‰ä¸‹æ¸…é›¶</span><br><span class="line">lcd_write_com(0x0c);//æ¢å¤åˆ°æ—¶é’Ÿèµ°åŠ¨çŠ¶æ€ï¼Œå³å…‰æ ‡ä¸æ˜¾ç¤ºï¼Œä¸é—ªçƒ</span><br><span class="line">//å°†æ‰€è°ƒçš„æ—¶é—´è½¬æ¢æˆbcdç </span><br><span class="line">b_second=dectobcd(second);</span><br><span class="line">b_minute=dectobcd(minute);</span><br><span class="line">b_hour=dectobcd(hour);</span><br><span class="line">//å°†æ‰€è°ƒçš„æ—¶é—´å‘æ—¶é’Ÿå†™å…¥</span><br><span class="line">ds1307_write_date(0xd0,2,b_hour);</span><br><span class="line">ds1307_write_date(0xd0,1,b_minute);</span><br><span class="line">ds1307_write_date(0xd0,0,b_second);</span><br><span class="line"></span><br><span class="line">EX0=1;//å¼€å¤–éƒ¨ä¸­æ–­0ï¼Œæ—¶é—´å¼€å§‹ç»§ç»­èµ°åŠ¨</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">//åˆ¤æ–­æ˜¯å¦æŒ‰ä¸‹è¿‡æ—¶é—´è°ƒèŠ‚èœå•é”®k0,è€Œå¤„äºéœ€è¦è°ƒèŠ‚æ—¶é—´çŠ¶æ€</span><br><span class="line">if(k0_num)</span><br><span class="line">&#123;</span><br><span class="line">//åˆ¤æ–­æ˜¯å¦æ˜¯ä¸Šè°ƒé”®k1æŒ‰ä¸‹</span><br><span class="line">if(k1==0)</span><br><span class="line">&#123;</span><br><span class="line">delay(5);</span><br><span class="line">if(k1==0)</span><br><span class="line">&#123;</span><br><span class="line">while(!k1);//æ¾æ‰‹æ£€æµ‹</span><br><span class="line">if(k0_num==1)//ä¸Šè°ƒç§’</span><br><span class="line">&#123;</span><br><span class="line">second++;</span><br><span class="line">if(second==60)</span><br><span class="line">second=0;</span><br><span class="line">lcd_write_second(second);//å‘lcdå†™å…¥è¢«ä¿®æ”¹çš„æ—¶é—´</span><br><span class="line">lcd_write_com(0x80+0x40+11);//å…‰æ ‡ä½ç½®é‡å®šä½åˆ°æ‰€è¦è°ƒçš„æ—¶é—´å¤„</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">if(k0_num==2)//ä¸Šè°ƒåˆ†</span><br><span class="line">&#123;</span><br><span class="line">minute++;</span><br><span class="line">if(minute==60)</span><br><span class="line">minute=0;</span><br><span class="line">lcd_write_minute(minute);</span><br><span class="line">lcd_write_com(0x80+0x40+8);</span><br><span class="line">&#125;</span><br><span class="line">if(k0_num==3)//ä¸Šè°ƒæ—¶</span><br><span class="line">&#123;</span><br><span class="line">hour++;</span><br><span class="line">if(hour==24)</span><br><span class="line">hour=0;</span><br><span class="line">lcd_write_hour(hour);</span><br><span class="line">lcd_write_com(0x80+0x40+5);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">//åˆ¤æ–­æ˜¯å¦æ˜¯ä¸‹è°ƒé”®k2æŒ‰ä¸‹</span><br><span class="line">if(k2==0)</span><br><span class="line">&#123;</span><br><span class="line">delay(5);</span><br><span class="line">if(k2==0)</span><br><span class="line">&#123;</span><br><span class="line">while(!k2);</span><br><span class="line">if(k0_num==1)//ä¸‹è°ƒèŠ‚ç§’</span><br><span class="line">&#123;</span><br><span class="line">second--;</span><br><span class="line">if(second==255)</span><br><span class="line">second=59;</span><br><span class="line">lcd_write_second(second);</span><br><span class="line">lcd_write_com(0x80+0x40+11);</span><br><span class="line">&#125;</span><br><span class="line">if(k0_num==2)//ä¸‹è°ƒèŠ‚åˆ†</span><br><span class="line">&#123;</span><br><span class="line">minute--;</span><br><span class="line">if(minute==255)</span><br><span class="line">minute=59;</span><br><span class="line">lcd_write_minute(minute);</span><br><span class="line">lcd_write_com(0x80+0x40+8);</span><br><span class="line">&#125;</span><br><span class="line">if(k0_num==3)//ä¸‹è°ƒèŠ‚æ—¶</span><br><span class="line">&#123;</span><br><span class="line">hour--;</span><br><span class="line">if(hour==255)</span><br><span class="line">hour=23;</span><br><span class="line">lcd_write_hour(hour);</span><br><span class="line">lcd_write_com(0x80+0x40+5);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨å›› 6æœˆ 23 2022</li><li>Processor: AT89C51</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>&#x2F;****************************************************</p><p>ç”µè·¯å›¾è¯´æ˜ï¼š<br>    å°†å•ç‰‡æœºP2.7å’ŒP1.0åˆ†åˆ«ä¸RTCï¼ˆå®æ—¶æ—¶é’Ÿï¼‰çš„æ—¶é’Ÿä¿¡å·SCLç«¯<br>å’Œæ•°æ®ä¿¡å·SDAç«¯ç›¸è¿ï¼Œ RTCçš„soutå¼•è„šä¸å•ç‰‡æœºP3.2ç›¸è¿ï¼ŒRTCçš„<br>åœ°å€æ˜¯11010000(0xD0)ç‹¬ç«‹é”®ç›˜k0<del>K3æ¥P1.1</del>P1.3<br>ç¨‹åºåŠŸèƒ½ï¼š<br>      ä½¿ç”¨æ—¶é’ŸèŠ¯ç‰‡ds1307åˆ¶ä½œä¸€ä¸ªå®æ—¶æ—¶é’Ÿ<br>******************************************************&#x2F;<br>#include &lt;reg52.h&gt;<br>#include&lt;intrins.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int<br>&#x2F;&#x2F;å®æ—¶æ—¶é’Ÿä¸¤ä¿¡å·çº¿<br>sbit scl&#x3D;P2^7;<br>sbit sda&#x3D;P1^0;<br>&#x2F;&#x2F;ç‹¬ç«‹é”®ç›˜æ‰«æä½<br>sbit k0&#x3D;P1^1;<br>sbit k1&#x3D;P1^2;<br>sbit k2&#x3D;P1^3;<br>&#x2F;&#x2F;æ¶²æ™¶æ˜¾ç¤ºå™¨æ§åˆ¶ä½<br>sbit lcd_rs&#x3D;P3^4;<br>sbit lcd_e&#x3D;P3^5;<br>void init();&#x2F;&#x2F;åˆå§‹åŒ–IICæ€»çº¿ï¼Œä½¿æ€»çº¿å¤„äºå¤‡ç”¨çŠ¶æ€,<br>            &#x2F;&#x2F;åˆå§‹åŒ–lcdå¹¶æ˜¾ç¤ºä¸Šé¢table1å’Œtable2çš„å€¼ï¼Œåˆå§‹åŒ–å®šæ—¶å™¨0ï¼Œåˆå§‹åŒ–å˜é‡æ—¶åˆ†ç§’</p><p>&#x2F;<strong><strong><strong><strong><strong><strong><strong><strong>IICæ€»çº¿æ§åˆ¶å‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong>***********&#x2F;<br>void IIC_start();&#x2F;&#x2F;IICé€šä¿¡å¼€å§‹ä¿¡å·<br>void IIC_stop();&#x2F;&#x2F;IICé€šä¿¡åœæ­¢ä¿¡å·<br>void IIC_un_ack();&#x2F;&#x2F;å•ç‰‡æœºå‘é€éåº”ç­”ä½<br>&#x2F;&#x2F;void IIC_ack();&#x2F;&#x2F;å•ç‰‡æœºå‘é€åº”ç­”ä½<br>void IIC_check_ack();&#x2F;&#x2F;å•ç‰‡æœºæ£€æŸ¥åº”ç­”ä½<br>void IIC_write_byte(uchar);&#x2F;&#x2F;å‘é€ä¸€å­—èŠ‚æ•°æ®<br>uchar IIC_read_byte();&#x2F;&#x2F;æ¥æ”¶ä¸€å­—èŠ‚æ•°æ®<br>void nop();&#x2F;&#x2F;5usç©ºæ“ä½œå»¶è¿Ÿ<br>&#x2F;**********************************&#x2F;<br>&#x2F;<strong><strong><strong><strong><strong>ds1307è¯»å†™å‡½æ•°</strong></strong></strong></strong></strong>*********&#x2F;<br>void ds1307_write_date(uchar ,uchar ,uchar);&#x2F;&#x2F;å‘æŒ‡å®šå™¨ä»¶å†™ä¸€å­—èŠ‚æ•°æ®<br>                                    &#x2F;&#x2F;å‚æ•°1å™¨ä»¶åœ°å€ï¼Œå‚æ•°2è¦å­˜çš„æ•°æ®å­˜æ”¾ä½ç½®8ä½åœ°å€<br>                                    &#x2F;&#x2F;å‚æ•°3è¦å†™çš„æ•°æ®</p><p>uchar ds1307_read_date(uchar ,uchar );&#x2F;&#x2F;ä»æŒ‡å®šå™¨ä»¶è¯»ä¸€å­—èŠ‚æ•°æ®ï¼Œ<br>                                &#x2F;&#x2F;å‚æ•°1è¢«é€šä¿¡å™¨ä»¶åœ°å€ï¼Œå‚æ•°2è¦è¯»çš„æ•°æ®å­˜æ”¾ä½ç½®8ä½åœ°å€<br>                                &#x2F;&#x2F;å‡½æ•°è¿”å›è¯»å–çš„æ•°æ®ã€‚<br>void delay(uint);&#x2F;&#x2F;åŸºæ•°1mså»¶è¿Ÿç¨‹åº<br>&#x2F;***********************************&#x2F;</p><p>&#x2F;<strong><strong><strong><strong><strong><strong><strong>LCDæ“ä½œå‡½æ•°</strong></strong></strong></strong></strong></strong></strong>************&#x2F;</p><p>uchar hour,minute,second,k0_num;&#x2F;&#x2F;æ—¶åˆ†ç§’å˜é‡ï¼Œèœå•é”®k0ç¬¬å‡ æ¬¡æŒ‰ä¸‹è®¡æ•°ï¼Œds1307è·Ÿæ–°æ ‡å¿—<br>&#x2F;&#x2F;æ—¶é’Ÿåˆæ˜¾ç¤º<br>uchar code table1[]&#x3D;â€2022-06-23 Thuâ€;<br>uchar code table2[]&#x3D;â€    16:31:15 â€œ;&#x2F;&#x2F;2022å¹´6æœˆ23æ—¥16:31:15</p><p>void lcd_write_com(uchar);&#x2F;&#x2F;å‘æ¶²æ™¶æ˜¾ç¤ºå™¨å†™æŒ‡ä»¤è®¾ç½®å…¶æ˜¾ç¤ºçš„æ ¼å¼<br>void lcd_write_date(uchar);&#x2F;&#x2F;å‘æ¶²æ™¶æ˜¾ç¤ºå™¨å†™æ˜¾ç¤ºçš„æ•°æ®</p><p>&#x2F;**********************************************&#x2F;</p><p>&#x2F;<strong><strong><strong><strong><strong><strong><strong>æ—¶é’Ÿå‡½æ•°</strong></strong></strong></strong></strong></strong></strong>*****&#x2F;<br>void lcd_write_second(uchar);&#x2F;&#x2F;å‘lcdå†™ç§’<br>void lcd_write_minute(uchar);&#x2F;&#x2F;å‘lcdå†™åˆ†<br>void lcd_write_hour(uchar);&#x2F;&#x2F;å‘lcdå†™æ—¶<br>void run_time();&#x2F;&#x2F;æ—¶é’Ÿèµ°åŠ¨æ˜¾ç¤º<br>void keyscan();&#x2F;&#x2F;èœå•é”®æ‰«æ<br>&#x2F;****************************************&#x2F;</p><p>&#x2F;<em><strong><strong><strong><strong>åè¿›å€¼ä¸BCDç ä¹‹é—´äº’æ¢</strong></strong></strong></strong></em><em>&#x2F;<br>uchar b_second,b_minute,b_hour;<br>uchar dectobcd(uchar);&#x2F;&#x2F;åè¿›å€¼è½¬bcdç <br>uchar bcdtodec(uchar);&#x2F;&#x2F;bcdç è½¬åè¿›å€¼<br>&#x2F;</em>***************************************&#x2F;</p><p>void main()<br>{<br>    init();<br>    while(1)<br>    {<br>        keyscan();<br>    }<br>}</p><p>void nop()<br>{<br>    <em>nop</em>();<em>nop</em>();<em>nop</em>();<br>    <em>nop</em>();<em>nop</em>();<em>nop</em>();<br>}</p><p>void init()<br>{<br>    uchar i;<br>    &#x2F;&#x2F;å°†æ•°æ®çº¿å’Œæ—¶é’Ÿçº¿æ‹‰é«˜ï¼Œå¤„äºå¤‡ç”¨çŠ¶æ€å³éå¿™<br>    sda&#x3D;1;<br>    nop();<br>    scl&#x3D;1;<br>    nop();</p><pre><code>//åˆå§‹åŒ–å†™å…¥LCDçš„æ—¶åˆ†ç§’    second=16;    minute=23;    hour=16;//åˆå§‹åŒ–ds1307ds1307_write_date(0xd0,0x07,0x10);//åˆå§‹åŒ–1307çš„æ§åˆ¶å­—ï¼Œä½¿å…¶SOUTå¼•è„šè¾“å‡º1Hzçš„æ–¹æ³¢ã€‚//åˆå§‹åŒ–1307çš„æ—¶é—´ds1307_write_date(0xd0,6,0x14); ds1307_write_date(0xd0,5,0x06);   ds1307_write_date(0xd0,4,0x09);ds1307_write_date(0xd0,3,0x00);ds1307_write_date(0xd0,2,0x23);ds1307_write_date(0xd0,1,0x59);ds1307_write_date(0xd0,0,0x55);//åˆå§‹åŒ–æ¶²æ™¶æ˜¾ç¤ºå™¨lcd_write_com(0x38);//è®¾ç½®16*2è¡Œï¼Œ5*7ç‚¹é˜µï¼Œ8ä½æ•°æ®æ¥å£lcd_write_com(0x06);//å†™å­—ç¬¦æŒ‡é’ˆå’Œå…‰æ ‡è‡ªåŠ¨å‘å³ç§»åŠ¨lcd_write_com(0x0c);//å¼€æ˜¾ç¤ºï¼Œä¸æ˜¾ç¤ºå…‰æ ‡ï¼Œå…‰æ ‡ä¸é—ªçƒlcd_write_com(0x01);//æ˜¾ç¤ºæ¸…å±for(i=0;i&lt;15;i++)&#123;    lcd_write_date(table1[i]);&#125;lcd_write_com(0x80+0x40);for(i=0;i&lt;10;i++)&#123;    lcd_write_date(table2[i]);&#125;</code></pre><p>&#x2F;&#x2F;å¼€å¯å¤–éƒ¨ä¸­æ–­0<br>    EA&#x3D;1;<br>    EX0&#x3D;1;<br>    IT0&#x3D;1;<br>}<br>void IIC_start()<br>{<br>    &#x2F;&#x2F;åœ¨æ—¶é’Ÿä¿¡å·æœ‰æ•ˆscl&#x3D;1æ—¶ï¼Œæ•°æ®çº¿è´Ÿè·³å˜<br>    sda&#x3D;1;<br>    nop();<br>    scl&#x3D;1;<br>    nop();<br>    sda&#x3D;0;<br>    nop();<br>    scl&#x3D;0;&#x2F;&#x2F;æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡<br>    nop();<br>}<br>void IIC_stop()<br>{<br>    &#x2F;&#x2F;åœ¨æ—¶é’Ÿä¿¡å·æœ‰æ•ˆscl&#x3D;1æ—¶ï¼Œæ•°æ®çº¿æ­£è·³å˜ï¼Œé‡Šæ”¾æ€»çº¿,ä½¿æ€»çº¿å¤„äºå¤‡ç”¨çŠ¶æ€å³éå¿™<br>    sda&#x3D;0;<br>    nop();<br>    scl&#x3D;1;<br>    nop();<br>    sda&#x3D;1;<br>    nop();<br>    nop();<br>    nop();<br>}<br>void IIC_un_ack()<br>{<br>    &#x2F;&#x2F;æ—¶é’Ÿä¿¡å·æœ‰æ•ˆæ—¶ï¼Œsdaç»™1ï¼Œç»™å‡ºéåº”ç­”<br>    sda&#x3D;1;<br>    nop();<br>    scl&#x3D;1;<br>    nop();<br>    scl&#x3D;0;&#x2F;&#x2F;æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡<br>    nop();<br>}<br>&#x2F;*<br>void IIC_ack()<br>{<br>    &#x2F;&#x2F;æ—¶é’Ÿä¿¡å·æœ‰æ•ˆæ—¶ï¼Œsdaç»™0ï¼Œç»™å‡ºåº”ç­”<br>    sda&#x3D;0;<br>    nop();<br>    scl&#x3D;1;<br>    nop();<br>    scl&#x3D;0;&#x2F;&#x2F;æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡<br>    nop();<br>}<br>*&#x2F;<br>void IIC_check_ack()<br>{<br>    &#x2F;&#x2F;uchar i;<br>    &#x2F;&#x2F;æ—¶é’Ÿä¿¡å·æœ‰æ•ˆæ—¶ï¼Œæ£€æµ‹æ•°æ®ä¿¡å·sdaæ˜¯å¦ä¸º0ï¼Œç»™0è¯´æ˜æœ‰åº”ç­”ä¿¡å·<br>    scl&#x3D;1;<br>    &#x2F;&#x2F;while((sda&#x3D;&#x3D;1)&amp;&amp;(i&lt;255)) i++;<br>    nop();<br>    scl&#x3D;0;&#x2F;&#x2F;æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡<br>    nop();<br>}<br>uchar IIC_read_byte( )<br>{<br>    uchar i,temp;&#x2F;&#x2F;tempç”¨äºå­˜æ”¾ä»æ•°æ®çº¿è¯»åˆ°çš„æ•°æ®</p><pre><code>for(i=0;i&lt;8;i++)//ä»æ•°æ®çº¿è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰&#123;    scl=1;    nop();    temp=(temp&lt;&lt;1)|sda;//tempå·¦ç§»ï¼Œè…¾å‡ºç¬¬0ä½ï¼Œç„¶åå°†æ•°æ®çº¿ä¸Šçš„ä¸€ä½æ•°ç”¨æˆ–                             //è¿ç®—å­˜æ”¾åˆ°tempçš„ç¬¬0ä½    scl=0;//æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡    nop();&#125;return temp;</code></pre><p>}</p><p>void IIC_write_byte(uchar byte)<br>{<br>    uchar i;<br>    for(i&#x3D;0;i&lt;8;i++)&#x2F;&#x2F;å‘æ•°æ®çº¿å†™ä¸€ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰<br>    {<br>        byte&#x3D;byte&lt;&lt;1;&#x2F;&#x2F;å·¦ç§»ä½ï¼Œå°†byteç¬¬7ä½ç§»åˆ°PSWä¸­çš„è¿›ä½æ ‡å¿—ä½CYä¸­<br>        sda&#x3D;CY;<br>        nop();<br>        scl&#x3D;1;<br>        nop();<br>        scl&#x3D;0;&#x2F;&#x2F;æ‹‰ä½ä¸ºä¸‹ä¸ªæ—¶é’Ÿæ•°æ®ä½œå‡†å¤‡<br>        nop();<br>    }<br>    sda&#x3D;1;&#x2F;&#x2F;é‡Šæ”¾æ€»çº¿ï¼Œå‡†å¤‡æ¥æ”¶è¢«æ§è®¾å¤‡åº”ç­”ä¿¡å·<br>    nop();<br>}</p><p>void ds1307_write_date(uchar d_address,uchar r_address,uchar date)<br>{</p><pre><code>IIC_start();IIC_write_byte(d_address &amp; (~0x01));//å†™å™¨ä»¶åœ°å€,æ–¹å‘æ˜¯å†™,æ‰€ä»¥æˆ–ä¸Š0x00IIC_check_ack();//ç­‰å¾…åº”ç­”IIC_write_byte(r_address);//å†™å­˜å‚¨å™¨æ•°æ®å­˜æ”¾çš„8ä½åœ°å€IIC_check_ack();//ç­‰å¾…åº”ç­”IIC_write_byte(date);//å†™ä¸€å­—èŠ‚æ•°æ®IIC_check_ack();//ç­‰å¾…åº”ç­”IIC_stop();</code></pre><p>}</p><p>uchar ds1307_read_date(uchar d_address,uchar r_address)<br>{<br>    uchar r;<br>    IIC_start();<br>    IIC_write_byte(d_address &amp; (~0x01));&#x2F;&#x2F;å†™å™¨ä»¶åœ°å€ï¼Œæ–¹å‘æ˜¯å†™<br>    IIC_check_ack();&#x2F;&#x2F;ç­‰å¾…åº”ç­”<br>    IIC_write_byte(r_address);&#x2F;&#x2F;å†™å­˜å‚¨å™¨æ•°æ®å­˜æ”¾çš„8ä½åœ°å€<br>    IIC_check_ack();&#x2F;&#x2F;ç­‰å¾…åº”ç­”</p><pre><code>//æ¢æ–¹å‘IIC_start();IIC_write_byte(d_address|0x01);//å†™å™¨ä»¶åœ°å€ï¼Œæ–¹å‘æ˜¯è¯»ï¼Œæ‰€ä»¥æˆ–ä¸Š1IIC_check_ack();r=IIC_read_byte();//è¯»å–ä¸€ä¸ªå­—èŠ‚æ•°æ®IIC_un_ack();IIC_stop();return r;//å°†è¯»åˆ°çš„æ•°æ®è¿”å›</code></pre><p>}<br>void delay(uint z)&#x2F;&#x2F;æ™¶æŒ¯é¢‘ç‡12MHzæ—¶ï¼Œz&#x3D;1æ—¶å»¶è¿Ÿ1ms<br>{<br>    uint a,b;<br>    for(a&#x3D;z;a&gt;0;aâ€“)<br>        for(b&#x3D;110;b&gt;0;bâ€“);<br>}</p><p>void lcd_write_com(uchar com)&#x2F;&#x2F;lcdå†™æŒ‡ä»¤å‡½æ•°å®šä¹‰<br>{<br>    lcd_rs&#x3D;0;<br>    P0&#x3D;com;<br>    delay(1);<br>    lcd_e&#x3D;1;<br>    lcd_e&#x3D;0;<br>    delay(2);<br>}<br>void lcd_write_date(uchar date)&#x2F;&#x2F;lcdå†™æ•°æ®å‡½æ•°å®šä¹‰<br>{<br>    lcd_rs&#x3D;1;<br>    P0&#x3D;date;<br>    delay(1);<br>    lcd_e&#x3D;1;<br>    lcd_e&#x3D;0;<br>    delay(2);<br>}</p><p>void lcd_write_second(uchar sec)&#x2F;&#x2F;å‘lcdå†™ç§’<br>{<br>    uchar h,l;<br>    h&#x3D;sec&#x2F;10;<br>    l&#x3D;sec%10;<br>    lcd_write_com(0x80+0x40+10);<br>    lcd_write_date(0x30+h);<br>    lcd_write_date(0x30+l);<br>}<br>void lcd_write_minute(uchar min)&#x2F;&#x2F;å‘lcdå†™åˆ†<br>{<br>    uchar h,l;<br>    h&#x3D;min&#x2F;10;<br>    l&#x3D;min%10;<br>    lcd_write_com(0x80+0x40+7);<br>    lcd_write_date(0x30+h);<br>    lcd_write_date(0x30+l);<br>}<br>void lcd_write_hour(uchar hou)&#x2F;&#x2F;å‘lcdå†™æ—¶<br>{<br>    uchar h,l;<br>    h&#x3D;hou&#x2F;10;<br>    l&#x3D;hou%10;<br>    lcd_write_com(0x80+0x40+4);<br>    lcd_write_date(0x30+h);<br>    lcd_write_date(0x30+l);<br>}</p><p>void inter0()interrupt 0<br>{<br>    run_time();<br>}</p><p>void run_time()&#x2F;&#x2F;æ—¶é’Ÿèµ°åŠ¨å‡½æ•°å®šä¹‰<br>{<br>    &#x2F;&#x2F;ä»1307ä¸­è¯»å‡ºæ—¶é—´<br>    b_second&#x3D;ds1307_read_date(0xd0,0);&#x2F;&#x2F;è¿”å›å‡½æ•°rå€¼ç§’<br>    b_minute&#x3D;ds1307_read_date(0xd0,1);<br>    b_hour&#x3D;ds1307_read_date(0xd0,2);<br>    &#x2F;&#x2F;å°†è¯»å‡ºçš„æ—¶é—´è½¬æ¢æˆåè¿›å€¼<br>    second&#x3D;bcdtodec(b_second);<br>    minute&#x3D;bcdtodec(b_minute);<br>    hour&#x3D;bcdtodec(b_hour);<br>    &#x2F;&#x2F;æ›´æ–°lcdæ˜¾ç¤ºæ—¶é—´<br>    lcd_write_second(second);<br>    lcd_write_minute(minute);<br>    lcd_write_hour(hour);<br>}</p><p>uchar dectobcd(uchar dec)&#x2F;&#x2F;åè¿›å€¼åˆ°BCDç <br>{<br>    uchar x,y;<br>    x&#x3D;dec&#x2F;10;&#x2F;&#x2F;å¾—åˆ°bcdçš„åä½æ•°<br>    y&#x3D;dec%10;&#x2F;&#x2F;å¾—åˆ°bcdçš„ä¸ªä½æ•°<br>    y&#x3D;(x&lt;&lt;4)|y;<br>    return y;<br>}<br>uchar bcdtodec(uchar bcd)&#x2F;&#x2F;bcdç è½¬åè¿›å€¼<br>{<br>    uchar x,y;<br>    y&#x3D;bcd&#x2F;16;&#x2F;&#x2F;å¾—åˆ°åè¿›åˆ¶çš„åä½æ•°<br>    x&#x3D;bcd%16;&#x2F;&#x2F;å¾—åˆ°åè¿›åˆ¶çš„ä¸ªä½æ•°<br>    y&#x3D;y*10+x;<br>    return y;<br>}</p><p>void keyscan()&#x2F;&#x2F;èœå•é”®æŒ‰ä¸‹æ‰«æå‡½æ•°å®šä¹‰<br>{<br>    k0&#x3D;1;<br>    k1&#x3D;1;<br>    k2&#x3D;1;<br>    &#x2F;&#x2F;åˆ¤æ–­èœå•é”®k0æ˜¯å¦æŒ‰ä¸‹<br>    if(k0&#x3D;&#x3D;0)<br>    {<br>        delay(5);<br>        if(k0&#x3D;&#x3D;0)<br>        {<br>            while(!k0);&#x2F;&#x2F;æ¾æ‰‹æ£€æµ‹<br>            k0_num++;&#x2F;&#x2F;è®°å½•èœå•é”®k0æ˜¯ç¬¬å‡ æ¬¡æŒ‰ä¸‹ï¼Œè€Œåˆ¤æ–­æ˜¯è°ƒèŠ‚ç§’ã€åˆ†è¿˜æ˜¯æ—¶ã€‚<br>            if(k0_num&#x3D;&#x3D;1)&#x2F;&#x2F;æŒ‡ç¤ºè°ƒèŠ‚ç§’<br>            {<br>                EX0&#x3D;0;&#x2F;&#x2F;å…³é—­å¤–éƒ¨ä¸­æ–­0ï¼Œä½¿æ—¶é—´èµ°åŠ¨åœæ­¢ï¼Œå‡†å¤‡è°ƒæ—¶é—´<br>                ds1307_write_date(0xd0,0,0x80|b_second);<br>                lcd_write_com(0x80+0x40+11);&#x2F;&#x2F;æ•°æ®æŒ‡é’ˆå’Œå…‰æ ‡ç§»åŠ¨ç§’å‡º<br>                lcd_write_com(0x0f);&#x2F;&#x2F;ä½¿å…‰æ ‡æ˜¾ç¤ºï¼Œå¹¶å…‰æ ‡å¤„å­—ç¬¦æ ¼ç¬¦é—ªçƒï¼Œç”¨æ¥æç¤ºç”¨æˆ·æ­¤æ—¶å¯ä»¥è°ƒèŠ‚<br>                                     &#x2F;&#x2F;ä»€ä¹ˆï¼Ÿæ˜¯ç§’ï¼Œæ˜¯åˆ†è¿˜æ˜¯æ—¶ã€‚<br>            }<br>            if(k0_num&#x3D;&#x3D;2)&#x2F;&#x2F;æŒ‡ç¤ºè°ƒèŠ‚åˆ†<br>            {<br>                lcd_write_com(0x80+0x40+8);&#x2F;&#x2F;æ•°æ®æŒ‡é’ˆå’Œå…‰æ ‡ç§»åŠ¨åˆ†å‡º<br>            }<br>            if(k0_num&#x3D;&#x3D;3)&#x2F;&#x2F;æŒ‡ç¤ºè°ƒèŠ‚æ—¶<br>            {<br>                lcd_write_com(0x80+0x40+5);&#x2F;&#x2F;æ•°æ®æŒ‡é’ˆå’Œå…‰æ ‡ç§»åŠ¨æ—¶å‡º<br>            }<br>            if(k0_num&#x3D;&#x3D;4)&#x2F;&#x2F;é€€å‡ºæ—¶é—´è°ƒèŠ‚èœå•<br>            {<br>                k0_num&#x3D;0;&#x2F;&#x2F;èœå•é”®k0æŒ‰ä¸‹æ¸…é›¶<br>                lcd_write_com(0x0c);&#x2F;&#x2F;æ¢å¤åˆ°æ—¶é’Ÿèµ°åŠ¨çŠ¶æ€ï¼Œå³å…‰æ ‡ä¸æ˜¾ç¤ºï¼Œä¸é—ªçƒ<br>                &#x2F;&#x2F;å°†æ‰€è°ƒçš„æ—¶é—´è½¬æ¢æˆbcdç <br>                b_second&#x3D;dectobcd(second);<br>                b_minute&#x3D;dectobcd(minute);<br>                b_hour&#x3D;dectobcd(hour);<br>                &#x2F;&#x2F;å°†æ‰€è°ƒçš„æ—¶é—´å‘æ—¶é’Ÿå†™å…¥<br>                ds1307_write_date(0xd0,2,b_hour);<br>                ds1307_write_date(0xd0,1,b_minute);<br>                ds1307_write_date(0xd0,0,b_second);</p><pre><code>            EX0=1;//å¼€å¤–éƒ¨ä¸­æ–­0ï¼Œæ—¶é—´å¼€å§‹ç»§ç»­èµ°åŠ¨        &#125;            &#125;&#125;//åˆ¤æ–­æ˜¯å¦æŒ‰ä¸‹è¿‡æ—¶é—´è°ƒèŠ‚èœå•é”®k0,è€Œå¤„äºéœ€è¦è°ƒèŠ‚æ—¶é—´çŠ¶æ€if(k0_num)&#123;    //åˆ¤æ–­æ˜¯å¦æ˜¯ä¸Šè°ƒé”®k1æŒ‰ä¸‹    if(k1==0)    &#123;        delay(5);        if(k1==0)        &#123;            while(!k1);//æ¾æ‰‹æ£€æµ‹            if(k0_num==1)//ä¸Šè°ƒç§’            &#123;                second++;                if(second==60)                    second=0;                lcd_write_second(second);//å‘lcdå†™å…¥è¢«ä¿®æ”¹çš„æ—¶é—´                lcd_write_com(0x80+0x40+11);//å…‰æ ‡ä½ç½®é‡å®šä½åˆ°æ‰€è¦è°ƒçš„æ—¶é—´å¤„                            &#125;            if(k0_num==2)//ä¸Šè°ƒåˆ†            &#123;                minute++;                if(minute==60)                    minute=0;                lcd_write_minute(minute);                lcd_write_com(0x80+0x40+8);            &#125;            if(k0_num==3)//ä¸Šè°ƒæ—¶            &#123;                hour++;                if(hour==24)                    hour=0;                lcd_write_hour(hour);                lcd_write_com(0x80+0x40+5);            &#125;        &#125;    &#125;    //åˆ¤æ–­æ˜¯å¦æ˜¯ä¸‹è°ƒé”®k2æŒ‰ä¸‹    if(k2==0)    &#123;        delay(5);        if(k2==0)        &#123;            while(!k2);            if(k0_num==1)//ä¸‹è°ƒèŠ‚ç§’            &#123;                second--;                if(second==255)                    second=59;                lcd_write_second(second);                lcd_write_com(0x80+0x40+11);            &#125;            if(k0_num==2)//ä¸‹è°ƒèŠ‚åˆ†            &#123;                minute--;                if(minute==255)                    minute=59;                lcd_write_minute(minute);                lcd_write_com(0x80+0x40+8);            &#125;            if(k0_num==3)//ä¸‹è°ƒèŠ‚æ—¶            &#123;                hour--;                if(hour==255)                    hour=23;                lcd_write_hour(hour);                lcd_write_com(0x80+0x40+5);            &#125;        &#125;    &#125;&#125;</code></pre><p>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/15j7vId51clOJlcNxIMkcww </span><br><span class="line">æå–ç ï¼š8z3w</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/15j7vId51clOJlcNxIMkcww  æå–ç ï¼š8z3w</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘4x4çŸ©é˜µé”®ç›˜ä¸­æ–­æ–¹å¼æ‰«æ +æ•°ç ç®¡æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F4x4%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98%E4%B8%AD%E6%96%AD%E6%96%B9%E5%BC%8F%E6%89%AB%E6%8F%8F-%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F4x4%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98%E4%B8%AD%E6%96%AD%E6%96%B9%E5%BC%8F%E6%89%AB%E6%8F%8F-%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘4x4çŸ©é˜µé”®ç›˜ä¸­æ–­æ–¹å¼æ‰«æ-æ•°ç ç®¡æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘4x4çŸ©é˜µé”®ç›˜ä¸­æ–­æ–¹å¼æ‰«æ-æ•°ç ç®¡æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4x4çŸ©é˜µé”®ç›˜ä¸­æ–­æ–¹å¼æ‰«æ +æ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘4x4çŸ©é˜µé”®ç›˜ä¸­æ–­æ–¹å¼æ‰«æ +æ•°ç ç®¡æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘4x4çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ-æ•°ç ç®¡æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘4x4çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ-æ•°ç ç®¡æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘4x4çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ +æ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘4x4çŸ©é˜µé”®ç›˜ä¸­æ–­æ‰«æ +æ•°ç ç®¡æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li><li>ç›¸å…³ç¯‡ã€Šã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ+LCD128x64æ˜¾ç¤ºã€‹</li><li>ã€Šã€Proteusä»¿çœŸã€‘Arduino UNO+æ•°ç ç®¡æ˜¾ç¤º4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ã€‹</li><li>ã€Š51å•ç‰‡æœº æ•°ç ç®¡æ˜¾ç¤º(0 -F)+4Ã—4é”®ç›˜çŸ©é˜µæŒ‰é”®è¾“å…¥ã€‹</li><li>ã€Š51å•ç‰‡æœº8x9çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸã€‹</li><li>ã€Š51å•ç‰‡æœº8x8çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸã€‹</li></ul><p>Proteusä»¿çœŸæ¼”ç¤º</p><p><img src="https://img-blog.csdnimg.cn/7a333bec53ef4e39b22053f43b959fed.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç›¸å…³ç¯‡ã€Šã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ+LCD128x64æ˜¾ç¤ºã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/125348185">ã€Proteusä»¿çœŸã€‘é”®ç›˜çŸ©é˜µæ‰«æ+LCD128x64æ˜¾ç¤º</a></p><p>ã€Šã€Proteusä»¿çœŸã€‘Arduino UNO+æ•°ç ç®¡æ˜¾ç¤º4x4é”®ç›˜çŸ©é˜µæŒ‰é”®ã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/125452871">ã€Proteusä»¿çœŸã€‘Arduino UNO+æ•°ç ç®¡æ˜¾ç¤º4x4é”®ç›˜çŸ©é˜µæŒ‰é”®</a></p><p>ã€Š51å•ç‰‡æœº æ•°ç ç®¡æ˜¾ç¤º(0 -F)+4Ã—4é”®ç›˜çŸ©é˜µæŒ‰é”®è¾“å…¥ã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/121007364">51å•ç‰‡æœº æ•°ç ç®¡æ˜¾ç¤º(0 -F)+4Ã—4é”®ç›˜çŸ©é˜µæŒ‰é”®è¾“å…¥</a></p><p>ã€Š51å•ç‰‡æœº8x9çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120009976">51å•ç‰‡æœº8x9çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸ</a></p><p>ã€Š51å•ç‰‡æœº8x8çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/120007533">51å•ç‰‡æœº8x8çŸ©é˜µé”®ç›˜+æ•°ç ç®¡+74HC595+Proteusä»¿çœŸ</a></p><h4 id="åŠŸèƒ½è¯´æ˜"><a href="#åŠŸèƒ½è¯´æ˜" class="headerlink" title="åŠŸèƒ½è¯´æ˜"></a>åŠŸèƒ½è¯´æ˜</h4><p>ä¸­æ–­æ–¹å¼å¯ä»¥æœ‰æ•ˆæé«˜cpuå·¥ä½œæ•ˆç‡ï¼Œåœ¨æœ‰æŒ‰é”®åŠ¨ä½œæ—¶æ‰è¿›è¡Œæ‰«æï¼Œå¹³æ—¶ä¸è¿›è¡Œæ‰«æå·¥ä½œã€‚</p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line">/*-----------------------------------------------</span><br><span class="line">  åç§°ï¼šçŸ©é˜µé”®ç›˜ä¾æ¬¡è¾“å…¥æ§åˆ¶ ä½¿ç”¨è¡Œåˆ—é€çº§æ‰«æ ä¸­æ–­æ–¹å¼</span><br><span class="line"></span><br><span class="line">  å†…å®¹ï¼šå¦‚è®¡ç®—å™¨è¾“å…¥æ•°æ®å½¢å¼ç›¸åŒ ä»å³è‡³å·¦ ä½¿ç”¨è¡Œåˆ—æ‰«ææ–¹æ³•</span><br><span class="line">        ä¸­æ–­æ–¹å¼å¯ä»¥æœ‰æ•ˆæä¾›cpuå·¥ä½œæ•ˆç‡ï¼Œåœ¨æœ‰æŒ‰é”®åŠ¨ä½œæ—¶æ‰æ‰«æï¼Œå¹³æ—¶ä¸è¿›è¡Œæ‰«æå·¥ä½œ</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">#include&lt;reg52.h&gt; //åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰</span><br><span class="line">#include&lt;intrins.h&gt; </span><br><span class="line"></span><br><span class="line">#define DataPort P0 //å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢</span><br><span class="line">#define KeyPort  P1</span><br><span class="line">#define MAIN_Fosc12000000uL//å®šä¹‰ä¸»æ—¶é’Ÿ</span><br><span class="line">unsigned char T0RH = 0; //T0 é‡è½½å€¼çš„é«˜å­—èŠ‚</span><br><span class="line">unsigned char T0RL = 0; //T0 é‡è½½å€¼çš„ä½å­—èŠ‚</span><br><span class="line"></span><br><span class="line">sbit LATCH1=P2^2;//å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜</span><br><span class="line">sbit LATCH2=P2^3;//                 ä½é”å­˜</span><br><span class="line">sbit P32 =P3^2;</span><br><span class="line">bit KeyPressFlag;//å®šä¹‰æŒ‰é”®æ ‡å¿—ä½</span><br><span class="line">unsigned char keycode;</span><br><span class="line">unsigned char code DuanMa[]=&#123;0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f&#125;;// æ˜¾ç¤ºæ®µç å€¼0~9</span><br><span class="line"></span><br><span class="line">void DelayMs(unsigned char t); //msçº§å»¶æ—¶</span><br><span class="line">void Display();//æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°</span><br><span class="line">void KeyScan(void);//é”®ç›˜æ‰«æ</span><br><span class="line">unsigned char KeyPro(void);</span><br><span class="line">void Init_Timer0(void);//å®šæ—¶å™¨åˆå§‹åŒ–</span><br><span class="line">void Init_INT0(void);  //å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–å’Œ</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    ä¸»å‡½æ•°</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void main (void)</span><br><span class="line">&#123;</span><br><span class="line">KeyPort =0xf0;</span><br><span class="line">Init_Timer0();</span><br><span class="line">Init_INT0();</span><br><span class="line">while (1) KeyPort = 0xf0;       //ä¸»å¾ªç¯</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line"> mSå»¶æ—¶å‡½æ•°</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void delay(unsigned int xms)// å»¶è¿Ÿå‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">unsigned int i,j;</span><br><span class="line">for(i=xms;i&gt;0;i--)</span><br><span class="line">for(j=112;j&gt;0;j--);</span><br><span class="line">&#125;</span><br><span class="line">/*æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°*/</span><br><span class="line">void Display()</span><br><span class="line">&#123;</span><br><span class="line">      static unsigned char k=0;</span><br><span class="line">   DataPort=0x00;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±</span><br><span class="line">       LATCH1=0;</span><br><span class="line"> LATCH2=1;</span><br><span class="line">       DataPort=DuanMa[keycode/10]; //å–ä½ç  </span><br><span class="line">delay(5);</span><br><span class="line">LATCH1=1;//å…³æ‰ä¸Šé¢æ˜¾ç¤ºçš„åä½æ˜¾ç¤º</span><br><span class="line">       LATCH2=1;     //ä½é”å­˜</span><br><span class="line">       LATCH2=0;//æ‰“å¼€ä¸ªä½æ˜¾ç¤º</span><br><span class="line"></span><br><span class="line">   DataPort=0x00;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±</span><br><span class="line">       DataPort=DuanMa[keycode%10];  //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç </span><br><span class="line">delay(5);</span><br><span class="line">k = k&lt;2 ? k+1 : 0;</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Init_Timer0(void)</span><br><span class="line">&#123;</span><br><span class="line">unsigned long tmp; //ä¸´æ—¶å˜é‡</span><br><span class="line"> TMOD |= 0x01;  //ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½å®šæ—¶å™¨ï¼Œä½¿ç”¨&quot;|&quot;ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“     </span><br><span class="line">    tmp = MAIN_Fosc / 12; //å®šæ—¶å™¨è®¡æ•°é¢‘ç‡</span><br><span class="line">    tmp = (tmp * 50) / 1000; //è®¡ç®—æ‰€éœ€çš„è®¡æ•°å€¼50ms</span><br><span class="line">    tmp = 65536 - tmp; //è®¡ç®—å®šæ—¶å™¨é‡è½½å€¼</span><br><span class="line">    tmp = tmp + 12; //è¡¥å¿ä¸­æ–­å“åº”å»¶æ—¶é€ æˆçš„è¯¯å·®</span><br><span class="line">    T0RH = (unsigned char)(tmp&gt;&gt;8); //å®šæ—¶å™¨é‡è½½å€¼æ‹†åˆ†ä¸ºé«˜ä½å­—èŠ‚</span><br><span class="line">    T0RL = (unsigned char)tmp;</span><br><span class="line">    TMOD &amp;= 0xF0; //æ¸…é›¶ T0 çš„æ§åˆ¶ä½</span><br><span class="line">    TMOD |= 0x01; //é…ç½® T0 ä¸ºæ¨¡å¼ 1</span><br><span class="line">    TH0 = T0RH; //åŠ è½½ T0 é‡è½½å€¼</span><br><span class="line">    TL0 = T0RL;</span><br><span class="line"></span><br><span class="line"> EA=1;            //æ€»ä¸­æ–­æ‰“å¼€</span><br><span class="line"> ET0=1;           //å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€</span><br><span class="line"> TR0=1;           //å®šæ—¶å™¨å¼€å…³æ‰“å¼€</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Timer0_isr(void) interrupt 1 </span><br><span class="line">&#123;</span><br><span class="line"> TH0=(65536-50000)/256;  //é‡æ–°èµ‹å€¼ 50ms</span><br><span class="line"> TL0=(65536-50000)%256;</span><br><span class="line"> Display();       // è°ƒç”¨æ•°ç ç®¡æ‰«æ</span><br><span class="line">&#125;</span><br><span class="line">/*------------------------------------------------</span><br><span class="line">æŒ‰é”®æ‰«æå‡½æ•°ï¼Œè¿”å›æ‰«æé”®å€¼</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void KeyScan(void)  //é”®ç›˜æ‰«æå‡½æ•°ï¼Œä½¿ç”¨è¡Œåˆ—é€çº§æ‰«ææ³•</span><br><span class="line">&#123;</span><br><span class="line">unsigned char t,key;</span><br><span class="line">/**********************ç¬¬ä¸€è¡ŒçŸ©é˜µ*******************/</span><br><span class="line"></span><br><span class="line">KeyPort = 0xfe;//1111 1110 è®©P3.0å£è¾“å‡ºä½</span><br><span class="line">t = KeyPort;</span><br><span class="line">t=t&amp;0xf0;// 1111 0000 å±è”½åå››ä½</span><br><span class="line"></span><br><span class="line">if(t != 0xf0) // è¯´æ˜æŒ‰é”®æœ‰è¢«æŒ‰ä½</span><br><span class="line">&#123;</span><br><span class="line">delay(10);</span><br><span class="line">t = KeyPort;</span><br><span class="line">t = t&amp;0xf0;</span><br><span class="line">if( t != 0xf0)</span><br><span class="line">&#123;</span><br><span class="line">t = KeyPort;</span><br><span class="line">switch(t)</span><br><span class="line">&#123;</span><br><span class="line">case 0xee:</span><br><span class="line">key = 1;   // æ­¤æ—¶ä¸º 1110 1110  S1æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0xde:</span><br><span class="line">key = 2;   // æ­¤æ—¶ä¸º 1101 1110  S2æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0xbe:</span><br><span class="line">key = 3;   // æ­¤æ—¶ä¸º 1011 1110  S3æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0x7e:</span><br><span class="line">key = 4;   // æ­¤æ—¶ä¸º 0111 1110  S4æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">// åˆ¤æ–­æŒ‰é”®æ˜¯å¦è¢«æ¾å¼€</span><br><span class="line">while( t != 0xf0)&#123;</span><br><span class="line"> t = KeyPort;</span><br><span class="line">t = t&amp;0xf0;</span><br><span class="line">&#125;</span><br><span class="line">keycode = key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**********************ç¬¬äºŒè¡ŒçŸ©é˜µ*******************/</span><br><span class="line"></span><br><span class="line">KeyPort = 0xfd;//1111 1101 è®©P3.1å£è¾“å‡ºä½</span><br><span class="line">t = KeyPort;</span><br><span class="line">t=t&amp;0xf0;// 1111 0000 å±è”½åå››ä½</span><br><span class="line">if(t != 0xf0) // è¯´æ˜æŒ‰é”®æœ‰è¢«æŒ‰ä½</span><br><span class="line">&#123;</span><br><span class="line">delay(10);</span><br><span class="line">t = KeyPort;</span><br><span class="line">t = t&amp;0xf0;</span><br><span class="line">if( t != 0xf0)</span><br><span class="line">&#123;</span><br><span class="line">t = KeyPort;</span><br><span class="line">switch(t)</span><br><span class="line">&#123;</span><br><span class="line">case 0xed:</span><br><span class="line">key = 5;   // æ­¤æ—¶ä¸º 1110 1101  S5æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0xdd:</span><br><span class="line">key = 6;   // æ­¤æ—¶ä¸º 1101 1101  S6æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0xbd:</span><br><span class="line">key = 7;   // æ­¤æ—¶ä¸º 1011 1101  S7æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0x7d:</span><br><span class="line">key = 8;   // æ­¤æ—¶ä¸º 0111 1101  S8æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">// åˆ¤æ–­æŒ‰é”®æ˜¯å¦è¢«æ¾å¼€</span><br><span class="line">while( t != 0xf0)&#123;</span><br><span class="line"> t = KeyPort;</span><br><span class="line">t = t&amp;0xf0;</span><br><span class="line">&#125;</span><br><span class="line">keycode = key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**********************ç¬¬ä¸‰è¡ŒçŸ©é˜µ*******************/</span><br><span class="line"></span><br><span class="line">KeyPort = 0xfb;//1111 1011 è®©P3.2å£è¾“å‡ºä½</span><br><span class="line">t = KeyPort;</span><br><span class="line">t=t&amp;0xf0;// 1111 0000 å±è”½åå››ä½</span><br><span class="line"></span><br><span class="line">if(t != 0xf0) // è¯´æ˜æŒ‰é”®æœ‰è¢«æŒ‰ä½</span><br><span class="line">&#123;</span><br><span class="line">delay(10);</span><br><span class="line">t = KeyPort;</span><br><span class="line">t = t&amp;0xf0;</span><br><span class="line">if( t != 0xf0)</span><br><span class="line">&#123;</span><br><span class="line">t = KeyPort;</span><br><span class="line">switch(t)</span><br><span class="line">&#123;</span><br><span class="line">case 0xeb:</span><br><span class="line">key = 9;   // æ­¤æ—¶ä¸º 1110 1011  S9æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0xdb:</span><br><span class="line">key = 10;   // æ­¤æ—¶ä¸º 1101 1011  S10æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0xbb:</span><br><span class="line">key = 11;   // æ­¤æ—¶ä¸º 1011 1011 S11æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0x7b:</span><br><span class="line">key = 12;   // æ­¤æ—¶ä¸º 0111 1011  S12æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">// åˆ¤æ–­æŒ‰é”®æ˜¯å¦è¢«æ¾å¼€</span><br><span class="line">while( t != 0xf0)&#123;</span><br><span class="line"> t = KeyPort;</span><br><span class="line">t = t&amp;0xf0;</span><br><span class="line">&#125;</span><br><span class="line">keycode = key;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**********************ç¬¬å››è¡ŒçŸ©é˜µ*******************/</span><br><span class="line"></span><br><span class="line">KeyPort = 0xf7;//1111 0111 è®©P1.3å£è¾“å‡ºä½</span><br><span class="line">t = KeyPort;</span><br><span class="line">t = t&amp;0xf0;// 1111 0000 å±è”½åå››ä½</span><br><span class="line">if(t != 0xf0) // è¯´æ˜æŒ‰é”®æœ‰è¢«æŒ‰ä½</span><br><span class="line">&#123;</span><br><span class="line">delay(10);</span><br><span class="line">t = KeyPort;</span><br><span class="line">t = t&amp;0xf0;</span><br><span class="line">if( t != 0xf0)</span><br><span class="line">&#123;</span><br><span class="line">t = KeyPort;</span><br><span class="line">switch(t)</span><br><span class="line">&#123;</span><br><span class="line">case 0xe7:</span><br><span class="line">key = 13;   // æ­¤æ—¶ä¸º 1110 0111  S13æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0xd7:</span><br><span class="line">key = 14;   // æ­¤æ—¶ä¸º 1101 0111  S14æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0xb7:</span><br><span class="line">key = 15;   // æ­¤æ—¶ä¸º 1011 0111  S15æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">case 0x77:</span><br><span class="line">key = 16;   // æ­¤æ—¶ä¸º 0111 0111  S16æŒ‰é”®è¢«æŒ‰ä¸‹</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">// åˆ¤æ–­æŒ‰é”®æ˜¯å¦è¢«æ¾å¼€</span><br><span class="line">while( t != 0xf0)&#123;</span><br><span class="line"> t = KeyPort;</span><br><span class="line">t = t&amp;0xf0;</span><br><span class="line">&#125;</span><br><span class="line">keycode = key;//æŠŠæŒ‰é”®çš„å€¼å‘ç»™æ•°ç»„ï¼Œè®©å…¶å¯¹åº”çš„æ•°å­—æ‰“å°å†æ•°ç ç®¡ä¸Š</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">           å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void Init_INT0(void)</span><br><span class="line">&#123;</span><br><span class="line">  EA=1;          //å…¨å±€ä¸­æ–­å¼€</span><br><span class="line">  EX0=1;         //å¤–éƒ¨ä¸­æ–­0å¼€</span><br><span class="line">  IT0=1;         //è¾¹æ²¿è§¦å‘</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*------------------------------------------------</span><br><span class="line">                 å¤–éƒ¨ä¸­æ–­0ç¨‹åº</span><br><span class="line">------------------------------------------------*/</span><br><span class="line">void int0() interrupt 0 //åœ¨ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­è¿›è¡Œé”®ç›˜æ‰«æ</span><br><span class="line">&#123;</span><br><span class="line"> KeyScan();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;*â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“<br>  åç§°ï¼šçŸ©é˜µé”®ç›˜ä¾æ¬¡è¾“å…¥æ§åˆ¶ ä½¿ç”¨è¡Œåˆ—é€çº§æ‰«æ ä¸­æ–­æ–¹å¼</p><p>  å†…å®¹ï¼šå¦‚è®¡ç®—å™¨è¾“å…¥æ•°æ®å½¢å¼ç›¸åŒ ä»å³è‡³å·¦ ä½¿ç”¨è¡Œåˆ—æ‰«ææ–¹æ³•<br>        ä¸­æ–­æ–¹å¼å¯ä»¥æœ‰æ•ˆæä¾›cpuå·¥ä½œæ•ˆç‡ï¼Œåœ¨æœ‰æŒ‰é”®åŠ¨ä½œæ—¶æ‰æ‰«æï¼Œå¹³æ—¶ä¸è¿›è¡Œæ‰«æå·¥ä½œ<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*&#x2F;<br>#include&lt;reg52.h&gt; &#x2F;&#x2F;åŒ…å«å¤´æ–‡ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤´æ–‡ä»¶åŒ…å«ç‰¹æ®ŠåŠŸèƒ½å¯„å­˜å™¨çš„å®šä¹‰<br>#include&lt;intrins.h&gt; </p><p>#define DataPort P0 &#x2F;&#x2F;å®šä¹‰æ•°æ®ç«¯å£ ç¨‹åºä¸­é‡åˆ°DataPort åˆ™ç”¨P0 æ›¿æ¢<br>#define KeyPort  P1<br>#define MAIN_Fosc12000000uL&#x2F;&#x2F;å®šä¹‰ä¸»æ—¶é’Ÿ<br>unsigned char T0RH &#x3D; 0; &#x2F;&#x2F;T0 é‡è½½å€¼çš„é«˜å­—èŠ‚<br>unsigned char T0RL &#x3D; 0; &#x2F;&#x2F;T0 é‡è½½å€¼çš„ä½å­—èŠ‚</p><p>sbit LATCH1&#x3D;P2^2;&#x2F;&#x2F;å®šä¹‰é”å­˜ä½¿èƒ½ç«¯å£ æ®µé”å­˜<br>sbit LATCH2&#x3D;P2^3;&#x2F;&#x2F;                 ä½é”å­˜<br>sbit P32 &#x3D;P3^2;<br>bit KeyPressFlag;&#x2F;&#x2F;å®šä¹‰æŒ‰é”®æ ‡å¿—ä½<br>unsigned char keycode;<br>unsigned char code DuanMa[]&#x3D;{0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};&#x2F;&#x2F; æ˜¾ç¤ºæ®µç å€¼0~9</p><p>void DelayMs(unsigned char t); &#x2F;&#x2F;msçº§å»¶æ—¶<br>void Display();&#x2F;&#x2F;æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°<br>void KeyScan(void);&#x2F;&#x2F;é”®ç›˜æ‰«æ<br>unsigned char KeyPro(void);<br>void Init_Timer0(void);&#x2F;&#x2F;å®šæ—¶å™¨åˆå§‹åŒ–<br>void Init_INT0(void);  &#x2F;&#x2F;å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–å’Œ<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    ä¸»å‡½æ•°<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void main (void)<br>{<br>    KeyPort &#x3D;0xf0;<br>    Init_Timer0();<br>    Init_INT0();<br>while (1) KeyPort &#x3D; 0xf0;       &#x2F;&#x2F;ä¸»å¾ªç¯<br>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> mSå»¶æ—¶å‡½æ•°<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void delay(unsigned int xms)&#x2F;&#x2F; å»¶è¿Ÿå‡½æ•°<br>{<br>    unsigned int i,j;<br>    for(i&#x3D;xms;i&gt;0;iâ€“)<br>        for(j&#x3D;112;j&gt;0;jâ€“);<br>}<br>&#x2F;<em>æ•°ç ç®¡æ˜¾ç¤ºå‡½æ•°</em>&#x2F;<br>void Display()<br>{<br>      static unsigned char k&#x3D;0;<br>       DataPort&#x3D;0x00;   &#x2F;&#x2F;æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±<br>       LATCH1&#x3D;0;<br>             LATCH2&#x3D;1;<br>       DataPort&#x3D;DuanMa[keycode&#x2F;10]; &#x2F;&#x2F;å–ä½ç <br>        delay(5);<br>        LATCH1&#x3D;1;&#x2F;&#x2F;å…³æ‰ä¸Šé¢æ˜¾ç¤ºçš„åä½æ˜¾ç¤º<br>       LATCH2&#x3D;1;     &#x2F;&#x2F;ä½é”å­˜<br>       LATCH2&#x3D;0;&#x2F;&#x2F;æ‰“å¼€ä¸ªä½æ˜¾ç¤º</p><pre><code>   DataPort=0x00;   //æ¸…ç©ºæ•°æ®ï¼Œé˜²æ­¢æœ‰äº¤æ›¿é‡å½±   DataPort=DuanMa[keycode%10];  //å–æ˜¾ç¤ºæ•°æ®ï¼Œæ®µç         delay(5);    k = k&lt;2 ? k+1 : 0;</code></pre><p>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                    å®šæ—¶å™¨åˆå§‹åŒ–å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Init_Timer0(void)<br>{<br>    unsigned long tmp; &#x2F;&#x2F;ä¸´æ—¶å˜é‡<br> TMOD |&#x3D; 0x01;  &#x2F;&#x2F;ä½¿ç”¨æ¨¡å¼1ï¼Œ16ä½å®šæ—¶å™¨ï¼Œä½¿ç”¨â€|â€ç¬¦å·å¯ä»¥åœ¨ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨æ—¶ä¸å—å½±å“<br>    tmp &#x3D; MAIN_Fosc &#x2F; 12; &#x2F;&#x2F;å®šæ—¶å™¨è®¡æ•°é¢‘ç‡<br>    tmp &#x3D; (tmp * 50) &#x2F; 1000; &#x2F;&#x2F;è®¡ç®—æ‰€éœ€çš„è®¡æ•°å€¼50ms<br>    tmp &#x3D; 65536 - tmp; &#x2F;&#x2F;è®¡ç®—å®šæ—¶å™¨é‡è½½å€¼<br>    tmp &#x3D; tmp + 12; &#x2F;&#x2F;è¡¥å¿ä¸­æ–­å“åº”å»¶æ—¶é€ æˆçš„è¯¯å·®<br>    T0RH &#x3D; (unsigned char)(tmp&gt;&gt;8); &#x2F;&#x2F;å®šæ—¶å™¨é‡è½½å€¼æ‹†åˆ†ä¸ºé«˜ä½å­—èŠ‚<br>    T0RL &#x3D; (unsigned char)tmp;<br>    TMOD &amp;&#x3D; 0xF0; &#x2F;&#x2F;æ¸…é›¶ T0 çš„æ§åˆ¶ä½<br>    TMOD |&#x3D; 0x01; &#x2F;&#x2F;é…ç½® T0 ä¸ºæ¨¡å¼ 1<br>    TH0 &#x3D; T0RH; &#x2F;&#x2F;åŠ è½½ T0 é‡è½½å€¼<br>    TL0 &#x3D; T0RL;</p><p> EA&#x3D;1;            &#x2F;&#x2F;æ€»ä¸­æ–­æ‰“å¼€<br> ET0&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨ä¸­æ–­æ‰“å¼€<br> TR0&#x3D;1;           &#x2F;&#x2F;å®šæ—¶å™¨å¼€å…³æ‰“å¼€<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                 å®šæ—¶å™¨ä¸­æ–­å­ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Timer0_isr(void) interrupt 1<br>{<br> TH0&#x3D;(65536-50000)&#x2F;256;  &#x2F;&#x2F;é‡æ–°èµ‹å€¼ 50ms<br> TL0&#x3D;(65536-50000)%256;<br> Display();       &#x2F;&#x2F; è°ƒç”¨æ•°ç ç®¡æ‰«æ<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>æŒ‰é”®æ‰«æå‡½æ•°ï¼Œè¿”å›æ‰«æé”®å€¼<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void KeyScan(void)  &#x2F;&#x2F;é”®ç›˜æ‰«æå‡½æ•°ï¼Œä½¿ç”¨è¡Œåˆ—é€çº§æ‰«ææ³•<br>{<br>        unsigned char t,key;<br>&#x2F;***<em><strong><strong><strong><strong><strong><strong><strong><strong><strong>ç¬¬ä¸€è¡ŒçŸ©é˜µ</strong></strong></strong></strong></strong></strong></strong></strong></strong></em>&#x2F;</p><pre><code>KeyPort = 0xfe;//1111 1110 è®©P3.0å£è¾“å‡ºä½t = KeyPort;t=t&amp;0xf0;// 1111 0000 å±è”½åå››ä½if(t != 0xf0) // è¯´æ˜æŒ‰é”®æœ‰è¢«æŒ‰ä½&#123;    delay(10);    t = KeyPort;    t = t&amp;0xf0;    if( t != 0xf0)    &#123;        t = KeyPort;        switch(t)        &#123;            case 0xee:                key = 1;   // æ­¤æ—¶ä¸º 1110 1110  S1æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0xde:                key = 2;   // æ­¤æ—¶ä¸º 1101 1110  S2æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0xbe:                key = 3;   // æ­¤æ—¶ä¸º 1011 1110  S3æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0x7e:                key = 4;   // æ­¤æ—¶ä¸º 0111 1110  S4æŒ‰é”®è¢«æŒ‰ä¸‹                break;        &#125;        // åˆ¤æ–­æŒ‰é”®æ˜¯å¦è¢«æ¾å¼€        while( t != 0xf0)&#123;         t = KeyPort;            t = t&amp;0xf0;        &#125;        keycode = key;    &#125;&#125;</code></pre><p>&#x2F;***<em><strong><strong><strong><strong><strong><strong><strong><strong><strong>ç¬¬äºŒè¡ŒçŸ©é˜µ</strong></strong></strong></strong></strong></strong></strong></strong></strong></em>&#x2F;</p><pre><code>KeyPort = 0xfd;//1111 1101 è®©P3.1å£è¾“å‡ºä½t = KeyPort;t=t&amp;0xf0;// 1111 0000 å±è”½åå››ä½if(t != 0xf0) // è¯´æ˜æŒ‰é”®æœ‰è¢«æŒ‰ä½&#123;    delay(10);    t = KeyPort;    t = t&amp;0xf0;    if( t != 0xf0)    &#123;        t = KeyPort;        switch(t)        &#123;            case 0xed:                key = 5;   // æ­¤æ—¶ä¸º 1110 1101  S5æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0xdd:                key = 6;   // æ­¤æ—¶ä¸º 1101 1101  S6æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0xbd:                key = 7;   // æ­¤æ—¶ä¸º 1011 1101  S7æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0x7d:                key = 8;   // æ­¤æ—¶ä¸º 0111 1101  S8æŒ‰é”®è¢«æŒ‰ä¸‹                break;            &#125;        // åˆ¤æ–­æŒ‰é”®æ˜¯å¦è¢«æ¾å¼€        while( t != 0xf0)&#123;         t = KeyPort;            t = t&amp;0xf0;        &#125;                    keycode = key;    &#125;&#125;</code></pre><p>&#x2F;***<em><strong><strong><strong><strong><strong><strong><strong><strong><strong>ç¬¬ä¸‰è¡ŒçŸ©é˜µ</strong></strong></strong></strong></strong></strong></strong></strong></strong></em>&#x2F;</p><pre><code>KeyPort = 0xfb;//1111 1011 è®©P3.2å£è¾“å‡ºä½t = KeyPort;t=t&amp;0xf0;// 1111 0000 å±è”½åå››ä½if(t != 0xf0) // è¯´æ˜æŒ‰é”®æœ‰è¢«æŒ‰ä½&#123;    delay(10);    t = KeyPort;    t = t&amp;0xf0;    if( t != 0xf0)    &#123;        t = KeyPort;        switch(t)        &#123;            case 0xeb:                key = 9;   // æ­¤æ—¶ä¸º 1110 1011  S9æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0xdb:                key = 10;   // æ­¤æ—¶ä¸º 1101 1011  S10æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0xbb:                key = 11;   // æ­¤æ—¶ä¸º 1011 1011 S11æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0x7b:                key = 12;   // æ­¤æ—¶ä¸º 0111 1011  S12æŒ‰é”®è¢«æŒ‰ä¸‹                break;        &#125;        // åˆ¤æ–­æŒ‰é”®æ˜¯å¦è¢«æ¾å¼€        while( t != 0xf0)&#123;         t = KeyPort;            t = t&amp;0xf0;        &#125;        keycode = key;    &#125;&#125;</code></pre><p>&#x2F;***<em><strong><strong><strong><strong><strong><strong><strong><strong><strong>ç¬¬å››è¡ŒçŸ©é˜µ</strong></strong></strong></strong></strong></strong></strong></strong></strong></em>&#x2F;</p><pre><code>KeyPort = 0xf7;//1111 0111 è®©P1.3å£è¾“å‡ºä½t = KeyPort;t = t&amp;0xf0;// 1111 0000 å±è”½åå››ä½if(t != 0xf0) // è¯´æ˜æŒ‰é”®æœ‰è¢«æŒ‰ä½&#123;    delay(10);    t = KeyPort;    t = t&amp;0xf0;    if( t != 0xf0)    &#123;        t = KeyPort;        switch(t)        &#123;            case 0xe7:                key = 13;   // æ­¤æ—¶ä¸º 1110 0111  S13æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0xd7:                key = 14;   // æ­¤æ—¶ä¸º 1101 0111  S14æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0xb7:                key = 15;   // æ­¤æ—¶ä¸º 1011 0111  S15æŒ‰é”®è¢«æŒ‰ä¸‹                break;            case 0x77:                key = 16;   // æ­¤æ—¶ä¸º 0111 0111  S16æŒ‰é”®è¢«æŒ‰ä¸‹                break;        &#125;        // åˆ¤æ–­æŒ‰é”®æ˜¯å¦è¢«æ¾å¼€        while( t != 0xf0)&#123;         t = KeyPort;            t = t&amp;0xf0;        &#125;        keycode = key;//æŠŠæŒ‰é”®çš„å€¼å‘ç»™æ•°ç»„ï¼Œè®©å…¶å¯¹åº”çš„æ•°å­—æ‰“å°å†æ•°ç ç®¡ä¸Š    &#125;&#125;</code></pre><p>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>           å¤–éƒ¨ä¸­æ–­0åˆå§‹åŒ–<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void Init_INT0(void)<br>{<br>  EA&#x3D;1;          &#x2F;&#x2F;å…¨å±€ä¸­æ–­å¼€<br>  EX0&#x3D;1;         &#x2F;&#x2F;å¤–éƒ¨ä¸­æ–­0å¼€<br>  IT0&#x3D;1;         &#x2F;&#x2F;è¾¹æ²¿è§¦å‘<br>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>                 å¤–éƒ¨ä¸­æ–­0ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</em>&#x2F;<br>void int0() interrupt 0 &#x2F;&#x2F;åœ¨ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­è¿›è¡Œé”®ç›˜æ‰«æ<br>{<br>     KeyScan();<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1xpMedaf7dpC9EuCFK7I2Tw </span><br><span class="line">æå–ç ï¼šjhb2</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1xpMedaf7dpC9EuCFK7I2Tw  æå–ç ï¼šjhb2</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F88LED%E7%82%B9%E9%98%B5%E5%B1%8F%E4%BB%BF%E7%94%B5%E6%A2%AF%E6%95%B0%E5%AD%97%E6%BB%9A%E5%8A%A8%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F88LED%E7%82%B9%E9%98%B5%E5%B1%8F%E4%BB%BF%E7%94%B5%E6%A2%AF%E6%95%B0%E5%AD%97%E6%BB%9A%E5%8A%A8%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/77cded2993784e4289fb0964ce079420.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="8X8ç‚¹é˜µå–æ¨¡å·¥å…·å’Œå–æ¨¡æ–¹å¼ï¼ˆéšæºç æ‰“åŒ…ï¼‰"><a href="#8X8ç‚¹é˜µå–æ¨¡å·¥å…·å’Œå–æ¨¡æ–¹å¼ï¼ˆéšæºç æ‰“åŒ…ï¼‰" class="headerlink" title="8X8ç‚¹é˜µå–æ¨¡å·¥å…·å’Œå–æ¨¡æ–¹å¼ï¼ˆéšæºç æ‰“åŒ…ï¼‰"></a>8X8ç‚¹é˜µå–æ¨¡å·¥å…·å’Œå–æ¨¡æ–¹å¼ï¼ˆéšæºç æ‰“åŒ…ï¼‰</h4><p><img src="https://img-blog.csdnimg.cn/29da13fcf5724ab59c2d28f48b105bdd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">//åç§°ï¼š8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º</span><br><span class="line">//è¯´æ˜ï¼šæœ¬ä¾‹æ¨¡æ‹Ÿäº†ç”µæ¢¯æ˜¾ç¤ºå±ä¸Šä¸‹æ»šåŠ¨æ˜¾ç¤ºæ¥¼å±‚çš„æ•ˆæœï¼Œå½“ç›®æ ‡æ¥¼å±‚å¤§äº</span><br><span class="line">//å½“å‰æ¥¼å±‚æ—¶ï¼Œå°†å‘ä¸Šæ»šåŠ¨æ˜¾ç¤ºï¼Œåä¹‹åˆ™å‘ä¸‹æ»šåŠ¨æ˜¾ç¤ºã€‚</span><br><span class="line">#include &lt;reg51.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line">uchar code Table[]=</span><br><span class="line">&#123;</span><br><span class="line">0x3C,0x42,0x42,0x42,0x42,0x42,0x42,0x3C,//0</span><br><span class="line">0x18,0x38,0x78,0x18,0x18,0x18,0x18,0x18,//1</span><br><span class="line">0x00,0x7E,0x02,0x02,0x7E,0x40,0x40,0x7E,//2</span><br><span class="line">0x00,0x7E,0x02,0x02,0x7E,0x02,0x02,0x7E,//3</span><br><span class="line">0x00,0x48,0x48,0x48,0x7E,0x08,0x08,0x08,//4</span><br><span class="line">0x00,0x7E,0x40,0x40,0x7E,0x02,0x02,0x7E,//5</span><br><span class="line">0x00,0x7C,0x40,0x40,0x7C,0x44,0x44,0x7C,//6</span><br><span class="line">0x00,0x7C,0x04,0x04,0x04,0x04,0x04,0x04,//7</span><br><span class="line">0x00,0x7C,0x44,0x44,0x7C,0x44,0x44,0x7C,//8</span><br><span class="line">0x00,0x7E,0x42,0x42,0x7E,0x02,0x02,0x7E,//9</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">uint r= 0;</span><br><span class="line">char offset = 0;</span><br><span class="line">uchar Current_Level = 1,Dest_Level=1,x=0,t =0;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line"> P3 = 0x80;</span><br><span class="line">Current_Level = 1;//ä»1å¼€å§‹æ˜¾ç¤º</span><br><span class="line">TMOD  = 0x01;//T0å·¥ä½œæ–¹å¼</span><br><span class="line">TH0 = -4000/256;//4ms//æ¯ä¸ªæ•°å­—æœ‰8å­—èŠ‚</span><br><span class="line">TL0 = -4000%256;</span><br><span class="line">TR0=1;</span><br><span class="line">IE = 0x82;</span><br><span class="line">EA =1;</span><br><span class="line">while(1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Led_Dispaly() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">uchar i;</span><br><span class="line">//åœ¨åœæ­¢æ»šåŠ¨æ—¶ï¼Œå¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œåˆ™åˆ¤æ–­ç›®æ ‡æ¥¼å±‚</span><br><span class="line">if (P1 != 0xff &amp;&amp; Current_Level == Dest_Level )</span><br><span class="line">&#123;</span><br><span class="line">if (P1 ==0xfe)Dest_Level =5;</span><br><span class="line">if (P1 ==0xfd)Dest_Level =4;</span><br><span class="line">if (P1 ==0xfb)Dest_Level =3;</span><br><span class="line">if (P1 ==0xf7)Dest_Level =2;</span><br><span class="line">if (P1 ==0xef)Dest_Level =1;</span><br><span class="line">&#125;</span><br><span class="line">TH0 = -4000/256;//4ms</span><br><span class="line">TL0 = -4000%256;</span><br><span class="line">P3 =_crol_(P3,1);</span><br><span class="line">i = Current_Level *8 + r + offset;</span><br><span class="line">P0 = ~Table[i];</span><br><span class="line"></span><br><span class="line">//ä¸Šå‡æ˜¾ç¤º</span><br><span class="line">if (Current_Level &lt; Dest_Level )</span><br><span class="line">&#123;</span><br><span class="line">if ( ++r ==8)</span><br><span class="line">&#123;//æ¯ä¸ªæ•°å­—æœ‰8å­—èŠ‚</span><br><span class="line">r =0;</span><br><span class="line">if( ++x ==4)</span><br><span class="line">&#123;//æ¯å®Œæˆxæ¬¡åˆ·æ–°ååå</span><br><span class="line">x = 0;</span><br><span class="line">if(++offset ==8)</span><br><span class="line">&#123;</span><br><span class="line">offset = 0;</span><br><span class="line">Current_Level++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//ä¸‹é™æ˜¾ç¤º</span><br><span class="line">else if(Current_Level &gt; Dest_Level )</span><br><span class="line">&#123;</span><br><span class="line">if ( ++r ==8)</span><br><span class="line">&#123;//æ¯ä¸ªæ•°å­—æœ‰8å­—èŠ‚</span><br><span class="line">r =0;</span><br><span class="line">if( ++x ==4)</span><br><span class="line">&#123;//æ¯å®Œæˆxæ¬¡åˆ·æ–°åå‰å</span><br><span class="line">x = 0;</span><br><span class="line">if(--offset == -8)</span><br><span class="line">&#123;</span><br><span class="line">offset = 0;</span><br><span class="line">Current_Level--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//åœæ­¢æ»šåŠ¨ï¼Œä¿æŒç¨³å®šçš„åˆ·æ–°æ˜¾ç¤º</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">if ( ++r ==8) r =0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;&#x2F;åç§°ï¼š8Ã—8LEDç‚¹é˜µå±ä»¿ç”µæ¢¯æ•°å­—æ»šåŠ¨æ˜¾ç¤º<br>&#x2F;&#x2F;è¯´æ˜ï¼šæœ¬ä¾‹æ¨¡æ‹Ÿäº†ç”µæ¢¯æ˜¾ç¤ºå±ä¸Šä¸‹æ»šåŠ¨æ˜¾ç¤ºæ¥¼å±‚çš„æ•ˆæœï¼Œå½“ç›®æ ‡æ¥¼å±‚å¤§äº<br>&#x2F;&#x2F;å½“å‰æ¥¼å±‚æ—¶ï¼Œå°†å‘ä¸Šæ»šåŠ¨æ˜¾ç¤ºï¼Œåä¹‹åˆ™å‘ä¸‹æ»šåŠ¨æ˜¾ç¤ºã€‚<br>#include &lt;reg51.h&gt;<br>#include &lt;intrins.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int<br>uchar code Table[]&#x3D;<br>{<br>    0x3C,0x42,0x42,0x42,0x42,0x42,0x42,0x3C,&#x2F;&#x2F;0<br>    0x18,0x38,0x78,0x18,0x18,0x18,0x18,0x18,&#x2F;&#x2F;1<br>    0x00,0x7E,0x02,0x02,0x7E,0x40,0x40,0x7E,&#x2F;&#x2F;2<br>    0x00,0x7E,0x02,0x02,0x7E,0x02,0x02,0x7E,&#x2F;&#x2F;3<br>    0x00,0x48,0x48,0x48,0x7E,0x08,0x08,0x08,&#x2F;&#x2F;4<br>    0x00,0x7E,0x40,0x40,0x7E,0x02,0x02,0x7E,&#x2F;&#x2F;5<br>    0x00,0x7C,0x40,0x40,0x7C,0x44,0x44,0x7C,&#x2F;&#x2F;6<br>    0x00,0x7C,0x04,0x04,0x04,0x04,0x04,0x04,&#x2F;&#x2F;7<br>    0x00,0x7C,0x44,0x44,0x7C,0x44,0x44,0x7C,&#x2F;&#x2F;8<br>    0x00,0x7E,0x42,0x42,0x7E,0x02,0x02,0x7E,&#x2F;&#x2F;9</p><p>};<br>uint r&#x3D; 0;<br>char offset &#x3D; 0;<br>uchar Current_Level &#x3D; 1,Dest_Level&#x3D;1,x&#x3D;0,t &#x3D;0;</p><p>void main()<br>{<br>     P3 &#x3D; 0x80;<br>    Current_Level &#x3D; 1;&#x2F;&#x2F;ä»1å¼€å§‹æ˜¾ç¤º<br>    TMOD  &#x3D; 0x01;&#x2F;&#x2F;T0å·¥ä½œæ–¹å¼<br>    TH0 &#x3D; -4000&#x2F;256;&#x2F;&#x2F;4ms&#x2F;&#x2F;æ¯ä¸ªæ•°å­—æœ‰8å­—èŠ‚<br>    TL0 &#x3D; -4000%256;<br>    TR0&#x3D;1;<br>    IE &#x3D; 0x82;<br>    EA &#x3D;1;<br>    while(1);<br>}</p><p>void Led_Dispaly() interrupt 1<br>{<br>    uchar i;<br>    &#x2F;&#x2F;åœ¨åœæ­¢æ»šåŠ¨æ—¶ï¼Œå¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œåˆ™åˆ¤æ–­ç›®æ ‡æ¥¼å±‚<br>    if (P1 !&#x3D; 0xff &amp;&amp; Current_Level &#x3D;&#x3D; Dest_Level )<br>    {<br>    if (P1 &#x3D;&#x3D;0xfe)Dest_Level &#x3D;5;<br>    if (P1 &#x3D;&#x3D;0xfd)Dest_Level &#x3D;4;<br>    if (P1 &#x3D;&#x3D;0xfb)Dest_Level &#x3D;3;<br>    if (P1 &#x3D;&#x3D;0xf7)Dest_Level &#x3D;2;<br>    if (P1 &#x3D;&#x3D;0xef)Dest_Level &#x3D;1;<br>    }<br>    TH0 &#x3D; -4000&#x2F;256;&#x2F;&#x2F;4ms<br>    TL0 &#x3D; -4000%256;<br>    P3 &#x3D;<em>crol</em>(P3,1);<br>    i &#x3D; Current_Level *8 + r + offset;<br>    P0 &#x3D; ~Table[i];</p><pre><code>//ä¸Šå‡æ˜¾ç¤ºif (Current_Level &lt; Dest_Level )&#123;    if ( ++r ==8)    &#123;//æ¯ä¸ªæ•°å­—æœ‰8å­—èŠ‚            r =0;        if( ++x ==4)        &#123;//æ¯å®Œæˆxæ¬¡åˆ·æ–°ååå            x = 0;            if(++offset ==8)            &#123;                offset = 0;                Current_Level++;            &#125;                    &#125;    &#125;    &#125;//ä¸‹é™æ˜¾ç¤ºelse if(Current_Level &gt; Dest_Level )&#123;    if ( ++r ==8)    &#123;//æ¯ä¸ªæ•°å­—æœ‰8å­—èŠ‚        r =0;        if( ++x ==4)        &#123;//æ¯å®Œæˆxæ¬¡åˆ·æ–°åå‰å            x = 0;            if(--offset == -8)            &#123;                offset = 0;                Current_Level--;            &#125;                    &#125;    &#125;    &#125;//åœæ­¢æ»šåŠ¨ï¼Œä¿æŒç¨³å®šçš„åˆ·æ–°æ˜¾ç¤ºelse&#123;    if ( ++r ==8) r =0;&#125;</code></pre><p>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1nbibyaWHQg8onv-0gfuBeA </span><br><span class="line">æå–ç ï¼šjn53</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1nbibyaWHQg8onv-0gfuBeA  æå–ç ï¼šjn53</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘LCD1602æ•´å±å†…å®¹ä¿¡æ¯ç§»åŠ¨</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FLCD1602%E6%95%B4%E5%B1%8F%E5%86%85%E5%AE%B9%E4%BF%A1%E6%81%AF%E7%A7%BB%E5%8A%A8/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FLCD1602%E6%95%B4%E5%B1%8F%E5%86%85%E5%AE%B9%E4%BF%A1%E6%81%AF%E7%A7%BB%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘LCD1602æ•´å±å†…å®¹ä¿¡æ¯ç§»åŠ¨"><a href="#ã€Proteusä»¿çœŸã€‘LCD1602æ•´å±å†…å®¹ä¿¡æ¯ç§»åŠ¨" class="headerlink" title="ã€Proteusä»¿çœŸã€‘LCD1602æ•´å±å†…å®¹ä¿¡æ¯ç§»åŠ¨"></a>ã€Proteusä»¿çœŸã€‘LCD1602æ•´å±å†…å®¹ä¿¡æ¯ç§»åŠ¨</h1><h3 id="ã€Proteusä»¿çœŸã€‘LCD1602æ•´å±å†…å®¹ä¿¡æ¯ç§»åŠ¨-1"><a href="#ã€Proteusä»¿çœŸã€‘LCD1602æ•´å±å†…å®¹ä¿¡æ¯ç§»åŠ¨-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘LCD1602æ•´å±å†…å®¹ä¿¡æ¯ç§»åŠ¨"></a>ã€Proteusä»¿çœŸã€‘LCD1602æ•´å±å†…å®¹ä¿¡æ¯ç§»åŠ¨</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º(æœ¬å®ä¾‹ä»…åšproteusä»¿çœŸå‚è€ƒ)</li></ul><p><img src="https://img-blog.csdnimg.cn/45ca049709f2448388bef57de3b50e25.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="proteusä»¿çœŸç›¸å…³è®¾ç½®"><a href="#proteusä»¿çœŸç›¸å…³è®¾ç½®" class="headerlink" title="proteusä»¿çœŸç›¸å…³è®¾ç½®"></a>proteusä»¿çœŸç›¸å…³è®¾ç½®</h4><ul><li>Data Memory map:è®¾ç½®èŒƒå›´ï¼š0000-FFFF</li></ul><p><code>Data Memory map</code></p><p><code>0000-FFFF</code></p><p><img src="https://img-blog.csdnimg.cn/f8a570316c1545969204b259e404c363.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="keilç¼–è¯‘é€‰é¡¹è®¾ç½®"><a href="#keilç¼–è¯‘é€‰é¡¹è®¾ç½®" class="headerlink" title="keilç¼–è¯‘é€‰é¡¹è®¾ç½®"></a>keilç¼–è¯‘é€‰é¡¹è®¾ç½®</h4><p><code>keil</code></p><p><img src="https://img-blog.csdnimg.cn/fc8ac0a12e3249c69100ea5c49e96c69.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä¸»ç¨‹åºç¤ºä¾‹ä»£ç "><a href="#ä¸»ç¨‹åºç¤ºä¾‹ä»£ç " class="headerlink" title="ä¸»ç¨‹åºç¤ºä¾‹ä»£ç "></a>ä¸»ç¨‹åºç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;STC89C5xRC.H&gt;</span><br><span class="line">#include &quot;LCD1602.h&quot;</span><br><span class="line"></span><br><span class="line">bit flag500ms = 0; //500ms å®šæ—¶æ ‡å¿—</span><br><span class="line">unsigned char T0RH = 0; //T0 é‡è½½å€¼çš„é«˜å­—èŠ‚</span><br><span class="line">unsigned char T0RL = 0; //T0 é‡è½½å€¼çš„ä½å­—èŠ‚</span><br><span class="line">unsigned char code str1[] = &quot;Perseverance51&quot;;</span><br><span class="line">//å¾…æ˜¾ç¤ºçš„ç¬¬äºŒè¡Œå­—ç¬¦ä¸²ï¼Œæœ€å¥½ä¸ä¸ç¬¬ä¸€è¡Œå­—ç¬¦ä¸²ç­‰é•¿ï¼Œè¾ƒçŸ­çš„è¡Œå¯ç”¨ç©ºæ ¼è¡¥é½</span><br><span class="line">unsigned char code str2[] = &quot;Hello &#x27; World&quot;;</span><br><span class="line">/* é…ç½®å¹¶å¯åŠ¨ T0ï¼Œms-T0 å®šæ—¶æ—¶é—´ */</span><br><span class="line">void ConfigTimer0(unsigned int ms)&#123;</span><br><span class="line">    unsigned long tmp; //ä¸´æ—¶å˜é‡</span><br><span class="line">    tmp = 11059200 / 12; //å®šæ—¶å™¨è®¡æ•°é¢‘ç‡</span><br><span class="line">    tmp = (tmp * ms) / 1000; //è®¡ç®—æ‰€éœ€çš„è®¡æ•°å€¼</span><br><span class="line">    tmp = 65536 - tmp; //è®¡ç®—å®šæ—¶å™¨é‡è½½å€¼</span><br><span class="line">   tmp = tmp + 12; //è¡¥å¿ä¸­æ–­å“åº”å»¶æ—¶é€ æˆçš„è¯¯å·®</span><br><span class="line">    T0RH = (unsigned char)(tmp&gt;&gt;8); //å®šæ—¶å™¨é‡è½½å€¼æ‹†åˆ†ä¸ºé«˜ä½å­—èŠ‚</span><br><span class="line">    T0RL = (unsigned char)tmp;</span><br><span class="line">    TMOD &amp;= 0xF0; //æ¸…é›¶ T0 çš„æ§åˆ¶ä½</span><br><span class="line">    TMOD |= 0x01; //é…ç½® T0 ä¸ºæ¨¡å¼ 1</span><br><span class="line">    TH0 = T0RH; //åŠ è½½ T0 é‡è½½å€¼</span><br><span class="line">    TL0 = T0RL;</span><br><span class="line">    ET0 = 1; //ä½¿èƒ½ T0 ä¸­æ–­</span><br><span class="line">    TR0 = 1; //å¯åŠ¨ T0</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned char i;</span><br><span class="line">    unsigned char index = 0; //ç§»åŠ¨ç´¢å¼•</span><br><span class="line">    unsigned char  bufMove1[16+sizeof(str1)+16]; //ç§»åŠ¨æ˜¾ç¤ºç¼“å†²åŒº 1</span><br><span class="line">    unsigned char  bufMove2[16+sizeof(str2)+16]; //ç§»åŠ¨æ˜¾ç¤ºç¼“å†²åŒº 2</span><br><span class="line">EA = 1; //å¼€æ€»ä¸­æ–­</span><br><span class="line"> ConfigTimer0(60); //é…ç½® T0 å®šæ—¶ è®¾ç½®è¿‡å°ä¼šå¯¼è‡´Proteusä»¿çœŸæ—¶å±å¹•æœ‰é»‘å—åŒºåŸŸï¼ŒæŒ‰ç†è¿™ä¸ªå€¼ä¸åº”è¯¥è¶…è¿‡51msæ‰è¡Œ</span><br><span class="line">//å®é™…ç¡¬ä»¶æ·»åŠ å®šä¹‰ï¼špdata å¤–éƒ¨å­˜å‚¨åŒº</span><br><span class="line"></span><br><span class="line">    LCD1602_Init();//åˆå§‹åŒ–LCD1602</span><br><span class="line">LCD1602_write_com(0x01);//æ¸…å±æŒ‡ä»¤</span><br><span class="line">//ç¼“å†²åŒºå¼€å¤´ä¸€æ®µå¡«å……ä¸ºç©ºæ ¼</span><br><span class="line">    for (i=0; i&lt;16; i++)&#123;</span><br><span class="line">        bufMove1[i] = &#x27; &#x27;;</span><br><span class="line">        bufMove2[i] = &#x27; &#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    //å¾…æ˜¾ç¤ºå­—ç¬¦ä¸²æ‹·è´åˆ°ç¼“å†²åŒºä¸­é—´ä½ç½®</span><br><span class="line">    for (i=0; i&lt;(sizeof(str1)-1); i++)&#123;</span><br><span class="line">        bufMove1[16+i] = str1[i];</span><br><span class="line">        bufMove2[16+i] = str2[i];</span><br><span class="line">    &#125;</span><br><span class="line">    //ç¼“å†²åŒºç»“å°¾ä¸€æ®µä¹Ÿå¡«å……ä¸ºç©ºæ ¼</span><br><span class="line">    for (i=(16+sizeof(str1)-1); i&lt;sizeof(bufMove1); i++)&#123;</span><br><span class="line">        bufMove1[i] = &#x27; &#x27;;</span><br><span class="line">        bufMove2[i] = &#x27; &#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        if (flag500ms)&#123; //æ¯ 500ms ç§»åŠ¨ä¸€æ¬¡å±å¹•</span><br><span class="line">            flag500ms = 0;</span><br><span class="line">            //ä»ç¼“å†²åŒºæŠ½å‡ºéœ€æ˜¾ç¤ºçš„ä¸€æ®µå­—ç¬¦æ˜¾ç¤ºåˆ°æ¶²æ™¶ä¸Š</span><br><span class="line">            LcdShowStr(0, 0, bufMove1+index, 16);</span><br><span class="line">            LcdShowStr(1, 0, bufMove2+index, 16);</span><br><span class="line">            //ç§»åŠ¨ç´¢å¼•é€’å¢ï¼Œå®ç°å·¦ç§»</span><br><span class="line">            index++;</span><br><span class="line">            if (index &gt;= (16+sizeof(str1)-1))&#123;</span><br><span class="line">                //èµ·å§‹ä½ç½®è¾¾åˆ°å­—ç¬¦ä¸²å°¾éƒ¨åå³è¿”å›ä»å¤´å¼€å§‹</span><br><span class="line">                index = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* T0 ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œå®šæ—¶ 500ms */</span><br><span class="line">void InterruptTimer0() interrupt 1&#123;</span><br><span class="line">    static unsigned char tmr500ms = 0;</span><br><span class="line">   </span><br><span class="line">    TH0 = T0RH; //é‡æ–°åŠ è½½é‡è½½å€¼</span><br><span class="line">    TL0 = T0RL;</span><br><span class="line">    tmr500ms++;</span><br><span class="line">    if (tmr500ms &gt;= 10)&#123;</span><br><span class="line">        tmr500ms = 0;</span><br><span class="line">        flag500ms = 1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;STC89C5xRC.H&gt;<br>#include â€œLCD1602.hâ€</p><p>bit flag500ms &#x3D; 0; &#x2F;&#x2F;500ms å®šæ—¶æ ‡å¿—<br>unsigned char T0RH &#x3D; 0; &#x2F;&#x2F;T0 é‡è½½å€¼çš„é«˜å­—èŠ‚<br>unsigned char T0RL &#x3D; 0; &#x2F;&#x2F;T0 é‡è½½å€¼çš„ä½å­—èŠ‚<br>unsigned char code str1[] &#x3D; â€œPerseverance51â€;<br>&#x2F;&#x2F;å¾…æ˜¾ç¤ºçš„ç¬¬äºŒè¡Œå­—ç¬¦ä¸²ï¼Œæœ€å¥½ä¸ä¸ç¬¬ä¸€è¡Œå­—ç¬¦ä¸²ç­‰é•¿ï¼Œè¾ƒçŸ­çš„è¡Œå¯ç”¨ç©ºæ ¼è¡¥é½<br>unsigned char code str2[] &#x3D; â€œHello â€˜ Worldâ€;<br>&#x2F;* é…ç½®å¹¶å¯åŠ¨ T0ï¼Œms-T0 å®šæ—¶æ—¶é—´ *&#x2F;<br>void ConfigTimer0(unsigned int ms){<br>    unsigned long tmp; &#x2F;&#x2F;ä¸´æ—¶å˜é‡<br>    tmp &#x3D; 11059200 &#x2F; 12; &#x2F;&#x2F;å®šæ—¶å™¨è®¡æ•°é¢‘ç‡<br>    tmp &#x3D; (tmp * ms) &#x2F; 1000; &#x2F;&#x2F;è®¡ç®—æ‰€éœ€çš„è®¡æ•°å€¼<br>    tmp &#x3D; 65536 - tmp; &#x2F;&#x2F;è®¡ç®—å®šæ—¶å™¨é‡è½½å€¼<br>   tmp &#x3D; tmp + 12; &#x2F;&#x2F;è¡¥å¿ä¸­æ–­å“åº”å»¶æ—¶é€ æˆçš„è¯¯å·®<br>    T0RH &#x3D; (unsigned char)(tmp&gt;&gt;8); &#x2F;&#x2F;å®šæ—¶å™¨é‡è½½å€¼æ‹†åˆ†ä¸ºé«˜ä½å­—èŠ‚<br>    T0RL &#x3D; (unsigned char)tmp;<br>    TMOD &amp;&#x3D; 0xF0; &#x2F;&#x2F;æ¸…é›¶ T0 çš„æ§åˆ¶ä½<br>    TMOD |&#x3D; 0x01; &#x2F;&#x2F;é…ç½® T0 ä¸ºæ¨¡å¼ 1<br>    TH0 &#x3D; T0RH; &#x2F;&#x2F;åŠ è½½ T0 é‡è½½å€¼<br>    TL0 &#x3D; T0RL;<br>    ET0 &#x3D; 1; &#x2F;&#x2F;ä½¿èƒ½ T0 ä¸­æ–­<br>    TR0 &#x3D; 1; &#x2F;&#x2F;å¯åŠ¨ T0<br>}<br>void main()<br>{<br>        unsigned char i;<br>    unsigned char index &#x3D; 0; &#x2F;&#x2F;ç§»åŠ¨ç´¢å¼•<br>    unsigned char  bufMove1[16+sizeof(str1)+16]; &#x2F;&#x2F;ç§»åŠ¨æ˜¾ç¤ºç¼“å†²åŒº 1<br>    unsigned char  bufMove2[16+sizeof(str2)+16]; &#x2F;&#x2F;ç§»åŠ¨æ˜¾ç¤ºç¼“å†²åŒº 2<br>    EA &#x3D; 1; &#x2F;&#x2F;å¼€æ€»ä¸­æ–­<br>     ConfigTimer0(60); &#x2F;&#x2F;é…ç½® T0 å®šæ—¶ è®¾ç½®è¿‡å°ä¼šå¯¼è‡´Proteusä»¿çœŸæ—¶å±å¹•æœ‰é»‘å—åŒºåŸŸï¼ŒæŒ‰ç†è¿™ä¸ªå€¼ä¸åº”è¯¥è¶…è¿‡51msæ‰è¡Œ<br>    &#x2F;&#x2F;å®é™…ç¡¬ä»¶æ·»åŠ å®šä¹‰ï¼špdata å¤–éƒ¨å­˜å‚¨åŒº</p><pre><code>LCD1602_Init();//åˆå§‹åŒ–LCD1602LCD1602_write_com(0x01);//æ¸…å±æŒ‡ä»¤//ç¼“å†²åŒºå¼€å¤´ä¸€æ®µå¡«å……ä¸ºç©ºæ ¼for (i=0; i&lt;16; i++)&#123;    bufMove1[i] = &#39; &#39;;    bufMove2[i] = &#39; &#39;;&#125;//å¾…æ˜¾ç¤ºå­—ç¬¦ä¸²æ‹·è´åˆ°ç¼“å†²åŒºä¸­é—´ä½ç½®for (i=0; i&lt;(sizeof(str1)-1); i++)&#123;    bufMove1[16+i] = str1[i];    bufMove2[16+i] = str2[i];&#125;//ç¼“å†²åŒºç»“å°¾ä¸€æ®µä¹Ÿå¡«å……ä¸ºç©ºæ ¼for (i=(16+sizeof(str1)-1); i&lt;sizeof(bufMove1); i++)&#123;    bufMove1[i] = &#39; &#39;;    bufMove2[i] = &#39; &#39;;&#125;while(1)&#123;    if (flag500ms)&#123; //æ¯ 500ms ç§»åŠ¨ä¸€æ¬¡å±å¹•        flag500ms = 0;        //ä»ç¼“å†²åŒºæŠ½å‡ºéœ€æ˜¾ç¤ºçš„ä¸€æ®µå­—ç¬¦æ˜¾ç¤ºåˆ°æ¶²æ™¶ä¸Š        LcdShowStr(0, 0, bufMove1+index, 16);        LcdShowStr(1, 0, bufMove2+index, 16);        //ç§»åŠ¨ç´¢å¼•é€’å¢ï¼Œå®ç°å·¦ç§»        index++;        if (index &gt;= (16+sizeof(str1)-1))&#123;            //èµ·å§‹ä½ç½®è¾¾åˆ°å­—ç¬¦ä¸²å°¾éƒ¨åå³è¿”å›ä»å¤´å¼€å§‹            index = 0;        &#125;    &#125;&#125;</code></pre><p>}</p><p>&#x2F;* T0 ä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œå®šæ—¶ 500ms *&#x2F;<br>void InterruptTimer0() interrupt 1{<br>    static unsigned char tmr500ms &#x3D; 0;</p><pre><code>TH0 = T0RH; //é‡æ–°åŠ è½½é‡è½½å€¼TL0 = T0RL;tmr500ms++;if (tmr500ms &gt;= 10)&#123;    tmr500ms = 0;    flag500ms = 1;&#125;</code></pre><p>}&#96;</p><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1GFzQSNQW5E0Do0CyvJovlQ </span><br><span class="line">æå–ç ï¼š37jm</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1GFzQSNQW5E0Do0CyvJovlQ  æå–ç ï¼š37jm</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘åŸºäºVSM ä¸²å£printfè°ƒè¯•è¾“å‡ºç¤ºä¾‹</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%9F%BA%E4%BA%8EVSM-%E4%B8%B2%E5%8F%A3printf%E8%B0%83%E8%AF%95%E8%BE%93%E5%87%BA%E7%A4%BA%E4%BE%8B/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%9F%BA%E4%BA%8EVSM-%E4%B8%B2%E5%8F%A3printf%E8%B0%83%E8%AF%95%E8%BE%93%E5%87%BA%E7%A4%BA%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘åŸºäºVSM-ä¸²å£printfè°ƒè¯•è¾“å‡ºç¤ºä¾‹"><a href="#ã€Proteusä»¿çœŸã€‘åŸºäºVSM-ä¸²å£printfè°ƒè¯•è¾“å‡ºç¤ºä¾‹" class="headerlink" title="ã€Proteusä»¿çœŸã€‘åŸºäºVSM ä¸²å£printfè°ƒè¯•è¾“å‡ºç¤ºä¾‹"></a>ã€Proteusä»¿çœŸã€‘åŸºäºVSM ä¸²å£printfè°ƒè¯•è¾“å‡ºç¤ºä¾‹</h1><h3 id="ã€Proteusä»¿çœŸã€‘åŸºäºVSM-ä¸²å£printfè°ƒè¯•è¾“å‡ºç¤ºä¾‹-1"><a href="#ã€Proteusä»¿çœŸã€‘åŸºäºVSM-ä¸²å£printfè°ƒè¯•è¾“å‡ºç¤ºä¾‹-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘åŸºäºVSM ä¸²å£printfè°ƒè¯•è¾“å‡ºç¤ºä¾‹"></a>ã€Proteusä»¿çœŸã€‘åŸºäºVSM ä¸²å£printfè°ƒè¯•è¾“å‡ºç¤ºä¾‹</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/f61fd4c550bf461bbfcf54170abe13c4.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><p>åœ¨Proteusé‡Œé¢ä½¿ç”¨VSM Studioæ‰“å°æµ®ç‚¹æ•°å˜é‡ç¼–è¯‘ä¼šå‡ºé”™ï¼Œè¿™é‡Œå°±æ²¡æœ‰æ‰“å°è¿™ä¸ªç±»å‹äº†ã€‚</p><p><code>VSM Studio</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">/* Main.c file generated by New Project wizard</span><br><span class="line"> *</span><br><span class="line"> * Created:   å‘¨ä¸€ 7æœˆ 4 2022</span><br><span class="line"> * Processor: AT89C51</span><br><span class="line"> * Compiler:  Keil for 8051</span><br><span class="line"> */</span><br><span class="line">#include &lt;reg51.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#define MAIN_Fosc11059200uL//å®šä¹‰ä¸»æ—¶é’Ÿ</span><br><span class="line">#define BAUD 9600           //UART baudrate</span><br><span class="line"></span><br><span class="line">void delayms(unsigned int z)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int x,y;</span><br><span class="line">  for(x=z;x&gt;0;x--)</span><br><span class="line">    for(y=112;y&gt;0;y--);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void tst_printf (void) &#123;</span><br><span class="line">  char a = 1;</span><br><span class="line">  int b  = 12365;</span><br><span class="line">  long c = 0x7FFFFFFF;</span><br><span class="line"></span><br><span class="line">  unsigned char x = &#x27;A&#x27;;</span><br><span class="line">  unsigned int y  = 54321;</span><br><span class="line">  unsigned long z = 0x4A6F6E00;</span><br><span class="line"></span><br><span class="line">//  float f_a = 10.0;</span><br><span class="line">// float f_g = 22.95;</span><br><span class="line"></span><br><span class="line">  char buf [] = &quot;Test String&quot;;//ä¸å®šé•¿æ•°ç»„</span><br><span class="line">  char *p = buf;</span><br><span class="line"></span><br><span class="line">  printf (&quot;char %bd int %d long %ld\n&quot;,a,b,c);</span><br><span class="line">  printf (&quot;Uchar %bu Uint %u Ulong %lu\n&quot;,x,y,z);</span><br><span class="line">  printf (&quot;xchar %bx xint %x xlong %lx\n&quot;,x,y,z);</span><br><span class="line">  printf (&quot;String %s is at address %p\n&quot;,buf,p);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void) </span><br><span class="line">&#123; </span><br><span class="line">SCON = 0x50; //ä¸²å£æ–¹å¼1,å…è®¸æ¥æ”¶ </span><br><span class="line">//PCON=0x80;//æ³¢ç‰¹ç‡å€é¢‘ï¼Œå¯ç”¨æ—¶ï¼Œæ³¢ç‰¹ç‡ç¿»å€</span><br><span class="line">    TMOD &amp;= 0x0F; //æ¸…é›¶ T1 çš„æ§åˆ¶ä½</span><br><span class="line">    TMOD |= 0x20; //å®šæ—¶å™¨1 å®šæ—¶æ–¹å¼2 ,8ä½è‡ªåŠ¨é‡è£…è½½</span><br><span class="line">TH1 = TL1 =256  -(MAIN_Fosc/12/32/BAUD); //è®¡ç®— T1 é‡è½½å€¼</span><br><span class="line">TI = 1; </span><br><span class="line">TR1 = 1; //å¯åŠ¨å®šæ—¶å™¨ </span><br><span class="line">ET1 = 0; //ç¦æ­¢ T1 ä¸­æ–­</span><br><span class="line">ES = 1; //ä½¿èƒ½ä¸²å£ä¸­æ–­</span><br><span class="line">EA =1;</span><br><span class="line">printf(&quot;Hello World!\n&quot;); //æ˜¾ç¤ºHello World </span><br><span class="line">while(1) </span><br><span class="line">&#123; </span><br><span class="line">delayms(3000);</span><br><span class="line">tst_printf();</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;* Main.c file generated by New Project wizard<br> *</p><ul><li>Created:   å‘¨ä¸€ 7æœˆ 4 2022</li><li>Processor: AT89C51</li><li>Compiler:  Keil for 8051<br> *&#x2F;</li></ul><p>#include &lt;reg51.h&gt;<br>#include &lt;stdio.h&gt;</p><p>#define MAIN_Fosc11059200uL&#x2F;&#x2F;å®šä¹‰ä¸»æ—¶é’Ÿ<br>#define BAUD 9600           &#x2F;&#x2F;UART baudrate</p><p>void delayms(unsigned int z)<br>{<br>  unsigned int x,y;<br>  for(x&#x3D;z;x&gt;0;xâ€“)<br>    for(y&#x3D;112;y&gt;0;yâ€“);<br>}</p><p>void tst_printf (void) {<br>  char a &#x3D; 1;<br>  int b  &#x3D; 12365;<br>  long c &#x3D; 0x7FFFFFFF;</p><p>  unsigned char x &#x3D; â€˜Aâ€™;<br>  unsigned int y  &#x3D; 54321;<br>  unsigned long z &#x3D; 0x4A6F6E00;</p><p>&#x2F;&#x2F;  float f_a &#x3D; 10.0;<br>&#x2F;&#x2F; float f_g &#x3D; 22.95;</p><p>  char buf [] &#x3D; â€œTest Stringâ€;&#x2F;&#x2F;ä¸å®šé•¿æ•°ç»„<br>  char *p &#x3D; buf;</p><p>  printf (â€œchar %bd int %d long %ld\nâ€,a,b,c);<br>  printf (â€œUchar %bu Uint %u Ulong %lu\nâ€,x,y,z);<br>  printf (â€œxchar %bx xint %x xlong %lx\nâ€,x,y,z);<br>  printf (â€œString %s is at address %p\nâ€,buf,p);</p><p>}</p><p>void main(void)<br>{<br>    SCON &#x3D; 0x50; &#x2F;&#x2F;ä¸²å£æ–¹å¼1,å…è®¸æ¥æ”¶<br>&#x2F;&#x2F;PCON&#x3D;0x80;&#x2F;&#x2F;æ³¢ç‰¹ç‡å€é¢‘ï¼Œå¯ç”¨æ—¶ï¼Œæ³¢ç‰¹ç‡ç¿»å€<br>    TMOD &amp;&#x3D; 0x0F; &#x2F;&#x2F;æ¸…é›¶ T1 çš„æ§åˆ¶ä½<br>    TMOD |&#x3D; 0x20; &#x2F;&#x2F;å®šæ—¶å™¨1 å®šæ—¶æ–¹å¼2 ,8ä½è‡ªåŠ¨é‡è£…è½½<br>    TH1 &#x3D; TL1 &#x3D;256  -(MAIN_Fosc&#x2F;12&#x2F;32&#x2F;BAUD); &#x2F;&#x2F;è®¡ç®— T1 é‡è½½å€¼<br>    TI &#x3D; 1;<br>    TR1 &#x3D; 1; &#x2F;&#x2F;å¯åŠ¨å®šæ—¶å™¨<br>    ET1 &#x3D; 0; &#x2F;&#x2F;ç¦æ­¢ T1 ä¸­æ–­<br>    ES &#x3D; 1; &#x2F;&#x2F;ä½¿èƒ½ä¸²å£ä¸­æ–­<br>    EA &#x3D;1;<br>printf(â€œHello World!\nâ€); &#x2F;&#x2F;æ˜¾ç¤ºHello World<br>    while(1)<br>    {<br>    delayms(3000);<br>    tst_printf();<br>    }<br>}&#96;</p><ul><li>åœ¨VSM Studioç•Œé¢é€‰ä¸­main.cæ–‡ä»¶åï¼Œç‚¹å‡»è¿è¡Œä»¿çœŸï¼Œç„¶åæš‚åœå¯ä»¥çœ‹åˆ°ä»£ç è¿è¡Œä½ç½®ã€‚</li></ul><p><code>main.c</code></p><p><img src="https://img-blog.csdnimg.cn/979de1e46dc7441ca78957d8e940ca74.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/01b9451e3aa24940a0984de50b08973a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ä»¿çœŸèµ„æº"><a href="#ä»¿çœŸèµ„æº" class="headerlink" title="ä»¿çœŸèµ„æº"></a>ä»¿çœŸèµ„æº</h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1INRLd18hGqulVlpr3gyQ_g </span><br><span class="line">æå–ç ï¼šjkvt</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1INRLd18hGqulVlpr3gyQ_g  æå–ç ï¼šjkvt</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘å¤šè·¯éé˜»å¡å»¶æ—¶æµæ°´ç¯æ¼”ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%A4%9A%E8%B7%AF%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%BB%B6%E6%97%B6%E6%B5%81%E6%B0%B4%E7%81%AF%E6%BC%94%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E5%A4%9A%E8%B7%AF%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%BB%B6%E6%97%B6%E6%B5%81%E6%B0%B4%E7%81%AF%E6%BC%94%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘å¤šè·¯éé˜»å¡å»¶æ—¶æµæ°´ç¯æ¼”ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘å¤šè·¯éé˜»å¡å»¶æ—¶æµæ°´ç¯æ¼”ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å¤šè·¯éé˜»å¡å»¶æ—¶æµæ°´ç¯æ¼”ç¤º"></a>ã€Proteusä»¿çœŸã€‘å¤šè·¯éé˜»å¡å»¶æ—¶æµæ°´ç¯æ¼”ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘å¤šè·¯éé˜»å¡å»¶æ—¶æµæ°´ç¯æ¼”ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘å¤šè·¯éé˜»å¡å»¶æ—¶æµæ°´ç¯æ¼”ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘å¤šè·¯éé˜»å¡å»¶æ—¶æµæ°´ç¯æ¼”ç¤º"></a>ã€Proteusä»¿çœŸã€‘å¤šè·¯éé˜»å¡å»¶æ—¶æµæ°´ç¯æ¼”ç¤º</h3><ul><li>ğŸŒ»Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/c3c3641c6c9e4096bbf4287c3c82015a.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸŒ¼åŠŸèƒ½è¯´æ˜"><a href="#ğŸŒ¼åŠŸèƒ½è¯´æ˜" class="headerlink" title="ğŸŒ¼åŠŸèƒ½è¯´æ˜"></a>ğŸŒ¼åŠŸèƒ½è¯´æ˜</h4><h5 id="ğŸ“œ51å•ç‰‡æœºåˆ©ç”¨å®šæ—¶å™¨è½®è¯¢è®¾ç½®2è·¯ä¸åŒé•¿åº¦çš„å»¶æ—¶æ—¶é—´ï¼Œè·‘æµæ°´ç¯ã€‚"><a href="#ğŸ“œ51å•ç‰‡æœºåˆ©ç”¨å®šæ—¶å™¨è½®è¯¢è®¾ç½®2è·¯ä¸åŒé•¿åº¦çš„å»¶æ—¶æ—¶é—´ï¼Œè·‘æµæ°´ç¯ã€‚" class="headerlink" title="ğŸ“œ51å•ç‰‡æœºåˆ©ç”¨å®šæ—¶å™¨è½®è¯¢è®¾ç½®2è·¯ä¸åŒé•¿åº¦çš„å»¶æ—¶æ—¶é—´ï¼Œè·‘æµæ°´ç¯ã€‚"></a>ğŸ“œ51å•ç‰‡æœºåˆ©ç”¨å®šæ—¶å™¨è½®è¯¢è®¾ç½®2è·¯ä¸åŒé•¿åº¦çš„å»¶æ—¶æ—¶é—´ï¼Œè·‘æµæ°´ç¯ã€‚</h5><h4 id="ğŸ““å®ç°æ–¹æ³•"><a href="#ğŸ““å®ç°æ–¹æ³•" class="headerlink" title="ğŸ““å®ç°æ–¹æ³•"></a>ğŸ““å®ç°æ–¹æ³•</h4><h5 id="ğŸ“‘åˆ©ç”¨å®šæ—¶å™¨ä¸­æ–­ï¼Œåˆ›å»ºä¸€ä¸ªä»¥1æ¯«ç§’ä¸ºæ—¶åŸºçš„å®šæ—¶å™¨ä¸­æ–­å‡½æ•°ã€‚åœ¨éœ€è¦ä¸åŒæ—¶é—´çš„å®šæ—¶é•¿åº¦æ—¶ï¼Œå°±è®¾ç½®ä¸€ä¸ªå®šæ—¶çš„æ ‡é‡ï¼Œå½“ä½¿èƒ½è¿™ä¸ªè¢«å®šä¹‰çš„æ ‡é‡åï¼Œå®šæ—¶å™¨æ¯éš”1æ¯«ç§’å°±è¿›å…¥ä¸­æ–­æœåŠ¡å‡½æ•°é‡Œé¢æŸ¥è¯¢å¹¶ç´¯åŠ è®¡æ•°ï¼Œå½“ç´¯è®¡è®¡æ•°è¾¾åˆ°æ ‡é‡å€¼æ—¶å°±å°†å¯¹åº”çš„æ ‡é‡æ ‡å¿—ä½ç½®1ï¼Œç„¶ååªè¦åœ¨ä¸»å¾ªç¯ä¸­æŸ¥è¯¢è¯¥æ ‡é‡æ ‡å¿—ä½æ˜¯å¦å€¼1ä»è€Œå®ç°éé˜»å¡å®šæ—¶çš„åŠŸèƒ½ã€‚"><a href="#ğŸ“‘åˆ©ç”¨å®šæ—¶å™¨ä¸­æ–­ï¼Œåˆ›å»ºä¸€ä¸ªä»¥1æ¯«ç§’ä¸ºæ—¶åŸºçš„å®šæ—¶å™¨ä¸­æ–­å‡½æ•°ã€‚åœ¨éœ€è¦ä¸åŒæ—¶é—´çš„å®šæ—¶é•¿åº¦æ—¶ï¼Œå°±è®¾ç½®ä¸€ä¸ªå®šæ—¶çš„æ ‡é‡ï¼Œå½“ä½¿èƒ½è¿™ä¸ªè¢«å®šä¹‰çš„æ ‡é‡åï¼Œå®šæ—¶å™¨æ¯éš”1æ¯«ç§’å°±è¿›å…¥ä¸­æ–­æœåŠ¡å‡½æ•°é‡Œé¢æŸ¥è¯¢å¹¶ç´¯åŠ è®¡æ•°ï¼Œå½“ç´¯è®¡è®¡æ•°è¾¾åˆ°æ ‡é‡å€¼æ—¶å°±å°†å¯¹åº”çš„æ ‡é‡æ ‡å¿—ä½ç½®1ï¼Œç„¶ååªè¦åœ¨ä¸»å¾ªç¯ä¸­æŸ¥è¯¢è¯¥æ ‡é‡æ ‡å¿—ä½æ˜¯å¦å€¼1ä»è€Œå®ç°éé˜»å¡å®šæ—¶çš„åŠŸèƒ½ã€‚" class="headerlink" title="ğŸ“‘åˆ©ç”¨å®šæ—¶å™¨ä¸­æ–­ï¼Œåˆ›å»ºä¸€ä¸ªä»¥1æ¯«ç§’ä¸ºæ—¶åŸºçš„å®šæ—¶å™¨ä¸­æ–­å‡½æ•°ã€‚åœ¨éœ€è¦ä¸åŒæ—¶é—´çš„å®šæ—¶é•¿åº¦æ—¶ï¼Œå°±è®¾ç½®ä¸€ä¸ªå®šæ—¶çš„æ ‡é‡ï¼Œå½“ä½¿èƒ½è¿™ä¸ªè¢«å®šä¹‰çš„æ ‡é‡åï¼Œå®šæ—¶å™¨æ¯éš”1æ¯«ç§’å°±è¿›å…¥ä¸­æ–­æœåŠ¡å‡½æ•°é‡Œé¢æŸ¥è¯¢å¹¶ç´¯åŠ è®¡æ•°ï¼Œå½“ç´¯è®¡è®¡æ•°è¾¾åˆ°æ ‡é‡å€¼æ—¶å°±å°†å¯¹åº”çš„æ ‡é‡æ ‡å¿—ä½ç½®1ï¼Œç„¶ååªè¦åœ¨ä¸»å¾ªç¯ä¸­æŸ¥è¯¢è¯¥æ ‡é‡æ ‡å¿—ä½æ˜¯å¦å€¼1ä»è€Œå®ç°éé˜»å¡å®šæ—¶çš„åŠŸèƒ½ã€‚"></a>ğŸ“‘åˆ©ç”¨å®šæ—¶å™¨ä¸­æ–­ï¼Œåˆ›å»ºä¸€ä¸ªä»¥1æ¯«ç§’ä¸ºæ—¶åŸºçš„å®šæ—¶å™¨ä¸­æ–­å‡½æ•°ã€‚åœ¨éœ€è¦ä¸åŒæ—¶é—´çš„å®šæ—¶é•¿åº¦æ—¶ï¼Œå°±è®¾ç½®ä¸€ä¸ªå®šæ—¶çš„æ ‡é‡ï¼Œå½“ä½¿èƒ½è¿™ä¸ªè¢«å®šä¹‰çš„æ ‡é‡åï¼Œå®šæ—¶å™¨æ¯éš”1æ¯«ç§’å°±è¿›å…¥ä¸­æ–­æœåŠ¡å‡½æ•°é‡Œé¢æŸ¥è¯¢å¹¶ç´¯åŠ è®¡æ•°ï¼Œå½“ç´¯è®¡è®¡æ•°è¾¾åˆ°æ ‡é‡å€¼æ—¶å°±å°†å¯¹åº”çš„æ ‡é‡æ ‡å¿—ä½ç½®1ï¼Œç„¶ååªè¦åœ¨ä¸»å¾ªç¯ä¸­æŸ¥è¯¢è¯¥æ ‡é‡æ ‡å¿—ä½æ˜¯å¦å€¼1ä»è€Œå®ç°éé˜»å¡å®šæ—¶çš„åŠŸèƒ½ã€‚</h5><ul><li>âœ…å®šæ—¶å™¨ä¸­æ–­æœåŠ¡å‡½æ•°</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">void time0_isr() interrupt  1 using  0</span><br><span class="line">&#123;</span><br><span class="line">TR0 = 0 ;</span><br><span class="line">if(time_enable)//è®¡æ•°å™¨ä½¿èƒ½</span><br><span class="line">&#123;</span><br><span class="line">cnt --;</span><br><span class="line">if(!cnt)time_flag = 1;//è®¡æ•°æ—¶é—´åˆ°</span><br><span class="line">&#125;</span><br><span class="line">if(time_enable2)//è®¡æ•°å™¨ä½¿èƒ½</span><br><span class="line">&#123;</span><br><span class="line">cnt2 --;</span><br><span class="line">if(!cnt2)time_flag2 = 1;//è®¡æ•°æ—¶é—´åˆ°</span><br><span class="line">&#125;</span><br><span class="line">TL0 = 0x18;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TH0 = 0xFC;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TR0 = 1;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;void time0_isr() interrupt  1 using  0<br>{<br>    TR0 &#x3D; 0 ;<br>    if(time_enable)&#x2F;&#x2F;è®¡æ•°å™¨ä½¿èƒ½<br>    {<br>        cnt â€“;<br>        if(!cnt)time_flag &#x3D; 1;&#x2F;&#x2F;è®¡æ•°æ—¶é—´åˆ°<br>    }<br>    if(time_enable2)&#x2F;&#x2F;è®¡æ•°å™¨ä½¿èƒ½<br>    {<br>        cnt2 â€“;<br>        if(!cnt2)time_flag2 &#x3D; 1;&#x2F;&#x2F;è®¡æ•°æ—¶é—´åˆ°<br>    }<br>    TL0 &#x3D; 0x18;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TH0 &#x3D; 0xFC;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TR0 &#x3D; 1;</p><p>}&#96;</p><h5 id="âœ¨å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å®šæ—¶å™¨ä¸­æ–­æœåŠ¡å‡½æ•°é‡Œé¢ç›´æ¥è¿›è¡Œæ ‡å¿—ä½æŸ¥è¯¢ï¼Œä»¥å‡å°‘å®šä¹‰çš„å˜é‡å¤šï¼Œä½†æ˜¯è¿™æ ·çš„è¿ç®—ä¼šé™ä½ç²¾åº¦ã€‚"><a href="#âœ¨å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å®šæ—¶å™¨ä¸­æ–­æœåŠ¡å‡½æ•°é‡Œé¢ç›´æ¥è¿›è¡Œæ ‡å¿—ä½æŸ¥è¯¢ï¼Œä»¥å‡å°‘å®šä¹‰çš„å˜é‡å¤šï¼Œä½†æ˜¯è¿™æ ·çš„è¿ç®—ä¼šé™ä½ç²¾åº¦ã€‚" class="headerlink" title="âœ¨å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å®šæ—¶å™¨ä¸­æ–­æœåŠ¡å‡½æ•°é‡Œé¢ç›´æ¥è¿›è¡Œæ ‡å¿—ä½æŸ¥è¯¢ï¼Œä»¥å‡å°‘å®šä¹‰çš„å˜é‡å¤šï¼Œä½†æ˜¯è¿™æ ·çš„è¿ç®—ä¼šé™ä½ç²¾åº¦ã€‚"></a>âœ¨å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å®šæ—¶å™¨ä¸­æ–­æœåŠ¡å‡½æ•°é‡Œé¢ç›´æ¥è¿›è¡Œæ ‡å¿—ä½æŸ¥è¯¢ï¼Œä»¥å‡å°‘å®šä¹‰çš„å˜é‡å¤šï¼Œä½†æ˜¯è¿™æ ·çš„è¿ç®—ä¼šé™ä½ç²¾åº¦ã€‚</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">void time0_isr() interrupt  1 using  0</span><br><span class="line">&#123;</span><br><span class="line">TR0 = 0 ;</span><br><span class="line">cnt++;</span><br><span class="line">if(cnt%20000==0) flag1=1;</span><br><span class="line">if(cnt%500==0) flag2=1;</span><br><span class="line">TL0 = 0x18;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TH0 = 0xFC;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TR0 = 1;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;void time0_isr() interrupt  1 using  0<br>{<br>    TR0 &#x3D; 0 ;<br>    cnt++;<br>    if(cnt%20000&#x3D;&#x3D;0) flag1&#x3D;1;<br>    if(cnt%500&#x3D;&#x3D;0) flag2&#x3D;1;<br>    TL0 &#x3D; 0x18;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TH0 &#x3D; 0xFC;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TR0 &#x3D; 1;</p><p>}&#96;</p><h4 id="ğŸ“ä¸»å‡½æ•°ä»£ç "><a href="#ğŸ“ä¸»å‡½æ•°ä»£ç " class="headerlink" title="ğŸ“ä¸»å‡½æ•°ä»£ç "></a>ğŸ“ä¸»å‡½æ•°ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;time.h&quot;</span><br><span class="line"></span><br><span class="line">#define led_shine_time 2000</span><br><span class="line">#define led_shine_time2 500</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">unsigned char temp = 0x80;</span><br><span class="line">unsigned char temp2 = 0x01;</span><br><span class="line">unsigned char i,j;</span><br><span class="line">cnt = led_shine_time;</span><br><span class="line">cnt2 = led_shine_time2;</span><br><span class="line">time_enable = 1;//ä½¿èƒ½1è·¯å®šæ—¶å™¨</span><br><span class="line">time_enable2 = 1;//ä½¿èƒ½2è·¯å®šæ—¶å™¨</span><br><span class="line">Timer0Init();</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line"> if(time_flag)//æŸ¥è¯¢å®šæ—¶å™¨è®¡æ•°æ˜¯å¦è¾¾åˆ°è®¾å®šå€¼</span><br><span class="line"> &#123;</span><br><span class="line"> time_flag = 0;</span><br><span class="line"> P1 = ~(temp&gt;&gt;i);</span><br><span class="line"> cnt = led_shine_time;//é‡æ–°è£…è½½</span><br><span class="line"> i++;</span><br><span class="line"> i %=8;</span><br><span class="line"> &#125;</span><br><span class="line">  if(time_flag2)//æŸ¥è¯¢å®šæ—¶å™¨è®¡æ•°æ˜¯å¦è¾¾åˆ°è®¾å®šå€¼</span><br><span class="line"> &#123;</span><br><span class="line"> time_flag2 = 0;</span><br><span class="line"> P2 = ~(temp&gt;&gt;j);</span><br><span class="line"> cnt2 = led_shine_time2;//é‡æ–°è£…è½½</span><br><span class="line"> j++;</span><br><span class="line"> j %=8;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œtime.hâ€</p><p>#define led_shine_time 2000<br>#define led_shine_time2 500</p><p>void main()<br>{<br>    unsigned char temp &#x3D; 0x80;<br>    unsigned char temp2 &#x3D; 0x01;<br>    unsigned char i,j;<br>    cnt &#x3D; led_shine_time;<br>    cnt2 &#x3D; led_shine_time2;<br>    time_enable &#x3D; 1;&#x2F;&#x2F;ä½¿èƒ½1è·¯å®šæ—¶å™¨<br>    time_enable2 &#x3D; 1;&#x2F;&#x2F;ä½¿èƒ½2è·¯å®šæ—¶å™¨<br>    Timer0Init();<br>    while(1)<br>    {<br>     if(time_flag)&#x2F;&#x2F;æŸ¥è¯¢å®šæ—¶å™¨è®¡æ•°æ˜¯å¦è¾¾åˆ°è®¾å®šå€¼<br>     {<br>         time_flag &#x3D; 0;<br>         P1 &#x3D; ~(temp&gt;&gt;i);<br>         cnt &#x3D; led_shine_time;&#x2F;&#x2F;é‡æ–°è£…è½½<br>         i++;<br>         i %&#x3D;8;<br>     }<br>      if(time_flag2)&#x2F;&#x2F;æŸ¥è¯¢å®šæ—¶å™¨è®¡æ•°æ˜¯å¦è¾¾åˆ°è®¾å®šå€¼<br>     {<br>         time_flag2 &#x3D; 0;<br>         P2 &#x3D; ~(temp&gt;&gt;j);<br>         cnt2 &#x3D; led_shine_time2;&#x2F;&#x2F;é‡æ–°è£…è½½<br>         j++;<br>         j %&#x3D;8;<br>     }<br>    }<br>}&#96;</p><h4 id="ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ğŸ“šç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/19mcG9hdqiuo3FciJAMgnCg </span><br><span class="line">æå–ç ï¼šit5g</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/19mcG9hdqiuo3FciJAMgnCg  æå–ç ï¼šit5g</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘ç‹¬ç«‹æŒ‰é”®+æ•°ç ç®¡æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%8B%AC%E7%AB%8B%E6%8C%89%E9%94%AE%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%8B%AC%E7%AB%8B%E6%8C%89%E9%94%AE%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘ç‹¬ç«‹æŒ‰é”®-æ•°ç ç®¡æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘ç‹¬ç«‹æŒ‰é”®-æ•°ç ç®¡æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ç‹¬ç«‹æŒ‰é”®+æ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘ç‹¬ç«‹æŒ‰é”®+æ•°ç ç®¡æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘ç‹¬ç«‹æŒ‰é”®-æ•°ç ç®¡æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘ç‹¬ç«‹æŒ‰é”®-æ•°ç ç®¡æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ç‹¬ç«‹æŒ‰é”®+æ•°ç ç®¡æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘ç‹¬ç«‹æŒ‰é”®+æ•°ç ç®¡æ˜¾ç¤º</h3><ul><li>âœ¨Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/a6756cf88ee54c299e046896529a45f6.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“šåŠŸèƒ½ç®€ä»‹"><a href="#ğŸ“šåŠŸèƒ½ç®€ä»‹" class="headerlink" title="ğŸ“šåŠŸèƒ½ç®€ä»‹"></a>ğŸ“šåŠŸèƒ½ç®€ä»‹</h4><h5 id="ğŸ“æœ¬æ–‡å†…å®¹ä¸Šæ˜¯å¹¶æ— æ–°æ„ï¼Œåªæ˜¯å°†å„åŠŸèƒ½æ¨¡å—åˆ†ç¦»å¼€æ¥ã€‚åŠŸèƒ½åº•å±‚å®ç°é‡‡ç”¨éé˜»å¡å¼æŒ‰é”®æ‰«æï¼Œå•å‡»æˆ–é•¿æŒ‰éƒ½åŠ ä¸€çš„æ¨¡å¼ï¼Œä½¿ç”¨å®šæ—¶å™¨å®šæ—¶æ‰«æçš„æ–¹å¼ã€‚"><a href="#ğŸ“æœ¬æ–‡å†…å®¹ä¸Šæ˜¯å¹¶æ— æ–°æ„ï¼Œåªæ˜¯å°†å„åŠŸèƒ½æ¨¡å—åˆ†ç¦»å¼€æ¥ã€‚åŠŸèƒ½åº•å±‚å®ç°é‡‡ç”¨éé˜»å¡å¼æŒ‰é”®æ‰«æï¼Œå•å‡»æˆ–é•¿æŒ‰éƒ½åŠ ä¸€çš„æ¨¡å¼ï¼Œä½¿ç”¨å®šæ—¶å™¨å®šæ—¶æ‰«æçš„æ–¹å¼ã€‚" class="headerlink" title="ğŸ“æœ¬æ–‡å†…å®¹ä¸Šæ˜¯å¹¶æ— æ–°æ„ï¼Œåªæ˜¯å°†å„åŠŸèƒ½æ¨¡å—åˆ†ç¦»å¼€æ¥ã€‚åŠŸèƒ½åº•å±‚å®ç°é‡‡ç”¨éé˜»å¡å¼æŒ‰é”®æ‰«æï¼Œå•å‡»æˆ–é•¿æŒ‰éƒ½åŠ ä¸€çš„æ¨¡å¼ï¼Œä½¿ç”¨å®šæ—¶å™¨å®šæ—¶æ‰«æçš„æ–¹å¼ã€‚"></a>ğŸ“æœ¬æ–‡å†…å®¹ä¸Šæ˜¯å¹¶æ— æ–°æ„ï¼Œåªæ˜¯å°†å„åŠŸèƒ½æ¨¡å—åˆ†ç¦»å¼€æ¥ã€‚åŠŸèƒ½åº•å±‚å®ç°é‡‡ç”¨éé˜»å¡å¼æŒ‰é”®æ‰«æï¼Œå•å‡»æˆ–é•¿æŒ‰éƒ½åŠ ä¸€çš„æ¨¡å¼ï¼Œä½¿ç”¨å®šæ—¶å™¨å®šæ—¶æ‰«æçš„æ–¹å¼ã€‚</h5><h4 id="ğŸ› å·¥ç¨‹æ¶æ„"><a href="#ğŸ› å·¥ç¨‹æ¶æ„" class="headerlink" title="ğŸ› å·¥ç¨‹æ¶æ„"></a>ğŸ› å·¥ç¨‹æ¶æ„</h4><p><img src="https://img-blog.csdnimg.cn/8a20933c0ef84487a5e7d7ee12e2c986.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ““ä¸»ç¨‹åºä»£ç "><a href="#ğŸ““ä¸»ç¨‹åºä»£ç " class="headerlink" title="ğŸ““ä¸»ç¨‹åºä»£ç "></a>ğŸ““ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;Key.h&quot;</span><br><span class="line">#include &quot;display.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unsigned int NumCnt;</span><br><span class="line"></span><br><span class="line">void Dis_Service();</span><br><span class="line">void Key_Service(); </span><br><span class="line"></span><br><span class="line">void main()&#123;</span><br><span class="line"></span><br><span class="line">while(1)&#123;</span><br><span class="line">  Key_Service();</span><br><span class="line">Dis_Service();</span><br><span class="line">Display();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> void Key_Service()&#123;</span><br><span class="line">switch(Key_Scan())&#123;</span><br><span class="line">case 0:break;</span><br><span class="line">case 1:NumCnt++;if(NumCnt &gt;9999)NumCnt = 0;break;</span><br><span class="line">case 2:NumCnt--;if(NumCnt &gt; 9999)NumCnt =9999;break;</span><br><span class="line">case 3:NumCnt = 0;break;</span><br><span class="line">case 4: NumCnt= 9527 ;break ;</span><br><span class="line">default :break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">void Dis_Service()&#123;</span><br><span class="line">LEDBuf[0]=NumCnt/1000;</span><br><span class="line">LEDBuf[1]=NumCnt/100%10;</span><br><span class="line">LEDBuf[2]=NumCnt/10%10;</span><br><span class="line">LEDBuf[3]=NumCnt%10; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œKey.hâ€<br>#include â€œdisplay.hâ€</p><p>unsigned int NumCnt;</p><p>void Dis_Service();<br>void Key_Service(); </p><p>void main(){</p><pre><code>while(1)&#123;  Key_Service();    Dis_Service();    Display();&#125;</code></pre><p>}</p><p> void Key_Service(){<br>    switch(Key_Scan()){<br>    case 0:break;<br>    case 1:NumCnt++;if(NumCnt &gt;9999)NumCnt &#x3D; 0;break;<br>    case 2:NumCntâ€“;if(NumCnt &gt; 9999)NumCnt &#x3D;9999;break;<br>    case 3:NumCnt &#x3D; 0;break;<br>    case 4: NumCnt&#x3D; 9527 ;break ;<br>    default :break;<br>    }<br>}</p><p>void Dis_Service(){<br>                LEDBuf[0]&#x3D;NumCnt&#x2F;1000;<br>                LEDBuf[1]&#x3D;NumCnt&#x2F;100%10;<br>                LEDBuf[2]&#x3D;NumCnt&#x2F;10%10;<br>                LEDBuf[3]&#x3D;NumCnt%10;<br> }&#96;</p><h4 id="â›³ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#â›³ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="â›³ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>â›³ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>ğŸ”–æœ¬æ¡ˆä¾‹åŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1lf1tHxfozh1ITvgS_jQ4Pg </span><br><span class="line">æå–ç ï¼šqbl8</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1lf1tHxfozh1ITvgS_jQ4Pg  æå–ç ï¼šqbl8</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STCå•ç‰‡æœº NRF24L01é€šè®¯å®éªŒ</title>
      <link href="/2024/03/STC-STC%E5%8D%95%E7%89%87%E6%9C%BA-NRF24L01%E9%80%9A%E8%AE%AF%E5%AE%9E%E9%AA%8C/"/>
      <url>/2024/03/STC-STC%E5%8D%95%E7%89%87%E6%9C%BA-NRF24L01%E9%80%9A%E8%AE%AF%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STCå•ç‰‡æœº-NRF24L01é€šè®¯å®éªŒ"><a href="#STCå•ç‰‡æœº-NRF24L01é€šè®¯å®éªŒ" class="headerlink" title="STCå•ç‰‡æœº NRF24L01é€šè®¯å®éªŒ"></a>STCå•ç‰‡æœº NRF24L01é€šè®¯å®éªŒ</h1><h3 id="STCå•ç‰‡æœº-NRF24L01é€šè®¯å®éªŒ-1"><a href="#STCå•ç‰‡æœº-NRF24L01é€šè®¯å®éªŒ-1" class="headerlink" title="STCå•ç‰‡æœº NRF24L01é€šè®¯å®éªŒ"></a>STCå•ç‰‡æœº NRF24L01é€šè®¯å®éªŒ</h3><ul><li>ğŸ”–éªŒè¯å¯¹è±¡ï¼šSTC15L2K60S2  ğŸ“STC15L2K60S2è‡ªåˆ¶ç³»ç»Ÿæ¿å¼€æºåœ°å€ï¼š<a href="https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban">https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban</a></li><li>â±æ—¶é’Ÿé¢‘ç‡ï¼š11.0592MHz</li><li>ğŸŒ¼NRF24L01æ¨¡å—ä»¥åŠæ¥çº¿è¯´æ˜</li><li>ğŸ“œæ¥çº¿å®šä¹‰ï¼š</li></ul><p>ğŸ”–éªŒè¯å¯¹è±¡ï¼šSTC15L2K60S2  ğŸ“STC15L2K60S2è‡ªåˆ¶ç³»ç»Ÿæ¿å¼€æºåœ°å€ï¼š<a href="https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban">https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban</a></p><p><code>STC15L2K60S2</code></p><p><img src="https://img-blog.csdnimg.cn/34e134cf773948e89141bed5e146bce0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban</code></p><p>â±æ—¶é’Ÿé¢‘ç‡ï¼š11.0592MHz</p><p><code>11.0592</code></p><p>ğŸŒ¼NRF24L01æ¨¡å—ä»¥åŠæ¥çº¿è¯´æ˜</p><p><img src="https://img-blog.csdnimg.cn/ce898ab67ac24dbbbb38b36d3c30445d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/c4015cf214744a7997a0e48317de943a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ğŸ“œæ¥çº¿å®šä¹‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">----------------------</span><br><span class="line">   VCC CSN MOSI IRQ</span><br><span class="line">   GND CE  SCK  MISO</span><br><span class="line">----------------------</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#define SCK  P17</span><br><span class="line">#define MISO P16</span><br><span class="line">#define MOSI P15</span><br><span class="line">#define CSN  P13</span><br><span class="line">#define CE   P12</span><br><span class="line">#define IRQ  P14</span><br></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title="&#96;&#x2F;*"></a>&#96;&#x2F;*</h2><h2 id="VCC-CSN-MOSI-IRQ-GND-CE-SCK-MISO"><a href="#VCC-CSN-MOSI-IRQ-GND-CE-SCK-MISO" class="headerlink" title="   VCC CSN MOSI IRQ   GND CE  SCK  MISO"></a>   VCC CSN MOSI IRQ<br>   GND CE  SCK  MISO</h2><p>*&#x2F;</p><p>#define SCK  P17<br>#define MISO P16<br>#define MOSI P15<br>#define CSN  P13<br>#define CE   P12<br>#define IRQ  P14&#96;</p><ul><li>ğŸ”°å¦‚æœæ¥çº¿é”™è¯¯æˆ–nRF24L01æœ‰é—®é¢˜ä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯ï¼š</li></ul><p><img src="https://img-blog.csdnimg.cn/00aee639d40145e3871a1cedf0513366.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/a695df66eaac47d2aa0c44b4ddb9d8e5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="â›³åŠŸèƒ½è¯´æ˜å’Œæ³¨æ„äº‹é¡¹"><a href="#â›³åŠŸèƒ½è¯´æ˜å’Œæ³¨æ„äº‹é¡¹" class="headerlink" title="â›³åŠŸèƒ½è¯´æ˜å’Œæ³¨æ„äº‹é¡¹"></a>â›³åŠŸèƒ½è¯´æ˜å’Œæ³¨æ„äº‹é¡¹</h4><ol><li>åœ¨è¿›è¡Œæœ¬å®éªŒå‰ï¼Œéœ€è¦ç¡®ä¿æ¨¡å—æ­£å¸¸ï¼Œæ¥çº¿æ­£ç¡®ï¼Œå¦‚æœæ¥çº¿é”™è¯¯ï¼Œæ‰“å¼€ä¸²å£æ—¶ï¼Œä¼šæ‰“å°åˆå§‹åŒ–å¤±è´¥ç›¸å…³ä¿¡æ¯æç¤ºã€‚</li><li>å‘å°„ç«¯é‡‡ç”¨æŒ‰é”®æ§åˆ¶æ•°æ®å‘é€ï¼Œç¨‹åºé»˜è®¤æ˜¯å½“P00å¼•è„šç”µå¹³æ‹‰ä½æ—¶å‘é€æŒ‡å®šæ•°æ®ã€‚</li><li>ä¸²å£é€šè®¯æ³¢ç‰¹ç‡ï¼š115200</li><li>å¦‚æœé‡‡ç”¨5Vçš„STCå•ç‰‡æœºè¿›è¡Œæœ¬å®éªŒï¼ŒNRF24L01æ¨¡å—ä¸º3.3Vä¾›ç”µæ¨¡å—ï¼Œéœ€è¦æ³¨æ„å¼•è„šç”µå¹³è½¬åŒ–ï¼Œæˆ–è€…ä¸²è”1Kç”µé˜»ä»¥å…æŸåé€šè®¯æ¨¡å—ã€‚</li></ol><p><img src="https://img-blog.csdnimg.cn/5bbaa34356824c31863f1e9255a8ceef.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>115200</code></p><h4 id="ğŸ“å‘å°„ç«¯ä¸»ç¨‹åº"><a href="#ğŸ“å‘å°„ç«¯ä¸»ç¨‹åº" class="headerlink" title="ğŸ“å‘å°„ç«¯ä¸»ç¨‹åº"></a>ğŸ“å‘å°„ç«¯ä¸»ç¨‹åº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;STC15F2K60S2.H&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;NRF24L01.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">xdata u8 sendbuf[32] = &quot;Hello World!Perseverance9527&quot;;</span><br><span class="line">#define MAIN_Fosc   11059200UL</span><br><span class="line">#define Baudrate    115200L</span><br><span class="line">#define TM          (65536 -(MAIN_Fosc/Baudrate/4))</span><br><span class="line">//é…ç½®ä¸²å£1åˆå§‹åŒ–å‡½æ•°</span><br><span class="line">void UartInit(void)</span><br><span class="line">&#123;</span><br><span class="line">    SCON = (SCON &amp; 0x3f) | 0x40;</span><br><span class="line">    T2L  = TM;</span><br><span class="line">    T2H  = TM &gt;&gt; 8;</span><br><span class="line">    AUXR |= 0x15;</span><br><span class="line">&#125;</span><br><span class="line">//ä¸²å£å•å­—ç¬¦è¾“å‡ºå‡½æ•°</span><br><span class="line">void UartPutc(unsigned char dat)</span><br><span class="line">&#123;</span><br><span class="line">    SBUF = dat;</span><br><span class="line">    while(TI == 0);</span><br><span class="line">    TI = 0;</span><br><span class="line">&#125;</span><br><span class="line">//é…ç½®printfå‡½æ•°ï¼Œéœ€åŒ…å«stdio.hå¤´æ–‡ä»¶</span><br><span class="line">char putchar(char c)</span><br><span class="line">&#123;</span><br><span class="line">    UartPutc(c);</span><br><span class="line">    return c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    P0M1 = 0x00;//é…ç½®ç«¯å£ä¸ºå‡†åŒå‘æ¨¡å¼</span><br><span class="line">    P0M0 = 0x00;</span><br><span class="line"></span><br><span class="line">    P1M1 = 0x00;</span><br><span class="line">    P1M0 = 0x00;</span><br><span class="line">    UartInit();//ä¸²å£åˆå§‹åŒ–</span><br><span class="line">    printf(&quot;STC15L2K60S2 nRF24L01 Send !\r\n&quot;); //UARTå‘é€ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">    if(NRF_CONFIG(NRF_TX))//nrfåˆå§‹åŒ–ï¼Œé…ç½®ä¸ºå‘é€æ¨¡å¼</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;nRF24L01 Send Init error!\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else printf(&quot;nRF24L01 Send Init success!\r\n&quot;);</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        if(P00 == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            NRF_TxOrRxPack(NRF_TX, sendbuf, 32, 100);//P35æŒ‰é”®æŒ‰ä¸‹ï¼Œå‘é€æ•°æ®</span><br><span class="line">            printf(&quot;Send!\r\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;STC15F2K60S2.H&gt;</p><p>#include &lt;NRF24L01.h&gt;<br>#include &lt;intrins.h&gt;<br>#include â€œstdio.hâ€<br>xdata u8 sendbuf[32] &#x3D; â€œHello World!Perseverance9527â€;<br>#define MAIN_Fosc   11059200UL<br>#define Baudrate    115200L<br>#define TM          (65536 -(MAIN_Fosc&#x2F;Baudrate&#x2F;4))<br>&#x2F;&#x2F;é…ç½®ä¸²å£1åˆå§‹åŒ–å‡½æ•°<br>void UartInit(void)<br>{<br>    SCON &#x3D; (SCON &amp; 0x3f) | 0x40;<br>    T2L  &#x3D; TM;<br>    T2H  &#x3D; TM &gt;&gt; 8;<br>    AUXR |&#x3D; 0x15;<br>}<br>&#x2F;&#x2F;ä¸²å£å•å­—ç¬¦è¾“å‡ºå‡½æ•°<br>void UartPutc(unsigned char dat)<br>{<br>    SBUF &#x3D; dat;<br>    while(TI &#x3D;&#x3D; 0);<br>    TI &#x3D; 0;<br>}<br>&#x2F;&#x2F;é…ç½®printfå‡½æ•°ï¼Œéœ€åŒ…å«stdio.hå¤´æ–‡ä»¶<br>char putchar(char c)<br>{<br>    UartPutc(c);<br>    return c;<br>}</p><p>void main(void)<br>{</p><pre><code>P0M1 = 0x00;//é…ç½®ç«¯å£ä¸ºå‡†åŒå‘æ¨¡å¼P0M0 = 0x00;P1M1 = 0x00;P1M0 = 0x00;UartInit();//ä¸²å£åˆå§‹åŒ–printf(&quot;STC15L2K60S2 nRF24L01 Send !\r\n&quot;); //UARTå‘é€ä¸€ä¸ªå­—ç¬¦ä¸²if(NRF_CONFIG(NRF_TX))//nrfåˆå§‹åŒ–ï¼Œé…ç½®ä¸ºå‘é€æ¨¡å¼&#123;    printf(&quot;nRF24L01 Send Init error!\r\n&quot;);&#125;else printf(&quot;nRF24L01 Send Init success!\r\n&quot;);while(1)&#123;    if(P00 == 0)    &#123;        NRF_TxOrRxPack(NRF_TX, sendbuf, 32, 100);//P35æŒ‰é”®æŒ‰ä¸‹ï¼Œå‘é€æ•°æ®        printf(&quot;Send!\r\n&quot;);    &#125;&#125;</code></pre><p>}&#96;</p><h4 id="ğŸ“æ¥æ”¶ç«¯ä¸»ç¨‹åº"><a href="#ğŸ“æ¥æ”¶ç«¯ä¸»ç¨‹åº" class="headerlink" title="ğŸ“æ¥æ”¶ç«¯ä¸»ç¨‹åº"></a>ğŸ“æ¥æ”¶ç«¯ä¸»ç¨‹åº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;STC15F2K60S2.H&gt;</span><br><span class="line">#include &lt;NRF24L01.h&gt;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">xdata u8 Rece_buf[32] = &#123;0&#125;;</span><br><span class="line"></span><br><span class="line">#define MAIN_Fosc   11059200UL</span><br><span class="line">#define Baudrate    115200L</span><br><span class="line">#define TM          (65536 -(MAIN_Fosc/Baudrate/4))</span><br><span class="line">void UartInit(void)</span><br><span class="line">&#123;</span><br><span class="line">    SCON = (SCON &amp; 0x3f) | 0x40;</span><br><span class="line">    T2L  = TM;</span><br><span class="line">    T2H  = TM &gt;&gt; 8;</span><br><span class="line">    AUXR |= 0x15;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void UartPutc(unsigned char dat)</span><br><span class="line">&#123;</span><br><span class="line">    SBUF = dat;</span><br><span class="line">    while(TI == 0);</span><br><span class="line">    TI = 0;</span><br><span class="line">&#125;</span><br><span class="line">char putchar(char c)</span><br><span class="line">&#123;</span><br><span class="line">    UartPutc(c);</span><br><span class="line">    return c;</span><br><span class="line">&#125;</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    P0M1 = 0x00;</span><br><span class="line">    P0M0 = 0x00;</span><br><span class="line"></span><br><span class="line">    P1M1 = 0x00;</span><br><span class="line">    P1M0 = 0x00;</span><br><span class="line">    UartInit();</span><br><span class="line">    printf(&quot;STC15L2K60S2 nRF24L01 Receve !\r\n&quot;); //UARTå‘é€ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line">    if(NRF_CONFIG(NRF_RX))//æ£€æµ‹è®¾å¤‡åœ¨çº¿</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;nRF24L01 Receve Init error!\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else printf(&quot;nRF24L01 Receve Init success!\r\n&quot;);</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        if(NRF_TxOrRxPack(NRF_RX, Rece_buf, 32, 100) == RX_OK)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            printf(&quot;Receve data: %s \r\n&quot;, Rece_buf);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include &lt;STC15F2K60S2.H&gt;<br>#include &lt;NRF24L01.h&gt;<br>#include &lt;intrins.h&gt;<br>#include â€œstdio.hâ€<br>xdata u8 Rece_buf[32] &#x3D; {0};</p><p>#define MAIN_Fosc   11059200UL<br>#define Baudrate    115200L<br>#define TM          (65536 -(MAIN_Fosc&#x2F;Baudrate&#x2F;4))<br>void UartInit(void)<br>{<br>    SCON &#x3D; (SCON &amp; 0x3f) | 0x40;<br>    T2L  &#x3D; TM;<br>    T2H  &#x3D; TM &gt;&gt; 8;<br>    AUXR |&#x3D; 0x15;<br>}</p><p>void UartPutc(unsigned char dat)<br>{<br>    SBUF &#x3D; dat;<br>    while(TI &#x3D;&#x3D; 0);<br>    TI &#x3D; 0;<br>}<br>char putchar(char c)<br>{<br>    UartPutc(c);<br>    return c;<br>}<br>void main(void)<br>{</p><pre><code>P0M1 = 0x00;P0M0 = 0x00;P1M1 = 0x00;P1M0 = 0x00;UartInit();printf(&quot;STC15L2K60S2 nRF24L01 Receve !\r\n&quot;); //UARTå‘é€ä¸€ä¸ªå­—ç¬¦ä¸²if(NRF_CONFIG(NRF_RX))//æ£€æµ‹è®¾å¤‡åœ¨çº¿&#123;    printf(&quot;nRF24L01 Receve Init error!\r\n&quot;);&#125;else printf(&quot;nRF24L01 Receve Init success!\r\n&quot;);while(1)&#123;    if(NRF_TxOrRxPack(NRF_RX, Rece_buf, 32, 100) == RX_OK)    &#123;        printf(&quot;Receve data: %s \r\n&quot;, Rece_buf);    &#125;&#125;</code></pre><p>}&#96;</p><h4 id="ğŸ“šç¨‹åºæºç "><a href="#ğŸ“šç¨‹åºæºç " class="headerlink" title="ğŸ“šç¨‹åºæºç "></a>ğŸ“šç¨‹åºæºç </h4><ul><li>ğŸŒ¿å‘å°„ç«¯</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥: https://pan.baidu.com/s/1F6fqcEtJ6YgzBUVSQpXyxg</span><br><span class="line">æå–ç : angp</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥: https://pan.baidu.com/s/1F6fqcEtJ6YgzBUVSQpXyxg æå–ç : angp</code></p><ul><li>ğŸŒ¿æ¥æ”¶ç«¯</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥: https://pan.baidu.com/s/1xuyyzrzSCkL401JuEYlZ1w</span><br><span class="line">æå–ç : gsng</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥: https://pan.baidu.com/s/1xuyyzrzSCkL401JuEYlZ1w æå–ç : gsng</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STCå•ç‰‡æœº NRF24L01é€šè®¯å¸¦çŠ¶æ€åé¦ˆ</title>
      <link href="/2024/03/STC-STC%E5%8D%95%E7%89%87%E6%9C%BA-NRF24L01%E9%80%9A%E8%AE%AF%E5%B8%A6%E7%8A%B6%E6%80%81%E5%8F%8D%E9%A6%88/"/>
      <url>/2024/03/STC-STC%E5%8D%95%E7%89%87%E6%9C%BA-NRF24L01%E9%80%9A%E8%AE%AF%E5%B8%A6%E7%8A%B6%E6%80%81%E5%8F%8D%E9%A6%88/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STCå•ç‰‡æœº-NRF24L01é€šè®¯å¸¦çŠ¶æ€åé¦ˆ"><a href="#STCå•ç‰‡æœº-NRF24L01é€šè®¯å¸¦çŠ¶æ€åé¦ˆ" class="headerlink" title="STCå•ç‰‡æœº NRF24L01é€šè®¯å¸¦çŠ¶æ€åé¦ˆ"></a>STCå•ç‰‡æœº NRF24L01é€šè®¯å¸¦çŠ¶æ€åé¦ˆ</h1><h3 id="STCå•ç‰‡æœº-NRF24L01é€šè®¯å¸¦çŠ¶æ€åé¦ˆ-1"><a href="#STCå•ç‰‡æœº-NRF24L01é€šè®¯å¸¦çŠ¶æ€åé¦ˆ-1" class="headerlink" title="STCå•ç‰‡æœº NRF24L01é€šè®¯å¸¦çŠ¶æ€åé¦ˆ"></a>STCå•ç‰‡æœº NRF24L01é€šè®¯å¸¦çŠ¶æ€åé¦ˆ</h3><ul><li>ğŸ“ç›¸å…³ç¯‡ã€ŠSTCå•ç‰‡æœº NRF24L01é€šè®¯å®éªŒã€‹</li><li>ğŸ”–éªŒè¯å¯¹è±¡ï¼šSTC15L2K60S2</li><li>ğŸ“STC15L2K60S2è‡ªåˆ¶ç³»ç»Ÿæ¿å¼€æºåœ°å€ï¼š<a href="https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban">https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban</a></li><li>â±æ—¶é’Ÿé¢‘ç‡ï¼š11.0592MHz</li><li>ğŸŒ¼NRF24L01æ¨¡å—ä»¥åŠæ¥çº¿è¯´æ˜</li></ul><p>ğŸ“ç›¸å…³ç¯‡ã€ŠSTCå•ç‰‡æœº NRF24L01é€šè®¯å®éªŒã€‹</p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/130617473">STCå•ç‰‡æœº NRF24L01é€šè®¯å®éªŒ</a></p><p>ğŸ”–éªŒè¯å¯¹è±¡ï¼šSTC15L2K60S2</p><p><code>STC15L2K60S2</code></p><p>ğŸ“STC15L2K60S2è‡ªåˆ¶ç³»ç»Ÿæ¿å¼€æºåœ°å€ï¼š<a href="https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban">https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban</a></p><p><code>https://oshwhub.com/perseverance51/stc15l2k60s2-ji-tong-ban</code></p><p>â±æ—¶é’Ÿé¢‘ç‡ï¼š11.0592MHz</p><p><code>11.0592</code></p><p>ğŸŒ¼NRF24L01æ¨¡å—ä»¥åŠæ¥çº¿è¯´æ˜</p><p><img src="https://img-blog.csdnimg.cn/5d5bcb8f8b6d4111853f7bc829f908a4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/9b324a8c32844043ad60c56258b80fcd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">----------------------</span><br><span class="line">   VCC CSN MOSI IRQ</span><br><span class="line">   GND CE  SCK  MISO</span><br><span class="line">----------------------</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#define SCK  P17</span><br><span class="line">#define MISO P16</span><br><span class="line">#define MOSI P15</span><br><span class="line">#define CSN  P13</span><br><span class="line">#define CE   P12</span><br><span class="line">#define IRQ  P14</span><br></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title="&#96;&#x2F;*"></a>&#96;&#x2F;*</h2><h2 id="VCC-CSN-MOSI-IRQ-GND-CE-SCK-MISO"><a href="#VCC-CSN-MOSI-IRQ-GND-CE-SCK-MISO" class="headerlink" title="   VCC CSN MOSI IRQ   GND CE  SCK  MISO"></a>   VCC CSN MOSI IRQ<br>   GND CE  SCK  MISO</h2><p>*&#x2F;</p><p>#define SCK  P17<br>#define MISO P16<br>#define MOSI P15<br>#define CSN  P13<br>#define CE   P12<br>#define IRQ  P14&#96;</p><ul><li>âœ¨åœ¨ä¸Šé¢ä¸€ç¯‡çš„åŸºç¡€ä¸Šå¢åŠ äº†æ¥æ”¶ç«¯çŠ¶æ€åé¦ˆï¼Œå¦‚æœå‘å°„ç«¯å‘é€çš„æ•°æ®ï¼Œæ¥æ”¶ç«¯æ²¡æœ‰æ”¶åˆ°ä¿¡æ¯æˆ–ç”±äºè‡ªèº«çš„åŸå› å‘é€å¤±è´¥ï¼Œåœ¨å‘å°„ç«¯çš„ä¸²å£è°ƒè¯•ä¿¡æ¯é‡Œé¢è¾“å‡ºå¯¹åº”çš„ç›¸å…³æç¤ºä¿¡æ¯ã€‚</li></ul><h5 id="âœ¨åœ¨ä¸Šé¢ä¸€ç¯‡çš„åŸºç¡€ä¸Šå¢åŠ äº†æ¥æ”¶ç«¯çŠ¶æ€åé¦ˆï¼Œå¦‚æœå‘å°„ç«¯å‘é€çš„æ•°æ®ï¼Œæ¥æ”¶ç«¯æ²¡æœ‰æ”¶åˆ°ä¿¡æ¯æˆ–ç”±äºè‡ªèº«çš„åŸå› å‘é€å¤±è´¥ï¼Œåœ¨å‘å°„ç«¯çš„ä¸²å£è°ƒè¯•ä¿¡æ¯é‡Œé¢è¾“å‡ºå¯¹åº”çš„ç›¸å…³æç¤ºä¿¡æ¯ã€‚"><a href="#âœ¨åœ¨ä¸Šé¢ä¸€ç¯‡çš„åŸºç¡€ä¸Šå¢åŠ äº†æ¥æ”¶ç«¯çŠ¶æ€åé¦ˆï¼Œå¦‚æœå‘å°„ç«¯å‘é€çš„æ•°æ®ï¼Œæ¥æ”¶ç«¯æ²¡æœ‰æ”¶åˆ°ä¿¡æ¯æˆ–ç”±äºè‡ªèº«çš„åŸå› å‘é€å¤±è´¥ï¼Œåœ¨å‘å°„ç«¯çš„ä¸²å£è°ƒè¯•ä¿¡æ¯é‡Œé¢è¾“å‡ºå¯¹åº”çš„ç›¸å…³æç¤ºä¿¡æ¯ã€‚" class="headerlink" title="âœ¨åœ¨ä¸Šé¢ä¸€ç¯‡çš„åŸºç¡€ä¸Šå¢åŠ äº†æ¥æ”¶ç«¯çŠ¶æ€åé¦ˆï¼Œå¦‚æœå‘å°„ç«¯å‘é€çš„æ•°æ®ï¼Œæ¥æ”¶ç«¯æ²¡æœ‰æ”¶åˆ°ä¿¡æ¯æˆ–ç”±äºè‡ªèº«çš„åŸå› å‘é€å¤±è´¥ï¼Œåœ¨å‘å°„ç«¯çš„ä¸²å£è°ƒè¯•ä¿¡æ¯é‡Œé¢è¾“å‡ºå¯¹åº”çš„ç›¸å…³æç¤ºä¿¡æ¯ã€‚"></a>âœ¨åœ¨ä¸Šé¢ä¸€ç¯‡çš„åŸºç¡€ä¸Šå¢åŠ äº†æ¥æ”¶ç«¯çŠ¶æ€åé¦ˆï¼Œå¦‚æœå‘å°„ç«¯å‘é€çš„æ•°æ®ï¼Œæ¥æ”¶ç«¯æ²¡æœ‰æ”¶åˆ°ä¿¡æ¯æˆ–ç”±äºè‡ªèº«çš„åŸå› å‘é€å¤±è´¥ï¼Œåœ¨å‘å°„ç«¯çš„ä¸²å£è°ƒè¯•ä¿¡æ¯é‡Œé¢è¾“å‡ºå¯¹åº”çš„ç›¸å…³æç¤ºä¿¡æ¯ã€‚</h5><p><img src="https://img-blog.csdnimg.cn/107bd622cc3942ca8c314d5abcfa75a6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>ğŸ­æœ¬ä¾‹ç¨‹ç¨‹åºæ¥æ”¶ç«¯ç¨‹åºå€¼æ·»åŠ æ£€æµ‹çŠ¶æ€æŒ‡ç¤ºç¯ä¸»è¦æ˜¯é’ˆå¯¹å¯¹å‘å°„ç«¯çš„ç¨‹åºåšäº†å†…å®¹æ–°å¢ã€‚</li></ul><h4 id="ğŸ“å‘å°„ç«¯ä¸»ç¨‹åº"><a href="#ğŸ“å‘å°„ç«¯ä¸»ç¨‹åº" class="headerlink" title="ğŸ“å‘å°„ç«¯ä¸»ç¨‹åº"></a>ğŸ“å‘å°„ç«¯ä¸»ç¨‹åº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;NRF24L01.h&quot;</span><br><span class="line">#include &quot;LED.h&quot;</span><br><span class="line">#include &lt;intrins.h&gt;</span><br><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">xdata u8 sendbuf[32] = &quot;Hello World!Perseverance9527&quot;;</span><br><span class="line">#define MAIN_Fosc   11059200UL</span><br><span class="line">#define Baudrate    115200L</span><br><span class="line">#define TM          (65536 -(MAIN_Fosc/Baudrate/4))</span><br><span class="line">//é…ç½®ä¸²å£1åˆå§‹åŒ–å‡½æ•°</span><br><span class="line">void UartInit(void)</span><br><span class="line">&#123;</span><br><span class="line">    SCON = (SCON &amp; 0x3f) | 0x40;</span><br><span class="line">    T2L  = TM;</span><br><span class="line">    T2H  = TM &gt;&gt; 8;</span><br><span class="line">    AUXR |= 0x15;</span><br><span class="line">&#125;</span><br><span class="line">//ä¸²å£å•å­—ç¬¦è¾“å‡ºå‡½æ•°</span><br><span class="line">void UartPutc(unsigned char dat)</span><br><span class="line">&#123;</span><br><span class="line">    SBUF = dat;</span><br><span class="line">    while(TI == 0);</span><br><span class="line">    TI = 0;</span><br><span class="line">&#125;</span><br><span class="line">//é…ç½®printfå‡½æ•°ï¼Œéœ€åŒ…å«stdio.hå¤´æ–‡ä»¶</span><br><span class="line">char putchar(char c)</span><br><span class="line">&#123;</span><br><span class="line">    UartPutc(c);</span><br><span class="line">    return c;</span><br><span class="line">&#125;</span><br><span class="line">/* Private function prototypes------------------------------------------------*/</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">* @name   GPIO_Init</span><br><span class="line">* @brief  é€šç”¨è¾“å…¥è¾“å‡ºç«¯å£åˆå§‹åŒ–</span><br><span class="line">* @param  None</span><br><span class="line">* @retval None</span><br><span class="line">*/</span><br><span class="line">static void GPIO_Init()</span><br><span class="line">&#123;</span><br><span class="line">    //M1  M0</span><br><span class="line">    //0   0     å‡†åŒå‘å£</span><br><span class="line">    //0   1     æ¨æŒ½è¾“å‡º</span><br><span class="line">    //1   0     é«˜é˜»è¾“å…¥</span><br><span class="line">    //1   1     å¼€æ¼</span><br><span class="line"></span><br><span class="line">    //P3</span><br><span class="line">    //P32è®¾ç½®ä¸ºé«˜é˜»è¾“å…¥</span><br><span class="line">    //P34,P35è®¾ç½®ä¸ºæ¨æŒ½è¾“å‡º</span><br><span class="line">    P3M1 = 0x04; //0000 0100</span><br><span class="line">    P3M0 = 0x30; //0011 0000</span><br><span class="line"></span><br><span class="line">    P34  = 0;  //å…³é—­è¿è¡ŒæŒ‡ç¤ºç¯</span><br><span class="line">    P35  = 0;  //å…³é—­PWMæŒ‡ç¤ºç¯</span><br><span class="line"></span><br><span class="line">    P0M1 = 0x00;//é…ç½®ç«¯å£ä¸ºå‡†åŒå‘æ¨¡å¼</span><br><span class="line">    P0M0 = 0x00;</span><br><span class="line"></span><br><span class="line">    P1M1 = 0x00;</span><br><span class="line">    P1M0 = 0x00;</span><br><span class="line">&#125;</span><br><span class="line"> /***********************************************</span><br><span class="line">å‡½æ•°åç§°ï¼šDelay_ms</span><br><span class="line">åŠŸ    èƒ½ï¼šSTC15ç³»åˆ—å•ç‰‡æœº1mså»¶æ—¶ç¨‹åº</span><br><span class="line">å…¥å£å‚æ•°ï¼šms:å»¶æ—¶çš„æ¯«ç§’æ•°</span><br><span class="line">è¿” å› å€¼ï¼šæ— </span><br><span class="line">å¤‡    æ³¨ï¼šç¤ºæ³¢å™¨å®æµ‹ï¼š0.997msï¼Œå†…éƒ¨æ—¶é’Ÿï¼š11.0592MHz           </span><br><span class="line">************************************************/</span><br><span class="line">void Delay_ms(unsigned int ms)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int i;</span><br><span class="line">  while( (ms--) != 0)</span><br><span class="line">   &#123;</span><br><span class="line">    for(i = 0; i &lt; 580; i++); </span><br><span class="line">   &#125;             </span><br><span class="line">&#125;</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">GPIO_Init();</span><br><span class="line">    UartInit();//ä¸²å£åˆå§‹åŒ–</span><br><span class="line">    printf(&quot;STC15L2K60S2 nRF24L01 Send !\r\n&quot;); //UARTå‘é€ä¸€ä¸ªå­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">    if(NRF_CONFIG(NRF_TX))//nrfåˆå§‹åŒ–ï¼Œé…ç½®ä¸ºå‘é€æ¨¡å¼</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;nRF24L01 Send Init error!\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">&#123;</span><br><span class="line">LED_Run.LED_Flip();</span><br><span class="line">Delay_ms(80);</span><br><span class="line">LED_Run.LED_Flip();</span><br><span class="line">Delay_ms(80);</span><br><span class="line">LED_Run.LED_Flip();</span><br><span class="line">Delay_ms(80);</span><br><span class="line">LED_Run.LED_OFF();</span><br><span class="line">printf(&quot;nRF24L01 Send Init success!\r\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">        if(P00 == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            NRF_TxOrRxPack(NRF_TX, sendbuf, 32, 100);//P35æŒ‰é”®æŒ‰ä¸‹ï¼Œå‘é€æ•°æ®</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œNRF24L01.hâ€<br>#include â€œLED.hâ€<br>#include &lt;intrins.h&gt;<br>#include â€œstdio.hâ€<br>xdata u8 sendbuf[32] &#x3D; â€œHello World!Perseverance9527â€;<br>#define MAIN_Fosc   11059200UL<br>#define Baudrate    115200L<br>#define TM          (65536 -(MAIN_Fosc&#x2F;Baudrate&#x2F;4))<br>&#x2F;&#x2F;é…ç½®ä¸²å£1åˆå§‹åŒ–å‡½æ•°<br>void UartInit(void)<br>{<br>    SCON &#x3D; (SCON &amp; 0x3f) | 0x40;<br>    T2L  &#x3D; TM;<br>    T2H  &#x3D; TM &gt;&gt; 8;<br>    AUXR |&#x3D; 0x15;<br>}<br>&#x2F;&#x2F;ä¸²å£å•å­—ç¬¦è¾“å‡ºå‡½æ•°<br>void UartPutc(unsigned char dat)<br>{<br>    SBUF &#x3D; dat;<br>    while(TI &#x3D;&#x3D; 0);<br>    TI &#x3D; 0;<br>}<br>&#x2F;&#x2F;é…ç½®printfå‡½æ•°ï¼Œéœ€åŒ…å«stdio.hå¤´æ–‡ä»¶<br>char putchar(char c)<br>{<br>    UartPutc(c);<br>    return c;<br>}<br>&#x2F;* Private function prototypesâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”*&#x2F;</p><p>&#x2F;*<br>    * @name   GPIO_Init<br>    * @brief  é€šç”¨è¾“å…¥è¾“å‡ºç«¯å£åˆå§‹åŒ–<br>    * @param  None<br>    * @retval None<br>*&#x2F;<br>static void GPIO_Init()<br>{<br>    &#x2F;&#x2F;M1  M0<br>    &#x2F;&#x2F;0   0     å‡†åŒå‘å£<br>    &#x2F;&#x2F;0   1     æ¨æŒ½è¾“å‡º<br>    &#x2F;&#x2F;1   0     é«˜é˜»è¾“å…¥<br>    &#x2F;&#x2F;1   1     å¼€æ¼</p><pre><code>//P3//P32è®¾ç½®ä¸ºé«˜é˜»è¾“å…¥//P34,P35è®¾ç½®ä¸ºæ¨æŒ½è¾“å‡ºP3M1 = 0x04; //0000 0100P3M0 = 0x30; //0011 0000P34  = 0;  //å…³é—­è¿è¡ŒæŒ‡ç¤ºç¯P35  = 0;  //å…³é—­PWMæŒ‡ç¤ºç¯P0M1 = 0x00;//é…ç½®ç«¯å£ä¸ºå‡†åŒå‘æ¨¡å¼P0M0 = 0x00;P1M1 = 0x00;P1M0 = 0x00;</code></pre><p>}<br> &#x2F;***********************************************<br>å‡½æ•°åç§°ï¼šDelay_ms<br>åŠŸ    èƒ½ï¼šSTC15ç³»åˆ—å•ç‰‡æœº1mså»¶æ—¶ç¨‹åº<br>å…¥å£å‚æ•°ï¼šms:å»¶æ—¶çš„æ¯«ç§’æ•°<br>è¿” å› å€¼ï¼šæ— <br>å¤‡    æ³¨ï¼šç¤ºæ³¢å™¨å®æµ‹ï¼š0.997msï¼Œå†…éƒ¨æ—¶é’Ÿï¼š11.0592MHz<br>************************************************&#x2F;<br>void Delay_ms(unsigned int ms)<br>{<br>      unsigned int i;<br>      while( (msâ€“) !&#x3D; 0)<br>       {<br>        for(i &#x3D; 0; i &lt; 580; i++);<br>       }<br>}<br>void main(void)<br>{</p><pre><code>    GPIO_Init();UartInit();//ä¸²å£åˆå§‹åŒ–printf(&quot;STC15L2K60S2 nRF24L01 Send !\r\n&quot;); //UARTå‘é€ä¸€ä¸ªå­—ç¬¦ä¸²if(NRF_CONFIG(NRF_TX))//nrfåˆå§‹åŒ–ï¼Œé…ç½®ä¸ºå‘é€æ¨¡å¼&#123;    printf(&quot;nRF24L01 Send Init error!\r\n&quot;);&#125;else    &#123;        LED_Run.LED_Flip();        Delay_ms(80);        LED_Run.LED_Flip();        Delay_ms(80);        LED_Run.LED_Flip();        Delay_ms(80);        LED_Run.LED_OFF();        printf(&quot;nRF24L01 Send Init success!\r\n&quot;);    &#125;while(1)&#123;    if(P00 == 0)    &#123;        NRF_TxOrRxPack(NRF_TX, sendbuf, 32, 100);//P35æŒ‰é”®æŒ‰ä¸‹ï¼Œå‘é€æ•°æ®            &#125;&#125;</code></pre><p>}&#96;</p><h4 id="ğŸ“šç¨‹åºæºç ï¼ˆåŒ…å«æ”¶å‘ç¨‹ï¼‰"><a href="#ğŸ“šç¨‹åºæºç ï¼ˆåŒ…å«æ”¶å‘ç¨‹ï¼‰" class="headerlink" title="ğŸ“šç¨‹åºæºç ï¼ˆåŒ…å«æ”¶å‘ç¨‹ï¼‰"></a>ğŸ“šç¨‹åºæºç ï¼ˆåŒ…å«æ”¶å‘ç¨‹ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥: https://pan.baidu.com/s/1dwXcKhQWzoho2XAOHUzoZw</span><br><span class="line">æå–ç : si3t</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥: https://pan.baidu.com/s/1dwXcKhQWzoho2XAOHUzoZw æå–ç : si3t</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ESP8266 + STC15åŸºäºATæŒ‡ä»¤é€šè¿‡TCPé€šè®¯åè®®æ§åˆ¶IOçŠ¶æ€</title>
      <link href="/2024/03/Stc15-ESP8266-STC15%E5%9F%BA%E4%BA%8EAT%E6%8C%87%E4%BB%A4%E9%80%9A%E8%BF%87TCP%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE%E6%8E%A7%E5%88%B6IO%E7%8A%B6%E6%80%81/"/>
      <url>/2024/03/Stc15-ESP8266-STC15%E5%9F%BA%E4%BA%8EAT%E6%8C%87%E4%BB%A4%E9%80%9A%E8%BF%87TCP%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE%E6%8E%A7%E5%88%B6IO%E7%8A%B6%E6%80%81/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ESP8266-STC15åŸºäºATæŒ‡ä»¤é€šè¿‡TCPé€šè®¯åè®®æ§åˆ¶IOçŠ¶æ€"><a href="#ESP8266-STC15åŸºäºATæŒ‡ä»¤é€šè¿‡TCPé€šè®¯åè®®æ§åˆ¶IOçŠ¶æ€" class="headerlink" title="ESP8266 + STC15åŸºäºATæŒ‡ä»¤é€šè¿‡TCPé€šè®¯åè®®æ§åˆ¶IOçŠ¶æ€"></a>ESP8266 + STC15åŸºäºATæŒ‡ä»¤é€šè¿‡TCPé€šè®¯åè®®æ§åˆ¶IOçŠ¶æ€</h1><h3 id="ESP8266-STC15åŸºäºATæŒ‡ä»¤é€šè¿‡TCPé€šè®¯åè®®æ§åˆ¶IOçŠ¶æ€-1"><a href="#ESP8266-STC15åŸºäºATæŒ‡ä»¤é€šè¿‡TCPé€šè®¯åè®®æ§åˆ¶IOçŠ¶æ€-1" class="headerlink" title="ESP8266 + STC15åŸºäºATæŒ‡ä»¤é€šè¿‡TCPé€šè®¯åè®®æ§åˆ¶IOçŠ¶æ€"></a>ESP8266 + STC15åŸºäºATæŒ‡ä»¤é€šè¿‡TCPé€šè®¯åè®®æ§åˆ¶IOçŠ¶æ€</h3><ul><li>ğŸ“ŒESP8266 ATå›ºä»¶åŸºäºå®‰ä¿¡å¯ATå›ºä»¶ï¼Œç›¸å…³åˆ·ATå›ºä»¶å¯ä»¥å‚è€ƒã€ŠNodeMCU-åˆ·å†™ATå›ºä»¶ã€‹</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/116032378">NodeMCU-åˆ·å†™ATå›ºä»¶</a></p><p>å½“ç„¶WIFIæ¨¡å—ä¹Ÿå¯ä»¥æ˜¯esp01.</p><ul><li>STC15 å•ç‰‡æœºé‡‡ç”¨çš„æ˜¯ï¼šSTC15F2K60S2 æ™¶æŒ¯é¢‘ç‡é‡‡ç”¨å†…éƒ¨ï¼š22.1184MHz</li></ul><p><code>STC15F2K60S2</code></p><p><code>22.1184</code></p><h4 id="ğŸŒ¼åŠŸèƒ½ä»‹ç»"><a href="#ğŸŒ¼åŠŸèƒ½ä»‹ç»" class="headerlink" title="ğŸŒ¼åŠŸèƒ½ä»‹ç»"></a>ğŸŒ¼åŠŸèƒ½ä»‹ç»</h4><p>é€šè¿‡ç”µè„‘ç«¯çš„ç½‘ç»œè°ƒè¯•åŠ©æ‰‹ï¼Œç»™å»ºç«‹TCPè¿æ¥ç«¯çš„esp8266å‘é€æŒ‡å®šçš„æ§åˆ¶æŒ‡ä»¤åï¼Œesp8266å°†æ”¶åˆ°çš„æ•°æ®é€šè¿‡ä¸²å£å‘ç»™STC15å•ç‰‡æœºï¼ŒSTC15å•ç‰‡æœºä¸²å£2å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä»è€Œå®ç°è¿œç¨‹æ§åˆ¶åŠŸèƒ½ã€‚STC15å¼€å¯åŒä¸²å£ï¼Œä¸²å£2ç”¨äºå’Œesp8266é€šè®¯ï¼Œä¸²å£1ç”¨äºæŸ¥çœ‹è°ƒè¯•ä¿¡æ¯ã€‚</p><p><img src="https://img-blog.csdnimg.cn/9b9b307c24e9440295956ffcfad840bb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“‘åŸç†å®ç°ä»‹ç»"><a href="#ğŸ“‘åŸç†å®ç°ä»‹ç»" class="headerlink" title="ğŸ“‘åŸç†å®ç°ä»‹ç»"></a>ğŸ“‘åŸç†å®ç°ä»‹ç»</h4><ul><li>ESP8266æ¨¡å—å•ç‹¬åˆ·å®ŒATå›ºä»¶åï¼Œåœ¨ç”µè„‘ç«¯å¼€å¯ä¸€ä¸ªTCPæœåŠ¡ç«¯ï¼Œç”¨äºç»™esp8266æ¥è¿æ¥çš„ã€‚esp8266çƒ§å½•å®ŒATå›ºä»¶åï¼Œé»˜è®¤ä¸²å£é€šè®¯æ³¢ç‰¹ç‡ä¸º115200ï¼Œesp8266ä¸²å£å’ŒSTC15å•ç‰‡æœºä¸²å£2ï¼ˆP10ï¼ŒP11ï¼‰ï¼Œè¿›è¡Œè¿æ¥ã€‚é€šè¿‡STC15å•ç‰‡æœºçš„ä¸²å£2å‘é€ç›¸å¯¹åº”TCPè¿æ¥ATæŒ‡ä»¤ç»™esp8266,æ¥ä¸»åŠ¨è¿æ¥ç”µè„‘ç«¯å¼€å¯çš„TCPæœåŠ¡ç«¯ã€‚å»ºç«‹è¿æ¥åï¼Œé€šè¿‡ç”µè„‘ç«¯çš„TCPæœåŠ¡ç«¯ç»™esp8266å‘é€æ•°æ®ï¼Œesp8266 TCPå®¢æˆ·ç«¯æ¥æ”¶åˆ°æ•°æ®åé€šè¿‡ä¸²å£å°†æ¥æ”¶åˆ°çš„æ•°æ®å‘ç»™stc15å•ç‰‡æœºã€‚</li></ul><p><code>115200</code></p><h4 id="ğŸé€šè®¯æ–¹å¼"><a href="#ğŸé€šè®¯æ–¹å¼" class="headerlink" title="ğŸé€šè®¯æ–¹å¼"></a>ğŸé€šè®¯æ–¹å¼</h4><ul><li><p>esp8266 â€”ä¸Šä½æœºè½¯ä»¶ï¼ˆç½‘ç»œè°ƒè¯•åŠ©æ‰‹ï¼‰é€šè¿‡å±€åŸŸç½‘TCPé€šè®¯</p></li><li><p>esp8266 â€”STC15å•ç‰‡æœºé€šè¿‡ä¸²å£é€šè®¯ã€‚</p></li><li><p>esp8266æ”¶åˆ°ä¸Šä½æœºè½¯ä»¶æ”¾è¿‡æ¥çš„æ•°æ®åï¼Œå°†æ•°æ®é€šè¿‡ä¸²å£å‘ç»™STC15å•ç‰‡æœºã€‚</p></li></ul><h4 id="ğŸ› ESP8266æ¨¡å—é…ç½®"><a href="#ğŸ› ESP8266æ¨¡å—é…ç½®" class="headerlink" title="ğŸ› ESP8266æ¨¡å—é…ç½®"></a>ğŸ› ESP8266æ¨¡å—é…ç½®</h4><ul><li>çƒ§å½•å®ŒATå›ºä»¶åï¼Œå°†ç½‘ç»œä¿¡æ¯é…ç½®åˆ°é‡Œé¢ï¼Œä¸ºä»€ä¹ˆä¸å°†é…ç½‘ä¿¡æ¯æ”¾åˆ°å•ç‰‡æœºé‡Œé¢æ˜¯å› ä¸ºæ¨¡å—é…ç½‘æ—¶é—´å¯èƒ½æ¯”è¾ƒé•¿ã€‚ï¼ˆå¦‚æœæƒ³æ”¾åˆ°stc15å•ç‰‡æœºç¨‹åºé‡Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªæ˜¯å¢åŠ 2æ¡å‘é€æŒ‡ä»¤è€Œå·²ï¼‰ã€‚</li><li>é€šè¿‡ä¸²å£å‘é€ATæŒ‡ä»¤ï¼Œæå‰å°†WIFIæ¥å…¥ä¿¡æ¯å­˜åˆ°esp8266ä¸­ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AT+CWMODE=1//é…ç½®STAæ¨¡å¼</span><br><span class="line">AT+CWJAP_DEF=&quot;MERCURY_D268G&quot;,&quot;pba5ayzk&quot;//é…ç½®WIFIï¼Œä¿¡æ¯æ‰ç”µä¸ä¸¢å¤±</span><br></pre></td></tr></table></figure><p><code>AT+CWMODE=1//é…ç½®STAæ¨¡å¼ AT+CWJAP_DEF=&quot;MERCURY_D268G&quot;,&quot;pba5ayzk&quot;//é…ç½®WIFIï¼Œä¿¡æ¯æ‰ç”µä¸ä¸¢å¤±</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Ai-Thinker Technology Co. Ltd.</span><br><span class="line"></span><br><span class="line">ready</span><br><span class="line">WIFI CONNECTED</span><br><span class="line">WIFI GOT IP</span><br><span class="line">AT+CWMODE=1</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">AT+CWJAP_DEF=&quot;MERCURY_D268G&quot;,&quot;pba5ayzk&quot;</span><br><span class="line">WIFI CONNECTED</span><br><span class="line">WIFI GOT IP</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p>&#96;Ai-Thinker Technology Co. Ltd.</p><p>ready<br>WIFI CONNECTED<br>WIFI GOT IP<br>AT+CWMODE&#x3D;1</p><p>OK<br>AT+CWJAP_DEF&#x3D;â€MERCURY_D268Gâ€,â€pba5ayzkâ€<br>WIFI CONNECTED<br>WIFI GOT IP</p><p>OK&#96;</p><p><img src="https://img-blog.csdnimg.cn/1a5c03e9f8f34842a3d1aa8793de63c8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/942aa62d2f3f4045a4e1cac96a799cc8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="â›³æ³¨æ„äº‹é¡¹"><a href="#â›³æ³¨æ„äº‹é¡¹" class="headerlink" title="â›³æ³¨æ„äº‹é¡¹"></a>â›³æ³¨æ„äº‹é¡¹</h4><ul><li>âš¡å¦‚æœåœ¨æ‰“å¼€ç½‘ç»œè°ƒè¯•åŠ©æ‰‹TCP serverä¸èƒ½æˆåŠŸè¿æ¥çš„æƒ…å†µï¼Œé‚£ä¹ˆè¯´æ˜é»˜è®¤çš„8080ç«¯å£è¢«å…¶ä»–é€šè®¯è¿æ¥å ç”¨äº†ï¼Œæ¢ä¸€ä¸ªç«¯å£å·å³å¯ã€‚æ”¹æˆå…¶ä»–çš„ç«¯å£å·ã€‚</li></ul><p><code>8080</code></p><p><img src="https://img-blog.csdnimg.cn/286aa4f93b3e49168b330f0fc443b245.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“ä¸»ç¨‹åºä»£ç "><a href="#ğŸ“ä¸»ç¨‹åºä»£ç " class="headerlink" title="ğŸ“ä¸»ç¨‹åºä»£ç "></a>ğŸ“ä¸»ç¨‹åºä»£ç </h4><ul><li>ğŸŒ¿å·¥ç¨‹æ¶æ„</li></ul><p><img src="https://img-blog.csdnimg.cn/84e93f8377bc4e25ae6c9988ec38c124.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;delay.h&quot;</span><br><span class="line">#include &quot;uart.h&quot;</span><br><span class="line">#include &quot;esp8266.h&quot;</span><br><span class="line"></span><br><span class="line">sbit led1 = P0 ^ 6;</span><br><span class="line">sbit led2 = P0 ^ 7;</span><br><span class="line"></span><br><span class="line">uint16 b;</span><br><span class="line">uint8 RE_Data;</span><br><span class="line">uint8 RE_flag = 0;</span><br><span class="line">void Uart2_Init(void);//P1.0/RxD_2,P1.1/TxD_2</span><br><span class="line">void Uart1_Init(void);//ä¸²å£1ï¼š115200bps@22.1184MHz</span><br><span class="line">/*********************å®šæ—¶å™¨å‡½æ•°************************************/</span><br><span class="line"></span><br><span class="line">void Timer0Init()       //2æ¯«ç§’@22.1184MHz</span><br><span class="line">&#123;</span><br><span class="line">    AUXR |= 0x80;       //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼</span><br><span class="line">    TMOD &amp;= 0xF0;       //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼</span><br><span class="line">    TL0 = 0x33;             //è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">    TH0 = 0x53;             //è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">    TF0 = 0;        //æ¸…é™¤TF0æ ‡å¿—</span><br><span class="line">    TR0 = 1;        //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void timer0() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">    TL0 = 0x33;             //è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">    TH0 = 0x53;             //è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">    TF0 = 0;</span><br><span class="line">    b++;</span><br><span class="line">    if (b &gt; 500)</span><br><span class="line">    &#123;</span><br><span class="line">        b = 0;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">//    Timer0Init();//åˆå§‹åŒ–å®šæ—¶å™¨0</span><br><span class="line">    ET0 = 1; //å¼€å¯å®šæ—¶å™¨0ä¸­æ–­</span><br><span class="line">    EA = 1; //å¼€å¯æ€»ä¸­æ–­</span><br><span class="line">    Delayus(6000);</span><br><span class="line">    P0M0 = 0X00;</span><br><span class="line">    P0M1 = 0X00;</span><br><span class="line">    P1M0 = 0X00;</span><br><span class="line">    P1M1 = 0X00;</span><br><span class="line">    P2M0 = 0X00;</span><br><span class="line">    P2M1 = 0X00;</span><br><span class="line">    P3M0 = 0X00;</span><br><span class="line">    P3M1 = 0X00;</span><br><span class="line">    P4M0 = 0X00;</span><br><span class="line">    P4M1 = 0X00;</span><br><span class="line">    Uart2_Init();</span><br><span class="line">    Uart1_Init();</span><br><span class="line">    ESP8266_Init();</span><br><span class="line">    led1 = 0;</span><br><span class="line">    led2 = 0;</span><br><span class="line">    while (1)</span><br><span class="line">    &#123;</span><br><span class="line">        if (RE_flag)</span><br><span class="line">        &#123;</span><br><span class="line">            UART1_SendStr(&amp;RE_Data);</span><br><span class="line">            RE_flag = 0;</span><br><span class="line">            if (RE_Data == &#x27;1&#x27;)</span><br><span class="line">            &#123;</span><br><span class="line">                led1 = 0;</span><br><span class="line">            &#125;</span><br><span class="line">            if (RE_Data == &#x27;2&#x27;)</span><br><span class="line">            &#123;</span><br><span class="line">                led1 = 1;</span><br><span class="line">            &#125;</span><br><span class="line">            if (RE_Data == &#x27;3&#x27;)</span><br><span class="line">            &#123;</span><br><span class="line">                led2 = 0;</span><br><span class="line">            &#125;</span><br><span class="line">            if (RE_Data == &#x27;4&#x27;)</span><br><span class="line">            &#123;</span><br><span class="line">                led2 = 1;</span><br><span class="line">            &#125;</span><br><span class="line">            if (RE_Data == &#x27;5&#x27;)</span><br><span class="line">            &#123;</span><br><span class="line">                led1 = 0;</span><br><span class="line">                led2 = 0;</span><br><span class="line">            &#125;</span><br><span class="line">            if (RE_Data == &#x27;6&#x27;)</span><br><span class="line">            &#123;</span><br><span class="line">                led1 = 1;</span><br><span class="line">                led2 = 1;</span><br><span class="line">            &#125;</span><br><span class="line">RE_Data=0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*----------------------------</span><br><span class="line">UART ä¸­æ–­æœåŠ¡ç¨‹åº</span><br><span class="line">-----------------------------*/</span><br><span class="line">void Uart() interrupt 4</span><br><span class="line">&#123;</span><br><span class="line">    if (RI)</span><br><span class="line">    &#123;</span><br><span class="line">        RI = 0;                 //æ¸…é™¤RIä½</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    if (TI)</span><br><span class="line">    &#123;</span><br><span class="line">        TI = 0;                 //æ¸…é™¤TIä½</span><br><span class="line">        UART1_busy = 0;               //æ¸…å¿™æ ‡å¿—</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Uart2() interrupt 8 using 1</span><br><span class="line">&#123;</span><br><span class="line">    static  uint8 a = 0, value = 0;</span><br><span class="line"></span><br><span class="line">    if (S2CON &amp; S2RI)</span><br><span class="line">    &#123;</span><br><span class="line">        S2CON &amp;= ~S2RI;   //æ¸…é™¤S2RI</span><br><span class="line">        value = S2BUF;</span><br><span class="line">        if (value == &#x27;:&#x27;) //æ¥æ”¶åˆ°&quot;48:&quot;æ—¶ï¼Œè¯´æ˜åé¢çš„å°±æ˜¯æ—¶é—´æŠ¥æ–‡äº†</span><br><span class="line">        &#123;</span><br><span class="line">            a = 1;</span><br><span class="line">        &#125;</span><br><span class="line">        if (a == 1)</span><br><span class="line">        &#123;</span><br><span class="line">            num++;</span><br><span class="line">            if (num == 2)</span><br><span class="line">            &#123;</span><br><span class="line">                RE_Data = S2BUF;</span><br><span class="line">                num = 0;</span><br><span class="line">                a = 0;</span><br><span class="line">                RE_flag = 1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (S2CON &amp; S2TI)</span><br><span class="line">    &#123;</span><br><span class="line">        S2CON &amp;= ~S2TI;         //æ¸…é™¤S2TIä½</span><br><span class="line">        UART2_busy = 0;               //æ¸…å¿™æ ‡å¿—</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œdelay.hâ€<br>#include â€œuart.hâ€<br>#include â€œesp8266.hâ€</p><p>sbit led1 &#x3D; P0 ^ 6;<br>sbit led2 &#x3D; P0 ^ 7;</p><p>uint16 b;<br>uint8 RE_Data;<br>uint8 RE_flag &#x3D; 0;<br>void Uart2_Init(void);&#x2F;&#x2F;P1.0&#x2F;RxD_2,P1.1&#x2F;TxD_2<br>void Uart1_Init(void);&#x2F;&#x2F;ä¸²å£1ï¼š<a href="mailto:&#x31;&#49;&#53;&#x32;&#x30;&#48;&#98;&#112;&#115;&#64;&#x32;&#50;&#46;&#49;&#x31;&#x38;&#52;&#x4d;&#72;&#x7a;">&#x31;&#49;&#53;&#x32;&#x30;&#48;&#98;&#112;&#115;&#64;&#x32;&#50;&#46;&#49;&#x31;&#x38;&#52;&#x4d;&#72;&#x7a;</a><br>&#x2F;<em><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>å®šæ—¶å™¨å‡½æ•°</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></em>***************&#x2F;</p><p>void Timer0Init()       &#x2F;&#x2F;2æ¯«ç§’@22.1184MHz<br>{<br>    AUXR |&#x3D; 0x80;       &#x2F;&#x2F;å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼<br>    TMOD &amp;&#x3D; 0xF0;       &#x2F;&#x2F;è®¾ç½®å®šæ—¶å™¨æ¨¡å¼<br>    TL0 &#x3D; 0x33;             &#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TH0 &#x3D; 0x53;             &#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TF0 &#x3D; 0;        &#x2F;&#x2F;æ¸…é™¤TF0æ ‡å¿—<br>    TR0 &#x3D; 1;        &#x2F;&#x2F;å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶<br>}</p><p>void timer0() interrupt 1<br>{<br>    TL0 &#x3D; 0x33;             &#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TH0 &#x3D; 0x53;             &#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TF0 &#x3D; 0;<br>    b++;<br>    if (b &gt; 500)<br>    {<br>        b &#x3D; 0;</p><pre><code>&#125;</code></pre><p>}</p><p>void main()<br>{<br>&#x2F;&#x2F;    Timer0Init();&#x2F;&#x2F;åˆå§‹åŒ–å®šæ—¶å™¨0<br>    ET0 &#x3D; 1; &#x2F;&#x2F;å¼€å¯å®šæ—¶å™¨0ä¸­æ–­<br>    EA &#x3D; 1; &#x2F;&#x2F;å¼€å¯æ€»ä¸­æ–­<br>    Delayus(6000);<br>    P0M0 &#x3D; 0X00;<br>    P0M1 &#x3D; 0X00;<br>    P1M0 &#x3D; 0X00;<br>    P1M1 &#x3D; 0X00;<br>    P2M0 &#x3D; 0X00;<br>    P2M1 &#x3D; 0X00;<br>    P3M0 &#x3D; 0X00;<br>    P3M1 &#x3D; 0X00;<br>    P4M0 &#x3D; 0X00;<br>    P4M1 &#x3D; 0X00;<br>    Uart2_Init();<br>    Uart1_Init();<br>    ESP8266_Init();<br>    led1 &#x3D; 0;<br>    led2 &#x3D; 0;<br>    while (1)<br>    {<br>        if (RE_flag)<br>        {<br>            UART1_SendStr(&amp;RE_Data);<br>            RE_flag &#x3D; 0;<br>            if (RE_Data &#x3D;&#x3D; â€˜1â€™)<br>            {<br>                led1 &#x3D; 0;<br>            }<br>            if (RE_Data &#x3D;&#x3D; â€˜2â€™)<br>            {<br>                led1 &#x3D; 1;<br>            }<br>            if (RE_Data &#x3D;&#x3D; â€˜3â€™)<br>            {<br>                led2 &#x3D; 0;<br>            }<br>            if (RE_Data &#x3D;&#x3D; â€˜4â€™)<br>            {<br>                led2 &#x3D; 1;<br>            }<br>            if (RE_Data &#x3D;&#x3D; â€˜5â€™)<br>            {<br>                led1 &#x3D; 0;<br>                led2 &#x3D; 0;<br>            }<br>            if (RE_Data &#x3D;&#x3D; â€˜6â€™)<br>            {<br>                led1 &#x3D; 1;<br>                led2 &#x3D; 1;<br>            }<br>                    RE_Data&#x3D;0;<br>        }<br>    }<br>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”-<br>UART ä¸­æ–­æœåŠ¡ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</em>&#x2F;<br>void Uart() interrupt 4<br>{<br>    if (RI)<br>    {<br>        RI &#x3D; 0;                 &#x2F;&#x2F;æ¸…é™¤RIä½</p><pre><code>&#125;if (TI)&#123;    TI = 0;                 //æ¸…é™¤TIä½    UART1_busy = 0;               //æ¸…å¿™æ ‡å¿—&#125;</code></pre><p>}</p><p>void Uart2() interrupt 8 using 1<br>{<br>    static  uint8 a &#x3D; 0, value &#x3D; 0;</p><pre><code>if (S2CON &amp; S2RI)&#123;    S2CON &amp;= ~S2RI;   //æ¸…é™¤S2RI    value = S2BUF;    if (value == &#39;:&#39;) //æ¥æ”¶åˆ°&quot;48:&quot;æ—¶ï¼Œè¯´æ˜åé¢çš„å°±æ˜¯æ—¶é—´æŠ¥æ–‡äº†    &#123;        a = 1;    &#125;    if (a == 1)    &#123;        num++;        if (num == 2)        &#123;            RE_Data = S2BUF;            num = 0;            a = 0;            RE_flag = 1;        &#125;    &#125;&#125;if (S2CON &amp; S2TI)&#123;    S2CON &amp;= ~S2TI;         //æ¸…é™¤S2TIä½    UART2_busy = 0;               //æ¸…å¿™æ ‡å¿—&#125;</code></pre><p>}&#96;</p><h4 id="ğŸ“šå·¥ç¨‹æºç "><a href="#ğŸ“šå·¥ç¨‹æºç " class="headerlink" title="ğŸ“šå·¥ç¨‹æºç "></a>ğŸ“šå·¥ç¨‹æºç </h4><ul><li>ğŸ“åŒ…å«ç½‘ç»œè°ƒè¯•åŠ©æ‰‹</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥: https://pan.baidu.com/s/1IxLv8_0TPdnaCJGDFXudKQ</span><br><span class="line">æå–ç : evu2</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥: https://pan.baidu.com/s/1IxLv8_0TPdnaCJGDFXudKQ æå–ç : evu2</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC15å•ç‰‡æœº+DHT11+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º</title>
      <link href="/2024/03/Stc15-STC15%E5%8D%95%E7%89%87%E6%9C%BADHT11LCD1602PCF8574%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E6%B8%A9%E5%BA%A6%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Stc15-STC15%E5%8D%95%E7%89%87%E6%9C%BADHT11LCD1602PCF8574%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E6%B8%A9%E5%BA%A6%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC15å•ç‰‡æœº-DHT11-LCD1602-PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º"><a href="#STC15å•ç‰‡æœº-DHT11-LCD1602-PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º" class="headerlink" title="STC15å•ç‰‡æœº+DHT11+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º"></a>STC15å•ç‰‡æœº+DHT11+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º</h1><h3 id="STC15å•ç‰‡æœº-DHT11-LCD1602-PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º-1"><a href="#STC15å•ç‰‡æœº-DHT11-LCD1602-PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º-1" class="headerlink" title="STC15å•ç‰‡æœº+DHT11+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º"></a>STC15å•ç‰‡æœº+DHT11+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º</h3><ul><li>ğŸ“ºæ•ˆæœæ¼”ç¤ºï¼š</li><li>ğŸŒ¿LCD1602+PCF8574è½¬IICæ¥å£å±å¹•</li><li>ğŸŒ¿DHT11æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨</li></ul><p><img src="https://img-blog.csdnimg.cn/4c6212081a8844678e988c342d285d77.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/6e0117743c2846b6a1d8ab881a01844b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/cf01c46c02f94e03814fd2dbadab36de.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ¬ç¤ºä¾‹åŸºäºè‡ªåˆ¶çš„STCå¼€å‘æ¿ï¼Œä¸»æ§é‡‡ç”¨çš„ï¼šIAP15W4K61S4</p><p><code>IAP15W4K61S4</code></p><ul><li>ç›¸å…³ç¯‡ã€Šã€PCBå¼€æºåˆ†äº«ã€‘STC&#x2F;IAP15W4K61S4å¼€å‘æ¿ã€‹</li><li>ã€Šã€å¼€æºåˆ†äº«ã€‘è‡ªåˆ¶STC15W408ASå¼€å‘æ¿ã€‹</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/126185155">ã€PCBå¼€æºåˆ†äº«ã€‘STC&#x2F;IAP15W4K61S4å¼€å‘æ¿</a></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/122150323">ã€å¼€æºåˆ†äº«ã€‘è‡ªåˆ¶STC15W408ASå¼€å‘æ¿</a></p><h4 id="ğŸŒ¼æ¥çº¿è¯´æ˜"><a href="#ğŸŒ¼æ¥çº¿è¯´æ˜" class="headerlink" title="ğŸŒ¼æ¥çº¿è¯´æ˜"></a>ğŸŒ¼æ¥çº¿è¯´æ˜</h4><ul><li>ğŸŒ´LCD1602+PCF8574è½¬IICæ¥å£</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SCL -----&gt; STC15 P1.0</span><br><span class="line">SDA -----&gt; STC15 P1.1</span><br></pre></td></tr></table></figure><p><code>SCL -----&gt; STC15 P1.0 SDA -----&gt; STC15 P1.1</code></p><ul><li>ğŸŒ´DHT11</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DATA -----&gt; P1.3</span><br></pre></td></tr></table></figure><p><code>DATA -----&gt; P1.3</code></p><ul><li>âœ…å·¥ç¨‹æ¶æ„</li></ul><p><img src="https://img-blog.csdnimg.cn/b2a2b44ba25c4e419abcf6ce5a1981e1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“ä¸»ç¨‹åºä»£ç "><a href="#ğŸ“ä¸»ç¨‹åºä»£ç " class="headerlink" title="ğŸ“ä¸»ç¨‹åºä»£ç "></a>ğŸ“ä¸»ç¨‹åºä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">#include &quot;lcd1602.h&quot;</span><br><span class="line">#include &quot;delay.h&quot;</span><br><span class="line">#include &quot;dht11.h&quot;</span><br><span class="line">//#include &lt;STC15F2K60S2.H&gt;</span><br><span class="line"></span><br><span class="line">//#define uchar unsigned char</span><br><span class="line">//#define uint unsigned int</span><br><span class="line"></span><br><span class="line">sfr P0M1 = 0x93;</span><br><span class="line">sfr P0M0 = 0x94;</span><br><span class="line">sfr P1M1 = 0x91;</span><br><span class="line">sfr P1M0 = 0x92;</span><br><span class="line">sfr P2M1 = 0x95;</span><br><span class="line">sfr P2M0 = 0x96;</span><br><span class="line">sfr P3M1 = 0xb1;</span><br><span class="line">sfr P3M0 = 0xb2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extern unsigned char rec_dat[4];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line"></span><br><span class="line">    float tem = 0.0,hum = 0.0;</span><br><span class="line">    unsigned char Tempbuf[5],Humbuf[8];</span><br><span class="line">P0M0 = 0x00;</span><br><span class="line">    P0M1 = 0x00;</span><br><span class="line">    P1M0 = 0x00;</span><br><span class="line">    P1M1 = 0x00;</span><br><span class="line">    P2M0 = 0x00;</span><br><span class="line">    P2M1 = 0x00;</span><br><span class="line">    P3M0 = 0x00;</span><br><span class="line">    P3M1 = 0x00;</span><br><span class="line">    Init_Lcd();</span><br><span class="line"></span><br><span class="line">    led = 0;</span><br><span class="line">    led2 = 0;</span><br><span class="line">DHT11_receive();//æ¥æ”¶DHT11æ•°æ®</span><br><span class="line">delay1(2000);</span><br><span class="line">    while(1) &#123;</span><br><span class="line">        DHT11_receive();//æ¥æ”¶DHT11æ•°æ®</span><br><span class="line">if(led)</span><br><span class="line">&#123;</span><br><span class="line">        hum = rec_dat[0] + rec_dat[1]*0.1;//æ¹¿åº¦</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        tem = rec_dat[2];</span><br><span class="line">if(rec_dat[2] &amp; 0x80)&#123;</span><br><span class="line">tem = -1 - tem;//é›¶åº¦ä»¥ä¸‹</span><br><span class="line">&#125;</span><br><span class="line">tem += (rec_dat[3] &amp; 0x0f)*0.1;//æ¸©åº¦</span><br><span class="line"></span><br><span class="line">        sprintf(Tempbuf, &quot;%2.1f&quot;,tem);</span><br><span class="line">        sprintf(Humbuf, &quot;%2.1f%%RH&quot;, hum);</span><br><span class="line">led =0;</span><br><span class="line">LCD_write_command(0x01); // æ¸…å±</span><br><span class="line">&#125;</span><br><span class="line">Write_LCD(3, 1, &quot;Temp:&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">        Write_LCD(3, 0, &quot;Hum:&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">        Write_LCD(7, 0, Humbuf);</span><br><span class="line">        Write_LCD(8, 1, Tempbuf);</span><br><span class="line">LCD_write_data(0xdf);</span><br><span class="line">  LCD_write_data(&#x27;C&#x27;);</span><br><span class="line">delay1(2000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œstdio.hâ€<br>#include â€œlcd1602.hâ€<br>#include â€œdelay.hâ€<br>#include â€œdht11.hâ€<br>&#x2F;&#x2F;#include &lt;STC15F2K60S2.H&gt;</p><p>&#x2F;&#x2F;#define uchar unsigned char<br>&#x2F;&#x2F;#define uint unsigned int</p><p>sfr P0M1 &#x3D; 0x93;<br>sfr P0M0 &#x3D; 0x94;<br>sfr P1M1 &#x3D; 0x91;<br>sfr P1M0 &#x3D; 0x92;<br>sfr P2M1 &#x3D; 0x95;<br>sfr P2M0 &#x3D; 0x96;<br>sfr P3M1 &#x3D; 0xb1;<br>sfr P3M0 &#x3D; 0xb2;</p><p>extern unsigned char rec_dat[4];</p><p>void main() {</p><pre><code>float tem = 0.0,hum = 0.0;unsigned char Tempbuf[5],Humbuf[8];    P0M0 = 0x00;P0M1 = 0x00;P1M0 = 0x00;P1M1 = 0x00;P2M0 = 0x00;P2M1 = 0x00;P3M0 = 0x00;P3M1 = 0x00;Init_Lcd();led = 0;led2 = 0;DHT11_receive();//æ¥æ”¶DHT11æ•°æ®delay1(2000);while(1) &#123;    DHT11_receive();//æ¥æ”¶DHT11æ•°æ®            if(led)            &#123;    hum = rec_dat[0] + rec_dat[1]*0.1;//æ¹¿åº¦            tem = rec_dat[2];            if(rec_dat[2] &amp; 0x80)&#123;                    tem = -1 - tem;//é›¶åº¦ä»¥ä¸‹            &#125;            tem += (rec_dat[3] &amp; 0x0f)*0.1;//æ¸©åº¦                    sprintf(Tempbuf, &quot;%2.1f&quot;,tem);    sprintf(Humbuf, &quot;%2.1f%%RH&quot;, hum);                led =0;                LCD_write_command(0x01); // æ¸…å±            &#125;            Write_LCD(3, 1, &quot;Temp:&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²    Write_LCD(3, 0, &quot;Hum:&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²    Write_LCD(7, 0, Humbuf);    Write_LCD(8, 1, Tempbuf);            LCD_write_data(0xdf);          LCD_write_data(&#39;C&#39;);            delay1(2000);&#125;</code></pre><p>}&#96;</p><h4 id="ğŸ“šç¨‹åºæºç "><a href="#ğŸ“šç¨‹åºæºç " class="headerlink" title="ğŸ“šç¨‹åºæºç "></a>ğŸ“šç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1vYY_NhLntjBH5kNaZekhzg </span><br><span class="line">æå–ç ï¼š04l7</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1vYY_NhLntjBH5kNaZekhzg  æå–ç ï¼š04l7</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STC15å•ç‰‡æœº+DS18B20+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º</title>
      <link href="/2024/03/Stc15-STC15%E5%8D%95%E7%89%87%E6%9C%BADS18B20LCD1602PCF8574%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E6%B8%A9%E5%BA%A6%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Stc15-STC15%E5%8D%95%E7%89%87%E6%9C%BADS18B20LCD1602PCF8574%E8%BD%ACIIC%E6%8E%A5%E5%8F%A3%E6%B8%A9%E5%BA%A6%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="STC15å•ç‰‡æœº-DS18B20-LCD1602-PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º"><a href="#STC15å•ç‰‡æœº-DS18B20-LCD1602-PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º" class="headerlink" title="STC15å•ç‰‡æœº+DS18B20+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º"></a>STC15å•ç‰‡æœº+DS18B20+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º</h1><h3 id="STC15å•ç‰‡æœº-DS18B20-LCD1602-PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º-1"><a href="#STC15å•ç‰‡æœº-DS18B20-LCD1602-PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º-1" class="headerlink" title="STC15å•ç‰‡æœº+DS18B20+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º"></a>STC15å•ç‰‡æœº+DS18B20+LCD1602+PCF8574è½¬IICæ¥å£æ¸©åº¦æ˜¾ç¤º</h3><ul><li>ğŸ“ºæ˜¾ç¤ºæ•ˆæœ</li><li>ğŸŒ¼LCD1602 IICæ¥å£</li></ul><p><img src="https://img-blog.csdnimg.cn/afba56693cd54598a0caa5dced61df72.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/045f1d33c3d0404f9e19b37d9d01ed6f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>âœ¨æœ¬ç¤ºä¾‹åŸºäºè‡ªåˆ¶çš„STCå¼€å‘æ¿ï¼Œä¸»æ§é‡‡ç”¨çš„ï¼šIAP15W4K61S4</li></ul><p><code>IAP15W4K61S4</code></p><ul><li>ç›¸å…³ç¯‡ã€Šã€PCBå¼€æºåˆ†äº«ã€‘STC&#x2F;IAP15W4K61S4å¼€å‘æ¿ã€‹</li><li>ã€Šã€å¼€æºåˆ†äº«ã€‘è‡ªåˆ¶STC15W408ASå¼€å‘æ¿ã€‹</li></ul><p><a href="https://blog.csdn.net/weixin_42880082/article/details/126185155">ã€PCBå¼€æºåˆ†äº«ã€‘STC&#x2F;IAP15W4K61S4å¼€å‘æ¿</a></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/122150323">ã€å¼€æºåˆ†äº«ã€‘è‡ªåˆ¶STC15W408ASå¼€å‘æ¿</a></p><h4 id="ğŸŒ¼æ¥çº¿è¯´æ˜"><a href="#ğŸŒ¼æ¥çº¿è¯´æ˜" class="headerlink" title="ğŸŒ¼æ¥çº¿è¯´æ˜"></a>ğŸŒ¼æ¥çº¿è¯´æ˜</h4><ul><li>ğŸŒ¿CD1602+PCF8574è½¬IICæ¥å£</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SCL -----&gt; STC15 P1.0</span><br><span class="line">SDA -----&gt; STC15 P1.1</span><br></pre></td></tr></table></figure><p><code>SCL -----&gt; STC15 P1.0 SDA -----&gt; STC15 P1.1</code></p><ul><li>ğŸŒ¿DS18B20</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data--- STC P1.3</span><br></pre></td></tr></table></figure><p><code>data--- STC P1.3</code></p><ul><li>ğŸš©STC-ISPä¸‹è½½æ˜¯é€‰æ‹©å†…éƒ¨æ—¶é’Ÿï¼Œé¢‘ç‡è®¾ç½®ä¸º11.0592MHz</li></ul><p><code>11.0592</code></p><p><img src="https://img-blog.csdnimg.cn/08d7920bcc27400a8aecc7cc9b22127a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="â›³æ³¨æ„äº‹é¡¹"><a href="#â›³æ³¨æ„äº‹é¡¹" class="headerlink" title="â›³æ³¨æ„äº‹é¡¹"></a>â›³æ³¨æ„äº‹é¡¹</h4><ul><li>ğŸš©å¦‚æœä½¿ç”¨IAP15W4K61S4-30I-På•ç‰‡æœºä½¿ç”¨P1.2ä½œä¸ºåŸºå‡†ç”µå‹è¾“å…¥å¼•è„šè¯·é¿å¼€ã€‚</li><li>ğŸš©æ‰€ä½¿èƒ½çš„DS18B20å¼•è„šï¼Œéœ€è¦åœ¨mainå‡½æ•°ä¸­ï¼Œé…ç½®ä¸ºå‡†åŒå‘IOæ¨¡å¼ï¼Œå¦åˆ™è¯»ä¸åˆ°æ•°æ®ã€‚</li></ul><p><code>IAP15W4K61S4-30I-P</code></p><p><code>P1.2</code></p><ul><li>ç»æµ‹è¯•,ç¨‹åºä¸åšä»»ä½•ä¿®æ”¹åœ¨STC12C5A60S2ä¸Šä¹Ÿèƒ½è¯»å–æˆåŠŸã€‚STC12å±äºY3æŒ‡ä»¤é›†çš„ï¼Œè€Œstc15å±äºY5æŒ‡ä»¤é›†çš„ã€‚</li></ul><p><code>STC12C5A60S2</code></p><p><img src="https://img-blog.csdnimg.cn/5701162012b64f6a88ef81a9c07e01c8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/0c6ef9b8518145e4b122d17f96523349.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/5ea3571853c04704b43b4b9bd7b7c2af.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="å¦‚æœé¡¹åœ¨STC12ä¸Šè¿è¡Œæœ€å¥½è¿˜æ˜¯ä¿®æ”¹ä¸€ä¸‹å¾®ç§’å»¶æ—¶ï¼Œå‚ç…§ä¸Šé¢ã€‚åœ¨stc12ä¸Šè·‘æ­¤ä»£ç å¦‚æœéœ€è¦ä¸²å£è¾“å‡ºï¼Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä¸²å£é…ç½®ï¼š"><a href="#å¦‚æœé¡¹åœ¨STC12ä¸Šè¿è¡Œæœ€å¥½è¿˜æ˜¯ä¿®æ”¹ä¸€ä¸‹å¾®ç§’å»¶æ—¶ï¼Œå‚ç…§ä¸Šé¢ã€‚åœ¨stc12ä¸Šè·‘æ­¤ä»£ç å¦‚æœéœ€è¦ä¸²å£è¾“å‡ºï¼Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä¸²å£é…ç½®ï¼š" class="headerlink" title="å¦‚æœé¡¹åœ¨STC12ä¸Šè¿è¡Œæœ€å¥½è¿˜æ˜¯ä¿®æ”¹ä¸€ä¸‹å¾®ç§’å»¶æ—¶ï¼Œå‚ç…§ä¸Šé¢ã€‚åœ¨stc12ä¸Šè·‘æ­¤ä»£ç å¦‚æœéœ€è¦ä¸²å£è¾“å‡ºï¼Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä¸²å£é…ç½®ï¼š"></a>å¦‚æœé¡¹åœ¨STC12ä¸Šè¿è¡Œæœ€å¥½è¿˜æ˜¯ä¿®æ”¹ä¸€ä¸‹å¾®ç§’å»¶æ—¶ï¼Œå‚ç…§ä¸Šé¢ã€‚åœ¨stc12ä¸Šè·‘æ­¤ä»£ç å¦‚æœéœ€è¦ä¸²å£è¾“å‡ºï¼Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ä¸²å£é…ç½®ï¼š</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SCON = 0x50;                //8ä½å¯å˜æ³¢ç‰¹ç‡</span><br><span class="line">    AUXR = 0x40;                //å®šæ—¶å™¨1ä¸º1Tæ¨¡å¼</span><br><span class="line">AUXR &amp;= 0xFE;//ä¸²å£1é€‰æ‹©å®šæ—¶å™¨1ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨</span><br><span class="line">TMOD &amp;= 0x0F;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼</span><br><span class="line">TMOD |= 0x20;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼</span><br><span class="line">TL1 = 0xFD;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TH1 = 0xFD;//è®¾ç½®å®šæ—¶é‡è½½å€¼</span><br></pre></td></tr></table></figure><p><code>SCON = 0x50;                //8ä½å¯å˜æ³¢ç‰¹ç‡     AUXR = 0x40;                //å®šæ—¶å™¨1ä¸º1Tæ¨¡å¼     AUXR &amp;= 0xFE;//ä¸²å£1é€‰æ‹©å®šæ—¶å™¨1ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨     TMOD &amp;= 0x0F;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼     TMOD |= 0x20;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼     TL1 = 0xFD;//è®¾ç½®å®šæ—¶åˆå§‹å€¼     TH1 = 0xFD;//è®¾ç½®å®šæ—¶é‡è½½å€¼</code></p><ul><li>ğŸŒ¿å·¥ç¨‹æ¶æ„</li></ul><p><img src="https://img-blog.csdnimg.cn/5b43fef28a414fc09d5c7495f7b14561.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“ä¸»ç¨‹åºä»£ç "><a href="#ğŸ“ä¸»ç¨‹åºä»£ç " class="headerlink" title="ğŸ“ä¸»ç¨‹åºä»£ç "></a>ğŸ“ä¸»ç¨‹åºä»£ç </h4><p>æ¸©åº¦æ•°æ®ä¹Ÿä¼šä»ä¸²å£æ‰“å°è¾“å‡ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">#include &quot;lcd1602.h&quot;</span><br><span class="line">#include &quot;delay.h&quot;</span><br><span class="line">#include &quot;DS18B20.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#define FOSC 11059200L          //ç³»ç»Ÿé¢‘ç‡</span><br><span class="line">#define BAUD 115200             //ä¸²å£æ³¢ç‰¹ç‡</span><br><span class="line"></span><br><span class="line">#define NONE_PARITY     0       //æ— æ ¡éªŒ</span><br><span class="line">#define ODD_PARITY      1       //å¥‡æ ¡éªŒ</span><br><span class="line">#define EVEN_PARITY     2       //å¶æ ¡éªŒ</span><br><span class="line">#define MARK_PARITY     3       //æ ‡è®°æ ¡éªŒ</span><br><span class="line">#define SPACE_PARITY    4       //ç©ºç™½æ ¡éªŒ</span><br><span class="line"></span><br><span class="line">#define PARITYBIT NONE_PARITY   //å®šä¹‰æ ¡éªŒä½</span><br><span class="line"></span><br><span class="line">sfr AUXR  = 0x8e;               //è¾…åŠ©å¯„å­˜å™¨</span><br><span class="line"></span><br><span class="line">sfr P_SW1   = 0xA2;             //å¤–è®¾åŠŸèƒ½åˆ‡æ¢å¯„å­˜å™¨1</span><br><span class="line"></span><br><span class="line">#define S1_S0 0x40              //P_SW1.6</span><br><span class="line">#define S1_S1 0x80              //P_SW1.7</span><br><span class="line">bit busy;</span><br><span class="line"></span><br><span class="line">sbit led = P1^5;//DHTå“åº”æŒ‡ç¤ºç¯</span><br><span class="line">sbit led2 = P1^6;//æ•ˆéªŒæ•°æ®æŒ‡ç¤ºç¯</span><br><span class="line"></span><br><span class="line">sfr P0M1 = 0x93;</span><br><span class="line">sfr P0M0 = 0x94;</span><br><span class="line">sfr P1M1 = 0x91;</span><br><span class="line">sfr P1M0 = 0x92;</span><br><span class="line">sfr P2M1 = 0x95;</span><br><span class="line">sfr P2M0 = 0x96;</span><br><span class="line">sfr P3M1 = 0xb1;</span><br><span class="line">sfr P3M0 = 0xb2;</span><br><span class="line"></span><br><span class="line">extern unsigned char MinusFlag;</span><br><span class="line">//*************************************** åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸² *************************************</span><br><span class="line"></span><br><span class="line">void SendData(unsigned char dat);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line"></span><br><span class="line">   float  tem = 0.0;</span><br><span class="line">unsigned char Tempbuf[5];</span><br><span class="line"></span><br><span class="line">    P0M0 = 0x00;</span><br><span class="line">    P0M1 = 0x00;</span><br><span class="line">    P1M0 = 0x00;</span><br><span class="line">    P1M1 = 0x00;</span><br><span class="line">    P2M0 = 0x00;</span><br><span class="line">    P2M1 = 0x00;</span><br><span class="line">    P3M0 = 0x00;</span><br><span class="line">    P3M1 = 0x00;</span><br><span class="line"></span><br><span class="line"> ACC = P_SW1;</span><br><span class="line">    ACC &amp;= ~(S1_S0 | S1_S1);    //S1_S0=0 S1_S1=0</span><br><span class="line">    P_SW1 = ACC;                //(P3.0/RxD, P3.1/TxD)</span><br><span class="line">    </span><br><span class="line">    SCON = 0x50;                //8ä½å¯å˜æ³¢ç‰¹ç‡</span><br><span class="line"></span><br><span class="line">    AUXR = 0x40;                //å®šæ—¶å™¨1ä¸º1Tæ¨¡å¼</span><br><span class="line">    TMOD = 0x00;                //å®šæ—¶å™¨1ä¸ºæ¨¡å¼0(16ä½è‡ªåŠ¨é‡è½½)</span><br><span class="line">    TL1 = (65536 - (FOSC/4/BAUD));   //è®¾ç½®æ³¢ç‰¹ç‡é‡è£…å€¼</span><br><span class="line">    TH1 = (65536 - (FOSC/4/BAUD))&gt;&gt;8;</span><br><span class="line">    TR1 = 1;                    //å®šæ—¶å™¨1å¼€å§‹å¯åŠ¨</span><br><span class="line">    ES = 1;                     //ä½¿èƒ½ä¸²å£ä¸­æ–­</span><br><span class="line">    EA = 1;</span><br><span class="line">    Init_Lcd();</span><br><span class="line"></span><br><span class="line">    led = 0;</span><br><span class="line">    led2 = 0;</span><br><span class="line"></span><br><span class="line">    while(1) &#123;</span><br><span class="line">delayms(2000);</span><br><span class="line">tem=(float)ReadTemperature();  //è¯»å–æ¸©åº¦</span><br><span class="line">tem= tem*0.1;</span><br><span class="line">printf(&quot;Temp=%.1f&quot;,tem);</span><br><span class="line">LCD_write_command(0x01); // æ¸…å±</span><br><span class="line">if(MinusFlag)  //è´Ÿæ•°æ ‡å¿—</span><br><span class="line">&#123;</span><br><span class="line">Write_LCD(5, 0, &quot;-&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">Write_LCD(5, 0, &quot; &quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Write_LCD(0, 0, &quot;Temp:&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²</span><br><span class="line"> sprintf(Tempbuf, &quot;%2.1f&quot;,tem);</span><br><span class="line">Write_LCD(6, 0, Tempbuf);</span><br><span class="line">LCD_write_data(0xdf);</span><br><span class="line">  LCD_write_data(&#x27;C&#x27;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*----------------------------</span><br><span class="line">UART ä¸­æ–­æœåŠ¡ç¨‹åº</span><br><span class="line">-----------------------------*/</span><br><span class="line">void Uart() interrupt 4</span><br><span class="line">&#123;</span><br><span class="line">//    if (RI)</span><br><span class="line">//    &#123;</span><br><span class="line">//        RI = 0;                 //æ¸…é™¤RIä½</span><br><span class="line">//        P0 = SBUF;              //P0æ˜¾ç¤ºä¸²å£æ•°æ®</span><br><span class="line">//    &#125;</span><br><span class="line">    if (TI)</span><br><span class="line">    &#123;</span><br><span class="line">        TI = 0;                 //æ¸…é™¤TIä½</span><br><span class="line">        busy = 0;               //æ¸…å¿™æ ‡å¿—</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*----------------------------</span><br><span class="line">å‘é€ä¸²å£æ•°æ®</span><br><span class="line">----------------------------*/</span><br><span class="line">void SendData(unsigned char dat)</span><br><span class="line">&#123;</span><br><span class="line">    while (busy);               //ç­‰å¾…å‰é¢çš„æ•°æ®å‘é€å®Œæˆ</span><br><span class="line">    ACC = dat;                  //è·å–æ ¡éªŒä½P (PSW.0)</span><br><span class="line">    if (P)                      //æ ¹æ®Pæ¥è®¾ç½®æ ¡éªŒä½</span><br><span class="line">    &#123;</span><br><span class="line">#if (PARITYBIT == ODD_PARITY)</span><br><span class="line">        TB8 = 0;                //è®¾ç½®æ ¡éªŒä½ä¸º0</span><br><span class="line">#elif (PARITYBIT == EVEN_PARITY)</span><br><span class="line">        TB8 = 1;                //è®¾ç½®æ ¡éªŒä½ä¸º1</span><br><span class="line">#endif</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">#if (PARITYBIT == ODD_PARITY)</span><br><span class="line">        TB8 = 1;                //è®¾ç½®æ ¡éªŒä½ä¸º1</span><br><span class="line">#elif (PARITYBIT == EVEN_PARITY)</span><br><span class="line">        TB8 = 0;                //è®¾ç½®æ ¡éªŒä½ä¸º0</span><br><span class="line">#endif</span><br><span class="line">    &#125;</span><br><span class="line">    busy = 1;</span><br><span class="line">    SBUF = ACC;                 //å†™æ•°æ®åˆ°UARTæ•°æ®å¯„å­˜å™¨</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">char putchar(char c)</span><br><span class="line">&#123;</span><br><span class="line">SendData(c);</span><br><span class="line">return c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œstdio.hâ€<br>#include â€œlcd1602.hâ€<br>#include â€œdelay.hâ€<br>#include â€œDS18B20.hâ€</p><p>#define FOSC 11059200L          &#x2F;&#x2F;ç³»ç»Ÿé¢‘ç‡<br>#define BAUD 115200             &#x2F;&#x2F;ä¸²å£æ³¢ç‰¹ç‡</p><p>#define NONE_PARITY     0       &#x2F;&#x2F;æ— æ ¡éªŒ<br>#define ODD_PARITY      1       &#x2F;&#x2F;å¥‡æ ¡éªŒ<br>#define EVEN_PARITY     2       &#x2F;&#x2F;å¶æ ¡éªŒ<br>#define MARK_PARITY     3       &#x2F;&#x2F;æ ‡è®°æ ¡éªŒ<br>#define SPACE_PARITY    4       &#x2F;&#x2F;ç©ºç™½æ ¡éªŒ</p><p>#define PARITYBIT NONE_PARITY   &#x2F;&#x2F;å®šä¹‰æ ¡éªŒä½</p><p>sfr AUXR  &#x3D; 0x8e;               &#x2F;&#x2F;è¾…åŠ©å¯„å­˜å™¨</p><p>sfr P_SW1   &#x3D; 0xA2;             &#x2F;&#x2F;å¤–è®¾åŠŸèƒ½åˆ‡æ¢å¯„å­˜å™¨1</p><p>#define S1_S0 0x40              &#x2F;&#x2F;P_SW1.6<br>#define S1_S1 0x80              &#x2F;&#x2F;P_SW1.7<br>bit busy;</p><p>sbit led &#x3D; P1^5;&#x2F;&#x2F;DHTå“åº”æŒ‡ç¤ºç¯<br>sbit led2 &#x3D; P1^6;&#x2F;&#x2F;æ•ˆéªŒæ•°æ®æŒ‡ç¤ºç¯</p><p>sfr P0M1 &#x3D; 0x93;<br>sfr P0M0 &#x3D; 0x94;<br>sfr P1M1 &#x3D; 0x91;<br>sfr P1M0 &#x3D; 0x92;<br>sfr P2M1 &#x3D; 0x95;<br>sfr P2M0 &#x3D; 0x96;<br>sfr P3M1 &#x3D; 0xb1;<br>sfr P3M0 &#x3D; 0xb2;</p><p>extern unsigned char MinusFlag;<br>&#x2F;&#x2F;*************************************** åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸² *************************************</p><p>void SendData(unsigned char dat);</p><p>void main() {</p><p>   float  tem &#x3D; 0.0;<br>unsigned char Tempbuf[5];</p><pre><code>P0M0 = 0x00;P0M1 = 0x00;P1M0 = 0x00;P1M1 = 0x00;P2M0 = 0x00;P2M1 = 0x00;P3M0 = 0x00;P3M1 = 0x00; ACC = P_SW1;ACC &amp;= ~(S1_S0 | S1_S1);    //S1_S0=0 S1_S1=0P_SW1 = ACC;                //(P3.0/RxD, P3.1/TxD)SCON = 0x50;                //8ä½å¯å˜æ³¢ç‰¹ç‡AUXR = 0x40;                //å®šæ—¶å™¨1ä¸º1Tæ¨¡å¼TMOD = 0x00;                //å®šæ—¶å™¨1ä¸ºæ¨¡å¼0(16ä½è‡ªåŠ¨é‡è½½)TL1 = (65536 - (FOSC/4/BAUD));   //è®¾ç½®æ³¢ç‰¹ç‡é‡è£…å€¼TH1 = (65536 - (FOSC/4/BAUD))&gt;&gt;8;TR1 = 1;                    //å®šæ—¶å™¨1å¼€å§‹å¯åŠ¨ES = 1;                     //ä½¿èƒ½ä¸²å£ä¸­æ–­EA = 1;Init_Lcd();led = 0;led2 = 0;while(1) &#123;            delayms(2000);        tem=(float)ReadTemperature();  //è¯»å–æ¸©åº¦        tem= tem*0.1;        printf(&quot;Temp=%.1f&quot;,tem);        LCD_write_command(0x01); // æ¸…å±    if(MinusFlag)  //è´Ÿæ•°æ ‡å¿—    &#123;        Write_LCD(5, 0, &quot;-&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²    &#125;    else    &#123;        Write_LCD(5, 0, &quot; &quot;);    &#125;                    Write_LCD(0, 0, &quot;Temp:&quot;);//åœ¨ç¬¬ä¸€è¡Œç¬¬ä¸€ä¸ªä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²             sprintf(Tempbuf, &quot;%2.1f&quot;,tem);            Write_LCD(6, 0, Tempbuf);            LCD_write_data(0xdf);          LCD_write_data(&#39;C&#39;);    &#125;</code></pre><p>}</p><p>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”-<br>UART ä¸­æ–­æœåŠ¡ç¨‹åº<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</em>&#x2F;<br>void Uart() interrupt 4<br>{<br>&#x2F;&#x2F;    if (RI)<br>&#x2F;&#x2F;    {<br>&#x2F;&#x2F;        RI &#x3D; 0;                 &#x2F;&#x2F;æ¸…é™¤RIä½<br>&#x2F;&#x2F;        P0 &#x3D; SBUF;              &#x2F;&#x2F;P0æ˜¾ç¤ºä¸²å£æ•°æ®<br>&#x2F;&#x2F;    }<br>    if (TI)<br>    {<br>        TI &#x3D; 0;                 &#x2F;&#x2F;æ¸…é™¤TIä½<br>        busy &#x3D; 0;               &#x2F;&#x2F;æ¸…å¿™æ ‡å¿—<br>    }<br>}<br>&#x2F;<em>â€”â€”â€”â€”â€”â€”â€”â€”â€”-<br>å‘é€ä¸²å£æ•°æ®<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”-</em>&#x2F;<br>void SendData(unsigned char dat)<br>{<br>    while (busy);               &#x2F;&#x2F;ç­‰å¾…å‰é¢çš„æ•°æ®å‘é€å®Œæˆ<br>    ACC &#x3D; dat;                  &#x2F;&#x2F;è·å–æ ¡éªŒä½P (PSW.0)<br>    if (P)                      &#x2F;&#x2F;æ ¹æ®Pæ¥è®¾ç½®æ ¡éªŒä½<br>    {<br>#if (PARITYBIT &#x3D;&#x3D; ODD_PARITY)<br>        TB8 &#x3D; 0;                &#x2F;&#x2F;è®¾ç½®æ ¡éªŒä½ä¸º0<br>#elif (PARITYBIT &#x3D;&#x3D; EVEN_PARITY)<br>        TB8 &#x3D; 1;                &#x2F;&#x2F;è®¾ç½®æ ¡éªŒä½ä¸º1<br>#endif<br>    }<br>    else<br>    {<br>#if (PARITYBIT &#x3D;&#x3D; ODD_PARITY)<br>        TB8 &#x3D; 1;                &#x2F;&#x2F;è®¾ç½®æ ¡éªŒä½ä¸º1<br>#elif (PARITYBIT &#x3D;&#x3D; EVEN_PARITY)<br>        TB8 &#x3D; 0;                &#x2F;&#x2F;è®¾ç½®æ ¡éªŒä½ä¸º0<br>#endif<br>    }<br>    busy &#x3D; 1;<br>    SBUF &#x3D; ACC;                 &#x2F;&#x2F;å†™æ•°æ®åˆ°UARTæ•°æ®å¯„å­˜å™¨<br>}</p><p>char putchar(char c)<br>{<br>SendData(c);<br>return c;<br>}&#96;</p><ul><li>ğŸŒ¿æ¸©åº¦ç¬¦åˆçš„ç»„æˆï¼šasciiå­—ç¬¦é›† 0xdf é…åˆå¤§å†™å­—æ¯Cç»„æˆã€‚</li></ul><p><code>0xdf</code></p><p><code>C</code></p><h4 id="ğŸ“šå·¥ç¨‹æºç "><a href="#ğŸ“šå·¥ç¨‹æºç " class="headerlink" title="ğŸ“šå·¥ç¨‹æºç "></a>ğŸ“šå·¥ç¨‹æºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1jNSZdcXhDA1d2xLs-WbcoA </span><br><span class="line">æå–ç ï¼š8h9j</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1jNSZdcXhDA1d2xLs-WbcoA  æå–ç ï¼š8h9j</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ADC0809 8é€šé“è½®æµé‡‡æ ·LCD1602æ˜¾ç¤º</title>
      <link href="/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-ADC0809-8%E9%80%9A%E9%81%93%E8%BD%AE%E6%B5%81%E9%87%87%E6%A0%B7LCD1602%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/proteus%E4%BB%BF%E7%9C%9F%E5%B8%B8%E7%94%A8%E8%8A%AF%E7%89%87-ADC0809-8%E9%80%9A%E9%81%93%E8%BD%AE%E6%B5%81%E9%87%87%E6%A0%B7LCD1602%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ADC0809-8é€šé“è½®æµé‡‡æ ·LCD1602æ˜¾ç¤º"><a href="#ADC0809-8é€šé“è½®æµé‡‡æ ·LCD1602æ˜¾ç¤º" class="headerlink" title="ADC0809 8é€šé“è½®æµé‡‡æ ·LCD1602æ˜¾ç¤º"></a>ADC0809 8é€šé“è½®æµé‡‡æ ·LCD1602æ˜¾ç¤º</h1><h3 id="ADC0809-8é€šé“è½®æµé‡‡æ ·LCD1602æ˜¾ç¤º-1"><a href="#ADC0809-8é€šé“è½®æµé‡‡æ ·LCD1602æ˜¾ç¤º-1" class="headerlink" title="ADC0809 8é€šé“è½®æµé‡‡æ ·LCD1602æ˜¾ç¤º"></a>ADC0809 8é€šé“è½®æµé‡‡æ ·LCD1602æ˜¾ç¤º</h3><ul><li>ğŸ“½ğŸğŸ“ºğŸ¬Proteusä»¿çœŸæ¼”ç¤ºï¼š</li><li>ğŸ“Œç›¸å…³ç¯‡ã€Š51å•ç‰‡æœº ADC0809æ¨¡æ•°è½¬æ¢ä¸æ˜¾ç¤º+Proteusä»¿çœŸã€‹</li></ul><p><img src="https://img-blog.csdnimg.cn/cd14e00b85bb4434a6ba24acd44f5550.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><a href="https://blog.csdn.net/weixin_42880082/article/details/121048776">51å•ç‰‡æœº ADC0809æ¨¡æ•°è½¬æ¢ä¸æ˜¾ç¤º+Proteusä»¿çœŸ</a></p><h5 id="ğŸ“‘æœ¬ç¤ºä¾‹å°†ADC08098ä¸ªé€šé“çš„é‡‡æ ·æ•°æ®åˆ†åˆ«æ˜¾ç¤ºåœ¨LCD1602å¯¹åº”ä½ç½®ï¼Œä¿ç•™å°æ•°ç‚¹å2ä½ç²¾åº¦ã€‚è¿™æ ·ä¾èµ–lcd1602æ•´ä¸ªå±å¹•åˆšå¥½æ˜¾ç¤º8ç»„æ•°æ®ï¼Œä¸­é—´æ²¡æœ‰é—´éš”ç©ºä½™ã€‚"><a href="#ğŸ“‘æœ¬ç¤ºä¾‹å°†ADC08098ä¸ªé€šé“çš„é‡‡æ ·æ•°æ®åˆ†åˆ«æ˜¾ç¤ºåœ¨LCD1602å¯¹åº”ä½ç½®ï¼Œä¿ç•™å°æ•°ç‚¹å2ä½ç²¾åº¦ã€‚è¿™æ ·ä¾èµ–lcd1602æ•´ä¸ªå±å¹•åˆšå¥½æ˜¾ç¤º8ç»„æ•°æ®ï¼Œä¸­é—´æ²¡æœ‰é—´éš”ç©ºä½™ã€‚" class="headerlink" title="ğŸ“‘æœ¬ç¤ºä¾‹å°†ADC08098ä¸ªé€šé“çš„é‡‡æ ·æ•°æ®åˆ†åˆ«æ˜¾ç¤ºåœ¨LCD1602å¯¹åº”ä½ç½®ï¼Œä¿ç•™å°æ•°ç‚¹å2ä½ç²¾åº¦ã€‚è¿™æ ·ä¾èµ–lcd1602æ•´ä¸ªå±å¹•åˆšå¥½æ˜¾ç¤º8ç»„æ•°æ®ï¼Œä¸­é—´æ²¡æœ‰é—´éš”ç©ºä½™ã€‚"></a>ğŸ“‘æœ¬ç¤ºä¾‹å°†ADC08098ä¸ªé€šé“çš„é‡‡æ ·æ•°æ®åˆ†åˆ«æ˜¾ç¤ºåœ¨LCD1602å¯¹åº”ä½ç½®ï¼Œä¿ç•™å°æ•°ç‚¹å2ä½ç²¾åº¦ã€‚è¿™æ ·ä¾èµ–lcd1602æ•´ä¸ªå±å¹•åˆšå¥½æ˜¾ç¤º8ç»„æ•°æ®ï¼Œä¸­é—´æ²¡æœ‰é—´éš”ç©ºä½™ã€‚</h5><h4 id="ğŸ““åŠŸèƒ½è¯´æ˜"><a href="#ğŸ““åŠŸèƒ½è¯´æ˜" class="headerlink" title="ğŸ““åŠŸèƒ½è¯´æ˜"></a>ğŸ““åŠŸèƒ½è¯´æ˜</h4><ul><li><p>ğŸŒ¿å®šæ—¶å™¨0ç”¨æ¥ç»™ADC0809æä¾›æ—¶é’Ÿæºã€‚</p></li><li><p>ğŸŒ¿å®šæ—¶å™¨1ç”¨æ¥äº§ç”Ÿ0.5så®šæ—¶ï¼Œç”¨æ¥æŸ¥è¯¢å„ä¸ªADCé€šé“æ•°æ®ã€‚</p></li><li><p>ğŸ”°å¦‚æœæƒ³å•é€šé“æ˜¾ç¤ºå¯ä»¥å¯ç”¨å¤–éƒ¨ä¸­æ–­0ï¼Œç”¨æ¥ä½œä¸ºé€šé“åˆ‡æ¢çš„æŒ‰é”®ã€‚</p></li><li><p>âœ¨å¦‚æœè§‰å¾—ä¸ç¾è§‚ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åªæ˜¾ç¤ºå•é€šé“ï¼Œç„¶åä½¿ç”¨æŒ‰é”®æ¥åˆ‡æ¢é€šé“æ˜¾ç¤º,ï¼Œè°ƒæ•´æ˜¾ç¤ºå‡½æ•°ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void exint0() interrupt 0           //(location at 0003H)</span><br><span class="line">&#123;</span><br><span class="line">    n++;</span><br><span class="line"> if(n==8)n=0;</span><br><span class="line">&#125;</span><br><span class="line">//åœ¨mainä¸­æ·»åŠ ï¼šï¼Œç”¨æ¥å¼€å¯å¤–éƒ¨ä¸­æ–­</span><br><span class="line">    IT0 = 1;   //set INT0 int type (1:Falling 0:Low level)ä¸‹é™æ²¿è§¦å‘</span><br><span class="line">    EX0 = 1;   //enable INT0 interrupt</span><br></pre></td></tr></table></figure><p><code>void exint0() interrupt 0           //(location at 0003H) &#123;     n++;      if(n==8)n=0; &#125; //åœ¨mainä¸­æ·»åŠ ï¼šï¼Œç”¨æ¥å¼€å¯å¤–éƒ¨ä¸­æ–­     IT0 = 1;   //set INT0 int type (1:Falling 0:Low level)ä¸‹é™æ²¿è§¦å‘     EX0 = 1;   //enable INT0 interrupt</code></p><ul><li>å·¥ç¨‹æ¶æ„</li><li>ç›¸å…³æœªå¯ç”¨çš„å‡½æ•°è­¦å‘Šå¤„ç†ï¼šç§»é™¤æœªä½¿ç”¨çš„å‡½æ•°ã€‚</li></ul><p><img src="https://img-blog.csdnimg.cn/6b248ad6250e4413b92fe16c2b6c2188.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/99214d50fcbc4beb9a8712adc0c7c887.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/84db67407d2a4af888af930f599595b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ğŸ“–mainä¸»ç¨‹åº"><a href="#ğŸ“–mainä¸»ç¨‹åº" class="headerlink" title="ğŸ“–mainä¸»ç¨‹åº"></a>ğŸ“–mainä¸»ç¨‹åº</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;LCD1602.h&quot;</span><br><span class="line"></span><br><span class="line">sbit key1= P1^6;</span><br><span class="line">sbit key2= P1^7;</span><br><span class="line">unsigned char dat,results;</span><br><span class="line">volatile unsigned char n,CNT;</span><br><span class="line"></span><br><span class="line">sbit CLK=P3^5;</span><br><span class="line">/*ADCé€šé“é€‰æ‹©*/</span><br><span class="line">sbit P10=P1^0;</span><br><span class="line">sbit P11=P1^1;</span><br><span class="line">sbit P12=P1^2;</span><br><span class="line"></span><br><span class="line">sbit EOC = P3^1;</span><br><span class="line">sbit OE = P3^0;</span><br><span class="line">sbit START = P3^4 ;</span><br><span class="line"></span><br><span class="line">void Timer0Init(void)//100å¾®ç§’@12.000MHz</span><br><span class="line">&#123;</span><br><span class="line">TMOD &amp;= 0xF0;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼</span><br><span class="line">TMOD |= 0x02;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼</span><br><span class="line">TL0 = 0x9C;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TH0 = 0x9C;//è®¾ç½®å®šæ—¶é‡è½½å€¼</span><br><span class="line">TF0 = 0;//æ¸…é™¤TF0æ ‡å¿—</span><br><span class="line">TR0 = 1;//å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//å®šæ—¶å™¨ä¸­æ–­</span><br><span class="line">void Timer0_INT() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">   CLK =!CLK;//ç»™ADC0809æä¾›æ—¶é’Ÿé¢‘ç‡</span><br><span class="line">TF0 = 0;//æ¸…é™¤TF0æ ‡å¿—</span><br><span class="line">TL0 = 0x9C;//è®¾ç½®å®šæ—¶åˆå§‹å€¼100å¾®ç§’=10KHz</span><br><span class="line">TH0 = 0x9C;//è®¾ç½®å®šæ—¶é‡è½½å€¼</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line">//External interrupt0 service routineå¤–éƒ¨ä¸­æ–­0ï¼šP32</span><br><span class="line">void exint0() interrupt 0           //(location at 0003H)</span><br><span class="line">&#123;</span><br><span class="line">    n++;</span><br><span class="line"> if(n==8)n=0;</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">void Timer1Init(void)//50æ¯«ç§’@12.000MHz</span><br><span class="line">&#123;</span><br><span class="line">TMOD &amp;= 0x0F;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼</span><br><span class="line">TMOD |= 0x10;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼</span><br><span class="line">TL1 = 0xB0;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TH1 = 0x3C;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TF1 = 0;//æ¸…é™¤TF0æ ‡å¿—</span><br><span class="line">TR1 = 1;//å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Timer1 interrupt routine */</span><br><span class="line">void tm1_isr() interrupt 3</span><br><span class="line">&#123;</span><br><span class="line">TF1 = 0;//æ¸…é™¤TF0æ ‡å¿—</span><br><span class="line">TL0 = 0xB0;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TH0 = 0x3C;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line"></span><br><span class="line">    if (CNT++ == 10)   //50ms * 20 -&gt; 2s</span><br><span class="line">    &#123;</span><br><span class="line">        CNT = 0;  //å½’é›¶</span><br><span class="line">        n++;</span><br><span class="line">if(n==8)n=0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">void Channel(unsigned char x)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   switch(x)&#123;</span><br><span class="line">    case 0:   P10=0; P11=0; P12=0;break;</span><br><span class="line">    case 1:   P10=1; P11=0; P12=0;break;</span><br><span class="line">    case 2:   P10=0; P11=1; P12=0;break;</span><br><span class="line">    case 3:   P10=1; P11=1; P12=0;break;</span><br><span class="line">    case 4:   P10=0; P11=0; P12=1;break;</span><br><span class="line">    case 5:   P10=1; P11=0; P12=1;break;</span><br><span class="line">    case 6:   P10=0; P11=1; P12=1;break;</span><br><span class="line">    case 7:   P10=1; P11=1; P12=1;break;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">void main(void)</span><br><span class="line"> &#123; </span><br><span class="line">  unsigned char Int,Dec;</span><br><span class="line">   unsigned int Value;</span><br><span class="line">//    IT0 = 1;   //set INT0 int type (1:Falling 0:Low level)</span><br><span class="line">//    EX0 = 1;   //enable INT0 interrupt</span><br><span class="line"> Timer0Init();</span><br><span class="line"> Timer1Init();</span><br><span class="line">     LCMInit();         //å°†æ¶²æ™¶åˆå§‹åŒ–</span><br><span class="line">   ET0 =1;//å¼€å¯å®šæ—¶å™¨0</span><br><span class="line"> ET1 = 1;//å¼€å¯å®šæ—¶å™¨1</span><br><span class="line"> EA =1;//å¼€å¯æ€»ä¸­æ–­</span><br><span class="line"> DisplayListChar(0,0,5, &quot; .   .   .   .&quot;);//å­—ç¬¦ä¸²æ˜¾ç¤º</span><br><span class="line"> DisplayListChar(1,0,5, &quot; .   .   .   .&quot;);//å­—ç¬¦ä¸²æ˜¾ç¤º</span><br><span class="line">    while(1)</span><br><span class="line">    &#123;</span><br><span class="line">      delayms(16); </span><br><span class="line">Channel(n); //é€‰æ‹©é€šé“</span><br><span class="line"></span><br><span class="line">      START=0;     </span><br><span class="line">      START=1;</span><br><span class="line">      START=0;//å½“ä½ç”µå¹³æ¥æ—¶å¼€å§‹è¯»å–æ•°æ®</span><br><span class="line">      while(EOC==0);</span><br><span class="line">      OE=1;</span><br><span class="line">     dat = P2; //å°†æ•°æ®èµ‹ç»™P2</span><br><span class="line">      OE = 0;       </span><br><span class="line"> Value = (dat*100)/51;</span><br><span class="line"> Int = dat/51;//dat*5/255</span><br><span class="line"> Dec = Value%100;//å¤„ç†æ•°æ®</span><br><span class="line">if(n&lt;4)&#123;</span><br><span class="line">  DisplayOneChar(0 ,4*n,Int+0x30);</span><br><span class="line">DisplayOneChar(0 ,2+4*n,Dec/10 +0x30);</span><br><span class="line">    DisplayOneChar(0 ,3+4*n,Dec%10 +0x30);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">DisplayOneChar(1 ,4*n,Int+0x30);</span><br><span class="line">DisplayOneChar(1 ,2+4*n,Dec/10 +0x30);</span><br><span class="line">    DisplayOneChar(1 ,3+4*n,Dec%10 +0x30);</span><br><span class="line">&#125;</span><br><span class="line"> &#125;            </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include â€œLCD1602.hâ€</p><p>sbit key1&#x3D; P1^6;<br>sbit key2&#x3D; P1^7;<br>unsigned char dat,results;<br>volatile unsigned char n,CNT;</p><p>sbit CLK&#x3D;P3^5;<br>&#x2F;<em>ADCé€šé“é€‰æ‹©</em>&#x2F;<br>sbit P10&#x3D;P1^0;<br>sbit P11&#x3D;P1^1;<br>sbit P12&#x3D;P1^2;</p><p>sbit EOC &#x3D; P3^1;<br>sbit OE &#x3D; P3^0;<br>sbit START &#x3D; P3^4 ;</p><p>void Timer0Init(void)&#x2F;&#x2F;100å¾®ç§’@12.000MHz<br>{<br>    TMOD &amp;&#x3D; 0xF0;&#x2F;&#x2F;è®¾ç½®å®šæ—¶å™¨æ¨¡å¼<br>    TMOD |&#x3D; 0x02;&#x2F;&#x2F;è®¾ç½®å®šæ—¶å™¨æ¨¡å¼<br>    TL0 &#x3D; 0x9C;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TH0 &#x3D; 0x9C;&#x2F;&#x2F;è®¾ç½®å®šæ—¶é‡è½½å€¼<br>    TF0 &#x3D; 0;&#x2F;&#x2F;æ¸…é™¤TF0æ ‡å¿—<br>    TR0 &#x3D; 1;&#x2F;&#x2F;å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶<br>}</p><p>&#x2F;&#x2F;å®šæ—¶å™¨ä¸­æ–­<br>void Timer0_INT() interrupt 1<br>{<br>   CLK &#x3D;!CLK;&#x2F;&#x2F;ç»™ADC0809æä¾›æ—¶é’Ÿé¢‘ç‡<br>    TF0 &#x3D; 0;&#x2F;&#x2F;æ¸…é™¤TF0æ ‡å¿—<br>    TL0 &#x3D; 0x9C;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼100å¾®ç§’&#x3D;10KHz<br>    TH0 &#x3D; 0x9C;&#x2F;&#x2F;è®¾ç½®å®šæ—¶é‡è½½å€¼</p><p>}<br>&#x2F;*<br>&#x2F;&#x2F;External interrupt0 service routineå¤–éƒ¨ä¸­æ–­0ï¼šP32<br>void exint0() interrupt 0           &#x2F;&#x2F;(location at 0003H)<br>{<br>    n++;<br>     if(n&#x3D;&#x3D;8)n&#x3D;0;<br>}<br>*&#x2F;</p><p>void Timer1Init(void)&#x2F;&#x2F;50æ¯«ç§’@12.000MHz<br>{<br>    TMOD &amp;&#x3D; 0x0F;&#x2F;&#x2F;è®¾ç½®å®šæ—¶å™¨æ¨¡å¼<br>    TMOD |&#x3D; 0x10;&#x2F;&#x2F;è®¾ç½®å®šæ—¶å™¨æ¨¡å¼<br>    TL1 &#x3D; 0xB0;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TH1 &#x3D; 0x3C;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TF1 &#x3D; 0;&#x2F;&#x2F;æ¸…é™¤TF0æ ‡å¿—<br>    TR1 &#x3D; 1;&#x2F;&#x2F;å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶<br>}</p><p>&#x2F;* Timer1 interrupt routine *&#x2F;<br>void tm1_isr() interrupt 3<br>{<br>    TF1 &#x3D; 0;&#x2F;&#x2F;æ¸…é™¤TF0æ ‡å¿—<br>    TL0 &#x3D; 0xB0;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TH0 &#x3D; 0x3C;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼</p><pre><code>if (CNT++ == 10)   //50ms * 20 -&gt; 2s&#123;    CNT = 0;  //å½’é›¶    n++;            if(n==8)n=0;&#125;</code></pre><p>}<br>void Channel(unsigned char x)<br>{</p><p>   switch(x){<br>    case 0:   P10&#x3D;0; P11&#x3D;0; P12&#x3D;0;break;<br>    case 1:   P10&#x3D;1; P11&#x3D;0; P12&#x3D;0;break;<br>    case 2:   P10&#x3D;0; P11&#x3D;1; P12&#x3D;0;break;<br>    case 3:   P10&#x3D;1; P11&#x3D;1; P12&#x3D;0;break;<br>    case 4:   P10&#x3D;0; P11&#x3D;0; P12&#x3D;1;break;<br>    case 5:   P10&#x3D;1; P11&#x3D;0; P12&#x3D;1;break;<br>    case 6:   P10&#x3D;0; P11&#x3D;1; P12&#x3D;1;break;<br>    case 7:   P10&#x3D;1; P11&#x3D;1; P12&#x3D;1;break;<br>   }</p><p>} </p><p>void main(void)<br> {<br>      unsigned char Int,Dec;<br>   unsigned int Value;<br>&#x2F;&#x2F;    IT0 &#x3D; 1;   &#x2F;&#x2F;set INT0 int type (1:Falling 0:Low level)<br>&#x2F;&#x2F;    EX0 &#x3D; 1;   &#x2F;&#x2F;enable INT0 interrupt<br>     Timer0Init();<br>     Timer1Init();<br>     LCMInit();         &#x2F;&#x2F;å°†æ¶²æ™¶åˆå§‹åŒ–<br>   ET0 &#x3D;1;&#x2F;&#x2F;å¼€å¯å®šæ—¶å™¨0<br>     ET1 &#x3D; 1;&#x2F;&#x2F;å¼€å¯å®šæ—¶å™¨1<br>     EA &#x3D;1;&#x2F;&#x2F;å¼€å¯æ€»ä¸­æ–­<br>     DisplayListChar(0,0,5, â€œ .   .   .   .â€);&#x2F;&#x2F;å­—ç¬¦ä¸²æ˜¾ç¤º<br>     DisplayListChar(1,0,5, â€œ .   .   .   .â€);&#x2F;&#x2F;å­—ç¬¦ä¸²æ˜¾ç¤º<br>    while(1)<br>    {<br>      delayms(16);<br>        Channel(n); &#x2F;&#x2F;é€‰æ‹©é€šé“</p><pre><code>  START=0;       START=1;  START=0;//å½“ä½ç”µå¹³æ¥æ—¶å¼€å§‹è¯»å–æ•°æ®  while(EOC==0);      OE=1;     dat = P2; //å°†æ•°æ®èµ‹ç»™P2      OE = 0;        Value = (dat*100)/51; Int = dat/51;//dat*5/255 Dec = Value%100;//å¤„ç†æ•°æ®if(n&lt;4)&#123;  DisplayOneChar(0 ,4*n,Int+0x30);    DisplayOneChar(0 ,2+4*n,Dec/10 +0x30);DisplayOneChar(0 ,3+4*n,Dec%10 +0x30);&#125;else&#123;    DisplayOneChar(1 ,4*n,Int+0x30);    DisplayOneChar(1 ,2+4*n,Dec/10 +0x30);DisplayOneChar(1 ,3+4*n,Dec%10 +0x30);&#125;</code></pre><p> }<br>}&#96;</p><h4 id="ğŸ“šç¨‹åºæºç "><a href="#ğŸ“šç¨‹åºæºç " class="headerlink" title="ğŸ“šç¨‹åºæºç "></a>ğŸ“šç¨‹åºæºç </h4><p>âš¡æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/11oPIiMOxxYKugudXKRwYaw </span><br><span class="line">æå–ç ï¼šq5yz</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/11oPIiMOxxYKugudXKRwYaw  æå–ç ï¼šq5yz</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘STC15å•ç‰‡æœº + LCD1602+5X8ç‚¹é˜µå­—ç¬¦æ˜¾ç¤º</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FSTC15%E5%8D%95%E7%89%87%E6%9C%BA-LCD16025X8%E7%82%B9%E9%98%B5%E5%AD%97%E7%AC%A6%E6%98%BE%E7%A4%BA/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9FSTC15%E5%8D%95%E7%89%87%E6%9C%BA-LCD16025X8%E7%82%B9%E9%98%B5%E5%AD%97%E7%AC%A6%E6%98%BE%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘STC15å•ç‰‡æœº-LCD1602-5X8ç‚¹é˜µå­—ç¬¦æ˜¾ç¤º"><a href="#ã€Proteusä»¿çœŸã€‘STC15å•ç‰‡æœº-LCD1602-5X8ç‚¹é˜µå­—ç¬¦æ˜¾ç¤º" class="headerlink" title="ã€Proteusä»¿çœŸã€‘STC15å•ç‰‡æœº + LCD1602+5X8ç‚¹é˜µå­—ç¬¦æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘STC15å•ç‰‡æœº + LCD1602+5X8ç‚¹é˜µå­—ç¬¦æ˜¾ç¤º</h1><h3 id="ã€Proteusä»¿çœŸã€‘STC15å•ç‰‡æœº-LCD1602-5X8ç‚¹é˜µå­—ç¬¦æ˜¾ç¤º-1"><a href="#ã€Proteusä»¿çœŸã€‘STC15å•ç‰‡æœº-LCD1602-5X8ç‚¹é˜µå­—ç¬¦æ˜¾ç¤º-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘STC15å•ç‰‡æœº + LCD1602+5X8ç‚¹é˜µå­—ç¬¦æ˜¾ç¤º"></a>ã€Proteusä»¿çœŸã€‘STC15å•ç‰‡æœº + LCD1602+5X8ç‚¹é˜µå­—ç¬¦æ˜¾ç¤º</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li></ul><p><img src="https://img-blog.csdnimg.cn/1cd4fa776fb445d1a1486ea0be9558d5.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç›¸å…³å‡½æ•°è¯´æ˜"><a href="#ç›¸å…³å‡½æ•°è¯´æ˜" class="headerlink" title="ç›¸å…³å‡½æ•°è¯´æ˜"></a>ç›¸å…³å‡½æ•°è¯´æ˜</h4><ul><li>unsigned char *uchartostr(unsigned num); &#x2F;&#x2F;å°†ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸² æˆ–10è¿›åˆ¶</li></ul><p><code>unsigned char *uchartostr(unsigned num);</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">unsigned char *uchartostr(unsigned num)//å°†ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸² æˆ–10è¿›åˆ¶</span><br><span class="line">&#123;</span><br><span class="line">unsigned char x2,x1,x0,i;</span><br><span class="line">x2=num/100;</span><br><span class="line">x1=num%100/10;</span><br><span class="line">x0=num%100%10;</span><br><span class="line">i=0;</span><br><span class="line">if(x2!=0)</span><br><span class="line">&#123;</span><br><span class="line">str[i]=x2+48;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">if(x1!=0)</span><br><span class="line">&#123;</span><br><span class="line">str[i]=x1+48;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">str[i]=x0+48;</span><br><span class="line">i++;</span><br><span class="line">str[i]=&#x27;\0&#x27;;</span><br><span class="line">return str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>unsigned char *uchartostr(unsigned num)//å°†ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸² æˆ–10è¿›åˆ¶ &#123;     unsigned char x2,x1,x0,i;     x2=num/100;     x1=num%100/10;     x0=num%100%10;     i=0;     if(x2!=0)     &#123;         str[i]=x2+48;         i++;     &#125;     if(x1!=0)     &#123;         str[i]=x1+48;         i++;     &#125;     str[i]=x0+48;     i++;     str[i]=&#39;\0&#39;;     return str; &#125;</code></p><ul><li>WriteROM(); &#x2F;&#x2F; å°†è‡ªå®šä¹‰å­—å½¢ç å†™å…¥LCD1602å†…éƒ¨å­˜å‚¨å™¨</li></ul><p><code>WriteROM(); // å°†è‡ªå®šä¹‰å­—å½¢ç å†™å…¥LCD1602å†…éƒ¨å­˜å‚¨å™¨</code></p><p>å°†84bitï¼Œ8å­—èŠ‚çš„æ•°æ®å†™å…¥åˆ°LCD1602 CGRAMå¯„å­˜å™¨ï¼Œ</p><p><code>CGRAM</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">void WriteROM()//LCD1602å†…éƒ¨æ•°æ®å¯„å­˜å™¨å†™å…¥å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i;</span><br><span class="line">Write_CMD(0x40); // æ“ä½œCGRAMçš„å‘½ä»¤ç ï¼Œ</span><br><span class="line">for(i=0;i&lt;64;i++)            // å†™å…¥æ•°ç»„ä¸­æ•°æ®  </span><br><span class="line">&#123;</span><br><span class="line">Write_DIS_Data(table[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>void WriteROM()//LCD1602å†…éƒ¨æ•°æ®å¯„å­˜å™¨å†™å…¥å‡½æ•° &#123;         unsigned char i;     Write_CMD(0x40); // æ“ä½œCGRAMçš„å‘½ä»¤ç ï¼Œ     for(i=0;i&lt;64;i++)            // å†™å…¥æ•°ç»„ä¸­æ•°æ®       &#123;         Write_DIS_Data(table[i]);     &#125; &#125;</code></p><ul><li>å‚è€ƒä¿¡æ¯ã€ŠLCD1602æ¶²æ™¶ä½¿ç”¨ä»‹ç»â€“ï¼ˆå®Œæ•´ç‰ˆï¼‰ã€‹</li><li>LCD17602å†…ç½®DDRAMã€CGROMå’ŒCGRAMã€‚</li></ul><p><a href="https://blog.csdn.net/weixin_46897073/article/details/110282736">LCD1602æ¶²æ™¶ä½¿ç”¨ä»‹ç»â€“ï¼ˆå®Œæ•´ç‰ˆï¼‰</a></p><p>CGRAMçš„å®¹é‡æ˜¯64ä¸ªå­—èŠ‚ï¼Œè€Œä¸€ä¸ªå­—ç¬¦æ˜¯8ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä¸€å…±èƒ½æ˜¾ç¤º8ä¸ªè‡ªå®šä¹‰çš„å­—ç¬¦ã€‚å†…éƒ¨å¸¸ç”¨å­—ç¬¦çš„æ˜¾ç¤ºæ˜¯ä»0x20å¼€å§‹çš„ï¼Œ0x00 ~ 0x0Fæ˜¯ä¸“é—¨ç•™ç»™è‡ªå®šä¹‰å­—ç¬¦æ˜¾ç¤ºç”¨çš„ï¼Œ0x00-0x07å’Œ0x08~0x0Fæ˜¾ç¤ºçš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´0x00&#x3D;0x08,0x01&#x3D;0x09ï¼Œä»¥æ­¤ç±»æ¨ã€‚CGRAMå…±128ä¸ªä½ï¼Œåœ°å€æ˜¯0x40-0x7Fï¼Œ128&#x2F;8&#x3D;16æ­£å¥½å¯¹åº”çš„æ˜¯0x00-0x0Få…±16ä¸ª.</p><p><img src="https://img-blog.csdnimg.cn/e20d1d9ca1ff4a2e8e9677031555a6b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="ç¨‹åºæºç "><a href="#ç¨‹åºæºç " class="headerlink" title="ç¨‹åºæºç "></a>ç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br></pre></td><td class="code"><pre><span class="line">/*************æœ¬ç¨‹åºåŠŸèƒ½è¯´æ˜**************</span><br><span class="line"></span><br><span class="line">é©±åŠ¨LCD1602å­—ç¬¦å±.</span><br><span class="line"></span><br><span class="line">æ˜¾ç¤ºæ•ˆæœä¸º:  DS1302 + LCD1602æ˜¾ç¤ºæ—¶é—´</span><br><span class="line"></span><br><span class="line">******************************************/</span><br><span class="line">#include&quot;STC15Fxxxx.H&quot;</span><br><span class="line"></span><br><span class="line">#define T1MS (65536-MAIN_Fosc/12/1000)   //12Tæ¨¡å¼1mså®šæ—¶</span><br><span class="line">#define  interval  1000 //è®¾ç½®å»¶æ—¶æ—¶é—´é—´éš”</span><br><span class="line">/*************æœ¬åœ°å˜é‡å£°æ˜**************/</span><br><span class="line">static volatile unsigned long sysRunmillis = 0;//ç³»ç»Ÿè¿è¡Œæ—¶é—´è®¡æ•°ï¼Œä¿å­˜å•ç‰‡æœºä»ä¸Šç”µå¤ä½ä»¥æ¥è¿è¡Œçš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚è¯¥æ•°å€¼ç”±å®šæ—¶å™¨T0çš„ä¸­æ–­å“åº”å­å‡½æ•°æ›´æ–°</span><br><span class="line">unsigned long previousMillis = 0;</span><br><span class="line">unsigned char str[4];//uchartostrå‡½æ•°è½¬æ¢çš„å­—ç¬¦ä¸² åŒæ—¶å¯ä»¥æŠŠ16è¿›åˆ¶è½¬æˆ10è¿›åˆ¶</span><br><span class="line">sbit Buzzer = P3^7;</span><br><span class="line">unsigned char code table[]=</span><br><span class="line">&#123;</span><br><span class="line">    0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,        // ä¸€ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x00</span><br><span class="line">    0x00,0x00,0x00,0x0e,0x00,0xff,0x00,0x00,        // äºŒï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x01</span><br><span class="line">    0x00,0x00,0xff,0x00,0x0e,0x00,0xff,0x00,        // ä¸‰ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x02</span><br><span class="line">    0x00,0x00,0xff,0xf5,0xfb,0xf1,0xff,0x00,        // å››ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x03</span><br><span class="line">    0x00,0xfe,0x08,0xfe,0x0a,0x0a,0xff,0x00,        // äº”ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x04</span><br><span class="line">    0x00,0x04,0x00,0xff,0x00,0x0a,0x11,0x00,        // å…­ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x05</span><br><span class="line">0x00,0x1f,0x11,0x1f,0x11,0x11,0x1f,0x00,        // æ—¥ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x06</span><br><span class="line">0x18,0x18,0x07,0x08,0x08,0x08,0x07,0x00,        // â„ƒï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x07</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void Timer0Init(void);//1æ¯«ç§’@12.000MHz</span><br><span class="line">void  delay_ms(unsigned long ms);</span><br><span class="line">voidInitialize_LCD(void);</span><br><span class="line">voidWrite_AC(u8 hang,u8 lie);</span><br><span class="line">voidWrite_DIS_Data(u8 DIS_Data);</span><br><span class="line">void WriteROM();//LCD1602å†…éƒ¨æ•°æ®å¯„å­˜å™¨å†™å…¥å‡½æ•°</span><br><span class="line">voidClearLine(u8 row);</span><br><span class="line">u8BIN_ASCII(u8 tmp);</span><br><span class="line">void PutString(u8 row, u8 column, u8 *puts);</span><br><span class="line">voidWriteChar(u8 row, u8 column, u8 dat);</span><br><span class="line">void Buzzer_Di(void);</span><br><span class="line">unsigned char *uchartostr(unsigned num);//å°†ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸² æˆ–10è¿›åˆ¶</span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: void main(void)</span><br><span class="line">// æè¿°: ä¸»å‡½æ•°ã€‚</span><br><span class="line">//========================================================================</span><br><span class="line">void main(void)</span><br><span class="line">&#123;</span><br><span class="line">unsigned long currentMillis;//å½“å‰æ—¶é—´</span><br><span class="line">unsigned char i =0;</span><br><span class="line">P0M1 = 0;P0M0 = 0;//è®¾ç½®ä¸ºå‡†åŒå‘å£</span><br><span class="line">P1M1 = 0;P1M0 = 0;//è®¾ç½®ä¸ºå‡†åŒå‘å£</span><br><span class="line">P2M1 = 0;P2M0 = 0;//è®¾ç½®ä¸ºå‡†åŒå‘å£</span><br><span class="line">P3M1 = 0;P3M0 = 0;//è®¾ç½®ä¸ºå‡†åŒå‘å£</span><br><span class="line">P4M1 = 0;P4M0 = 0;//è®¾ç½®ä¸ºå‡†åŒå‘å£</span><br><span class="line">P5M1 = 0;P5M0 = 0;//è®¾ç½®ä¸ºå‡†åŒå‘å£</span><br><span class="line">P6M1 = 0;P6M0 = 0;//è®¾ç½®ä¸ºå‡†åŒå‘å£</span><br><span class="line">P7M1 = 0;P7M0 = 0;//è®¾ç½®ä¸ºå‡†åŒå‘å£</span><br><span class="line">Timer0Init();//1æ¯«ç§’@12.000MHz</span><br><span class="line">Initialize_LCD();//LCDåˆå§‹åŒ–å‡½æ•°</span><br><span class="line">ClearLine(0);</span><br><span class="line">ClearLine(1);</span><br><span class="line">PutString(0,0,&quot;STC15W4K&quot;);</span><br><span class="line">WriteROM();   // å°†è‡ªå®šä¹‰å­—å½¢ç å†™å…¥LCD1602å†…éƒ¨å­˜å‚¨å™¨</span><br><span class="line">  WriteChar(1, 0, 0);</span><br><span class="line">WriteChar(1, 1, 1);</span><br><span class="line">WriteChar(1, 2, 2);</span><br><span class="line">WriteChar(1, 3, 3);</span><br><span class="line">WriteChar(1, 4, 4);</span><br><span class="line">WriteChar(1, 5, 5);</span><br><span class="line">WriteChar(1, 6, 6);</span><br><span class="line">WriteChar(1, 7, 7);</span><br><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">currentMillis = sysRunmillis;</span><br><span class="line">if (currentMillis - previousMillis  &gt;= interval)</span><br><span class="line">&#123;//æ¯éš”1ç§’ç¿»è½¬ä¸€æ¬¡</span><br><span class="line">    previousMillis = sysRunmillis;</span><br><span class="line">if(++i &lt;= 255)&#123;</span><br><span class="line">PutString(0,9,uchartostr(i));</span><br><span class="line">WriteChar(0, 14, i);</span><br><span class="line"></span><br><span class="line">PutString(1,9,uchartostr(255 -i));</span><br><span class="line">WriteChar(1, 14, 255 -i);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">void Timer0Init(void)//1æ¯«ç§’@12.000MHz</span><br><span class="line">&#123;</span><br><span class="line">AUXR &amp;= 0x7F;//å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼</span><br><span class="line">TMOD &amp;= 0xF0;//è®¾ç½®å®šæ—¶å™¨æ¨¡å¼</span><br><span class="line">TL0 = T1MS ;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">TH0 = T1MS &gt;&gt;8;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">//TL0 = 0x18;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">//TH0 = 0xFC;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line"></span><br><span class="line">TF0 = 0;//æ¸…é™¤TF0æ ‡å¿—</span><br><span class="line">TR0 = 1;//å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶</span><br><span class="line">ET0 = 1;     //enable timer0 interrupt</span><br><span class="line">  EA = 1;      //open global interrupt switch</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Timer0 interrupt routine */</span><br><span class="line">void tm0_isr() interrupt 1</span><br><span class="line">&#123;</span><br><span class="line">//TL0 = 0x18;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">//TH0 = 0xFC;//è®¾ç½®å®šæ—¶åˆå§‹å€¼</span><br><span class="line">    TL0 = T1MS;                     //reload timer0 low byte</span><br><span class="line">    TH0 = T1MS &gt;&gt; 8;                //reload timer0 high byte</span><br><span class="line">sysRunmillis ++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: void  delay_ms(u8 ms)</span><br><span class="line">// æè¿°: å»¶æ—¶å‡½æ•°ã€‚</span><br><span class="line">// å‚æ•°: ms,è¦å»¶æ—¶çš„msæ•°, è¿™é‡Œåªæ”¯æŒ1~255ms. è‡ªåŠ¨é€‚åº”ä¸»æ—¶é’Ÿ.</span><br><span class="line">// è¿”å›: none.</span><br><span class="line">// ç‰ˆæœ¬: VER1.0</span><br><span class="line">// æ—¥æœŸ: 2013-4-1</span><br><span class="line">// å¤‡æ³¨: </span><br><span class="line">//========================================================================</span><br><span class="line">void  delay_ms(unsigned long ms)</span><br><span class="line">&#123;</span><br><span class="line">unsigned longtemp = sysRunmillis ;</span><br><span class="line">    while(sysRunmillis - temp &lt; ms );</span><br><span class="line">//     unsigned int i;</span><br><span class="line">// do&#123;</span><br><span class="line">//      i = MAIN_Fosc / 13000;</span><br><span class="line">//  while(--i);   //14T per loop</span><br><span class="line">//     &#125;while(--ms);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/************* LCD1602ç›¸å…³ç¨‹åº*****************************************************/</span><br><span class="line">//8ä½æ•°æ®è®¿é—®æ–¹å¼LCD1602æ ‡å‡†ç¨‹åºæ¢å·¥ç¼–å†™2014-2-21</span><br><span class="line"></span><br><span class="line">#define LineLength16//16x2</span><br><span class="line"></span><br><span class="line">/*************Pin define*****************************************************/</span><br><span class="line"></span><br><span class="line">sfrLCD_BUS = 0x80;//P0--0x80, P1--0x90, P2--0xA0, P3--0xB0</span><br><span class="line"></span><br><span class="line">sbitLCD_B7  = LCD_BUS^7;//D7 -- Pin 14LED- -- Pin 16 </span><br><span class="line">sbitLCD_B6  = LCD_BUS^6;//D6 -- Pin 13LED+ -- Pin 15</span><br><span class="line">sbitLCD_B5  = LCD_BUS^5;//D5 -- Pin 12Vo   -- Pin 3</span><br><span class="line">sbitLCD_B4  = LCD_BUS^4;//D4 -- Pin 11VDD  -- Pin 2</span><br><span class="line">sbitLCD_B3  = LCD_BUS^3;//D3 -- Pin 10VSS  -- Pin 1</span><br><span class="line">sbitLCD_B2  = LCD_BUS^2;//D2 -- Pin  9</span><br><span class="line">sbitLCD_B1  = LCD_BUS^1;//D1 -- Pin  8</span><br><span class="line">sbitLCD_B0  = LCD_BUS^0;//D0 -- Pin  7</span><br><span class="line"></span><br><span class="line">sbitLCD_ENA= P2^2;//Pin 6</span><br><span class="line">sbitLCD_RW= P2^1;//Pin 5//LCD_RS   R/W   DB7--DB0        FOUNCTION</span><br><span class="line">sbitLCD_RS= P2^0;//Pin 4//00  INPUT      write the command to LCD model</span><br><span class="line">//01     OUTPUT     read BF and AC pointer from LCD model</span><br><span class="line">//10     INPUT      write the data to LCD  model</span><br><span class="line">//11     OUTPUT     read the data from LCD model</span><br><span class="line">/*</span><br><span class="line">total 2 lines, 16x2= 32</span><br><span class="line">first line address:  0~15</span><br><span class="line">second line address: 64~79</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#define C_CLEAR0x01//clear LCD</span><br><span class="line">#define C_HOME 0x02//cursor go home</span><br><span class="line">#define C_CUR_L0x04//cursor shift left after input</span><br><span class="line">#define C_RIGHT0x05//picture shift right after input</span><br><span class="line">#define C_CUR_R0x06//cursor shift right after input</span><br><span class="line">#define C_LEFT 0x07//picture shift left after input</span><br><span class="line">#define C_OFF  0x08//turn off LCD</span><br><span class="line">#define C_ON   0x0C//turn on  LCD</span><br><span class="line">#define C_FLASH0x0D//turn on  LCD, flash </span><br><span class="line">#define C_CURSOR0x0E//turn on  LCD and cursor</span><br><span class="line">#define C_FLASH_ALL0x0F//turn on  LCD and cursor, flash</span><br><span class="line">#define C_CURSOR_LEFT0x10//single cursor shift left</span><br><span class="line">#define C_CURSOR_RIGHT0x10//single cursor shift right</span><br><span class="line">#define C_PICTURE_LEFT0x10//single picture shift left</span><br><span class="line">#define C_PICTURE_RIGHT0x10//single picture shift right</span><br><span class="line">#define C_BIT80x30//set the data is 8 bits</span><br><span class="line">#define C_BIT40x20//set the data is 4 bits</span><br><span class="line">#define C_L1DOT70x30//8 bits,one line 5*7  dots</span><br><span class="line">#define C_L1DOT100x34//8 bits,one line 5*10 dots</span><br><span class="line">#define C_L2DOT70x38//8 bits,tow lines 5*7 dots</span><br><span class="line">#define C_4bitL2DOT70x28//4 bits,tow lines 5*7 dots</span><br><span class="line">#define C_CGADDRESS00x40//CGRAM address0 (addr=40H+x)</span><br><span class="line">#define C_DDADDRESS00x80//DDRAM address0 (addr=80H+x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#defineLCD_DelayNop()NOP(15)</span><br><span class="line"></span><br><span class="line">#defineLCD_BusData(dat)LCD_BUS = dat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: voidCheckBusy(void)</span><br><span class="line">// æè¿°: æ£€æµ‹å¿™å‡½æ•°</span><br><span class="line">// å‚æ•°: none.</span><br><span class="line">// è¿”å›: none.</span><br><span class="line">// ç‰ˆæœ¬: VER1.0</span><br><span class="line">// æ—¥æœŸ: 2013-4-1</span><br><span class="line">// å¤‡æ³¨: </span><br><span class="line">//========================================================================</span><br><span class="line">voidCheckBusy(void)</span><br><span class="line">&#123;</span><br><span class="line">u16i;</span><br><span class="line">for(i=0; i&lt;5000; i++)&#123;if(!LCD_B7)break;&#125;//check the LCD busy or not. With time out</span><br><span class="line">//while(LCD_B7);//check the LCD busy or not. Without time out</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: void IniSendCMD(u8 cmd)</span><br><span class="line">// æè¿°: åˆå§‹åŒ–å†™å‘½ä»¤(ä¸æ£€æµ‹å¿™)</span><br><span class="line">// å‚æ•°: cmd: è¦å†™çš„å‘½ä»¤.</span><br><span class="line">// è¿”å›: none.</span><br><span class="line">// ç‰ˆæœ¬: VER1.0</span><br><span class="line">// æ—¥æœŸ: 2013-4-1</span><br><span class="line">// å¤‡æ³¨: </span><br><span class="line">//========================================================================</span><br><span class="line">void IniSendCMD(u8 cmd)</span><br><span class="line">&#123;</span><br><span class="line">LCD_RW = 0;</span><br><span class="line">LCD_BusData(cmd);</span><br><span class="line">LCD_DelayNop();</span><br><span class="line">LCD_ENA = 1;</span><br><span class="line">LCD_DelayNop();</span><br><span class="line">LCD_ENA = 0;</span><br><span class="line">LCD_BusData(0xff);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: void Write_CMD(u8 cmd)</span><br><span class="line">// æè¿°: å†™å‘½ä»¤(æ£€æµ‹å¿™)</span><br><span class="line">// å‚æ•°: cmd: è¦å†™çš„å‘½ä»¤.</span><br><span class="line">// è¿”å›: none.</span><br><span class="line">// ç‰ˆæœ¬: VER1.0</span><br><span class="line">// æ—¥æœŸ: 2013-4-1</span><br><span class="line">// å¤‡æ³¨: </span><br><span class="line">//========================================================================</span><br><span class="line">void Write_CMD(u8 cmd)</span><br><span class="line">&#123;</span><br><span class="line">LCD_RS  = 0;</span><br><span class="line">LCD_RW = 1;</span><br><span class="line">LCD_BusData(0xff);</span><br><span class="line">LCD_DelayNop();</span><br><span class="line">LCD_ENA = 1;</span><br><span class="line">CheckBusy();//check the LCD busy or not.</span><br><span class="line">LCD_ENA = 0;</span><br><span class="line">LCD_RW = 0;</span><br><span class="line"></span><br><span class="line">LCD_BusData(cmd);</span><br><span class="line">LCD_DelayNop();</span><br><span class="line">LCD_ENA = 1;</span><br><span class="line">LCD_DelayNop();</span><br><span class="line">LCD_ENA = 0;</span><br><span class="line">LCD_BusData(0xff);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: void Write_DIS_Data(u8 dat)</span><br><span class="line">// æè¿°: å†™æ˜¾ç¤ºæ•°æ®(æ£€æµ‹å¿™)</span><br><span class="line">// å‚æ•°: dat: è¦å†™çš„æ•°æ®.</span><br><span class="line">// è¿”å›: none.</span><br><span class="line">// ç‰ˆæœ¬: VER1.0</span><br><span class="line">// æ—¥æœŸ: 2013-4-1</span><br><span class="line">// å¤‡æ³¨: </span><br><span class="line">//========================================================================</span><br><span class="line">void Write_DIS_Data(u8 dat)</span><br><span class="line">&#123;</span><br><span class="line">LCD_RS = 0;</span><br><span class="line">LCD_RW = 1;</span><br><span class="line"></span><br><span class="line">LCD_BusData(0xff);</span><br><span class="line">LCD_DelayNop();</span><br><span class="line">LCD_ENA = 1;</span><br><span class="line">CheckBusy();//check the LCD busy or not.</span><br><span class="line">LCD_ENA = 0;</span><br><span class="line">LCD_RW = 0;</span><br><span class="line">LCD_RS  = 1;</span><br><span class="line"></span><br><span class="line">LCD_BusData(dat);</span><br><span class="line">LCD_DelayNop();</span><br><span class="line">LCD_ENA = 1;</span><br><span class="line">LCD_DelayNop();</span><br><span class="line">LCD_ENA = 0;</span><br><span class="line">LCD_BusData(0xff);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned char *uchartostr(unsigned num)//å°†ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸² æˆ–10è¿›åˆ¶</span><br><span class="line">&#123;</span><br><span class="line">unsigned char x2,x1,x0,i;</span><br><span class="line">x2=num/100;</span><br><span class="line">x1=num%100/10;</span><br><span class="line">x0=num%100%10;</span><br><span class="line">i=0;</span><br><span class="line">if(x2!=0)</span><br><span class="line">&#123;</span><br><span class="line">str[i]=x2+48;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">if(x1!=0)</span><br><span class="line">&#123;</span><br><span class="line">str[i]=x1+48;</span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">str[i]=x0+48;</span><br><span class="line">i++;</span><br><span class="line">str[i]=&#x27;\0&#x27;;</span><br><span class="line">return str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: void Initialize_LCD(void)</span><br><span class="line">// æè¿°: åˆå§‹åŒ–å‡½æ•°</span><br><span class="line">// å‚æ•°: none.</span><br><span class="line">// è¿”å›: none.</span><br><span class="line">// ç‰ˆæœ¬: VER1.0</span><br><span class="line">// æ—¥æœŸ: 2013-4-1</span><br><span class="line">// å¤‡æ³¨: </span><br><span class="line">//========================================================================</span><br><span class="line">void Initialize_LCD(void)</span><br><span class="line">&#123;</span><br><span class="line">LCD_ENA = 0;</span><br><span class="line">LCD_RS  = 0;</span><br><span class="line">LCD_RW = 0;</span><br><span class="line"></span><br><span class="line">delay_ms(100);</span><br><span class="line">IniSendCMD(C_BIT8);//set the data is 8 bits</span><br><span class="line"></span><br><span class="line">delay_ms(10);</span><br><span class="line">Write_CMD(C_L2DOT7);//tow lines 5*7 dots</span><br><span class="line"></span><br><span class="line">delay_ms(6);</span><br><span class="line">Write_CMD(C_CLEAR);//clear LCD RAM</span><br><span class="line">Write_CMD(C_CUR_R);//Curror Shift Right</span><br><span class="line">Write_CMD(C_ON);//turn on  LCD</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: void ClearLine(u8 row)</span><br><span class="line">// æè¿°: æ¸…é™¤1è¡Œ</span><br><span class="line">// å‚æ•°: row: è¡Œ(0æˆ–1)</span><br><span class="line">// è¿”å›: none.</span><br><span class="line">// ç‰ˆæœ¬: VER1.0</span><br><span class="line">// æ—¥æœŸ: 2013-4-1</span><br><span class="line">// å¤‡æ³¨: </span><br><span class="line">//========================================================================</span><br><span class="line">void ClearLine(u8 row)</span><br><span class="line">&#123;</span><br><span class="line">u8 i;</span><br><span class="line">Write_CMD(((row &amp; 1) &lt;&lt; 6) | 0x80);</span><br><span class="line">for(i=0; i&lt;LineLength; i++)Write_DIS_Data(&#x27; &#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: voidWriteChar(u8 row, u8 column, u8 dat)</span><br><span class="line">// æè¿°: æŒ‡å®šè¡Œã€åˆ—å’Œå­—ç¬¦, å†™ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">// å‚æ•°: row: è¡Œ(0æˆ–1),  column: ç¬¬å‡ ä¸ªå­—ç¬¦(0~15),  dat: è¦å†™çš„å­—ç¬¦.</span><br><span class="line">// è¿”å›: none.</span><br><span class="line">// ç‰ˆæœ¬: VER1.0</span><br><span class="line">// æ—¥æœŸ: 2013-4-1</span><br><span class="line">// å¤‡æ³¨: </span><br><span class="line">//========================================================================</span><br><span class="line">voidWriteChar(u8 row, u8 column, u8 dat)</span><br><span class="line">&#123;</span><br><span class="line">Write_CMD((((row &amp; 1) &lt;&lt; 6) + column) | 0x80);</span><br><span class="line">Write_DIS_Data(dat);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//========================================================================</span><br><span class="line">// å‡½æ•°: void PutString(u8 row, u8 column, u8 *puts)</span><br><span class="line">// æè¿°: å†™ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŒ‡å®šè¡Œã€åˆ—å’Œå­—ç¬¦ä¸²é¦–åœ°å€</span><br><span class="line">// å‚æ•°: row: è¡Œ(0æˆ–1),  column: ç¬¬å‡ ä¸ªå­—ç¬¦(0~15),  puts: è¦å†™çš„å­—ç¬¦ä¸²æŒ‡é’ˆ.</span><br><span class="line">// è¿”å›: none.</span><br><span class="line">// ç‰ˆæœ¬: VER1.0</span><br><span class="line">// æ—¥æœŸ: 2013-4-1</span><br><span class="line">// å¤‡æ³¨: </span><br><span class="line">//========================================================================</span><br><span class="line">void PutString(u8 row, u8 column, u8 *puts)</span><br><span class="line">&#123;</span><br><span class="line">Write_CMD((((row &amp; 1) &lt;&lt; 6) + column) | 0x80);</span><br><span class="line">for ( ;  *puts != 0;  puts++)//é‡åˆ°åœæ­¢ç¬¦0ç»“æŸ</span><br><span class="line">&#123;</span><br><span class="line">Write_DIS_Data(*puts);</span><br><span class="line">if(++column &gt;= LineLength)break;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">void WriteROM()//LCD1602å†…éƒ¨æ•°æ®å¯„å­˜å™¨å†™å…¥å‡½æ•°</span><br><span class="line">&#123;</span><br><span class="line">unsigned char i;</span><br><span class="line">Write_CMD(0x40); // æ“ä½œCGRAMçš„å‘½ä»¤ç </span><br><span class="line">for(i=0;i&lt;64;i++)            // å†™å…¥æ•°ç»„ä¸­æ•°æ®  </span><br><span class="line">&#123;</span><br><span class="line">Write_DIS_Data(table[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//******************** LCD20 Module END ***************************</span><br><span class="line">//****************************************************</span><br><span class="line">//èœ‚é¸£å™¨ç¨‹åº</span><br><span class="line">//****************************************************</span><br><span class="line">void Buzzer_Di(void)&#123;</span><br><span class="line">Buzzer = 0;</span><br><span class="line">delay_ms(3);</span><br><span class="line">Buzzer = 1;</span><br><span class="line">delay_ms(3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;&#x2F;*************æœ¬ç¨‹åºåŠŸèƒ½è¯´æ˜**************</p><p>é©±åŠ¨LCD1602å­—ç¬¦å±.</p><p>æ˜¾ç¤ºæ•ˆæœä¸º:  DS1302 + LCD1602æ˜¾ç¤ºæ—¶é—´</p><p>******************************************&#x2F;<br>#includeâ€œSTC15Fxxxx.Hâ€</p><p>#define T1MS (65536-MAIN_Fosc&#x2F;12&#x2F;1000)   &#x2F;&#x2F;12Tæ¨¡å¼1mså®šæ—¶<br>#define  interval  1000 &#x2F;&#x2F;è®¾ç½®å»¶æ—¶æ—¶é—´é—´éš”<br>&#x2F;*************æœ¬åœ°å˜é‡å£°æ˜**************&#x2F;<br>static volatile unsigned long sysRunmillis &#x3D; 0;&#x2F;&#x2F;ç³»ç»Ÿè¿è¡Œæ—¶é—´è®¡æ•°ï¼Œä¿å­˜å•ç‰‡æœºä»ä¸Šç”µå¤ä½ä»¥æ¥è¿è¡Œçš„æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚è¯¥æ•°å€¼ç”±å®šæ—¶å™¨T0çš„ä¸­æ–­å“åº”å­å‡½æ•°æ›´æ–°<br>unsigned long previousMillis &#x3D; 0;<br>unsigned char str[4];&#x2F;&#x2F;uchartostrå‡½æ•°è½¬æ¢çš„å­—ç¬¦ä¸² åŒæ—¶å¯ä»¥æŠŠ16è¿›åˆ¶è½¬æˆ10è¿›åˆ¶<br>sbit Buzzer &#x3D; P3^7;<br>unsigned char code table[]&#x3D;<br>{<br>    0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,        &#x2F;&#x2F; ä¸€ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x00<br>    0x00,0x00,0x00,0x0e,0x00,0xff,0x00,0x00,        &#x2F;&#x2F; äºŒï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x01<br>    0x00,0x00,0xff,0x00,0x0e,0x00,0xff,0x00,        &#x2F;&#x2F; ä¸‰ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x02<br>    0x00,0x00,0xff,0xf5,0xfb,0xf1,0xff,0x00,        &#x2F;&#x2F; å››ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x03<br>    0x00,0xfe,0x08,0xfe,0x0a,0x0a,0xff,0x00,        &#x2F;&#x2F; äº”ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x04<br>    0x00,0x04,0x00,0xff,0x00,0x0a,0x11,0x00,        &#x2F;&#x2F; å…­ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x05<br>    0x00,0x1f,0x11,0x1f,0x11,0x11,0x1f,0x00,        &#x2F;&#x2F; æ—¥ï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x06<br>    0x18,0x18,0x07,0x08,0x08,0x08,0x07,0x00,        &#x2F;&#x2F; â„ƒï¼Œæ˜¾ç¤ºæ—¶çš„ASCIIç  0x07<br>};</p><p>void Timer0Init(void);&#x2F;&#x2F;1æ¯«ç§’@12.000MHz<br>void  delay_ms(unsigned long ms);<br>voidInitialize_LCD(void);<br>voidWrite_AC(u8 hang,u8 lie);<br>voidWrite_DIS_Data(u8 DIS_Data);<br>void WriteROM();&#x2F;&#x2F;LCD1602å†…éƒ¨æ•°æ®å¯„å­˜å™¨å†™å…¥å‡½æ•°<br>voidClearLine(u8 row);<br>u8BIN_ASCII(u8 tmp);<br>void PutString(u8 row, u8 column, u8 *puts);<br>voidWriteChar(u8 row, u8 column, u8 dat);<br>void Buzzer_Di(void);<br>unsigned char *uchartostr(unsigned num);&#x2F;&#x2F;å°†ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸² æˆ–10è¿›åˆ¶<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: void main(void)<br>&#x2F;&#x2F; æè¿°: ä¸»å‡½æ•°ã€‚<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void main(void)<br>{<br>    unsigned long currentMillis;&#x2F;&#x2F;å½“å‰æ—¶é—´<br>    unsigned char i &#x3D;0;<br>    P0M1 &#x3D; 0;P0M0 &#x3D; 0;&#x2F;&#x2F;è®¾ç½®ä¸ºå‡†åŒå‘å£<br>    P1M1 &#x3D; 0;P1M0 &#x3D; 0;&#x2F;&#x2F;è®¾ç½®ä¸ºå‡†åŒå‘å£<br>    P2M1 &#x3D; 0;P2M0 &#x3D; 0;&#x2F;&#x2F;è®¾ç½®ä¸ºå‡†åŒå‘å£<br>    P3M1 &#x3D; 0;P3M0 &#x3D; 0;&#x2F;&#x2F;è®¾ç½®ä¸ºå‡†åŒå‘å£<br>    P4M1 &#x3D; 0;P4M0 &#x3D; 0;&#x2F;&#x2F;è®¾ç½®ä¸ºå‡†åŒå‘å£<br>    P5M1 &#x3D; 0;P5M0 &#x3D; 0;&#x2F;&#x2F;è®¾ç½®ä¸ºå‡†åŒå‘å£<br>    P6M1 &#x3D; 0;P6M0 &#x3D; 0;&#x2F;&#x2F;è®¾ç½®ä¸ºå‡†åŒå‘å£<br>    P7M1 &#x3D; 0;P7M0 &#x3D; 0;&#x2F;&#x2F;è®¾ç½®ä¸ºå‡†åŒå‘å£<br>    Timer0Init();&#x2F;&#x2F;1æ¯«ç§’@12.000MHz<br>    Initialize_LCD();&#x2F;&#x2F;LCDåˆå§‹åŒ–å‡½æ•°<br>    ClearLine(0);<br>    ClearLine(1);<br>    PutString(0,0,â€STC15W4Kâ€);<br>    WriteROM();   &#x2F;&#x2F; å°†è‡ªå®šä¹‰å­—å½¢ç å†™å…¥LCD1602å†…éƒ¨å­˜å‚¨å™¨<br>  WriteChar(1, 0, 0);<br>    WriteChar(1, 1, 1);<br>    WriteChar(1, 2, 2);<br>    WriteChar(1, 3, 3);<br>    WriteChar(1, 4, 4);<br>    WriteChar(1, 5, 5);<br>    WriteChar(1, 6, 6);<br>    WriteChar(1, 7, 7);<br>    while(1)<br>    {<br>        currentMillis &#x3D; sysRunmillis;<br>    if (currentMillis - previousMillis  &gt;&#x3D; interval)<br>        {&#x2F;&#x2F;æ¯éš”1ç§’ç¿»è½¬ä¸€æ¬¡<br>    previousMillis &#x3D; sysRunmillis;<br>        if(++i &lt;&#x3D; 255){<br>            PutString(0,9,uchartostr(i));<br>            WriteChar(0, 14, i);</p><pre><code>        PutString(1,9,uchartostr(255 -i));        WriteChar(1, 14, 255 -i);            &#125;    &#125;&#125;</code></pre><p>} </p><p>void Timer0Init(void)&#x2F;&#x2F;1æ¯«ç§’@12.000MHz<br>{<br>    AUXR &amp;&#x3D; 0x7F;&#x2F;&#x2F;å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼<br>    TMOD &amp;&#x3D; 0xF0;&#x2F;&#x2F;è®¾ç½®å®šæ—¶å™¨æ¨¡å¼<br>    TL0 &#x3D; T1MS ;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TH0 &#x3D; T1MS &gt;&gt;8;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>&#x2F;&#x2F;TL0 &#x3D; 0x18;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>&#x2F;&#x2F;TH0 &#x3D; 0xFC;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼</p><pre><code>TF0 = 0;//æ¸…é™¤TF0æ ‡å¿—TR0 = 1;//å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶ET0 = 1;     //enable timer0 interrupt</code></pre><p>  EA &#x3D; 1;      &#x2F;&#x2F;open global interrupt switch<br>}</p><p>&#x2F;* Timer0 interrupt routine *&#x2F;<br>void tm0_isr() interrupt 1<br>{<br>&#x2F;&#x2F;TL0 &#x3D; 0x18;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>&#x2F;&#x2F;TH0 &#x3D; 0xFC;&#x2F;&#x2F;è®¾ç½®å®šæ—¶åˆå§‹å€¼<br>    TL0 &#x3D; T1MS;                     &#x2F;&#x2F;reload timer0 low byte<br>    TH0 &#x3D; T1MS &gt;&gt; 8;                &#x2F;&#x2F;reload timer0 high byte<br>    sysRunmillis ++;<br>}</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: void  delay_ms(u8 ms)<br>&#x2F;&#x2F; æè¿°: å»¶æ—¶å‡½æ•°ã€‚<br>&#x2F;&#x2F; å‚æ•°: ms,è¦å»¶æ—¶çš„msæ•°, è¿™é‡Œåªæ”¯æŒ1~255ms. è‡ªåŠ¨é€‚åº”ä¸»æ—¶é’Ÿ.<br>&#x2F;&#x2F; è¿”å›: none.<br>&#x2F;&#x2F; ç‰ˆæœ¬: VER1.0<br>&#x2F;&#x2F; æ—¥æœŸ: 2013-4-1<br>&#x2F;&#x2F; å¤‡æ³¨:<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void  delay_ms(unsigned long ms)<br>{<br>    unsigned longtemp &#x3D; sysRunmillis ;<br>    while(sysRunmillis - temp &lt; ms );<br>&#x2F;&#x2F;     unsigned int i;<br>&#x2F;&#x2F; do{<br>&#x2F;&#x2F;      i &#x3D; MAIN_Fosc &#x2F; 13000;<br>&#x2F;&#x2F;  while(â€“i);   &#x2F;&#x2F;14T per loop<br>&#x2F;&#x2F;     }while(â€“ms);<br>}</p><p>&#x2F;************* LCD1602ç›¸å…³ç¨‹åº*****************************************************&#x2F;<br>&#x2F;&#x2F;8ä½æ•°æ®è®¿é—®æ–¹å¼LCD1602æ ‡å‡†ç¨‹åºæ¢å·¥ç¼–å†™2014-2-21</p><p>#define LineLength16&#x2F;&#x2F;16x2</p><p>&#x2F;*************Pin define*****************************************************&#x2F;</p><p>sfrLCD_BUS &#x3D; 0x80;&#x2F;&#x2F;P0â€“0x80, P1â€“0x90, P2â€“0xA0, P3â€“0xB0</p><p>sbitLCD_B7  &#x3D; LCD_BUS^7;&#x2F;&#x2F;D7 â€“ Pin 14LED- â€“ Pin 16<br>sbitLCD_B6  &#x3D; LCD_BUS^6;&#x2F;&#x2F;D6 â€“ Pin 13LED+ â€“ Pin 15<br>sbitLCD_B5  &#x3D; LCD_BUS^5;&#x2F;&#x2F;D5 â€“ Pin 12Vo   â€“ Pin 3<br>sbitLCD_B4  &#x3D; LCD_BUS^4;&#x2F;&#x2F;D4 â€“ Pin 11VDD  â€“ Pin 2<br>sbitLCD_B3  &#x3D; LCD_BUS^3;&#x2F;&#x2F;D3 â€“ Pin 10VSS  â€“ Pin 1<br>sbitLCD_B2  &#x3D; LCD_BUS^2;&#x2F;&#x2F;D2 â€“ Pin  9<br>sbitLCD_B1  &#x3D; LCD_BUS^1;&#x2F;&#x2F;D1 â€“ Pin  8<br>sbitLCD_B0  &#x3D; LCD_BUS^0;&#x2F;&#x2F;D0 â€“ Pin  7</p><p>sbitLCD_ENA&#x3D; P2^2;&#x2F;&#x2F;Pin 6<br>sbitLCD_RW&#x3D; P2^1;&#x2F;&#x2F;Pin 5&#x2F;&#x2F;LCD_RS   R&#x2F;W   DB7â€“DB0        FOUNCTION<br>sbitLCD_RS&#x3D; P2^0;&#x2F;&#x2F;Pin 4&#x2F;&#x2F;00  INPUT      write the command to LCD model<br>                                &#x2F;&#x2F;01     OUTPUT     read BF and AC pointer from LCD model<br>                                &#x2F;&#x2F;10     INPUT      write the data to LCD  model<br>                                &#x2F;&#x2F;11     OUTPUT     read the data from LCD model<br>&#x2F;*<br>total 2 lines, 16x2&#x3D; 32<br>first line address:  0<del>15<br>second line address: 64</del>79</p><p>*&#x2F;</p><p>#define C_CLEAR0x01&#x2F;&#x2F;clear LCD<br>#define C_HOME 0x02&#x2F;&#x2F;cursor go home<br>#define C_CUR_L0x04&#x2F;&#x2F;cursor shift left after input<br>#define C_RIGHT0x05&#x2F;&#x2F;picture shift right after input<br>#define C_CUR_R0x06&#x2F;&#x2F;cursor shift right after input<br>#define C_LEFT 0x07&#x2F;&#x2F;picture shift left after input<br>#define C_OFF  0x08&#x2F;&#x2F;turn off LCD<br>#define C_ON   0x0C&#x2F;&#x2F;turn on  LCD<br>#define C_FLASH0x0D&#x2F;&#x2F;turn on  LCD, flash<br>#define C_CURSOR0x0E&#x2F;&#x2F;turn on  LCD and cursor<br>#define C_FLASH_ALL0x0F&#x2F;&#x2F;turn on  LCD and cursor, flash<br>#define C_CURSOR_LEFT0x10&#x2F;&#x2F;single cursor shift left<br>#define C_CURSOR_RIGHT0x10&#x2F;&#x2F;single cursor shift right<br>#define C_PICTURE_LEFT0x10&#x2F;&#x2F;single picture shift left<br>#define C_PICTURE_RIGHT0x10&#x2F;&#x2F;single picture shift right<br>#define C_BIT80x30&#x2F;&#x2F;set the data is 8 bits<br>#define C_BIT40x20&#x2F;&#x2F;set the data is 4 bits<br>#define C_L1DOT70x30&#x2F;&#x2F;8 bits,one line 5<em>7  dots<br>#define C_L1DOT100x34&#x2F;&#x2F;8 bits,one line 5</em>10 dots<br>#define C_L2DOT70x38&#x2F;&#x2F;8 bits,tow lines 5<em>7 dots<br>#define C_4bitL2DOT70x28&#x2F;&#x2F;4 bits,tow lines 5</em>7 dots<br>#define C_CGADDRESS00x40&#x2F;&#x2F;CGRAM address0 (addr&#x3D;40H+x)<br>#define C_DDADDRESS00x80&#x2F;&#x2F;DDRAM address0 (addr&#x3D;80H+x)</p><p>#defineLCD_DelayNop()NOP(15)</p><p>#defineLCD_BusData(dat)LCD_BUS &#x3D; dat</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: voidCheckBusy(void)<br>&#x2F;&#x2F; æè¿°: æ£€æµ‹å¿™å‡½æ•°<br>&#x2F;&#x2F; å‚æ•°: none.<br>&#x2F;&#x2F; è¿”å›: none.<br>&#x2F;&#x2F; ç‰ˆæœ¬: VER1.0<br>&#x2F;&#x2F; æ—¥æœŸ: 2013-4-1<br>&#x2F;&#x2F; å¤‡æ³¨:<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>voidCheckBusy(void)<br>{<br>    u16i;<br>    for(i&#x3D;0; i&lt;5000; i++){if(!LCD_B7)break;}&#x2F;&#x2F;check the LCD busy or not. With time out<br>&#x2F;&#x2F;while(LCD_B7);&#x2F;&#x2F;check the LCD busy or not. Without time out<br>}</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: void IniSendCMD(u8 cmd)<br>&#x2F;&#x2F; æè¿°: åˆå§‹åŒ–å†™å‘½ä»¤(ä¸æ£€æµ‹å¿™)<br>&#x2F;&#x2F; å‚æ•°: cmd: è¦å†™çš„å‘½ä»¤.<br>&#x2F;&#x2F; è¿”å›: none.<br>&#x2F;&#x2F; ç‰ˆæœ¬: VER1.0<br>&#x2F;&#x2F; æ—¥æœŸ: 2013-4-1<br>&#x2F;&#x2F; å¤‡æ³¨:<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void IniSendCMD(u8 cmd)<br>{<br>    LCD_RW &#x3D; 0;<br>    LCD_BusData(cmd);<br>    LCD_DelayNop();<br>    LCD_ENA &#x3D; 1;<br>    LCD_DelayNop();<br>    LCD_ENA &#x3D; 0;<br>    LCD_BusData(0xff);<br>}</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: void Write_CMD(u8 cmd)<br>&#x2F;&#x2F; æè¿°: å†™å‘½ä»¤(æ£€æµ‹å¿™)<br>&#x2F;&#x2F; å‚æ•°: cmd: è¦å†™çš„å‘½ä»¤.<br>&#x2F;&#x2F; è¿”å›: none.<br>&#x2F;&#x2F; ç‰ˆæœ¬: VER1.0<br>&#x2F;&#x2F; æ—¥æœŸ: 2013-4-1<br>&#x2F;&#x2F; å¤‡æ³¨:<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void Write_CMD(u8 cmd)<br>{<br>    LCD_RS  &#x3D; 0;<br>    LCD_RW &#x3D; 1;<br>    LCD_BusData(0xff);<br>    LCD_DelayNop();<br>    LCD_ENA &#x3D; 1;<br>    CheckBusy();&#x2F;&#x2F;check the LCD busy or not.<br>    LCD_ENA &#x3D; 0;<br>    LCD_RW &#x3D; 0;</p><pre><code>LCD_BusData(cmd);LCD_DelayNop();LCD_ENA = 1;LCD_DelayNop();LCD_ENA = 0;LCD_BusData(0xff);</code></pre><p>}</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: void Write_DIS_Data(u8 dat)<br>&#x2F;&#x2F; æè¿°: å†™æ˜¾ç¤ºæ•°æ®(æ£€æµ‹å¿™)<br>&#x2F;&#x2F; å‚æ•°: dat: è¦å†™çš„æ•°æ®.<br>&#x2F;&#x2F; è¿”å›: none.<br>&#x2F;&#x2F; ç‰ˆæœ¬: VER1.0<br>&#x2F;&#x2F; æ—¥æœŸ: 2013-4-1<br>&#x2F;&#x2F; å¤‡æ³¨:<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void Write_DIS_Data(u8 dat)<br>{<br>    LCD_RS &#x3D; 0;<br>    LCD_RW &#x3D; 1;</p><pre><code>LCD_BusData(0xff);LCD_DelayNop();LCD_ENA = 1;CheckBusy();//check the LCD busy or not.LCD_ENA = 0;LCD_RW = 0;LCD_RS  = 1;LCD_BusData(dat);LCD_DelayNop();LCD_ENA = 1;LCD_DelayNop();LCD_ENA = 0;LCD_BusData(0xff);</code></pre><p>}</p><p>unsigned char *uchartostr(unsigned num)&#x2F;&#x2F;å°†ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸² æˆ–10è¿›åˆ¶<br>{<br>    unsigned char x2,x1,x0,i;<br>    x2&#x3D;num&#x2F;100;<br>    x1&#x3D;num%100&#x2F;10;<br>    x0&#x3D;num%100%10;<br>    i&#x3D;0;<br>    if(x2!&#x3D;0)<br>    {<br>        str[i]&#x3D;x2+48;<br>        i++;<br>    }<br>    if(x1!&#x3D;0)<br>    {<br>        str[i]&#x3D;x1+48;<br>        i++;<br>    }<br>    str[i]&#x3D;x0+48;<br>    i++;<br>    str[i]&#x3D;â€™\0â€™;<br>    return str;<br>}</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: void Initialize_LCD(void)<br>&#x2F;&#x2F; æè¿°: åˆå§‹åŒ–å‡½æ•°<br>&#x2F;&#x2F; å‚æ•°: none.<br>&#x2F;&#x2F; è¿”å›: none.<br>&#x2F;&#x2F; ç‰ˆæœ¬: VER1.0<br>&#x2F;&#x2F; æ—¥æœŸ: 2013-4-1<br>&#x2F;&#x2F; å¤‡æ³¨:<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void Initialize_LCD(void)<br>{<br>    LCD_ENA &#x3D; 0;<br>    LCD_RS  &#x3D; 0;<br>    LCD_RW &#x3D; 0;</p><pre><code>delay_ms(100);IniSendCMD(C_BIT8);//set the data is 8 bitsdelay_ms(10);Write_CMD(C_L2DOT7);//tow lines 5*7 dotsdelay_ms(6);Write_CMD(C_CLEAR);//clear LCD RAMWrite_CMD(C_CUR_R);//Curror Shift RightWrite_CMD(C_ON);//turn on  LCD</code></pre><p>}</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: void ClearLine(u8 row)<br>&#x2F;&#x2F; æè¿°: æ¸…é™¤1è¡Œ<br>&#x2F;&#x2F; å‚æ•°: row: è¡Œ(0æˆ–1)<br>&#x2F;&#x2F; è¿”å›: none.<br>&#x2F;&#x2F; ç‰ˆæœ¬: VER1.0<br>&#x2F;&#x2F; æ—¥æœŸ: 2013-4-1<br>&#x2F;&#x2F; å¤‡æ³¨:<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void ClearLine(u8 row)<br>{<br>    u8 i;<br>    Write_CMD(((row &amp; 1) &lt;&lt; 6) | 0x80);<br>    for(i&#x3D;0; i&lt;LineLength; i++)Write_DIS_Data(â€˜ â€˜);<br>}</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: voidWriteChar(u8 row, u8 column, u8 dat)<br>&#x2F;&#x2F; æè¿°: æŒ‡å®šè¡Œã€åˆ—å’Œå­—ç¬¦, å†™ä¸€ä¸ªå­—ç¬¦<br>&#x2F;&#x2F; å‚æ•°: row: è¡Œ(0æˆ–1),  column: ç¬¬å‡ ä¸ªå­—ç¬¦(0~15),  dat: è¦å†™çš„å­—ç¬¦.<br>&#x2F;&#x2F; è¿”å›: none.<br>&#x2F;&#x2F; ç‰ˆæœ¬: VER1.0<br>&#x2F;&#x2F; æ—¥æœŸ: 2013-4-1<br>&#x2F;&#x2F; å¤‡æ³¨:<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>voidWriteChar(u8 row, u8 column, u8 dat)<br>{<br>    Write_CMD((((row &amp; 1) &lt;&lt; 6) + column) | 0x80);<br>    Write_DIS_Data(dat);<br>}</p><p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F; å‡½æ•°: void PutString(u8 row, u8 column, u8 *puts)<br>&#x2F;&#x2F; æè¿°: å†™ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒæŒ‡å®šè¡Œã€åˆ—å’Œå­—ç¬¦ä¸²é¦–åœ°å€<br>&#x2F;&#x2F; å‚æ•°: row: è¡Œ(0æˆ–1),  column: ç¬¬å‡ ä¸ªå­—ç¬¦(0~15),  puts: è¦å†™çš„å­—ç¬¦ä¸²æŒ‡é’ˆ.<br>&#x2F;&#x2F; è¿”å›: none.<br>&#x2F;&#x2F; ç‰ˆæœ¬: VER1.0<br>&#x2F;&#x2F; æ—¥æœŸ: 2013-4-1<br>&#x2F;&#x2F; å¤‡æ³¨:<br>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>void PutString(u8 row, u8 column, u8 *puts)<br>{<br>    Write_CMD((((row &amp; 1) &lt;&lt; 6) + column) | 0x80);<br>    for ( ;  *puts !&#x3D; 0;  puts++)&#x2F;&#x2F;é‡åˆ°åœæ­¢ç¬¦0ç»“æŸ<br>    {<br>        Write_DIS_Data(*puts);<br>        if(++column &gt;&#x3D; LineLength)break;<br>    }<br>}<br>void WriteROM()&#x2F;&#x2F;LCD1602å†…éƒ¨æ•°æ®å¯„å­˜å™¨å†™å…¥å‡½æ•°<br>{<br>        unsigned char i;<br>    Write_CMD(0x40); &#x2F;&#x2F; æ“ä½œCGRAMçš„å‘½ä»¤ç <br>    for(i&#x3D;0;i&lt;64;i++)            &#x2F;&#x2F; å†™å…¥æ•°ç»„ä¸­æ•°æ®<br>    {<br>        Write_DIS_Data(table[i]);<br>    }<br>}</p><p>&#x2F;&#x2F;******************** LCD20 Module END ***************************<br>&#x2F;&#x2F;****************************************************<br>&#x2F;&#x2F;èœ‚é¸£å™¨ç¨‹åº<br>&#x2F;&#x2F;****************************************************<br>void Buzzer_Di(void){<br>    Buzzer &#x3D; 0;<br>    delay_ms(3);<br>    Buzzer &#x3D; 1;<br>    delay_ms(3);<br>}&#96;</p><h4 id="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"><a href="#ç¨‹åºæºç å’Œä»¿çœŸèµ„æº" class="headerlink" title="ç¨‹åºæºç å’Œä»¿çœŸèµ„æº"></a>ç¨‹åºæºç å’Œä»¿çœŸèµ„æº</h4><p>æœ¬å®éªŒåŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Q7PCk5sDC2lwsVZjvHmvlw </span><br><span class="line">æå–ç ï¼špzl3//è¯·ä½¿ç”¨å¤åˆ¶ç²˜è´´å‘½ä»¤ï¼Œæ‰‹å·¥è¾“å…¥å®¹æ˜“å‡ºé”™</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Q7PCk5sDC2lwsVZjvHmvlw  æå–ç ï¼špzl3//è¯·ä½¿ç”¨å¤åˆ¶ç²˜è´´å‘½ä»¤ï¼Œæ‰‹å·¥è¾“å…¥å®¹æ˜“å‡ºé”™</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Proteusä»¿çœŸã€‘ç”¨24C04ä¸1602LCDè®¾è®¡çš„ç®€æ˜“åŠ å¯†ç”µå­å¯†ç é”</title>
      <link href="/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%94%A824C04%E4%B8%8E1602LCD%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%AE%80%E6%98%93%E5%8A%A0%E5%AF%86%E7%94%B5%E5%AD%90%E5%AF%86%E7%A0%81%E9%94%81/"/>
      <url>/2024/03/Proteus-Proteus%E4%BB%BF%E7%9C%9F%E7%94%A824C04%E4%B8%8E1602LCD%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%AE%80%E6%98%93%E5%8A%A0%E5%AF%86%E7%94%B5%E5%AD%90%E5%AF%86%E7%A0%81%E9%94%81/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="ã€Proteusä»¿çœŸã€‘ç”¨24C04ä¸1602LCDè®¾è®¡çš„ç®€æ˜“åŠ å¯†ç”µå­å¯†ç é”"><a href="#ã€Proteusä»¿çœŸã€‘ç”¨24C04ä¸1602LCDè®¾è®¡çš„ç®€æ˜“åŠ å¯†ç”µå­å¯†ç é”" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ç”¨24C04ä¸1602LCDè®¾è®¡çš„ç®€æ˜“åŠ å¯†ç”µå­å¯†ç é”"></a>ã€Proteusä»¿çœŸã€‘ç”¨24C04ä¸1602LCDè®¾è®¡çš„ç®€æ˜“åŠ å¯†ç”µå­å¯†ç é”</h1><h3 id="ã€Proteusä»¿çœŸã€‘ç”¨24C04ä¸1602LCDè®¾è®¡çš„ç®€æ˜“åŠ å¯†ç”µå­å¯†ç é”-1"><a href="#ã€Proteusä»¿çœŸã€‘ç”¨24C04ä¸1602LCDè®¾è®¡çš„ç®€æ˜“åŠ å¯†ç”µå­å¯†ç é”-1" class="headerlink" title="ã€Proteusä»¿çœŸã€‘ç”¨24C04ä¸1602LCDè®¾è®¡çš„ç®€æ˜“åŠ å¯†ç”µå­å¯†ç é”"></a>ã€Proteusä»¿çœŸã€‘ç”¨24C04ä¸1602LCDè®¾è®¡çš„ç®€æ˜“åŠ å¯†ç”µå­å¯†ç é”</h3><ul><li>Proteusä»¿çœŸæ¼”ç¤º</li><li>VSCode æ¼”ç¤ºç”ŸæˆBINæ–‡ä»¶</li></ul><p>Proteusä»¿çœŸæ¼”ç¤º</p><p><img src="https://img-blog.csdnimg.cn/198cd9c897614743b28f99c45fdb21f4.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>VSCode æ¼”ç¤ºç”ŸæˆBINæ–‡ä»¶</p><p><code>VSCode</code></p><p><code>BIN</code></p><p><img src="https://img-blog.csdnimg.cn/38c3072c2faf45cb98d21819214ba205.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="24C04å¯†ç å­—åº“ç”Ÿæˆæ–¹æ³•"><a href="#24C04å¯†ç å­—åº“ç”Ÿæˆæ–¹æ³•" class="headerlink" title="24C04å¯†ç å­—åº“ç”Ÿæˆæ–¹æ³•"></a>24C04å¯†ç å­—åº“ç”Ÿæˆæ–¹æ³•</h4><ul><li>éœ€è¦ä½¿ç”¨VSCodeæ¥ç¼–è¯‘ç”Ÿæˆã€‚</li><li>å‰ææ˜¯éœ€è¦å…ˆæŒ‰ç…§Code Runneræ’ä»¶ã€‚</li></ul><p><code>VSCode</code></p><p><img src="https://img-blog.csdnimg.cn/26af65f1f0074f79a4070223fcc7f650.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><code>Code Runner</code></p><p><img src="https://img-blog.csdnimg.cn/441287ab3d064ab1a41f887dd285ac1d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/fe91e54956654ac991d1a27c0f8d94f8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>.ccpæ–‡ä»¶</li></ul><p><code>.ccp</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  FILE *fp;</span><br><span class="line">  fp = fopen(&quot;24c04a.bin&quot;,&quot;wb&quot;);//ç¼–è¯‘æ—¶åœ¨é¡¹ç›®æ–‡ä»¶å¤¹å†…ç”ŸæˆäºŒè¿›åˆ¶24c04a.binæ–‡ä»¶</span><br><span class="line">  fwrite(&quot;654321\x0&quot;,1,7,fp);//å†™å…¥çš„å†…å®¹</span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>#include &lt;stdio.h&gt; int main() &#123;   FILE *fp;   fp = fopen(&quot;24c04a.bin&quot;,&quot;wb&quot;);//ç¼–è¯‘æ—¶åœ¨é¡¹ç›®æ–‡ä»¶å¤¹å†…ç”ŸæˆäºŒè¿›åˆ¶24c04a.binæ–‡ä»¶   fwrite(&quot;654321\x0&quot;,1,7,fp);//å†™å…¥çš„å†…å®¹   fclose(fp);   return 0; &#125;</code></p><h4 id="ç¨‹åºæºç "><a href="#ç¨‹åºæºç " class="headerlink" title="ç¨‹åºæºç "></a>ç¨‹åºæºç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;reg51.h&gt;</span><br><span class="line">#include&lt;string.h&gt;</span><br><span class="line">#include&lt;intrins.h&gt;</span><br><span class="line">#define uchar unsigned char</span><br><span class="line">#define uint unsigned int</span><br><span class="line">#define     LCDIO      P0</span><br><span class="line">#define delay4us() _nop_();_nop_();_nop_();_nop_();</span><br><span class="line">uchar buffer[6]=&#123;0&#125;; </span><br><span class="line">sbit sda=P3^3;</span><br><span class="line">sbit scl=P3^2;</span><br><span class="line">sbit beep=P3^7;</span><br><span class="line">bit  flag=0,aa;        //ç”¨æˆ·è¹²æ¸Šä¹‰å®šæ—¶æº¢å‡ºæ ‡å¿—ä½</span><br><span class="line">uchar  DSY_BUFFER[16]=&quot;                &quot;;</span><br><span class="line">uchar  DSY_BUFFER1[16]=&quot;                &quot;;</span><br><span class="line">uchar  Userpassword[6]=&#123;0&#125;;</span><br><span class="line">sbit  rs=P2^0;  </span><br><span class="line">sbit  rd=P2^1;</span><br><span class="line">sbit  lcden=P2^2;</span><br><span class="line">sbit  led=P2^7;</span><br><span class="line">uchar code table2[]=&quot;123456&quot;;</span><br><span class="line">uchar code table[]=&quot;Your Password...&quot;;</span><br><span class="line">void delayms(uint z)</span><br><span class="line">&#123;</span><br><span class="line">  uint x,y;</span><br><span class="line">  for(x=z;x&gt;0;x--)</span><br><span class="line">    for(y=110;y&gt;0;y--);</span><br><span class="line">&#125;</span><br><span class="line">void delay()      //çŸ­å»¶æ—¶ï¼Œä¸¤ä¸ªæœºå™¨å‘¨æœŸ,åšæ€»çº¿çš„å»¶æ—¶ç”¨</span><br><span class="line">&#123;;;&#125;</span><br><span class="line">void write_com(uchar com)</span><br><span class="line">&#123;</span><br><span class="line">  rs=0;</span><br><span class="line">  rd=0;</span><br><span class="line">  lcden=0;</span><br><span class="line">  P0=com;</span><br><span class="line">  delayms(3);</span><br><span class="line">  lcden=1;</span><br><span class="line">  delayms(3);</span><br><span class="line">  lcden=0;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void write_date(uchar date)</span><br><span class="line">&#123;</span><br><span class="line">  rs=1;</span><br><span class="line">  rd=0;</span><br><span class="line">  lcden=0;</span><br><span class="line">  P0=date;</span><br><span class="line">  delayms(3);</span><br><span class="line">  lcden=1;</span><br><span class="line">  delayms(3);</span><br><span class="line">  lcden=0;  </span><br><span class="line">&#125;</span><br><span class="line">void Display_String(uchar *p,uchar com)</span><br><span class="line">&#123;  uchar i;</span><br><span class="line">   write_com(com);</span><br><span class="line">   for(i=0;i&lt;16;i++)</span><br><span class="line">   &#123;</span><br><span class="line">   write_date(p[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">void init_lcd()</span><br><span class="line">&#123;</span><br><span class="line">  lcden=0;</span><br><span class="line">  write_com(0x38);</span><br><span class="line">  write_com(0x0c);</span><br><span class="line">  write_com(0x06);</span><br><span class="line">  write_com(0x01);</span><br><span class="line">  write_com(0x80);</span><br><span class="line">    Display_String(table,0x80);</span><br><span class="line">  Display_String(&quot;Lock OK!         &quot;,0xc0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void start()</span><br><span class="line">&#123;</span><br><span class="line">  sda=1;</span><br><span class="line">  scl=1;</span><br><span class="line">  delay4us();</span><br><span class="line">  sda=0;</span><br><span class="line">  delay4us();</span><br><span class="line">  scl=0;</span><br><span class="line">&#125;</span><br><span class="line">void stop()</span><br><span class="line">&#123;</span><br><span class="line">  sda=0;</span><br><span class="line">  scl=1;</span><br><span class="line">  delay4us();</span><br><span class="line">  sda=1;</span><br><span class="line">  delay4us();</span><br><span class="line">  scl=0;</span><br><span class="line">&#125;</span><br><span class="line">void init()              //åˆå§‹åŒ–</span><br><span class="line">&#123;</span><br><span class="line">sda=1;</span><br><span class="line">delay();</span><br><span class="line">scl=1;</span><br><span class="line">delay();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void ack()</span><br><span class="line">&#123;</span><br><span class="line">  sda=0;</span><br><span class="line">  scl=1;</span><br><span class="line">  delay4us();</span><br><span class="line">  scl=0;</span><br><span class="line">  sda=1;</span><br><span class="line">&#125;</span><br><span class="line">void noack()</span><br><span class="line">&#123;</span><br><span class="line">  sda=1;</span><br><span class="line">  scl=1;</span><br><span class="line">  delay4us();</span><br><span class="line">  scl=0;</span><br><span class="line">  sda=0;</span><br><span class="line">&#125;</span><br><span class="line">uchar recbyte()</span><br><span class="line">&#123;</span><br><span class="line">  uchar i,rd;</span><br><span class="line">  rd=0x00;</span><br><span class="line">  sda=1;</span><br><span class="line">  for(i=0;i&lt;8;i++)</span><br><span class="line">  &#123;</span><br><span class="line">    scl=1;</span><br><span class="line">    rd&lt;&lt;=1;</span><br><span class="line">    rd|=sda;</span><br><span class="line">    delay4us();</span><br><span class="line">    scl=0;</span><br><span class="line">    delay4us();</span><br><span class="line">  &#125;</span><br><span class="line">  scl=0;</span><br><span class="line">  delay4us();</span><br><span class="line">  return rd;</span><br><span class="line">&#125;</span><br><span class="line">uchar sendbyte(uchar wd)</span><br><span class="line">&#123;</span><br><span class="line">  uchar i;</span><br><span class="line">  bit ack0;</span><br><span class="line">  for(i=0;i&lt;8;i++)</span><br><span class="line">  &#123;</span><br><span class="line">    sda=(bit)(wd&amp;0x80);</span><br><span class="line">    _nop_();</span><br><span class="line">    _nop_();</span><br><span class="line">    scl=1;</span><br><span class="line">    delay4us();</span><br><span class="line">    scl=0;</span><br><span class="line">    wd&lt;&lt;=1;</span><br><span class="line">  &#125;</span><br><span class="line">  delay4us();</span><br><span class="line">  sda=1;</span><br><span class="line">  scl=1;</span><br><span class="line">  delay4us();</span><br><span class="line">  ack0=!sda;</span><br><span class="line">  scl=0;</span><br><span class="line">  delay4us();</span><br><span class="line">  return ack0;</span><br><span class="line">&#125;</span><br><span class="line">uchar Recstring(uchar slave,uchar subaddr,uchar *buffer,uchar n)</span><br><span class="line">&#123;</span><br><span class="line"> uchar i; </span><br><span class="line"> start();</span><br><span class="line"> if(!sendbyte(slave)) return 0;</span><br><span class="line"> if(!sendbyte(subaddr)) return 0;</span><br><span class="line"> start();</span><br><span class="line"> if(!sendbyte(slave+1)) return 0;</span><br><span class="line"> for(i=0;i&lt;n-1;i++)</span><br><span class="line">  &#123;</span><br><span class="line">    buffer[i]=recbyte();</span><br><span class="line">  ack();</span><br><span class="line">  &#125;</span><br><span class="line"> buffer[n-1]=recbyte();</span><br><span class="line"> noack();</span><br><span class="line"> stop();</span><br><span class="line"> return 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uchar Sendstring(uchar slave,uchar subaddr,uchar *buffer,uchar n)</span><br><span class="line">&#123;</span><br><span class="line">  uchar i;</span><br><span class="line">  start();</span><br><span class="line">  if(!sendbyte(slave)) return 0;</span><br><span class="line">  if(!sendbyte(subaddr)) return 0;</span><br><span class="line">  for(i=0;i&lt;n;i++)</span><br><span class="line">  &#123;</span><br><span class="line">    if(!sendbyte(buffer[i])) return 0;</span><br><span class="line">  &#125;</span><br><span class="line">  stop();</span><br><span class="line">  return 1;</span><br><span class="line">&#125;</span><br><span class="line">void clear_password( )</span><br><span class="line">&#123;  uchar i;</span><br><span class="line">  for(i=0;i&lt;6;i++)</span><br><span class="line">  &#123;</span><br><span class="line">   Userpassword[i]=&#x27; &#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">  for(i=0;i&lt;16;i++)</span><br><span class="line">  &#123;</span><br><span class="line">     DSY_BUFFER[i]=&#x27; &#x27;;   </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">uchar Keys_Scan()</span><br><span class="line">&#123;  </span><br><span class="line">  uchar temp,keynum;</span><br><span class="line">  P1=0x0F;</span><br><span class="line">  delayms(5);</span><br><span class="line">  temp=P1^0x0F;</span><br><span class="line">  switch(temp)</span><br><span class="line">  &#123;</span><br><span class="line">    case 1:keynum=0;break;</span><br><span class="line">    case 2:keynum=1;break;</span><br><span class="line">    case 4:keynum=2;break;</span><br><span class="line">    case 8:keynum=3;break;</span><br><span class="line">    break;</span><br><span class="line">  &#125;</span><br><span class="line">  P1=0xF0;</span><br><span class="line">  delayms(5);</span><br><span class="line">  temp=P1&gt;&gt;4^0x0F;</span><br><span class="line">  switch(temp)</span><br><span class="line">  &#123;</span><br><span class="line">    case 1:keynum+=0;break;</span><br><span class="line">    case 2:keynum+=4;break;</span><br><span class="line">    case 4:keynum+=8;break;</span><br><span class="line">    case 8:keynum+=12;break;</span><br><span class="line">    break;</span><br><span class="line">  &#125;</span><br><span class="line">  delayms(600);</span><br><span class="line">   return keynum;</span><br><span class="line">&#125;</span><br><span class="line">void main()</span><br><span class="line">&#123;   uchar temp,i=0,j=0,k=0,n;</span><br><span class="line">  uchar IS_valid_user; </span><br><span class="line">  beep=1;</span><br><span class="line">  init();      </span><br><span class="line">    init_lcd();</span><br><span class="line">  delayms(5);</span><br><span class="line">  aa=Sendstring(0xa0,1,table2,6);</span><br><span class="line">  delayms(5);</span><br><span class="line">  aa=Recstring(0xa0,1,buffer,6);</span><br><span class="line">  delayms(10);</span><br><span class="line">   P1=0x0f;     </span><br><span class="line">    while(1)</span><br><span class="line">    &#123; </span><br><span class="line">     </span><br><span class="line">      if(P1!=0x0f)</span><br><span class="line">      &#123;  </span><br><span class="line">          temp=Keys_Scan();</span><br><span class="line">          switch(temp)</span><br><span class="line">                 &#123;</span><br><span class="line">                       case 0:  case 1: case 2: case 3: case 4: </span><br><span class="line">                       case 5:  case 6: case 7: case 8: case 9:</span><br><span class="line">                        </span><br><span class="line">                       if (i&lt;=5)             //å¯†ç é™åˆ¶åœ¨6ä½ä»¥å†…</span><br><span class="line">                       &#123;</span><br><span class="line">                        Userpassword[i]=temp;</span><br><span class="line">                        DSY_BUFFER[i]=&#x27;*&#x27;;</span><br><span class="line">                        Display_String(DSY_BUFFER,0xc0);    </span><br><span class="line">            i++;</span><br><span class="line">                         &#125;                </span><br><span class="line">                        break;</span><br><span class="line">                </span><br><span class="line">                        case 10: //æŒ‰Aé”®å¼€é”</span><br><span class="line">            for(k=0;k&lt;6;k++)</span><br><span class="line">            &#123;</span><br><span class="line">              if(buffer[k]==(Userpassword[k]+48))</span><br><span class="line">              flag=1;</span><br><span class="line">              else</span><br><span class="line">              flag=0;</span><br><span class="line">            &#125;</span><br><span class="line">                        if (flag==1) </span><br><span class="line">                        &#123; flag=0;</span><br><span class="line">              i=0;</span><br><span class="line">                          led=0;  //ç‚¹äº®LED</span><br><span class="line">                           clear_password();</span><br><span class="line">                           Display_String(&quot;OPEN    OK!      &quot;,0xc0);</span><br><span class="line">                           IS_valid_user = 1;</span><br><span class="line">               j=0;</span><br><span class="line">                        &#125;</span><br><span class="line">                       else </span><br><span class="line">                        &#123; </span><br><span class="line">             j++;</span><br><span class="line">                         led=1;   //å…³é—­LED</span><br><span class="line">                         clear_password();</span><br><span class="line">                         Display_String(&quot;ERROR!Have try   &quot;,0xc0);</span><br><span class="line">             write_com(0xcf);</span><br><span class="line">             write_date(0x30+j);</span><br><span class="line">                         IS_valid_user=0;</span><br><span class="line">                         &#125;</span><br><span class="line">                        i=0;</span><br><span class="line">                        break;</span><br><span class="line">                    </span><br><span class="line">                      case 11: //æŒ‰Bé”®ä¸Šé”</span><br><span class="line">                      led=1;   </span><br><span class="line">                      clear_password();</span><br><span class="line">                      Display_String(table,0x80);</span><br><span class="line">                      Display_String(&quot;Lock OK!         &quot;,0xc0);</span><br><span class="line">                      i=0;                         </span><br><span class="line">                      IS_valid_user=0;               </span><br><span class="line">                      break;</span><br><span class="line">                                   </span><br><span class="line">                      case 12: //æŒ‰Cé”®è®¾ç½®æ–°å¯†ç </span><br><span class="line">                       //å¦‚æœæ˜¯åˆæ³•ç”¨æˆ·åˆ™æç¤ºè¾“å…¥æ–°å¯†ç     </span><br><span class="line">                      if ( !IS_valid_user) </span><br><span class="line">            &#123;</span><br><span class="line">             i=0;</span><br><span class="line">             Display_String(&quot;No rights !      &quot;,0xc0);</span><br><span class="line">             delayms(1000);</span><br><span class="line">             Display_String(&quot;Your Password...&quot;,0x80);</span><br><span class="line">             Display_String(&quot;Lock OK!         &quot;,0xc0);</span><br><span class="line">             &#125;</span><br><span class="line">                       else </span><br><span class="line">                        &#123;</span><br><span class="line">                          i=0;</span><br><span class="line">                          Display_String(&quot;New Password:   &quot;,0x80);</span><br><span class="line">                          Display_String(&quot;                &quot;,0xc0);</span><br><span class="line">                         &#125;</span><br><span class="line">           </span><br><span class="line">                       break;                        </span><br><span class="line">                    </span><br><span class="line">                      case 13: //æŒ‰Dé”®ä¿å­˜æ–°å¯†ç </span><br><span class="line">                      if ( !IS_valid_user)</span><br><span class="line">            &#123;   i=0;</span><br><span class="line">               Display_String(&quot;No rights !       &quot;,0xc0);</span><br><span class="line">                delayms(1000);</span><br><span class="line">             Display_String(&quot;Your Password...&quot;,0x80);</span><br><span class="line">             Display_String(&quot;Lock OK!         &quot;,0xc0);</span><br><span class="line">             &#125;</span><br><span class="line">                       else </span><br><span class="line">                      &#123;i = 0;  </span><br><span class="line">             init();</span><br><span class="line">             delayms(5);</span><br><span class="line">             for(k=0;k&lt;6;k++)</span><br><span class="line">             &#123;</span><br><span class="line">               Userpassword[k]=Userpassword[k]+48;</span><br><span class="line">             &#125;</span><br><span class="line">                       aa=Sendstring(0xa0,1,Userpassword,6);</span><br><span class="line">             delayms(5);</span><br><span class="line">                       aa=Recstring(0xa0,1,buffer,6);  </span><br><span class="line">             delayms(5); </span><br><span class="line">                       clear_password();                         </span><br><span class="line">                       Display_String(table,0x00);</span><br><span class="line">                       Display_String(&quot;Password Saved!   &quot;,0xc0);</span><br><span class="line">             delayms(1000);</span><br><span class="line">             Display_String(&quot;Do lock agian ?   &quot;,0xc0);</span><br><span class="line">                      &#125;               </span><br><span class="line">                      break;                        </span><br><span class="line">       </span><br><span class="line">                      case 14: //æŒ‰Eé”®æ¶ˆé™¤æ‰€æœ‰è¾“å…¥</span><br><span class="line">                      i=0;</span><br><span class="line">                      clear_password();</span><br><span class="line">                      Display_String(&quot;                &quot;,0xc0);            </span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">            case 15:   //æ¸…é™¤ä¸€ä½</span><br><span class="line">             if(i!=0)i--;</span><br><span class="line">             for(n=0;n&lt;i;n++)</span><br><span class="line">             &#123;</span><br><span class="line">               DSY_BUFFER1[n]=&#x27;*&#x27;;  </span><br><span class="line">             &#125;</span><br><span class="line">             Display_String(DSY_BUFFER1,0xc0);    </span><br><span class="line">             </span><br><span class="line">            &#125;</span><br><span class="line">            P1=0x0f;</span><br><span class="line">      &#125;</span><br><span class="line">      if(j==3)</span><br><span class="line">      &#123;  Display_String(&quot;THIEF!!!THIEF!!!&quot;,0xc0); </span><br><span class="line">        j=0;</span><br><span class="line">        beep=0;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#96;#include&lt;reg51.h&gt;<br>#include&lt;string.h&gt;<br>#include&lt;intrins.h&gt;<br>#define uchar unsigned char<br>#define uint unsigned int<br>#define     LCDIO      P0<br>#define delay4us() <em>nop</em>();<em>nop</em>();<em>nop</em>();<em>nop</em>();<br>uchar buffer[6]&#x3D;{0};<br>sbit sda&#x3D;P3^3;<br>sbit scl&#x3D;P3^2;<br>sbit beep&#x3D;P3^7;<br>bit  flag&#x3D;0,aa;        &#x2F;&#x2F;ç”¨æˆ·è¹²æ¸Šä¹‰å®šæ—¶æº¢å‡ºæ ‡å¿—ä½<br>uchar  DSY_BUFFER[16]&#x3D;â€                â€œ;<br>uchar  DSY_BUFFER1[16]&#x3D;â€                â€œ;<br>uchar  Userpassword[6]&#x3D;{0};<br>sbit  rs&#x3D;P2^0;<br>sbit  rd&#x3D;P2^1;<br>sbit  lcden&#x3D;P2^2;<br>sbit  led&#x3D;P2^7;<br>uchar code table2[]&#x3D;â€123456â€;<br>uchar code table[]&#x3D;â€Your Passwordâ€¦â€;<br>void delayms(uint z)<br>{<br>  uint x,y;<br>  for(x&#x3D;z;x&gt;0;xâ€“)<br>    for(y&#x3D;110;y&gt;0;yâ€“);<br>}<br>void delay()      &#x2F;&#x2F;çŸ­å»¶æ—¶ï¼Œä¸¤ä¸ªæœºå™¨å‘¨æœŸ,åšæ€»çº¿çš„å»¶æ—¶ç”¨<br>{;;}<br>void write_com(uchar com)<br>{<br>  rs&#x3D;0;<br>  rd&#x3D;0;<br>  lcden&#x3D;0;<br>  P0&#x3D;com;<br>  delayms(3);<br>  lcden&#x3D;1;<br>  delayms(3);<br>  lcden&#x3D;0;<br>}</p><p>void write_date(uchar date)<br>{<br>  rs&#x3D;1;<br>  rd&#x3D;0;<br>  lcden&#x3D;0;<br>  P0&#x3D;date;<br>  delayms(3);<br>  lcden&#x3D;1;<br>  delayms(3);<br>  lcden&#x3D;0;<br>}<br>void Display_String(uchar *p,uchar com)<br>{  uchar i;<br>   write_com(com);<br>   for(i&#x3D;0;i&lt;16;i++)<br>   {<br>   write_date(p[i]);<br>  }<br>}<br>void init_lcd()<br>{<br>  lcden&#x3D;0;<br>  write_com(0x38);<br>  write_com(0x0c);<br>  write_com(0x06);<br>  write_com(0x01);<br>  write_com(0x80);<br>    Display_String(table,0x80);<br>  Display_String(â€œLock OK!         â€œ,0xc0);<br>}</p><p>void start()<br>{<br>  sda&#x3D;1;<br>  scl&#x3D;1;<br>  delay4us();<br>  sda&#x3D;0;<br>  delay4us();<br>  scl&#x3D;0;<br>}<br>void stop()<br>{<br>  sda&#x3D;0;<br>  scl&#x3D;1;<br>  delay4us();<br>  sda&#x3D;1;<br>  delay4us();<br>  scl&#x3D;0;<br>}<br>void init()              &#x2F;&#x2F;åˆå§‹åŒ–<br>{<br>sda&#x3D;1;<br>delay();<br>scl&#x3D;1;<br>delay();<br>}</p><p>void ack()<br>{<br>  sda&#x3D;0;<br>  scl&#x3D;1;<br>  delay4us();<br>  scl&#x3D;0;<br>  sda&#x3D;1;<br>}<br>void noack()<br>{<br>  sda&#x3D;1;<br>  scl&#x3D;1;<br>  delay4us();<br>  scl&#x3D;0;<br>  sda&#x3D;0;<br>}<br>uchar recbyte()<br>{<br>  uchar i,rd;<br>  rd&#x3D;0x00;<br>  sda&#x3D;1;<br>  for(i&#x3D;0;i&lt;8;i++)<br>  {<br>    scl&#x3D;1;<br>    rd&lt;&lt;&#x3D;1;<br>    rd|&#x3D;sda;<br>    delay4us();<br>    scl&#x3D;0;<br>    delay4us();<br>  }<br>  scl&#x3D;0;<br>  delay4us();<br>  return rd;<br>}<br>uchar sendbyte(uchar wd)<br>{<br>  uchar i;<br>  bit ack0;<br>  for(i&#x3D;0;i&lt;8;i++)<br>  {<br>    sda&#x3D;(bit)(wd&amp;0x80);<br>    <em>nop</em>();<br>    <em>nop</em>();<br>    scl&#x3D;1;<br>    delay4us();<br>    scl&#x3D;0;<br>    wd&lt;&lt;&#x3D;1;<br>  }<br>  delay4us();<br>  sda&#x3D;1;<br>  scl&#x3D;1;<br>  delay4us();<br>  ack0&#x3D;!sda;<br>  scl&#x3D;0;<br>  delay4us();<br>  return ack0;<br>}<br>uchar Recstring(uchar slave,uchar subaddr,uchar *buffer,uchar n)<br>{<br> uchar i;<br> start();<br> if(!sendbyte(slave)) return 0;<br> if(!sendbyte(subaddr)) return 0;<br> start();<br> if(!sendbyte(slave+1)) return 0;<br> for(i&#x3D;0;i&lt;n-1;i++)<br>  {<br>    buffer[i]&#x3D;recbyte();<br>  ack();<br>  }<br> buffer[n-1]&#x3D;recbyte();<br> noack();<br> stop();<br> return 1;<br>}</p><p>uchar Sendstring(uchar slave,uchar subaddr,uchar *buffer,uchar n)<br>{<br>  uchar i;<br>  start();<br>  if(!sendbyte(slave)) return 0;<br>  if(!sendbyte(subaddr)) return 0;<br>  for(i&#x3D;0;i&lt;n;i++)<br>  {<br>    if(!sendbyte(buffer[i])) return 0;<br>  }<br>  stop();<br>  return 1;<br>}<br>void clear_password( )<br>{  uchar i;<br>  for(i&#x3D;0;i&lt;6;i++)<br>  {<br>   Userpassword[i]&#x3D;â€™ â€˜;<br>  }<br>  for(i&#x3D;0;i&lt;16;i++)<br>  {<br>     DSY_BUFFER[i]&#x3D;â€™ â€˜;<br>   }<br>}<br>uchar Keys_Scan()<br>{<br>  uchar temp,keynum;<br>  P1&#x3D;0x0F;<br>  delayms(5);<br>  temp&#x3D;P1^0x0F;<br>  switch(temp)<br>  {<br>    case 1:keynum&#x3D;0;break;<br>    case 2:keynum&#x3D;1;break;<br>    case 4:keynum&#x3D;2;break;<br>    case 8:keynum&#x3D;3;break;<br>    break;<br>  }<br>  P1&#x3D;0xF0;<br>  delayms(5);<br>  temp&#x3D;P1&gt;&gt;4^0x0F;<br>  switch(temp)<br>  {<br>    case 1:keynum+&#x3D;0;break;<br>    case 2:keynum+&#x3D;4;break;<br>    case 4:keynum+&#x3D;8;break;<br>    case 8:keynum+&#x3D;12;break;<br>    break;<br>  }<br>  delayms(600);<br>   return keynum;<br>}<br>void main()<br>{   uchar temp,i&#x3D;0,j&#x3D;0,k&#x3D;0,n;<br>  uchar IS_valid_user;<br>  beep&#x3D;1;<br>  init();<br>    init_lcd();<br>  delayms(5);<br>  aa&#x3D;Sendstring(0xa0,1,table2,6);<br>  delayms(5);<br>  aa&#x3D;Recstring(0xa0,1,buffer,6);<br>  delayms(10);<br>   P1&#x3D;0x0f;<br>    while(1)<br>    { </p><pre><code>  if(P1!=0x0f)  &#123;        temp=Keys_Scan();      switch(temp)             &#123;                   case 0:  case 1: case 2: case 3: case 4:                    case 5:  case 6: case 7: case 8: case 9:                                       if (i&lt;=5)             //å¯†ç é™åˆ¶åœ¨6ä½ä»¥å†…                   &#123;                    Userpassword[i]=temp;                    DSY_BUFFER[i]=&#39;*&#39;;                    Display_String(DSY_BUFFER,0xc0);            i++;                     &#125;                                    break;                                case 10: //æŒ‰Aé”®å¼€é”        for(k=0;k&lt;6;k++)        &#123;          if(buffer[k]==(Userpassword[k]+48))          flag=1;          else          flag=0;        &#125;                    if (flag==1)                     &#123; flag=0;          i=0;                      led=0;  //ç‚¹äº®LED                       clear_password();                       Display_String(&quot;OPEN    OK!      &quot;,0xc0);                       IS_valid_user = 1;           j=0;                    &#125;                   else                     &#123;          j++;                     led=1;   //å…³é—­LED                     clear_password();                     Display_String(&quot;ERROR!Have try   &quot;,0xc0);         write_com(0xcf);         write_date(0x30+j);                     IS_valid_user=0;                     &#125;                    i=0;                    break;                                  case 11: //æŒ‰Bé”®ä¸Šé”                  led=1;                     clear_password();                  Display_String(table,0x80);                  Display_String(&quot;Lock OK!         &quot;,0xc0);                  i=0;                                           IS_valid_user=0;                                 break;                                                 case 12: //æŒ‰Cé”®è®¾ç½®æ–°å¯†ç                    //å¦‚æœæ˜¯åˆæ³•ç”¨æˆ·åˆ™æç¤ºè¾“å…¥æ–°å¯†ç                       if ( !IS_valid_user)         &#123;         i=0;         Display_String(&quot;No rights !      &quot;,0xc0);         delayms(1000);         Display_String(&quot;Your Password...&quot;,0x80);         Display_String(&quot;Lock OK!         &quot;,0xc0);         &#125;                   else                     &#123;                      i=0;                      Display_String(&quot;New Password:   &quot;,0x80);                      Display_String(&quot;                &quot;,0xc0);                     &#125;                          break;                                                          case 13: //æŒ‰Dé”®ä¿å­˜æ–°å¯†ç                   if ( !IS_valid_user)        &#123;   i=0;           Display_String(&quot;No rights !       &quot;,0xc0);            delayms(1000);         Display_String(&quot;Your Password...&quot;,0x80);         Display_String(&quot;Lock OK!         &quot;,0xc0);         &#125;                   else                   &#123;i = 0;           init();         delayms(5);         for(k=0;k&lt;6;k++)         &#123;           Userpassword[k]=Userpassword[k]+48;         &#125;                   aa=Sendstring(0xa0,1,Userpassword,6);         delayms(5);                   aa=Recstring(0xa0,1,buffer,6);           delayms(5);                    clear_password();                                            Display_String(table,0x00);                   Display_String(&quot;Password Saved!   &quot;,0xc0);         delayms(1000);         Display_String(&quot;Do lock agian ?   &quot;,0xc0);                  &#125;                                 break;                                             case 14: //æŒ‰Eé”®æ¶ˆé™¤æ‰€æœ‰è¾“å…¥                  i=0;                  clear_password();                  Display_String(&quot;                &quot;,0xc0);                    break;        case 15:   //æ¸…é™¤ä¸€ä½         if(i!=0)i--;         for(n=0;n&lt;i;n++)         &#123;           DSY_BUFFER1[n]=&#39;*&#39;;           &#125;         Display_String(DSY_BUFFER1,0xc0);                     &#125;        P1=0x0f;  &#125;  if(j==3)  &#123;  Display_String(&quot;THIEF!!!THIEF!!!&quot;,0xc0);     j=0;    beep=0;  &#125;&#125;</code></pre><p>}&#96;</p><h4 id="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "><a href="#ä»¿çœŸèµ„æºå’Œç¨‹åºæºç " class="headerlink" title="ä»¿çœŸèµ„æºå’Œç¨‹åºæºç "></a>ä»¿çœŸèµ„æºå’Œç¨‹åºæºç </h4><p>æœ¬ç¤ºä¾‹åŸºäºProteus8.12å¹³å°</p><p><code>Proteus8.12</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é“¾æ¥ï¼šhttps://pan.baidu.com/s/1i7_6NMLvZ1EFCz80qveBuQ </span><br><span class="line">æå–ç ï¼š77p0//å»ºè®®ä½¿ç”¨å¤åˆ¶ç²˜è´´å‘½ä»¤ï¼Œæ‰‹åŠ¨è¾“å…¥å®¹æ˜“å‡ºé”™</span><br></pre></td></tr></table></figure><p><code>é“¾æ¥ï¼šhttps://pan.baidu.com/s/1i7_6NMLvZ1EFCz80qveBuQ  æå–ç ï¼š77p0//å»ºè®®ä½¿ç”¨å¤åˆ¶ç²˜è´´å‘½ä»¤ï¼Œæ‰‹åŠ¨è¾“å…¥å®¹æ˜“å‡ºé”™</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨WSL2æ—¶æ§åˆ¶å°è¾“å‡ºâ€œwsl æ£€æµ‹åˆ° localhost ä»£ç†é…ç½®ï¼Œä½†æœªé•œåƒåˆ° WSLã€‚NAT æ¨¡å¼ä¸‹çš„ WSL ä¸æ”¯æŒ localhost ä»£ç†â€œ</title>
      <link href="/2024/03/wsl-%E4%BD%BF%E7%94%A8WSL2%E6%97%B6%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%BE%93%E5%87%BA%E2%80%9Cwsl-%E6%A3%80%E6%B5%8B%E5%88%B0-localhost-%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%86%E6%9C%AA%E9%95%9C%E5%83%8F%E5%88%B0-WSL%E3%80%82NAT-%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-WSL-%E4%B8%8D%E6%94%AF%E6%8C%81-localhost-%E4%BB%A3%E7%90%86%E2%80%9C/"/>
      <url>/2024/03/wsl-%E4%BD%BF%E7%94%A8WSL2%E6%97%B6%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%BE%93%E5%87%BA%E2%80%9Cwsl-%E6%A3%80%E6%B5%8B%E5%88%B0-localhost-%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%86%E6%9C%AA%E9%95%9C%E5%83%8F%E5%88%B0-WSL%E3%80%82NAT-%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84-WSL-%E4%B8%8D%E6%94%AF%E6%8C%81-localhost-%E4%BB%A3%E7%90%86%E2%80%9C/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>WSL2ç‰ˆæœ¬ï¼š2.0.9.0</p><p>Windowsç‰ˆæœ¬ï¼š10.0.22621.2715</p><ol><li>æ‰“å¼€æˆ–åˆ›å»ºWSLé…ç½®æ–‡ä»¶(ä½äºC:&#x2F;User&#x2F;%ä½ çš„ç”¨æˆ·å&#x2F;.wslconfig),å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[experimental]</span><br><span class="line">autoMemoryReclaim=gradual</span><br><span class="line">networkingMode=mirrored</span><br><span class="line">dnsTunneling=<span class="literal">true</span></span><br><span class="line">firewall=<span class="literal">true</span></span><br><span class="line">autoProxy=<span class="literal">true</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>æ‰“å¼€å‘½ä»¤æç¤ºç¬¦å¹¶æ‰§è¡Œ <code>wsl --shutdown</code>å‘½ä»¤ã€‚</p></li><li><p>é‡æ–°å¯åŠ¨wslå°±å¯ä»¥äº†</p></li></ol><p>æ³¨æ„ï¼šwsl2ç‰ˆæœ¬2.0ä»¥å‰çš„ä¸æ”¯æŒè¿™ä¸ªæ–¹æ³•</p><p>ä½¿ç”¨é•œåƒæ¨¡å¼åï¼Œwsl2ä¼šè‡ªåŠ¨å…±äº«ä¸»æœºçš„ä»£ç†ï¼Œæ¯”ä»¥å‰æ–¹ä¾¿äº†ä¸å°‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> wsl </category>
          
          <category> æŠ¥é”™è§£å†³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wsl </tag>
            
            <tag> æŠ¥é”™è§£å†³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€è§£é‡Šå™¨çš„å®ç°</title>
      <link href="/2024/03/C%E8%AF%AD%E8%A8%80-C%E8%AF%AD%E8%A8%80-C%E8%AF%AD%E8%A8%80%E8%A7%A3%E9%87%8A%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
      <url>/2024/03/C%E8%AF%AD%E8%A8%80-C%E8%AF%AD%E8%A8%80-C%E8%AF%AD%E8%A8%80%E8%A7%A3%E9%87%8A%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h2><p>åœ¨å†™CuteCæ–‡æœ¬ç¼–è¾‘å™¨çš„åŒæ—¶ï¼Œä¸ºäº†ä½¿ä¹‹æœ‰è„šæœ¬æ‰§è¡Œèƒ½åŠ›ã€‚ç‰¹æ„å®ç°äº†ä¸€ä¸ªç®€æ˜“çš„Cè¯­è¨€è§£é‡Šå™¨ï¼Œæ‰€è°“çš„è§£é‡Šå™¨ï¼Œå°±æ˜¯å®ƒæ˜¯è§£ææ‰§è¡Œè„šæœ¬æ–‡ä»¶çš„ï¼Œå¹¶ä¸äº§ç”Ÿå¯æ‰§è¡Œçš„ç›®æ ‡ä»£ç ã€‚å®ƒå…·å¤‡äº†Cè¯­è¨€çš„å‡ ä¹å…¨éƒ¨çš„è¯­æ³•ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘æ‰“ç®—æŠŠå®ƒä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®æ¥å¼€å‘äº†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè‡ªå·±ä¹Ÿå­¦åˆ°äº†ä¸å°‘çš„çŸ¥è¯†ï¼Œæ‰€ä»¥ä¹Ÿæ‰“ç®—è·Ÿå¤§å®¶åˆ†äº«ã€‚å†™è¿™äº›ä¸œè¥¿ï¼Œè™½ç„¶æ˜¯é‡å¤å‘æ˜è½®å­çš„äº‹ï¼Œä½†ä¹Ÿä¸è‡³äºæ˜¯åœ¨æµªè´¹ç”Ÿå‘½ã€‚ç¨‹åºå‘˜å˜›ï¼Œæˆ‘æ€»è§‰å¾—åº”è¯¥æ˜¯è¦ç†è§£æˆ‘ä»¬æ¯å¤©æ‰€ç¼–è¯‘å‡ºæ¥çš„ç¨‹åºæ˜¯æ€ä¹ˆè¢«æ‰§è¡Œï¼Œåº”è¯¥æ˜ç™½æˆ‘ä»¬æ•²æ‰“çš„æ¯è¡Œä»£ç çš„å®é™…æ„ä¹‰ã€‚<br>æˆ‘æ‰“ç®—å†™ä¸€ä¸ªç³»åˆ—çš„æ–‡ç« æ¥è¯´æ˜è¿™ä¸ªè§£é‡Šå™¨çš„å®ç°è¿‡ç¨‹ï¼Œå…¶ä¸­å¯¹äºç¼–è¯‘åŸç†çš„ç†è®ºçŸ¥è¯†ä¸åšå¤ªå¤šçš„è®²è§£ï¼Œä¸€æ˜¯ä¸å®¹æ˜“æé«˜å¤§å®¶çš„ç§¯ææ€§ï¼ŒäºŒæ˜¯è‡ªå·±æ°´å¹³æœ‰é™ã€‚æ‰€ä»¥æˆ‘è§‰å¾—å¤§éƒ¨åˆ†ä»ä¾‹å­å‡ºå‘ï¼Œè®²è§£ä¸€ä¸ªä¸ªç›®æ ‡çš„å®ç°è¿‡ç¨‹ï¼Œå¤§å®¶æ…¢æ…¢ä½“ä¼šï¼Œä¼°è®¡æ”¶è·ä¼šæ¯”è¾ƒå¤§ã€‚</p><p>é€šè¿‡è¿™ä¸€ç³»åˆ—çš„æ–‡ç« ï¼Œå¤§å®¶åº”è¯¥å¯ä»¥å­¦åˆ°ä»¥ä¸‹çš„çŸ¥è¯†ã€‚<br>1.æ›´æ·±å…¥çš„ç†è§£Cçš„å†…éƒ¨ç»†èŠ‚ï¼Œå¯¹ä»¥åçš„å¼€å‘æ€»æ˜¯æœ‰å¥½å¤„çš„ã€‚ä¾‹å¦‚ï¼Œä½ èƒ½å¾ˆæ¸…æ¥šCè¯­è¨€çš„ç±»å‹å®šä¹‰ï¼Œé€šè¿‡åŸºæœ¬çš„ç±»å‹ä¸ºä½•èƒ½å¤Ÿå®šä¹‰å‡ºæ— ç©·çš„å„ç§ç±»å‹ã€‚<br>2.äº†è§£è¡¨è¾¾å¼çš„è§£æï¼Œä¸­é—´ä»£ç çš„äº§ç”Ÿã€‚è¿™ç‚¹éå¸¸æœ‰æ„æ€ï¼Œäº†è§£äº†è¿™ç‚¹ï¼Œå¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•åšå¾ˆå¤šäº‹æƒ…ï¼ŒåŒ…æ‹¬è®¾è®¡ä¸ªè®¡ç®—å™¨ï¼Œè§£æå¤æ‚çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨è½¯ä»¶ä¸­è§£æå‘½ä»¤ç­‰ç­‰ã€‚<br>3.å¯¹ç¼–è¯‘å™¨æœ‰ä¸€ä¸ªæ„Ÿæ€§çš„è®¤è¯†ï¼Œè™½ç„¶ç¦»å†™å‡ºç¼–è¯‘å™¨è¿˜æ¯”è¾ƒé¥è¿œï¼Œä½†å¯¹äºè¯­æ³•è§£æï¼Œé¢„ç¼–è¯‘ï¼Œç†è§£çš„å°±æ¯”è¾ƒæ·±å…¥äº†ã€‚ç°åœ¨å¾ˆå¤šè½¯ä»¶éƒ½æœ‰é¢„ç¼–è¯‘çš„æ¨¡å—åœ¨é‡Œé¢ï¼Œæ¯”å¦‚Pro*C, GSoapç­‰ç­‰ã€‚<br>4.æˆ‘ä»¬äº§ç”Ÿçš„ä¸­é—´ä»£ç å…¶å®å·²ç»éå¸¸æ¥è¿‘æ±‡ç¼–ä»£ç ï¼Œè¿™å¯¹ç†è§£Cçš„æ‰§è¡Œè¿‡ç¨‹æ€»æ˜¯æœ‰å¥½å¤„çš„ã€‚</p><p>æ€»ä¹‹ï¼Œæ™’æ™’è‡ªå·±çš„æˆæœï¼Œæ€ä¹ˆè¯´ä¹Ÿæ˜¯æˆ‘äº²äº²è‹¦è‹¦å†™å‡ºæ¥çš„ï¼Œå¸Œæœ›å¤§å®¶èƒ½æ‰¾åˆ°ç‚¹å¯ä»¥å€Ÿé‰´çš„ä¸œè¥¿å§~ä»£ç æˆ‘è¿˜åœ¨åŠªåŠ›çš„ç¼–å†™ï¼Œè¿‡ä¸€æ®µæ—¶é—´å†æ”¾å‡ºæ¥ä¸€ä¸ªåˆçº§çš„ç‰ˆæœ¬ã€‚å¦‚æœå·¥ä½œå¿™ï¼Œé‚£ä¼°è®¡å°±è¦å†ç­‰ä¸€æ®µæ—¶é—´äº†ã€‚</p><p>ä»¥å‰æˆ‘å‘è¿‡ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„è§£é‡Šå™¨ï¼Œå¯ä»¥åœ¨<a href="https://link.zhihu.com/?target=http://www.cnblogs.com/linxr/archive/2011/03/23/1992644.html">è¿™ç¯‡æ–‡ç« </a>ä¸­ä¸‹è½½ï¼Œä¸è¿‡æˆ‘ç°åœ¨å·²ç»é‡å†™äº†è§£é‡Šå™¨ï¼Œæ‰€ä»¥è¦çœ‹ç»“æœå¯ä»¥å…ˆä¸‹è½½ä¸‹æ¥çœ‹çœ‹:ï¼‰ã€‚</p><p>ç›®å½•ï¼š</p><p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/linxr/archive/2011/12/16/2290502.html%23mempool">1. å†…å­˜æ± </a></p><p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/linxr/archive/2011/12/16/2290502.html%23stack">2. æ ˆ</a></p><p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/linxr/archive/2011/12/16/2290502.html%23hash">3. Hashè¡¨</a></p><h3 id="1-å†…å­˜æ± "><a href="#1-å†…å­˜æ± " class="headerlink" title="1.å†…å­˜æ± "></a><strong>1.å†…å­˜æ± </strong></h3><p>åœ¨ä¸€äº›å°çš„ç¨‹åºé‡Œï¼Œæ²¡ä»€ä¹ˆå¿…è¦æ·»åŠ å†…å­˜ç®¡ç†æ¨¡å—åœ¨é‡Œé¢ã€‚ä½†æ˜¯å¯¹äºæ¯”è¾ƒå¤æ‚çš„ä»£ç ï¼Œå¦‚æœéœ€è¦å¾ˆå¤šçš„å†…å­˜æ“ä½œï¼Œé‚£ä¹ˆåŠ å…¥è‡ªå·±çš„å†…å­˜ç®¡ç†æ˜¯æœ‰å¿…è¦çš„ã€‚è‡³å°‘æœ‰ä¸€äº›å¥½å¤„ï¼šèƒ½å¤ŸåŠ å¿«å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾ï¼›èƒ½å¤Ÿè½»æ¾çš„æŸ¥æ‰¾å†…å­˜æ³„éœ²é—®é¢˜ï¼›èƒ½å¤Ÿå¯¹æ•´ä¸ªè½¯ä»¶çš„å†…å­˜æ¶ˆè€—åšä¸€ä¸ªæ¯”è¾ƒç²¾ç¡®çš„ç»Ÿè®¡ï¼›å¯¹ä»¥åçš„ä¼˜åŒ–æœ‰å¾ˆå¤§çš„å¥½å¤„ç­‰ç­‰ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘çš„è§£é‡Šå™¨é‡Œï¼Œæˆ‘åŠ å…¥äº†ä¸€ä¸ªç®€å•çš„å†…å­˜ç®¡ç†æ¨¡å—ï¼Œä»¿é€ äº†å†…å­˜æ± çš„åšæ³•ã€‚<br>ä¸»è¦æ€æƒ³æ˜¯è¿™æ ·çš„ï¼š<br>a.è®°å½•æ‰€æœ‰çš„ç”³è¯·çš„å†…å­˜<br>b.å½“é‡Šæ”¾å†…å­˜æ—¶ï¼Œè®°å½•ä¸‹æ¥ä»¥ä¾›ä¸‹æ¬¡ç”³è¯·ä½¿ç”¨<br>c.ç”³è¯·å†…å­˜æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å‰é¢é‡Šæ”¾è¿‡çš„å†…å­˜<br>ä¸ºäº†è¾¾åˆ°ä»¥ä¸Šçš„åŠŸèƒ½ã€‚æˆ‘ä¸ºç”³è¯·å†…å­˜çš„å¤§å°åˆ’åˆ†ç²’åº¦ï¼Œä¾‹å¦‚ï¼šæˆ‘å¾—ç²’åº¦è¿™ä¹ˆå®‰æ’{16,32,64,128,â€¦}é‚£ä¹ˆç”³è¯·17ä¸ªå­—èŠ‚çš„å¤§å°æ—¶å€™ï¼Œæˆ‘ä¼šç”³è¯·32ä¸ªå­—èŠ‚çš„å¤§å°ã€‚è¿™æ ·å­æ–¹ä¾¿ç®¡ç†ã€‚å¹¶ä¸”ä¸ºæ¯ä¸ªç²’åº¦åˆ›å»ºä¸€ä¸ªå¯ç”¨å†…å­˜çš„åŒå‘é“¾è¡¨ã€‚ç”³è¯·å†…å­˜æ—¶ï¼Œå°±å¯ç›´æ¥ä»è¿™äº›é“¾è¡¨å¤´ä¸­ç”³è¯·ï¼ˆå³å°†ä¸€ä¸ªèŠ‚ç‚¹ä»é“¾è¡¨å¤´ç§»é™¤ï¼Œä½œä¸ºè¢«ç”³è¯·çš„ç©ºé—´ï¼Œå¹¶æ’å…¥åˆ°åœ¨ä½¿ç”¨çš„é“¾è¡¨ä¸­ï¼‰ï¼Œå†…å­˜çš„é‡Šæ”¾åˆ™æ˜¯ä¸€ä¸ªæƒ³æ³•çš„è¿‡ç¨‹ã€‚è¿™äº›çš„å­˜å‚¨ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>å›¾1.1 å†…å­˜æ± çš„å­˜å‚¨ç»“æ„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">pool_block</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="type">void</span> * data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">pool_block</span> * <span class="title">next</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">pool_block</span> * <span class="title">pre</span>;</span></span><br><span class="line">&#125;<span class="type">pool_block_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">pool</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> num_all;</span><br><span class="line">    <span class="type">int</span> num_free;</span><br><span class="line">    <span class="type">pool_block_t</span> * list_all;</span><br><span class="line">    <span class="type">pool_block_t</span> * list_free[POOL_ATOM_NUM];</span><br><span class="line">&#125;<span class="type">pool_t</span>;</span><br><span class="line"><span class="type">int</span> pool_atom_tab[POOL_ATOM_NUM] = &#123;</span><br><span class="line">    <span class="number">32</span>, <span class="number">64</span>, <span class="number">128</span>, <span class="number">256</span>, <span class="number">512</span>, <span class="number">1024</span>, <span class="number">2048</span>, <span class="number">4096</span>, <span class="number">8192</span>, <span class="number">-1</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š<br>a.å†…å­˜çš„ç”³è¯·ä¼šæŒ‰ç…§pool_atom_tabæ•°ç»„ä¸­çš„å¤§å°å¯¹é½ï¼Œæ¯”å¦‚ç”³è¯·10byteï¼Œé‚£ä¹ˆï¼Œæˆ‘ä¼šç”³è¯·32byte.</p><p>b.ä¸ºæ¯ä¸ªç²’åº¦ä¿å­˜ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨äºä¿å­˜è¢«é‡Šæ”¾çš„å†…å­˜ã€‚å¦‚æœè¦ç”³è¯·çš„å†…å­˜è¶…è¿‡8192ï¼Œé‚£ä¹ˆæˆ‘ç›´æ¥è°ƒç”¨ç³»ç»Ÿçš„mallocï¼Œé‡Šæ”¾æ—¶ï¼Œç›´æ¥è°ƒç”¨free.</p><p>c.å†…å­˜ç”³è¯·è¿‡ç¨‹ï¼šåˆ°ç›¸åº”çš„ç²’åº¦é“¾è¡¨ï¼ˆlist_freeï¼‰ä¸­æŸ¥çœ‹æ˜¯å¦æœ‰å¯ç”¨å†…å­˜ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥å°†å®ƒä»è¯¥list_freeé“¾è¡¨ä¸­ç§»åŠ¨åˆ°list_allé“¾è¡¨ã€‚<br>d.å†…å­˜é‡Šæ”¾è¿‡ç¨‹ï¼šè¦é‡Šæ”¾çš„å†…å­˜å¿…å®šä¿å­˜åœ¨list_allä¸­ï¼Œæ ¹æ®å®ƒçš„å¤§å°ï¼ŒæŠŠå®ƒç§»åŠ¨åˆ°ç›¸åº”çš„list_freeé“¾è¡¨ã€‚<br>e.pool_block_tç»“æ„è¢«æ”¾ç½®åœ¨ç”³è¯·å†…å­˜çš„å‰é¢ï¼Œåˆ™åœ¨é‡Šæ”¾æ—¶ï¼Œç›´æ¥æ ¹æ®BufferæŒ‡é’ˆå°±å¯å¾—åˆ°pool_block_tçš„ä½ç½®ï¼Œä»è€Œå¾—åˆ°nextå’Œpreï¼Œå¿«é€Ÿçš„åœ¨é“¾è¡¨ä¸­ç§»åŠ¨ã€‚</p><h3 id="2-æ ˆ"><a href="#2-æ ˆ" class="headerlink" title="2.æ ˆ"></a><strong>2.æ ˆ</strong></h3><p>æ ˆåœ¨è§£é‡Šå™¨ä¸­ç”¨åˆ°çš„åœ°æ–¹å¾ˆå¤šï¼Œä¸ç®¡æ˜¯è¡¨è¾¾å¼çš„è§£æï¼Œè¿˜æ˜¯ä»£ç å—çš„è§£æï¼Œç±»å‹çš„è§£æï¼Œç­‰ç­‰éƒ½ç”¨åˆ°äº†æ ˆã€‚æ‰€ä»¥ä¸å®ç°å®ƒæ˜¯ä¸å¯èƒ½çš„äº‹ï¼Œä¸è¿‡åœ¨æ•°æ®ç»“æ„ä¸­ä»–æ˜¯æœ€ç®€å•çš„äº†ï¼Œæ— éå°±æ˜¯ç”³è¯·ä¸€ä¸ªç©ºé—´ï¼ŒæŒ‰ä¸€ä¸ªä¸€ä¸ªçš„èŠ‚ç‚¹ä¿å­˜è¿›å»ï¼ŒæŒ‰ä¸€ä¸ªä¸€ä¸ªçš„èŠ‚ç‚¹å–å‡ºæ¥ã€‚æ²¡ä»€ä¹ˆæŠ€å·§åœ¨é‡Œé¢ï¼Œåªæ˜¯è¿™ä¸ªæˆ‘è®©æ ˆçš„å¤§å°ç©ºé—´æ˜¯è‡ªåŠ¨å¢é•¿å’Œå‡å°çš„ï¼Œè¿™ä¹ˆåšçš„ç›®çš„æ˜¯ï¼šæ ˆçš„ç©ºé—´ä»…ä»…é™åˆ¶äºå†…å­˜çš„å¤§å°ã€‚ä½†æ˜¯ï¼Œè¿™ä¹ˆåšå¾—ç¼ºç‚¹æ˜¯ï¼Œå½“æ ˆçš„ç©ºé—´å¤§å°è‡ªåŠ¨å˜åŒ–æ—¶ï¼Œæ ˆå†…çš„æ•°æ®è¦è¢«å¤åˆ¶ä¸€éï¼Œè¿™åŠ¡å¿…ä¼šå½±å“æ•ˆç‡ã€‚ä½†æ²¡æœ‰åŠæ³•ï¼Œæš‚æ—¶ä¹‹èƒ½è¿™æ ·äº†ã€‚å”¯ä¸€çš„åŠæ³•æ˜¯åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šåšä¸€ä¸ªé€‰æ‹©ã€‚<br>æ ˆçš„å­˜å‚¨ç»“æ„å¦‚ä¸‹ï¼š</p><p>å›¾1.2 æ ˆçš„å­˜å‚¨ç»“æ„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">stack</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> item_len;</span><br><span class="line">    <span class="type">int</span> item_num;</span><br><span class="line">    <span class="type">int</span> stack_size;</span><br><span class="line">    <span class="type">char</span> *p;</span><br><span class="line">&#125;<span class="type">stack_t</span>;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š<br>item_len: ä¿å­˜æ¯ä¸ªèŠ‚ç‚¹çš„é•¿åº¦<br>item_num: æ ˆä¸­èŠ‚ç‚¹çš„ä¸ªæ•°<br>stack_size: æ ˆä¸­å¯ä¿å­˜çš„èŠ‚ç‚¹ä¸ªæ•°<br>p: æŒ‡å‘æ ˆç©ºé—´<br>a.å½“èŠ‚ç‚¹çš„ä¸ªæ•°item_numå¤§äºstack_size,é‚£ä¹ˆå¿…é¡»é‡æ–°ç”³è¯·ç©ºé—´ï¼Œå°†åŸæ¥çš„æ•°æ®æ‹·è´åˆ°æ–°çš„ç©ºé—´ã€‚<br>b.å½“èŠ‚ç‚¹çš„ä¸ªæ•°å‡å°åˆ°ä¸€å®šçš„æ•°é‡æ—¶ï¼Œå¯ä»¥é‡æ–°ç”³è¯·å°çš„æ•°æ®ç©ºé—´ï¼Œé‡Šæ”¾åŸæ¥å¤§çš„ç©ºé—´ã€‚</p><h3 id="3-hashè¡¨"><a href="#3-hashè¡¨" class="headerlink" title="3.hashè¡¨"></a><strong>3.hashè¡¨</strong></h3><p>hashç”±äºå…¶å¿«é€Ÿçš„æŸ¥æ‰¾èƒ½åŠ›è€Œè‘—ç§°ï¼Œä½†æ˜¯å®ƒå¤ªæµªè´¹å†…å­˜äº†ï¼Œæ‰€ä»¥ç”¨å¾—çš„æ¯”è¾ƒå°‘ï¼Œä»…ä»…æ˜¯åœ¨å‡½æ•°çš„è°ƒç”¨æ—¶è¢«ä½¿ç”¨ã€‚å› ä¸ºå‡½æ•°çš„è°ƒç”¨æ˜¯é¢‘ç¹çš„ï¼Œå¦‚æœä»å¤´æŸ¥æ‰¾å‡½æ•°ï¼Œé‚£å°†æµªè´¹å¾ˆå¤šçš„æ—¶é—´ã€‚è¿™é‡Œå¼•å…¥hashä¹Ÿæ˜¯å¿…è¦çš„ã€‚</p><p>hashè¡¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> HH_TAB_SIZE 128</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">hh_node</span>&#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> hash, klen, dlen;</span><br><span class="line">    <span class="type">void</span> * key;</span><br><span class="line">    <span class="type">void</span> * data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">hh_node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;<span class="type">hh_node_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">hh_head</span>&#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> node_num;</span><br><span class="line">    <span class="type">hh_node_t</span> *  node_list;</span><br><span class="line">&#125;<span class="type">hh_head_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">hh_hash</span>&#123;</span></span><br><span class="line">    <span class="type">hh_opts_t</span> opts;</span><br><span class="line">    <span class="type">hh_head_t</span> tabs[HH_TAB_SIZE];</span><br><span class="line">&#125;<span class="type">hh_hash_t</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">hh_opts</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> (*cmp_key)(<span class="type">void</span> *key1, <span class="type">void</span> *key2);</span><br><span class="line">    <span class="type">unsigned</span> <span class="title function_">int</span> <span class="params">(*get_hash)</span><span class="params">(<span class="type">void</span> *key)</span>;</span><br><span class="line">    <span class="type">void</span> * (*new_key)(<span class="type">int</span>);</span><br><span class="line">    <span class="type">void</span> * (*new_data)(<span class="type">int</span>);</span><br><span class="line">    <span class="type">void</span> (*del_key)(<span class="type">void</span> *key);</span><br><span class="line">    <span class="type">void</span> (*del_data)(<span class="type">void</span> *data);</span><br><span class="line">&#125;<span class="type">hh_opts_t</span>;</span><br></pre></td></tr></table></figure><h2 id="è¯æ³•åˆ†æ-äºŒ"><a href="#è¯æ³•åˆ†æ-äºŒ" class="headerlink" title="è¯æ³•åˆ†æ(äºŒ)"></a>è¯æ³•åˆ†æ(äºŒ)</h2><p>è¯æ³•åˆ†ææ˜¯ç¼–è¯‘åŸç†ä¸­æœ€å®¹æ˜“ç†è§£çš„ï¼Œå°±ç®—æ²¡æœ‰äº†è§£è¿‡ç¼–è¯‘åŸç†ï¼Œä¹Ÿèƒ½å†™å‡ºä¸€ä¸ªè¯æ³•åˆ†æå™¨ã€‚æˆ‘ä»¬ä¸ç”¨ç†è§£æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸ç”¨ç†è§£çŠ¶æ€æœºåŸç†ï¼Œå°±å¯ä»¥è½»æ¾çš„å®Œæˆè¯æ³•çš„åˆ†æã€‚</p><p>è¿™é‡Œé¦–å…ˆä»‹ç»ä¸‹è‡ªé¡¶å‘ä¸‹çš„è§£æè¿‡ç¨‹ï¼Œæ‰€è°“çš„è‡ªé¡¶å‘ä¸‹ï¼ŒæŒ‰æˆ‘çš„ç†è§£ï¼Œå°±æ˜¯ä»ä¸€ä¸ªå¤§çš„é›†åˆè§£æåˆ°å°çš„é›†åˆã€‚ä¾‹å¦‚ï¼šè§£æä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿›å…¥æ–‡ä»¶ï¼Œè§£æä¸€ä¸ªå‡½æ•°ï¼Œè¿›å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè§£æå±€éƒ¨å˜é‡ï¼Œè§£æè¡¨è¾¾å¼ï¼Œè¿›å…¥è¡¨è¾¾å¼ï¼Œè§£æå˜é‡ã€å¸¸é‡ç­‰ç­‰ï¼Œæœ€ç»ˆå®Œæˆä¸€ä¸ªCæ–‡ä»¶çš„è§£æè¿‡ç¨‹ã€‚æ•´ä¸ªè¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªçŒœæµ‹çš„è¿‡ç¨‹ã€‚ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»ä¾èµ–äºæ–‡ä»¶ä¸­çš„æ¯ä¸ªè¯ï¼ˆtokenï¼‰ï¼Œtokenå¯ä»¥çœ‹æˆæ˜¯è§£æè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå•ä½ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ol><li><p>å…³é”®è¯æœ‰ï¼šint char double long for while â€¦â€¦</p></li><li><p>è¿ç®—ç¬¦æœ‰ï¼š+ - * &#x2F; â€¦â€¦</p></li><li><p>æ•°å­—å¸¸é‡ï¼š12 0x34 3.45</p></li><li><p>å­—ç¬¦ä¸² ï¼šâ€helloâ€</p></li></ol><p>â€¦</p><p>ç­‰ç­‰.</p><p>é‚£ä¹ˆæˆ‘ä»¬å¿…é¡»å®ç°ä¸€ä¸ªå‡½æ•°get_tokenï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬è·å–æ–‡ä»¶ä¸­çš„ä¸€ä¸ªtokenã€‚ä¾‹å¦‚ç°åœ¨ä¸€ä¸ªCæ–‡ä»¶ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> agrc, <span class="type">char</span> **argv )</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¤šæ¬¡æ‰§è¡Œget_tokenï¼Œåˆ†åˆ«å¾—åˆ°çš„tokenä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">main</span></span><br><span class="line"><span class="params">(           â‘¢</span></span><br><span class="line"><span class="params"><span class="type">int</span></span></span><br><span class="line"><span class="params">argc</span></span><br><span class="line"><span class="params">...</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">...</span></span><br><span class="line"><span class="params"></span></span><br></pre></td></tr></table></figure><p>é™¤äº†ä¸€ä¸ªget_tokenå‡½æ•°å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå«åšput_backçš„å‡½æ•°ï¼Œå› ä¸ºè„šæœ¬è§£ææ˜¯ä¸€ä¸ªçŒœæµ‹çš„è¿‡ç¨‹ã€‚æœ‰æ—¶å€™æˆ‘ä»¬å¿…é¡»çŸ¥é“ä¸‹ä¸€ä¸ªçš„tokenæ˜¯ä»€ä¹ˆï¼Œæ‰èƒ½åˆ¤æ–­è¯¥èµ°å“ªä¸ªåˆ†æ”¯ã€‚è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨â‘¢çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¾—åˆ°äº†â€(â€œï¼Œæ‰€ä»¥çŸ¥é“mainæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå¦‚æœè¯¥tokenä¸æ˜¯â€(â€œï¼Œ è€Œæ˜¯â€&#x3D;â€, æˆ‘ä»¬çŸ¥é“å®ƒä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªåŸºæœ¬çš„å˜é‡å®šä¹‰ï¼Œå¹¶ä¸”éœ€è¦åˆå§‹åŒ–ã€‚é‚£ä¹ˆæˆ‘ä»¬å¿…é¡»è°ƒç”¨put_backå‡½æ•°ï¼ŒæŠŠè¯¥tokené‡æ–°æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œä½¿å¾—ä¸‹æ¬¡get_tokençš„æ—¶å€™ï¼Œè¿˜ä¼šæ‹¿åˆ°è¿™ä¸ªtoken,è€Œä¸æ˜¯ä¸‹ä¸ªtokenã€‚</p><p>è‡³äºget_tokenå’Œput_backå‡½æ•°å¦‚ä½•å®ç°ï¼Œæˆ‘å°±ä¸å¤šè¯´äº†ã€‚æˆ‘ä½¿ç”¨äº†æœ€ç¬¨çš„æ–¹æ³•ï¼Œæ— éå°±æ˜¯æ¯ä¸ªå­—ç¬¦ä¸€ä¸ªä¸€ä¸ªçš„å‘åæ‰«æï¼Œåˆ¤æ–­æ˜¯è¯¥è¿”å›ä»€ä¹ˆæ ‡ç¤ºã€‚æ¯ä¸ªtokenè¢«åˆ†ä¸ºå„ç§ç±»å‹token_type:</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enum tok_types&#123; DELIMITER = 1, IDENTIFIER, KEYWORD, TEMP, STRING, CHARACTOR, NUMBER, TYPE, BLOCK, PRECOMPILE &#125;;</span><br></pre></td></tr></table></figure><p><strong>ç±»å‹ æ„ä¹‰ ä¾‹å¦‚</strong></p><hr><p>DELIMITER æ ‡ç¤ºåˆ†éš”ç¬¦ ; | + -</p><p>IDENTIFIER æ ‡ç¤ºIDæ ‡ç¤ºç¬¦ var hello</p><p>KEYWORD å…³é”®å­— int char while do</p><p>STRING å­—ç¬¦ä¸² â€œstringâ€</p><p>CHARACTOR å­—ç¬¦ â€˜câ€™</p><p>NUMBER æ•°å­—å¸¸é‡ 123 012 0x34</p><p>TYPE ç±»å‹ typedef int int32; é‚£ä¹ˆint32å°±è¢«æ ‡ç¤ºä¸ºTYPE</p><p>BLOCK å—æ ‡å¿— { }</p><p>PRECOMPILE é¢„ç¼–è¯‘è¡Œ #define</p><p>TEMP ä¿ç•™</p><p>è¯æ³•åˆ†æçš„ç›®çš„å°±æ˜¯æ‰«ææºç ï¼ŒåŒºåˆ†å‡ºè¿™äº›ç±»å‹ï¼Œå˜è¿”å›è¯¥tokenã€‚ä¾›è§£é‡Šå™¨çš„å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚</p><h2 id="ç±»å‹è§£æ-ä¸‰"><a href="#ç±»å‹è§£æ-ä¸‰" class="headerlink" title="ç±»å‹è§£æ(ä¸‰)"></a>ç±»å‹è§£æ(ä¸‰)</h2><h3 id="1-ç±»å‹çš„è¡¨ç¤º"><a href="#1-ç±»å‹çš„è¡¨ç¤º" class="headerlink" title="1.ç±»å‹çš„è¡¨ç¤º"></a>1.ç±»å‹çš„è¡¨ç¤º</h3><p>Cè¯­è¨€çš„ç±»å‹æ˜¯ç›¸å½“çµæ´»çš„ï¼Œé™¤äº†æ ‡å‡†çš„ç±»å‹(int char float double long ç­‰ç­‰)å¤–ï¼Œè‡ªå·±æ ¹æ®éœ€æ±‚ï¼Œèƒ½å®šä¹‰å‡ºæ— ç©·çš„ç±»å‹ã€‚ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š<br><strong><em>int * a[10];</em></strong><br>å®ƒè¡¨ç¤ºçš„æ„æ€æ˜¯ï¼š<br><strong><em>a is ARRAY 0..9 of POINTER to INT</em></strong><br>ä»”ç»†è§‚å¯Ÿå®ƒçš„æ„æ€ï¼Œå°±ä¼šå‘ç°ï¼Œè¿™ä¸ªç±»å‹æ˜¯å…¶ä»–åŸºæœ¬ç±»å‹æŒ‰ç…§ä¸€å®šé¡ºåºçš„ç»„åˆï¼šARRAY|POINTER|INTã€‚è¦è¡¨ç¤ºè¿™ç§å½¢å¼ï¼Œé“¾è¡¨æ˜¯æœ€åˆé€‚ä¸è¿‡çš„äº†ã€‚å¦‚ä¸‹å›¾ï¼š</p><p>å›¾2.1ç±»å‹çš„è¡¨ç¤º</p><p>è¿˜æœ‰ä¸€äº›æƒ…å†µï¼Œæ¯”å¦‚ç»“æ„ä½“ç±»å‹ï¼Œé‚£ä¹ˆä¸Šè¿°çš„è¡¨ç¤ºå°±ä¸å¤§åˆé€‚äº†ã€‚ä¾‹å¦‚ä¸‹é¢çš„ç»“æ„ä½“ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">a</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">char</span> * p[<span class="number">10</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç»“æ„ä¸­çš„æ¯ä¸ªåŸŸåˆ†åˆ«æ˜¯ç”±ä¸€ä¸ªä¸ªçš„ç±»å‹ç»„æˆçš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç±»å‹é“¾è¡¨ç»„æˆã€‚å…·ä½“å°±æ˜¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_a is STRUCT of</span><br><span class="line">    n: INT</span><br><span class="line">    p: ARRAY <span class="number">0.</span><span class="number">.9</span> of POINTER to INT</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p>å›¾2.2ç»“æ„ä½“çš„è¡¨ç¤º</p><p>ç¨‹åºä¸­çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">type_t</span> <span class="title">ttype_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">type_t</span> * <span class="title">ptype_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">type_list_t</span> <span class="title">ttype_list_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">type_list_t</span> * <span class="title">ptype_list_t</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">type_t</span>&#123;</span></span><br><span class="line">    <span class="type">int</span> bty;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="type">ptype_t</span> ty;</span><br><span class="line">    <span class="type">ptype_list_t</span> sty;</span><br><span class="line">    <span class="type">char</span> * name;</span><br><span class="line">    <span class="type">char</span> * tag;</span><br><span class="line">    <span class="type">char</span> * pos;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">type_list_t</span>&#123;</span></span><br><span class="line">    <span class="type">ptype_t</span> ty;</span><br><span class="line">    <span class="type">ptype_list_t</span> next;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="2-ç±»å‹è§£æ"><a href="#2-ç±»å‹è§£æ" class="headerlink" title="2.ç±»å‹è§£æ"></a>2.ç±»å‹è§£æ</h3><p>å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒåˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼š<br>specifier + id + dclor<br>å¯¹åº”åˆ°ä¸€ä¸ªå…·ä½“çš„å®šä¹‰ï¼šint * p[10]; è¿™ä¸‰éƒ¨åˆ†åˆ†åˆ«æ˜¯ï¼š<br>specifier int *<br>id p<br>dclor [10]<br>ç±»å‹çš„è§£æè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼Œé¦–å…ˆæ‰¾åˆ°idï¼Œç„¶åæ ¹æ®ä¸€ä¸ªè§„åˆ™ï¼ˆå‘å³å†å‘å·¦ï¼‰ï¼Œä¾æ¬¡è§£æå‡ºè¿™ä¸ªç±»å‹ï¼š</p><p>å›¾2.3ç±»å‹çš„è§£æè¿‡ç¨‹</p><p>åœ¨ç¬¬2æ­¥ï¼Œæœ‰å‡ ç§æƒ…å†µï¼š<br>a. [ è¡¨ç¤ºæ•°ç»„ï¼Œå¦‚æœé‡åˆ°[ åˆ™è¿›å…¥è§£ææ•°ç»„å‡½æ•°<br>b. ( è¡¨ç¤ºå‡½æ•°ï¼Œå¦‚æœé‡åˆ°( åˆ™è¿›å…¥è§£æå‚æ•°åˆ—è¡¨å‡½æ•°</p><p>æ‰€ä»¥æˆ‘ä»¬çš„è§£æå‡½æ•°æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">dclor</span><span class="params">( <span class="type">ptype_t</span> ty )</span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>( *token )&#123;</span><br><span class="line">    <span class="keyword">case</span> ALY: dcl_arrays(ty); <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span>: ty-&gt;pos = prog;  dcl_args(ty); <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dcl_pointers(ty);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(tok_top &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>( *tok_stack[tok_top].token == <span class="string">&#x27;(&#x27;</span> )&#123;  <span class="comment">//å·¦è¾¹æ˜¯( ç»§ç»­å‘å³è§£æ</span></span><br><span class="line">            token_pop();</span><br><span class="line">            get_token();</span><br><span class="line">            dclor(ty);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">struct</span> token_node  node;</span><br><span class="line">            node = token_pop();</span><br><span class="line">            <span class="keyword">if</span>( <span class="built_in">strcmp</span>( node.token, <span class="string">&quot;splitor&quot;</span> ) == <span class="number">0</span> )&#123;</span><br><span class="line">                <span class="comment">//ç»“æŸ</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>( node.ty != <span class="literal">NULL</span> )&#123;</span><br><span class="line">                sbt.ty = node.ty;</span><br><span class="line">            &#125;</span><br><span class="line">            dcl_specifier( node.tok, <span class="literal">NULL</span> );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºç±»å‹çš„è§£æï¼Œæˆ‘è¿™é‡Œæ¨èä¸‹ã€ŠCä¸“å®¶ç¼–ç¨‹ã€‹ä¸­çš„ç±»å‹è§£é‡Šéƒ¨åˆ†ï¼Œé‡Œé¢è®²è§£å¾—æ›´åŠ é€å½»ã€‚</p><h2 id="è¡¨è¾¾å¼è§£æ-å››"><a href="#è¡¨è¾¾å¼è§£æ-å››" class="headerlink" title="è¡¨è¾¾å¼è§£æ(å››)"></a>è¡¨è¾¾å¼è§£æ(å››)</h2><p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/linxr/archive/2011/12/28/2304742.html%23BNF">1. BNFå®šä¹‰</a></p><p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/linxr/archive/2011/12/28/2304742.html%23exp2">2.è¡¨è¾¾å¼è§£æ</a></p><p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/linxr/archive/2011/12/28/2304742.html%23exp3">3. åç¼€è¡¨è¾¾å¼</a></p><p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/linxr/archive/2011/12/28/2304742.html%23exp4">4.åç¼€è¡¨è¾¾å¼åˆ°ä¸­é—´ä»£ç </a></p><p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/linxr/archive/2011/12/28/2304742.html%23exp5">5.ä¸­é—´ä»£ç çš„è¡¨ç¤º</a></p><h3 id="1-BNFå®šä¹‰"><a href="#1-BNFå®šä¹‰" class="headerlink" title="1. BNFå®šä¹‰"></a><strong>1. BNFå®šä¹‰</strong></h3><p>è™½ç„¶ä¸æƒ³å¤šæç†è®ºçŸ¥è¯†ï¼Œä½†æ˜¯æœ‰äº›ä¸œè¥¿è¿˜æ˜¯é¿å…ä¸äº†ã€‚åœ¨è§£æè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“å®ƒçš„BNFå®šä¹‰ï¼Œè¿™æ ·è§£æèµ·æ¥å°±éå¸¸æ–¹ä¾¿äº†ã€‚æ‰€è°“çš„BNFå®šä¹‰ï¼Œç›¸ä¿¡å¤§å®¶çœ‹ä¸€çœ¼å°±çŸ¥é“äº†ï¼š<br><strong><em>exp_additive</em></strong> <strong><em>-&gt;</em></strong> <strong><em>exp_multiplicative ( â€œ+â€|â€-â€œ ) exp_multiplicative</em></strong><br><strong><em>exp_multiplicative</em></strong> <strong><em>-&gt;</em></strong> <strong><em>exp_cast ( â€œ*â€|â€&#x2F;â€œ|â€%â€ ) exp_cast</em></strong><br><strong><em>exp_cast</em></strong> <strong><em>-&gt;</em></strong> <strong><em>â€¦</em></strong><br>æ„æ€æ˜¯ï¼š<br>åŠ æ³•è¡¨è¾¾å¼å¯ä»¥è¡¨ç¤ºä¸º â€œä¹˜æ³•è¡¨è¾¾å¼ + ä¹˜æ³•è¡¨è¾¾å¼â€<br>ä¹˜æ³•è¡¨è¾¾å¼å¯ä»¥è¡¨ç¤ºä¸º â€œç±»å‹è½¬æ¢è¡¨è¾¾å¼ *æˆ–&#x2F;æˆ–% ç±»å‹è½¬æ¢è¡¨è¾¾å¼â€<br>â€¦</p><p>çŸ¥é“äº†æ•´ä¸ªCè¯­è¨€çš„BNFå®šä¹‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆç®€å•çš„æŒ‰ç…§è¿™ä¸ªå®šä¹‰æ¥è§£æäº†ã€‚æ•´ä¸ªCçš„BNFå®šä¹‰å¯ä»¥æŸ¥çœ‹ä»¥ä¸‹çš„é“¾æ¥ï¼š<br><a href="https://link.zhihu.com/?target=http://lists.canonical.org/pipermail/kragen-hacks/1999-October/000201.html">http://lists.canonical.org/pip ermail/kragen-hacks/1999-October/000201.html</a></p><h3 id="2-è¡¨è¾¾å¼è§£æ"><a href="#2-è¡¨è¾¾å¼è§£æ" class="headerlink" title="2. è¡¨è¾¾å¼è§£æ"></a><strong>2. è¡¨è¾¾å¼è§£æ</strong></h3><p>çŸ¥é“äº†ä¸Šé¢çš„BNFå®šä¹‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è§£æä»£ç å°±å¯ä»¥è¿™ä¹ˆå†™ï¼š<br><em>void exp_additive(){</em><br><em>char op;</em><br><em>exp_multiplicative();</em><br><em>while(</em><br><em>(op &#x3D; OPERATOR( â€˜+â€™ )) ||</em><br><em>op &#x3D; OPERATOR( â€˜-â€˜ )) ){</em><br><em>get_token();</em><br><em>exp_multiplicative();</em><br><em>â€¦</em><br><em>}</em><br><em>}</em></p><p><em>void exp_multiplicative(){</em><br><em>char op;</em><br><em>exp_cast();</em><br><em>while(</em><br><em>(op &#x3D; OPERATOR( â€˜*â€™ )) ||</em><br><em>(op &#x3D; OPERATOR( â€˜&#x2F;â€˜ )) ||</em><br><em>(op &#x3D; OPERATOR( â€˜%â€™ )) ){</em><br><em>get_token();</em><br><em>exp_cast();</em><br><em>â€¦</em><br><em>}</em><br><em>}</em><br>è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š<br><strong>a.</strong> è°ƒç”¨exp_additiveæ—¶ï¼Œå…ˆè°ƒç”¨exp_multiplicative<br><strong>b.</strong> ç„¶ååˆ¤æ–­åé¢æ˜¯å¦æ˜¯ + æˆ– -ï¼Œå¦‚æœæ˜¯ï¼Œå†æ¬¡è°ƒç”¨exp_multiplicative<br>è¿™æ ·å°±å®Œæˆäº†åŠ æ³•è¡¨è¾¾å¼çš„è§£æã€‚å¦‚æœéè¦é—®ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™å°±èƒ½è§£æå‡ºè¡¨è¾¾å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¸¾ä¸ªä¾‹å­ï¼š<br><em><strong>a &#x3D; a * b + c * d;</strong></em><br>é‚£ä¹ˆï¼Œä»–çš„è¯­æ³•æ ‘åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><p>ï¼ˆå›¾4.2 è¯­æ³•æ ‘ï¼‰<br>æˆ‘ä»¬å‘ä¸‹é€’å½’è°ƒç”¨çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯æ„é€ è¿™ä¸ªè¯­æ³•æ ‘çš„è¿‡ç¨‹ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸ä¼šçœŸçš„åˆ›å»ºå‡ºè¿™ä¸ªè¯­æ³•æ ‘ï¼Œè€Œæ˜¯ä¿å­˜äº†ä¸€ä¸ªä¸å®ƒç­‰ä»·çš„ä¸€ç§å½¢å¼â€“åç¼€è¡¨è¾¾å¼,å…¶å®åç¼€è¡¨è¾¾å¼å°±æ˜¯è¯­æ³•æ ‘çš„åç»­éå†ã€‚</p><h3 id="3-åç¼€è¡¨è¾¾å¼"><a href="#3-åç¼€è¡¨è¾¾å¼" class="headerlink" title="3. åç¼€è¡¨è¾¾å¼"></a><strong>3. åç¼€è¡¨è¾¾å¼</strong></h3><p>ä»€ä¹ˆæ˜¯åç¼€è¡¨è¾¾å¼ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯ä»ä¾‹å­å‡ºå‘ï¼Œä¸Šé¢çš„è¡¨è¾¾å¼ï¼Œè½¬åŒ–æˆåç¼€è¡¨è¾¾å¼å°±æ˜¯è¿™æ ·å­çš„ï¼š<br><strong><em>a a b * c d * + &#x3D;</em></strong><br>ä¸ºä»€ä¹ˆè¦å†™æˆè¿™ç§å¥‡æ€ªçš„å½¢å¼ï¼Ÿæˆ‘ä»¬ä¸æ˜¯åƒé¥±äº†æ’‘ç€ï¼Œä»å·¦å¾€å³åˆ†åˆ«æŸ¥çœ‹è¿™ä¸ªè¡¨è¾¾å¼æ‚¨å°±çŸ¥é“åŸå› äº†ã€‚<br><strong>a</strong><br><strong>a</strong><br><strong>b</strong><br>***** å¾—åˆ°<em>å·ï¼Œé‚£ä¹ˆæ‹¿å‰é¢çš„ä¸¤ä¸ªå˜é‡a bæ±‚å’Œ<br><strong>c</strong><br><strong>d</strong><br>***** å¾—åˆ°</em>å·ï¼Œé‚£ä¹ˆæ‹¿å‰é¢çš„ä¸¤ä¸ªå˜é‡c dæ±‚å’Œ<br><strong>+</strong> çš„åˆ°+å·ï¼Œè·å–å‰é¢çš„ä¸¤ä¸ªå˜é‡ a<em>b c</em>d çš„ç»“æœï¼Œæ±‚å’Œ<br><strong>&#x3D;</strong> å¾—åˆ°&#x3D;å·ï¼Œå°†å‰é¢çš„ç»“æœèµ‹ç»™a<br>ä¸ºäº†ç”Ÿæˆåç¼€è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬è¦æ”¹é€ ä¸Šé¢çš„è§£æå‡½æ•°ã€‚<br><em>void exp_additive(){</em><br><em>char op;</em><br><em>exp_multiplicative();</em><br><em>while(</em><br><em>(op &#x3D; OPERATOR( â€˜+â€™ )) ||</em><br><em>op &#x3D; OPERATOR( â€˜-â€˜ )) ){</em><br><em>get_token();</em><br><em>exp_multiplicative();</em><br><strong><em>EXP_OPR( op );</em></strong><br><em>}</em><br><em>}</em></p><p><em>void exp_multiplicative(){</em><br><em>char op;</em><br><em>exp_cast();</em><br><em>while(</em><br><em>(op &#x3D; OPERATOR( â€˜*â€™ )) ||</em><br><em>(op &#x3D; OPERATOR( â€˜&#x2F;â€˜ )) ||</em><br><em>(op &#x3D; OPERATOR( â€˜%â€™ )) ){</em><br><em>get_token();</em><br><em>exp_cast();</em><br><em><strong>EXP_OPR( op );</strong></em><br><em>}</em><br><em>}</em><br>é‚£ä¹ˆè§£æå®Œæˆä»¥åï¼Œæˆ‘ä»¬çš„æ ˆä¸­å°±ä¼šå½¢æˆåç¼€è¡¨è¾¾å¼äº†ã€‚æœ‰äº†è¡¨è¾¾å¼çš„åç¼€å½¢å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾çš„äº§ç”Ÿåç¼€è¡¨è¾¾å¼çš„ä¸­é—´ä»£ç äº†ã€‚</p><h3 id="4-åç¼€è¡¨è¾¾å¼åˆ°ä¸­é—´ä»£ç "><a href="#4-åç¼€è¡¨è¾¾å¼åˆ°ä¸­é—´ä»£ç " class="headerlink" title="4.åç¼€è¡¨è¾¾å¼åˆ°ä¸­é—´ä»£ç "></a><strong>4.åç¼€è¡¨è¾¾å¼åˆ°ä¸­é—´ä»£ç </strong></h3><p>é¦–å…ˆæˆ‘ä»¬å…ˆè¯´æ˜ä¸€ä¸‹æˆ‘ä»¬çš„ä¸­é—´ä»£ç æ˜¯æ€æ ·çš„ä¸€ç§å½¢å¼ï¼Œè¿™é‡Œæš‚ä¸”å«å®ƒä¸ºä¸‰å…ƒè¡¨è¾¾å¼ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªç§ä¸­é—´ä»£ç çš„å½¢å¼æ˜¯å›ºå®šçš„ã€‚ä¾‹å¦‚ï¼Œç´§æ¥ä¸ŠèŠ‚çš„ä¾‹å­ï¼Œè¡¨è¾¾å¼ a &#x3D; a * b + c * d;çš„ä¸­é—´ä»£ç æœ€ç»ˆåº”è¯¥æ˜¯è¿™æ ·å­çš„ï¼š</p><p><em>@1 &#x3D; a * b;</em><br><em>@2 &#x3D; c * d;</em><br><em>@3 &#x3D; @1 + @2;</em><br><em>@4 &#x3D; a &#x3D; @3;</em></p><p>å…¶ä¸­ä»¥@å¼€å¤´çš„éƒ½æ˜¯æˆ‘ä»¬ä¸ºä¹‹äº§ç”Ÿçš„ä¸­é—´å˜é‡ã€‚ç”Ÿæˆä¸Šè¿°çš„ä¸­é—´ä»£ç åï¼Œå°†ä¼šå¯¹æˆ‘ä»¬åç»­çš„è§£ææä¾›å¾ˆå¤§çš„å¸®åŠ©ï¼Œåº”ä¸ºå®ƒç»“æ„å›ºå®šï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨å†å»è§£ææºç¨‹åºï¼Œè€Œæ˜¯é€šè¿‡è¿™ä¸ªä¸­é—´ä»£ç äº§ç”Ÿæœ€ç»ˆçš„æ‰§è¡Œä»£ç ã€‚è¿™é‡Œå…ˆå£°æ˜ä¸‹ï¼Œæˆ‘æ‰€è¯´çš„æ‰§è¡Œä»£ç ï¼Œä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šå¾—å¯æ‰§è¡Œä»£ç ï¼Œè€Œæ˜¯èƒ½å¤Ÿè¢«æˆ‘çš„è½¯ä»¶è§£æçš„å‘½ä»¤åºåˆ—ã€‚å…¶å®å®ƒå·²ç»éå¸¸æ¥è¿‘æ±‡ç¼–ä»£ç ã€‚ä½†æ˜¯æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è§£ææ‰§è¡Œï¼Œå¹¶ä¸äº§ç”Ÿæ±‡ç¼–ä»£ç ï¼Œæ‰€ä»¥äº§ç”Ÿç®€å•çš„å‘½ä»¤åºåˆ—å·²ç»å¯ä»¥å®Œæˆç›®æ ‡äº†ã€‚</p><p>æˆ‘ä»¬å‰é¢è§£æè¡¨è¾¾å¼ï¼Œäº§ç”Ÿåç¼€å½¢å¼ï¼Œä¸ºçš„å°±æ˜¯ç”Ÿäº§è¿™ç§ä¸­é—´è¡¨è¾¾å¼ã€‚è¡¨è¾¾å¼â€a &#x3D; a * b + c * d;â€çš„åç¼€å½¢å¼æ˜¯â€a a b * c d * + &#x3D;;â€ æˆ‘ä»¬è¦æ ¹æ®è¿™ä¸ªåç¼€å½¢å¼äº§ç”Ÿä¸­é—´ä»£ç çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><strong>5.ä¸­é—´ä»£ç çš„è¡¨ç¤º</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">code</span> <span class="title">code_t</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">code</span> * <span class="title">pcode_t</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">code</span>&#123;</span></span><br><span class="line">    <span class="type">char</span> opr;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">        <span class="type">int</span>  i, n, t;</span><br><span class="line">    &#125;lab;</span><br><span class="line">    <span class="type">v_t</span> var[<span class="number">4</span>];</span><br><span class="line">    <span class="type">code_t</span> * next;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®ƒæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜äº†ä¸€ä¸ªå½¢å¦‚â€@1 &#x3D; a * b;â€çš„ä¸­é—´ä»£ç ã€‚å…¶ä¸­ï¼Œoprè¡¨ç¤ºè¿ç®—ç¬¦â€*â€;labè¡¨ç¤ºè¯¥èŠ‚ç‚¹ä¸ºä¸€ä¸ªLAB,ç•™åˆ°åé¢ç« èŠ‚è®²è§£;varè¡¨ç¤ºè¿ç®—å˜é‡ï¼Œå¦‚ä¸Šé¢è¡¨è¾¾å¼çš„â€@1, a, bâ€ã€‚<br>è¿™æ ·å­ï¼Œå½“ä¸€ä¸ªè¡¨è¾¾å¼è§£æå®Œæˆåï¼Œä¼šç”Ÿæˆä¸€ä¸ªé“¾è¡¨ï¼Œè¡¨ç¤ºè¯¥è¡¨è¾¾å¼çš„ä¸­é—´ä»£ç ã€‚</p><h2 id="è¯­æ³•è§£æ-äº”"><a href="#è¯­æ³•è§£æ-äº”" class="headerlink" title="è¯­æ³•è§£æ(äº”)"></a>è¯­æ³•è§£æ(äº”)</h2><h3 id="1-ä»£ç å—"><a href="#1-ä»£ç å—" class="headerlink" title="1.ä»£ç å—"></a><strong>1.ä»£ç å—</strong></h3><p>ä»£ç å—æ˜¯ç”±å¤šä¸ªè¡¨è¾¾å¼ç»„æˆçš„ä¸€ç»„ä»£ç ã€‚å®ƒå¯ä»¥çœ‹æˆæ˜¯ä»¥ä¸‹çš„å½¢å¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    exp1</span><br><span class="line">    exp2</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒç”±â€{â€œå¼€å§‹ï¼Œç”±â€}â€ç»“æŸï¼Œä¸­é—´åŒ…å«å¤šæ¡è¡¨è¾¾å¼ï¼Œæˆ–è€…æ˜¯æ§åˆ¶è¯­å¥ã€‚å¦‚æœä¸æ˜¯ä»¥â€{â€œå¼€å§‹ï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªä»£ç å—å°±æ˜¯ä¸€æ¡è¡¨è¾¾å¼ã€‚åœ¨ä¸Šé¢çš„ç« èŠ‚ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ï¼Œæ¯ä¸ªè¡¨è¾¾å¼ä¼šäº§ç”Ÿä¸€ä¸ªä¸­é—´ä»£ç ã€‚å®ƒæ˜¯ä¸€ä¸ªé“¾è¡¨ struct _code * ï¼Œè€Œä¸€ä¸ªä»£ç å—ï¼Œæ˜¯ç”±å¤šä¸ªè¡¨è¾¾å¼ç»„æˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ¯ä¸ªè¡¨è¾¾å¼çš„ä¸­é—´ä»£ç é“¾è¡¨è¿åˆ°ä¸€èµ·å°±æˆäº†ä»£ç å—çš„ä¸­é—´ä»£ç äº†ã€‚<br>å¦‚æœä»£ç å—ä¸­åŒ…å«æ§åˆ¶è¯­å¥ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¿…é¡»åšä¸€äº›å¤„ç†ï¼Œå³åœ¨ä»£ç é“¾è¡¨ä¸­æ’å…¥è·³è½¬è¯­å¥ï¼Œå’Œè·³è½¬ä½ç½®(Lab)ã€‚</p><h3 id="2-æ§åˆ¶è¯­å¥"><a href="#2-æ§åˆ¶è¯­å¥" class="headerlink" title="2.æ§åˆ¶è¯­å¥"></a><strong>2.æ§åˆ¶è¯­å¥</strong></h3><p><strong>2.1 Cè¯­è¨€ä¸­ï¼Œæ§åˆ¶è¯­å¥æœ‰è¿™äº›ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a. <span class="keyword">if</span>( <span class="built_in">exp</span> ) stmt <span class="keyword">else</span> stmt</span><br><span class="line">b. <span class="keyword">do</span> stmt <span class="keyword">while</span>( <span class="built_in">exp</span> )</span><br><span class="line">c. <span class="keyword">while</span>( <span class="built_in">exp</span> ) stmt</span><br><span class="line">d. <span class="keyword">for</span>( exp1; exp2; exp3 ) stmt</span><br><span class="line">e. <span class="keyword">switch</span>( <span class="built_in">exp</span> ) stmt</span><br><span class="line">f. <span class="keyword">goto</span> lab</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œstmtè¡¨ç¤ºä¸€ä¸ªä»£ç å—ã€‚æˆ‘ä»¬å¦‚ä½•ä¸ºè¿™äº›ä»£ç äº§ç”Ÿä¸­é—´ä»£ç å‘¢ï¼Ÿè¿™é‡Œè¿˜è¦è¯´æ˜çš„æ˜¯è·³è½¬è¯­å¥ã€‚æ¯”å¦‚ä¸€ä¸ªifè¯­å¥ï¼š<br>if( exp ) stmt1 else stmt2<br>é‚£ä¹ˆ,å®ƒçš„æ„æ€æ˜¯ï¼Œå½“ exp &#x3D;&#x3D; 0 æ—¶ï¼Œè·³è½¬åˆ°stmt2ä½ç½®ï¼›å½“exp !&#x3D; 0çš„æ—¶å€™ä¸åšè·³è½¬ï¼Œä½†æ˜¯stmt1æ‰§è¡Œå®Œæˆåè¦è·³è½¬åˆ°stmt2çš„åé¢ã€‚æ‰€ä»¥ï¼Œè¿™ä¸­é—´æ¶‰åŠäº†ä¸¤ä¸ªä¸œè¥¿ï¼šè·³è½¬è¯­å¥ å’Œ è·³è½¬çš„ä½ç½®ã€‚è·³è½¬è¯­å¥æˆ‘ä»¬ç”¨ä¸‰ç§å‘½ä»¤è¡¨ç¤ºï¼šJEã€JNEã€JMPï¼Œå³ä¸ç­‰äºè·³è½¬ï¼Œç­‰äºè·³è½¬ï¼Œæ— æ¡ä»¶è·³è½¬ã€‚ è·³è½¬çš„ä½ç½®æˆ‘ä»¬ç”¨Labè¡¨ç¤ºï¼Œå³åœ¨ä»£ç é“¾è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ ‡ç­¾ï¼Œä¾›è·³è½¬è¯­å¥æŸ¥æ‰¾è¦è·³è½¬çš„ä½ç½®ã€‚<br>è¿˜æ˜¯ä¸Šé¢çš„ifè¯­å¥ï¼Œå®ƒäº§ç”Ÿåçš„ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> A.  if( exp ) stmt1 else stmt2 --&gt;</span><br><span class="line">       exp</span><br><span class="line">JE L1</span><br><span class="line">       stmt1</span><br><span class="line">JMP L2</span><br><span class="line">L1:</span><br><span class="line">       stmt2</span><br><span class="line">L2:</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ŒL1 L2åˆ†åˆ«å ç”¨ä»£ç é“¾è¡¨çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåœ¨code_tç»“æ„ä½“ä¸­ï¼Œç”¨labåŸŸè¡¨ç¤ºã€‚</p><p><strong>2.2 æ§åˆ¶è¯­å¥ä¸­çš„breakå’Œcontinue</strong>.</p><p>åœ¨ä¸€äº›æ§åˆ¶è¯­å¥ä¸­ï¼Œä»–ä»¬æ”¯æŒbreakå’Œcontinueï¼Œå³å¦‚æœåœ¨ä»£ç å—æ€»å‡ºç°breakï¼Œé‚£ä¹ˆä»–åº”è¯¥è·³è½¬åˆ°ä»£ç å—çš„å¤–é¢ï¼Œå¦‚æœæ˜¯continue,é‚£ä¹ˆè·³è½¬åˆ°æ¡ä»¶è¯­å¥ç»§ç»­æ‰§è¡Œã€‚ä¾‹å¦‚ä¸‹é¢çš„do whileè¯­å¥ï¼š</p><p>B. do stmt while( exp ) â€“&gt;<br><em>L1:</em><br><em>stmt</em></p><p><strong>2.3 å…¶ä»–æ§åˆ¶è¯­å¥çš„ä»£ç å½¢å¼</strong>ï¼š</p><p>C. while( exp ) stmt â€“&gt;<br><em>JMP</em> <em>L2</em><br><em>L1:</em><br><em>stmt</em><br><em>L2:</em><br><em>exp</em><br><em>JNE</em> <em>L1</em><br><em>L3:</em></p><p>D. for( exp1; exp2; exp3 ) stmt â€“&gt;<br><em>exp1</em><br><em>JMP</em> <em>L3</em><br><em>L1:</em><br><em>stmt</em><br><em>L2:</em><br><em>exp3</em><br><em>L3:</em><br><em>exp2</em><br><em>JNE</em> <em>goto L1</em><br><em>L4:</em></p><p>E. switch( exp ){<br><em>case 1: stmt1</em><br><em>case i: stmti</em><br><em>default: stmt</em><br><em>â€¦</em><br><em>}</em></p><p><em>exp</em><br><em>selete i and jmp(L1..Ln,L)</em><br><em>Li: stmti</em><br><em>L: stmt</em><br><em>LL:</em></p><p>selete i and jmp(L1..Ln,L) è¡¨ç¤º å¦‚æœexpçš„ç»“æœæ˜¯i,é‚£ä¹ˆè·³è½¬åˆ°Li,å¦åˆ™è·³è½¬åˆ°Lã€‚switchè¯­å¥è·Ÿåˆ«çš„æ§åˆ¶è¯­å¥ä¸ä¸€æ ·ï¼Œå…¶ä»–çš„æ§åˆ¶è¯­å¥åœ¨è¿˜æ²¡è§£æä»£ç å—çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å·²ç»çŸ¥é“åº”è¯¥åˆ›å»ºå‡ ä¸ªLabäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥äº‹å…ˆåˆ›å»ºå¥½Labï¼Œç„¶ååœ¨é€‚å½“çš„ä½ç½®æ’å…¥JMPè¯­å¥ï¼Œè¿™ä¸ªJMPè¯­å¥ä¸­è·³è½¬åˆ°çš„Labè¿™æ—¶å€™å·²ç»ç¡®å®šäº†ã€‚ä½†æ˜¯å¯¹äºswitchè¯­å¥ï¼Œæˆ‘ä»¬äº‹å…ˆä¸çŸ¥é“caseåœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œæ‰€ä»¥ä¸çŸ¥é“â€selete i and jmp(L1..Ln,L)â€åº”è¯¥å¯¹åº”ä»€ä¹ˆä»£ç ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»è§£æå®Œstmt(ä»£ç å—)ä¹‹åæ‰èƒ½äº§ç”Ÿä»£ç ã€‚ å…·ä½“çš„åšæ³•æ˜¯åœ¨è§£æä»£ç å¿«çš„æ—¶å€™è®°å½•ä¸‹æ‰€ä»¥çš„Labï¼Œè§£æå®Œæˆåå†åšç›¸åº”çš„å¤„ç†ï¼Œå³æ„é€ â€selete i and jmp(L1..Ln,L)â€ä»£ç ï¼Œå°†å®ƒè¿æ¥åˆ°ä¸­é—´ä»£ç çš„å‰é¢ã€‚</p><p>F. goto Lab â€“&gt;<br><em>JMP</em> <em>Lab</em></p><p>åœ¨è§£ægotoçš„æ—¶å€™ï¼Œå¿…é¡»å°†â€Labâ€åç§°è½¬æ¢æˆæˆ‘ä»¬çš„Labçš„è¡¨ç¤ºå½¢å¼ã€‚</p><h3 id="3-å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#3-å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3.å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ"></a><strong>3.å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ</strong></h3><p>åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®šä¹‰çš„å˜é‡ç§°ä¹‹ä¸ºå±€éƒ¨å˜é‡ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³åœ¨è‡ªå·±çš„ä»£ç å—ä¸­å®šä¹‰çš„ï¼Œé‚£ä¹ˆå®ƒåªå¯¹è¿™ä¸ªä»£ç å—çš„ä»£ç å¯è§ã€‚ä¾‹å¦‚æœ‰ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç¬¬äºŒä¸ªaå¯¹printfè¯­å¥å¤„æ˜¯ä¸å¯è§çš„ã€‚ä¸ºäº†è¡¨ç¤ºå˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªå˜é‡åŠ å…¥äº†beginå’ŒendåŸŸï¼Œç”¨æ¥ä¿å­˜è¯¥å˜é‡å¯¹[begin,end]åŒºé—´çš„ä»£ç æ˜¯å¯è§çš„ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œbegin,å’Œendæ€ä¹ˆè§£ææ˜¯ä¸ªé—®é¢˜ï¼Œbeginä¸éš¾ï¼Œåœ¨è§£æå®šä¹‰çš„æ—¶å€™å°±å¯ä»¥ç¡®å®šï¼Œä½†æ˜¯endç¡®å®æ¯”è¾ƒéš¾ï¼Œå› ä¸ºå¿…é¡»åœ¨ä¸€ä¸ªä»£ç å—ä¸­ç»“æŸåï¼ˆå³è§£æåˆ°â€}â€åï¼‰ï¼Œæ‰çŸ¥é“endçš„å€¼ã€‚æ‰€ä»¥ä¸ºäº†ç¡®å®šendçš„å€¼ï¼Œæ ˆåœ¨è¿™é‡Œåˆè¢«å¾ç”¨äº†ã€‚</p><p>{</p><h3 id="4-å‡½æ•°è§£æ"><a href="#4-å‡½æ•°è§£æ" class="headerlink" title="4.å‡½æ•°è§£æ"></a><strong>4.å‡½æ•°è§£æ</strong></h3><p>ä¸€ä¸ªå‡½æ•°åŒ…æ‹¬è¿™å‡ ä¸ªéƒ¨åˆ†ï¼š<br>a. è¿”å›å€¼ç±»å‹<br>b. å½¢å‚åˆ—è¡¨<br>c. å±€éƒ¨å˜é‡<br>d. ä»£ç å—<br>ä¾‹å¦‚ä¸‹é¢çš„å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">( <span class="type">int</span> a, <span class="type">int</span> b )</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">    c = a + b;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå®ƒçš„è¿”å›å€¼ç±»å‹æ˜¯int, å‚æ•°åˆ—è¡¨æ˜¯aã€bï¼Œå±€éƒ¨å˜é‡æœ‰c, æ‰§è¡Œä»£ç æ˜¯ â€œ c &#x3D; a + b; return c; â€œ ã€‚ä»”ç»†è§‚å¯Ÿï¼Œå®ƒå…¶å®æ˜¯ç”±å‡½æ•°å£°æ˜å’Œä¸€ä¸ªä»£ç å—ç»„æˆçš„ã€‚æ‰€ä»¥è§£æè¿™ä¸ªå‡½æ•°ä¹Ÿå¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯è§£æå£°æ˜ï¼Œå¾—åˆ°å‡½æ•°åï¼Œå‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼ç±»å‹ã€‚ç„¶åæ‰§è¡Œä¸Šä¸€ç« èŠ‚æè¿°çš„è§£æä»£ç å—å‡½æ•°ï¼Œå¾—åˆ°è¯¥å‡½æ•°çš„ä¸­é—´ä»£ç é“¾ã€‚</p><h3 id="5-é™„"><a href="#5-é™„" class="headerlink" title="5.é™„"></a><strong>5.é™„</strong></h3><p>æ¯”å¦‚æœ‰å¦‚ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">( <span class="type">int</span> argc, <span class="type">char</span> **argv )</span>&#123;</span><br><span class="line">    <span class="type">int</span> a, b;</span><br><span class="line">    b = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>( a=<span class="number">0</span>; a&lt;<span class="number">10</span>; a++ )&#123;</span><br><span class="line">        b *= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™ä¸ªå‡½æ•°æ‰€å¯¹åº”çš„ä¸­é—´ä»£ç æ˜¯è¿™æ ·çš„ï¼š<br>fun: main 2-args: argc argv b a<br><em>@0 &#x3D; b &#x3D; 1</em><br><em>@1 &#x3D; a &#x3D; 0</em><br><em>JMP 7</em><br><em>LAB_5:</em><br><em>@4 &#x3D; b *&#x3D; 2</em><br><em>LAB_6:</em><br><em>@3 &#x3D; a ++</em><br><em>LAB_7:</em><br><em>@2 &#x3D; a &lt; 10</em><br><em>JNE 5</em><br><em>LAB_8:</em><br><em>@5 &#x3D; b</em></p>]]></content>
      
      
      <categories>
          
          <category> wæŠ¥é”™è§£å†³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wsl </tag>
            
            <tag> æŠ¥é”™è§£å†³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32 HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº</title>
      <link href="/2024/03/stm32-STM32-HAL%E5%BA%93%E9%A9%B1%E5%8A%A8DHT11%E8%AF%BB%E5%8F%96%E6%B8%A9%E6%B9%BF%E5%BA%A6%E7%A8%8B%E5%BA%8F/"/>
      <url>/2024/03/stm32-STM32-HAL%E5%BA%93%E9%A9%B1%E5%8A%A8DHT11%E8%AF%BB%E5%8F%96%E6%B8%A9%E6%B9%BF%E5%BA%A6%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº"><a href="#STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº" class="headerlink" title="STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº"></a>STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº</h2><p><strong>é©±åŠ¨DHT11ã€DHT22ã€DS18BB20ç­‰æ¸©æ¹¿åº¦æ¨¡å—æ—¶åºæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå…³é”®åœ¨äºæ§åˆ¶å¥½æ—¶åºçš„ <code>&amp;#x5EF6;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;</code> ï¼ŒHALåº“çš„å»¶æ—¶å‡½æ•°HAL_Delayæ˜¯æ¯«ç§’çº§åˆ«å»¶æ—¶å‡½æ•°ï¼Œæ‰€å…³é”®ç‚¹å°±æ˜¯å®ç°å¾®ç§’çº§åˆ«çš„å»¶æ—¶å‡½æ•°ã€‚</strong></p><p><strong>å¾®ç§’çº§åˆ«å»¶æ—¶å‡½æ•°å®ç°è§æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š<a href="https://blog.csdn.net/qq153471503/article/details/102930097">https://blog.csdn.net/qq153471503/article/details/102930097</a></strong></p><p><strong>æ‰«æä»¥ä¸‹äºŒç»´ç ï¼Œå…³æ³¨å…¬ä¼—å· <code>&amp;#x96CD;&amp;#x6B63;&amp;#x4E0D;&amp;#x79C3;&amp;#x5934;</code> è·å–æ›´å¤šSTM32èµ„æºåŠå¹²è´§ï¼</strong><br><img src="https://img-blog.csdnimg.cn/20210126155428872.png"></p><h3 id="sys-h"><a href="#sys-h" class="headerlink" title=";  sys.h"></a><a name="sysh_13">;</a>  sys.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _SYS_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _SYS_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BITBAND(addr, bitnum) ((addr &amp; 0xF0000000)+0x2000000+((addr &amp;0xFFFFF)&lt;&lt;5)+(bitnum&lt;&lt;2))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEM_ADDR(addr)  *((volatile unsigned long  *)(addr))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BIT_ADDR(addr, bitnum)   MEM_ADDR(BITBAND(addr, bitnum))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOA_ODR_Addr    (GPIOA_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOB_ODR_Addr    (GPIOB_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOC_ODR_Addr    (GPIOC_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOD_ODR_Addr    (GPIOD_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOE_ODR_Addr    (GPIOE_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOF_ODR_Addr    (GPIOF_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOG_ODR_Addr    (GPIOG_BASE+12)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOA_IDR_Addr    (GPIOA_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOB_IDR_Addr    (GPIOB_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOC_IDR_Addr    (GPIOC_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOD_IDR_Addr    (GPIOD_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOE_IDR_Addr    (GPIOE_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOF_IDR_Addr    (GPIOF_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOG_IDR_Addr    (GPIOG_BASE+8)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PAout(n)   BIT_ADDR(GPIOA_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PAin(n)    BIT_ADDR(GPIOA_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PBout(n)   BIT_ADDR(GPIOB_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PBin(n)    BIT_ADDR(GPIOB_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCout(n)   BIT_ADDR(GPIOC_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCin(n)    BIT_ADDR(GPIOC_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PDout(n)   BIT_ADDR(GPIOD_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PDin(n)    BIT_ADDR(GPIOD_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PEout(n)   BIT_ADDR(GPIOE_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PEin(n)    BIT_ADDR(GPIOE_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PFout(n)   BIT_ADDR(GPIOF_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PFin(n)    BIT_ADDR(GPIOF_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PGout(n)   BIT_ADDR(GPIOG_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PGin(n)    BIT_ADDR(GPIOG_IDR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="dht11-h"><a href="#dht11-h" class="headerlink" title="dht11.h"></a>dht11.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DHT11_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DHT11_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sys.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint8_t</span> u8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint16_t</span> u16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint32_t</span> u32;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHT11_IO_IN()  &#123;IODHT22_GPIO_Port-&gt;CRH &amp;= 0xFFFFF0FF;IODHT22_GPIO_Port-&gt;CRH |= 8 &lt;&lt; 8;&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHT11_IO_OUT() &#123;IODHT22_GPIO_Port-&gt;CRH &amp;= 0xFFFFF0FF;IODHT22_GPIO_Port-&gt;CRH |= 3 &lt;&lt; 8;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>DHT11_DQ_OUT PCout(10)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>DHT11_DQ_IN  PCin(10)</span></span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Read_Data</span><span class="params">(u8 *temp, u8 *humi)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Read_Byte</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Read_Bit</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Check</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">DHT11_Rst</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Read_Data_Float</span><span class="params">(<span class="type">float</span> *temp,<span class="type">float</span> *humi)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="dht11-c"><a href="#dht11-c" class="headerlink" title="dht11.c"></a>dht11.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dht11.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DHT11_Rst</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    DHT11_IO_OUT();</span><br><span class="line">    DHT11_DQ_OUT=<span class="number">0</span>;</span><br><span class="line">    delay_ms(<span class="number">20</span>);</span><br><span class="line">    DHT11_DQ_OUT=<span class="number">1</span>;</span><br><span class="line">    delay_us(<span class="number">30</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Check</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 retry=<span class="number">0</span>;</span><br><span class="line">    DHT11_IO_IN();</span><br><span class="line">    <span class="keyword">while</span> (DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(<span class="number">1</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span>(retry&gt;=<span class="number">100</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> retry=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(<span class="number">1</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span>(retry&gt;=<span class="number">100</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Read_Bit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 retry=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    retry=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    delay_us(<span class="number">40</span>);</span><br><span class="line">    <span class="keyword">if</span>(DHT11_DQ_IN)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Read_Byte</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 i,dat;</span><br><span class="line">    dat=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        dat&lt;<span class="number">1</span>;</span><br><span class="line">        dat|=DHT11_Read_Bit();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Read_Data</span><span class="params">(u8 *temp,u8 *humi)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 buf[<span class="number">5</span>];</span><br><span class="line">    u8 i;</span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    <span class="keyword">if</span>(DHT11_Check()==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            buf[i]=DHT11_Read_Byte();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>((buf[<span class="number">0</span>]+buf[<span class="number">1</span>]+buf[<span class="number">2</span>]+buf[<span class="number">3</span>])==buf[<span class="number">4</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            *humi=buf[<span class="number">0</span>];</span><br><span class="line">            *temp=buf[<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Read_Data_Float</span><span class="params">(<span class="type">float</span> *temp,<span class="type">float</span> *humi)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 buf[<span class="number">5</span>];</span><br><span class="line">    u8 i;</span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    <span class="keyword">if</span>(DHT11_Check()==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            buf[i]=DHT11_Read_Byte();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>((buf[<span class="number">0</span>]+buf[<span class="number">1</span>]+buf[<span class="number">2</span>]+buf[<span class="number">3</span>])==buf[<span class="number">4</span>])</span><br><span class="line">        &#123;</span><br><span class="line">*humi=((buf[<span class="number">0</span>] &lt;&lt; <span class="number">8</span>) + buf[<span class="number">1</span>]) / <span class="number">10.0</span>;</span><br><span class="line">*temp=((buf[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + buf[<span class="number">3</span>]) / <span class="number">10.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 ret = <span class="number">1</span>;</span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    ret = DHT11_Check();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;dht11 init %s. \r\n&quot;</span>, ret == <span class="number">0</span> ? <span class="string">&quot;ok&quot;</span> : <span class="string">&quot;failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32 å®ç° 44 çŸ©é˜µé”®ç›˜æ‰«æï¼ˆHALåº“ã€æ ‡å‡†åº“ éƒ½é€‚ç”¨ï¼‰ - ç™½èœæ²¡æˆ‘ç™½ - åšå®¢å›­</title>
      <link href="/2024/03/stm32-STM32-%E5%AE%9E%E7%8E%B0-44-%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98%E6%89%AB%E6%8F%8F%EF%BC%88HAL%E5%BA%93%E3%80%81%E6%A0%87%E5%87%86%E5%BA%93-%E9%83%BD%E9%80%82%E7%94%A8%EF%BC%89-%E7%99%BD%E8%8F%9C%E6%B2%A1%E6%88%91%E7%99%BD-%E5%8D%9A%E5%AE%A2%E5%9B%AD/"/>
      <url>/2024/03/stm32-STM32-%E5%AE%9E%E7%8E%B0-44-%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98%E6%89%AB%E6%8F%8F%EF%BC%88HAL%E5%BA%93%E3%80%81%E6%A0%87%E5%87%86%E5%BA%93-%E9%83%BD%E9%80%82%E7%94%A8%EF%BC%89-%E7%99%BD%E8%8F%9C%E6%B2%A1%E6%88%91%E7%99%BD-%E5%8D%9A%E5%AE%A2%E5%9B%AD/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>æœ¬æ–‡å®ç°çš„ä»£ç æ˜¯åŸºäºSTM32HALåº“çš„åŸºç¡€ä¸Šçš„ï¼Œä¸è¿‡æ ‡å‡†åº“ä¹Ÿå¯ä»¥ç”¨ï¼Œåªæ˜¯è°ƒç”¨çš„åº“å‡½æ•°ä¸åŒï¼Œé€»è¾‘è·Ÿé…ç½®æ˜¯ä¸€æ ·çš„ï¼ŒæŒ‰æˆ‘è¿™é‡Œçš„é€»è¾‘æ¥é…ç½®å³å¯ã€‚</p><p><strong>1ã€é”®ç›˜åŸç†å›¾ï¼š</strong></p><p><img src="https://img2018.cnblogs.com/blog/1433771/201903/1433771-20190313172634453-1011388660.png"></p><p>åŸç†ä¸¾ä¾‹ï¼šå…ˆæŠŠ F0-F7 å†…éƒ¨æ‹‰é«˜ï¼Œè¿™æ ·è¿™ä¸ª8ä¸ªå¼•è„šéƒ½æ˜¯é«˜ç”µå¹³ï¼Œç„¶åå°±è¿›è¡Œåˆ—æ‰«æã€‚ä¾‹å¦‚ï¼šå‡å¦‚æŒ‰ä¸‹3æŒ‰é’®ï¼ŒY3 åˆ—æ‰«æï¼ŒæŠŠF4å…ˆæ‹‰ä½ï¼Œç„¶åè¯»å–F0-F3çš„çŠ¶æ€ï¼Œå°±ä¼šè¯»å‡ºä¸º1110ï¼Œè¿™å°±å¯ ä»¥çŸ¥é“æ˜¯F3è¡Œæ‹‰ä½äº†ï¼ŒåŒæ—¶è¿™æ—¶å€™æ˜¯ç¨‹åºæ§åˆ¶F4æ‹‰ä½çš„ï¼Œè¿™æ ·å°±å¯ä»¥çŸ¥é“æ˜¯F4åˆ—å¯¼è‡´å®ƒè½¬æ€å˜åŒ–äº†çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®šä½å‡ºæ˜¯F4åˆ—F3è¡Œçš„æŒ‰é”®æŒ‰ä¸‹äº†ï¼›å…¶ä»–çš„åˆ—ä¹Ÿæ˜¯è¿™æ ·å­æ‰«æï¼Œå°±å¯ä»¥å®ç°äº†ã€‚</p><p><strong>2ã€STM32 cubemx å¼•è„šé…ç½®å›¾ï¼š</strong></p><p><img src="https://img2018.cnblogs.com/blog/1433771/201903/1433771-20190313173013856-453677748.png"></p><p>è¿™é‡Œç”¨å¤–éƒ¨æ™¶æŒ¯å†…éƒ¨æ™¶æŒ¯éƒ½å¯ä»¥ï¼Œæ—¶é’Ÿå¯¹è¿™ä¸ªæ²¡ä»€ä¹ˆå½±å“ï¼Œä¸ç”¨å¼€ä¸­æ–­ï¼Œæ‰€ä»¥å…¶ä»–çš„é…ç½®å°±ä¸ç»†è¯´äº†ï¼Œä¸‹é¢å†è¯´ä¸€ä¸‹è¿™8ä¸ªGPIOçš„é…ç½®ã€‚</p><p><img src="https://img2018.cnblogs.com/blog/1433771/201903/1433771-20190313173246180-1491953324.png"></p><p>4ä¸ªå¼•è„šé…æ¨æŒ½è¾“å‡ºï¼Œè¿™4ä¸ªé…è¾“å‡ºçš„å¼•è„šå†…éƒ¨ä¸Šä¸‹æ‹‰ä¸ç”¨é…ç½®ï¼›å¦å¤–4ä¸ªé…æˆè¾“å…¥ï¼Œå†…éƒ¨ä¸Šæ‹‰ã€‚</p><p><strong>3ã€ç”Ÿæˆä»£ç åï¼Œå¼€å§‹ç¼–å†™é€»è¾‘ï¼š</strong></p><p>ç¼–å†™ä¹‹å‰æˆ‘ä»¬å…ˆåšä¸€ä¸‹å¤´æ–‡ä»¶çš„å®šä¹‰ï¼ŒæŠŠä¸€äº›è¦ç”¨åˆ°çš„å®å®šä¹‰å¥½ï¼š</p><pre><span>#ifndef __HW_key_H__</span><span>#define</span> __HW_key_H__<span>#include </span><span>&quot;</span><span>main.h</span><span>&quot;</span><span>#include </span><span>&quot;</span><span>stm32f1xx_hal.h</span><span>&quot;</span><span>#include </span>&lt;<span>string</span>.h&gt;<span>char</span> KEY_SCAN(<span>void</span><span>);</span><span>char</span> KEY_ROW_SCAN(<span>void</span><span>);</span><span>void</span> HW_KEY_FUNCTION(<span>void</span><span>);</span><span>#define</span> KEY_CLO0_OUT_LOW  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_7,GPIO_PIN_RESET)<span>#define</span> KEY_CLO1_OUT_LOW  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_8,GPIO_PIN_RESET)<span>#define</span> KEY_CLO2_OUT_LOW  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_9,GPIO_PIN_RESET)<span>#define</span> KEY_CLO3_OUT_LOW  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_10,GPIO_PIN_RESET)<span>#define</span> KEY_CLO0_OUT_HIGH  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_7,GPIO_PIN_SET)<span>#define</span> KEY_CLO1_OUT_HIGH  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_8,GPIO_PIN_SET)<span>#define</span> KEY_CLO2_OUT_HIGH  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_9,GPIO_PIN_SET)<span>#define</span> KEY_CLO3_OUT_HIGH  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_10,GPIO_PIN_SET)<span>#endif</span></pre><p>ç„¶ååŒ…å«å¤´æ–‡ä»¶ä»¥åŠå®šä¹‰ä¸€äº›è¦ç”¨åˆ°çš„å˜é‡æ•°ç»„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;HW_key.h&quot;</span><br><span class="line">uint8_t Key_row[1]=&#123;0xff&#125;;   //ä¿å­˜æŒ‰é”®è¡Œæ‰«ææƒ…å†µçš„çŠ¶æ€æ•°ç»„</span><br></pre></td></tr></table></figure><p>æ¥ç€å¯ä»¥å†™æ‰«æé€»è¾‘äº†ï¼Œå…ˆç¼–å†™æ¨ªæ‰«æçš„ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/***</span><br><span class="line"> *å‡½æ•°åï¼šKEY_ROW_SCAN</span><br><span class="line"> *åŠŸ  èƒ½ï¼šæŒ‰é”®è¡Œæ‰«æ</span><br><span class="line"> *è¿”å›å€¼ï¼š1~4ï¼Œå¯¹åº”1~4è¡ŒæŒ‰é”®ä½ç½®</span><br><span class="line"> */</span><br><span class="line">char KEY_ROW_SCAN(void)</span><br><span class="line">&#123;</span><br><span class="line">    //è¯»å‡ºè¡Œæ‰«æçŠ¶æ€</span><br><span class="line">    Key_row[0] = HAL_GPIO_ReadPin(GPIOE,KEY_row0_Pin)&lt;&lt;3;</span><br><span class="line">    Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_row1_Pin)&lt;&lt;2);</span><br><span class="line">    Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_row2_Pin)&lt;&lt;1);</span><br><span class="line">    Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_row3_Pin));</span><br><span class="line"></span><br><span class="line">    if(Key_row[0] != 0x0f)         //è¡Œæ‰«ææœ‰å˜åŒ–ï¼Œåˆ¤æ–­è¯¥åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">      HAL_Delay(10);                    //æ¶ˆæŠ–</span><br><span class="line">      if(Key_row[0] != 0x0f)</span><br><span class="line">        &#123;</span><br><span class="line">                //printf(&quot;Key_Row_DATA = 0x%x\r\n&quot;,Key_row[0]);</span><br><span class="line">                switch(Key_row[0])</span><br><span class="line">                &#123;</span><br><span class="line">                    case 0x07:         //0111 åˆ¤æ–­ä¸ºè¯¥åˆ—ç¬¬1è¡Œçš„æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">                        return 1;</span><br><span class="line">                    case 0x0b:         //1011 åˆ¤æ–­ä¸ºè¯¥åˆ—ç¬¬2è¡Œçš„æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">                        return 2;</span><br><span class="line">                    case 0x0d:         //1101 åˆ¤æ–­ä¸ºè¯¥åˆ—ç¬¬3è¡Œçš„æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">                        return 3;</span><br><span class="line">                    case 0x0e:         //1110 åˆ¤æ–­ä¸ºè¯¥åˆ—ç¬¬4è¡Œçš„æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">                        return 4;</span><br><span class="line">                    default :</span><br><span class="line">                        return 0;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    else return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥åˆ¤æ–­å“ªä¸€è¡Œæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œå¹¶è¿”å›æœ‰æŒ‰é”®æŒ‰ä¸‹çš„è¡Œæ•°ã€‚</p><p>æ¥ç€ç¼–å†™åˆ—æ‰«æçš„ä»£ç ï¼Œè¿™é‡Œçš„æ€æƒ³æ˜¯ï¼Œå…ˆæ‰«æç¬¬ä¸€åˆ—ï¼Œæ¥ç€åˆ¤æ–­ç¬¬ä¸€åˆ—æœ‰æ²¡æœ‰è¡Œè¢«æŒ‰ä¸‹ï¼Œæœ‰çš„è¯å°±å¯ä»¥ç›´æ¥å®šä½åˆ°è¿™ä¸€åˆ—çš„å“ªä¸€è¡Œï¼Œå…¶ä»–4åˆ—é€»è¾‘ä¸€æ ·ï¼Œè¿™æ ·å°±å¯ä»¥å®šä½åˆ°å“ªä¸ªæŒ‰é”®æŒ‰ä¸‹äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">/***</span><br><span class="line"> *å‡½æ•°åï¼šKEY_SCAN</span><br><span class="line"> *åŠŸ  èƒ½ï¼š4*4æŒ‰é”®æ‰«æ</span><br><span class="line"> *è¿”å›å€¼ï¼š0~16ï¼Œå¯¹åº”16ä¸ªæŒ‰é”®</span><br><span class="line"> */</span><br><span class="line">char KEY_SCAN(void)</span><br><span class="line">&#123;</span><br><span class="line">    char Key_Num=0;       //1-16å¯¹åº”çš„æŒ‰é”®æ•°</span><br><span class="line">    char key_row_num=0;        //è¡Œæ‰«æç»“æœè®°å½•</span><br><span class="line"></span><br><span class="line">    KEY_CLO0_OUT_LOW;</span><br><span class="line">    if( (key_row_num=KEY_ROW_SCAN()) != 0 )</span><br><span class="line">    &#123;</span><br><span class="line">        while(KEY_ROW_SCAN() != 0);  //æ¶ˆæŠ–</span><br><span class="line">        Key_Num = 0 + key_row_num;</span><br><span class="line">        //printf(&quot;Key_Clo_1\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    KEY_CLO0_OUT_HIGH;</span><br><span class="line"></span><br><span class="line">    KEY_CLO1_OUT_LOW;</span><br><span class="line">    if( (key_row_num=KEY_ROW_SCAN()) != 0 )</span><br><span class="line">    &#123;</span><br><span class="line">        while(KEY_ROW_SCAN() != 0);</span><br><span class="line">        Key_Num = 4 + key_row_num;</span><br><span class="line">        //printf(&quot;Key_Clo_2\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    KEY_CLO1_OUT_HIGH;</span><br><span class="line"></span><br><span class="line">    KEY_CLO2_OUT_LOW;</span><br><span class="line">    if( (key_row_num=KEY_ROW_SCAN()) != 0 )</span><br><span class="line">    &#123;</span><br><span class="line">        while(KEY_ROW_SCAN() != 0);</span><br><span class="line">    Key_Num = 8 + key_row_num;</span><br><span class="line">        //printf(&quot;Key_Clo_3\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    KEY_CLO2_OUT_HIGH;</span><br><span class="line"></span><br><span class="line">    KEY_CLO3_OUT_LOW;</span><br><span class="line">    if( (key_row_num=KEY_ROW_SCAN()) != 0 )</span><br><span class="line">    &#123;</span><br><span class="line">//        Key_row[0] = HAL_GPIO_ReadPin(GPIOE,KEY_col0_Pin)&lt;//        Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_col1_Pin)&lt;//        Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_col2_Pin)&lt;//        Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_col3_Pin));</span><br><span class="line">//        printf(&quot;Key_Clo4_DATA = 0x%x\r\n&quot;,Key_row[0]);</span><br><span class="line">        while(KEY_ROW_SCAN() != 0);</span><br><span class="line">        Key_Num = 12 + key_row_num;</span><br><span class="line">        //printf(&quot;Key_Clo_4\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    KEY_CLO3_OUT_HIGH;</span><br><span class="line"></span><br><span class="line">    return Key_Num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°å°±å¯ä»¥ç›´æ¥è¿”å›1-16ä¸ªæŒ‰é”®çš„æŒ‰é”®æ•°äº†ï¼ŒæŒ‰ä¸‹ç¬¬ä¸€ä¸ªæŒ‰é”®å°±è¿”å›1ï¼Œç¬¬2ä¸ªå°±è¿”å›2ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä¸‹é¢å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°åšæŒ‰é”®æŒ‰ä¸‹çš„æ“ä½œäº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/***</span><br><span class="line"> *å‡½æ•°åï¼šKEY_ROW_SCAN</span><br><span class="line"> *åŠŸ  èƒ½ï¼šæ‰§è¡ŒæŒ‰ä¸‹æŒ‰é”®åçš„æ“ä½œ</span><br><span class="line"> *è¿”å›å€¼ï¼šæ— </span><br><span class="line"> */</span><br><span class="line">void HW_KEY_FUNCTION(void)</span><br><span class="line">&#123;</span><br><span class="line">    char key_confirm;</span><br><span class="line">    key_confirm = KEY_SCAN();</span><br><span class="line">    if( 0 &lt; key_confirm  &amp;&amp; key_confirm &lt; 17 )</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;Key_NUM = %d \r\n&quot;,key_confirm); //æŒ‰ä¸‹1-16ä¸ªæŒ‰é”®çš„æ“ä½œ</span><br><span class="line">        printf(&quot;= = = = = = = = = = = \r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œå°±æ˜¯ç”¨ä¸²å£åŠ©æ‰‹æ‰“å°å‡ºæ¥æŸ¥çœ‹å“ªä¸ªæŒ‰é”®æŒ‰ä¸‹çš„ï¼Œå®æµ‹å¯ç”¨ã€‚</p><p><img src="https://img2018.cnblogs.com/blog/1433771/201903/1433771-20190318150541397-1921208533.png"></p><p><strong>4ã€æ€»ç»“ï¼š</strong></p><p>ï¼ˆ1ï¼‰å…ˆé…ç½®8ä¸ªå¼•è„šï¼Œ4ä¸ªé…ç½®è¾“å…¥ï¼Œä¸Šæ‹‰ï¼›4ä¸ªé…ç½®æˆæ¨æŒ½ï¼ˆPPï¼‰è¾“å‡ºï¼Œä¸ç”¨ä¸Šä¸‹æ‹‰ï¼Œè¾“å‡ºé«˜ç”µå¹³ï¼›</p><p>ï¼ˆ2ï¼‰è½¯ä»¶é€»è¾‘ï¼š</p><p>a. å…ˆè¯´ä¸€ä¸‹è¡Œæ‰«æçš„åŸç†ï¼Œå› ä¸ºå¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹çš„è¯ï¼ŒæŸä¸€ä¸ªè¾“å…¥çš„å¼•è„šå°±ä¼šè·Ÿå¯¹åº”çš„è¾“å‡ºå¼•è„šè¿æ¥ï¼Œå› ä¸ºè¾“å‡ºä¸ºé«˜ç”µå¹³ï¼Œæ‰€ä»¥å¯¹åº”çš„è¾“å…¥å¼•è„šä¼šè¢«æ‹‰é«˜ï¼Œè¯»å–å¼•è„šçš„çŠ¶æ€ï¼Œåˆ¤æ–­å“ªä¸ªå¼•è„šè¢«æ‹‰é«˜å°±å¯ä»¥çŸ¥é“å“ªä¸€è¡Œæœ‰æŒ‰é”®æŒ‰ä¸‹äº†ï¼›æ€»çš„æ¥è¯´æ˜¯é€šè¿‡é«˜å››ä½è¾“å‡ºé«˜ç”µå¹³æ¥å¯¹çŸ©é˜µé”®ç›˜è¿›è¡Œé€è¡Œæ‰«æï¼Œå½“ä½å››ä½æ¥æ”¶åˆ°çš„æ•°æ®ä¸å…¨ä¸º1çš„æ—¶å€™ï¼Œè¯´æ˜æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œç„¶åé€šè¿‡æ¥æ”¶åˆ°çš„æ•°æ®æ˜¯å“ªä¸€ä½ä¸º0æ¥åˆ¤æ–­æ˜¯å“ªä¸€è¡ŒæŒ‰é”®è¢«æŒ‰ä¸‹ï¼›</p><p>b. åˆ—æ‰«æåŸç†ï¼šæ€è·¯æ˜¯å…ˆæŠŠç¬¬ä¸€åˆ—è¾“å‡ºä½ç”µå¹³ï¼Œæ¥ç€è¯»å–é«˜4ä½çš„ç”µå¹³è½¬æ€ï¼Œå•ä¸å…¨ä¸º1æ—¶ï¼Œè¯´æ˜è¿™ä¸€åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ŒåŒæ—¶ç»“åˆè¡Œæ‰«æåˆ¤æ–­å‡ºæ¥çš„è¡Œæ•°å®šä½åˆ°æŒ‰ä¸‹çš„æŒ‰é”®ã€‚ç¨‹åºé‡Œæ˜¯æ‰«æç¬¬ä¸€åˆ—çš„æ—¶å€™ç¬¬ä¸€åˆ—ç»™ä½ç”µå¹³ï¼Œæ¥ç€è¿›è¡Œè¡Œæ‰«æåˆ¤æ–­ï¼Œå› ä¸ºè¾“å…¥è¾“å‡ºå¼•è„šéƒ½æ˜¯é«˜ç”µå¹³äº†ï¼Œåªæœ‰ç¬¬ä¸€åˆ—çš„å¼•è„šæ˜¯ä½ç”µå¹³ï¼Œæ‰€ä»¥å½“ç¬¬ä¸€åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹çš„æ—¶å€™ï¼Œè¡Œæ‰«æè¯»åˆ°çš„4ä¸ªå¼•è„šå°±ä¸å…¨ä¸º1ï¼Œè¿™æ—¶å› ä¸ºç¬¬ä¸€åˆ—çš„ç”µå¹³æ˜¯æˆ‘ä»¬è‡ªå·±ç»™çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥ç›´æ¥åˆ¤æ–­è¿™ä¸€åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼›æ¥ç€åˆ©ç”¨è¡Œæ‰«æåŸç†å®šä½å“ªä¸€è¡Œæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­å‡ºç¬¬ä¸€åˆ—çš„æŸä¸€è¡Œçš„æŒ‰é”®è¢«æŒ‰ä¸‹äº†ï¼Œå…¶ä»–3åˆ—åŒç†ï¼Œç„¶åè½®æµæ‰«æ4åˆ—å°±å¯ä»¥åˆ¤æ–­16ä¸ªæŒ‰é”®äº†ã€‚</p><p>é€šä¿—ç‚¹è¯´ï¼Œå°±æ˜¯å¦‚æœæˆ‘ç»™è¿™ä¸€åˆ—ä½ç”µå¹³ï¼Œé€ æˆäº†è¡Œæ‰«ææœ‰å˜åŒ–ï¼Œé‚£å°±ç›´æ¥çŸ¥é“è¿™ä¸€åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œæ¥ç€æŸ¥çœ‹è¡Œå˜åŒ–çš„ç”µå¹³å˜åŒ–ï¼Œæ¨ç®—å‡ºå“ªä¸€è¡Œå˜åŒ–äº†ï¼Œå°±å¯ä»¥çŸ¥é“è¿™ä¸€åˆ—çš„ç¬¬å‡ ä¸ªæŒ‰é”®è¢«æŒ‰ä¸‹äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32CubeMX  HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦</title>
      <link href="/2024/03/stm32-STM32CubeMX-HAL%E5%BA%93%E7%9A%84ADC%E5%A4%9A%E9%80%9A%E9%81%93%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%EF%BC%88%E8%BD%AE%E8%AE%AD%E3%80%81DMA%E3%80%81DMA-TIM-%E3%80%81%E8%AF%BB%E5%8F%96%E5%86%85%E9%83%A8%E4%BC%A0%E6%84%9F%E5%99%A8%E6%B8%A9%E5%BA%A6/"/>
      <url>/2024/03/stm32-STM32CubeMX-HAL%E5%BA%93%E7%9A%84ADC%E5%A4%9A%E9%80%9A%E9%81%93%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%EF%BC%88%E8%BD%AE%E8%AE%AD%E3%80%81DMA%E3%80%81DMA-TIM-%E3%80%81%E8%AF%BB%E5%8F%96%E5%86%85%E9%83%A8%E4%BC%A0%E6%84%9F%E5%99%A8%E6%B8%A9%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="STM32CubeMX-HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA-TIM-ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦"><a href="#STM32CubeMX-HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA-TIM-ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦" class="headerlink" title="STM32CubeMX | HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦"></a>STM32CubeMX | HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦</h2><h4 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h4><ul><li><a href="#stm32cubemx--haladcdmadmatim-0">STM32CubeMX | HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦</a></li><li><ul><li><ul><li><a href="#1adc-11">1ã€ADCç®€ä»‹</a></li><li><ul><li><a href="#11--13">1.1 é‡‡æ ·å®šç†</a></li><li><a href="#12--15">1.2 æ¨¡å¼ä»‹ç»</a></li><li><a href="#13--24">1.3 é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—</a></li></ul></li><li><a href="#2-56">2ã€è½®è®­æ–¹å¼çš„å¤šé€šé“é‡‡é›†</a></li><li><ul><li><a href="#21--57">2.1 æ–¹å¼ä¸€ï¼šé—´æ–­æ¨¡å¼+æ‰«ææ¨¡å¼</a></li><li><a href="#22--72">2.2 æ–¹å¼äºŒï¼šå®Œå…¨è½®è®­</a></li></ul></li><li><a href="#3dma-108">3ã€DMAå®ç°å¤šé€šé“é‡‡é›†</a></li><li><a href="#4timdma-136">4ã€TIM+DMAå®ç°å¤šé€šé“é‡‡é›†</a></li><li><a href="#5adc-179">5ã€è¡¥å……ï¼šå†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ADCé€šé“</a></li></ul></li></ul></li></ul><p><em>æ³¨ï¼šæœ¬ç‰‡æ–‡ç« ä»¥STM32F103ç³»åˆ—ä¸ºä¾‹ï¼Œå…¶ä»–ç³»åˆ—å¯èƒ½ç¨æœ‰ä¸åŒã€‚</em></p><h4 id="1ã€ADCç®€ä»‹"><a href="#1ã€ADCç®€ä»‹" class="headerlink" title="1ã€ADCç®€ä»‹"></a>1ã€ADCç®€ä»‹</h4><h5 id="1-1-é‡‡æ ·å®šç†"><a href="#1-1-é‡‡æ ·å®šç†" class="headerlink" title="1.1 é‡‡æ ·å®šç†"></a>1.1 é‡‡æ ·å®šç†</h5><h5 id="1-2-æ¨¡å¼ä»‹ç»"><a href="#1-2-æ¨¡å¼ä»‹ç»" class="headerlink" title="1.2 æ¨¡å¼ä»‹ç»"></a>1.2 æ¨¡å¼ä»‹ç»</h5><ul><li><strong>æ‰«ææ¨¡å¼ï¼š</strong> ä½¿ç”¨STM32CUBEMXé…ç½®äº†å¤šé€šé“åï¼Œè¿™ä¸€é¡¹é»˜è®¤å¼€å¯ä¸”æ— æ³•è®¾ç½®æˆå…³é—­ã€‚è¿™ä¸ªæ¨¡å¼å°±æ˜¯è‡ªåŠ¨æ‰«æä½ å¼€å¯çš„æ‰€æœ‰é€šé“è¿›è¡Œè½¬æ¢ï¼Œç›´è‡³è½¬æ¢å®Œã€‚ä¾‹å¦‚ä½ å¼€å¯äº†CH0ã€CH1ã€CH2ã€CH3è¿™å››ä¸ªé€šé“ï¼Œå¯åŠ¨è½¬æ¢åADCä¼šè‡ªåŠ¨å°†è¿™4ä¸ªé€šé“å…¨éƒ¨è½¬æ¢å®Œï¼Œä½†æ˜¯è¿™ç§è¿ç»­æ€§æ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œæ‰€ä»¥å°±å¼•å‡ºäº†é—´æ–­æ¨¡å¼ã€‚</li><li><strong>è¿ç»­æ¨¡å¼ï¼š</strong> åœ¨CUBEä¸­é€‰ä¸­ENABLEå°±æ˜¯è¿ç»­æ¨¡å¼ï¼ŒDISABLEå°±æ˜¯å•æ¬¡æ¨¡å¼ã€‚å¼€å¯è¿ç»­æ¨¡å¼åï¼ŒADCçš„è½¬æ¢ä¸ç”±å…¶ä»–æ§åˆ¶ã€‚ä¾‹å¦‚å°†ADCè®¾ç½®ä¸ºäº†å®šæ—¶å™¨çš„TGROè§¦å‘é‡‡æ ·ï¼Œå¦‚æœå¼€å¯è¿ç»­æ¨¡å¼ï¼ŒADCå°†å¿½ç•¥å®šæ—¶å™¨çš„è§¦å‘é‡‡æ ·ã€‚ï¼ˆè¿ç»­è½¬æ¢æ¨¡å¼å¼€å¯åå…¶å®å°±æ˜¯æ»¡é¢‘ç‡çš„é‡‡æ ·ï¼‰ã€‚</li><li><strong>é—´æ–­æ¨¡å¼ï¼š</strong> å¯ä»¥å°†å¤šä¸ªé€šé“è¿›è¡Œ <strong>åˆ†ç»„é‡‡é›†</strong>ï¼Œä¾‹å¦‚ä½ å¼€å¯äº†CH0~3è¿™4ä¸ªé€šé“ï¼Œå‡å¦‚ä½ è®¾ç½®äº†é—´æ–­æ¬¡æ•°ä¸º4ï¼Œå°±ç›¸å½“äºå°†4ä¸ªé€šé“åˆ†æˆäº†4ç»„ï¼Œæ¯ç»„1ä¸ªé€šé“ï¼Œé‚£ä¹ˆè¦æƒ³é‡‡é›†å®Œè¿™4ä¸ªé€šé“å°±éœ€è¦æ‰‹åŠ¨è§¦å‘4æ¬¡ADCé‡‡é›†ï¼›å¦‚æœè®¾ç½®äº†é—´æ–­æ¬¡æ•°ä¸º2ï¼Œé‚£ä¹ˆé‡‡é›†å®Œ4ä¸ªé€šé“å°±éœ€è¦æ‰‹åŠ¨è§¦å‘2æ¬¡ADCé‡‡é›†ã€‚</li></ul><h5 id="1-3-é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—"><a href="#1-3-é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—" class="headerlink" title="1.3 é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—"></a>1.3 é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—</h5><p><strong>ADCé‡‡æ ·ä¸¤ç‚¹é—´éš”çš„æ—¶é—´ä¸€å®šè¦å¤§äºADCçš„é‡‡æ ·æ—¶é—´ï¼</strong> é‡‡æ ·æ—¶é—´æ€ä¹ˆç®—ï¼Œä¸‹é¢å°±ç»†è¯´ä¸€ä¸‹ã€‚</p><p>STM32F103ä¸€èˆ¬å°†æ—¶é’Ÿé…ç½®ä¸»é¢‘ä¸º72Mã€APB2ä¸º72Mã€‚ADCæŒ‚åœ¨APB2æ—¶é’Ÿæ€»çº¿ä¸Šï¼Œä¸”ADCçš„æ—¶é’Ÿä¸èƒ½è¶…è¿‡14Mã€‚æ‰€ä»¥ä¸€èˆ¬å°†ADCçš„åˆ†é¢‘è®¾ç½®ä¸º6ï¼ŒADCçš„æ—¶é’Ÿä¸»é¢‘å°±ä¸º72&#x2F;6&#x3D;12MHzã€‚é‚£ä¹ˆä¸€ä¸ªå‘¨æœŸå°±æ˜¯ï¼š1&#x2F;12MHz&#x3D;0.0833usã€‚</p><p>ä»¥ä¸‹æˆªå›¾ä¸ºSTM32F1å‚è€ƒæ‰‹å†Œï¼ˆæ‰‹å†Œç¼–å·RM0008ï¼Œå¯åœ¨STå®˜ç½‘ç›´æ¥æœç´¢ä¸‹è½½ï¼‰ï¼š</p><p><img src="https://img-blog.csdnimg.cn/84ca12cd9d40459eb3e03c54889e9df3.png"></p><p>ä¸Šå›¾çš„æ„æ€æ˜¯ï¼šADCå¯¹è¾“å…¥ç”µå‹é‡‡æ ·è‹¥å¹²ä¸ªADC_CLKå‘¨æœŸï¼Œè¿™äº›å‘¨æœŸå¯é€šè¿‡ADC_SMPR1å’ŒADC_SMPR2å¯„å­˜å™¨ä¸­çš„SMP[2:0]ä½è¿›è¡Œä¿®æ”¹ã€‚æ¯ä¸ªé€šé“éƒ½å¯ä»¥ç”¨ä¸åŒçš„é‡‡æ ·æ—¶é—´è¿›è¡Œé‡‡æ ·ã€‚</p><p><strong>ADCè½¬æ¢æ—¶é—´ &#x3D; é‡‡æ ·æ—¶é—´ + 12.5ä¸ªå‘¨æœŸ</strong></p><p>ç¤ºä¾‹ï¼š</p><pre><code class="å½“ADCæ—¶é’Ÿä¸»é¢‘ä¸º14MHzå¹¶ä¸”é‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªå‘¨æœŸæ—¶ï¼šé‡‡æ ·æ—¶é—´">STM32F1ç³»åˆ—çš„æ—¶é’Ÿä¸»é¢‘ä¸€èˆ¬è®¾ç½®ä¸ºäº†12Mï¼Œé‡‡æ ·æ—¶é—´çš„è®¾ç½®æ‰€å¯¹åº”é‡‡æ ·é¢‘ç‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://img-blog.csdnimg.cn/de1135452e21490a94b671995f48824f.png)çŸ¥é“äº†æœ€çŸ­æ—¶é—´åï¼Œå½“ADCæ—¶é’Ÿä¸»é¢‘ä¸º12Må¹¶ä¸”é‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªå‘¨æœŸæ—¶ï¼ŒADCé‡‡æ ·ä¸¤ç‚¹çš„æ—¶é—´å¿…é¡»å¤§äº1.17usã€‚è€ŒSTM32F031ç³»åˆ—çš„ADCæ—¶é’Ÿä¸»é¢‘ä¸º14MHzï¼Œé‡‡æ ·æ—¶é—´çš„è®¾ç½®æ‰€å¯¹åº”é‡‡æ ·é¢‘ç‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://img-blog.csdnimg.cn/4616052a159b4c6da44230ee81f9a4a0.png)å½“ADCæ—¶é’Ÿä¸»é¢‘ä¸º14Må¹¶ä¸”é‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªå‘¨æœŸæ—¶ï¼ŒADCé‡‡æ ·ä¸¤ç‚¹çš„æ—¶é—´å¿…é¡»å¤§äº1usã€‚#### &lt;a name=&quot;2_56&quot;&gt;;&lt;/a&gt;  2ã€è½®è®­æ–¹å¼çš„å¤šé€šé“é‡‡é›†##### 2.1 æ–¹å¼ä¸€ï¼šé—´æ–­æ¨¡å¼+æ‰«ææ¨¡å¼æˆ‘å¼€å¯äº†é€šé“0ã€1ã€2ä»¥åŠå†…éƒ¨æ¸©åº¦è¯»å–é€šé“ä¸€å…±å››ä¸ªé€šé“ï¼š![](https://img-blog.csdnimg.cn/20200820144708671.png#pic_center)![](https://img-blog.csdnimg.cn/20200820144717271.png#pic_center)å¦‚æœæƒ³ä½¿ç”¨è½®è®­æ–¹å¼å¹¶ä¸”ä¸ä½¿ç”¨DMAçš„å¤šé€šé“é‡‡é›†ï¼Œé‚£ä¹ˆå°±è¦é…ç½®ä¸º **ã€å•æ¬¡æ¨¡å¼+é—´æ–­æ¨¡å¼ã€‘**ï¼Œå¹¶ä¸”å°†Number Of Discontinuous Conversionsä¸º1ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªé€šé“åˆ†æˆäº†ä¸€ä¸ªç»„ï¼Œé…ç½®å¦‚ä¸‹å›¾ï¼š![](https://img-blog.csdnimg.cn/20200820145205371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center)ç”±äºæˆ‘è¿™é‡Œè®¾ç½®é—´æ–­æ•°ä¸º1ï¼Œä¹Ÿå°±æ˜¯å°†4ä¸ªé€šé“åˆ†æˆäº†4ç»„ï¼Œé‚£ä¹ˆæˆ‘æ¯æ¬¡é‡‡é›†çš„æ—¶å€™éƒ½éœ€è¦æ‰‹åŠ¨å»è§¦å‘ADCé‡‡é›†ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä¸€æ¬¡HAL_ADC_Startå‡½æ•°ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/2020082014582133.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center)æˆ‘å°†é€šé“0åˆ†åˆ«æ¥åˆ°3.3Vå’ŒGNDä¸Šï¼Œ4é€šé“é‡‡é›†è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/20200820150008132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center)##### &lt;a name=&quot;22__72&quot;&gt;;&lt;/a&gt;  2.2 æ–¹å¼äºŒï¼šå®Œå…¨è½®è®­å®Œå…¨ä½¿ç”¨è½®è®­çš„æ–¹å¼ä¸èƒ½ä½¿ç”¨ **æ‰«ææ¨¡å¼**ï¼ˆç†è®ºä¸Šæ¥è¯´å¤šé€šé“éœ€è¦ä½¿ç”¨æ‰«ææ¨¡å¼ï¼Œè€Œä¸æ˜¯å®Œå…¨è½®è®­ï¼‰ï¼Œä½†æ˜¯ä½¿ç”¨STM32CUBEMXé…ç½®å¤šé€šé“æ‰«ææ¨¡å¼ä¸æ— æ³•è¢«å…³é—­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç”¨STM32CUBEMXé…ç½®æˆä¸€ä¸ªé€šé“ï¼š![](https://img-blog.csdnimg.cn/0b4c62f299d54bcf89ba61ea0aee0eca.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAeS16aGVuZw==,size_20,color_FFFFFF,t_70,g_se,x_16)ç„¶åè¯»å–ADCé‡‡é›†æ•°å€¼çš„å‡½æ•°æ˜¯è¿™æ ·ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint16_t</span> <span class="title function_">ADC_Read</span><span class="params">(<span class="type">uint32_t</span> Channel)</span></span><br><span class="line">&#123;</span><br><span class="line">ADC_ChannelConfTypeDef sConfig = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">sConfig.Channel = Channel;</span><br><span class="line">sConfig.Rank = ADC_REGULAR_RANK_1;</span><br><span class="line">sConfig.SamplingTime = ADC_SAMPLETIME_55CYCLES_5;</span><br><span class="line"><span class="keyword">if</span> (HAL_ADC_ConfigChannel(&amp;hadc1, &amp;sConfig) != HAL_OK)</span><br><span class="line">&#123;</span><br><span class="line">Error_Handler();</span><br><span class="line">&#125;</span><br><span class="line">HAL_ADC_Start(&amp;hadc1);</span><br><span class="line">HAL_ADC_PollForConversion(&amp;hadc1, HAL_MAX_DELAY);</span><br><span class="line"><span class="keyword">return</span> (<span class="type">uint16_t</span>)HAL_ADC_GetValue(&amp;hadc1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>#### 3ã€DMAå®ç°å¤šé€šé“é‡‡é›†é€šè¿‡DMAå®ç°å¤šé€šé“æ•°æ®é‡‡é›†ï¼Œ **è¦å°†è¿ç»­æ¨¡å¼å’Œé—´æ–­æ¨¡å¼å…³é—­ï¼**å¦‚æœè¿ç»­æ¨¡å¼å¼€å¯ï¼Œé‚£ä¹ˆé€šè¿‡DMAä¼ è¾“åˆ°çš„æ•°ç»„ä¸­ï¼Œæ¯ä¸ªé€šé“æ‰€é‡‡é›†åˆ°çš„å€¼å¯¹åº”æ•°ç»„ä¸­çš„ä¸€ä¸ªä½ç½®å°±æ˜¯ä¸å›ºå®šçš„ã€‚ä¾‹å¦‚ä½ å¼€å¯äº†IN0~IN3è¿™å››ä¸ªé€šé“ï¼Œå¹¶é€šè¿‡DMAå°†è¿™å››ä¸ªé€šé“çš„æ•°æ®æ”¾åˆ°ADC_Valueè¿™ä¸ªå¤§å°ä¸º4çš„u16ç±»å‹æ•°ç»„ï¼Œä½ åœ¨ç¬¬ä¸€æ¬¡é‡‡é›†çš„æ—¶å€™IN0é€šé“çš„æ•°å€¼é€šè¿‡DMAè¢«æ”¾åœ¨ADC_Value[0]ï¼Œç¬¬äºŒæ¬¡é‡‡é›†çš„æ—¶å€™IN0é‡‡é›†åˆ°çš„æ•°å€¼å°±å¯èƒ½è¢«æ”¾åˆ°äº†ADC_Value[1]ï¼Œè¿™æ ·çš„è¯å°±æä¸æ–¹ä¾¿æˆ‘ä»¬å¯¹æ¯ä¸ªé€šé“çš„æ•°æ®è¿›è¡Œåˆ†æå’Œæå–ã€‚é…ç½®å¦‚ä¸‹ï¼Œå°†è¿ç»­è½¬æ¢æ¨¡å¼å’Œé—´æ–­è½¬æ¢æ¨¡å¼å…³é—­ï¼Œå¹¶å¼€å¯ADCçš„DMAé€šé“ï¼Œå°†DMAçš„æ¨¡å¼é…ç½®ä¸ºå‘¨æœŸæ¨¡å¼ï¼š![](https://img-blog.csdnimg.cn/20200820152200735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center)![](https://img-blog.csdnimg.cn/ddd590ed84b44942863728c7b84ff639.png)ä»£ç å¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/c457e847f73847ceb3a35f112f66667e.png)4ä¸ªé€šé“é‡‡é›†è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/20200820152427227.png#pic_center)#### &lt;a name=&quot;4timdma_136&quot;&gt;;&lt;/a&gt;  4ã€TIM+DMAå®ç°å¤šé€šé“é‡‡é›†åœ¨ä¸ä½¿ç”¨DMAçš„æƒ…å†µä¸‹ï¼Œå®šæ—¶å™¨æ§åˆ¶ADCè¿›è¡Œæ•°æ®é‡‡é›†åªèƒ½æ˜¯å•é€šé“ï¼å¦‚æœå¼€å¯äº†å¤šé€šé“ï¼Œè¯»å–åˆ°çš„ADCé‡‡é›†å€¼åªä¼šæ˜¯æœ€åä¸€ä¸ªé€šé“çš„å€¼ï¼æ‰€ä»¥ï¼Œè¦æƒ³ä½¿ç”¨å®šæ—¶å™¨æ§åˆ¶ADCé‡‡é›† **å¤šé€šé“**ï¼Œå¿…é¡»ä½¿ç”¨DMAï¼CubeMXé…ç½®å¦‚ä¸‹ï¼Œä½¿èƒ½ADCçš„DMAï¼š![](https://img-blog.csdnimg.cn/42aa3e7658df4d89ac32b7f2a1ebc643.png)ADCçš„è§¦å‘æ–¹å¼è®¾ç½®ä¸ºå®šæ—¶å™¨3çš„è§¦å‘äº‹ä»¶ï¼š![](https://img-blog.csdnimg.cn/c4ff90b3330b44fda0a609316e2370db.png)é‡‡æ ·æ—¶é—´è®¾ç½®ä¸ºäº†55.5ä¸ªå‘¨æœŸï¼Œå¯¹åº”é‡‡æ ·é¢‘ç‡ä¸º176.47KHzï¼Œæ‰€ä»¥å®šæ—¶å™¨3çš„é¢‘ç‡è®¾ç½®è¦ä½äº176.47KHzã€‚è®¾ç½®å®šæ—¶å™¨3åˆ†é¢‘ç³»æ•°ä¸º72ï¼Œé‡è½½å€¼ä¸º10ï¼Œå¾—åˆ° `72MHz / 72&amp;#x5206;&amp;#x9891; / 10 = 100KHz`çš„å®šæ—¶å™¨3ï¼š![](https://img-blog.csdnimg.cn/a50e71979339457e90f451449ec69d86.png)ä»£ç å¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/c418cbe4d5b340a2ae94438927728da5.png)è¿è¡Œç»“æœå¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/534899ff62e24bcb9909ffaff4b29065.png)å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©è¿›è¡Œä¸€ç»„æ•°æ®ï¼Œä¾‹å¦‚å°†32ä¸ªç‚¹ä¸ºä¸€ç»„æ•°æ®è¿›è¡Œé‡‡é›†ï¼Œè®¾ç½®å¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/a08aa8f0ae7c4cd8bfd70d40a980b3e1.png)è¿è¡Œç»“æœå¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/eb3feca6e37140eeb65f794634e86da3.png)#### 5ã€è¡¥å……ï¼šå†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ADCé€šé“![](https://img-blog.csdnimg.cn/87fe51b0eb7b447798ade02be31b4329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70)ä¸Šé¢å›¾ç‰‡æ˜¯æˆªå–åœ¨STM32F103RCçš„datasheetä¸­çš„ï¼Œä¸­æ–‡æ„æ€å°±æ˜¯ï¼šæ¸©åº¦ä¼ æ„Ÿå™¨å¿…é¡»äº§ç”Ÿéšæ¸©åº¦çº¿æ€§å˜åŒ–çš„ç”µå‹ã€‚è½¬æ¢èŒƒå›´åœ¨2v &lt; VDDA &lt; 3.6 Vä¹‹é—´ã€‚æ¸©åº¦ä¼ æ„Ÿå™¨å†…éƒ¨è¿æ¥ADC1_IN16è¾“å…¥é€šé“ï¼Œç”¨äºå°†ä¼ æ„Ÿå™¨è¾“å‡ºç”µå‹è½¬æ¢ä¸ºæ•°å­—å€¼ã€‚å†…éƒ¨æ¸©åº¦è®¡ç®—å…¬å¼ï¼šã€Temperature = &#123;(V25 - VSENSE) / Avg_Slope&#125; + 25ã€‘å­—æ®µè¯´æ˜ï¼š* **V25ï¼š** æœ€å°1.34Vï¼Œæœ€å¤§1.52Vï¼Œå…¸å‹å€¼1.43V* **Avg_Slopeï¼š** æœ€å°4.0ï¼Œæœ€å¤§4.6ï¼Œå…¸å‹å€¼4.3mv/â„ƒ* **VSENSEï¼š** ADCé‡‡é›†åˆ°çš„ç”µå‹![](https://img-blog.csdnimg.cn/da0745b68e874c41b42573887a74e20e.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70)ADCå€¼è½¬ç”µå‹å€¼è®¡ç®—å…¬å¼ï¼šã€ç”µå‹ = ADCé‡‡é›†åˆ°çš„å€¼ * 3.3 / 4096ã€‘çœ‹ä¸Šå›¾æˆ‘é‡‡é›†åˆ°çš„å€¼ä¸º1703ï¼Œå…ˆè½¬æ¢ä¸ºç”µå‹å€¼ï¼š1703*3.3/4096â‰ˆ1.37**ï¼ˆ1.43 - 1.37ï¼‰/ 0.0043 + 25 â‰ˆ 38.95â„ƒ**ends...</code></pre>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€HALåº“ã€‘STM32+ESP8266+Onenet+MQTTï¼Œæç®€å·¥ç¨‹ï¼Œhalåº“ç§»æ¤ã€‚</title>
      <link href="/2024/03/stm32-%E3%80%90HAL%E5%BA%93%E3%80%91STM32-ESP8266-Onenet-MQTT%EF%BC%8C%E6%9E%81%E7%AE%80%E5%B7%A5%E7%A8%8B%EF%BC%8Chal%E5%BA%93%E7%A7%BB%E6%A4%8D%E3%80%82/"/>
      <url>/2024/03/stm32-%E3%80%90HAL%E5%BA%93%E3%80%91STM32-ESP8266-Onenet-MQTT%EF%BC%8C%E6%9E%81%E7%AE%80%E5%B7%A5%E7%A8%8B%EF%BC%8Chal%E5%BA%93%E7%A7%BB%E6%A4%8D%E3%80%82/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h4 id="ESP8266-Onenet-MQTT"><a href="#ESP8266-Onenet-MQTT" class="headerlink" title="ESP8266+Onenet+MQTT"></a>ESP8266+Onenet+MQTT</h4><ul><li><ul><li><a href="#1-chled-12">1 å¯¼å…¥.c.hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰</a></li><li><a href="#2-cubemx-21">2 Cubemxé…ç½®</a></li><li><a href="#3--ch--27">3 ä¿®æ”¹ .c.h æ–‡ä»¶</a></li><li><a href="#4--65">4 æµ‹è¯•</a></li></ul></li></ul><p>ESP8266é€šè¿‡MQTTåè®®è¿æ¥Onenetã€‚ä»æ ‡å‡†åº“ç§»åˆ°äº†HALåº“ï¼Œè¿‡ç¨‹æœ‰ç‚¹éº»çƒ¦ï¼Œæ•´äº†ä¸€å¤©ã€‚åšå®Œåæ•´ç†äº†ä¸€ä¸‹ï¼Œè¿™ä¸ªæç®€çš„å·¥ç¨‹ï¼Œæ–¹ä¾¿ä»¥åå¼€å‘ï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚</p><p>ä»£ç å·¥ç¨‹ï¼š<br><a href="https://github.com/wyfroom/ESP8266-Onenet-MQTT">https://github.com/wyfroom/ESP8266-Onenet-MQTT</a></p><p>è¯¥ä»½ä»£ç ç¡¬ä»¶é…ç½®ï¼š<br>æ¿å­ï¼šSTM32F103C8T6æœ€å°ç³»ç»Ÿæ¿ã€‚<br>å¤–è®¾ï¼šä¸²å£1ç”¨ä½œè°ƒè¯•ï¼Œä¸²å£3ç”¨ä½œesp8266ã€‚<br>esp8266ï¼šæ·˜å®ï¼Œesp-01s</p><h3 id="1-å¯¼å…¥-c-hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰"><a href="#1-å¯¼å…¥-c-hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰" class="headerlink" title="1 å¯¼å…¥.c.hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰"></a>1 å¯¼å…¥.c.hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰</h3><p>åœ¨keilå·¥ç¨‹ä¸­å¯¼å…¥ä¹‹å‰å†™å¥½çš„.c.hæ–‡ä»¶ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»æ ‡å‡†åº“ç§»å€’halåº“çš„ï¼Œç›´æ¥ä»æˆ‘å·¥ç¨‹é‡Œå¤åˆ¶å°±è¡Œï¼Œå¾ˆçº¯å‡€ï¼Œæ²¡æœ‰åŠ å¤šä½™çš„ä¸œè¥¿ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•æ ¹æ®ä¸ªäººå®é™…ä½¿ç”¨æƒ…å†µæ›´æ”¹ä¸€äº›å‚æ•°ã€‚</p><blockquote><p>cubemxè¯¦ç»†ä½¿ç”¨æ•™ç¨‹åŠæ‰€æœ‰æ¨¡å—æ•´åˆè§è¿™ç¯‡ï¼š<br><a href="http://t.csdn.cn/Awtl9">ã€HALåº“ã€‘HALåº“STM32cubemxå¿«é€Ÿä½¿ç”¨</a></p></blockquote><p><img src="https://img-blog.csdnimg.cn/img_convert/913840e121e5a09eff4133733245efe9.png"></p><h3 id="2-Cubemxé…ç½®"><a href="#2-Cubemxé…ç½®" class="headerlink" title=";  2 Cubemxé…ç½®"></a><a name="2_cubemx_21">;</a>  2 Cubemxé…ç½®</h3><p>ä¸²å£1ç”¨äºè°ƒè¯•ï¼Œä¸²å£3ç”¨äºESP8266é€šä¿¡ï¼Œæ‰“å¼€ä¸­æ–­ã€‚</p><p>åŸºç¡€çš„æˆ‘å°±ä¸é…ç½®äº†ï¼Œå¯ä»¥çœ‹å‰é¢çš„è¯¦ç»†è®²è§£ã€‚</p><h3 id="3-ä¿®æ”¹-c-h-æ–‡ä»¶"><a href="#3-ä¿®æ”¹-c-h-æ–‡ä»¶" class="headerlink" title="3 ä¿®æ”¹ .c.h æ–‡ä»¶"></a>3 ä¿®æ”¹ .c.h æ–‡ä»¶</h3><p>ç§»æ¤æ—¶è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š</p><p>1 æ”¹æ‰€ç”¨ä¸²å£</p><p>å‘é€éƒ¨åˆ†ï¼šåœ¨esp8266.cé‡Œï¼Œå°†huart3å…¨éƒ¨æ›¿æ¢ä¸ºè¦ä¿®æ”¹çš„ä¸²å£å·ï¼Œæ¯”å¦‚ä¸²å£2ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/87b34edd334476992b18233290799fe3.png"></p><p>æ¥æ”¶éƒ¨åˆ†ï¼šç”¨ä¸²å£ä¸­æ–­æ¥æ”¶esp8266å‘æ¥çš„æ¶ˆæ¯ã€‚éšä¾¿åœ¨å“ªä¸ªæ–‡ä»¶å¤¹å¡«åŠ ä¸²å£å›è°ƒå‡½æ•°ï¼Œæˆ‘ä¸ªäººæ˜¯ä¹‹å‰ä¸“é—¨å»ºäº†ä¸ªuart.cæ–‡ä»¶æ”¾ä¸²å£ç›¸å…³çš„æ‰€æœ‰ä»£ç ã€‚</p><p>åŠ å…¥ä¸‹é¢çš„ä»£ç ï¼ˆä¸²å£å·æ ¹æ®ä¸ªäººæƒ…å†µä¿®æ”¹ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_UART_RxCpltCallback</span><span class="params">(UART_HandleTypeDef *huart)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(huart == &amp;huart3)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(esp8266_cnt &gt;= <span class="keyword">sizeof</span>(esp8266_buf))</span><br><span class="line">&#123;</span><br><span class="line">esp8266_cnt = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">esp8266_buf[esp8266_cnt++] = Uart3_RxData;</span><br><span class="line"></span><br><span class="line">HAL_UART_Receive_IT(&amp;huart3,(<span class="type">uint8_t</span> *)&amp;Uart3_RxData, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2 æ”¹wifiåå­—å’Œå¯†ç </p><p><img src="https://img-blog.csdnimg.cn/img_convert/601b58b84f41ec638f86d9e63eeb4c41.png"></p><p>3 æ”¹äº§å“IDã€è®¾å¤‡IDã€é‰´æƒä¿¡æ¯ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/03f4e721469e45d2729425eca9a8d38a.png"></p><h3 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4 æµ‹è¯•"></a>4 æµ‹è¯•</h3><p><strong>æ·»åŠ å¤´æ–‡ä»¶</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;onenet.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp8266.h&quot;</span></span></span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ åˆå§‹åŒ–</strong></p><p>åˆ«å¿˜äº†å¼€ä¸²å£ä¸­æ–­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HAL_UART_Receive_IT(&amp;huart3,(<span class="type">uint8_t</span> *)&amp;Uart3_RxData, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">HAL_Delay(<span class="number">2000</span>);</span><br><span class="line">ESP8266_Init();</span><br><span class="line">HAL_Delay(<span class="number">2000</span>);</span><br><span class="line"><span class="keyword">while</span>(OneNet_DevLink())</span><br><span class="line">HAL_Delay(<span class="number">2000</span>);</span><br></pre></td></tr></table></figure><p>è¿æ¥æˆåŠŸçš„è¯ï¼Œonenetä¼šæ˜¾ç¤ºè®¾å¤‡åœ¨çº¿ã€‚ä¸²å£ä¹Ÿä¼šæ‰“å°æˆåŠŸã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/e08522ae2a3d08bd5f99c7fdeda41379.png"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/4e1ab1158b6bfc9430b57a31e27cfab3.png"></p><p><strong>å‘é€æ•°æ®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OneNet_SendData();//&amp;#x53D1;&amp;#x9001;&amp;#x6570;&amp;#x636E;</span><br><span class="line">ESP8266_Clear();//&amp;#x6E05;&amp;#x7A7A;&amp;#x6570;&amp;#x636E;&amp;#x7F13;&amp;#x5B58;&amp;#x533A;</span><br><span class="line">HAL_Delay(3000);//3s&amp;#x53D1;&amp;#x9001;&amp;#x4E00;&amp;#x6B21;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/05e4629537d4b953e7e7f4bc651a0267.png"></p><p>è¦å‘ä»€ä¹ˆæ•°æ®ï¼Œåœ¨è¿™é‡Œæ”¹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/img_convert/2e0513318f4aa1042b26a9f18b546071.png"></p><p><strong>æ¥æ”¶æ•°æ®</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataPtr = ESP8266_GetIPD(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(dataPtr != <span class="literal">NULL</span>)</span><br><span class="line">OneNet_RevPro(dataPtr);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºSTM32F103C8T6ï¼ˆHALåº“ï¼‰çš„HC-SR501çº¢å¤–äººä½“ä¼ æ„ŸåŠHC-SR04è¶…å£°æ³¢æµ‹è·</title>
      <link href="/2024/03/stm32-%E5%9F%BA%E4%BA%8ESTM32F103C8T6%EF%BC%88HAL%E5%BA%93%EF%BC%89%E7%9A%84HC-SR501%E7%BA%A2%E5%A4%96%E4%BA%BA%E4%BD%93%E4%BC%A0%E6%84%9F%E5%8F%8AHC-SR04%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D/"/>
      <url>/2024/03/stm32-%E5%9F%BA%E4%BA%8ESTM32F103C8T6%EF%BC%88HAL%E5%BA%93%EF%BC%89%E7%9A%84HC-SR501%E7%BA%A2%E5%A4%96%E4%BA%BA%E4%BD%93%E4%BC%A0%E6%84%9F%E5%8F%8AHC-SR04%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="ç³»åˆ—æ–‡ç« ç›®å½•"><a href="#ç³»åˆ—æ–‡ç« ç›®å½•" class="headerlink" title="ç³»åˆ—æ–‡ç« ç›®å½•"></a>ç³»åˆ—æ–‡ç« ç›®å½•</h2><p><a href="https://blog.csdn.net/h568630659/article/details/121404155">ä¸€ã€åŸºäºSTM32F103C8T6æœ€å°ç³»ç»Ÿæ¿å’ŒSTM32CubeMXå®ç°LEDç¯å¾ªç¯é—ªçƒ</a><br><a href="https://blog.csdn.net/h568630659/article/details/121427218">äºŒã€åŸºäºSTM32F103C8T6å’ŒSTM32CubeMXå®ç°UARTä¸²å£é€šä¿¡æ•°æ®æ”¶å‘</a><br><a href="https://blog.csdn.net/h568630659/article/details/121465665">ä¸‰ã€å®æˆ˜å°ä¾‹ç¨‹ åŸºäºSTM32F103C8T6æœ€å°ç³»ç»Ÿæ¿å’ŒSTM32CubeMXé©±åŠ¨WS2812Bå…‰ç«‹æ–¹</a><br><a href="https://blog.csdn.net/h568630659/article/details/121764481">å››ã€åŸºäºSTM32F103C8T6æœ€å°ç³»ç»Ÿæ¿HALåº“CubeMXé©±åŠ¨HC-SR501çº¢å¤–äººä½“ä¼ æ„Ÿæ¨¡å—</a><br><a href="https://blog.csdn.net/h568630659/article/details/122058600">äº”ã€åŸºäºSTM32F103C8T6ï¼ˆHALåº“ï¼‰çš„HC-SR501çº¢å¤–äººä½“ä¼ æ„ŸåŠHC-SR04è¶…å£°æ³¢æµ‹è·</a></p><h4 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h4><ul><li><a href="#-0">ç³»åˆ—æ–‡ç« ç›®å½•</a></li><li><a href="#-16">å‰è¨€</a></li><li><a href="#-22">ä¸€ã€æ¨¡å—ç®€ä»‹</a></li><li><a href="#cubemx-45">äºŒã€é…ç½®CubeMX</a></li><li><a href="#-67">ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†</a></li><li><a href="#-94">å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†</a></li><li><ul><li><a href="#hc-sr04c-97">HC_SR04.c</a></li><li><a href="#hc-sr04h-181">HC_SR04.h</a></li><li><a href="#mainc-193">main.c</a></li></ul></li></ul><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­é©±åŠ¨äº†HC-SR501çº¢å¤–äººä½“ä¼ æ„Ÿæ¨¡å—ï¼Œä½†åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼Œè¿™ä¸ªæ¨¡å—çš„çƒ­é‡Šç”µæ¢å¤´è¿‡äºçµæ•äº†ï¼Œç”šè‡³æœ‰çš„æ—¶å€™å¾€ä¸Šå“ˆæ°”ï¼Œä¼šå› ä¸ºæ£€æµ‹åˆ°ç±»ä¼¼äºäººä½“çš„æ¸©åº¦è€Œè¯¯åˆ¤ä¸ºæ„Ÿåº”åˆ°äººä½“ï¼Œæ‰€ä»¥ä¸ºäº†å‡å°‘è¯¯åˆ¤æ¦‚ç‡ï¼Œæˆ‘æ‰“ç®—å†æ·»åŠ ä¸€ä¸ªæµ‹è·æ¨¡å—ï¼Œåœ¨çº¢å¤–æ„Ÿåº”åˆ°äººä½“æ—¶ï¼Œå†æ¬¡åˆ¤æ–­äººä½“ä¸ä¼ æ„Ÿå™¨çš„è·ç¦»ï¼Œåœ¨æ»¡è¶³é¢„è®¾çš„è·ç¦»èŒƒå›´æ—¶ï¼Œæ‰ç¡®å®šæœ‰äººä½“æ¥è¿‘ï¼Œè¿›è¡Œåç»­æ“ä½œã€‚</p><h2 id="ä¸€ã€æ¨¡å—ç®€ä»‹"><a href="#ä¸€ã€æ¨¡å—ç®€ä»‹" class="headerlink" title="ä¸€ã€æ¨¡å—ç®€ä»‹"></a>ä¸€ã€æ¨¡å—ç®€ä»‹</h2><p><strong>HC-SR501çº¢å¤–äººä½“æ„Ÿåº”æ¨¡å—èµ„æ–™ä»‹ç»ï¼š</strong><br><a href="https://www.arduino.cn/thread-2851-1-1.html">æ¢ç©¶äººä½“çº¢å¤–ä¼ æ„Ÿå™¨HC-SR501</a></p><p><strong>HC-SR04è¶…å£°æ³¢æµ‹è·æ¨¡å—èµ„æ–™ä»‹ç»ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/92ad9fec95424c4daee75611f36e9b7b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>å¼•è„šåç§°å¼•è„šä½œç”¨VCC<br><strong>3-5.5V</strong></p><p>ä¾›ç”µï¼ˆå®æµ‹å‘ç°å¯ä»¥3.3Vä¾›ç”µï¼Œä½†æ²¡æœ‰5Vä¾›ç”µæµ‹å¾—å‡†ï¼‰GNDæ¥åœ°Trigå¤–éƒ¨è§¦å‘ä¿¡å·è¾“å…¥ï¼Œè¾“å…¥ä¸€ä¸ªé«˜äº10Î¼sçš„é«˜ç”µå¹³å³å¯è§¦å‘æ¨¡å—æµ‹è·Echoå›å“ä¿¡å·è¾“å‡ºï¼Œæµ‹è·ç»“æŸæ—¶æ­¤ç®¡è„šè¾“å‡ºä¸€ä¸ªé«˜ç”µå¹³ï¼Œç”µå¹³å®½åº¦åæ˜ è¶…å£°æ³¢å¾€è¿”æ—¶é—´ä¹‹å’Œ</p><p><strong>å·¥ä½œåŸç†ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/2440fa92274644939b0de5e59ef1852b.png"><br><img src="https://img-blog.csdnimg.cn/0fa754c51ca94c2188fbdfa59f3604ea.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><strong>ç®€è€Œè¨€ä¹‹ï¼š<br> ç»™Trigä¸€ä¸ª10Î¼Sä»¥ä¸Šçš„é«˜ç”µå¹³,æ¨¡å—å¼€å§‹å·¥ä½œï¼Œæ¨¡å—å†…è‡ªåŠ¨å‘é€å…«ä¸ª40khzæ–¹æ³¢ï¼Œå¹¶è‡ªä¸»æ£€æµ‹æ˜¯å¦æœ‰ç”µæ³¢è¿”å›ã€‚æ­¤æ—¶éœ€è¦æ£€æµ‹Echoå¤„çš„ç”µå¹³ï¼Œå½“ä¸ºé«˜ç”µå¹³çš„æ—¶å€™è®°ä¸€ä¸ªæ—¶é—´ï¼›å½“Echoå‡ºä¸ºä½ç”µå¹³çš„æ—¶å€™å†è®°ä¸€ä¸ªæ—¶é—´ï¼Œè¿™ä¸¤ä¸ªæ—¶é—´çš„å·®å°±æ˜¯é«˜ç”µå¹³æŒç»­çš„æ—¶é—´ï¼Œæœ€åç”¨æµ‹è·å…¬å¼è¿›è¡Œè®¡ç®—</strong>ã€‚</p><h2 id="äºŒã€é…ç½®CubeMX"><a href="#äºŒã€é…ç½®CubeMX" class="headerlink" title="; äºŒã€é…ç½®CubeMX"></a><a name="cubemx_45">;</a> äºŒã€é…ç½®CubeMX</h2><p><strong>1ã€æ–°å»ºå·¥ç¨‹;<br>2ã€é…ç½®æ—¶é’Ÿæºï¼Œåœ¨RCCé‡Œé¢çš„HSEé…ç½®çš„æ˜¯æ™¶æŒ¯æ—¶é’Ÿ;<br>3ã€é…ç½®ç¨‹åºçƒ§å½•å¼•è„šSYSä¸ºSWDæ¨¡å¼;<br>4ã€é…ç½®GPIOè¾“å‡ºå£ï¼Œé…ç½®ä¸€ä¸ªLEDç¯ï¼ˆæˆ‘çš„æ¿å­æ˜¯PC13ï¼‰ï¼Œèµ·åˆ°æ£€æµ‹åˆ°äººä½“æ—¶çš„æŒ‡ç¤ºä½œç”¨;<br>5ã€é…ç½®GPIOè¾“å…¥å£ï¼Œç”¨æ¥è¯»å–HC-SR501æ¨¡å—çš„è¾“å‡ºç”µå¹³ï¼Œæˆ‘é€‰çš„æ˜¯PA1å£;</strong><br><strong>6ã€é…ç½®GPIOè¾“å…¥å£ï¼Œç”¨æ¥æ£€æµ‹HC-SR04è¶…å£°æ³¢æµ‹è·æ¨¡å—çš„å›å“ä¿¡å·è¾“å‡ºï¼Œæˆ‘é€‰æ‹©PB5å£ï¼Œå‘½åä¸ºHC_SR04_Echo_Pin;<br>7ã€é…ç½®GPIOè¾“å‡ºå£ï¼Œç”¨æ¥è§¦å‘HC-SR04è¶…å£°æ³¢æµ‹è·æ¨¡å—ï¼Œæˆ‘é€‰æ‹©PB4å£ï¼Œå‘½åä¸ºHC_SR04_Trig_Pin;<br>8ã€ä½¿èƒ½å®šæ—¶å™¨ï¼Œç”¨æ¥å®ç°å¾®ç§’å»¶æ—¶ï¼Œå’Œæµ‹é‡HC-SR04æ¨¡å—é«˜ç”µå¹³æ—¶é—´ï¼Œæˆ‘é€‰æ‹©TIM2ï¼Œå¹¶ä½¿èƒ½TIM2ä¸­æ–­;</strong><br><img src="https://img-blog.csdnimg.cn/f5c269ef459b4f58a202b49397c11036.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_17,color_FFFFFF,t_70,g_se,x_16"><br>TIM2æŒ‚è½½åœ¨APB1ï¼Œæ—¶é’Ÿæ¥æºé¢‘ç‡ä¸º36MHzï¼Œæ•…å–é¢„åˆ†é¢‘ç³»æ•° <code>PSC=36-1</code>ï¼Œè®¡æ•°å‘¨æœŸ <code>Counter</code>è®¾ä¸º <code>60000-1</code>ã€‚å³æ­¤æ—¶å®šæ—¶å™¨é¢‘ç‡ä¸º36M&#x2F;36&#x3D;1MHzï¼Œæ¯60msè¿›ä¸€æ¬¡ä¸­æ–­ï¼Œ60000Î¼så¯¹åº”å®é™…æµ‹è·èŒƒå›´å¤§æ¦‚ä¸º10mï¼Œè¿œè¿œè¶…è¿‡æˆ‘çš„éœ€æ±‚ã€‚</p><p><img src="https://img-blog.csdnimg.cn/96058ff9807d44dea3a1b773f47f9330.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"><br><img src="https://img-blog.csdnimg.cn/14c2aefe04d5410b89a5300226b73aa6.png"></p><p><strong>9ã€é…ç½®ä¸²å£æ”¶å‘å¼•è„š;<br>10ã€é…ç½®æ—¶é’Ÿæ ‘ï¼Œæˆ‘è¿˜æ˜¯å¼€åˆ°æœ€é«˜çš„72MHz;<br>11ã€è¿›è¡Œé¡¹ç›®è®¾ç½®ï¼Œæœ€åç”Ÿæˆä»£ç ï¼ŒCubeMXéƒ¨åˆ†å°±å¤§åŠŸå‘Šæˆäº†</strong></p><p><img src="https://img-blog.csdnimg.cn/1b053bd5569c41b7b11caeba75037c7d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†"><a href="#ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†" class="headerlink" title="ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†"></a>ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†</h2><p>CH340 â†” STM32F103C8T6æœ€å°ç³»ç»Ÿæ¿ï¼š<br>TX â†” RX<br>RX â†” TX</p><p>DAP-LINK â†” STM32F103C8T6æœ€å°ç³»ç»Ÿæ¿<br>3.3V â†” VCC<br>GND â†” GND<br>SWIO â†” SWIO<br>SWCLK â†” SWCLK</p><p>HC-SR501æ¨¡å— â†” STM32F103C8T6æœ€å°ç³»ç»Ÿæ¿<br>OUT â†” PA1<br>GND â†” GND</p><p>HC-SR501æ¨¡å— â†” DAP-LINK <strong>ï¼ˆè¿™é‡Œæ³¨æ„æ¨¡å—ä¾›ç”µèŒƒå›´ä¸º4.5V-20Vï¼Œç”¨3.3Væ— æ³•é©±åŠ¨ï¼‰</strong><br>VCC â†” 5V</p><p>HC-SR04æ¨¡å— â†” CH340<br>VCC â†” 5V</p><p>HC-SR04æ¨¡å— â†” STM32F103C8T6æœ€å°ç³»ç»Ÿæ¿<br>Trig â†” PB4<br>Echo â†” PB5<br>GND â†” GND</p><h2 id="å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†"><a href="#å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†" class="headerlink" title="å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†"></a>å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†</h2><p>ä»£ç æ¡†æ¶æ˜¯åŸºäºä¸Šä¸€ç¯‡HC-SR501çº¢å¤–äººä½“æ„Ÿåº”æ¨¡å—ä¿®æ”¹è€Œæˆçš„ï¼Œæƒ³è¦å®Œæ•´ä»£ç çš„è¯å¯ä»¥å’Œä¸Šç¯‡æ–‡ç« ä¸€èµ·çœ‹ã€‚</p><h3 id="HC-SR04-c"><a href="#HC-SR04-c" class="headerlink" title="HC_SR04.c"></a>HC_SR04.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;HC_SR04.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f1xx_hal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f1xx_it.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">float</span> distance_result;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_us</span><span class="params">(<span class="type">uint16_t</span> time)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint16_t</span> a1=TIM2-&gt;CNT;</span><br><span class="line"><span class="keyword">while</span>(TIM2-&gt;CNT-a1&lt;time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HC_SR04_startrange</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_WritePin(HC_SR04_Trig_GPIO_Port,HC_SR04_Trig_Pin,GPIO_PIN_SET);</span><br><span class="line"></span><br><span class="line">Delay_us(<span class="number">10</span>);</span><br><span class="line">HAL_GPIO_WritePin(HC_SR04_Trig_GPIO_Port,HC_SR04_Trig_Pin,GPIO_PIN_RESET);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">HC_SR04_gettime</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint32_t</span> a;</span><br><span class="line">a=TIM2-&gt;CNT;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">HC_SR04_getdistance</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint16_t</span> time_node1;</span><br><span class="line"> <span class="type">uint16_t</span> time_node2;</span><br><span class="line">  <span class="type">uint16_t</span> measure;</span><br><span class="line"></span><br><span class="line">  HC_SR04_startrange();</span><br><span class="line"></span><br><span class="line">TIM2-&gt;CNT = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(HAL_GPIO_ReadPin(HC_SR04_Echo_GPIO_Port,HC_SR04_Echo_Pin)==RESET);</span><br><span class="line">time_node1=HC_SR04_gettime();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(HAL_GPIO_ReadPin(HC_SR04_Echo_GPIO_Port,HC_SR04_Echo_Pin)==SET);</span><br><span class="line">time_node2=HC_SR04_gettime();</span><br><span class="line"></span><br><span class="line">measure=time_node2-time_node1;</span><br><span class="line"></span><br><span class="line">distance_result = measure * <span class="number">17.0</span>/<span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> distance_result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HC-SR04-h"><a href="#HC-SR04-h" class="headerlink" title="HC_SR04.h"></a>HC_SR04.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _HC_SR04_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _HC_SR04_H_</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_us</span><span class="params">(<span class="type">uint16_t</span> time)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">HC_SR04_startrange</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">float</span> <span class="title function_">HC_SR04_getdistance</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">HC_SR04_gettime</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_TIM_Base_Start_IT(&amp;htim2);</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_1) == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">HC_SR04_distance=HC_SR04_getdistance();</span><br><span class="line">HAL_GPIO_WritePin(GPIOC,GPIO_PIN_13,GPIO_PIN_RESET);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;æœ‰äºº,ç›®å‰è·ç¦»ä¸ºï¼š%.2f cm\r\n&quot;</span>,HC_SR04_distance);</span><br><span class="line">HAL_Delay(<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_WritePin(GPIOC,GPIO_PIN_13,GPIO_PIN_SET);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;æ²¡äºº\r\n&quot;</span>);</span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç°è±¡ï¼š</strong></p><p>æ„Ÿåº”åˆ°äººä½“ï¼Œæ¿è½½LEDç»¿ç¯äº®ï¼ŒåŒæ—¶ä¸²å£æ‰“å°æµ‹è·ç»“æœã€‚<br><img src="https://img-blog.csdnimg.cn/fdf542a1e5f54fb497c66664fcf7880e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><strong>æ³¨æ„ï¼š</strong><br><strong>é‡å®šä¹‰printfåï¼Œå¿…é¡»åœ¨targeté‡Œé¢å‹¾é€‰ä¸ŠMicroLIBï¼Œè°ƒç”¨ä¸€ä¸‹è¿™ä¸ªå¾®å‹åº“ï¼Œä¸ç„¶ä¸€ç›´å¡åœ¨é‡Œé¢ã€‚</strong></p><p><img src="https://img-blog.csdnimg.cn/bba9468e9009467abfafc8111b94ac0d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>å‚è€ƒåšå®¢ï¼š<br><a href="https://blog.csdn.net/sasasatori/article/details/81199455">stm32f1é©±åŠ¨HC-SR04è¶…å£°æ³¢æµ‹è·æ¨¡å—</a></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºSTM32çš„HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—é©±åŠ¨ä¸åº”ç”¨</title>
      <link href="/2024/03/stm32-%E5%9F%BA%E4%BA%8ESTM32%E7%9A%84HC-SR501%E7%BA%A2%E5%A4%96%E6%84%9F%E5%BA%94%E6%A8%A1%E5%9D%97%E9%A9%B1%E5%8A%A8%E4%B8%8E%E5%BA%94%E7%94%A8/"/>
      <url>/2024/03/stm32-%E5%9F%BA%E4%BA%8ESTM32%E7%9A%84HC-SR501%E7%BA%A2%E5%A4%96%E6%84%9F%E5%BA%94%E6%A8%A1%E5%9D%97%E9%A9%B1%E5%8A%A8%E4%B8%8E%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><strong>ä¸€ã€ ç®€ä»‹<br>HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—æ˜¯ä¸€ç§å¸¸ç”¨çš„äººä½“çº¢å¤–æ„Ÿåº”æ¨¡å—ï¼Œå¸¸ç”¨äºå®‰é˜²ç›‘æ§ã€æ™ºèƒ½å®¶å±…ç­‰é¢†åŸŸã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨STM32å•ç‰‡æœºä¸Šé©±åŠ¨å’Œåº”ç”¨HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—ï¼Œå®ç°åŸºæœ¬çš„äººä½“æ£€æµ‹åŠŸèƒ½ã€‚</strong></p><p><strong>äºŒã€ æ¨¡å—åŸç†</strong><br>HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—åŸºäºçº¢å¤–çƒ­é‡Šç”µä¼ æ„Ÿå™¨ï¼ˆPIR sensorï¼‰åŸç†ï¼Œå½“æ£€æµ‹åˆ°äººä½“æˆ–å…¶ä»–çƒ­æºæ—¶ï¼Œè¾“å‡ºé«˜ç”µå¹³ä¿¡å·ã€‚è¯¥æ¨¡å—æœ‰å»¶è¿Ÿæ—¶é—´å’Œé‡å¤è§¦å‘æ—¶é—´ä¸¤ä¸ªå¯è°ƒèŠ‚çš„èºæ—‹è°ƒèŠ‚å™¨ï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒèŠ‚æ¨¡å—çš„çµæ•åº¦å’Œè§¦å‘åçš„è¾“å‡ºä¿¡å·æ—¶é•¿ã€‚</p><p><strong>ä¸‰ã€ è¿æ¥ä¸é©±åŠ¨<br>1. è¿æ¥</strong><br>è¿æ¥HC-SR501æ¨¡å—è‡³STM32å•ç‰‡æœºï¼Œå°†æ¨¡å—çš„OUTå¼•è„šè¿æ¥è‡³STM32çš„GPIOå¼•è„šï¼Œä»¥æ¥æ”¶æ„Ÿåº”æ¨¡å—çš„è¾“å‡ºä¿¡å·ã€‚åŒæ—¶ï¼Œé€šè¿‡ç”µæºæ¨¡å—è¿æ¥æ¨¡å—è‡³å•ç‰‡æœºçš„ä¾›ç”µå¼•è„šã€‚</p><p><img src="https://img-blog.csdnimg.cn/direct/12a9a768aaa04891b1c9bfc0d758aae5.png"></p><p><strong>2. é©±åŠ¨</strong><br>åœ¨STM32çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œç¼–å†™å¯¹HC-SR501æ¨¡å—çš„é©±åŠ¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">```c</span><br><span class="line">#include &quot;stm32f4xx.h&quot;</span><br><span class="line"></span><br><span class="line">#define HC_SR501_PIN GPIO_PIN_0</span><br><span class="line">#define HC_SR501_PORT GPIOA</span><br><span class="line"></span><br><span class="line">void HC_SR501_Init(void) &#123;</span><br><span class="line">&amp;#xA0; GPIO_InitTypeDef GPIO_InitStruct;</span><br><span class="line"></span><br><span class="line">&amp;#xA0; __HAL_RCC_GPIOA_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">&amp;#xA0; GPIO_InitStruct.Pin = HC_SR501_PIN;</span><br><span class="line">&amp;#xA0; GPIO_InitStruct.Mode = GPIO_MODE_INPUT;</span><br><span class="line">&amp;#xA0; GPIO_InitStruct.Pull = GPIO_NOPULL;</span><br><span class="line">&amp;#xA0; HAL_GPIO_Init(HC_SR501_PORT, &amp;GPIO_InitStruct);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int HC_SR501_Read(void) &#123;</span><br><span class="line">&amp;#xA0; return HAL_GPIO_ReadPin(HC_SR501_PORT, HC_SR501_PIN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void HC_SR501_Application(void) &#123;</span><br><span class="line">&amp;#xA0; while (1) &#123;</span><br><span class="line">&amp;#xA0; &amp;#xA0; if (HC_SR501_Read()) &#123;</span><br><span class="line">&amp;#xA0; &amp;#xA0; &amp;#xA0; // &amp;#x68C0;&amp;#x6D4B;&amp;#x5230;&amp;#x4EBA;&amp;#x4F53;&amp;#xFF0C;&amp;#x6267;&amp;#x884C;&amp;#x76F8;&amp;#x5E94;&amp;#x64CD;&amp;#x4F5C;</span><br><span class="line">&amp;#xA0; &amp;#xA0; &#125; else &#123;</span><br><span class="line">&amp;#xA0; &amp;#xA0; &amp;#xA0; // &amp;#x672A;&amp;#x68C0;&amp;#x6D4B;&amp;#x5230;&amp;#x4EBA;&amp;#x4F53;&amp;#xFF0C;&amp;#x6267;&amp;#x884C;&amp;#x76F8;&amp;#x5E94;&amp;#x64CD;&amp;#x4F5C;</span><br><span class="line">&amp;#xA0; &amp;#xA0; &#125;</span><br><span class="line">&amp;#xA0; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void) &#123;</span><br><span class="line">&amp;#xA0; HC_SR501_Init();</span><br><span class="line">&amp;#xA0; HC_SR501_Application();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>ä»¥ä¸Šä»£ç ä¸­ï¼Œé¦–å…ˆåˆå§‹åŒ–äº†GPIOå¼•è„šï¼Œç„¶ååœ¨åº”ç”¨å‡½æ•°ä¸­ä¸æ–­è¯»å–æ„Ÿåº”æ¨¡å—çš„è¾“å‡ºä¿¡å·ï¼Œæ ¹æ®è¾“å‡ºä¿¡å·æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚**å››ã€ åº”ç”¨ç¤ºä¾‹&lt;br&gt;1. åŸºäºHC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—çš„äººä½“æ£€æµ‹æŠ¥è­¦ç³»ç»Ÿ**é€šè¿‡è¿æ¥HC-SR501æ¨¡å—è‡³STM32å•ç‰‡æœºï¼Œå¹¶é…åˆèœ‚é¸£å™¨æˆ–å…¶ä»–æŠ¥è­¦è£…ç½®ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„äººä½“æ£€æµ‹æŠ¥è­¦ç³»ç»Ÿã€‚å½“æ£€æµ‹åˆ°äººä½“æ—¶ï¼Œç³»ç»Ÿè§¦å‘æŠ¥è­¦è£…ç½®ï¼Œå®ç°å®‰é˜²ç›‘æ§ã€‚**2. åŸºäºHC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—çš„æ™ºèƒ½ç…§æ˜æ§åˆ¶ç³»ç»Ÿ**å°†HC-SR501æ¨¡å—è¿æ¥è‡³STM32å•ç‰‡æœºï¼Œå†è¿æ¥è‡³LEDç¯æˆ–å…¶ä»–ç…§æ˜è®¾å¤‡ï¼Œå¯ä»¥å®ç°æ™ºèƒ½ç…§æ˜æ§åˆ¶ç³»ç»Ÿã€‚å½“æ£€æµ‹åˆ°äººä½“æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å¼€å¯ç…§æ˜è®¾å¤‡ï¼Œå½“æœªæ£€æµ‹åˆ°äººä½“æ—¶åˆ™å…³é—­ç…§æ˜è®¾å¤‡ï¼Œå®ç°æ™ºèƒ½èŠ‚èƒ½æ§åˆ¶ã€‚**ä»¥ä¸Šæ˜¯åŸºäºSTM32çš„HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—çš„é©±åŠ¨ä¸åº”ç”¨çš„åŸºæœ¬ä»‹ç»ï¼Œé€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯ä»¥å®ç°é’ˆå¯¹ä¸åŒåœºæ™¯çš„äººä½“æ„Ÿåº”æ§åˆ¶ç³»ç»Ÿã€‚**&gt; âœ…ä½œè€…ç®€ä»‹ï¼šçƒ­çˆ±ç§‘ç ”çš„åµŒå…¥å¼å¼€å‘è€…ï¼Œä¿®å¿ƒå’ŒæŠ€æœ¯åŒæ­¥ç²¾è¿›ä»£ç è·å–ã€é—®é¢˜æ¢è®¨åŠæ–‡ç« è½¬è½½å¯ç§ä¿¡ã€‚â˜ æ„¿ä½ çš„ç”Ÿå‘½ä¸­æœ‰å¤Ÿå¤šçš„äº‘ç¿³,æ¥é€ å°±ä¸€ä¸ªç¾ä¸½çš„é»„æ˜ã€‚ğŸè·å–æ›´å¤šåµŒå…¥å¼èµ„æ–™å¯ç‚¹å‡»é“¾æ¥è¿›ç¾¤é¢†å–ï¼Œè°¢è°¢æ”¯æŒï¼ğŸ‘‡[ç‚¹å‡»é¢†å–æ›´å¤šè¯¦ç»†èµ„æ–™](https://fss.mpay8.cn/article/dmrjinh2C6fjejm &quot;ç‚¹å‡»é¢†å–æ›´å¤šè¯¦ç»†èµ„æ–™&quot;)</code></pre>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹æŠŠæ‰‹æ•™ä½ ï¼Œé€šè¿‡HALåº“å®ç°STM32çš„è¶…å£°æ³¢æµ‹è·--ä»¥SR-04ä¸ºä¾‹</title>
      <link href="/2024/03/stm32-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%EF%BC%8C%E9%80%9A%E8%BF%87HAL%E5%BA%93%E5%AE%9E%E7%8E%B0STM32%E7%9A%84%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D-%E4%BB%A5SR-04%E4%B8%BA%E4%BE%8B/"/>
      <url>/2024/03/stm32-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%EF%BC%8C%E9%80%9A%E8%BF%87HAL%E5%BA%93%E5%AE%9E%E7%8E%B0STM32%E7%9A%84%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D-%E4%BB%A5SR-04%E4%B8%BA%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><strong>ç›®å½•</strong></p><p><a href="#0%E3%80%81sr-04%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86" title="0ã€SR-04åŸºæœ¬åŸç†">0ã€SR-04åŸºæœ¬åŸç†</a></p><p><a href="#1%E3%80%81%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" title="1ã€å‡†å¤‡å·¥ä½œ">1ã€å‡†å¤‡å·¥ä½œ</a></p><p><a href="#2%E3%80%81%E8%BF%9E%E7%BA%BF" title="2ã€è¿çº¿">2ã€è¿çº¿</a></p><p><a href="#%C2%A03%E3%80%81stm32cubemx%E8%AE%BE%E7%BD%AE" title="3ã€STM32CUBEMXè®¾ç½®">3ã€STM32CUBEMXè®¾ç½®</a></p><p><a href="#31%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B" title="3.1æ–°å»ºå·¥ç¨‹">3.1æ–°å»ºå·¥ç¨‹</a></p><p><a href="#32%E8%8A%AF%E7%89%87%E9%80%9A%E7%94%A8%E8%AE%BE%E7%BD%AE" title="3.2èŠ¯ç‰‡é€šç”¨è®¾ç½®">3.2èŠ¯ç‰‡é€šç”¨è®¾ç½®</a></p><p><a href="#33%E5%AE%9A%E6%97%B6%E5%99%A8%E6%8D%95%E8%8E%B7%E8%AE%BE%E7%BD%AE" title="3.3å®šæ—¶å™¨æ•è·è®¾ç½®">3.3å®šæ—¶å™¨æ•è·è®¾ç½®</a></p><p><a href="#%E2%80%8B34%E5%85%B6%E4%BB%96%E8%AE%BE%E7%BD%AE" title="â€‹3.4å…¶ä»–è®¾ç½®">â€‹3.4å…¶ä»–è®¾ç½®</a></p><p><a href="#35%E7%94%9F%E6%88%90%E5%B7%A5%E7%A8%8B" title="3.5ç”Ÿæˆå·¥ç¨‹">3.5ç”Ÿæˆå·¥ç¨‹</a></p><p><a href="#%C2%A04%E3%80%81%E7%A8%8B%E5%BA%8F%E5%AE%8C%E5%96%84" title="4ã€ç¨‹åºå®Œå–„">4ã€ç¨‹åºå®Œå–„</a></p><p><a href="#41%E5%AE%8C%E5%96%84%E6%89%93%E5%8D%B0%E8%BE%93%E5%87%BA%E5%87%BD%E6%95%B0" title="4.1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°">4.1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°</a></p><p><a href="#%C2%A042%E5%AE%8C%E5%96%84timc" title="4.2å®Œå–„tim.c">4.2å®Œå–„tim.c</a></p><p><a href="#43%E5%AE%8C%E5%96%84gpioc%C2%A0" title="4.3å®Œå–„gpio.c">4.3å®Œå–„gpio.c</a></p><p><a href="#44%E5%AE%8C%E5%96%84main%E5%87%BD%E6%95%B0%C2%A0" title="4.4å®Œå–„mainå‡½æ•°">4.4å®Œå–„mainå‡½æ•°</a></p><p><a href="#%C2%A05%E3%80%81%E6%80%BB%E7%BB%93" title="5ã€æ€»ç»“">5ã€æ€»ç»“</a></p><h2 id="0ã€SR-04åŸºæœ¬åŸç†"><a href="#0ã€SR-04åŸºæœ¬åŸç†" class="headerlink" title="0ã€SR-04åŸºæœ¬åŸç†"></a>0ã€SR-04åŸºæœ¬åŸç†</h2><p>å£°æ³¢é‡åˆ°éšœç¢ç‰©ä¼šåå°„ï¼Œè€Œå£°æ³¢çš„é€Ÿåº¦å·²çŸ¥ï¼Œæ‰€ä»¥åªéœ€è¦çŸ¥é“å‘å°„åˆ°æ¥æ”¶çš„æ—¶é—´å·®ï¼Œå°±èƒ½è½»æ¾è®¡ç®—å‡ºæµ‹é‡è·ç¦»ï¼Œå†ç»“åˆå‘å°„å™¨å’Œæ¥æ”¶å™¨çš„è·ç¦»ï¼Œå°±èƒ½ç®—å‡ºéšœç¢ç‰©çš„å®é™…è·ç¦»ã€‚</p><p><img src="https://img-blog.csdnimg.cn/2020032802343260.png"></p><p><img src="https://img-blog.csdnimg.cn/20200328023701292.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyMjU4OTgx,size_16,color_FFFFFF,t_70"></p><p>ä»¥HC-SR04ç¡¬ä»¶ä¸ºä¾‹ï¼Œç«¯å£ä¸ºVCCã€Trigã€Echoã€GNDã€‚</p><p>VCCâ€“æ¥STM32æ¿å­+5Vï¼›<br>GNDâ€“æ¥STM32æ¿å­GNDï¼›<br>Trigâ€“ä¸ºè§¦å‘æ§åˆ¶ä¿¡å·è¾“å…¥ï¼Œè§¦å‘æµ‹è·ï¼Œç»™è‡³å°‘10usçš„é«˜ç”µå¹³ä¿¡å·ï¼Œæ¨¡å—è‡ªåŠ¨å‘å°„8ä¸ª40KHzçš„æ–¹æ³¢ï¼Œè‡ªåŠ¨æ£€æµ‹æ˜¯å¦æœ‰ä¿¡å·è¿”å›ï¼›<br>Echoâ€“å›å“ä¿¡å·è¾“å‡ºï¼Œæœ‰ä¿¡å·è¿”å›ï¼Œé€šè¿‡IOå£ECHOè¾“å‡ºä¸€ä¸ªé«˜ç”µå¹³ï¼Œé«˜ç”µå¹³æŒç»­æ—¶é—´å°±æ˜¯è¶…å£°æ³¢ä»å‘å°„åˆ°è¿”å›çš„æ—¶é—´ã€‚<br>é‚£ç”¨STM32æ€ä¹ˆç»™ç«¯å£ä¿¡å·å‘¢ï¼Ÿåˆæ˜¯æ€ä¹ˆè·å–ä¿¡å·å‘¢ï¼Ÿ<br>Trigç«¯å£ä¸ºè¶…å£°æ³¢æ¨¡å—çš„è¾“å…¥ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡STM23ä¸€ä¸ªç«¯å£æ¨æŒ½è¾“å‡ºä¸€ä¸ªè‡³å°‘10usçš„é«˜ç”µå¹³ä¿¡å·å³å¯ï¼Œåˆ©ç”¨delay_ms(20)å®ç°ï¼›<br>Echoç«¯å£ä¸ºè¶…å£°æ³¢æ¨¡å—çš„è¾“å‡ºä¿¡å·ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨STM32ç«¯å£æ•è·é«˜ç”µå¹³æ—¶é—´ï¼Œé‚£ä¹ˆè¿™ä¸ªç«¯å£è‚¯å®šæ˜¯å¯ä»¥ç”¨åšå®šæ—¶å™¨çš„ç«¯å£ã€‚<br>é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œè¿™é‡Œé‡‡ç”¨ä»¥ä¸‹STM32ç«¯å£</p><p><img src="https://img-blog.csdnimg.cn/c10df4b58e2d49cb8b3b363c0e22019c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><img src="https://img-blog.csdnimg.cn/3b14aae863264dd4afbc8445ad66a7d9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="1ã€å‡†å¤‡å·¥ä½œ"><a href="#1ã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="1ã€å‡†å¤‡å·¥ä½œ"></a>1ã€å‡†å¤‡å·¥ä½œ</h2><p>å¼€å‘æ¿ï¼šSTM32F1ç²¾è‹±ç‰ˆ</p><p>è½¯ä»¶ï¼šSTM32CubeMxè½¯ä»¶</p><p>IDEï¼š MDK-Keilè½¯ä»¶</p><p>ä¼ æ„Ÿå™¨ï¼šHC-SR04</p><h2 id="2ã€è¿çº¿"><a href="#2ã€è¿çº¿" class="headerlink" title="2ã€è¿çº¿"></a>2ã€è¿çº¿</h2><p>é€‰æ‹©TIM5çš„CH1å³PA0ä½œä¸ºè¾“å…¥æ•è·å¼•è„šï¼ˆEchoï¼‰ï¼Œé€‰æ‹©PA5ä½œä¸ºè§¦å‘è„šTrigã€‚å…·ä½“è¿æ¥çº¿å¦‚ä¸‹ï¼š</p><p>çº¢çº¿è¿æ¥ç²¾è‹±ç‰ˆçš„5Vä¸SR04çš„VCCè„š</p><p>ç™½çº¿è¿æ¥ç²¾è‹±æ¿çš„GNDä¸SR04çš„GNDè„š</p><p>æ©™è‰²çº¿è¿æ¥ç²¾è‹±æ¿çš„PA5ä¸Trigè„š</p><p>é»‘è‰²çº¿è¿æ¥ç²¾è‹±æ¿çš„PA0ä¸Echoè„š</p><p><img src="https://img-blog.csdnimg.cn/2e1fa4f5325345729a0a44473dfd2526.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="3ã€STM32CUBEMXè®¾ç½®"><a href="#3ã€STM32CUBEMXè®¾ç½®" class="headerlink" title="3ã€STM32CUBEMXè®¾ç½®"></a>3ã€STM32CUBEMXè®¾ç½®</h2><h3 id="3-1æ–°å»ºå·¥ç¨‹"><a href="#3-1æ–°å»ºå·¥ç¨‹" class="headerlink" title="3.1æ–°å»ºå·¥ç¨‹"></a>3.1æ–°å»ºå·¥ç¨‹</h3><p>1ï¼‰æ–°å»ºå·¥ç¨‹</p><p><img src="https://img-blog.csdnimg.cn/7115721af4f7487fae5b0ff66f45667d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>2ï¼‰é€‰æ‹©èŠ¯ç‰‡</p><p><img src="https://img-blog.csdnimg.cn/9cecc36eced643b185e29591bbe60cf0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h3 id="3-2èŠ¯ç‰‡é€šç”¨è®¾ç½®"><a href="#3-2èŠ¯ç‰‡é€šç”¨è®¾ç½®" class="headerlink" title="3.2èŠ¯ç‰‡é€šç”¨è®¾ç½®"></a>3.2èŠ¯ç‰‡é€šç”¨è®¾ç½®</h3><p>1ï¼‰æ—¶é’ŸèŠ¯ç‰‡è®¾ç½®</p><p><img src="https://img-blog.csdnimg.cn/e262e3fba4f8447ab4c8c567225173a5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>2ï¼‰æ—¶é’Ÿè®¾ç½®</p><p><img src="https://img-blog.csdnimg.cn/abb1957bcbce4521af21421c25464c77.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>3ï¼‰ç³»ç»Ÿè°ƒè¯•è®¾ç½®</p><p><img src="https://img-blog.csdnimg.cn/ed518ef9e29c4359bd52a2ca81e8823e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h3 id="3-3å®šæ—¶å™¨æ•è·è®¾ç½®"><a href="#3-3å®šæ—¶å™¨æ•è·è®¾ç½®" class="headerlink" title="3.3å®šæ—¶å™¨æ•è·è®¾ç½®"></a>3.3å®šæ—¶å™¨æ•è·è®¾ç½®</h3><p>ç”±äºå‰æ–‡è¿çº¿ä¸­ï¼Œæˆ‘ä»¬å°†TIMER5CH1ä½œä¸ºè¾“å…¥æ•è·å¼•è„šï¼Œæ‰€ä»¥å¯¹TIMER5è¿›è¡Œè®¾ç½®ï¼š</p><p>Channel 1é€‰æ‹©ï¼šInput Capture direct mode</p><p>ä¸åˆ†é¢‘ç³»æ•°å¡«å†™ï¼š72-1ï¼ˆåˆ™æ¯æ¬¡è®¡æ•°ä¸º1usï¼‰</p><p>Polarity Selectioné€‰æ‹©ï¼šRising Edgeï¼ˆä¸Šå‡æ²¿ï¼‰</p><p>å…¶ä»–ä¿æŒä¸å˜ã€‚</p><p><img src="https://img-blog.csdnimg.cn/c4191f72c63049fdbfb8f8b96f672f66.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>NVIC settingsé€‰æ‹©TIM5 global interrupt</p><h3 id="3-4å…¶ä»–è®¾ç½®"><a href="#3-4å…¶ä»–è®¾ç½®" class="headerlink" title="  3.4å…¶ä»–è®¾ç½®"></a><img src="https://img-blog.csdnimg.cn/d1d24efee88d46178d8001eb1f8eaf61.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16">  3.4å…¶ä»–è®¾ç½®</h3><p>1ï¼‰USART1è®¾ç½®</p><p>ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œå°†æµ‹é‡æ‰€å¾—æ•°æ®é€šè¿‡ä¸²å£ä¼ é€’åˆ°ç”µè„‘ä¸Šè¿›è¡Œæ˜¾ç¤ºï¼Œæ­¤å¤„ä½¿ç”¨ä¸²å£1é€šè¿‡printfå°†è¾“å‡ºå‘é€è‡³ç”µè„‘ã€‚</p><p><img src="https://img-blog.csdnimg.cn/82ca9b0ff3e94cfa8286e7d5573fac1a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>2ï¼‰GPIOé…ç½®</p><p>æ­¤å¤„é€‰æ‹©PA5ä½œä¸ºTrigè„šï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/47ed779ee47641cfb88d1b94d4804ce0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h3 id="3-5ç”Ÿæˆå·¥ç¨‹"><a href="#3-5ç”Ÿæˆå·¥ç¨‹" class="headerlink" title="3.5ç”Ÿæˆå·¥ç¨‹"></a>3.5ç”Ÿæˆå·¥ç¨‹</h3><p><img src="https://img-blog.csdnimg.cn/a6e90e647fe24e5087daa4b099e7da40.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><img src="https://img-blog.csdnimg.cn/46dfa628b984462d95dc70b4a37152c0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="4ã€ç¨‹åºå®Œå–„"><a href="#4ã€ç¨‹åºå®Œå–„" class="headerlink" title="4ã€ç¨‹åºå®Œå–„"></a>4ã€ç¨‹åºå®Œå–„</h2><h3 id="4-1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°"><a href="#4-1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°" class="headerlink" title="4.1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°"></a>4.1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°</h3><p>åœ¨mainå‡½æ•°ä¸­åŠ å…¥ä¸‹é¢è¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/* Private includes ----------------------------------------------------------*/</span><br><span class="line">/* USER CODE BEGIN Includes */</span><br><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">#include &quot;string.h&quot;</span><br><span class="line">/* USER CODE END Includes */</span><br><span class="line"></span><br><span class="line">/* Private user code ---------------------------------------------------------*/</span><br><span class="line">/* USER CODE BEGIN 0 */</span><br><span class="line">#ifdef __GNUC__</span><br><span class="line">#define PUTCHAR_PROTOTYPE int __io_putchar(int ch)</span><br><span class="line">#else</span><br><span class="line">#define PUTCHAR_PROTOTYPE int fputc(int ch, FILE *f)</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">PUTCHAR_PROTOTYPE</span><br><span class="line">&#123;</span><br><span class="line">HAL_UART_Transmit(&amp;huart1, (uint8_t *)&amp;ch, 1, 0xFFFF);</span><br><span class="line">return ch;</span><br><span class="line">&#125;</span><br><span class="line">/* USER CODE END 0 */</span><br></pre></td></tr></table></figure><p>åŠ å…¥æ­¤è¯­å¥ä¹‹åå¯ä»¥åœ¨mainå‡½æ•°ä¸­åŠ å…¥printfè¯­å¥æµ‹è¯•æ˜¯å¦æˆåŠŸã€‚</p><p>å°†ç²¾è‹±æ¿USB232å£é€šè¿‡USBæ•°æ®çº¿ä¸ç”µè„‘è¿æ¥ï¼Œå¹¶åœ¨ç”µè„‘ä¸Šæ‰“å¼€ä¸²å£è°ƒè¯•è½¯ä»¶ï¼š <img src="https://img-blog.csdnimg.cn/a79a767a9dfa4baeb621c05235cbc92b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><img src="https://img-blog.csdnimg.cn/d27a80b3c0fa4d30999384ca8c8a46d7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h3 id="4-2å®Œå–„tim-c"><a href="#4-2å®Œå–„tim-c" class="headerlink" title="4.2å®Œå–„tim.c"></a>4.2å®Œå–„tim.c</h3><p>åœ¨tim.cä¸­åŠ å…¥ä»¥ä¸‹ç¨‹åºï¼š</p><p>å®šä¹‰å˜é‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/* USER CODE BEGIN 0 */</span><br><span class="line">//&amp;#x6355;&amp;#x83B7;&amp;#x72B6;&amp;#x6001;</span><br><span class="line">//[7]:0,&amp;#x6CA1;&amp;#x6709;&amp;#x6210;&amp;#x529F;&amp;#x7684;&amp;#x6355;&amp;#x83B7;;1,&amp;#x6210;&amp;#x529F;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x6B21;.</span><br><span class="line"></span><br><span class="line">//[6]:0,&amp;#x8FD8;&amp;#x6CA1;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4F4E;&amp;#x7535;&amp;#x5E73;;1,&amp;#x5DF2;&amp;#x7ECF;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4F4E;&amp;#x7535;&amp;#x5E73;&amp;#x4E86;.</span><br><span class="line"></span><br><span class="line">//[5:0]:&amp;#x6355;&amp;#x83B7;&amp;#x4F4E;&amp;#x7535;&amp;#x5E73;&amp;#x540E;&amp;#x6EA2;&amp;#x51FA;&amp;#x7684;&amp;#x6B21;&amp;#x6570;</span><br><span class="line">uint8_t  TIM5CH2_CAPTURE_STA=0;//&amp;#x8F93;&amp;#x5165;&amp;#x6355;&amp;#x83B7;&amp;#x72B6;&amp;#x6001;</span><br><span class="line">uint16_t TIM5CH2_CAPTURE_VAL;//&amp;#x8F93;&amp;#x5165;&amp;#x6355;&amp;#x83B7;&amp;#x503C;(TIM2&amp;#x662F;16&amp;#x4F4D;)</span><br><span class="line">/* USER CODE END 0 */</span><br></pre></td></tr></table></figure><p>åœ¨åº•éƒ¨åŠ å…¥æº¢å‡ºå›è°ƒå‡½æ•°å’Œè¾“å…¥æ•è·å›è°ƒå‡½æ•°ã€‚å…¶ä¸­å‚è€ƒäº†æ­£ç‚¹åŸå­å®˜æ–¹çš„çš„è¾“å…¥ æ•è·å›è°ƒå‡½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">/* USER CODE BEGIN 1 */</span><br><span class="line">void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)//&amp;#x66F4;&amp;#x65B0;&amp;#x4E2D;&amp;#x65AD;&amp;#xFF08;&amp;#x6EA2;&amp;#x51FA;&amp;#xFF09;&amp;#x53D1;&amp;#x751F;&amp;#x65F6;&amp;#x6267;&amp;#x884C;</span><br><span class="line">&#123;</span><br><span class="line">if((TIM5CH2_CAPTURE_STA&amp;0X80) ==0)//&amp;#x8FD8;&amp;#x672A;&amp;#x6355;&amp;#x83B7;&amp;#x6210;&amp;#x529F;</span><br><span class="line">&#123;</span><br><span class="line">if(TIM5CH2_CAPTURE_STA&amp;0X40)//&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E0B;&amp;#x964D;&amp;#x6CBF;</span><br><span class="line">&#123;</span><br><span class="line">if((TIM5CH2_CAPTURE_STA&amp;0X3F)==0X3F)//&amp;#x9AD8;&amp;#x7535;&amp;#x5E73;&amp;#x65F6;&amp;#x95F4;&amp;#x592A;&amp;#x957F;&amp;#x4E86;</span><br><span class="line">&#123;</span><br><span class="line">TIM5CH2_CAPTURE_STA |= 0X80;//&amp;#x6807;&amp;#x8BB0;&amp;#x6210;&amp;#x529F;&amp;#x6355;&amp;#x83B7;&amp;#x4E00;&amp;#x6B21;</span><br><span class="line">TIM5CH2_CAPTURE_VAL = 0XFFFF;//</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">TIM5CH2_CAPTURE_STA++;//&amp;#x5426;&amp;#x5219;&amp;#x6807;&amp;#x8BB0;&amp;#x6EA2;&amp;#x51FA;&amp;#x6570;&amp;#x52A0;&amp;#x4E00;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void HAL_TIM_IC_CaptureCallback(TIM_HandleTypeDef *htim)//&amp;#x6355;&amp;#x83B7;&amp;#x4E2D;&amp;#x65AD;&amp;#x53D1;&amp;#x751F;&amp;#x65F6;&amp;#x6267;&amp;#x884C;</span><br><span class="line">&#123;</span><br><span class="line">if((TIM5CH2_CAPTURE_STA&amp;0x80)==0)//&amp;#x8FD8;&amp;#x672A;&amp;#x6355;&amp;#x83B7;&amp;#x6210;&amp;#x529F;</span><br><span class="line">&#123;</span><br><span class="line">if(TIM5CH2_CAPTURE_STA&amp;0x40)//&amp;#x6210;&amp;#x529F;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E0B;&amp;#x964D;&amp;#x6CBF;</span><br><span class="line">&#123;</span><br><span class="line">TIM5CH2_CAPTURE_STA |= 0X80;//&amp;#x6807;&amp;#x8BB0;&amp;#x6210;&amp;#x529F;&amp;#xFF0C;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x6B21;&amp;#x9AD8;&amp;#x7535;&amp;#x5E73;&amp;#x5B8C;&amp;#x6210;</span><br><span class="line">TIM5CH2_CAPTURE_VAL  = HAL_TIM_ReadCapturedValue(&amp;htim5, TIM_CHANNEL_1);//&amp;#x83B7;&amp;#x53D6;&amp;#x5F53;&amp;#x524D;&amp;#x6355;&amp;#x83B7;&amp;#x503C;</span><br><span class="line">TIM_RESET_CAPTUREPOLARITY(&amp;htim5, TIM_CHANNEL_1);//&amp;#x6E05;&amp;#x9664;&amp;#x539F;&amp;#x6765;&amp;#x8BBE;&amp;#x7F6E;</span><br><span class="line">TIM_SET_CAPTUREPOLARITY(&amp;htim5, TIM_CHANNEL_1, TIM_ICPOLARITY_RISING);//&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E0B;&amp;#x964D;&amp;#x6CBF;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x6355;&amp;#x83B7;&amp;#x590D;&amp;#x4F4D;&amp;#x5230;&amp;#x6355;&amp;#x83B7;&amp;#x4E0A;&amp;#x5347;&amp;#x6CBF;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">else//&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E0A;&amp;#x5347;&amp;#x6CBF;</span><br><span class="line">&#123;</span><br><span class="line">TIM5CH2_CAPTURE_STA = 0;</span><br><span class="line">TIM5CH2_CAPTURE_VAL = 0;</span><br><span class="line">TIM5CH2_CAPTURE_STA |= 0x40;//&amp;#x7B2C;&amp;#x516D;&amp;#x4F4D;&amp;#x6807;&amp;#x8BB0;&amp;#x4E3A;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E0A;&amp;#x5347;&amp;#x6CBF;</span><br><span class="line">__HAL_TIM_DISABLE(&amp;htim5);//&amp;#x5173;&amp;#x95ED;&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;</span><br><span class="line">__HAL_TIM_SET_COUNTER(&amp;htim5, 0);//&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;&amp;#x521D;&amp;#x59CB;&amp;#x503C;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E3A;0</span><br><span class="line">TIM_RESET_CAPTUREPOLARITY(&amp;htim5, TIM_CHANNEL_1);</span><br><span class="line">TIM_SET_CAPTUREPOLARITY(&amp;htim5, TIM_CHANNEL_1, TIM_ICPOLARITY_FALLING);//&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E0A;&amp;#x5347;&amp;#x6CBF;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x6355;&amp;#x83B7;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E3A;&amp;#x4E0B;&amp;#x964D;&amp;#x6CBF;</span><br><span class="line">__HAL_TIM_ENABLE(&amp;htim5);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">/* USER CODE END 1 */</span><br></pre></td></tr></table></figure><h3 id="4-3å®Œå–„gpio-c"><a href="#4-3å®Œå–„gpio-c" class="headerlink" title="4.3å®Œå–„gpio.c"></a>4.3å®Œå–„gpio.c</h3><p>æ¨¡æ‹ŸTrigè„šï¼Œå…ˆç½®ä½ï¼Œè¿‡40usåï¼Œå¤ä½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* USER CODE BEGIN 2 */</span><br><span class="line">void CHL_capture(void)</span><br><span class="line">&#123;</span><br><span class="line">uint32_t i;</span><br><span class="line"></span><br><span class="line">HAL_GPIO_WritePin(TRIG_GPIO_Port, TRIG_Pin, GPIO_PIN_SET);</span><br><span class="line">for(i=0;i&lt;72*40;i++) 2 __nop(); hal_gpio_writepin(trig_gpio_port, trig_pin, gpio_pin_reset); &#125; * user code end &lt;&gt;&lt;/72*40;i++)&gt;</span><br></pre></td></tr></table></figure><h3 id="4-4å®Œå–„mainå‡½æ•°"><a href="#4-4å®Œå–„mainå‡½æ•°" class="headerlink" title="4.4å®Œå–„mainå‡½æ•°"></a>4.4å®Œå–„mainå‡½æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">  /* USER CODE BEGIN 1 */</span><br><span class="line">float len = 0;</span><br><span class="line">uint32_t time= 0;</span><br><span class="line">uint8_t count = 0;</span><br><span class="line">  /* USER CODE END 1 */</span><br><span class="line"></span><br><span class="line">  /* MCU Configuration--------------------------------------------------------*/</span><br><span class="line"></span><br><span class="line">  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br><span class="line">  HAL_Init();</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN Init */</span><br><span class="line"></span><br><span class="line">  /* USER CODE END Init */</span><br><span class="line"></span><br><span class="line">  /* Configure the system clock */</span><br><span class="line">  SystemClock_Config();</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN SysInit */</span><br><span class="line"></span><br><span class="line">  /* USER CODE END SysInit */</span><br><span class="line"></span><br><span class="line">  /* Initialize all configured peripherals */</span><br><span class="line">  MX_GPIO_Init();</span><br><span class="line">  MX_TIM5_Init();</span><br><span class="line">  MX_USART1_UART_Init();</span><br><span class="line">  /* USER CODE BEGIN 2 */</span><br><span class="line">printf(&quot;Hello World!\r\n&quot;);</span><br><span class="line">HAL_TIM_IC_Start_IT(&amp;htim5,TIM_CHANNEL_1);   //&amp;#x5F00;&amp;#x542F;TIM2&amp;#x7684;&amp;#x6355;&amp;#x83B7;&amp;#x901A;&amp;#x9053;2&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5F00;&amp;#x542F;&amp;#x6355;&amp;#x83B7;&amp;#x4E2D;&amp;#x65AD;</span><br><span class="line">    __HAL_TIM_ENABLE_IT(&amp;htim5,TIM_IT_UPDATE);   //&amp;#x4F7F;&amp;#x80FD;&amp;#x66F4;&amp;#x65B0;&amp;#x4E2D;&amp;#x65AD;</span><br><span class="line"></span><br><span class="line">  /* USER CODE END 2 */</span><br><span class="line"></span><br><span class="line">  /* Infinite loop */</span><br><span class="line">  /* USER CODE BEGIN WHILE */</span><br><span class="line">  while (1)</span><br><span class="line">  &#123;</span><br><span class="line">    /* USER CODE END WHILE */</span><br><span class="line"></span><br><span class="line">    /* USER CODE BEGIN 3 */</span><br><span class="line">  HAL_Delay(100);</span><br><span class="line">  CHL_capture();</span><br><span class="line">  if(TIM5CH2_CAPTURE_STA &amp; 0x80)//&amp;#x6210;&amp;#x529F;&amp;#x6355;&amp;#x83B7;&amp;#x4E00;&amp;#x4E2A;&amp;#x8109;&amp;#x5BBD;</span><br><span class="line">  &#123;</span><br><span class="line">time = TIM5CH2_CAPTURE_STA &amp; 0x3F;//&amp;#x83B7;&amp;#x53D6;&amp;#x6EA2;&amp;#x51FA;&amp;#x6B21;&amp;#x6570;</span><br><span class="line">time *= 65536;//&amp;#x83B7;&amp;#x5F97;&amp;#x6EA2;&amp;#x51FA;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x503C;</span><br><span class="line">time += TIM5CH2_CAPTURE_VAL;//&amp;#x52A0;&amp;#x4E0A;&amp;#x6700;&amp;#x540E;&amp;#x4E00;&amp;#x6B21;&amp;#x53D6;&amp;#x5F97;&amp;#x7684;&amp;#x503C;</span><br><span class="line">len = time * 342.62*100/2000000;</span><br><span class="line"></span><br><span class="line">TIM5CH2_CAPTURE_STA = 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  printf(&quot;LENGTH: %f CM\r\n&quot;, len);</span><br><span class="line">  &#125;</span><br><span class="line">  /* USER CODE END 3 */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº†é€šè¿‡HALåº“å®ŒæˆSR-04è¶…å£°æ³¢ä¼ æ„Ÿå™¨è·ç¦»çš„æµ‹é‡ã€‚åŒ…æ‹¬äº†ï¼Œè¶…å£°æ³¢ä¼ æ„Ÿå™¨çš„åŸç†ã€STM32CUBEMXçš„é…ç½®ï¼Œä»¥åŠç¨‹åºçš„å®Œå–„ã€‚æœ€ç»ˆçš„ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/bdd5e4a431694f4897745b2ebb55fbdd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32 HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº</title>
      <link href="/2024/03/stm32-stm32-STM32-HAL%E5%BA%93%E9%A9%B1%E5%8A%A8DHT11%E8%AF%BB%E5%8F%96%E6%B8%A9%E6%B9%BF%E5%BA%A6%E7%A8%8B%E5%BA%8F/"/>
      <url>/2024/03/stm32-stm32-STM32-HAL%E5%BA%93%E9%A9%B1%E5%8A%A8DHT11%E8%AF%BB%E5%8F%96%E6%B8%A9%E6%B9%BF%E5%BA%A6%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº"><a href="#STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº" class="headerlink" title="STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº"></a>STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº</h2><p><strong>é©±åŠ¨DHT11ã€DHT22ã€DS18BB20ç­‰æ¸©æ¹¿åº¦æ¨¡å—æ—¶åºæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå…³é”®åœ¨äºæ§åˆ¶å¥½æ—¶åºçš„ <code>&amp;#x5EF6;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;</code> ï¼ŒHALåº“çš„å»¶æ—¶å‡½æ•°HAL_Delayæ˜¯æ¯«ç§’çº§åˆ«å»¶æ—¶å‡½æ•°ï¼Œæ‰€å…³é”®ç‚¹å°±æ˜¯å®ç°å¾®ç§’çº§åˆ«çš„å»¶æ—¶å‡½æ•°ã€‚</strong></p><p><strong>å¾®ç§’çº§åˆ«å»¶æ—¶å‡½æ•°å®ç°è§æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š<a href="https://blog.csdn.net/qq153471503/article/details/102930097">https://blog.csdn.net/qq153471503/article/details/102930097</a></strong></p><p><strong>æ‰«æä»¥ä¸‹äºŒç»´ç ï¼Œå…³æ³¨å…¬ä¼—å· <code>&amp;#x96CD;&amp;#x6B63;&amp;#x4E0D;&amp;#x79C3;&amp;#x5934;</code> è·å–æ›´å¤šSTM32èµ„æºåŠå¹²è´§ï¼</strong><br><img src="https://img-blog.csdnimg.cn/20210126155428872.png"></p><h3 id="sys-h"><a href="#sys-h" class="headerlink" title=";  sys.h"></a><a name="sysh_13">;</a>  sys.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _SYS_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _SYS_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BITBAND(addr, bitnum) ((addr &amp; 0xF0000000)+0x2000000+((addr &amp;0xFFFFF)&lt;&lt;5)+(bitnum&lt;&lt;2))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEM_ADDR(addr)  *((volatile unsigned long  *)(addr))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BIT_ADDR(addr, bitnum)   MEM_ADDR(BITBAND(addr, bitnum))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOA_ODR_Addr    (GPIOA_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOB_ODR_Addr    (GPIOB_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOC_ODR_Addr    (GPIOC_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOD_ODR_Addr    (GPIOD_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOE_ODR_Addr    (GPIOE_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOF_ODR_Addr    (GPIOF_BASE+12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOG_ODR_Addr    (GPIOG_BASE+12)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOA_IDR_Addr    (GPIOA_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOB_IDR_Addr    (GPIOB_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOC_IDR_Addr    (GPIOC_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOD_IDR_Addr    (GPIOD_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOE_IDR_Addr    (GPIOE_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOF_IDR_Addr    (GPIOF_BASE+8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIOG_IDR_Addr    (GPIOG_BASE+8)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PAout(n)   BIT_ADDR(GPIOA_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PAin(n)    BIT_ADDR(GPIOA_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PBout(n)   BIT_ADDR(GPIOB_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PBin(n)    BIT_ADDR(GPIOB_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCout(n)   BIT_ADDR(GPIOC_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCin(n)    BIT_ADDR(GPIOC_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PDout(n)   BIT_ADDR(GPIOD_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PDin(n)    BIT_ADDR(GPIOD_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PEout(n)   BIT_ADDR(GPIOE_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PEin(n)    BIT_ADDR(GPIOE_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PFout(n)   BIT_ADDR(GPIOF_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PFin(n)    BIT_ADDR(GPIOF_IDR_Addr,n)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PGout(n)   BIT_ADDR(GPIOG_ODR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PGin(n)    BIT_ADDR(GPIOG_IDR_Addr,n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="dht11-h"><a href="#dht11-h" class="headerlink" title="dht11.h"></a>dht11.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __DHT11_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __DHT11_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sys.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint8_t</span> u8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint16_t</span> u16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">uint32_t</span> u32;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHT11_IO_IN()  &#123;IODHT22_GPIO_Port-&gt;CRH &amp;= 0xFFFFF0FF;IODHT22_GPIO_Port-&gt;CRH |= 8 &lt;&lt; 8;&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHT11_IO_OUT() &#123;IODHT22_GPIO_Port-&gt;CRH &amp;= 0xFFFFF0FF;IODHT22_GPIO_Port-&gt;CRH |= 3 &lt;&lt; 8;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>DHT11_DQ_OUT PCout(10)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>DHT11_DQ_IN  PCin(10)</span></span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Read_Data</span><span class="params">(u8 *temp, u8 *humi)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Read_Byte</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Read_Bit</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Check</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">DHT11_Rst</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">u8 <span class="title function_">DHT11_Read_Data_Float</span><span class="params">(<span class="type">float</span> *temp,<span class="type">float</span> *humi)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="dht11-c"><a href="#dht11-c" class="headerlink" title="dht11.c"></a>dht11.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dht11.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">DHT11_Rst</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    DHT11_IO_OUT();</span><br><span class="line">    DHT11_DQ_OUT=<span class="number">0</span>;</span><br><span class="line">    delay_ms(<span class="number">20</span>);</span><br><span class="line">    DHT11_DQ_OUT=<span class="number">1</span>;</span><br><span class="line">    delay_us(<span class="number">30</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Check</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 retry=<span class="number">0</span>;</span><br><span class="line">    DHT11_IO_IN();</span><br><span class="line">    <span class="keyword">while</span> (DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(<span class="number">1</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span>(retry&gt;=<span class="number">100</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> retry=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(<span class="number">1</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span>(retry&gt;=<span class="number">100</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Read_Bit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 retry=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    retry=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!DHT11_DQ_IN&amp;&amp;retry&lt;<span class="number">100</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    delay_us(<span class="number">40</span>);</span><br><span class="line">    <span class="keyword">if</span>(DHT11_DQ_IN)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Read_Byte</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 i,dat;</span><br><span class="line">    dat=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        dat&lt;<span class="number">1</span>;</span><br><span class="line">        dat|=DHT11_Read_Bit();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Read_Data</span><span class="params">(u8 *temp,u8 *humi)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 buf[<span class="number">5</span>];</span><br><span class="line">    u8 i;</span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    <span class="keyword">if</span>(DHT11_Check()==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            buf[i]=DHT11_Read_Byte();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>((buf[<span class="number">0</span>]+buf[<span class="number">1</span>]+buf[<span class="number">2</span>]+buf[<span class="number">3</span>])==buf[<span class="number">4</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            *humi=buf[<span class="number">0</span>];</span><br><span class="line">            *temp=buf[<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Read_Data_Float</span><span class="params">(<span class="type">float</span> *temp,<span class="type">float</span> *humi)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 buf[<span class="number">5</span>];</span><br><span class="line">    u8 i;</span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    <span class="keyword">if</span>(DHT11_Check()==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            buf[i]=DHT11_Read_Byte();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>((buf[<span class="number">0</span>]+buf[<span class="number">1</span>]+buf[<span class="number">2</span>]+buf[<span class="number">3</span>])==buf[<span class="number">4</span>])</span><br><span class="line">        &#123;</span><br><span class="line">*humi=((buf[<span class="number">0</span>] &lt;&lt; <span class="number">8</span>) + buf[<span class="number">1</span>]) / <span class="number">10.0</span>;</span><br><span class="line">*temp=((buf[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + buf[<span class="number">3</span>]) / <span class="number">10.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 <span class="title function_">DHT11_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    u8 ret = <span class="number">1</span>;</span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    ret = DHT11_Check();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;dht11 init %s. \r\n&quot;</span>, ret == <span class="number">0</span> ? <span class="string">&quot;ok&quot;</span> : <span class="string">&quot;failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32 å®ç° 44 çŸ©é˜µé”®ç›˜æ‰«æï¼ˆHALåº“ã€æ ‡å‡†åº“ éƒ½é€‚ç”¨ï¼‰ - ç™½èœæ²¡æˆ‘ç™½ - åšå®¢å›­</title>
      <link href="/2024/03/stm32-stm32-STM32-%E5%AE%9E%E7%8E%B0-44-%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98%E6%89%AB%E6%8F%8F%EF%BC%88HAL%E5%BA%93%E3%80%81%E6%A0%87%E5%87%86%E5%BA%93-%E9%83%BD%E9%80%82%E7%94%A8%EF%BC%89-%E7%99%BD%E8%8F%9C%E6%B2%A1%E6%88%91%E7%99%BD-%E5%8D%9A%E5%AE%A2%E5%9B%AD/"/>
      <url>/2024/03/stm32-stm32-STM32-%E5%AE%9E%E7%8E%B0-44-%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98%E6%89%AB%E6%8F%8F%EF%BC%88HAL%E5%BA%93%E3%80%81%E6%A0%87%E5%87%86%E5%BA%93-%E9%83%BD%E9%80%82%E7%94%A8%EF%BC%89-%E7%99%BD%E8%8F%9C%E6%B2%A1%E6%88%91%E7%99%BD-%E5%8D%9A%E5%AE%A2%E5%9B%AD/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>æœ¬æ–‡å®ç°çš„ä»£ç æ˜¯åŸºäºSTM32HALåº“çš„åŸºç¡€ä¸Šçš„ï¼Œä¸è¿‡æ ‡å‡†åº“ä¹Ÿå¯ä»¥ç”¨ï¼Œåªæ˜¯è°ƒç”¨çš„åº“å‡½æ•°ä¸åŒï¼Œé€»è¾‘è·Ÿé…ç½®æ˜¯ä¸€æ ·çš„ï¼ŒæŒ‰æˆ‘è¿™é‡Œçš„é€»è¾‘æ¥é…ç½®å³å¯ã€‚</p><p><strong>1ã€é”®ç›˜åŸç†å›¾ï¼š</strong></p><p><img src="https://img2018.cnblogs.com/blog/1433771/201903/1433771-20190313172634453-1011388660.png"></p><p>åŸç†ä¸¾ä¾‹ï¼šå…ˆæŠŠ F0-F7 å†…éƒ¨æ‹‰é«˜ï¼Œè¿™æ ·è¿™ä¸ª8ä¸ªå¼•è„šéƒ½æ˜¯é«˜ç”µå¹³ï¼Œç„¶åå°±è¿›è¡Œåˆ—æ‰«æã€‚ä¾‹å¦‚ï¼šå‡å¦‚æŒ‰ä¸‹3æŒ‰é’®ï¼ŒY3 åˆ—æ‰«æï¼ŒæŠŠF4å…ˆæ‹‰ä½ï¼Œç„¶åè¯»å–F0-F3çš„çŠ¶æ€ï¼Œå°±ä¼šè¯»å‡ºä¸º1110ï¼Œè¿™å°±å¯ ä»¥çŸ¥é“æ˜¯F3è¡Œæ‹‰ä½äº†ï¼ŒåŒæ—¶è¿™æ—¶å€™æ˜¯ç¨‹åºæ§åˆ¶F4æ‹‰ä½çš„ï¼Œè¿™æ ·å°±å¯ä»¥çŸ¥é“æ˜¯F4åˆ—å¯¼è‡´å®ƒè½¬æ€å˜åŒ–äº†çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®šä½å‡ºæ˜¯F4åˆ—F3è¡Œçš„æŒ‰é”®æŒ‰ä¸‹äº†ï¼›å…¶ä»–çš„åˆ—ä¹Ÿæ˜¯è¿™æ ·å­æ‰«æï¼Œå°±å¯ä»¥å®ç°äº†ã€‚</p><p><strong>2ã€STM32 cubemx å¼•è„šé…ç½®å›¾ï¼š</strong></p><p><img src="https://img2018.cnblogs.com/blog/1433771/201903/1433771-20190313173013856-453677748.png"></p><p>è¿™é‡Œç”¨å¤–éƒ¨æ™¶æŒ¯å†…éƒ¨æ™¶æŒ¯éƒ½å¯ä»¥ï¼Œæ—¶é’Ÿå¯¹è¿™ä¸ªæ²¡ä»€ä¹ˆå½±å“ï¼Œä¸ç”¨å¼€ä¸­æ–­ï¼Œæ‰€ä»¥å…¶ä»–çš„é…ç½®å°±ä¸ç»†è¯´äº†ï¼Œä¸‹é¢å†è¯´ä¸€ä¸‹è¿™8ä¸ªGPIOçš„é…ç½®ã€‚</p><p><img src="https://img2018.cnblogs.com/blog/1433771/201903/1433771-20190313173246180-1491953324.png"></p><p>4ä¸ªå¼•è„šé…æ¨æŒ½è¾“å‡ºï¼Œè¿™4ä¸ªé…è¾“å‡ºçš„å¼•è„šå†…éƒ¨ä¸Šä¸‹æ‹‰ä¸ç”¨é…ç½®ï¼›å¦å¤–4ä¸ªé…æˆè¾“å…¥ï¼Œå†…éƒ¨ä¸Šæ‹‰ã€‚</p><p><strong>3ã€ç”Ÿæˆä»£ç åï¼Œå¼€å§‹ç¼–å†™é€»è¾‘ï¼š</strong></p><p>ç¼–å†™ä¹‹å‰æˆ‘ä»¬å…ˆåšä¸€ä¸‹å¤´æ–‡ä»¶çš„å®šä¹‰ï¼ŒæŠŠä¸€äº›è¦ç”¨åˆ°çš„å®å®šä¹‰å¥½ï¼š</p><pre><span>#ifndef __HW_key_H__</span><span>#define</span> __HW_key_H__<span>#include </span><span>&quot;</span><span>main.h</span><span>&quot;</span><span>#include </span><span>&quot;</span><span>stm32f1xx_hal.h</span><span>&quot;</span><span>#include </span>&lt;<span>string</span>.h&gt;<span>char</span> KEY_SCAN(<span>void</span><span>);</span><span>char</span> KEY_ROW_SCAN(<span>void</span><span>);</span><span>void</span> HW_KEY_FUNCTION(<span>void</span><span>);</span><span>#define</span> KEY_CLO0_OUT_LOW  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_7,GPIO_PIN_RESET)<span>#define</span> KEY_CLO1_OUT_LOW  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_8,GPIO_PIN_RESET)<span>#define</span> KEY_CLO2_OUT_LOW  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_9,GPIO_PIN_RESET)<span>#define</span> KEY_CLO3_OUT_LOW  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_10,GPIO_PIN_RESET)<span>#define</span> KEY_CLO0_OUT_HIGH  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_7,GPIO_PIN_SET)<span>#define</span> KEY_CLO1_OUT_HIGH  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_8,GPIO_PIN_SET)<span>#define</span> KEY_CLO2_OUT_HIGH  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_9,GPIO_PIN_SET)<span>#define</span> KEY_CLO3_OUT_HIGH  HAL_GPIO_WritePin(GPIOE,GPIO_PIN_10,GPIO_PIN_SET)<span>#endif</span></pre><p>ç„¶ååŒ…å«å¤´æ–‡ä»¶ä»¥åŠå®šä¹‰ä¸€äº›è¦ç”¨åˆ°çš„å˜é‡æ•°ç»„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;HW_key.h&quot;</span><br><span class="line">uint8_t Key_row[1]=&#123;0xff&#125;;   //ä¿å­˜æŒ‰é”®è¡Œæ‰«ææƒ…å†µçš„çŠ¶æ€æ•°ç»„</span><br></pre></td></tr></table></figure><p>æ¥ç€å¯ä»¥å†™æ‰«æé€»è¾‘äº†ï¼Œå…ˆç¼–å†™æ¨ªæ‰«æçš„ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/***</span><br><span class="line"> *å‡½æ•°åï¼šKEY_ROW_SCAN</span><br><span class="line"> *åŠŸ  èƒ½ï¼šæŒ‰é”®è¡Œæ‰«æ</span><br><span class="line"> *è¿”å›å€¼ï¼š1~4ï¼Œå¯¹åº”1~4è¡ŒæŒ‰é”®ä½ç½®</span><br><span class="line"> */</span><br><span class="line">char KEY_ROW_SCAN(void)</span><br><span class="line">&#123;</span><br><span class="line">    //è¯»å‡ºè¡Œæ‰«æçŠ¶æ€</span><br><span class="line">    Key_row[0] = HAL_GPIO_ReadPin(GPIOE,KEY_row0_Pin)&lt;&lt;3;</span><br><span class="line">    Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_row1_Pin)&lt;&lt;2);</span><br><span class="line">    Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_row2_Pin)&lt;&lt;1);</span><br><span class="line">    Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_row3_Pin));</span><br><span class="line"></span><br><span class="line">    if(Key_row[0] != 0x0f)         //è¡Œæ‰«ææœ‰å˜åŒ–ï¼Œåˆ¤æ–­è¯¥åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">    &#123;</span><br><span class="line">      HAL_Delay(10);                    //æ¶ˆæŠ–</span><br><span class="line">      if(Key_row[0] != 0x0f)</span><br><span class="line">        &#123;</span><br><span class="line">                //printf(&quot;Key_Row_DATA = 0x%x\r\n&quot;,Key_row[0]);</span><br><span class="line">                switch(Key_row[0])</span><br><span class="line">                &#123;</span><br><span class="line">                    case 0x07:         //0111 åˆ¤æ–­ä¸ºè¯¥åˆ—ç¬¬1è¡Œçš„æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">                        return 1;</span><br><span class="line">                    case 0x0b:         //1011 åˆ¤æ–­ä¸ºè¯¥åˆ—ç¬¬2è¡Œçš„æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">                        return 2;</span><br><span class="line">                    case 0x0d:         //1101 åˆ¤æ–­ä¸ºè¯¥åˆ—ç¬¬3è¡Œçš„æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">                        return 3;</span><br><span class="line">                    case 0x0e:         //1110 åˆ¤æ–­ä¸ºè¯¥åˆ—ç¬¬4è¡Œçš„æŒ‰é”®æŒ‰ä¸‹</span><br><span class="line">                        return 4;</span><br><span class="line">                    default :</span><br><span class="line">                        return 0;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    else return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥åˆ¤æ–­å“ªä¸€è¡Œæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œå¹¶è¿”å›æœ‰æŒ‰é”®æŒ‰ä¸‹çš„è¡Œæ•°ã€‚</p><p>æ¥ç€ç¼–å†™åˆ—æ‰«æçš„ä»£ç ï¼Œè¿™é‡Œçš„æ€æƒ³æ˜¯ï¼Œå…ˆæ‰«æç¬¬ä¸€åˆ—ï¼Œæ¥ç€åˆ¤æ–­ç¬¬ä¸€åˆ—æœ‰æ²¡æœ‰è¡Œè¢«æŒ‰ä¸‹ï¼Œæœ‰çš„è¯å°±å¯ä»¥ç›´æ¥å®šä½åˆ°è¿™ä¸€åˆ—çš„å“ªä¸€è¡Œï¼Œå…¶ä»–4åˆ—é€»è¾‘ä¸€æ ·ï¼Œè¿™æ ·å°±å¯ä»¥å®šä½åˆ°å“ªä¸ªæŒ‰é”®æŒ‰ä¸‹äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">/***</span><br><span class="line"> *å‡½æ•°åï¼šKEY_SCAN</span><br><span class="line"> *åŠŸ  èƒ½ï¼š4*4æŒ‰é”®æ‰«æ</span><br><span class="line"> *è¿”å›å€¼ï¼š0~16ï¼Œå¯¹åº”16ä¸ªæŒ‰é”®</span><br><span class="line"> */</span><br><span class="line">char KEY_SCAN(void)</span><br><span class="line">&#123;</span><br><span class="line">    char Key_Num=0;       //1-16å¯¹åº”çš„æŒ‰é”®æ•°</span><br><span class="line">    char key_row_num=0;        //è¡Œæ‰«æç»“æœè®°å½•</span><br><span class="line"></span><br><span class="line">    KEY_CLO0_OUT_LOW;</span><br><span class="line">    if( (key_row_num=KEY_ROW_SCAN()) != 0 )</span><br><span class="line">    &#123;</span><br><span class="line">        while(KEY_ROW_SCAN() != 0);  //æ¶ˆæŠ–</span><br><span class="line">        Key_Num = 0 + key_row_num;</span><br><span class="line">        //printf(&quot;Key_Clo_1\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    KEY_CLO0_OUT_HIGH;</span><br><span class="line"></span><br><span class="line">    KEY_CLO1_OUT_LOW;</span><br><span class="line">    if( (key_row_num=KEY_ROW_SCAN()) != 0 )</span><br><span class="line">    &#123;</span><br><span class="line">        while(KEY_ROW_SCAN() != 0);</span><br><span class="line">        Key_Num = 4 + key_row_num;</span><br><span class="line">        //printf(&quot;Key_Clo_2\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    KEY_CLO1_OUT_HIGH;</span><br><span class="line"></span><br><span class="line">    KEY_CLO2_OUT_LOW;</span><br><span class="line">    if( (key_row_num=KEY_ROW_SCAN()) != 0 )</span><br><span class="line">    &#123;</span><br><span class="line">        while(KEY_ROW_SCAN() != 0);</span><br><span class="line">    Key_Num = 8 + key_row_num;</span><br><span class="line">        //printf(&quot;Key_Clo_3\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    KEY_CLO2_OUT_HIGH;</span><br><span class="line"></span><br><span class="line">    KEY_CLO3_OUT_LOW;</span><br><span class="line">    if( (key_row_num=KEY_ROW_SCAN()) != 0 )</span><br><span class="line">    &#123;</span><br><span class="line">//        Key_row[0] = HAL_GPIO_ReadPin(GPIOE,KEY_col0_Pin)&lt;//        Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_col1_Pin)&lt;//        Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_col2_Pin)&lt;//        Key_row[0] = Key_row[0] | (HAL_GPIO_ReadPin(GPIOE,KEY_col3_Pin));</span><br><span class="line">//        printf(&quot;Key_Clo4_DATA = 0x%x\r\n&quot;,Key_row[0]);</span><br><span class="line">        while(KEY_ROW_SCAN() != 0);</span><br><span class="line">        Key_Num = 12 + key_row_num;</span><br><span class="line">        //printf(&quot;Key_Clo_4\r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    KEY_CLO3_OUT_HIGH;</span><br><span class="line"></span><br><span class="line">    return Key_Num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°å°±å¯ä»¥ç›´æ¥è¿”å›1-16ä¸ªæŒ‰é”®çš„æŒ‰é”®æ•°äº†ï¼ŒæŒ‰ä¸‹ç¬¬ä¸€ä¸ªæŒ‰é”®å°±è¿”å›1ï¼Œç¬¬2ä¸ªå°±è¿”å›2ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä¸‹é¢å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°åšæŒ‰é”®æŒ‰ä¸‹çš„æ“ä½œäº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/***</span><br><span class="line"> *å‡½æ•°åï¼šKEY_ROW_SCAN</span><br><span class="line"> *åŠŸ  èƒ½ï¼šæ‰§è¡ŒæŒ‰ä¸‹æŒ‰é”®åçš„æ“ä½œ</span><br><span class="line"> *è¿”å›å€¼ï¼šæ— </span><br><span class="line"> */</span><br><span class="line">void HW_KEY_FUNCTION(void)</span><br><span class="line">&#123;</span><br><span class="line">    char key_confirm;</span><br><span class="line">    key_confirm = KEY_SCAN();</span><br><span class="line">    if( 0 &lt; key_confirm  &amp;&amp; key_confirm &lt; 17 )</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;Key_NUM = %d \r\n&quot;,key_confirm); //æŒ‰ä¸‹1-16ä¸ªæŒ‰é”®çš„æ“ä½œ</span><br><span class="line">        printf(&quot;= = = = = = = = = = = \r\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œå°±æ˜¯ç”¨ä¸²å£åŠ©æ‰‹æ‰“å°å‡ºæ¥æŸ¥çœ‹å“ªä¸ªæŒ‰é”®æŒ‰ä¸‹çš„ï¼Œå®æµ‹å¯ç”¨ã€‚</p><p><img src="https://img2018.cnblogs.com/blog/1433771/201903/1433771-20190318150541397-1921208533.png"></p><p><strong>4ã€æ€»ç»“ï¼š</strong></p><p>ï¼ˆ1ï¼‰å…ˆé…ç½®8ä¸ªå¼•è„šï¼Œ4ä¸ªé…ç½®è¾“å…¥ï¼Œä¸Šæ‹‰ï¼›4ä¸ªé…ç½®æˆæ¨æŒ½ï¼ˆPPï¼‰è¾“å‡ºï¼Œä¸ç”¨ä¸Šä¸‹æ‹‰ï¼Œè¾“å‡ºé«˜ç”µå¹³ï¼›</p><p>ï¼ˆ2ï¼‰è½¯ä»¶é€»è¾‘ï¼š</p><p>a. å…ˆè¯´ä¸€ä¸‹è¡Œæ‰«æçš„åŸç†ï¼Œå› ä¸ºå¦‚æœæœ‰æŒ‰é”®æŒ‰ä¸‹çš„è¯ï¼ŒæŸä¸€ä¸ªè¾“å…¥çš„å¼•è„šå°±ä¼šè·Ÿå¯¹åº”çš„è¾“å‡ºå¼•è„šè¿æ¥ï¼Œå› ä¸ºè¾“å‡ºä¸ºé«˜ç”µå¹³ï¼Œæ‰€ä»¥å¯¹åº”çš„è¾“å…¥å¼•è„šä¼šè¢«æ‹‰é«˜ï¼Œè¯»å–å¼•è„šçš„çŠ¶æ€ï¼Œåˆ¤æ–­å“ªä¸ªå¼•è„šè¢«æ‹‰é«˜å°±å¯ä»¥çŸ¥é“å“ªä¸€è¡Œæœ‰æŒ‰é”®æŒ‰ä¸‹äº†ï¼›æ€»çš„æ¥è¯´æ˜¯é€šè¿‡é«˜å››ä½è¾“å‡ºé«˜ç”µå¹³æ¥å¯¹çŸ©é˜µé”®ç›˜è¿›è¡Œé€è¡Œæ‰«æï¼Œå½“ä½å››ä½æ¥æ”¶åˆ°çš„æ•°æ®ä¸å…¨ä¸º1çš„æ—¶å€™ï¼Œè¯´æ˜æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œç„¶åé€šè¿‡æ¥æ”¶åˆ°çš„æ•°æ®æ˜¯å“ªä¸€ä½ä¸º0æ¥åˆ¤æ–­æ˜¯å“ªä¸€è¡ŒæŒ‰é”®è¢«æŒ‰ä¸‹ï¼›</p><p>b. åˆ—æ‰«æåŸç†ï¼šæ€è·¯æ˜¯å…ˆæŠŠç¬¬ä¸€åˆ—è¾“å‡ºä½ç”µå¹³ï¼Œæ¥ç€è¯»å–é«˜4ä½çš„ç”µå¹³è½¬æ€ï¼Œå•ä¸å…¨ä¸º1æ—¶ï¼Œè¯´æ˜è¿™ä¸€åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼ŒåŒæ—¶ç»“åˆè¡Œæ‰«æåˆ¤æ–­å‡ºæ¥çš„è¡Œæ•°å®šä½åˆ°æŒ‰ä¸‹çš„æŒ‰é”®ã€‚ç¨‹åºé‡Œæ˜¯æ‰«æç¬¬ä¸€åˆ—çš„æ—¶å€™ç¬¬ä¸€åˆ—ç»™ä½ç”µå¹³ï¼Œæ¥ç€è¿›è¡Œè¡Œæ‰«æåˆ¤æ–­ï¼Œå› ä¸ºè¾“å…¥è¾“å‡ºå¼•è„šéƒ½æ˜¯é«˜ç”µå¹³äº†ï¼Œåªæœ‰ç¬¬ä¸€åˆ—çš„å¼•è„šæ˜¯ä½ç”µå¹³ï¼Œæ‰€ä»¥å½“ç¬¬ä¸€åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹çš„æ—¶å€™ï¼Œè¡Œæ‰«æè¯»åˆ°çš„4ä¸ªå¼•è„šå°±ä¸å…¨ä¸º1ï¼Œè¿™æ—¶å› ä¸ºç¬¬ä¸€åˆ—çš„ç”µå¹³æ˜¯æˆ‘ä»¬è‡ªå·±ç»™çš„ï¼Œæ‰€ä»¥å°±å¯ä»¥ç›´æ¥åˆ¤æ–­è¿™ä¸€åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼›æ¥ç€åˆ©ç”¨è¡Œæ‰«æåŸç†å®šä½å“ªä¸€è¡Œæœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œè¿™æ ·å°±å¯ä»¥åˆ¤æ–­å‡ºç¬¬ä¸€åˆ—çš„æŸä¸€è¡Œçš„æŒ‰é”®è¢«æŒ‰ä¸‹äº†ï¼Œå…¶ä»–3åˆ—åŒç†ï¼Œç„¶åè½®æµæ‰«æ4åˆ—å°±å¯ä»¥åˆ¤æ–­16ä¸ªæŒ‰é”®äº†ã€‚</p><p>é€šä¿—ç‚¹è¯´ï¼Œå°±æ˜¯å¦‚æœæˆ‘ç»™è¿™ä¸€åˆ—ä½ç”µå¹³ï¼Œé€ æˆäº†è¡Œæ‰«ææœ‰å˜åŒ–ï¼Œé‚£å°±ç›´æ¥çŸ¥é“è¿™ä¸€åˆ—æœ‰æŒ‰é”®æŒ‰ä¸‹ï¼Œæ¥ç€æŸ¥çœ‹è¡Œå˜åŒ–çš„ç”µå¹³å˜åŒ–ï¼Œæ¨ç®—å‡ºå“ªä¸€è¡Œå˜åŒ–äº†ï¼Œå°±å¯ä»¥çŸ¥é“è¿™ä¸€åˆ—çš„ç¬¬å‡ ä¸ªæŒ‰é”®è¢«æŒ‰ä¸‹äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32CubeMX  HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦</title>
      <link href="/2024/03/stm32-stm32-STM32CubeMX-HAL%E5%BA%93%E7%9A%84ADC%E5%A4%9A%E9%80%9A%E9%81%93%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%EF%BC%88%E8%BD%AE%E8%AE%AD%E3%80%81DMA%E3%80%81DMA-TIM-%E3%80%81%E8%AF%BB%E5%8F%96%E5%86%85%E9%83%A8%E4%BC%A0%E6%84%9F%E5%99%A8%E6%B8%A9%E5%BA%A6/"/>
      <url>/2024/03/stm32-stm32-STM32CubeMX-HAL%E5%BA%93%E7%9A%84ADC%E5%A4%9A%E9%80%9A%E9%81%93%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%EF%BC%88%E8%BD%AE%E8%AE%AD%E3%80%81DMA%E3%80%81DMA-TIM-%E3%80%81%E8%AF%BB%E5%8F%96%E5%86%85%E9%83%A8%E4%BC%A0%E6%84%9F%E5%99%A8%E6%B8%A9%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="STM32CubeMX-HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA-TIM-ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦"><a href="#STM32CubeMX-HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA-TIM-ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦" class="headerlink" title="STM32CubeMX | HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦"></a>STM32CubeMX | HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦</h2><h4 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h4><ul><li><a href="#stm32cubemx--haladcdmadmatim-0">STM32CubeMX | HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦</a></li><li><ul><li><ul><li><a href="#1adc-11">1ã€ADCç®€ä»‹</a></li><li><ul><li><a href="#11--13">1.1 é‡‡æ ·å®šç†</a></li><li><a href="#12--15">1.2 æ¨¡å¼ä»‹ç»</a></li><li><a href="#13--24">1.3 é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—</a></li></ul></li><li><a href="#2-56">2ã€è½®è®­æ–¹å¼çš„å¤šé€šé“é‡‡é›†</a></li><li><ul><li><a href="#21--57">2.1 æ–¹å¼ä¸€ï¼šé—´æ–­æ¨¡å¼+æ‰«ææ¨¡å¼</a></li><li><a href="#22--72">2.2 æ–¹å¼äºŒï¼šå®Œå…¨è½®è®­</a></li></ul></li><li><a href="#3dma-108">3ã€DMAå®ç°å¤šé€šé“é‡‡é›†</a></li><li><a href="#4timdma-136">4ã€TIM+DMAå®ç°å¤šé€šé“é‡‡é›†</a></li><li><a href="#5adc-179">5ã€è¡¥å……ï¼šå†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ADCé€šé“</a></li></ul></li></ul></li></ul><p><em>æ³¨ï¼šæœ¬ç‰‡æ–‡ç« ä»¥STM32F103ç³»åˆ—ä¸ºä¾‹ï¼Œå…¶ä»–ç³»åˆ—å¯èƒ½ç¨æœ‰ä¸åŒã€‚</em></p><h4 id="1ã€ADCç®€ä»‹"><a href="#1ã€ADCç®€ä»‹" class="headerlink" title="1ã€ADCç®€ä»‹"></a>1ã€ADCç®€ä»‹</h4><h5 id="1-1-é‡‡æ ·å®šç†"><a href="#1-1-é‡‡æ ·å®šç†" class="headerlink" title="1.1 é‡‡æ ·å®šç†"></a>1.1 é‡‡æ ·å®šç†</h5><h5 id="1-2-æ¨¡å¼ä»‹ç»"><a href="#1-2-æ¨¡å¼ä»‹ç»" class="headerlink" title="1.2 æ¨¡å¼ä»‹ç»"></a>1.2 æ¨¡å¼ä»‹ç»</h5><ul><li><strong>æ‰«ææ¨¡å¼ï¼š</strong> ä½¿ç”¨STM32CUBEMXé…ç½®äº†å¤šé€šé“åï¼Œè¿™ä¸€é¡¹é»˜è®¤å¼€å¯ä¸”æ— æ³•è®¾ç½®æˆå…³é—­ã€‚è¿™ä¸ªæ¨¡å¼å°±æ˜¯è‡ªåŠ¨æ‰«æä½ å¼€å¯çš„æ‰€æœ‰é€šé“è¿›è¡Œè½¬æ¢ï¼Œç›´è‡³è½¬æ¢å®Œã€‚ä¾‹å¦‚ä½ å¼€å¯äº†CH0ã€CH1ã€CH2ã€CH3è¿™å››ä¸ªé€šé“ï¼Œå¯åŠ¨è½¬æ¢åADCä¼šè‡ªåŠ¨å°†è¿™4ä¸ªé€šé“å…¨éƒ¨è½¬æ¢å®Œï¼Œä½†æ˜¯è¿™ç§è¿ç»­æ€§æ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œæ‰€ä»¥å°±å¼•å‡ºäº†é—´æ–­æ¨¡å¼ã€‚</li><li><strong>è¿ç»­æ¨¡å¼ï¼š</strong> åœ¨CUBEä¸­é€‰ä¸­ENABLEå°±æ˜¯è¿ç»­æ¨¡å¼ï¼ŒDISABLEå°±æ˜¯å•æ¬¡æ¨¡å¼ã€‚å¼€å¯è¿ç»­æ¨¡å¼åï¼ŒADCçš„è½¬æ¢ä¸ç”±å…¶ä»–æ§åˆ¶ã€‚ä¾‹å¦‚å°†ADCè®¾ç½®ä¸ºäº†å®šæ—¶å™¨çš„TGROè§¦å‘é‡‡æ ·ï¼Œå¦‚æœå¼€å¯è¿ç»­æ¨¡å¼ï¼ŒADCå°†å¿½ç•¥å®šæ—¶å™¨çš„è§¦å‘é‡‡æ ·ã€‚ï¼ˆè¿ç»­è½¬æ¢æ¨¡å¼å¼€å¯åå…¶å®å°±æ˜¯æ»¡é¢‘ç‡çš„é‡‡æ ·ï¼‰ã€‚</li><li><strong>é—´æ–­æ¨¡å¼ï¼š</strong> å¯ä»¥å°†å¤šä¸ªé€šé“è¿›è¡Œ <strong>åˆ†ç»„é‡‡é›†</strong>ï¼Œä¾‹å¦‚ä½ å¼€å¯äº†CH0~3è¿™4ä¸ªé€šé“ï¼Œå‡å¦‚ä½ è®¾ç½®äº†é—´æ–­æ¬¡æ•°ä¸º4ï¼Œå°±ç›¸å½“äºå°†4ä¸ªé€šé“åˆ†æˆäº†4ç»„ï¼Œæ¯ç»„1ä¸ªé€šé“ï¼Œé‚£ä¹ˆè¦æƒ³é‡‡é›†å®Œè¿™4ä¸ªé€šé“å°±éœ€è¦æ‰‹åŠ¨è§¦å‘4æ¬¡ADCé‡‡é›†ï¼›å¦‚æœè®¾ç½®äº†é—´æ–­æ¬¡æ•°ä¸º2ï¼Œé‚£ä¹ˆé‡‡é›†å®Œ4ä¸ªé€šé“å°±éœ€è¦æ‰‹åŠ¨è§¦å‘2æ¬¡ADCé‡‡é›†ã€‚</li></ul><h5 id="1-3-é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—"><a href="#1-3-é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—" class="headerlink" title="1.3 é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—"></a>1.3 é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—</h5><p><strong>ADCé‡‡æ ·ä¸¤ç‚¹é—´éš”çš„æ—¶é—´ä¸€å®šè¦å¤§äºADCçš„é‡‡æ ·æ—¶é—´ï¼</strong> é‡‡æ ·æ—¶é—´æ€ä¹ˆç®—ï¼Œä¸‹é¢å°±ç»†è¯´ä¸€ä¸‹ã€‚</p><p>STM32F103ä¸€èˆ¬å°†æ—¶é’Ÿé…ç½®ä¸»é¢‘ä¸º72Mã€APB2ä¸º72Mã€‚ADCæŒ‚åœ¨APB2æ—¶é’Ÿæ€»çº¿ä¸Šï¼Œä¸”ADCçš„æ—¶é’Ÿä¸èƒ½è¶…è¿‡14Mã€‚æ‰€ä»¥ä¸€èˆ¬å°†ADCçš„åˆ†é¢‘è®¾ç½®ä¸º6ï¼ŒADCçš„æ—¶é’Ÿä¸»é¢‘å°±ä¸º72&#x2F;6&#x3D;12MHzã€‚é‚£ä¹ˆä¸€ä¸ªå‘¨æœŸå°±æ˜¯ï¼š1&#x2F;12MHz&#x3D;0.0833usã€‚</p><p>ä»¥ä¸‹æˆªå›¾ä¸ºSTM32F1å‚è€ƒæ‰‹å†Œï¼ˆæ‰‹å†Œç¼–å·RM0008ï¼Œå¯åœ¨STå®˜ç½‘ç›´æ¥æœç´¢ä¸‹è½½ï¼‰ï¼š</p><p><img src="https://img-blog.csdnimg.cn/84ca12cd9d40459eb3e03c54889e9df3.png"></p><p>ä¸Šå›¾çš„æ„æ€æ˜¯ï¼šADCå¯¹è¾“å…¥ç”µå‹é‡‡æ ·è‹¥å¹²ä¸ªADC_CLKå‘¨æœŸï¼Œè¿™äº›å‘¨æœŸå¯é€šè¿‡ADC_SMPR1å’ŒADC_SMPR2å¯„å­˜å™¨ä¸­çš„SMP[2:0]ä½è¿›è¡Œä¿®æ”¹ã€‚æ¯ä¸ªé€šé“éƒ½å¯ä»¥ç”¨ä¸åŒçš„é‡‡æ ·æ—¶é—´è¿›è¡Œé‡‡æ ·ã€‚</p><p><strong>ADCè½¬æ¢æ—¶é—´ &#x3D; é‡‡æ ·æ—¶é—´ + 12.5ä¸ªå‘¨æœŸ</strong></p><p>ç¤ºä¾‹ï¼š</p><pre><code class="å½“ADCæ—¶é’Ÿä¸»é¢‘ä¸º14MHzå¹¶ä¸”é‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªå‘¨æœŸæ—¶ï¼šé‡‡æ ·æ—¶é—´">STM32F1ç³»åˆ—çš„æ—¶é’Ÿä¸»é¢‘ä¸€èˆ¬è®¾ç½®ä¸ºäº†12Mï¼Œé‡‡æ ·æ—¶é—´çš„è®¾ç½®æ‰€å¯¹åº”é‡‡æ ·é¢‘ç‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://img-blog.csdnimg.cn/de1135452e21490a94b671995f48824f.png)çŸ¥é“äº†æœ€çŸ­æ—¶é—´åï¼Œå½“ADCæ—¶é’Ÿä¸»é¢‘ä¸º12Må¹¶ä¸”é‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªå‘¨æœŸæ—¶ï¼ŒADCé‡‡æ ·ä¸¤ç‚¹çš„æ—¶é—´å¿…é¡»å¤§äº1.17usã€‚è€ŒSTM32F031ç³»åˆ—çš„ADCæ—¶é’Ÿä¸»é¢‘ä¸º14MHzï¼Œé‡‡æ ·æ—¶é—´çš„è®¾ç½®æ‰€å¯¹åº”é‡‡æ ·é¢‘ç‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![](https://img-blog.csdnimg.cn/4616052a159b4c6da44230ee81f9a4a0.png)å½“ADCæ—¶é’Ÿä¸»é¢‘ä¸º14Må¹¶ä¸”é‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªå‘¨æœŸæ—¶ï¼ŒADCé‡‡æ ·ä¸¤ç‚¹çš„æ—¶é—´å¿…é¡»å¤§äº1usã€‚#### &lt;a name=&quot;2_56&quot;&gt;;&lt;/a&gt;  2ã€è½®è®­æ–¹å¼çš„å¤šé€šé“é‡‡é›†##### 2.1 æ–¹å¼ä¸€ï¼šé—´æ–­æ¨¡å¼+æ‰«ææ¨¡å¼æˆ‘å¼€å¯äº†é€šé“0ã€1ã€2ä»¥åŠå†…éƒ¨æ¸©åº¦è¯»å–é€šé“ä¸€å…±å››ä¸ªé€šé“ï¼š![](https://img-blog.csdnimg.cn/20200820144708671.png#pic_center)![](https://img-blog.csdnimg.cn/20200820144717271.png#pic_center)å¦‚æœæƒ³ä½¿ç”¨è½®è®­æ–¹å¼å¹¶ä¸”ä¸ä½¿ç”¨DMAçš„å¤šé€šé“é‡‡é›†ï¼Œé‚£ä¹ˆå°±è¦é…ç½®ä¸º **ã€å•æ¬¡æ¨¡å¼+é—´æ–­æ¨¡å¼ã€‘**ï¼Œå¹¶ä¸”å°†Number Of Discontinuous Conversionsä¸º1ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªé€šé“åˆ†æˆäº†ä¸€ä¸ªç»„ï¼Œé…ç½®å¦‚ä¸‹å›¾ï¼š![](https://img-blog.csdnimg.cn/20200820145205371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center)ç”±äºæˆ‘è¿™é‡Œè®¾ç½®é—´æ–­æ•°ä¸º1ï¼Œä¹Ÿå°±æ˜¯å°†4ä¸ªé€šé“åˆ†æˆäº†4ç»„ï¼Œé‚£ä¹ˆæˆ‘æ¯æ¬¡é‡‡é›†çš„æ—¶å€™éƒ½éœ€è¦æ‰‹åŠ¨å»è§¦å‘ADCé‡‡é›†ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä¸€æ¬¡HAL_ADC_Startå‡½æ•°ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/2020082014582133.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center)æˆ‘å°†é€šé“0åˆ†åˆ«æ¥åˆ°3.3Vå’ŒGNDä¸Šï¼Œ4é€šé“é‡‡é›†è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/20200820150008132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center)##### &lt;a name=&quot;22__72&quot;&gt;;&lt;/a&gt;  2.2 æ–¹å¼äºŒï¼šå®Œå…¨è½®è®­å®Œå…¨ä½¿ç”¨è½®è®­çš„æ–¹å¼ä¸èƒ½ä½¿ç”¨ **æ‰«ææ¨¡å¼**ï¼ˆç†è®ºä¸Šæ¥è¯´å¤šé€šé“éœ€è¦ä½¿ç”¨æ‰«ææ¨¡å¼ï¼Œè€Œä¸æ˜¯å®Œå…¨è½®è®­ï¼‰ï¼Œä½†æ˜¯ä½¿ç”¨STM32CUBEMXé…ç½®å¤šé€šé“æ‰«ææ¨¡å¼ä¸æ— æ³•è¢«å…³é—­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç”¨STM32CUBEMXé…ç½®æˆä¸€ä¸ªé€šé“ï¼š![](https://img-blog.csdnimg.cn/0b4c62f299d54bcf89ba61ea0aee0eca.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAeS16aGVuZw==,size_20,color_FFFFFF,t_70,g_se,x_16)ç„¶åè¯»å–ADCé‡‡é›†æ•°å€¼çš„å‡½æ•°æ˜¯è¿™æ ·ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint16_t</span> <span class="title function_">ADC_Read</span><span class="params">(<span class="type">uint32_t</span> Channel)</span></span><br><span class="line">&#123;</span><br><span class="line">ADC_ChannelConfTypeDef sConfig = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">sConfig.Channel = Channel;</span><br><span class="line">sConfig.Rank = ADC_REGULAR_RANK_1;</span><br><span class="line">sConfig.SamplingTime = ADC_SAMPLETIME_55CYCLES_5;</span><br><span class="line"><span class="keyword">if</span> (HAL_ADC_ConfigChannel(&amp;hadc1, &amp;sConfig) != HAL_OK)</span><br><span class="line">&#123;</span><br><span class="line">Error_Handler();</span><br><span class="line">&#125;</span><br><span class="line">HAL_ADC_Start(&amp;hadc1);</span><br><span class="line">HAL_ADC_PollForConversion(&amp;hadc1, HAL_MAX_DELAY);</span><br><span class="line"><span class="keyword">return</span> (<span class="type">uint16_t</span>)HAL_ADC_GetValue(&amp;hadc1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>#### 3ã€DMAå®ç°å¤šé€šé“é‡‡é›†é€šè¿‡DMAå®ç°å¤šé€šé“æ•°æ®é‡‡é›†ï¼Œ **è¦å°†è¿ç»­æ¨¡å¼å’Œé—´æ–­æ¨¡å¼å…³é—­ï¼**å¦‚æœè¿ç»­æ¨¡å¼å¼€å¯ï¼Œé‚£ä¹ˆé€šè¿‡DMAä¼ è¾“åˆ°çš„æ•°ç»„ä¸­ï¼Œæ¯ä¸ªé€šé“æ‰€é‡‡é›†åˆ°çš„å€¼å¯¹åº”æ•°ç»„ä¸­çš„ä¸€ä¸ªä½ç½®å°±æ˜¯ä¸å›ºå®šçš„ã€‚ä¾‹å¦‚ä½ å¼€å¯äº†IN0~IN3è¿™å››ä¸ªé€šé“ï¼Œå¹¶é€šè¿‡DMAå°†è¿™å››ä¸ªé€šé“çš„æ•°æ®æ”¾åˆ°ADC_Valueè¿™ä¸ªå¤§å°ä¸º4çš„u16ç±»å‹æ•°ç»„ï¼Œä½ åœ¨ç¬¬ä¸€æ¬¡é‡‡é›†çš„æ—¶å€™IN0é€šé“çš„æ•°å€¼é€šè¿‡DMAè¢«æ”¾åœ¨ADC_Value[0]ï¼Œç¬¬äºŒæ¬¡é‡‡é›†çš„æ—¶å€™IN0é‡‡é›†åˆ°çš„æ•°å€¼å°±å¯èƒ½è¢«æ”¾åˆ°äº†ADC_Value[1]ï¼Œè¿™æ ·çš„è¯å°±æä¸æ–¹ä¾¿æˆ‘ä»¬å¯¹æ¯ä¸ªé€šé“çš„æ•°æ®è¿›è¡Œåˆ†æå’Œæå–ã€‚é…ç½®å¦‚ä¸‹ï¼Œå°†è¿ç»­è½¬æ¢æ¨¡å¼å’Œé—´æ–­è½¬æ¢æ¨¡å¼å…³é—­ï¼Œå¹¶å¼€å¯ADCçš„DMAé€šé“ï¼Œå°†DMAçš„æ¨¡å¼é…ç½®ä¸ºå‘¨æœŸæ¨¡å¼ï¼š![](https://img-blog.csdnimg.cn/20200820152200735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center)![](https://img-blog.csdnimg.cn/ddd590ed84b44942863728c7b84ff639.png)ä»£ç å¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/c457e847f73847ceb3a35f112f66667e.png)4ä¸ªé€šé“é‡‡é›†è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/20200820152427227.png#pic_center)#### &lt;a name=&quot;4timdma_136&quot;&gt;;&lt;/a&gt;  4ã€TIM+DMAå®ç°å¤šé€šé“é‡‡é›†åœ¨ä¸ä½¿ç”¨DMAçš„æƒ…å†µä¸‹ï¼Œå®šæ—¶å™¨æ§åˆ¶ADCè¿›è¡Œæ•°æ®é‡‡é›†åªèƒ½æ˜¯å•é€šé“ï¼å¦‚æœå¼€å¯äº†å¤šé€šé“ï¼Œè¯»å–åˆ°çš„ADCé‡‡é›†å€¼åªä¼šæ˜¯æœ€åä¸€ä¸ªé€šé“çš„å€¼ï¼æ‰€ä»¥ï¼Œè¦æƒ³ä½¿ç”¨å®šæ—¶å™¨æ§åˆ¶ADCé‡‡é›† **å¤šé€šé“**ï¼Œå¿…é¡»ä½¿ç”¨DMAï¼CubeMXé…ç½®å¦‚ä¸‹ï¼Œä½¿èƒ½ADCçš„DMAï¼š![](https://img-blog.csdnimg.cn/42aa3e7658df4d89ac32b7f2a1ebc643.png)ADCçš„è§¦å‘æ–¹å¼è®¾ç½®ä¸ºå®šæ—¶å™¨3çš„è§¦å‘äº‹ä»¶ï¼š![](https://img-blog.csdnimg.cn/c4ff90b3330b44fda0a609316e2370db.png)é‡‡æ ·æ—¶é—´è®¾ç½®ä¸ºäº†55.5ä¸ªå‘¨æœŸï¼Œå¯¹åº”é‡‡æ ·é¢‘ç‡ä¸º176.47KHzï¼Œæ‰€ä»¥å®šæ—¶å™¨3çš„é¢‘ç‡è®¾ç½®è¦ä½äº176.47KHzã€‚è®¾ç½®å®šæ—¶å™¨3åˆ†é¢‘ç³»æ•°ä¸º72ï¼Œé‡è½½å€¼ä¸º10ï¼Œå¾—åˆ° `72MHz / 72&amp;#x5206;&amp;#x9891; / 10 = 100KHz`çš„å®šæ—¶å™¨3ï¼š![](https://img-blog.csdnimg.cn/a50e71979339457e90f451449ec69d86.png)ä»£ç å¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/c418cbe4d5b340a2ae94438927728da5.png)è¿è¡Œç»“æœå¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/534899ff62e24bcb9909ffaff4b29065.png)å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©è¿›è¡Œä¸€ç»„æ•°æ®ï¼Œä¾‹å¦‚å°†32ä¸ªç‚¹ä¸ºä¸€ç»„æ•°æ®è¿›è¡Œé‡‡é›†ï¼Œè®¾ç½®å¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/a08aa8f0ae7c4cd8bfd70d40a980b3e1.png)è¿è¡Œç»“æœå¦‚ä¸‹ï¼š![](https://img-blog.csdnimg.cn/eb3feca6e37140eeb65f794634e86da3.png)#### 5ã€è¡¥å……ï¼šå†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ADCé€šé“![](https://img-blog.csdnimg.cn/87fe51b0eb7b447798ade02be31b4329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70)ä¸Šé¢å›¾ç‰‡æ˜¯æˆªå–åœ¨STM32F103RCçš„datasheetä¸­çš„ï¼Œä¸­æ–‡æ„æ€å°±æ˜¯ï¼šæ¸©åº¦ä¼ æ„Ÿå™¨å¿…é¡»äº§ç”Ÿéšæ¸©åº¦çº¿æ€§å˜åŒ–çš„ç”µå‹ã€‚è½¬æ¢èŒƒå›´åœ¨2v &lt; VDDA &lt; 3.6 Vä¹‹é—´ã€‚æ¸©åº¦ä¼ æ„Ÿå™¨å†…éƒ¨è¿æ¥ADC1_IN16è¾“å…¥é€šé“ï¼Œç”¨äºå°†ä¼ æ„Ÿå™¨è¾“å‡ºç”µå‹è½¬æ¢ä¸ºæ•°å­—å€¼ã€‚å†…éƒ¨æ¸©åº¦è®¡ç®—å…¬å¼ï¼šã€Temperature = &#123;(V25 - VSENSE) / Avg_Slope&#125; + 25ã€‘å­—æ®µè¯´æ˜ï¼š* **V25ï¼š** æœ€å°1.34Vï¼Œæœ€å¤§1.52Vï¼Œå…¸å‹å€¼1.43V* **Avg_Slopeï¼š** æœ€å°4.0ï¼Œæœ€å¤§4.6ï¼Œå…¸å‹å€¼4.3mv/â„ƒ* **VSENSEï¼š** ADCé‡‡é›†åˆ°çš„ç”µå‹![](https://img-blog.csdnimg.cn/da0745b68e874c41b42573887a74e20e.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70)ADCå€¼è½¬ç”µå‹å€¼è®¡ç®—å…¬å¼ï¼šã€ç”µå‹ = ADCé‡‡é›†åˆ°çš„å€¼ * 3.3 / 4096ã€‘çœ‹ä¸Šå›¾æˆ‘é‡‡é›†åˆ°çš„å€¼ä¸º1703ï¼Œå…ˆè½¬æ¢ä¸ºç”µå‹å€¼ï¼š1703*3.3/4096â‰ˆ1.37**ï¼ˆ1.43 - 1.37ï¼‰/ 0.0043 + 25 â‰ˆ 38.95â„ƒ**ends...</code></pre>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€HALåº“ã€‘STM32+ESP8266+Onenet+MQTTï¼Œæç®€å·¥ç¨‹ï¼Œhalåº“ç§»æ¤ã€‚</title>
      <link href="/2024/03/stm32-stm32-%E3%80%90HAL%E5%BA%93%E3%80%91STM32-ESP8266-Onenet-MQTT%EF%BC%8C%E6%9E%81%E7%AE%80%E5%B7%A5%E7%A8%8B%EF%BC%8Chal%E5%BA%93%E7%A7%BB%E6%A4%8D%E3%80%82/"/>
      <url>/2024/03/stm32-stm32-%E3%80%90HAL%E5%BA%93%E3%80%91STM32-ESP8266-Onenet-MQTT%EF%BC%8C%E6%9E%81%E7%AE%80%E5%B7%A5%E7%A8%8B%EF%BC%8Chal%E5%BA%93%E7%A7%BB%E6%A4%8D%E3%80%82/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h4 id="ESP8266-Onenet-MQTT"><a href="#ESP8266-Onenet-MQTT" class="headerlink" title="ESP8266+Onenet+MQTT"></a>ESP8266+Onenet+MQTT</h4><ul><li><ul><li><a href="#1-chled-12">1 å¯¼å…¥.c.hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰</a></li><li><a href="#2-cubemx-21">2 Cubemxé…ç½®</a></li><li><a href="#3--ch--27">3 ä¿®æ”¹ .c.h æ–‡ä»¶</a></li><li><a href="#4--65">4 æµ‹è¯•</a></li></ul></li></ul><p>ESP8266é€šè¿‡MQTTåè®®è¿æ¥Onenetã€‚ä»æ ‡å‡†åº“ç§»åˆ°äº†HALåº“ï¼Œè¿‡ç¨‹æœ‰ç‚¹éº»çƒ¦ï¼Œæ•´äº†ä¸€å¤©ã€‚åšå®Œåæ•´ç†äº†ä¸€ä¸‹ï¼Œè¿™ä¸ªæç®€çš„å·¥ç¨‹ï¼Œæ–¹ä¾¿ä»¥åå¼€å‘ï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚</p><p>ä»£ç å·¥ç¨‹ï¼š<br><a href="https://github.com/wyfroom/ESP8266-Onenet-MQTT">https://github.com/wyfroom/ESP8266-Onenet-MQTT</a></p><p>è¯¥ä»½ä»£ç ç¡¬ä»¶é…ç½®ï¼š<br>æ¿å­ï¼šSTM32F103C8T6æœ€å°ç³»ç»Ÿæ¿ã€‚<br>å¤–è®¾ï¼šä¸²å£1ç”¨ä½œè°ƒè¯•ï¼Œä¸²å£3ç”¨ä½œesp8266ã€‚<br>esp8266ï¼šæ·˜å®ï¼Œesp-01s</p><h3 id="1-å¯¼å…¥-c-hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰"><a href="#1-å¯¼å…¥-c-hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰" class="headerlink" title="1 å¯¼å…¥.c.hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰"></a>1 å¯¼å…¥.c.hæ–‡ä»¶ï¼ˆä¸å†èµ˜è¿°ï¼Œè¯¦ç»†è§LEDéƒ¨åˆ†ï¼‰</h3><p>åœ¨keilå·¥ç¨‹ä¸­å¯¼å…¥ä¹‹å‰å†™å¥½çš„.c.hæ–‡ä»¶ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»æ ‡å‡†åº“ç§»å€’halåº“çš„ï¼Œç›´æ¥ä»æˆ‘å·¥ç¨‹é‡Œå¤åˆ¶å°±è¡Œï¼Œå¾ˆçº¯å‡€ï¼Œæ²¡æœ‰åŠ å¤šä½™çš„ä¸œè¥¿ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•æ ¹æ®ä¸ªäººå®é™…ä½¿ç”¨æƒ…å†µæ›´æ”¹ä¸€äº›å‚æ•°ã€‚</p><blockquote><p>cubemxè¯¦ç»†ä½¿ç”¨æ•™ç¨‹åŠæ‰€æœ‰æ¨¡å—æ•´åˆè§è¿™ç¯‡ï¼š<br><a href="http://t.csdn.cn/Awtl9">ã€HALåº“ã€‘HALåº“STM32cubemxå¿«é€Ÿä½¿ç”¨</a></p></blockquote><p><img src="https://img-blog.csdnimg.cn/img_convert/913840e121e5a09eff4133733245efe9.png"></p><h3 id="2-Cubemxé…ç½®"><a href="#2-Cubemxé…ç½®" class="headerlink" title=";  2 Cubemxé…ç½®"></a><a name="2_cubemx_21">;</a>  2 Cubemxé…ç½®</h3><p>ä¸²å£1ç”¨äºè°ƒè¯•ï¼Œä¸²å£3ç”¨äºESP8266é€šä¿¡ï¼Œæ‰“å¼€ä¸­æ–­ã€‚</p><p>åŸºç¡€çš„æˆ‘å°±ä¸é…ç½®äº†ï¼Œå¯ä»¥çœ‹å‰é¢çš„è¯¦ç»†è®²è§£ã€‚</p><h3 id="3-ä¿®æ”¹-c-h-æ–‡ä»¶"><a href="#3-ä¿®æ”¹-c-h-æ–‡ä»¶" class="headerlink" title="3 ä¿®æ”¹ .c.h æ–‡ä»¶"></a>3 ä¿®æ”¹ .c.h æ–‡ä»¶</h3><p>ç§»æ¤æ—¶è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š</p><p>1 æ”¹æ‰€ç”¨ä¸²å£</p><p>å‘é€éƒ¨åˆ†ï¼šåœ¨esp8266.cé‡Œï¼Œå°†huart3å…¨éƒ¨æ›¿æ¢ä¸ºè¦ä¿®æ”¹çš„ä¸²å£å·ï¼Œæ¯”å¦‚ä¸²å£2ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/87b34edd334476992b18233290799fe3.png"></p><p>æ¥æ”¶éƒ¨åˆ†ï¼šç”¨ä¸²å£ä¸­æ–­æ¥æ”¶esp8266å‘æ¥çš„æ¶ˆæ¯ã€‚éšä¾¿åœ¨å“ªä¸ªæ–‡ä»¶å¤¹å¡«åŠ ä¸²å£å›è°ƒå‡½æ•°ï¼Œæˆ‘ä¸ªäººæ˜¯ä¹‹å‰ä¸“é—¨å»ºäº†ä¸ªuart.cæ–‡ä»¶æ”¾ä¸²å£ç›¸å…³çš„æ‰€æœ‰ä»£ç ã€‚</p><p>åŠ å…¥ä¸‹é¢çš„ä»£ç ï¼ˆä¸²å£å·æ ¹æ®ä¸ªäººæƒ…å†µä¿®æ”¹ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_UART_RxCpltCallback</span><span class="params">(UART_HandleTypeDef *huart)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(huart == &amp;huart3)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(esp8266_cnt &gt;= <span class="keyword">sizeof</span>(esp8266_buf))</span><br><span class="line">&#123;</span><br><span class="line">esp8266_cnt = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">esp8266_buf[esp8266_cnt++] = Uart3_RxData;</span><br><span class="line"></span><br><span class="line">HAL_UART_Receive_IT(&amp;huart3,(<span class="type">uint8_t</span> *)&amp;Uart3_RxData, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2 æ”¹wifiåå­—å’Œå¯†ç </p><p><img src="https://img-blog.csdnimg.cn/img_convert/601b58b84f41ec638f86d9e63eeb4c41.png"></p><p>3 æ”¹äº§å“IDã€è®¾å¤‡IDã€é‰´æƒä¿¡æ¯ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/03f4e721469e45d2729425eca9a8d38a.png"></p><h3 id="4-æµ‹è¯•"><a href="#4-æµ‹è¯•" class="headerlink" title="4 æµ‹è¯•"></a>4 æµ‹è¯•</h3><p><strong>æ·»åŠ å¤´æ–‡ä»¶</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;onenet.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp8266.h&quot;</span></span></span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ åˆå§‹åŒ–</strong></p><p>åˆ«å¿˜äº†å¼€ä¸²å£ä¸­æ–­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HAL_UART_Receive_IT(&amp;huart3,(<span class="type">uint8_t</span> *)&amp;Uart3_RxData, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">HAL_Delay(<span class="number">2000</span>);</span><br><span class="line">ESP8266_Init();</span><br><span class="line">HAL_Delay(<span class="number">2000</span>);</span><br><span class="line"><span class="keyword">while</span>(OneNet_DevLink())</span><br><span class="line">HAL_Delay(<span class="number">2000</span>);</span><br></pre></td></tr></table></figure><p>è¿æ¥æˆåŠŸçš„è¯ï¼Œonenetä¼šæ˜¾ç¤ºè®¾å¤‡åœ¨çº¿ã€‚ä¸²å£ä¹Ÿä¼šæ‰“å°æˆåŠŸã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/e08522ae2a3d08bd5f99c7fdeda41379.png"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/4e1ab1158b6bfc9430b57a31e27cfab3.png"></p><p><strong>å‘é€æ•°æ®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OneNet_SendData();//&amp;#x53D1;&amp;#x9001;&amp;#x6570;&amp;#x636E;</span><br><span class="line">ESP8266_Clear();//&amp;#x6E05;&amp;#x7A7A;&amp;#x6570;&amp;#x636E;&amp;#x7F13;&amp;#x5B58;&amp;#x533A;</span><br><span class="line">HAL_Delay(3000);//3s&amp;#x53D1;&amp;#x9001;&amp;#x4E00;&amp;#x6B21;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/05e4629537d4b953e7e7f4bc651a0267.png"></p><p>è¦å‘ä»€ä¹ˆæ•°æ®ï¼Œåœ¨è¿™é‡Œæ”¹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/img_convert/2e0513318f4aa1042b26a9f18b546071.png"></p><p><strong>æ¥æ”¶æ•°æ®</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataPtr = ESP8266_GetIPD(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(dataPtr != <span class="literal">NULL</span>)</span><br><span class="line">OneNet_RevPro(dataPtr);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºSTM32F103C8T6ï¼ˆHALåº“ï¼‰çš„HC-SR501çº¢å¤–äººä½“ä¼ æ„ŸåŠHC-SR04è¶…å£°æ³¢æµ‹è·</title>
      <link href="/2024/03/stm32-stm32-%E5%9F%BA%E4%BA%8ESTM32F103C8T6%EF%BC%88HAL%E5%BA%93%EF%BC%89%E7%9A%84HC-SR501%E7%BA%A2%E5%A4%96%E4%BA%BA%E4%BD%93%E4%BC%A0%E6%84%9F%E5%8F%8AHC-SR04%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D/"/>
      <url>/2024/03/stm32-stm32-%E5%9F%BA%E4%BA%8ESTM32F103C8T6%EF%BC%88HAL%E5%BA%93%EF%BC%89%E7%9A%84HC-SR501%E7%BA%A2%E5%A4%96%E4%BA%BA%E4%BD%93%E4%BC%A0%E6%84%9F%E5%8F%8AHC-SR04%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="ç³»åˆ—æ–‡ç« ç›®å½•"><a href="#ç³»åˆ—æ–‡ç« ç›®å½•" class="headerlink" title="ç³»åˆ—æ–‡ç« ç›®å½•"></a>ç³»åˆ—æ–‡ç« ç›®å½•</h2><p><a href="https://blog.csdn.net/h568630659/article/details/121404155">ä¸€ã€åŸºäºSTM32F103C8T6æœ€å°ç³»ç»Ÿæ¿å’ŒSTM32CubeMXå®ç°LEDç¯å¾ªç¯é—ªçƒ</a><br><a href="https://blog.csdn.net/h568630659/article/details/121427218">äºŒã€åŸºäºSTM32F103C8T6å’ŒSTM32CubeMXå®ç°UARTä¸²å£é€šä¿¡æ•°æ®æ”¶å‘</a><br><a href="https://blog.csdn.net/h568630659/article/details/121465665">ä¸‰ã€å®æˆ˜å°ä¾‹ç¨‹ åŸºäºSTM32F103C8T6æœ€å°ç³»ç»Ÿæ¿å’ŒSTM32CubeMXé©±åŠ¨WS2812Bå…‰ç«‹æ–¹</a><br><a href="https://blog.csdn.net/h568630659/article/details/121764481">å››ã€åŸºäºSTM32F103C8T6æœ€å°ç³»ç»Ÿæ¿HALåº“CubeMXé©±åŠ¨HC-SR501çº¢å¤–äººä½“ä¼ æ„Ÿæ¨¡å—</a><br><a href="https://blog.csdn.net/h568630659/article/details/122058600">äº”ã€åŸºäºSTM32F103C8T6ï¼ˆHALåº“ï¼‰çš„HC-SR501çº¢å¤–äººä½“ä¼ æ„ŸåŠHC-SR04è¶…å£°æ³¢æµ‹è·</a></p><h4 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h4><ul><li><a href="#-0">ç³»åˆ—æ–‡ç« ç›®å½•</a></li><li><a href="#-16">å‰è¨€</a></li><li><a href="#-22">ä¸€ã€æ¨¡å—ç®€ä»‹</a></li><li><a href="#cubemx-45">äºŒã€é…ç½®CubeMX</a></li><li><a href="#-67">ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†</a></li><li><a href="#-94">å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†</a></li><li><ul><li><a href="#hc-sr04c-97">HC_SR04.c</a></li><li><a href="#hc-sr04h-181">HC_SR04.h</a></li><li><a href="#mainc-193">main.c</a></li></ul></li></ul><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­é©±åŠ¨äº†HC-SR501çº¢å¤–äººä½“ä¼ æ„Ÿæ¨¡å—ï¼Œä½†åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼Œè¿™ä¸ªæ¨¡å—çš„çƒ­é‡Šç”µæ¢å¤´è¿‡äºçµæ•äº†ï¼Œç”šè‡³æœ‰çš„æ—¶å€™å¾€ä¸Šå“ˆæ°”ï¼Œä¼šå› ä¸ºæ£€æµ‹åˆ°ç±»ä¼¼äºäººä½“çš„æ¸©åº¦è€Œè¯¯åˆ¤ä¸ºæ„Ÿåº”åˆ°äººä½“ï¼Œæ‰€ä»¥ä¸ºäº†å‡å°‘è¯¯åˆ¤æ¦‚ç‡ï¼Œæˆ‘æ‰“ç®—å†æ·»åŠ ä¸€ä¸ªæµ‹è·æ¨¡å—ï¼Œåœ¨çº¢å¤–æ„Ÿåº”åˆ°äººä½“æ—¶ï¼Œå†æ¬¡åˆ¤æ–­äººä½“ä¸ä¼ æ„Ÿå™¨çš„è·ç¦»ï¼Œåœ¨æ»¡è¶³é¢„è®¾çš„è·ç¦»èŒƒå›´æ—¶ï¼Œæ‰ç¡®å®šæœ‰äººä½“æ¥è¿‘ï¼Œè¿›è¡Œåç»­æ“ä½œã€‚</p><h2 id="ä¸€ã€æ¨¡å—ç®€ä»‹"><a href="#ä¸€ã€æ¨¡å—ç®€ä»‹" class="headerlink" title="ä¸€ã€æ¨¡å—ç®€ä»‹"></a>ä¸€ã€æ¨¡å—ç®€ä»‹</h2><p><strong>HC-SR501çº¢å¤–äººä½“æ„Ÿåº”æ¨¡å—èµ„æ–™ä»‹ç»ï¼š</strong><br><a href="https://www.arduino.cn/thread-2851-1-1.html">æ¢ç©¶äººä½“çº¢å¤–ä¼ æ„Ÿå™¨HC-SR501</a></p><p><strong>HC-SR04è¶…å£°æ³¢æµ‹è·æ¨¡å—èµ„æ–™ä»‹ç»ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/92ad9fec95424c4daee75611f36e9b7b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>å¼•è„šåç§°å¼•è„šä½œç”¨VCC<br><strong>3-5.5V</strong></p><p>ä¾›ç”µï¼ˆå®æµ‹å‘ç°å¯ä»¥3.3Vä¾›ç”µï¼Œä½†æ²¡æœ‰5Vä¾›ç”µæµ‹å¾—å‡†ï¼‰GNDæ¥åœ°Trigå¤–éƒ¨è§¦å‘ä¿¡å·è¾“å…¥ï¼Œè¾“å…¥ä¸€ä¸ªé«˜äº10Î¼sçš„é«˜ç”µå¹³å³å¯è§¦å‘æ¨¡å—æµ‹è·Echoå›å“ä¿¡å·è¾“å‡ºï¼Œæµ‹è·ç»“æŸæ—¶æ­¤ç®¡è„šè¾“å‡ºä¸€ä¸ªé«˜ç”µå¹³ï¼Œç”µå¹³å®½åº¦åæ˜ è¶…å£°æ³¢å¾€è¿”æ—¶é—´ä¹‹å’Œ</p><p><strong>å·¥ä½œåŸç†ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/2440fa92274644939b0de5e59ef1852b.png"><br><img src="https://img-blog.csdnimg.cn/0fa754c51ca94c2188fbdfa59f3604ea.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><strong>ç®€è€Œè¨€ä¹‹ï¼š<br> ç»™Trigä¸€ä¸ª10Î¼Sä»¥ä¸Šçš„é«˜ç”µå¹³,æ¨¡å—å¼€å§‹å·¥ä½œï¼Œæ¨¡å—å†…è‡ªåŠ¨å‘é€å…«ä¸ª40khzæ–¹æ³¢ï¼Œå¹¶è‡ªä¸»æ£€æµ‹æ˜¯å¦æœ‰ç”µæ³¢è¿”å›ã€‚æ­¤æ—¶éœ€è¦æ£€æµ‹Echoå¤„çš„ç”µå¹³ï¼Œå½“ä¸ºé«˜ç”µå¹³çš„æ—¶å€™è®°ä¸€ä¸ªæ—¶é—´ï¼›å½“Echoå‡ºä¸ºä½ç”µå¹³çš„æ—¶å€™å†è®°ä¸€ä¸ªæ—¶é—´ï¼Œè¿™ä¸¤ä¸ªæ—¶é—´çš„å·®å°±æ˜¯é«˜ç”µå¹³æŒç»­çš„æ—¶é—´ï¼Œæœ€åç”¨æµ‹è·å…¬å¼è¿›è¡Œè®¡ç®—</strong>ã€‚</p><h2 id="äºŒã€é…ç½®CubeMX"><a href="#äºŒã€é…ç½®CubeMX" class="headerlink" title="; äºŒã€é…ç½®CubeMX"></a><a name="cubemx_45">;</a> äºŒã€é…ç½®CubeMX</h2><p><strong>1ã€æ–°å»ºå·¥ç¨‹;<br>2ã€é…ç½®æ—¶é’Ÿæºï¼Œåœ¨RCCé‡Œé¢çš„HSEé…ç½®çš„æ˜¯æ™¶æŒ¯æ—¶é’Ÿ;<br>3ã€é…ç½®ç¨‹åºçƒ§å½•å¼•è„šSYSä¸ºSWDæ¨¡å¼;<br>4ã€é…ç½®GPIOè¾“å‡ºå£ï¼Œé…ç½®ä¸€ä¸ªLEDç¯ï¼ˆæˆ‘çš„æ¿å­æ˜¯PC13ï¼‰ï¼Œèµ·åˆ°æ£€æµ‹åˆ°äººä½“æ—¶çš„æŒ‡ç¤ºä½œç”¨;<br>5ã€é…ç½®GPIOè¾“å…¥å£ï¼Œç”¨æ¥è¯»å–HC-SR501æ¨¡å—çš„è¾“å‡ºç”µå¹³ï¼Œæˆ‘é€‰çš„æ˜¯PA1å£;</strong><br><strong>6ã€é…ç½®GPIOè¾“å…¥å£ï¼Œç”¨æ¥æ£€æµ‹HC-SR04è¶…å£°æ³¢æµ‹è·æ¨¡å—çš„å›å“ä¿¡å·è¾“å‡ºï¼Œæˆ‘é€‰æ‹©PB5å£ï¼Œå‘½åä¸ºHC_SR04_Echo_Pin;<br>7ã€é…ç½®GPIOè¾“å‡ºå£ï¼Œç”¨æ¥è§¦å‘HC-SR04è¶…å£°æ³¢æµ‹è·æ¨¡å—ï¼Œæˆ‘é€‰æ‹©PB4å£ï¼Œå‘½åä¸ºHC_SR04_Trig_Pin;<br>8ã€ä½¿èƒ½å®šæ—¶å™¨ï¼Œç”¨æ¥å®ç°å¾®ç§’å»¶æ—¶ï¼Œå’Œæµ‹é‡HC-SR04æ¨¡å—é«˜ç”µå¹³æ—¶é—´ï¼Œæˆ‘é€‰æ‹©TIM2ï¼Œå¹¶ä½¿èƒ½TIM2ä¸­æ–­;</strong><br><img src="https://img-blog.csdnimg.cn/f5c269ef459b4f58a202b49397c11036.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_17,color_FFFFFF,t_70,g_se,x_16"><br>TIM2æŒ‚è½½åœ¨APB1ï¼Œæ—¶é’Ÿæ¥æºé¢‘ç‡ä¸º36MHzï¼Œæ•…å–é¢„åˆ†é¢‘ç³»æ•° <code>PSC=36-1</code>ï¼Œè®¡æ•°å‘¨æœŸ <code>Counter</code>è®¾ä¸º <code>60000-1</code>ã€‚å³æ­¤æ—¶å®šæ—¶å™¨é¢‘ç‡ä¸º36M&#x2F;36&#x3D;1MHzï¼Œæ¯60msè¿›ä¸€æ¬¡ä¸­æ–­ï¼Œ60000Î¼så¯¹åº”å®é™…æµ‹è·èŒƒå›´å¤§æ¦‚ä¸º10mï¼Œè¿œè¿œè¶…è¿‡æˆ‘çš„éœ€æ±‚ã€‚</p><p><img src="https://img-blog.csdnimg.cn/96058ff9807d44dea3a1b773f47f9330.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"><br><img src="https://img-blog.csdnimg.cn/14c2aefe04d5410b89a5300226b73aa6.png"></p><p><strong>9ã€é…ç½®ä¸²å£æ”¶å‘å¼•è„š;<br>10ã€é…ç½®æ—¶é’Ÿæ ‘ï¼Œæˆ‘è¿˜æ˜¯å¼€åˆ°æœ€é«˜çš„72MHz;<br>11ã€è¿›è¡Œé¡¹ç›®è®¾ç½®ï¼Œæœ€åç”Ÿæˆä»£ç ï¼ŒCubeMXéƒ¨åˆ†å°±å¤§åŠŸå‘Šæˆäº†</strong></p><p><img src="https://img-blog.csdnimg.cn/1b053bd5569c41b7b11caeba75037c7d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†"><a href="#ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†" class="headerlink" title="ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†"></a>ä¸‰ã€ç¡¬ä»¶è¿çº¿éƒ¨åˆ†</h2><p>CH340 â†” STM32F103C8T6æœ€å°ç³»ç»Ÿæ¿ï¼š<br>TX â†” RX<br>RX â†” TX</p><p>DAP-LINK â†” STM32F103C8T6æœ€å°ç³»ç»Ÿæ¿<br>3.3V â†” VCC<br>GND â†” GND<br>SWIO â†” SWIO<br>SWCLK â†” SWCLK</p><p>HC-SR501æ¨¡å— â†” STM32F103C8T6æœ€å°ç³»ç»Ÿæ¿<br>OUT â†” PA1<br>GND â†” GND</p><p>HC-SR501æ¨¡å— â†” DAP-LINK <strong>ï¼ˆè¿™é‡Œæ³¨æ„æ¨¡å—ä¾›ç”µèŒƒå›´ä¸º4.5V-20Vï¼Œç”¨3.3Væ— æ³•é©±åŠ¨ï¼‰</strong><br>VCC â†” 5V</p><p>HC-SR04æ¨¡å— â†” CH340<br>VCC â†” 5V</p><p>HC-SR04æ¨¡å— â†” STM32F103C8T6æœ€å°ç³»ç»Ÿæ¿<br>Trig â†” PB4<br>Echo â†” PB5<br>GND â†” GND</p><h2 id="å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†"><a href="#å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†" class="headerlink" title="å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†"></a>å››ã€é€»è¾‘ä»£ç éƒ¨åˆ†</h2><p>ä»£ç æ¡†æ¶æ˜¯åŸºäºä¸Šä¸€ç¯‡HC-SR501çº¢å¤–äººä½“æ„Ÿåº”æ¨¡å—ä¿®æ”¹è€Œæˆçš„ï¼Œæƒ³è¦å®Œæ•´ä»£ç çš„è¯å¯ä»¥å’Œä¸Šç¯‡æ–‡ç« ä¸€èµ·çœ‹ã€‚</p><h3 id="HC-SR04-c"><a href="#HC-SR04-c" class="headerlink" title="HC_SR04.c"></a>HC_SR04.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;HC_SR04.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f1xx_hal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stm32f1xx_it.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">float</span> distance_result;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_us</span><span class="params">(<span class="type">uint16_t</span> time)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint16_t</span> a1=TIM2-&gt;CNT;</span><br><span class="line"><span class="keyword">while</span>(TIM2-&gt;CNT-a1&lt;time);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HC_SR04_startrange</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_WritePin(HC_SR04_Trig_GPIO_Port,HC_SR04_Trig_Pin,GPIO_PIN_SET);</span><br><span class="line"></span><br><span class="line">Delay_us(<span class="number">10</span>);</span><br><span class="line">HAL_GPIO_WritePin(HC_SR04_Trig_GPIO_Port,HC_SR04_Trig_Pin,GPIO_PIN_RESET);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">HC_SR04_gettime</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint32_t</span> a;</span><br><span class="line">a=TIM2-&gt;CNT;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">HC_SR04_getdistance</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">uint16_t</span> time_node1;</span><br><span class="line"> <span class="type">uint16_t</span> time_node2;</span><br><span class="line">  <span class="type">uint16_t</span> measure;</span><br><span class="line"></span><br><span class="line">  HC_SR04_startrange();</span><br><span class="line"></span><br><span class="line">TIM2-&gt;CNT = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(HAL_GPIO_ReadPin(HC_SR04_Echo_GPIO_Port,HC_SR04_Echo_Pin)==RESET);</span><br><span class="line">time_node1=HC_SR04_gettime();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(HAL_GPIO_ReadPin(HC_SR04_Echo_GPIO_Port,HC_SR04_Echo_Pin)==SET);</span><br><span class="line">time_node2=HC_SR04_gettime();</span><br><span class="line"></span><br><span class="line">measure=time_node2-time_node1;</span><br><span class="line"></span><br><span class="line">distance_result = measure * <span class="number">17.0</span>/<span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> distance_result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HC-SR04-h"><a href="#HC-SR04-h" class="headerlink" title="HC_SR04.h"></a>HC_SR04.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _HC_SR04_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _HC_SR04_H_</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Delay_us</span><span class="params">(<span class="type">uint16_t</span> time)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">HC_SR04_startrange</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">float</span> <span class="title function_">HC_SR04_getdistance</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">HC_SR04_gettime</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_TIM_Base_Start_IT(&amp;htim2);</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_1) == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">HC_SR04_distance=HC_SR04_getdistance();</span><br><span class="line">HAL_GPIO_WritePin(GPIOC,GPIO_PIN_13,GPIO_PIN_RESET);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;æœ‰äºº,ç›®å‰è·ç¦»ä¸ºï¼š%.2f cm\r\n&quot;</span>,HC_SR04_distance);</span><br><span class="line">HAL_Delay(<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">HAL_GPIO_WritePin(GPIOC,GPIO_PIN_13,GPIO_PIN_SET);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;æ²¡äºº\r\n&quot;</span>);</span><br><span class="line">HAL_Delay(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç°è±¡ï¼š</strong></p><p>æ„Ÿåº”åˆ°äººä½“ï¼Œæ¿è½½LEDç»¿ç¯äº®ï¼ŒåŒæ—¶ä¸²å£æ‰“å°æµ‹è·ç»“æœã€‚<br><img src="https://img-blog.csdnimg.cn/fdf542a1e5f54fb497c66664fcf7880e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><strong>æ³¨æ„ï¼š</strong><br><strong>é‡å®šä¹‰printfåï¼Œå¿…é¡»åœ¨targeté‡Œé¢å‹¾é€‰ä¸ŠMicroLIBï¼Œè°ƒç”¨ä¸€ä¸‹è¿™ä¸ªå¾®å‹åº“ï¼Œä¸ç„¶ä¸€ç›´å¡åœ¨é‡Œé¢ã€‚</strong></p><p><img src="https://img-blog.csdnimg.cn/bba9468e9009467abfafc8111b94ac0d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6YGX5b-Y5Li2,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>å‚è€ƒåšå®¢ï¼š<br><a href="https://blog.csdn.net/sasasatori/article/details/81199455">stm32f1é©±åŠ¨HC-SR04è¶…å£°æ³¢æµ‹è·æ¨¡å—</a></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºSTM32çš„HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—é©±åŠ¨ä¸åº”ç”¨</title>
      <link href="/2024/03/stm32-stm32-%E5%9F%BA%E4%BA%8ESTM32%E7%9A%84HC-SR501%E7%BA%A2%E5%A4%96%E6%84%9F%E5%BA%94%E6%A8%A1%E5%9D%97%E9%A9%B1%E5%8A%A8%E4%B8%8E%E5%BA%94%E7%94%A8/"/>
      <url>/2024/03/stm32-stm32-%E5%9F%BA%E4%BA%8ESTM32%E7%9A%84HC-SR501%E7%BA%A2%E5%A4%96%E6%84%9F%E5%BA%94%E6%A8%A1%E5%9D%97%E9%A9%B1%E5%8A%A8%E4%B8%8E%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><strong>ä¸€ã€ ç®€ä»‹<br>HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—æ˜¯ä¸€ç§å¸¸ç”¨çš„äººä½“çº¢å¤–æ„Ÿåº”æ¨¡å—ï¼Œå¸¸ç”¨äºå®‰é˜²ç›‘æ§ã€æ™ºèƒ½å®¶å±…ç­‰é¢†åŸŸã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨STM32å•ç‰‡æœºä¸Šé©±åŠ¨å’Œåº”ç”¨HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—ï¼Œå®ç°åŸºæœ¬çš„äººä½“æ£€æµ‹åŠŸèƒ½ã€‚</strong></p><p><strong>äºŒã€ æ¨¡å—åŸç†</strong><br>HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—åŸºäºçº¢å¤–çƒ­é‡Šç”µä¼ æ„Ÿå™¨ï¼ˆPIR sensorï¼‰åŸç†ï¼Œå½“æ£€æµ‹åˆ°äººä½“æˆ–å…¶ä»–çƒ­æºæ—¶ï¼Œè¾“å‡ºé«˜ç”µå¹³ä¿¡å·ã€‚è¯¥æ¨¡å—æœ‰å»¶è¿Ÿæ—¶é—´å’Œé‡å¤è§¦å‘æ—¶é—´ä¸¤ä¸ªå¯è°ƒèŠ‚çš„èºæ—‹è°ƒèŠ‚å™¨ï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒèŠ‚æ¨¡å—çš„çµæ•åº¦å’Œè§¦å‘åçš„è¾“å‡ºä¿¡å·æ—¶é•¿ã€‚</p><p><strong>ä¸‰ã€ è¿æ¥ä¸é©±åŠ¨<br>1. è¿æ¥</strong><br>è¿æ¥HC-SR501æ¨¡å—è‡³STM32å•ç‰‡æœºï¼Œå°†æ¨¡å—çš„OUTå¼•è„šè¿æ¥è‡³STM32çš„GPIOå¼•è„šï¼Œä»¥æ¥æ”¶æ„Ÿåº”æ¨¡å—çš„è¾“å‡ºä¿¡å·ã€‚åŒæ—¶ï¼Œé€šè¿‡ç”µæºæ¨¡å—è¿æ¥æ¨¡å—è‡³å•ç‰‡æœºçš„ä¾›ç”µå¼•è„šã€‚</p><p><img src="https://img-blog.csdnimg.cn/direct/12a9a768aaa04891b1c9bfc0d758aae5.png"></p><p><strong>2. é©±åŠ¨</strong><br>åœ¨STM32çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œç¼–å†™å¯¹HC-SR501æ¨¡å—çš„é©±åŠ¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">```c</span><br><span class="line">#include &quot;stm32f4xx.h&quot;</span><br><span class="line"></span><br><span class="line">#define HC_SR501_PIN GPIO_PIN_0</span><br><span class="line">#define HC_SR501_PORT GPIOA</span><br><span class="line"></span><br><span class="line">void HC_SR501_Init(void) &#123;</span><br><span class="line">&amp;#xA0; GPIO_InitTypeDef GPIO_InitStruct;</span><br><span class="line"></span><br><span class="line">&amp;#xA0; __HAL_RCC_GPIOA_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">&amp;#xA0; GPIO_InitStruct.Pin = HC_SR501_PIN;</span><br><span class="line">&amp;#xA0; GPIO_InitStruct.Mode = GPIO_MODE_INPUT;</span><br><span class="line">&amp;#xA0; GPIO_InitStruct.Pull = GPIO_NOPULL;</span><br><span class="line">&amp;#xA0; HAL_GPIO_Init(HC_SR501_PORT, &amp;GPIO_InitStruct);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int HC_SR501_Read(void) &#123;</span><br><span class="line">&amp;#xA0; return HAL_GPIO_ReadPin(HC_SR501_PORT, HC_SR501_PIN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void HC_SR501_Application(void) &#123;</span><br><span class="line">&amp;#xA0; while (1) &#123;</span><br><span class="line">&amp;#xA0; &amp;#xA0; if (HC_SR501_Read()) &#123;</span><br><span class="line">&amp;#xA0; &amp;#xA0; &amp;#xA0; // &amp;#x68C0;&amp;#x6D4B;&amp;#x5230;&amp;#x4EBA;&amp;#x4F53;&amp;#xFF0C;&amp;#x6267;&amp;#x884C;&amp;#x76F8;&amp;#x5E94;&amp;#x64CD;&amp;#x4F5C;</span><br><span class="line">&amp;#xA0; &amp;#xA0; &#125; else &#123;</span><br><span class="line">&amp;#xA0; &amp;#xA0; &amp;#xA0; // &amp;#x672A;&amp;#x68C0;&amp;#x6D4B;&amp;#x5230;&amp;#x4EBA;&amp;#x4F53;&amp;#xFF0C;&amp;#x6267;&amp;#x884C;&amp;#x76F8;&amp;#x5E94;&amp;#x64CD;&amp;#x4F5C;</span><br><span class="line">&amp;#xA0; &amp;#xA0; &#125;</span><br><span class="line">&amp;#xA0; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void) &#123;</span><br><span class="line">&amp;#xA0; HC_SR501_Init();</span><br><span class="line">&amp;#xA0; HC_SR501_Application();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>ä»¥ä¸Šä»£ç ä¸­ï¼Œé¦–å…ˆåˆå§‹åŒ–äº†GPIOå¼•è„šï¼Œç„¶ååœ¨åº”ç”¨å‡½æ•°ä¸­ä¸æ–­è¯»å–æ„Ÿåº”æ¨¡å—çš„è¾“å‡ºä¿¡å·ï¼Œæ ¹æ®è¾“å‡ºä¿¡å·æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚**å››ã€ åº”ç”¨ç¤ºä¾‹&lt;br&gt;1. åŸºäºHC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—çš„äººä½“æ£€æµ‹æŠ¥è­¦ç³»ç»Ÿ**é€šè¿‡è¿æ¥HC-SR501æ¨¡å—è‡³STM32å•ç‰‡æœºï¼Œå¹¶é…åˆèœ‚é¸£å™¨æˆ–å…¶ä»–æŠ¥è­¦è£…ç½®ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„äººä½“æ£€æµ‹æŠ¥è­¦ç³»ç»Ÿã€‚å½“æ£€æµ‹åˆ°äººä½“æ—¶ï¼Œç³»ç»Ÿè§¦å‘æŠ¥è­¦è£…ç½®ï¼Œå®ç°å®‰é˜²ç›‘æ§ã€‚**2. åŸºäºHC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—çš„æ™ºèƒ½ç…§æ˜æ§åˆ¶ç³»ç»Ÿ**å°†HC-SR501æ¨¡å—è¿æ¥è‡³STM32å•ç‰‡æœºï¼Œå†è¿æ¥è‡³LEDç¯æˆ–å…¶ä»–ç…§æ˜è®¾å¤‡ï¼Œå¯ä»¥å®ç°æ™ºèƒ½ç…§æ˜æ§åˆ¶ç³»ç»Ÿã€‚å½“æ£€æµ‹åˆ°äººä½“æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å¼€å¯ç…§æ˜è®¾å¤‡ï¼Œå½“æœªæ£€æµ‹åˆ°äººä½“æ—¶åˆ™å…³é—­ç…§æ˜è®¾å¤‡ï¼Œå®ç°æ™ºèƒ½èŠ‚èƒ½æ§åˆ¶ã€‚**ä»¥ä¸Šæ˜¯åŸºäºSTM32çš„HC-SR501çº¢å¤–æ„Ÿåº”æ¨¡å—çš„é©±åŠ¨ä¸åº”ç”¨çš„åŸºæœ¬ä»‹ç»ï¼Œé€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯ä»¥å®ç°é’ˆå¯¹ä¸åŒåœºæ™¯çš„äººä½“æ„Ÿåº”æ§åˆ¶ç³»ç»Ÿã€‚**&gt; âœ…ä½œè€…ç®€ä»‹ï¼šçƒ­çˆ±ç§‘ç ”çš„åµŒå…¥å¼å¼€å‘è€…ï¼Œä¿®å¿ƒå’ŒæŠ€æœ¯åŒæ­¥ç²¾è¿›ä»£ç è·å–ã€é—®é¢˜æ¢è®¨åŠæ–‡ç« è½¬è½½å¯ç§ä¿¡ã€‚â˜ æ„¿ä½ çš„ç”Ÿå‘½ä¸­æœ‰å¤Ÿå¤šçš„äº‘ç¿³,æ¥é€ å°±ä¸€ä¸ªç¾ä¸½çš„é»„æ˜ã€‚ğŸè·å–æ›´å¤šåµŒå…¥å¼èµ„æ–™å¯ç‚¹å‡»é“¾æ¥è¿›ç¾¤é¢†å–ï¼Œè°¢è°¢æ”¯æŒï¼ğŸ‘‡[ç‚¹å‡»é¢†å–æ›´å¤šè¯¦ç»†èµ„æ–™](https://fss.mpay8.cn/article/dmrjinh2C6fjejm &quot;ç‚¹å‡»é¢†å–æ›´å¤šè¯¦ç»†èµ„æ–™&quot;)</code></pre>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰‹æŠŠæ‰‹æ•™ä½ ï¼Œé€šè¿‡HALåº“å®ç°STM32çš„è¶…å£°æ³¢æµ‹è·--ä»¥SR-04ä¸ºä¾‹</title>
      <link href="/2024/03/stm32-stm32-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%EF%BC%8C%E9%80%9A%E8%BF%87HAL%E5%BA%93%E5%AE%9E%E7%8E%B0STM32%E7%9A%84%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D-%E4%BB%A5SR-04%E4%B8%BA%E4%BE%8B/"/>
      <url>/2024/03/stm32-stm32-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%EF%BC%8C%E9%80%9A%E8%BF%87HAL%E5%BA%93%E5%AE%9E%E7%8E%B0STM32%E7%9A%84%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D-%E4%BB%A5SR-04%E4%B8%BA%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><strong>ç›®å½•</strong></p><p><a href="#0%E3%80%81sr-04%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86" title="0ã€SR-04åŸºæœ¬åŸç†">0ã€SR-04åŸºæœ¬åŸç†</a></p><p><a href="#1%E3%80%81%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" title="1ã€å‡†å¤‡å·¥ä½œ">1ã€å‡†å¤‡å·¥ä½œ</a></p><p><a href="#2%E3%80%81%E8%BF%9E%E7%BA%BF" title="2ã€è¿çº¿">2ã€è¿çº¿</a></p><p><a href="#%C2%A03%E3%80%81stm32cubemx%E8%AE%BE%E7%BD%AE" title="3ã€STM32CUBEMXè®¾ç½®">3ã€STM32CUBEMXè®¾ç½®</a></p><p><a href="#31%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B" title="3.1æ–°å»ºå·¥ç¨‹">3.1æ–°å»ºå·¥ç¨‹</a></p><p><a href="#32%E8%8A%AF%E7%89%87%E9%80%9A%E7%94%A8%E8%AE%BE%E7%BD%AE" title="3.2èŠ¯ç‰‡é€šç”¨è®¾ç½®">3.2èŠ¯ç‰‡é€šç”¨è®¾ç½®</a></p><p><a href="#33%E5%AE%9A%E6%97%B6%E5%99%A8%E6%8D%95%E8%8E%B7%E8%AE%BE%E7%BD%AE" title="3.3å®šæ—¶å™¨æ•è·è®¾ç½®">3.3å®šæ—¶å™¨æ•è·è®¾ç½®</a></p><p><a href="#%E2%80%8B34%E5%85%B6%E4%BB%96%E8%AE%BE%E7%BD%AE" title="â€‹3.4å…¶ä»–è®¾ç½®">â€‹3.4å…¶ä»–è®¾ç½®</a></p><p><a href="#35%E7%94%9F%E6%88%90%E5%B7%A5%E7%A8%8B" title="3.5ç”Ÿæˆå·¥ç¨‹">3.5ç”Ÿæˆå·¥ç¨‹</a></p><p><a href="#%C2%A04%E3%80%81%E7%A8%8B%E5%BA%8F%E5%AE%8C%E5%96%84" title="4ã€ç¨‹åºå®Œå–„">4ã€ç¨‹åºå®Œå–„</a></p><p><a href="#41%E5%AE%8C%E5%96%84%E6%89%93%E5%8D%B0%E8%BE%93%E5%87%BA%E5%87%BD%E6%95%B0" title="4.1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°">4.1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°</a></p><p><a href="#%C2%A042%E5%AE%8C%E5%96%84timc" title="4.2å®Œå–„tim.c">4.2å®Œå–„tim.c</a></p><p><a href="#43%E5%AE%8C%E5%96%84gpioc%C2%A0" title="4.3å®Œå–„gpio.c">4.3å®Œå–„gpio.c</a></p><p><a href="#44%E5%AE%8C%E5%96%84main%E5%87%BD%E6%95%B0%C2%A0" title="4.4å®Œå–„mainå‡½æ•°">4.4å®Œå–„mainå‡½æ•°</a></p><p><a href="#%C2%A05%E3%80%81%E6%80%BB%E7%BB%93" title="5ã€æ€»ç»“">5ã€æ€»ç»“</a></p><h2 id="0ã€SR-04åŸºæœ¬åŸç†"><a href="#0ã€SR-04åŸºæœ¬åŸç†" class="headerlink" title="0ã€SR-04åŸºæœ¬åŸç†"></a>0ã€SR-04åŸºæœ¬åŸç†</h2><p>å£°æ³¢é‡åˆ°éšœç¢ç‰©ä¼šåå°„ï¼Œè€Œå£°æ³¢çš„é€Ÿåº¦å·²çŸ¥ï¼Œæ‰€ä»¥åªéœ€è¦çŸ¥é“å‘å°„åˆ°æ¥æ”¶çš„æ—¶é—´å·®ï¼Œå°±èƒ½è½»æ¾è®¡ç®—å‡ºæµ‹é‡è·ç¦»ï¼Œå†ç»“åˆå‘å°„å™¨å’Œæ¥æ”¶å™¨çš„è·ç¦»ï¼Œå°±èƒ½ç®—å‡ºéšœç¢ç‰©çš„å®é™…è·ç¦»ã€‚</p><p><img src="https://img-blog.csdnimg.cn/2020032802343260.png"></p><p><img src="https://img-blog.csdnimg.cn/20200328023701292.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyMjU4OTgx,size_16,color_FFFFFF,t_70"></p><p>ä»¥HC-SR04ç¡¬ä»¶ä¸ºä¾‹ï¼Œç«¯å£ä¸ºVCCã€Trigã€Echoã€GNDã€‚</p><p>VCCâ€“æ¥STM32æ¿å­+5Vï¼›<br>GNDâ€“æ¥STM32æ¿å­GNDï¼›<br>Trigâ€“ä¸ºè§¦å‘æ§åˆ¶ä¿¡å·è¾“å…¥ï¼Œè§¦å‘æµ‹è·ï¼Œç»™è‡³å°‘10usçš„é«˜ç”µå¹³ä¿¡å·ï¼Œæ¨¡å—è‡ªåŠ¨å‘å°„8ä¸ª40KHzçš„æ–¹æ³¢ï¼Œè‡ªåŠ¨æ£€æµ‹æ˜¯å¦æœ‰ä¿¡å·è¿”å›ï¼›<br>Echoâ€“å›å“ä¿¡å·è¾“å‡ºï¼Œæœ‰ä¿¡å·è¿”å›ï¼Œé€šè¿‡IOå£ECHOè¾“å‡ºä¸€ä¸ªé«˜ç”µå¹³ï¼Œé«˜ç”µå¹³æŒç»­æ—¶é—´å°±æ˜¯è¶…å£°æ³¢ä»å‘å°„åˆ°è¿”å›çš„æ—¶é—´ã€‚<br>é‚£ç”¨STM32æ€ä¹ˆç»™ç«¯å£ä¿¡å·å‘¢ï¼Ÿåˆæ˜¯æ€ä¹ˆè·å–ä¿¡å·å‘¢ï¼Ÿ<br>Trigç«¯å£ä¸ºè¶…å£°æ³¢æ¨¡å—çš„è¾“å…¥ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡STM23ä¸€ä¸ªç«¯å£æ¨æŒ½è¾“å‡ºä¸€ä¸ªè‡³å°‘10usçš„é«˜ç”µå¹³ä¿¡å·å³å¯ï¼Œåˆ©ç”¨delay_ms(20)å®ç°ï¼›<br>Echoç«¯å£ä¸ºè¶…å£°æ³¢æ¨¡å—çš„è¾“å‡ºä¿¡å·ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨STM32ç«¯å£æ•è·é«˜ç”µå¹³æ—¶é—´ï¼Œé‚£ä¹ˆè¿™ä¸ªç«¯å£è‚¯å®šæ˜¯å¯ä»¥ç”¨åšå®šæ—¶å™¨çš„ç«¯å£ã€‚<br>é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œè¿™é‡Œé‡‡ç”¨ä»¥ä¸‹STM32ç«¯å£</p><p><img src="https://img-blog.csdnimg.cn/c10df4b58e2d49cb8b3b363c0e22019c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><img src="https://img-blog.csdnimg.cn/3b14aae863264dd4afbc8445ad66a7d9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="1ã€å‡†å¤‡å·¥ä½œ"><a href="#1ã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="1ã€å‡†å¤‡å·¥ä½œ"></a>1ã€å‡†å¤‡å·¥ä½œ</h2><p>å¼€å‘æ¿ï¼šSTM32F1ç²¾è‹±ç‰ˆ</p><p>è½¯ä»¶ï¼šSTM32CubeMxè½¯ä»¶</p><p>IDEï¼š MDK-Keilè½¯ä»¶</p><p>ä¼ æ„Ÿå™¨ï¼šHC-SR04</p><h2 id="2ã€è¿çº¿"><a href="#2ã€è¿çº¿" class="headerlink" title="2ã€è¿çº¿"></a>2ã€è¿çº¿</h2><p>é€‰æ‹©TIM5çš„CH1å³PA0ä½œä¸ºè¾“å…¥æ•è·å¼•è„šï¼ˆEchoï¼‰ï¼Œé€‰æ‹©PA5ä½œä¸ºè§¦å‘è„šTrigã€‚å…·ä½“è¿æ¥çº¿å¦‚ä¸‹ï¼š</p><p>çº¢çº¿è¿æ¥ç²¾è‹±ç‰ˆçš„5Vä¸SR04çš„VCCè„š</p><p>ç™½çº¿è¿æ¥ç²¾è‹±æ¿çš„GNDä¸SR04çš„GNDè„š</p><p>æ©™è‰²çº¿è¿æ¥ç²¾è‹±æ¿çš„PA5ä¸Trigè„š</p><p>é»‘è‰²çº¿è¿æ¥ç²¾è‹±æ¿çš„PA0ä¸Echoè„š</p><p><img src="https://img-blog.csdnimg.cn/2e1fa4f5325345729a0a44473dfd2526.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="3ã€STM32CUBEMXè®¾ç½®"><a href="#3ã€STM32CUBEMXè®¾ç½®" class="headerlink" title="3ã€STM32CUBEMXè®¾ç½®"></a>3ã€STM32CUBEMXè®¾ç½®</h2><h3 id="3-1æ–°å»ºå·¥ç¨‹"><a href="#3-1æ–°å»ºå·¥ç¨‹" class="headerlink" title="3.1æ–°å»ºå·¥ç¨‹"></a>3.1æ–°å»ºå·¥ç¨‹</h3><p>1ï¼‰æ–°å»ºå·¥ç¨‹</p><p><img src="https://img-blog.csdnimg.cn/7115721af4f7487fae5b0ff66f45667d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>2ï¼‰é€‰æ‹©èŠ¯ç‰‡</p><p><img src="https://img-blog.csdnimg.cn/9cecc36eced643b185e29591bbe60cf0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h3 id="3-2èŠ¯ç‰‡é€šç”¨è®¾ç½®"><a href="#3-2èŠ¯ç‰‡é€šç”¨è®¾ç½®" class="headerlink" title="3.2èŠ¯ç‰‡é€šç”¨è®¾ç½®"></a>3.2èŠ¯ç‰‡é€šç”¨è®¾ç½®</h3><p>1ï¼‰æ—¶é’ŸèŠ¯ç‰‡è®¾ç½®</p><p><img src="https://img-blog.csdnimg.cn/e262e3fba4f8447ab4c8c567225173a5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>2ï¼‰æ—¶é’Ÿè®¾ç½®</p><p><img src="https://img-blog.csdnimg.cn/abb1957bcbce4521af21421c25464c77.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>3ï¼‰ç³»ç»Ÿè°ƒè¯•è®¾ç½®</p><p><img src="https://img-blog.csdnimg.cn/ed518ef9e29c4359bd52a2ca81e8823e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h3 id="3-3å®šæ—¶å™¨æ•è·è®¾ç½®"><a href="#3-3å®šæ—¶å™¨æ•è·è®¾ç½®" class="headerlink" title="3.3å®šæ—¶å™¨æ•è·è®¾ç½®"></a>3.3å®šæ—¶å™¨æ•è·è®¾ç½®</h3><p>ç”±äºå‰æ–‡è¿çº¿ä¸­ï¼Œæˆ‘ä»¬å°†TIMER5CH1ä½œä¸ºè¾“å…¥æ•è·å¼•è„šï¼Œæ‰€ä»¥å¯¹TIMER5è¿›è¡Œè®¾ç½®ï¼š</p><p>Channel 1é€‰æ‹©ï¼šInput Capture direct mode</p><p>ä¸åˆ†é¢‘ç³»æ•°å¡«å†™ï¼š72-1ï¼ˆåˆ™æ¯æ¬¡è®¡æ•°ä¸º1usï¼‰</p><p>Polarity Selectioné€‰æ‹©ï¼šRising Edgeï¼ˆä¸Šå‡æ²¿ï¼‰</p><p>å…¶ä»–ä¿æŒä¸å˜ã€‚</p><p><img src="https://img-blog.csdnimg.cn/c4191f72c63049fdbfb8f8b96f672f66.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>NVIC settingsé€‰æ‹©TIM5 global interrupt</p><h3 id="3-4å…¶ä»–è®¾ç½®"><a href="#3-4å…¶ä»–è®¾ç½®" class="headerlink" title="  3.4å…¶ä»–è®¾ç½®"></a><img src="https://img-blog.csdnimg.cn/d1d24efee88d46178d8001eb1f8eaf61.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16">  3.4å…¶ä»–è®¾ç½®</h3><p>1ï¼‰USART1è®¾ç½®</p><p>ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œå°†æµ‹é‡æ‰€å¾—æ•°æ®é€šè¿‡ä¸²å£ä¼ é€’åˆ°ç”µè„‘ä¸Šè¿›è¡Œæ˜¾ç¤ºï¼Œæ­¤å¤„ä½¿ç”¨ä¸²å£1é€šè¿‡printfå°†è¾“å‡ºå‘é€è‡³ç”µè„‘ã€‚</p><p><img src="https://img-blog.csdnimg.cn/82ca9b0ff3e94cfa8286e7d5573fac1a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>2ï¼‰GPIOé…ç½®</p><p>æ­¤å¤„é€‰æ‹©PA5ä½œä¸ºTrigè„šï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/47ed779ee47641cfb88d1b94d4804ce0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h3 id="3-5ç”Ÿæˆå·¥ç¨‹"><a href="#3-5ç”Ÿæˆå·¥ç¨‹" class="headerlink" title="3.5ç”Ÿæˆå·¥ç¨‹"></a>3.5ç”Ÿæˆå·¥ç¨‹</h3><p><img src="https://img-blog.csdnimg.cn/a6e90e647fe24e5087daa4b099e7da40.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><img src="https://img-blog.csdnimg.cn/46dfa628b984462d95dc70b4a37152c0.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h2 id="4ã€ç¨‹åºå®Œå–„"><a href="#4ã€ç¨‹åºå®Œå–„" class="headerlink" title="4ã€ç¨‹åºå®Œå–„"></a>4ã€ç¨‹åºå®Œå–„</h2><h3 id="4-1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°"><a href="#4-1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°" class="headerlink" title="4.1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°"></a>4.1å®Œå–„æ‰“å°è¾“å‡ºå‡½æ•°</h3><p>åœ¨mainå‡½æ•°ä¸­åŠ å…¥ä¸‹é¢è¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/* Private includes ----------------------------------------------------------*/</span><br><span class="line">/* USER CODE BEGIN Includes */</span><br><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line">#include &quot;string.h&quot;</span><br><span class="line">/* USER CODE END Includes */</span><br><span class="line"></span><br><span class="line">/* Private user code ---------------------------------------------------------*/</span><br><span class="line">/* USER CODE BEGIN 0 */</span><br><span class="line">#ifdef __GNUC__</span><br><span class="line">#define PUTCHAR_PROTOTYPE int __io_putchar(int ch)</span><br><span class="line">#else</span><br><span class="line">#define PUTCHAR_PROTOTYPE int fputc(int ch, FILE *f)</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">PUTCHAR_PROTOTYPE</span><br><span class="line">&#123;</span><br><span class="line">HAL_UART_Transmit(&amp;huart1, (uint8_t *)&amp;ch, 1, 0xFFFF);</span><br><span class="line">return ch;</span><br><span class="line">&#125;</span><br><span class="line">/* USER CODE END 0 */</span><br></pre></td></tr></table></figure><p>åŠ å…¥æ­¤è¯­å¥ä¹‹åå¯ä»¥åœ¨mainå‡½æ•°ä¸­åŠ å…¥printfè¯­å¥æµ‹è¯•æ˜¯å¦æˆåŠŸã€‚</p><p>å°†ç²¾è‹±æ¿USB232å£é€šè¿‡USBæ•°æ®çº¿ä¸ç”µè„‘è¿æ¥ï¼Œå¹¶åœ¨ç”µè„‘ä¸Šæ‰“å¼€ä¸²å£è°ƒè¯•è½¯ä»¶ï¼š <img src="https://img-blog.csdnimg.cn/a79a767a9dfa4baeb621c05235cbc92b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p><img src="https://img-blog.csdnimg.cn/d27a80b3c0fa4d30999384ca8c8a46d7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p><h3 id="4-2å®Œå–„tim-c"><a href="#4-2å®Œå–„tim-c" class="headerlink" title="4.2å®Œå–„tim.c"></a>4.2å®Œå–„tim.c</h3><p>åœ¨tim.cä¸­åŠ å…¥ä»¥ä¸‹ç¨‹åºï¼š</p><p>å®šä¹‰å˜é‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/* USER CODE BEGIN 0 */</span><br><span class="line">//&amp;#x6355;&amp;#x83B7;&amp;#x72B6;&amp;#x6001;</span><br><span class="line">//[7]:0,&amp;#x6CA1;&amp;#x6709;&amp;#x6210;&amp;#x529F;&amp;#x7684;&amp;#x6355;&amp;#x83B7;;1,&amp;#x6210;&amp;#x529F;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x6B21;.</span><br><span class="line"></span><br><span class="line">//[6]:0,&amp;#x8FD8;&amp;#x6CA1;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4F4E;&amp;#x7535;&amp;#x5E73;;1,&amp;#x5DF2;&amp;#x7ECF;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4F4E;&amp;#x7535;&amp;#x5E73;&amp;#x4E86;.</span><br><span class="line"></span><br><span class="line">//[5:0]:&amp;#x6355;&amp;#x83B7;&amp;#x4F4E;&amp;#x7535;&amp;#x5E73;&amp;#x540E;&amp;#x6EA2;&amp;#x51FA;&amp;#x7684;&amp;#x6B21;&amp;#x6570;</span><br><span class="line">uint8_t  TIM5CH2_CAPTURE_STA=0;//&amp;#x8F93;&amp;#x5165;&amp;#x6355;&amp;#x83B7;&amp;#x72B6;&amp;#x6001;</span><br><span class="line">uint16_t TIM5CH2_CAPTURE_VAL;//&amp;#x8F93;&amp;#x5165;&amp;#x6355;&amp;#x83B7;&amp;#x503C;(TIM2&amp;#x662F;16&amp;#x4F4D;)</span><br><span class="line">/* USER CODE END 0 */</span><br></pre></td></tr></table></figure><p>åœ¨åº•éƒ¨åŠ å…¥æº¢å‡ºå›è°ƒå‡½æ•°å’Œè¾“å…¥æ•è·å›è°ƒå‡½æ•°ã€‚å…¶ä¸­å‚è€ƒäº†æ­£ç‚¹åŸå­å®˜æ–¹çš„çš„è¾“å…¥ æ•è·å›è°ƒå‡½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">/* USER CODE BEGIN 1 */</span><br><span class="line">void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)//&amp;#x66F4;&amp;#x65B0;&amp;#x4E2D;&amp;#x65AD;&amp;#xFF08;&amp;#x6EA2;&amp;#x51FA;&amp;#xFF09;&amp;#x53D1;&amp;#x751F;&amp;#x65F6;&amp;#x6267;&amp;#x884C;</span><br><span class="line">&#123;</span><br><span class="line">if((TIM5CH2_CAPTURE_STA&amp;0X80) ==0)//&amp;#x8FD8;&amp;#x672A;&amp;#x6355;&amp;#x83B7;&amp;#x6210;&amp;#x529F;</span><br><span class="line">&#123;</span><br><span class="line">if(TIM5CH2_CAPTURE_STA&amp;0X40)//&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E0B;&amp;#x964D;&amp;#x6CBF;</span><br><span class="line">&#123;</span><br><span class="line">if((TIM5CH2_CAPTURE_STA&amp;0X3F)==0X3F)//&amp;#x9AD8;&amp;#x7535;&amp;#x5E73;&amp;#x65F6;&amp;#x95F4;&amp;#x592A;&amp;#x957F;&amp;#x4E86;</span><br><span class="line">&#123;</span><br><span class="line">TIM5CH2_CAPTURE_STA |= 0X80;//&amp;#x6807;&amp;#x8BB0;&amp;#x6210;&amp;#x529F;&amp;#x6355;&amp;#x83B7;&amp;#x4E00;&amp;#x6B21;</span><br><span class="line">TIM5CH2_CAPTURE_VAL = 0XFFFF;//</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">TIM5CH2_CAPTURE_STA++;//&amp;#x5426;&amp;#x5219;&amp;#x6807;&amp;#x8BB0;&amp;#x6EA2;&amp;#x51FA;&amp;#x6570;&amp;#x52A0;&amp;#x4E00;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void HAL_TIM_IC_CaptureCallback(TIM_HandleTypeDef *htim)//&amp;#x6355;&amp;#x83B7;&amp;#x4E2D;&amp;#x65AD;&amp;#x53D1;&amp;#x751F;&amp;#x65F6;&amp;#x6267;&amp;#x884C;</span><br><span class="line">&#123;</span><br><span class="line">if((TIM5CH2_CAPTURE_STA&amp;0x80)==0)//&amp;#x8FD8;&amp;#x672A;&amp;#x6355;&amp;#x83B7;&amp;#x6210;&amp;#x529F;</span><br><span class="line">&#123;</span><br><span class="line">if(TIM5CH2_CAPTURE_STA&amp;0x40)//&amp;#x6210;&amp;#x529F;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E0B;&amp;#x964D;&amp;#x6CBF;</span><br><span class="line">&#123;</span><br><span class="line">TIM5CH2_CAPTURE_STA |= 0X80;//&amp;#x6807;&amp;#x8BB0;&amp;#x6210;&amp;#x529F;&amp;#xFF0C;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x6B21;&amp;#x9AD8;&amp;#x7535;&amp;#x5E73;&amp;#x5B8C;&amp;#x6210;</span><br><span class="line">TIM5CH2_CAPTURE_VAL  = HAL_TIM_ReadCapturedValue(&amp;htim5, TIM_CHANNEL_1);//&amp;#x83B7;&amp;#x53D6;&amp;#x5F53;&amp;#x524D;&amp;#x6355;&amp;#x83B7;&amp;#x503C;</span><br><span class="line">TIM_RESET_CAPTUREPOLARITY(&amp;htim5, TIM_CHANNEL_1);//&amp;#x6E05;&amp;#x9664;&amp;#x539F;&amp;#x6765;&amp;#x8BBE;&amp;#x7F6E;</span><br><span class="line">TIM_SET_CAPTUREPOLARITY(&amp;htim5, TIM_CHANNEL_1, TIM_ICPOLARITY_RISING);//&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E0B;&amp;#x964D;&amp;#x6CBF;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x6355;&amp;#x83B7;&amp;#x590D;&amp;#x4F4D;&amp;#x5230;&amp;#x6355;&amp;#x83B7;&amp;#x4E0A;&amp;#x5347;&amp;#x6CBF;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">else//&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E0A;&amp;#x5347;&amp;#x6CBF;</span><br><span class="line">&#123;</span><br><span class="line">TIM5CH2_CAPTURE_STA = 0;</span><br><span class="line">TIM5CH2_CAPTURE_VAL = 0;</span><br><span class="line">TIM5CH2_CAPTURE_STA |= 0x40;//&amp;#x7B2C;&amp;#x516D;&amp;#x4F4D;&amp;#x6807;&amp;#x8BB0;&amp;#x4E3A;&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E0A;&amp;#x5347;&amp;#x6CBF;</span><br><span class="line">__HAL_TIM_DISABLE(&amp;htim5);//&amp;#x5173;&amp;#x95ED;&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;</span><br><span class="line">__HAL_TIM_SET_COUNTER(&amp;htim5, 0);//&amp;#x5B9A;&amp;#x65F6;&amp;#x5668;&amp;#x521D;&amp;#x59CB;&amp;#x503C;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E3A;0</span><br><span class="line">TIM_RESET_CAPTUREPOLARITY(&amp;htim5, TIM_CHANNEL_1);</span><br><span class="line">TIM_SET_CAPTUREPOLARITY(&amp;htim5, TIM_CHANNEL_1, TIM_ICPOLARITY_FALLING);//&amp;#x6355;&amp;#x83B7;&amp;#x5230;&amp;#x4E0A;&amp;#x5347;&amp;#x6CBF;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5C06;&amp;#x6355;&amp;#x83B7;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E3A;&amp;#x4E0B;&amp;#x964D;&amp;#x6CBF;</span><br><span class="line">__HAL_TIM_ENABLE(&amp;htim5);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">/* USER CODE END 1 */</span><br></pre></td></tr></table></figure><h3 id="4-3å®Œå–„gpio-c"><a href="#4-3å®Œå–„gpio-c" class="headerlink" title="4.3å®Œå–„gpio.c"></a>4.3å®Œå–„gpio.c</h3><p>æ¨¡æ‹ŸTrigè„šï¼Œå…ˆç½®ä½ï¼Œè¿‡40usåï¼Œå¤ä½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* USER CODE BEGIN 2 */</span><br><span class="line">void CHL_capture(void)</span><br><span class="line">&#123;</span><br><span class="line">uint32_t i;</span><br><span class="line"></span><br><span class="line">HAL_GPIO_WritePin(TRIG_GPIO_Port, TRIG_Pin, GPIO_PIN_SET);</span><br><span class="line">for(i=0;i&lt;72*40;i++) 2 __nop(); hal_gpio_writepin(trig_gpio_port, trig_pin, gpio_pin_reset); &#125; * user code end &lt;&gt;&lt;/72*40;i++)&gt;</span><br></pre></td></tr></table></figure><h3 id="4-4å®Œå–„mainå‡½æ•°"><a href="#4-4å®Œå–„mainå‡½æ•°" class="headerlink" title="4.4å®Œå–„mainå‡½æ•°"></a>4.4å®Œå–„mainå‡½æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">  /* USER CODE BEGIN 1 */</span><br><span class="line">float len = 0;</span><br><span class="line">uint32_t time= 0;</span><br><span class="line">uint8_t count = 0;</span><br><span class="line">  /* USER CODE END 1 */</span><br><span class="line"></span><br><span class="line">  /* MCU Configuration--------------------------------------------------------*/</span><br><span class="line"></span><br><span class="line">  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span><br><span class="line">  HAL_Init();</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN Init */</span><br><span class="line"></span><br><span class="line">  /* USER CODE END Init */</span><br><span class="line"></span><br><span class="line">  /* Configure the system clock */</span><br><span class="line">  SystemClock_Config();</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN SysInit */</span><br><span class="line"></span><br><span class="line">  /* USER CODE END SysInit */</span><br><span class="line"></span><br><span class="line">  /* Initialize all configured peripherals */</span><br><span class="line">  MX_GPIO_Init();</span><br><span class="line">  MX_TIM5_Init();</span><br><span class="line">  MX_USART1_UART_Init();</span><br><span class="line">  /* USER CODE BEGIN 2 */</span><br><span class="line">printf(&quot;Hello World!\r\n&quot;);</span><br><span class="line">HAL_TIM_IC_Start_IT(&amp;htim5,TIM_CHANNEL_1);   //&amp;#x5F00;&amp;#x542F;TIM2&amp;#x7684;&amp;#x6355;&amp;#x83B7;&amp;#x901A;&amp;#x9053;2&amp;#xFF0C;&amp;#x5E76;&amp;#x4E14;&amp;#x5F00;&amp;#x542F;&amp;#x6355;&amp;#x83B7;&amp;#x4E2D;&amp;#x65AD;</span><br><span class="line">    __HAL_TIM_ENABLE_IT(&amp;htim5,TIM_IT_UPDATE);   //&amp;#x4F7F;&amp;#x80FD;&amp;#x66F4;&amp;#x65B0;&amp;#x4E2D;&amp;#x65AD;</span><br><span class="line"></span><br><span class="line">  /* USER CODE END 2 */</span><br><span class="line"></span><br><span class="line">  /* Infinite loop */</span><br><span class="line">  /* USER CODE BEGIN WHILE */</span><br><span class="line">  while (1)</span><br><span class="line">  &#123;</span><br><span class="line">    /* USER CODE END WHILE */</span><br><span class="line"></span><br><span class="line">    /* USER CODE BEGIN 3 */</span><br><span class="line">  HAL_Delay(100);</span><br><span class="line">  CHL_capture();</span><br><span class="line">  if(TIM5CH2_CAPTURE_STA &amp; 0x80)//&amp;#x6210;&amp;#x529F;&amp;#x6355;&amp;#x83B7;&amp;#x4E00;&amp;#x4E2A;&amp;#x8109;&amp;#x5BBD;</span><br><span class="line">  &#123;</span><br><span class="line">time = TIM5CH2_CAPTURE_STA &amp; 0x3F;//&amp;#x83B7;&amp;#x53D6;&amp;#x6EA2;&amp;#x51FA;&amp;#x6B21;&amp;#x6570;</span><br><span class="line">time *= 65536;//&amp;#x83B7;&amp;#x5F97;&amp;#x6EA2;&amp;#x51FA;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x503C;</span><br><span class="line">time += TIM5CH2_CAPTURE_VAL;//&amp;#x52A0;&amp;#x4E0A;&amp;#x6700;&amp;#x540E;&amp;#x4E00;&amp;#x6B21;&amp;#x53D6;&amp;#x5F97;&amp;#x7684;&amp;#x503C;</span><br><span class="line">len = time * 342.62*100/2000000;</span><br><span class="line"></span><br><span class="line">TIM5CH2_CAPTURE_STA = 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  printf(&quot;LENGTH: %f CM\r\n&quot;, len);</span><br><span class="line">  &#125;</span><br><span class="line">  /* USER CODE END 3 */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h2><p>æœ¬æ–‡ä»‹ç»äº†é€šè¿‡HALåº“å®ŒæˆSR-04è¶…å£°æ³¢ä¼ æ„Ÿå™¨è·ç¦»çš„æµ‹é‡ã€‚åŒ…æ‹¬äº†ï¼Œè¶…å£°æ³¢ä¼ æ„Ÿå™¨çš„åŸç†ã€STM32CUBEMXçš„é…ç½®ï¼Œä»¥åŠç¨‹åºçš„å®Œå–„ã€‚æœ€ç»ˆçš„ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/bdd5e4a431694f4897745b2ebb55fbdd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5rGk5a6q5a6H,size_20,color_FFFFFF,t_70,g_se,x_16"></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32F407ä½¿ç”¨Helixåº“è½¯è§£MP3å¹¶é€šè¿‡DACè¾“å‡ºï¼Œæœ€ç²¾ç®€çš„STM32+SDå¡å®ç°MP3æ’­æ”¾å™¨</title>
      <link href="/2024/03/stm32-STM32F407%E4%BD%BF%E7%94%A8Helix%E5%BA%93%E8%BD%AF%E8%A7%A3MP3%E5%B9%B6%E9%80%9A%E8%BF%87DAC%E8%BE%93%E5%87%BA%EF%BC%8C%E6%9C%80%E7%B2%BE%E7%AE%80%E7%9A%84STM32-SD%E5%8D%A1%E5%AE%9E%E7%8E%B0MP3%E6%92%AD%E6%94%BE%E5%99%A8/"/>
      <url>/2024/03/stm32-STM32F407%E4%BD%BF%E7%94%A8Helix%E5%BA%93%E8%BD%AF%E8%A7%A3MP3%E5%B9%B6%E9%80%9A%E8%BF%87DAC%E8%BE%93%E5%87%BA%EF%BC%8C%E6%9C%80%E7%B2%BE%E7%AE%80%E7%9A%84STM32-SD%E5%8D%A1%E5%AE%9E%E7%8E%B0MP3%E6%92%AD%E6%94%BE%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>åªç”¨STM32å•ç‰‡æœº+SDå¡+è€³æœºæ’åº§ï¼Œå®ç°æ’­æ”¾MP3æ’­æ”¾å™¨ï¼</p><p>çœ‹è¿‡å¾ˆå¤šSTM32è½¯è§£MP3çš„æ–¹æ¡ˆï¼Œå³ä¸é€šè¿‡ç±»ä¼¼VS1053ä¹‹ç±»çš„è§£ç å™¨èŠ¯ç‰‡ï¼Œç›´æ¥ç”¨STM32å’Œè½¯ä»¶åº“è§£ç MP3æ–‡ä»¶ï¼Œé€šå¸¸ä½¿ç”¨äº†labmadæˆ–è€…Helixè§£ç åº“å®ç°ï¼ŒHelixç›¸å¯¹labmadå ç”¨çš„RAMæ›´å°‘ã€‚ä½†æ˜¯å¤§å¤šæ•°å‚è€ƒçš„æ–¹æ¡ˆè¿˜æ˜¯ç”¨äº†å¤–æ¥IISæ¥å£WM98xxä¹‹ç±»çš„éŸ³é¢‘DACèŠ¯ç‰‡æ’­æ”¾éŸ³é¢‘ï¼Œç¨æ˜¾å¤æ‚ç¹çã€‚STM32F407Vxæœ¬èº«å°±è‡ªå¸¦äº†2è·¯12ä½DACè¾“å‡ºï¼Œæœ€é«˜åˆ·æ–°é€Ÿåº¦333kHzï¼Œé™¤äº†åˆ†è¾¨ç‡å·®ç‚¹æ„æ€ï¼Œé€Ÿåº¦ä¸Šå¯¹äºMP3é€šå¸¸44.1kHzé‡‡æ ·ç‡æ¥è¯´ï¼Œç”¨æ¥æ’­æ”¾éŸ³é¢‘ç»°ç»°æœ‰ä½™äº†ã€‚æœ¬æ–‡ç»™çš„æ–¹æ¡ˆå’Œæºç ï¼Œç›´æ¥ç”¨STM32è½¯è§£ç MP3å¹¶ä½¿ç”¨è‡ªå¸¦çš„2ä¸ªDACè¾“å‡ºå¼•è„šè¾“å‡ºéŸ³é¢‘å·¦å³å£°é“ã€‚</p><p>åŸç†ï¼šSTM32ä»SDè¯»å–MP3æ–‡ä»¶åŸå§‹æ•°æ®ï¼Œå‘é€ç»™Helixåº“è§£ç ï¼ŒHelixè§£ç åè¾“å‡ºPCMæ•°æ®æµï¼Œå°†æ­¤æ•°æ®è¿›ä¸€æ­¥å¤„ç†è½¬æ¢åï¼ŒæŒ‰ç…§å·¦å³å£°é“åˆ†åˆ«å­˜å…¥DACè¾“å‡º1å’Œ2ç¼“å­˜ï¼Œé€šè¿‡å®šæ—¶å™¨ä»¥MP3æ–‡ä»¶çš„é‡‡æ ·ç‡çš„é¢‘ç‡æä¾›DACè§¦å‘èŠ‚æ‹ï¼Œé€šè¿‡DMAå–ç¼“å­˜ä¸­é«˜12ä½æ•°æ®ç»™DACï¼Œåœ¨DAC1å’Œ2å¼•è„šäº§ç”ŸéŸ³é¢‘æ³¢å½¢ï¼Œé€šè¿‡ç”µå®¹è€¦åˆåˆ°è€³æœºçš„å·¦å³å£°é“ä¸Šã€‚</p><p>MP3æºæ–‡ä»¶æ˜¯ä¸€ç§ç»è¿‡è‹¥å¹²ç®—æ³•ï¼Œå°†åŸå§‹éŸ³é¢‘æ•°æ®å‹ç¼©å¾—æ¥çš„ï¼Œè½¯ä»¶è§£ç çš„è¿‡ç¨‹æ˜¯é€†è¿‡ç¨‹ï¼Œå°†å‹ç¼©çš„éŸ³é¢‘åå‘è½¬æ¢ä¸ºè®°å½•äº†å·¦å³å£°é“ã€å¹…å€¼çš„æ•°æ®æµï¼Œé€šå¸¸æ˜¯PCMæ ¼å¼ã€‚</p><p>PCMï¼šæ˜¯æ¨¡æ‹Ÿä¿¡å·ä»¥å›ºå®šçš„é‡‡æ ·é¢‘ç‡è½¬æ¢æˆæ•°å­—ä¿¡å·åçš„è¡¨ç°å½¢å¼ã€‚è®°å½•äº†éŸ³é¢‘é‡‡æ ·çš„æ•°æ®ï¼ŒåŒé€šé“ã€16bitçš„PCMæ•°æ®æ ¼å¼æ˜¯ä»¥0è½´ä¸ºä¸­å¿ƒï¼ŒèŒƒå›´ä¸º-32768~32767çš„æ•°å€¼ï¼Œæ¯ä¸ªæ•°æ®å ç”¨2å­—èŠ‚ï¼Œå·¦å£°é“å’Œå³å£°é“äº¤æ›¿å­˜å‚¨ï¼Œå¦‚å›¾ã€‚</p><p><img src="https://img-blog.csdnimg.cn/694e98caa0d54f54939024bb8ccf386e.png"></p><p>è½¯è§£ç å¾—åˆ°çš„PCMæ•°æ®åˆ°STM32çš„DACç¼“å­˜éœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚STM32çš„DACæ˜¯12ä½çš„ï¼Œå…¶è¾“å…¥èŒƒå›´0<del>4095ï¼Œè€ŒåŒé€šé“16ä½çš„PCMéŸ³é¢‘æ•°æ®æ˜¯å·¦å³å£°é“äº¤æ›¿å­˜å‚¨ï¼Œä¸”æ•°æ®èŒƒå›´-32768</del>32767ï¼Œå› æ­¤PCMåˆ°STM32çš„DACç¼“å­˜è¦æŒ‰ç…§é¡ºåºä¸€æ‹†ä¸ºäºŒï¼Œåˆ†ä¸ºå·¦å³å£°é“ï¼Œæ¯ä¸ªæ•°æ®å†åŠ ä¸Š32768ï¼Œä½¿å…¶ç”±short intçš„èŒƒå›´è½¬æ¢ä¸ºunsigned short intï¼Œå³0~65535ã€‚ç”±äºPCMæ•°æ®æ˜¯å¯¹éŸ³é¢‘çš„é‡‡æ ·ï¼Œå› æ­¤è°ƒèŠ‚éŸ³é‡ï¼ˆå¹…å€¼ï¼‰å¯ä»¥åœ¨æ­¤æ­¥éª¤ä¸€å¹¶å¤„ç†ï¼Œå³éŸ³é¢‘æ•°æ® x éŸ³é‡ &#x2F;æœ€å¤§éŸ³é‡ã€‚è‡³äºDACæ˜¯12ä½ï¼Œåªéœ€å°†DACæ¨¡å¼è®¾ç½®ä¸ºå·¦å¯¹é½12ä½ï¼Œèˆå¼ƒä½4ä½å³å¯ã€‚</p><p>åˆ°æ­¤ï¼ŒSTM32çš„DACè¾“å‡ºå¼•è„šä¸Šåº”è¯¥å·²ç»æœ‰éŸ³é¢‘ä¿¡å·äº†ï¼Œé€šå¸¸DACå¼•è„šä¸Šä¸²è”ä¸€ä¸ª1~10uFçš„ç”µå®¹ç”¨æ¥è€¦åˆéŸ³é¢‘ä¿¡å·ï¼Œç”µå®¹è¶Šå¤§éŸ³è´¨è¶Šå¥½ï¼Œç”µå®¹å¦ä¸€ç«¯æ¥è€³æœºæ’åº§çš„å·¦å£°é“&#x2F;å³å£°é“ï¼Œæ’ä¸Šè€³æœºå°±å¯ä»¥æ¬£èµéŸ³ä¹å•¦ï¼éŸ³è´¨å˜›ï¼Œåæ­£æˆ‘æ˜¯å¬ä¸å‡ºæ¥å¥½ä¸å¥½ï¼Œè·Ÿå•†å“MP3æ’­æ”¾å™¨å·®ä¸å¤šã€‚å¦‚æœä¸ä¸²è”ç”µå®¹ï¼ŒDACå¼•è„šç›´è¿è€³æœºæ’åº§å·¦å³å£°é“ä¹Ÿèƒ½å¬åˆ°å£°éŸ³ï¼Œå°±æ˜¯æœ‰äº›æ•°å­—ä¿¡å·å™ªå£°ä¹Ÿä¼šä¼ è¿›æ¥ã€‚å¦‚æœå¸Œæœ›å™ªå£°å°ä¸€äº›ï¼ŒDACå¼•è„šè¾“å‡ºç«¯åŠ ä¸€ä¸ªä¸‹å›¾çš„ä½é€šæ»¤æ³¢ç”µè·¯ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p><img src="https://img-blog.csdnimg.cn/f132f4062140488bbdfc5c5d375776a2.jpeg"></p><p><img src="https://img-blog.csdnimg.cn/44697c32a37541ea990a3a9d5911e091.jpeg"></p><p>Helixç§»æ¤ï¼š</p><p>Helixæºç çš„å®˜ç½‘æˆ‘æ²¡æ‰¾åˆ°ï¼Œç›´æ¥ç”¨äº†é‡ç«çš„ä¾‹ç¨‹é‡Œé¢çš„ä»£ç ï¼Œç§»æ¤ä¹Ÿå¾ˆç®€å•ï¼Œä¸ç”¨æ”¹ä»»ä½•ä»£ç ï¼Œåªéœ€è¦å°†Helixæ–‡ä»¶å¤¹æ‹·è´åˆ°å·¥ç¨‹ç›®å½•é‡Œï¼Œç„¶ååœ¨Keilä¸­æ·»åŠ å¥½æ–‡ä»¶ï¼Œä»¥åŠæ·»åŠ å¤´æ–‡ä»¶é€”å¾„ï¼Œç¼–è¯‘å³å¯ã€‚å·¥ç¨‹ç›®å½•å¦‚å›¾ã€‚</p><p><img src="https://img-blog.csdnimg.cn/bb0d0811712140ae83b917fa128509d9.jpeg"></p><p>æºç ï¼šdacé…ç½®</p><p>dac.c</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  ******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    dac.c</span></span><br><span class="line"><span class="comment">  * @author  ZL</span></span><br><span class="line"><span class="comment">  * @version V0.0.1</span></span><br><span class="line"><span class="comment">  * @date    September-20-2019</span></span><br><span class="line"><span class="comment">  * @brief   DAC configuration.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  ******************************************************************************</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dac.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private typedef -----------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* Private define ------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>   CNT_FREQ          84000000      <span class="comment">// TIM6 counter clock (prescaled APB1)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* DHR registers offsets */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHR12R1_OFFSET             ((uint32_t)0x00000008)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHR12R2_OFFSET             ((uint32_t)0x00000014)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHR12RD_OFFSET             ((uint32_t)0x00000020)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private macro -------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* Private variables ---------------------------------------------------------*/</span></span><br><span class="line"><span class="type">uint32_t</span> DAC_DHR12R1_ADDR = (<span class="type">uint32_t</span>)DAC_BASE + DHR12R1_OFFSET + DAC_Align_12b_L;</span><br><span class="line"><span class="type">uint32_t</span> DAC_DHR12R2_ADDR = (<span class="type">uint32_t</span>)DAC_BASE + DHR12R2_OFFSET + DAC_Align_12b_L;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> DAC_buff[<span class="number">2</span>][DAC_BUF_LEN]; <span class="comment">//DAC1ã€DAC2è¾“å‡ºç¼“å†²</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private function prototypes -----------------------------------------------*/</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">TIM6_Config</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private functions ---------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  DACåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">  * @param  none</span></span><br><span class="line"><span class="comment">  * @retval none</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_Config</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">GPIO_InitTypeDef  GPIO_InitStructure;</span><br><span class="line">DAC_InitTypeDef  DAC_InitStructure;</span><br><span class="line"></span><br><span class="line"><span class="built_in">RCC_AHB1PeriphClockCmd</span>(RCC_AHB1Periph_GPIOA, ENABLE);</span><br><span class="line"><span class="built_in">RCC_APB1PeriphClockCmd</span>(RCC_APB1Periph_DAC, ENABLE);</span><br><span class="line"></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4 | GPIO_Pin_5;</span><br><span class="line"></span><br><span class="line">GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AN;</span><br><span class="line">GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;</span><br><span class="line">GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;</span><br><span class="line">GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;</span><br><span class="line"><span class="built_in">GPIO_Init</span>(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">DAC_InitStructure.DAC_WaveGeneration = DAC_WaveGeneration_None;</span><br><span class="line">DAC_InitStructure.DAC_Trigger = DAC_Trigger_T6_TRGO;</span><br><span class="line">DAC_InitStructure.DAC_OutputBuffer = DAC_OutputBuffer_Enable;</span><br><span class="line"><span class="built_in">DAC_Init</span>(DAC_Channel_1, &amp;DAC_InitStructure);</span><br><span class="line"><span class="built_in">DAC_Init</span>(DAC_Channel_2, &amp;DAC_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®DMA</span></span><br><span class="line">DMA_InitTypeDef DMA_InitStruct;</span><br><span class="line"><span class="built_in">DMA_StructInit</span>(&amp;DMA_InitStruct);</span><br><span class="line"></span><br><span class="line"><span class="built_in">RCC_AHB1PeriphClockCmd</span>(RCC_AHB1Periph_DMA1, ENABLE);</span><br><span class="line"></span><br><span class="line">DMA_InitStruct.DMA_PeripheralBaseAddr = (u32)DAC_DHR12R1_ADDR;</span><br><span class="line">DMA_InitStruct.DMA_Memory0BaseAddr = (u32)&amp;DAC_buff[<span class="number">0</span>];<span class="comment">//DAC1</span></span><br><span class="line">DMA_InitStruct.DMA_DIR = DMA_DIR_MemoryToPeripheral;</span><br><span class="line">DMA_InitStruct.DMA_BufferSize = DAC_BUF_LEN;</span><br><span class="line">DMA_InitStruct.DMA_PeripheralInc = DMA_PeripheralInc_Disable;</span><br><span class="line">DMA_InitStruct.DMA_MemoryInc = DMA_MemoryInc_Enable;</span><br><span class="line">DMA_InitStruct.DMA_PeripheralDataSize = DMA_PeripheralDataSize_HalfWord;</span><br><span class="line">DMA_InitStruct.DMA_MemoryDataSize = DMA_MemoryDataSize_HalfWord;</span><br><span class="line">DMA_InitStruct.DMA_Mode = DMA_Mode_Circular;</span><br><span class="line">DMA_InitStruct.DMA_Priority = DMA_Priority_High;</span><br><span class="line">DMA_InitStruct.DMA_Channel = DMA_Channel_7;</span><br><span class="line">DMA_InitStruct.DMA_FIFOMode = DMA_FIFOMode_Disable;</span><br><span class="line">DMA_InitStruct.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull;</span><br><span class="line">  DMA_InitStruct.DMA_MemoryBurst   = DMA_MemoryBurst_Single;</span><br><span class="line">  DMA_InitStruct.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;</span><br><span class="line"></span><br><span class="line"><span class="built_in">DMA_Init</span>(DMA1_Stream5, &amp;DMA_InitStruct);</span><br><span class="line"></span><br><span class="line">DMA_InitStruct.DMA_PeripheralBaseAddr = (u32)DAC_DHR12R2_ADDR;</span><br><span class="line">DMA_InitStruct.DMA_Memory0BaseAddr = (u32)&amp;DAC_buff[<span class="number">1</span>];<span class="comment">//DAC2</span></span><br><span class="line"><span class="built_in">DMA_Init</span>(DMA1_Stream6, &amp;DMA_InitStruct);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯DMAä¼ è¾“å®Œæˆä¸­æ–­</span></span><br><span class="line">NVIC_InitTypeDef NVIC_InitStructure;</span><br><span class="line"></span><br><span class="line">  NVIC_InitStructure.NVIC_IRQChannel = DMA1_Stream6_IRQn;</span><br><span class="line">  NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = <span class="number">0</span>;</span><br><span class="line">  NVIC_InitStructure.NVIC_IRQChannelSubPriority = <span class="number">1</span>;</span><br><span class="line">  NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;</span><br><span class="line">  <span class="built_in">NVIC_Init</span>(&amp;NVIC_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="built_in">DMA_ClearITPendingBit</span>(DMA1_Stream6, DMA_IT_TCIF6);</span><br><span class="line"><span class="built_in">DMA_ClearITPendingBit</span>(DMA1_Stream6, DMA_IT_HTIF6);</span><br><span class="line"><span class="built_in">DMA_ITConfig</span>(DMA1_Stream6, DMA_IT_TC, ENABLE);</span><br><span class="line"><span class="built_in">DMA_ITConfig</span>(DMA1_Stream6, DMA_IT_HT, ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//DMA_Cmd(DMA1_Stream5, ENABLE);</span></span><br><span class="line"><span class="comment">//DMA_Cmd(DMA1_Stream6, ENABLE);</span></span><br><span class="line"><span class="built_in">DAC_Cmd</span>(DAC_Channel_1, ENABLE);</span><br><span class="line">  <span class="built_in">DAC_Cmd</span>(DAC_Channel_2, ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="built_in">DAC_DMACmd</span>(DAC_Channel_1, ENABLE);</span><br><span class="line"><span class="built_in">DAC_DMACmd</span>(DAC_Channel_2, ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="built_in">TIM6_Config</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®DACé‡‡æ ·ç‡å’ŒDMAæ•°æ®é•¿åº¦ï¼Œå¹¶å¯åŠ¨DMA DAC</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_DMA_Start</span><span class="params">(<span class="type">uint32_t</span> freq, <span class="type">uint16_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//è®¾ç½®DMAç¼“å†²é•¿åº¦éœ€è¦åœæ­¢DMA</span></span><br><span class="line"><span class="built_in">DAC_DMA_Stop</span>();</span><br><span class="line"><span class="comment">//è®¾ç½®DMA DACç¼“å†²é•¿åº¦</span></span><br><span class="line"><span class="built_in">DMA_SetCurrDataCounter</span>(DMA1_Stream5, len);</span><br><span class="line"><span class="built_in">DMA_SetCurrDataCounter</span>(DMA1_Stream6, len);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®å®šæ—¶å™¨</span></span><br><span class="line"><span class="built_in">TIM_SetAutoreload</span>(TIM6, (<span class="type">uint16_t</span>)((CNT_FREQ)/freq));</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨</span></span><br><span class="line"><span class="built_in">DMA_Cmd</span>(DMA1_Stream5, ENABLE);</span><br><span class="line"><span class="built_in">DMA_Cmd</span>(DMA1_Stream6, ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœæ­¢DMA DAC</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_DMA_Stop</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">DMA_Cmd</span>(DMA1_Stream5, DISABLE);</span><br><span class="line"><span class="built_in">DMA_Cmd</span>(DMA1_Stream6, DISABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šæ—¶å™¨6ç”¨äºè®¾ç½®DACåˆ·æ–°ç‡</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">TIM6_Config</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  TIM_TimeBaseInitTypeDef TIM6_TimeBase;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">RCC_APB1PeriphClockCmd</span>(RCC_APB1Periph_TIM6, ENABLE);</span><br><span class="line">  <span class="built_in">TIM_TimeBaseStructInit</span>(&amp;TIM6_TimeBase);</span><br><span class="line"></span><br><span class="line">  TIM6_TimeBase.TIM_Period        = (<span class="type">uint16_t</span>)((CNT_FREQ)/<span class="number">44100</span>);</span><br><span class="line">  TIM6_TimeBase.TIM_Prescaler     = <span class="number">0</span>;</span><br><span class="line">  TIM6_TimeBase.TIM_ClockDivision = <span class="number">0</span>;</span><br><span class="line">  TIM6_TimeBase.TIM_CounterMode   = TIM_CounterMode_Up;</span><br><span class="line">  <span class="built_in">TIM_TimeBaseInit</span>(TIM6, &amp;TIM6_TimeBase);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">TIM_SelectOutputTrigger</span>(TIM6, TIM_TRGOSource_Update);</span><br><span class="line">  <span class="built_in">TIM_Cmd</span>(TIM6, ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  DAC out1 PA4è¾“å‡ºç”µå‹</span></span><br><span class="line"><span class="comment">  * @param  datï¼šdacæ•°å€¼:ï¼Œ0~4095</span></span><br><span class="line"><span class="comment">  * @retval none</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_Out1</span><span class="params">(<span class="type">uint16_t</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">DAC_SetChannel1Data</span>(DAC_Align_12b_R,  dat);</span><br><span class="line"><span class="built_in">DAC_SoftwareTriggerCmd</span>(DAC_Channel_1, ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  DAC out2 PA5è¾“å‡ºç”µå‹</span></span><br><span class="line"><span class="comment">  * @param  datï¼šdacæ•°å€¼:ï¼Œ0~4095</span></span><br><span class="line"><span class="comment">  * @retval none</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_Out2</span><span class="params">(<span class="type">uint16_t</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">DAC_SetChannel2Data</span>(DAC_Align_12b_R,  dat);</span><br><span class="line"><span class="built_in">DAC_SoftwareTriggerCmd</span>(DAC_Channel_2, ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************* *****END OF FILE****/</span></span><br></pre></td></tr></table></figure><p>æºç ï¼šMP3æ’­æ”¾æµç¨‹ ï¼ˆåŸåˆ›é‡ç«ï¼Œå‚è€ƒäº†é‡ç«çš„ä¾‹ç¨‹ï¼Œæœ¬äººè¿›è¡Œæ•´ç†å’Œä¿®æ”¹ï¼‰</p><p>MP3player.c</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">******************************************************************************</span></span><br><span class="line"><span class="comment">* @file    mp3Player.c</span></span><br><span class="line"><span class="comment">* @author  fire</span></span><br><span class="line"><span class="comment">* @version V1.0</span></span><br><span class="line"><span class="comment">* @date    2023-08-13</span></span><br><span class="line"><span class="comment">* @brief   mp3è§£ç </span></span><br><span class="line"><span class="comment">******************************************************************************</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ff.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mp3Player.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mp3dec.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dac.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;led.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ¨èä½¿ç”¨ä»¥ä¸‹æ ¼å¼mp3æ–‡ä»¶ï¼š</span></span><br><span class="line"><span class="comment"> * é‡‡æ ·ç‡ï¼š44100Hz</span></span><br><span class="line"><span class="comment"> * å£°  é“ï¼š2</span></span><br><span class="line"><span class="comment"> * æ¯”ç‰¹ç‡ï¼š320kbps</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¤„ç†ç«‹ä½“å£°éŸ³é¢‘æ•°æ®æ—¶ï¼Œè¾“å‡ºç¼“å†²åŒºéœ€è¦çš„æœ€å¤§å¤§å°ä¸º2304*16/8å­—èŠ‚(16ä¸ºPCMæ•°æ®ä¸º16ä½)ï¼Œ</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œæˆ‘ä»¬å®šä¹‰MP3BUFFER_SIZEä¸º2304</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MP3BUFFER_SIZE  2304</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INPUTBUF_SIZE   3000</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> HMP3DecoderMp3Decoder;<span class="comment">/* mp3è§£ç å™¨æŒ‡é’ˆ*/</span></span><br><span class="line"><span class="type">static</span> MP3FrameInfoMp3FrameInfo;<span class="comment">/* mP3å¸§ä¿¡æ¯  */</span></span><br><span class="line"><span class="type">static</span> MP3_TYPE mp3player;            <span class="comment">/* mp3æ’­æ”¾è®¾å¤‡ */</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">uint8_t</span> Isread = <span class="number">0</span>;          <span class="comment">/* DMAä¼ è¾“å®Œæˆæ ‡å¿— */</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">uint8_t</span> dac_ht = <span class="number">0</span>;          <span class="comment">//DAC dma åŠä¼ è¾“æ ‡å¿—</span></span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> led_delay = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> inputbuf[INPUTBUF_SIZE]=&#123;<span class="number">0</span>&#125;;     <span class="comment">/* è§£ç è¾“å…¥ç¼“å†²åŒºï¼Œ1940å­—èŠ‚ä¸ºæœ€å¤§MP3å¸§å¤§å°  */</span></span><br><span class="line"><span class="type">static</span> <span class="type">short</span> outbuffer[MP3BUFFER_SIZE];  <span class="comment">/* è§£ç è¾“å‡ºç¼“å†²åŒº*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> FIL file;<span class="comment">/* file objects */</span></span><br><span class="line"><span class="type">static</span> UINT bw;       <span class="comment">/* File R/W count */</span></span><br><span class="line">FRESULT result;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»SDå¡è¯»å–MP3æºæ–‡ä»¶è¿›è¡Œè§£ç ï¼Œå¹¶ä¼ å…¥DACç¼“å†²åŒº</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MP3DataDecoder</span><span class="params">(<span class="type">uint8_t</span> **read_ptr, <span class="type">int</span> *bytes_left)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> err = <span class="number">0</span>, i = <span class="number">0</span>, outputSamps = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//bufflagå¼€å§‹è§£ç  å‚æ•°ï¼šmp3è§£ç ç»“æ„ä½“ã€è¾“å…¥æµæŒ‡é’ˆã€è¾“å…¥æµå¤§å°ã€è¾“å‡ºæµæŒ‡é’ˆã€æ•°æ®æ ¼å¼</span></span><br><span class="line">err = <span class="built_in">MP3Decode</span>(Mp3Decoder, read_ptr, bytes_left, outbuffer, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (err != ERR_MP3_NONE)<span class="comment">//é”™è¯¯å¤„ç†</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">switch</span> (err)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> ERR_MP3_INDATA_UNDERFLOW:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ERR_MP3_INDATA_UNDERFLOW\r\n&quot;</span>);</span><br><span class="line">result = <span class="built_in">f_read</span>(&amp;file, inputbuf, INPUTBUF_SIZE, &amp;bw);</span><br><span class="line">*read_ptr = inputbuf;</span><br><span class="line">*bytes_left = bw;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> ERR_MP3_MAINDATA_UNDERFLOW:</span><br><span class="line"><span class="comment">/* do nothing - next call to decode will provide more mainData */</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ERR_MP3_MAINDATA_UNDERFLOW\r\n&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;UNKNOWN ERROR:%d\r\n&quot;</span>, err);</span><br><span class="line"><span class="comment">// è·³è¿‡æ­¤å¸§</span></span><br><span class="line"><span class="keyword">if</span> (*bytes_left &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">(*bytes_left) --;</span><br><span class="line">read_ptr ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">//è§£ç æ— é”™è¯¯ï¼Œå‡†å¤‡æŠŠæ•°æ®è¾“å‡ºåˆ°PCM</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MP3GetLastFrameInfo</span>(Mp3Decoder, &amp;Mp3FrameInfo);<span class="comment">//è·å–è§£ç ä¿¡æ¯</span></span><br><span class="line"><span class="comment">/* è¾“å‡ºåˆ°DAC */</span></span><br><span class="line">outputSamps = Mp3FrameInfo.outputSamps;<span class="comment">//PCMæ•°æ®ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">if</span> (outputSamps &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (Mp3FrameInfo.nChans == <span class="number">1</span>)<span class="comment">//å•å£°é“</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å•å£°é“æ•°æ®éœ€è¦å¤åˆ¶ä¸€ä»½åˆ°å¦ä¸€ä¸ªå£°é“</span></span><br><span class="line"><span class="keyword">for</span> (i = outputSamps - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line">outbuffer[i * <span class="number">2</span>] = outbuffer[i];</span><br><span class="line">outbuffer[i * <span class="number">2</span> + <span class="number">1</span>] = outbuffer[i];</span><br><span class="line">&#125;</span><br><span class="line">outputSamps *= <span class="number">2</span>;</span><br><span class="line">&#125;<span class="comment">//if (Mp3FrameInfo.nChans == 1)//å•å£°é“</span></span><br><span class="line">&#125;<span class="comment">//if (outputSamps &gt; 0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†æ•°æ®ä¼ é€è‡³DMA DACç¼“å†²åŒº</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; outputSamps/<span class="number">2</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(dac_ht == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">DAC_buff[<span class="number">0</span>][i] = outbuffer[<span class="number">2</span>*i] * mp3player.ucVolume /<span class="number">100</span> + <span class="number">32768</span>;</span><br><span class="line">DAC_buff[<span class="number">1</span>][i] = outbuffer[<span class="number">2</span>*i+<span class="number">1</span>] * mp3player.ucVolume /<span class="number">100</span> + <span class="number">32768</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">DAC_buff[<span class="number">0</span>][i+outputSamps/<span class="number">2</span>] = outbuffer[<span class="number">2</span>*i] * mp3player.ucVolume /<span class="number">100</span> + <span class="number">32768</span>;</span><br><span class="line">DAC_buff[<span class="number">1</span>][i+outputSamps/<span class="number">2</span>] = outbuffer[<span class="number">2</span>*i+<span class="number">1</span>] * mp3player.ucVolume /<span class="number">100</span> + <span class="number">32768</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;<span class="comment">//else è§£ç æ­£å¸¸</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯»å–ä¸€æ®µMP3æ•°æ®ï¼Œå¹¶æŠŠè¯»å–çš„æŒ‡é’ˆèµ‹å€¼read_ptrï¼Œé•¿åº¦èµ‹å€¼bytes_left</span></span><br><span class="line"><span class="function"><span class="type">uint8_t</span> <span class="title">read_file</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *mp3file, <span class="type">uint8_t</span> **read_ptr, <span class="type">int</span> *bytes_left)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">result = <span class="built_in">f_read</span>(&amp;file, inputbuf, INPUTBUF_SIZE, &amp;bw);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(result != FR_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;è¯»å–%så¤±è´¥ -&gt; %d\r\n&quot;</span>, mp3file, result);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">*read_ptr = inputbuf;</span><br><span class="line">*bytes_left = bw;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  MP3æ ¼å¼éŸ³é¢‘æ’­æ”¾ä¸»ç¨‹åº</span></span><br><span class="line"><span class="comment">  * @param  mp3file MP3æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mp3PlayerDemo</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *mp3file)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">uint8_t</span> *read_ptr = inputbuf;</span><br><span class="line"><span class="type">int</span>read_offset = <span class="number">0</span>;<span class="comment">/* è¯»åç§»æŒ‡é’ˆ */</span></span><br><span class="line"><span class="type">int</span>bytes_left = <span class="number">0</span>;<span class="comment">/* å‰©ä½™å­—èŠ‚æ•° */</span></span><br><span class="line"></span><br><span class="line">mp3player.ucStatus = STA_IDLE;</span><br><span class="line">mp3player.ucVolume = <span class="number">15</span>; <span class="comment">//éŸ³é‡å€¼ï¼Œ100æ»¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è¯•æ‰“å¼€MP3æ–‡ä»¶</span></span><br><span class="line">result = <span class="built_in">f_open</span>(&amp;file, mp3file, FA_READ);</span><br><span class="line"><span class="keyword">if</span>(result != FR_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Open mp3file :%s fail!!!-&gt;%d\r\n&quot;</span>, mp3file, result);</span><br><span class="line">result = <span class="built_in">f_close</span> (&amp;file);</span><br><span class="line"><span class="keyword">return</span>;<span class="comment">/* åœæ­¢æ’­æ”¾ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;å½“å‰æ’­æ”¾æ–‡ä»¶ -&gt; %s\n&quot;</span>, mp3file);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–MP3è§£ç å™¨</span></span><br><span class="line">Mp3Decoder = <span class="built_in">MP3InitDecoder</span>();</span><br><span class="line"><span class="keyword">if</span>(Mp3Decoder == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;åˆå§‹åŒ–helixè§£ç åº“è®¾å¤‡å¤±è´¥ï¼\r\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;<span class="comment">/* åœæ­¢æ’­æ”¾ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;åˆå§‹åŒ–helixè§£ç åº“å®Œæˆ\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è¯•è¯»å–ä¸€æ®µMP3æ•°æ®ï¼Œå¹¶æŠŠè¯»å–çš„æŒ‡é’ˆèµ‹å€¼read_ptrï¼Œé•¿åº¦èµ‹å€¼bytes_left</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">read_file</span>(mp3file, &amp;read_ptr, &amp;bytes_left))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MP3FreeDecoder</span>(Mp3Decoder);</span><br><span class="line"><span class="keyword">return</span>;<span class="comment">/* åœæ­¢æ’­æ”¾ */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è¯•è§£ç æˆåŠŸ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">MP3DataDecoder</span>(&amp;read_ptr, &amp;bytes_left))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//æ‰“å°MP3ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n Bitrate       %dKbps&quot;</span>, Mp3FrameInfo.bitrate/<span class="number">1000</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n Samprate      %dHz&quot;</span>,   Mp3FrameInfo.samprate);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n BitsPerSample %db&quot;</span>,    Mp3FrameInfo.bitsPerSample);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n nChans        %d&quot;</span>,     Mp3FrameInfo.nChans);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n Layer         %d&quot;</span>,     Mp3FrameInfo.layer);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n Version       %d&quot;</span>,     Mp3FrameInfo.version);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n OutputSamps   %d&quot;</span>,     Mp3FrameInfo.outputSamps);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨DACï¼Œå¼€å§‹å‘å£°</span></span><br><span class="line"><span class="keyword">if</span> (Mp3FrameInfo.nChans == <span class="number">1</span>)<span class="comment">//å•å£°é“è¦å°†outputSamps*2</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DAC_DMA_Start</span>(Mp3FrameInfo.samprate, <span class="number">2</span> * Mp3FrameInfo.outputSamps);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">//åŒå£°é“ç›´æ¥ç”¨Mp3FrameInfo.outputSamps</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DAC_DMA_Start</span>(Mp3FrameInfo.samprate, Mp3FrameInfo.outputSamps);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">//è§£ç å¤±è´¥</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MP3FreeDecoder</span>(Mp3Decoder);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ”¾éŸ³çŠ¶æ€ */</span></span><br><span class="line">mp3player.ucStatus = STA_PLAYING;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¿›å…¥ä¸»ç¨‹åºå¾ªç¯ä½“ */</span></span><br><span class="line"><span class="keyword">while</span>(mp3player.ucStatus == STA_PLAYING)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å¯»æ‰¾å¸§åŒæ­¥ï¼Œè¿”å›ç¬¬ä¸€ä¸ªåŒæ­¥å­—çš„ä½ç½®</span></span><br><span class="line">read_offset = <span class="built_in">MP3FindSyncWord</span>(read_ptr, bytes_left);</span><br><span class="line"><span class="keyword">if</span>(read_offset &lt; <span class="number">0</span>)<span class="comment">//æ²¡æœ‰æ‰¾åˆ°åŒæ­¥å­—</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">read_file</span>(mp3file, &amp;read_ptr, &amp;bytes_left))<span class="comment">//é‡æ–°è¯»å–ä¸€æ¬¡æ–‡ä»¶å†æ‰¾</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">continue</span>;<span class="comment">//å›åˆ°while(mp3player.ucStatus == STA_PLAYING)åé¢</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">//æ‰¾åˆ°åŒæ­¥å­—</span></span><br><span class="line">&#123;</span><br><span class="line">read_ptr   += read_offset;<span class="comment">//åç§»è‡³åŒæ­¥å­—çš„ä½ç½®</span></span><br><span class="line">bytes_left -= read_offset;<span class="comment">//åŒæ­¥å­—ä¹‹åçš„æ•°æ®å¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(bytes_left &lt; <span class="number">1024</span>)<span class="comment">//å¦‚æœå‰©ä½™çš„æ•°æ®å°äº1024å­—èŠ‚ï¼Œè¡¥å……æ•°æ®</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* æ³¨æ„è¿™ä¸ªåœ°æ–¹å› ä¸ºé‡‡ç”¨çš„æ˜¯DMAè¯»å–ï¼Œæ‰€ä»¥ä¸€å®šè¦4å­—èŠ‚å¯¹é½  */</span></span><br><span class="line">u16 i = (<span class="type">uint32_t</span>)(bytes_left)&amp;<span class="number">3</span>;<span class="comment">//åˆ¤æ–­å¤šä½™çš„å­—èŠ‚</span></span><br><span class="line"><span class="keyword">if</span>(i) i=<span class="number">4</span>-i;<span class="comment">//éœ€è¦è¡¥å……çš„å­—èŠ‚</span></span><br><span class="line"><span class="built_in">memcpy</span>(inputbuf+i, read_ptr, bytes_left);<span class="comment">//ä»å¯¹é½ä½ç½®å¼€å§‹å¤åˆ¶</span></span><br><span class="line">read_ptr = inputbuf+i;<span class="comment">//æŒ‡å‘æ•°æ®å¯¹é½ä½ç½®</span></span><br><span class="line">result = <span class="built_in">f_read</span>(&amp;file, inputbuf+bytes_left+i, INPUTBUF_SIZE-bytes_left-i, &amp;bw);<span class="comment">//è¡¥å……æ•°æ®</span></span><br><span class="line"><span class="keyword">if</span>(result != FR_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;è¯»å–%så¤±è´¥ -&gt; %d\r\n&quot;</span>,mp3file,result);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">bytes_left += bw;<span class="comment">//æœ‰æ•ˆæ•°æ®æµå¤§å°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MP3æ•°æ®è§£ç å¹¶é€å…¥DACç¼“å­˜</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">MP3DataDecoder</span>(&amp;read_ptr, &amp;bytes_left))</span><br><span class="line">&#123;<span class="comment">//å¦‚æœæ’­æ”¾å‡ºé”™ï¼ŒIsreadç½®1ï¼Œé¿å…å¡ä½æ­»å¾ªç¯</span></span><br><span class="line">Isread = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//mp3æ–‡ä»¶è¯»å–å®Œæˆï¼Œé€€å‡º</span></span><br><span class="line"><span class="keyword">if</span>(file.fptr == file.fsize)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;å•æ›²æ’­æ”¾å®Œæ¯•\r\n&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç­‰å¾…DACå‘é€ä¸€åŠæˆ–å…¨éƒ¨ä¸­æ–­</span></span><br><span class="line"><span class="keyword">while</span>(Isread == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">led_delay++;</span><br><span class="line"><span class="keyword">if</span>(led_delay == <span class="number">0xffffff</span>)</span><br><span class="line">&#123;</span><br><span class="line">led_delay=<span class="number">0</span>;</span><br><span class="line">LED1_TROG;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Input_scan();//ç­‰å¾…DMAä¼ è¾“å®Œæˆï¼Œæ­¤é—´å¯ä»¥è¿è¡ŒæŒ‰é”®æ‰«æåŠå¤„ç†äº‹ä»¶</span></span><br><span class="line">&#125;</span><br><span class="line">Isread = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿è¡Œåˆ°æ­¤å¤„ï¼Œè¯´æ˜å•æ›²æ’­æ”¾å®Œæˆï¼Œæ”¶å°¾å·¥ä½œ</span></span><br><span class="line"><span class="built_in">DAC_DMA_Stop</span>();<span class="comment">//åœæ­¢å–‚DACæ•°æ®</span></span><br><span class="line">mp3player.ucStatus = STA_IDLE;</span><br><span class="line"><span class="built_in">MP3FreeDecoder</span>(Mp3Decoder);<span class="comment">//æ¸…ç†ç¼“å­˜</span></span><br><span class="line"><span class="built_in">f_close</span>(&amp;file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DMA1_Stream6_IRQHandler</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">DMA_GetITStatus</span>(DMA1_Stream6, DMA_IT_HTIF6) != RESET) <span class="comment">//åŠä¼ è¾“</span></span><br><span class="line">&#123;</span><br><span class="line">dac_ht = <span class="number">1</span>;</span><br><span class="line">Isread=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">DMA_ClearITPendingBit</span>(DMA1_Stream6, DMA_IT_HTIF6);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">DMA_GetITStatus</span>(DMA1_Stream6, DMA_IT_TCIF6) != RESET) <span class="comment">//å…¨ä¼ è¾“</span></span><br><span class="line">&#123;</span><br><span class="line">dac_ht = <span class="number">0</span>;</span><br><span class="line">Isread=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">DMA_ClearITPendingBit</span>(DMA1_Stream6, DMA_IT_TCIF6);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************** (END OF FILE) *********************************/</span></span><br></pre></td></tr></table></figure><p>æºç ï¼šmain.c</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  ******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    ../User/main.c</span></span><br><span class="line"><span class="comment">  * @author  ZL</span></span><br><span class="line"><span class="comment">  * @version V1.0</span></span><br><span class="line"><span class="comment">  * @date    2015-12-26</span></span><br><span class="line"><span class="comment">  * @brief   Main program body</span></span><br><span class="line"><span class="comment">  ******************************************************************************</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hw_includes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ff.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;exfuns.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mp3Player.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†ç›®å½•æ–‡ä»¶å¹¶æ‰“å°è¾“å‡º</span></span><br><span class="line"><span class="function">u8 <span class="title">scan_files</span><span class="params">(u8 * path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">FRESULT res;</span><br><span class="line"><span class="type">char</span> buf[<span class="number">512</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="type">char</span> *fn;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _USE_LFN</span></span><br><span class="line"> fileinfo.lfsize = _MAX_LFN * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">fileinfo.lfname = buf;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">res = <span class="built_in">f_opendir</span>(&amp;dir,(<span class="type">const</span> TCHAR*)path);</span><br><span class="line"><span class="keyword">if</span> (res == FR_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"></span><br><span class="line">res = <span class="built_in">f_readdir</span>(&amp;dir, &amp;fileinfo);</span><br><span class="line"><span class="keyword">if</span> (res != FR_OK || fileinfo.fname[<span class="number">0</span>] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _USE_LFN</span></span><br><span class="line">fn = *fileinfo.lfname ? fileinfo.lfname : fileinfo.fname;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">fn = fileinfo.fname;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/&quot;</span>, path);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\r\n&quot;</span>, fn);</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  Main program</span></span><br><span class="line"><span class="comment">  * @param  None</span></span><br><span class="line"><span class="comment">  * @retval None</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">delay_init</span>(<span class="number">168</span>);</span><br><span class="line"><span class="built_in">usart1_Init</span>(<span class="number">115200</span>);</span><br><span class="line"><span class="built_in">LED_Init</span>();</span><br><span class="line"><span class="built_in">DAC_Config</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">SD_Init</span>())</span><br><span class="line"> &#123;</span><br><span class="line"><span class="built_in">exfuns_init</span>();<span class="comment">//ä¸ºfatfsç›¸å…³å˜é‡ç”³è¯·å†…å­˜</span></span><br><span class="line"><span class="built_in">f_mount</span>(fs[<span class="number">0</span>],<span class="string">&quot;0:&quot;</span>,<span class="number">1</span>); <span class="comment">//æŒ‚è½½SDå¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å°SDç›®å½•å’Œæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">scan_files</span>(<span class="string">&quot;0:&quot;</span>);</span><br><span class="line"></span><br><span class="line">LED0_ON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">mp3PlayerDemo</span>(<span class="string">&quot;0:/æ–­æ¡¥æ®‹é›ª.MP3&quot;</span>);</span><br><span class="line"><span class="built_in">mp3PlayerDemo</span>(<span class="string">&quot;0:/å¼ å›½è£-ç»ç’ƒä¹‹æƒ….MP3&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">delay_ms</span>(<span class="number">50</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºæ–¹ä¾¿è°ƒè¯•æµ‹è¯•ï¼Œä½¿ç”¨usart1æ‰“å°æ•°æ®ã€‚å®æµ‹æ•ˆæœï¼š</p><p><img src="https://img-blog.csdnimg.cn/bad9436c9a4e40de9bbd62abbae67b7c.jpeg"></p><p><img src="https://img-blog.csdnimg.cn/54ff22470d72499bb3e585a487abab46.jpeg"></p><p>ç¨‹åºæºç ä¸åŸç†å›¾ï¼Œæµ‹è¯•éŸ³é¢‘ï¼š</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/10hYXkrqnuBQgs0DWKLUUOA?pwd=iatt">https://pan.baidu.com/s/10hYXkrqnuBQgs0DWKLUUOA?pwd=iatt</a><br>æå–ç ï¼šiatt</p><p>çŸ¥é“è¿™é‡Œä¸‹è½½è¦ç§¯åˆ†ç™»å½•ä»€ä¹ˆçš„éº»çƒ¦å¾—å¾ˆï¼Œæ‰€ä»¥ç¨‹åºæ”¾åˆ°ç™¾åº¦ç½‘ç›˜äº†ï¼Œå‡å¦‚è¿æ¥å¤±æ•ˆï¼Œè®°å¾—åœ¨è¯„è®ºåŒºå–Šæˆ‘æ›´æ–°ï¼</p><p>ç†è®ºä¸ŠSTM32F1æˆ–è€…å…¶ä»–ç³»åˆ—ä¹Ÿèƒ½ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œè¦è‡ªå·±æ”¹æ”¹æµ‹è¯•å–½ï¼Œæœ¬æ–‡æŠŠæ€è·¯åˆ†äº«å‡ºæ¥æŠ›ç –å¼•ç‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€STM32ã€‘HALåº“ STM32CubeMXæ•™ç¨‹åä¸‰---RTCæ—¶é’Ÿ</title>
      <link href="/2024/03/stm32-%E3%80%90STM32%E3%80%91HAL%E5%BA%93-STM32CubeMX%E6%95%99%E7%A8%8B%E5%8D%81%E4%B8%89-RTC%E6%97%B6%E9%92%9F/"/>
      <url>/2024/03/stm32-%E3%80%90STM32%E3%80%91HAL%E5%BA%93-STM32CubeMX%E6%95%99%E7%A8%8B%E5%8D%81%E4%B8%89-RTC%E6%97%B6%E9%92%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>å‰è¨€ï¼š</p><p>æœ¬ç³»åˆ—æ•™ç¨‹å°† å¯¹åº”å¤–è®¾åŸç†ï¼ŒHALåº“ä¸STM32CubeMXç»“åˆåœ¨ä¸€èµ·è®²è§£ï¼Œä½¿æ‚¨å¯ä»¥æ›´å¿«é€Ÿçš„å­¦ä¼šå„ä¸ªæ¨¡å—çš„ä½¿ç”¨</p><p>æ‰€ç”¨å·¥å…·ï¼š</p><p>1ã€èŠ¯ç‰‡ï¼š STM32F407ZET6&#x2F; STM32F103ZET6</p><p>2ã€STM32CubeMxè½¯ä»¶</p><p>3ã€IDEï¼š MDK-Keilè½¯ä»¶</p><p>4ã€STM32F1xx&#x2F;STM32F4xxHALåº“</p><p>çŸ¥è¯†æ¦‚æ‹¬ï¼š</p><p>é€šè¿‡æœ¬ç¯‡åšå®¢æ‚¨å°†å­¦åˆ°ï¼š</p><p>RTCæ—¶é’ŸåŸç†</p><p>STM32CubeMXåˆ›å»ºRTCä¾‹ç¨‹</p><p>HALåº“å®šæ—¶å™¨RTCå‡½æ•°åº“</p><p><strong>PS: è¿™é‡Œçš„RTCè®²è§£ï¼Œæˆ‘ä»¬åªå°†åŸç†ï¼Œä¸è®²å¯„å­˜å™¨ï¼Œå¦‚æœè¦çœ‹RTCçš„å¯„å­˜å™¨ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« </strong><br><a href="https://blog.csdn.net/as480133937/article/details/105026033">ã€STM32ã€‘RTCå®æ—¶æ—¶é’Ÿï¼Œæ­¥éª¤è¶…ç»†è¯¦è§£ï¼Œä¸€æ–‡çœ‹æ‡‚RTC</a></p><h3 id="ä»€ä¹ˆæ˜¯RTC"><a href="#ä»€ä¹ˆæ˜¯RTC" class="headerlink" title="ä»€ä¹ˆæ˜¯RTC"></a>ä»€ä¹ˆæ˜¯RTC</h3><p>**RTC (Real Time Clock)**ï¼šå®æ—¶æ—¶é’Ÿ</p><p><strong>RTCæ˜¯ä¸ªç‹¬ç«‹çš„å®šæ—¶å™¨</strong>ã€‚RTCæ¨¡å—æ‹¥æœ‰ä¸€ä¸ªè¿ç»­è®¡æ•°çš„è®¡æ•°å™¨ï¼Œåœ¨ç›¸åº”çš„è½¯ä»¶é…ç½®ä¸‹ï¼Œå¯ä»¥æä¾›æ—¶é’Ÿæ—¥å†çš„åŠŸèƒ½ã€‚ä¿®æ”¹è®¡æ•°å™¨çš„å€¼å¯ä»¥é‡æ–°è®¾ç½®å½“å‰æ—¶é—´å’Œæ—¥æœŸ RTCè¿˜åŒ…å«ç”¨äºç®¡ç†ä½åŠŸè€—æ¨¡å¼çš„è‡ªåŠ¨å”¤é†’å•å…ƒã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200423215123488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p><strong>åœ¨æ–­ç”µæƒ…å†µä¸‹ RTCä»å¯ä»¥ç‹¬ç«‹è¿è¡Œ åªè¦èŠ¯ç‰‡çš„å¤‡ç”¨ç”µæºä¸€ç›´ä¾›ç”µ,RTCä¸Šçš„æ—¶é—´ä¼šä¸€ç›´èµ°ã€‚</strong></p><p>RTCå®è´¨æ˜¯ä¸€ä¸ªæ‰ç”µåè¿˜ç»§ç»­è¿è¡Œçš„å®šæ—¶å™¨,ä»å®šæ—¶å™¨çš„è§’åº¦æ¥çœ‹,ç›¸å¯¹äºé€šç”¨å®šæ—¶å™¨TIMå¤–è®¾,å®ƒçš„åŠŸèƒ½ååˆ†ç®€å•,åªæœ‰è®¡æ—¶åŠŸèƒ½(ä¹Ÿå¯ä»¥è§¦å‘ä¸­æ–­)ã€‚ä½†å…¶é«˜çº§æŒ‡å‡ºä¹Ÿå°±åœ¨äºæ‰ç”µä¹‹åè¿˜å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><p>ä¸¤ä¸ª 32 ä½å¯„å­˜å™¨åŒ…å«äºŒè¿›ç åè¿›æ•°æ ¼å¼ (BCD) çš„ç§’ã€åˆ†é’Ÿã€å°æ—¶ï¼ˆ 12 æˆ– 24 å°æ—¶åˆ¶ï¼‰ã€æ˜ŸæœŸå‡ ã€æ—¥æœŸã€æœˆä»½å’Œå¹´ä»½ã€‚æ­¤å¤–ï¼Œè¿˜å¯æä¾›äºŒè¿›åˆ¶æ ¼å¼çš„äºšç§’å€¼ã€‚ç³»ç»Ÿå¯ä»¥è‡ªåŠ¨å°†æœˆä»½çš„å¤©æ•°è¡¥å¿ä¸º 28ã€29ï¼ˆé—°å¹´ï¼‰ã€30 å’Œ 31 å¤©ã€‚</p><p>ä¸Šç”µå¤ä½åï¼Œæ‰€æœ‰RTCå¯„å­˜å™¨éƒ½ä¼šå—åˆ°ä¿æŠ¤ï¼Œä»¥é˜²æ­¢å¯èƒ½çš„éæ­£å¸¸å†™è®¿é—®ã€‚</p><p>æ— è®ºå™¨ä»¶çŠ¶æ€å¦‚ä½•ï¼ˆè¿è¡Œæ¨¡å¼ã€ä½åŠŸè€—æ¨¡å¼æˆ–å¤„äºå¤ä½çŠ¶æ€ï¼‰ï¼Œåªè¦ç”µæºç”µå‹ä¿æŒåœ¨å·¥ä½œèŒƒå›´å†…ï¼ŒRTCä½¿ä¸ä¼šåœæ­¢å·¥ä½œã€‚</p><h4 id="RCTç‰¹å¾ï¼š"><a href="#RCTç‰¹å¾ï¼š" class="headerlink" title="; RCTç‰¹å¾ï¼š"></a><a name="rct_47">;</a> <strong>RCTç‰¹å¾ï¼š</strong></h4><p>â— <strong>å¯ç¼–ç¨‹çš„é¢„åˆ†é¢‘ç³»æ•°ï¼šåˆ†é¢‘ç³»æ•°é«˜ä¸º220ã€‚</strong><br>â— <strong>32ä½çš„å¯ç¼–ç¨‹è®¡æ•°å™¨ï¼Œå¯ç”¨äºè¾ƒé•¿æ—¶é—´æ®µçš„æµ‹é‡ã€‚</strong><br>â— <strong>2ä¸ªåˆ†ç¦»çš„æ—¶é’Ÿï¼šç”¨äºAPB1æ¥å£çš„PCLK1å’ŒRTCæ—¶é’Ÿ(RTCæ—¶é’Ÿçš„é¢‘ç‡å¿…é¡»å°äºPCLK1æ—¶é’Ÿ é¢‘ç‡çš„å››åˆ†ä¹‹ä¸€ä»¥ä¸Š)ã€‚</strong><br>â— å¯ä»¥é€‰æ‹©ä»¥ä¸‹ <strong>ä¸‰ç§RTCçš„æ—¶é’Ÿæº</strong>ï¼š<br>â— HSEæ—¶é’Ÿé™¤ä»¥128ï¼›<br>â— LSEæŒ¯è¡å™¨æ—¶é’Ÿï¼›<br>â— LSIæŒ¯è¡å™¨æ—¶é’Ÿ</p><p>â— <strong>2ä¸ªç‹¬ç«‹çš„å¤ä½ç±»å‹ï¼š</strong><br>â— APB1æ¥å£ç”±ç³»ç»Ÿå¤ä½ï¼›<br>â— RTCæ ¸å¿ƒ(é¢„åˆ†é¢‘å™¨ã€é—¹é’Ÿã€è®¡æ•°å™¨å’Œåˆ†é¢‘å™¨)åªèƒ½ç”±åå¤‡åŸŸå¤ä½</p><p>â— <strong>3ä¸ªä¸“é—¨çš„å¯å±è”½ä¸­æ–­ï¼š</strong><br>â— 1. <strong>é—¹é’Ÿä¸­æ–­</strong>ï¼Œç”¨æ¥äº§ç”Ÿä¸€ä¸ªè½¯ä»¶å¯ç¼–ç¨‹çš„é—¹é’Ÿä¸­æ–­ã€‚</p><p>â— 2. <strong>ç§’ä¸­æ–­</strong>ï¼Œç”¨æ¥äº§ç”Ÿä¸€ä¸ªå¯ç¼–ç¨‹çš„å‘¨æœŸæ€§ä¸­æ–­ä¿¡å·(é•¿å¯è¾¾1ç§’)ã€‚</p><p>â— 3. <strong>æº¢å‡ºä¸­æ–­</strong>ï¼ŒæŒ‡ç¤ºå†…éƒ¨å¯ç¼–ç¨‹è®¡æ•°å™¨æº¢å‡ºå¹¶å›è½¬ä¸º0çš„çŠ¶æ€ã€‚</p><p><strong>RTCæ—¶é’Ÿæºï¼š</strong><br>ä¸‰ç§ä¸åŒçš„æ—¶é’Ÿæºå¯è¢«ç”¨æ¥é©±åŠ¨ç³»ç»Ÿæ—¶é’Ÿ(SYSCLK)ï¼š</p><p>â— <strong>HSIæŒ¯è¡å™¨æ—¶é’Ÿ</strong><br>â— <strong>HSEæŒ¯è¡å™¨æ—¶é’Ÿ</strong><br>â— <strong>PLLæ—¶é’Ÿ</strong></p><p>è¿™äº›è®¾å¤‡æœ‰ä»¥ä¸‹2ç§äºŒçº§æ—¶é’Ÿæºï¼š</p><p>â— 40kHzä½é€Ÿå†…éƒ¨RCï¼Œå¯ä»¥ç”¨äºé©±åŠ¨ç‹¬ç«‹çœ‹é—¨ç‹—å’Œé€šè¿‡ç¨‹åºé€‰æ‹©é©±åŠ¨RTCã€‚ RTCç”¨äºä»åœæœº&#x2F;å¾…æœºæ¨¡å¼ä¸‹è‡ªåŠ¨å”¤é†’ç³»ç»Ÿã€‚<br>â— 32.768kHzä½é€Ÿå¤–éƒ¨æ™¶ä½“ä¹Ÿå¯ç”¨æ¥é€šè¿‡ç¨‹åºé€‰æ‹©é©±åŠ¨RTC(RTCCLK)ã€‚</p><h4 id="RTCåŸç†æ¡†å›¾"><a href="#RTCåŸç†æ¡†å›¾" class="headerlink" title="RTCåŸç†æ¡†å›¾"></a>RTCåŸç†æ¡†å›¾</h4><p><img src="https://img-blog.csdnimg.cn/20200322144525734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"><br>RTCæ—¶é’Ÿçš„æ¡†å›¾è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠä»–åˆ†æˆ <strong><code>&amp;#x4E24;&amp;#x4E2A;&amp;#x90E8;&amp;#x5206;</code></strong>:</p><p><strong>APB1 æ¥å£</strong>ï¼šç”¨æ¥å’Œ APB1 æ€»çº¿ç›¸è¿ã€‚ æ­¤å•å…ƒè¿˜åŒ…å«ä¸€ç»„ 16 ä½å¯„å­˜å™¨ï¼Œå¯é€šè¿‡ APB1 æ€»çº¿å¯¹å…¶è¿›è¡Œè¯»å†™æ“ä½œã€‚APB1 æ¥å£ç”± APB1 æ€» çº¿æ—¶é’Ÿé©±åŠ¨ï¼Œç”¨æ¥ä¸ APB1 æ€»çº¿è¿æ¥ã€‚</p><p>é€šè¿‡APB1æ¥å£å¯ä»¥è®¿é—®RTCçš„ç›¸å…³å¯„å­˜å™¨ï¼ˆé¢„åˆ†é¢‘å€¼ï¼Œè®¡æ•°å™¨å€¼ï¼Œé—¹é’Ÿå€¼ï¼‰ã€‚</p><p><strong>RTC æ ¸å¿ƒæ¥å£</strong>ï¼šç”±ä¸€ç»„å¯ç¼–ç¨‹è®¡æ•°å™¨ç»„æˆï¼Œåˆ†æˆ ** <code>&amp;#x4E24;&amp;#x4E2A;&amp;#x4E3B;&amp;#x8981;&amp;#x6A21;&amp;#x5757;</code>** ã€‚<br><img src="https://img-blog.csdnimg.cn/20200322223612113.png">g)<br><strong>ç¬¬ä¸€ä¸ªæ¨¡å—æ˜¯ RTC çš„ é¢„åˆ†é¢‘æ¨¡å—</strong>ï¼Œå®ƒå¯ç¼–ç¨‹äº§ç”Ÿ 1 ç§’çš„ RTC æ—¶é—´åŸºå‡† TR_CLKã€‚RTC çš„é¢„åˆ†é¢‘æ¨¡å—åŒ…å«äº†ä¸€ä¸ª 20 ä½çš„å¯ç¼–ç¨‹åˆ†é¢‘å™¨(RTC é¢„åˆ†é¢‘å™¨)ã€‚å¦‚æœåœ¨ RTC_CR å¯„å­˜å™¨ä¸­è®¾ç½®äº†ç›¸åº”çš„å…è®¸ä½ï¼Œåˆ™åœ¨æ¯ä¸ª TR_CLK å‘¨æœŸä¸­ RTC äº§ç”Ÿä¸€ä¸ªä¸­æ–­(ç§’ä¸­æ–­)ã€‚<br><img src="https://img-blog.csdnimg.cn/2020032222362770.png"><br><strong>ç¬¬äºŒä¸ªæ¨¡å—æ˜¯ä¸€ä¸ª 32 ä½çš„å¯ç¼–ç¨‹è®¡æ•°å™¨ ï¼ˆRTC_CNTï¼‰</strong>ï¼Œå¯è¢«åˆå§‹åŒ–ä¸ºå½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œä¸€ä¸ª 32 ä½çš„æ—¶é’Ÿè®¡æ•°å™¨ï¼ŒæŒ‰ç§’é’Ÿè®¡ç®—ï¼Œå¯ä»¥è®° å½• 4294967296 ç§’ï¼Œçº¦åˆ 136 å¹´å·¦å³ï¼Œä½œä¸ºä¸€èˆ¬åº”ç”¨ï¼Œè¿™å·²ç»æ˜¯è¶³å¤Ÿäº†çš„ã€‚</p><h4 id="RTCå…·ä½“æµç¨‹ï¼š"><a href="#RTCå…·ä½“æµç¨‹ï¼š" class="headerlink" title="; RTCå…·ä½“æµç¨‹ï¼š"></a><a name="rtc_107">;</a> <strong>RTCå…·ä½“æµç¨‹ï¼š</strong></h4><p><strong>RTCCLKç»è¿‡RTC_DIVé¢„åˆ†é¢‘ï¼ŒRTC_PRLè®¾ç½®é¢„åˆ†é¢‘ç³»æ•°ï¼Œç„¶åå¾—åˆ°TR_CLKæ—¶é’Ÿä¿¡å·ï¼Œæˆ‘ä»¬ä¸€èˆ¬è®¾ç½®å…¶å‘¨æœŸä¸º1sï¼ŒRTC_CNTè®¡æ•°å™¨è®¡æ•°ï¼Œå‡å¦‚1970è®¾ç½®ä¸ºæ—¶é—´èµ·ç‚¹ä¸º0sï¼Œé€šè¿‡å½“å‰æ—¶é—´çš„ç§’æ•°è®¡ç®—å¾—åˆ°å½“å‰çš„æ—¶é—´ã€‚RTC_ALRæ˜¯è®¾ç½®é—¹é’Ÿæ—¶é—´ï¼ŒRTC_CNTè®¡æ•°åˆ°RTC_ALRå°±ä¼šäº§ç”Ÿè®¡æ•°ä¸­æ–­ï¼Œ</strong></p><ul><li><strong>RTC_Second</strong>ä¸ºç§’ä¸­æ–­ï¼Œç”¨äºåˆ·æ–°æ—¶é—´ï¼Œ</li><li><strong>RTC_Overflow</strong>æ˜¯æº¢å‡ºä¸­æ–­ã€‚</li><li><strong>RTC Alarm</strong> æ§åˆ¶å¼€å…³æœº</li></ul><h4 id="RTCæ—¶é’Ÿé€‰æ‹©"><a href="#RTCæ—¶é’Ÿé€‰æ‹©" class="headerlink" title="RTCæ—¶é’Ÿé€‰æ‹©"></a>RTCæ—¶é’Ÿé€‰æ‹©</h4><p><strong>ä½¿ç”¨HSEåˆ†é¢‘æ—¶é’Ÿæˆ–è€…LSIçš„æ—¶å€™,åœ¨ä¸»ç”µæºVDDæ‰ç”µçš„æƒ…å†µä¸‹,è¿™ä¸¤ä¸ªæ—¶é’Ÿæ¥æºéƒ½ä¼šå—åˆ°å½±å“,å› æ­¤æ²¡æ³•ä¿è¯RTCæ­£å¸¸å·¥ä½œ.æ‰€ä»¥RTCä¸€èˆ¬éƒ½æ—¶é’Ÿä½é€Ÿå¤–éƒ¨æ—¶é’ŸLSE,é¢‘ç‡ä¸ºå®æ—¶æ—¶é’Ÿæ¨¡å—ä¸­å¸¸ç”¨çš„32.768KHz,å› ä¸º32768 &#x3D; 2^15,åˆ†é¢‘å®¹æ˜“å®ç°,æ‰€ä»¥è¢«å¹¿æ³›åº”ç”¨åˆ°RTCæ¨¡å—.(åœ¨ä¸»ç”µæºVDDæœ‰æ•ˆçš„æƒ…å†µä¸‹(å¾…æœº),RTCè¿˜å¯ä»¥é…ç½®é—¹é’Ÿäº‹ä»¶ä½¿STM32é€€å‡ºå¾…æœºæ¨¡å¼).</strong></p><h4 id="RTCå¤ä½è¿‡ç¨‹"><a href="#RTCå¤ä½è¿‡ç¨‹" class="headerlink" title="RTCå¤ä½è¿‡ç¨‹"></a>RTCå¤ä½è¿‡ç¨‹</h4><p>é™¤äº†RTC_PRLã€RTC_ALRã€RTC_CNTå’ŒRTC_DIVå¯„å­˜å™¨å¤–ï¼Œæ‰€æœ‰çš„ç³»ç»Ÿå¯„å­˜å™¨éƒ½ç”±ç³»ç»Ÿå¤ä½æˆ–ç”µæºå¤ä½è¿›è¡Œå¼‚æ­¥å¤ä½ã€‚<br>RTC_PRLã€RTC_ALRã€RTC_CNTå’ŒRTC_DIVå¯„å­˜å™¨ä»…èƒ½é€šè¿‡å¤‡ä»½åŸŸå¤ä½ä¿¡å·å¤ä½ã€‚</p><p><strong>ç³»ç»Ÿå¤ä½å,ç¦æ­¢è®¿é—®åå¤‡å¯„å­˜å™¨å’ŒRCT,é˜²æ­¢å¯¹åå«åŒºåŸŸ(BKP)çš„æ„å¤–å†™æ“ä½œ</strong></p><h4 id="RTCä¸­æ–­"><a href="#RTCä¸­æ–­" class="headerlink" title="RTCä¸­æ–­"></a>RTCä¸­æ–­</h4><p><strong>ç§’ä¸­æ–­ï¼š</strong><br>è¿™é‡Œæ—¶é’Ÿè‡ªå¸¦ä¸€ä¸ªç§’ä¸­æ–­ï¼Œæ¯å½“è®¡æ•°åŠ ä¸€çš„æ—¶å€™å°±ä¼šè§¦å‘ä¸€æ¬¡ç§’ä¸­æ–­ï¼Œã€‚æ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„ç§’ä¸­æ–­å¹¶éä¸€å®šæ˜¯ä¸€ç§’çš„æ—¶é—´ï¼Œå®ƒæ˜¯ç”±RTCæ—¶é’Ÿæºå’Œåˆ†é¢‘å€¼å†³å®šçš„â€ç§’â€çš„æ—¶é—´ï¼Œå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥åšåˆ°1ç§’é’Ÿä¸­æ–­ä¸€æ¬¡ã€‚æˆ‘ä»¬é€šè¿‡å¾€ç§’ä¸­æ–­é‡Œå†™æ›´æ–°æ—¶é—´çš„å‡½æ•°æ¥è¾¾åˆ°æ—¶é—´åŒæ­¥çš„æ•ˆæœ</p><p><strong>é—¹é’Ÿä¸­æ–­ï¼š</strong><br>é—¹é’Ÿä¸­æ–­å°±æ˜¯è®¾ç½®ä¸€ä¸ªé¢„è®¾å®šçš„å€¼ï¼Œè®¡æ•°æ¯è‡ªåŠ å¤šå°‘æ¬¡è§¦å‘ä¸€æ¬¡é—¹é’Ÿä¸­æ–­</p><h3 id="CubeMXé…ç½®RTC"><a href="#CubeMXé…ç½®RTC" class="headerlink" title="CubeMXé…ç½®RTC"></a>CubeMXé…ç½®RTC</h3><h4 id="å·¥ç¨‹åˆ›å»º"><a href="#å·¥ç¨‹åˆ›å»º" class="headerlink" title="å·¥ç¨‹åˆ›å»º"></a>å·¥ç¨‹åˆ›å»º</h4><p><strong>1è®¾ç½®RCC</strong><br><img src="https://img-blog.csdnimg.cn/20200425101549368.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li><strong>è®¾ç½®é«˜é€Ÿå¤–éƒ¨æ—¶é’ŸHSE é€‰æ‹©å¤–éƒ¨æ—¶é’Ÿæº</strong></li><li>*<em>ä½¿èƒ½å¤–éƒ¨æ™¶æŒ¯LSE</em></li></ul><p><strong>RTCè®¾å¤‡å› ä¸ºå…¶ç‹¬ç‰¹çš„è¿è¡Œæ–¹å¼ï¼ˆå³æ‰ç”µä¾æ—§è¿è¡Œï¼‰ä½¿ç”¨HSEåˆ†é¢‘æ—¶é’Ÿæˆ–è€…LSIçš„æ—¶å€™,åœ¨ä¸»ç”µæºVDDæ‰ç”µçš„æƒ…å†µä¸‹,è¿™ä¸¤ä¸ªæ—¶é’Ÿæ¥æºéƒ½ä¼šå—åˆ°å½±å“ï¼Œèµ„æºæ¶ˆè€—å¤ªå¤§ï¼Œå°å°çš„çº½æ‰£ç”µæ± æ ¹æœ¬åƒä¸æ¶ˆã€‚æ²¡æ³•ä¿è¯RTCæ­£å¸¸å·¥ä½œ.æ‰€ä»¥RTCä¸€èˆ¬éƒ½æ—¶é’Ÿä½é€Ÿå¤–éƒ¨æ—¶é’ŸLSE</strong></p><ol start="2"><li><strong>é…ç½®RTC</strong><br><img src="https://img-blog.csdnimg.cn/20200425110730403.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></li></ol><ul><li><strong>Activate Clock Source æ¿€æ´»æ—¶é’Ÿæº</strong></li><li>*<em>Activate calendaræ¿€æ´»æ—¥å†</em></li></ul><p><strong>è¿™ä¸¤ä¸ªéƒ½è¦ç‚¹ï¼Œä½œç”¨ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå…ˆæ˜¯ä½¿èƒ½æ—¶é’Ÿæºï¼Œå†ä½¿èƒ½RTCæ—¥å†</strong></p><ul><li><strong>RTC_OUTï¼š Not RTC_OUT</strong></li><li><strong>Tamperï¼š</strong> *<em>Ã—</em></li></ul><p>ç¬¬ä¸€ä¸ªæ˜¯æ˜¯å¦ä½¿èƒ½ <strong>tamperï¼ˆPC13ï¼‰å¼•è„šä¸Šè¾“å‡ºæ ¡æ­£çš„ç§’è„‰å†²æ—¶é’Ÿï¼Œ</strong></p><p>ç¬¬äºŒä¸ªï¼š <strong>RTCå…¥ä¾µæ£€æµ‹æ ¡éªŒåŠŸèƒ½</strong></p><p><strong>RTCæ ¡éªŒåŠŸèƒ½ï¼Œä½¿èƒ½ä¾µå…¥æ£€æµ‹åŠŸèƒ½ã€‚RTCæ—¶é’Ÿç»64åˆ†é¢‘è¾“å‡ºåˆ°ä¾µå…¥æ£€æµ‹å¼•è„šTAMPERä¸Š<br> å½“ TAMPERå¼•è„šä¸Šçš„ä¿¡å·ä» 0å˜æˆ1æˆ–è€…ä» 1å˜æˆ 0(å–å†³äºå¤‡ä»½æ§åˆ¶å¯„å­˜å™¨BKP_CRçš„ TPALä½)ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªä¾µå…¥æ£€æµ‹äº‹ä»¶ã€‚ä¾µå…¥æ£€æµ‹äº‹ä»¶å°†æ‰€æœ‰æ•°æ®å¤‡ä»½å¯„å­˜å™¨å†…å®¹æ¸…é™¤ã€‚</strong></p><ol><li>ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªæ˜¯ä½¿èƒ½tamperï¼ˆPC13ï¼‰å¼•è„šä½œä¸ºæ—¶é’Ÿè„‰å†²è¾“å‡º</li><li>ç¬¬äºŒä¸ªæ˜¯ä½¿èƒ½tamperï¼ˆPC13ï¼‰å¼•è„šä½œä¸ºå…¥ä¾µæ£€æµ‹åŠŸèƒ½</li></ol><p>ä¸‹é¢æ˜¯ä¸¤ä¸ªRTCçš„ä¸­æ–­ï¼š</p><ul><li><strong>RTCå…¨å±€ä¸­æ–­RTC_IRQHandler()</strong></li><li>*<em>é—¹é’Ÿä¸­æ–­å‡½æ•°RTCAlarm_IRQHandler()</em></li></ul><p><img src="https://img-blog.csdnimg.cn/2020042514381771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p><strong>æ­¤å¤„è®¾ç½®æ—¶é—´ä¸º2020&#x2F;04&#x2F;25 13:30:00</strong></p><ul><li>Data Format: æ—¥æœŸæ ¼å¼</li></ul><p><strong>Binary data format åå…­è¿›åˆ¶<br>BCD data format BCDç è¿›åˆ¶</strong></p><p>ä½¿ç”¨è‡ªåŠ¨é…ç½®ï¼Œåˆå§‹åŒ–æ—¶é—´å¿…é¡»ä½¿ç”¨BCD data formatï¼ŒåŸå› æ˜¯åº“å‡½æ•°å­˜åœ¨bugï¼Œå¦‚æœä½¿ç”¨Binary data formatï¼Œæœˆä»½é…ç½®ä¼šå‡ºé”™ï¼Œæ¯”å¦‚è¯´11æœˆï¼Œé…ç½®æ—¶ä¼šèµ‹å€¼ä¸ºRTC_MONTH_NOVEMBERï¼Œè€Œæ­¤å®å®šä¹‰å€¼ä¸º0x11ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶åè¿›åˆ¶å€¼ä¸º17</p><ul><li><strong>Hoursï¼š å°æ—¶</strong></li><li><strong>Minutesï¼š åˆ†é’Ÿ</strong></li><li><strong>Secondsï¼š ç§’</strong></li><li><strong>Week Dayï¼š æ˜ŸæœŸ</strong></li><li><strong>Month æœˆä»½</strong></li><li><strong>Dateï¼š æ—¥æœŸ</strong></li><li>*<em>Yearï¼š å¹´ä»½</em></li></ul><p><strong>3 ä½¿èƒ½ä¸²å£</strong><br><img src="https://img-blog.csdnimg.cn/20200425143944495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"><br><strong>ä½¿èƒ½ä¸€ä¸‹ä¸²å£ï¼Œå› ä¸ºå‘é€æ—¥æœŸåˆ°ä¸Šä½æœº</strong></p><p><strong>4æ—¶é’Ÿæºè®¾ç½®</strong><br><img src="https://img-blog.csdnimg.cn/20200425144337169.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p>æˆ‘çš„æ˜¯ å¤–éƒ¨æ™¶æŒ¯ä¸º8MHz</p><ul><li>1é€‰æ‹©å¤–éƒ¨æ—¶é’ŸHSE 8MHz</li><li>2PLLé”ç›¸ç¯å€é¢‘9å€</li><li>3ç³»ç»Ÿæ—¶é’Ÿæ¥æºé€‰æ‹©ä¸ºPLL</li><li>4è®¾ç½®APB1åˆ†é¢‘å™¨ä¸º &#x2F;2</li><li>5 ä½¿èƒ½CSSç›‘è§†æ—¶é’Ÿ</li><li>*<em>6 è®¾ç½®RTCæ—¶é’Ÿä¸ºLSE</em></li></ul><p>32çš„æ—¶é’Ÿæ ‘æ¡†å›¾ å¦‚æœä¸æ‡‚çš„è¯è¯·çœ‹<a href="https://blog.csdn.net/as480133937/article/details/98845509">ã€Šã€STM32ã€‘ç³»ç»Ÿæ—¶é’ŸRCCè¯¦è§£(è¶…è¯¦ç»†ï¼Œè¶…å…¨é¢)ã€‹</a></p><p><strong>5é¡¹ç›®æ–‡ä»¶è®¾ç½®</strong><br><img src="https://img-blog.csdnimg.cn/20200425144600886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li>1 è®¾ç½®é¡¹ç›®åç§°</li><li>2 è®¾ç½®å­˜å‚¨è·¯å¾„</li><li>3 é€‰æ‹©æ‰€ç”¨IDE<br><img src="https://img-blog.csdnimg.cn/2020042514462236.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></li></ul><p><strong>6åˆ›å»ºå·¥ç¨‹æ–‡ä»¶</strong></p><p><strong>ç„¶åç‚¹å‡»GENERATE CODE åˆ›å»ºå·¥ç¨‹</strong></p><p><strong>é…ç½®ä¸‹è½½å·¥å…·</strong><br>æ–°å»ºçš„å·¥ç¨‹æ‰€æœ‰é…ç½®éƒ½æ˜¯é»˜è®¤çš„ æˆ‘ä»¬éœ€è¦è‡ªè¡Œé€‰æ‹©ä¸‹è½½æ¨¡å¼ï¼Œå‹¾é€‰ä¸Šä¸‹è½½åå¤ä½è¿è¡Œ</p><p><img src="https://img-blog.csdnimg.cn/202004251446415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><h4 id="RTC-HALåº“å‡½æ•°"><a href="#RTC-HALåº“å‡½æ•°" class="headerlink" title=";  RTC_HALåº“å‡½æ•°"></a><a name="rtc_hal_243">;</a>  RTC_HALåº“å‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetAlarm</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_AlarmTypeDef *sAlarm, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetAlarm_IT</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_AlarmTypeDef *sAlarm, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">__weak <span class="keyword">void</span> <span class="title function_">HAL_RTC_AlarmAEventCallback</span><span class="params">(RTC_HandleTypeDef *hrtc)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">HAL_RTCEx_BKUPWrite</span><span class="params">(RTC_HandleTypeDef *hrtc, uint32_t BackupRegister, uint32_t Data)</span></span><br><span class="line"></span><br><span class="line">uint32_t <span class="title function_">HAL_RTCEx_BKUPRead</span><span class="params">(RTC_HandleTypeDef *hrtc, uint32_t BackupRegister</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢çš„å››ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯</p><ul><li><strong>è®¾ç½®ç³»ç»Ÿæ—¶é—´ï¼šHAL_RTC_SetTime();</strong></li><li><strong>è¯»å–ç³»ç»Ÿæ—¶é—´: HAL_RTC_GetTime();</strong></li><li><strong>è®¾ç½®ç³»ç»Ÿæ—¥æœŸ: HAL_RTC_SetDate();</strong></li><li>*<em>è¯»å–ç³»ç»Ÿæ—¥æœŸ: HAL_RTC_GetDate();</em></li></ul><p>å› ä¸ºç³»ç»Ÿçš„æ—¶é—´å’Œæ—¥æœŸå¼€å§‹çš„æ—¶å€™å·²ç»è®¾ç½®è¿‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªç”¨ä¸¤ä¸ªè¯»å–å‡½æ•°</p><p><strong>è¯»å–ç³»ç»Ÿæ—¶é—´å‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br></pre></td></tr></table></figure><p>åŠŸèƒ½ï¼š è·å–RTCæ—¶é’Ÿçš„æ—¶é—´</p><p>å‚æ•°ï¼š</p><ul><li>*hrtc RTCç»“æ„ä½“å‚æ•° ä¾‹ï¼š&amp;hi2c2</li><li><strong>RTC_TimeTypeDef</strong> *sTimeï¼š è·å–RTCæ—¶é—´çš„ç»“æ„ä½“ï¼Œ</li><li>Formatï¼š <strong>è·å–æ—¶é—´çš„æ ¼å¼</strong><br>*<em>RTC_FORMAT_BIN ä½¿ç”¨16è¿›åˆ¶<br>RTC_FORMAT_BCD ä½¿ç”¨BCDè¿›åˆ¶</em></li></ul><p><strong>è¯»å–ç³»ç»Ÿæ—¥æœŸå‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br></pre></td></tr></table></figure><p>åŠŸèƒ½ï¼š è·å–RTCæ—¶é’Ÿçš„æ—¥æœŸ</p><p>å‚æ•°ï¼š</p><ul><li>*hrtc RTCç»“æ„ä½“å‚æ•° ä¾‹ï¼š&amp;hi2c2</li><li><strong>RTC_DateTypeDef</strong> *sTimeï¼š è·å–RTCæ—¥æœŸçš„ç»“æ„ä½“ï¼Œ</li><li>Formatï¼š <strong>è·å–æ—¥æœŸçš„æ ¼å¼</strong><br>*<em>RTC_FORMAT_BIN ä½¿ç”¨16è¿›åˆ¶<br>RTC_FORMAT_BCD ä½¿ç”¨BCDè¿›åˆ¶</em></li></ul><p>åœ¨stm32f1xx_hal_rtc.hå¤´æ–‡ä»¶ä¸­ï¼Œå¯ä»¥æ‰¾åˆ° <code>RTC_TimeTypeDef</code>ï¼Œ <code>RTC_DateTypeDef</code>è¿™ä¸¤ä¸ªç»“æ„ä½“çš„æˆå‘˜å˜é‡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">uint8_t</span> Hours;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Minutes;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Seconds;</span><br><span class="line"></span><br><span class="line">&#125; RTC_TimeTypeDef;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">uint8_t</span> WeekDay;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Month;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Date;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Year;</span><br><span class="line"></span><br><span class="line">&#125; RTC_DateTypeDef;</span><br></pre></td></tr></table></figure><p><strong>ç¨‹åºä»£ç ï¼š</strong></p><p>main.c</p><p><strong>åœ¨main.cä¸­é‡å†™fputcå‡½æ•°ï¼Œä½¿å¾—èƒ½å¤Ÿä½¿ç”¨printfå‡½æ•°</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">fputc</span><span class="params">(<span class="type">int</span> ch,FILE *f)</span>&#123;</span><br><span class="line"> <span class="type">uint8_t</span> temp[<span class="number">1</span>]=&#123;ch&#125;;</span><br><span class="line"> HAL_UART_Transmit(&amp;huart1,temp,<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"> <span class="keyword">return</span> ch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®šä¹‰ä¸¤ä¸ªç»“æ„ä½“æ¥è·å–æ—¥æœŸå’Œæ—¶é—´ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RTC_DateTypeDef GetData;</span><br><span class="line"></span><br><span class="line">RTC_TimeTypeDef GetTime;</span><br></pre></td></tr></table></figure><p>åœ¨whileå¾ªç¯ä¸­æ·»åŠ ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_RTC_GetTime(&amp;hrtc, &amp;GetTime, RTC_FORMAT_BIN);</span><br><span class="line"></span><br><span class="line">   HAL_RTC_GetDate(&amp;hrtc, &amp;GetData, RTC_FORMAT_BIN);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%02d/%02d/%02d\r\n&quot;</span>,<span class="number">2000</span> + GetData.Year, GetData.Month, GetData.Date);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%02d:%02d:%02d\r\n&quot;</span>,GetTime.Hours, GetTime.Minutes, GetTime.Seconds);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">   HAL_Delay(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p><strong>ç¨‹åºä¸­ä½¿ç”¨HAL_RTC_GetTimeï¼ˆï¼‰,HAL_RTC_GetDate()è¯»å–æ—¶é—´å’Œæ—¥æœŸï¼Œå¹¶ä¿å­˜åˆ°ç»“æ„ä½“å˜é‡ä¸­ï¼Œç„¶åé€šè¿‡ä¸²å£è¾“å‡ºè¯»å–çš„æ—¶é—´å’Œæ—¥æœŸã€‚</strong></p><p><strong>ä¾‹ç¨‹æµ‹è¯•æ­£å¸¸ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20200425153330941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><h4 id="RTCæ‰ç”µé‡ç½®"><a href="#RTCæ‰ç”µé‡ç½®" class="headerlink" title="RTCæ‰ç”µé‡ç½®"></a>RTCæ‰ç”µé‡ç½®</h4><p>ä½†æ˜¯å‘¢ï¼Œåœ¨halåº“ä¸­ç”Ÿæˆçš„ä»£ç ï¼Œ <strong>æ¯æ¬¡æ–­ç”µå°±RTCæ—¶é—´ä¼šé‡ç½®</strong>ï¼Œæ¯æ¬¡ä¸Šç”µéƒ½ä¼šé‡æ–°åˆå§‹åŒ–æ—¶é—´</p><p>å› ä¸ºHALåº“è®¾ç½®äº†ä¸€ä¸ªBKPå¯„å­˜å™¨ä¿å­˜ä¸€ä¸ªæ ‡å¿—ã€‚æ¯æ¬¡å•ç‰‡æœºå¯åŠ¨æ—¶éƒ½è¯»å–è¿™ä¸ªæ ‡å¿—å¹¶åˆ¤æ–­æ˜¯ä¸æ˜¯é¢„å…ˆè®¾å®šçš„å€¼ï¼šå¦‚åº¦æœä¸æ˜¯å°±åˆå§‹åŒ–RTCå¹¶è®¾ç½®æ—¶é—´ï¼Œå†è®¾ç½®æ ‡å¿—ä¸ºé¢„æœŸå€¼ï¼›å¦‚æœæ˜¯é¢„æœŸå€¼å°±è·³è¿‡åˆå§‹åŒ–å’Œæ—¶é—´è®¾ç½®ï¼Œç»§ç»­æ‰§è¡Œåé¢çš„ç¨‹åº</p><p><strong>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ¯æ¬¡ä¸Šç”µæ‰§è¡ŒRTCåˆå§‹åŒ–ä¹‹å‰ï¼Œå°†æ ‡å¿—è®¾ç½®ä¸ºé¢„æœŸå€¼å³å¯</strong></p><p><strong>åœ¨rtc.cä¸­çš„RTC_Initä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹å³å¯</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">void</span> <span class="title function_">MX_RTC_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">RTC_TimeTypeDef time;</span><br><span class="line">RTC_DateTypeDef datebuff;</span><br><span class="line"></span><br><span class="line">  RTC_TimeTypeDef sTime = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  RTC_DateTypeDef DateToUpdate = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">__HAL_RCC_BKP_CLK_ENABLE();</span><br><span class="line">__HAL_RCC_PWR_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">  hrtc.Instance = RTC;</span><br><span class="line">  hrtc.Init.AsynchPrediv = RTC_AUTO_1_SECOND;</span><br><span class="line">  hrtc.Init.OutPut = RTC_OUTPUTSOURCE_NONE;</span><br><span class="line">  <span class="keyword">if</span> (HAL_RTC_Init(&amp;hrtc) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(HAL_RTCEx_BKUPRead(&amp;hrtc,RTC_BKP_DR1)!= <span class="number">0x5051</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  sTime.Hours = <span class="number">0x14</span>;</span><br><span class="line">  sTime.Minutes = <span class="number">0x30</span>;</span><br><span class="line">  sTime.Seconds = <span class="number">0x0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (HAL_RTC_SetTime(&amp;hrtc, &amp;sTime, RTC_FORMAT_BCD) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line">  DateToUpdate.WeekDay = RTC_WEEKDAY_SATURDAY;</span><br><span class="line">  DateToUpdate.Month = RTC_MONTH_APRIL;</span><br><span class="line">  DateToUpdate.Date = <span class="number">0x25</span>;</span><br><span class="line">  DateToUpdate.Year = <span class="number">0x20</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (HAL_RTC_SetDate(&amp;hrtc, &amp;DateToUpdate, RTC_FORMAT_BCD) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">__HAL_RTC_SECOND_ENABLE_IT(&amp;hrtc,RTC_IT_SEC);</span><br><span class="line">datebuff = DateToUpdate;</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR1, <span class="number">0x5051</span>);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR2, (<span class="type">uint16_t</span>)datebuff.Year);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR3, (<span class="type">uint16_t</span>)datebuff.Month);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR4, (<span class="type">uint16_t</span>)datebuff.Date);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR5, (<span class="type">uint16_t</span>)datebuff.WeekDay);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">datebuff.Year    = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR2);</span><br><span class="line">datebuff.Month   = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR3);</span><br><span class="line">datebuff.Date    = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR4);</span><br><span class="line">datebuff.WeekDay = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR5);</span><br><span class="line">DateToUpdate = datebuff;</span><br><span class="line"><span class="keyword">if</span> (HAL_RTC_SetDate(&amp;hrtc, &amp;DateToUpdate, RTC_FORMAT_BIN) != HAL_OK)</span><br><span class="line">&#123;</span><br><span class="line">Error_Handler();</span><br><span class="line">&#125;</span><br><span class="line">__HAL_RTC_SECOND_ENABLE_IT(&amp;hrtc,RTC_IT_SEC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200425165901167.gif"><br><img src="https://img-blog.csdnimg.cn/20200425165904365.gif"></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32F407ä½¿ç”¨Helixåº“è½¯è§£MP3å¹¶é€šè¿‡DACè¾“å‡ºï¼Œæœ€ç²¾ç®€çš„STM32+SDå¡å®ç°MP3æ’­æ”¾å™¨</title>
      <link href="/2024/03/stm32-stm32-STM32F407%E4%BD%BF%E7%94%A8Helix%E5%BA%93%E8%BD%AF%E8%A7%A3MP3%E5%B9%B6%E9%80%9A%E8%BF%87DAC%E8%BE%93%E5%87%BA%EF%BC%8C%E6%9C%80%E7%B2%BE%E7%AE%80%E7%9A%84STM32-SD%E5%8D%A1%E5%AE%9E%E7%8E%B0MP3%E6%92%AD%E6%94%BE%E5%99%A8/"/>
      <url>/2024/03/stm32-stm32-STM32F407%E4%BD%BF%E7%94%A8Helix%E5%BA%93%E8%BD%AF%E8%A7%A3MP3%E5%B9%B6%E9%80%9A%E8%BF%87DAC%E8%BE%93%E5%87%BA%EF%BC%8C%E6%9C%80%E7%B2%BE%E7%AE%80%E7%9A%84STM32-SD%E5%8D%A1%E5%AE%9E%E7%8E%B0MP3%E6%92%AD%E6%94%BE%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>åªç”¨STM32å•ç‰‡æœº+SDå¡+è€³æœºæ’åº§ï¼Œå®ç°æ’­æ”¾MP3æ’­æ”¾å™¨ï¼</p><p>çœ‹è¿‡å¾ˆå¤šSTM32è½¯è§£MP3çš„æ–¹æ¡ˆï¼Œå³ä¸é€šè¿‡ç±»ä¼¼VS1053ä¹‹ç±»çš„è§£ç å™¨èŠ¯ç‰‡ï¼Œç›´æ¥ç”¨STM32å’Œè½¯ä»¶åº“è§£ç MP3æ–‡ä»¶ï¼Œé€šå¸¸ä½¿ç”¨äº†labmadæˆ–è€…Helixè§£ç åº“å®ç°ï¼ŒHelixç›¸å¯¹labmadå ç”¨çš„RAMæ›´å°‘ã€‚ä½†æ˜¯å¤§å¤šæ•°å‚è€ƒçš„æ–¹æ¡ˆè¿˜æ˜¯ç”¨äº†å¤–æ¥IISæ¥å£WM98xxä¹‹ç±»çš„éŸ³é¢‘DACèŠ¯ç‰‡æ’­æ”¾éŸ³é¢‘ï¼Œç¨æ˜¾å¤æ‚ç¹çã€‚STM32F407Vxæœ¬èº«å°±è‡ªå¸¦äº†2è·¯12ä½DACè¾“å‡ºï¼Œæœ€é«˜åˆ·æ–°é€Ÿåº¦333kHzï¼Œé™¤äº†åˆ†è¾¨ç‡å·®ç‚¹æ„æ€ï¼Œé€Ÿåº¦ä¸Šå¯¹äºMP3é€šå¸¸44.1kHzé‡‡æ ·ç‡æ¥è¯´ï¼Œç”¨æ¥æ’­æ”¾éŸ³é¢‘ç»°ç»°æœ‰ä½™äº†ã€‚æœ¬æ–‡ç»™çš„æ–¹æ¡ˆå’Œæºç ï¼Œç›´æ¥ç”¨STM32è½¯è§£ç MP3å¹¶ä½¿ç”¨è‡ªå¸¦çš„2ä¸ªDACè¾“å‡ºå¼•è„šè¾“å‡ºéŸ³é¢‘å·¦å³å£°é“ã€‚</p><p>åŸç†ï¼šSTM32ä»SDè¯»å–MP3æ–‡ä»¶åŸå§‹æ•°æ®ï¼Œå‘é€ç»™Helixåº“è§£ç ï¼ŒHelixè§£ç åè¾“å‡ºPCMæ•°æ®æµï¼Œå°†æ­¤æ•°æ®è¿›ä¸€æ­¥å¤„ç†è½¬æ¢åï¼ŒæŒ‰ç…§å·¦å³å£°é“åˆ†åˆ«å­˜å…¥DACè¾“å‡º1å’Œ2ç¼“å­˜ï¼Œé€šè¿‡å®šæ—¶å™¨ä»¥MP3æ–‡ä»¶çš„é‡‡æ ·ç‡çš„é¢‘ç‡æä¾›DACè§¦å‘èŠ‚æ‹ï¼Œé€šè¿‡DMAå–ç¼“å­˜ä¸­é«˜12ä½æ•°æ®ç»™DACï¼Œåœ¨DAC1å’Œ2å¼•è„šäº§ç”ŸéŸ³é¢‘æ³¢å½¢ï¼Œé€šè¿‡ç”µå®¹è€¦åˆåˆ°è€³æœºçš„å·¦å³å£°é“ä¸Šã€‚</p><p>MP3æºæ–‡ä»¶æ˜¯ä¸€ç§ç»è¿‡è‹¥å¹²ç®—æ³•ï¼Œå°†åŸå§‹éŸ³é¢‘æ•°æ®å‹ç¼©å¾—æ¥çš„ï¼Œè½¯ä»¶è§£ç çš„è¿‡ç¨‹æ˜¯é€†è¿‡ç¨‹ï¼Œå°†å‹ç¼©çš„éŸ³é¢‘åå‘è½¬æ¢ä¸ºè®°å½•äº†å·¦å³å£°é“ã€å¹…å€¼çš„æ•°æ®æµï¼Œé€šå¸¸æ˜¯PCMæ ¼å¼ã€‚</p><p>PCMï¼šæ˜¯æ¨¡æ‹Ÿä¿¡å·ä»¥å›ºå®šçš„é‡‡æ ·é¢‘ç‡è½¬æ¢æˆæ•°å­—ä¿¡å·åçš„è¡¨ç°å½¢å¼ã€‚è®°å½•äº†éŸ³é¢‘é‡‡æ ·çš„æ•°æ®ï¼ŒåŒé€šé“ã€16bitçš„PCMæ•°æ®æ ¼å¼æ˜¯ä»¥0è½´ä¸ºä¸­å¿ƒï¼ŒèŒƒå›´ä¸º-32768~32767çš„æ•°å€¼ï¼Œæ¯ä¸ªæ•°æ®å ç”¨2å­—èŠ‚ï¼Œå·¦å£°é“å’Œå³å£°é“äº¤æ›¿å­˜å‚¨ï¼Œå¦‚å›¾ã€‚</p><p><img src="https://img-blog.csdnimg.cn/694e98caa0d54f54939024bb8ccf386e.png"></p><p>è½¯è§£ç å¾—åˆ°çš„PCMæ•°æ®åˆ°STM32çš„DACç¼“å­˜éœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚STM32çš„DACæ˜¯12ä½çš„ï¼Œå…¶è¾“å…¥èŒƒå›´0<del>4095ï¼Œè€ŒåŒé€šé“16ä½çš„PCMéŸ³é¢‘æ•°æ®æ˜¯å·¦å³å£°é“äº¤æ›¿å­˜å‚¨ï¼Œä¸”æ•°æ®èŒƒå›´-32768</del>32767ï¼Œå› æ­¤PCMåˆ°STM32çš„DACç¼“å­˜è¦æŒ‰ç…§é¡ºåºä¸€æ‹†ä¸ºäºŒï¼Œåˆ†ä¸ºå·¦å³å£°é“ï¼Œæ¯ä¸ªæ•°æ®å†åŠ ä¸Š32768ï¼Œä½¿å…¶ç”±short intçš„èŒƒå›´è½¬æ¢ä¸ºunsigned short intï¼Œå³0~65535ã€‚ç”±äºPCMæ•°æ®æ˜¯å¯¹éŸ³é¢‘çš„é‡‡æ ·ï¼Œå› æ­¤è°ƒèŠ‚éŸ³é‡ï¼ˆå¹…å€¼ï¼‰å¯ä»¥åœ¨æ­¤æ­¥éª¤ä¸€å¹¶å¤„ç†ï¼Œå³éŸ³é¢‘æ•°æ® x éŸ³é‡ &#x2F;æœ€å¤§éŸ³é‡ã€‚è‡³äºDACæ˜¯12ä½ï¼Œåªéœ€å°†DACæ¨¡å¼è®¾ç½®ä¸ºå·¦å¯¹é½12ä½ï¼Œèˆå¼ƒä½4ä½å³å¯ã€‚</p><p>åˆ°æ­¤ï¼ŒSTM32çš„DACè¾“å‡ºå¼•è„šä¸Šåº”è¯¥å·²ç»æœ‰éŸ³é¢‘ä¿¡å·äº†ï¼Œé€šå¸¸DACå¼•è„šä¸Šä¸²è”ä¸€ä¸ª1~10uFçš„ç”µå®¹ç”¨æ¥è€¦åˆéŸ³é¢‘ä¿¡å·ï¼Œç”µå®¹è¶Šå¤§éŸ³è´¨è¶Šå¥½ï¼Œç”µå®¹å¦ä¸€ç«¯æ¥è€³æœºæ’åº§çš„å·¦å£°é“&#x2F;å³å£°é“ï¼Œæ’ä¸Šè€³æœºå°±å¯ä»¥æ¬£èµéŸ³ä¹å•¦ï¼éŸ³è´¨å˜›ï¼Œåæ­£æˆ‘æ˜¯å¬ä¸å‡ºæ¥å¥½ä¸å¥½ï¼Œè·Ÿå•†å“MP3æ’­æ”¾å™¨å·®ä¸å¤šã€‚å¦‚æœä¸ä¸²è”ç”µå®¹ï¼ŒDACå¼•è„šç›´è¿è€³æœºæ’åº§å·¦å³å£°é“ä¹Ÿèƒ½å¬åˆ°å£°éŸ³ï¼Œå°±æ˜¯æœ‰äº›æ•°å­—ä¿¡å·å™ªå£°ä¹Ÿä¼šä¼ è¿›æ¥ã€‚å¦‚æœå¸Œæœ›å™ªå£°å°ä¸€äº›ï¼ŒDACå¼•è„šè¾“å‡ºç«¯åŠ ä¸€ä¸ªä¸‹å›¾çš„ä½é€šæ»¤æ³¢ç”µè·¯ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p><img src="https://img-blog.csdnimg.cn/f132f4062140488bbdfc5c5d375776a2.jpeg"></p><p><img src="https://img-blog.csdnimg.cn/44697c32a37541ea990a3a9d5911e091.jpeg"></p><p>Helixç§»æ¤ï¼š</p><p>Helixæºç çš„å®˜ç½‘æˆ‘æ²¡æ‰¾åˆ°ï¼Œç›´æ¥ç”¨äº†é‡ç«çš„ä¾‹ç¨‹é‡Œé¢çš„ä»£ç ï¼Œç§»æ¤ä¹Ÿå¾ˆç®€å•ï¼Œä¸ç”¨æ”¹ä»»ä½•ä»£ç ï¼Œåªéœ€è¦å°†Helixæ–‡ä»¶å¤¹æ‹·è´åˆ°å·¥ç¨‹ç›®å½•é‡Œï¼Œç„¶ååœ¨Keilä¸­æ·»åŠ å¥½æ–‡ä»¶ï¼Œä»¥åŠæ·»åŠ å¤´æ–‡ä»¶é€”å¾„ï¼Œç¼–è¯‘å³å¯ã€‚å·¥ç¨‹ç›®å½•å¦‚å›¾ã€‚</p><p><img src="https://img-blog.csdnimg.cn/bb0d0811712140ae83b917fa128509d9.jpeg"></p><p>æºç ï¼šdacé…ç½®</p><p>dac.c</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  ******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    dac.c</span></span><br><span class="line"><span class="comment">  * @author  ZL</span></span><br><span class="line"><span class="comment">  * @version V0.0.1</span></span><br><span class="line"><span class="comment">  * @date    September-20-2019</span></span><br><span class="line"><span class="comment">  * @brief   DAC configuration.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  ******************************************************************************</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dac.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private typedef -----------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* Private define ------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>   CNT_FREQ          84000000      <span class="comment">// TIM6 counter clock (prescaled APB1)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* DHR registers offsets */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHR12R1_OFFSET             ((uint32_t)0x00000008)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHR12R2_OFFSET             ((uint32_t)0x00000014)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DHR12RD_OFFSET             ((uint32_t)0x00000020)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private macro -------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* Private variables ---------------------------------------------------------*/</span></span><br><span class="line"><span class="type">uint32_t</span> DAC_DHR12R1_ADDR = (<span class="type">uint32_t</span>)DAC_BASE + DHR12R1_OFFSET + DAC_Align_12b_L;</span><br><span class="line"><span class="type">uint32_t</span> DAC_DHR12R2_ADDR = (<span class="type">uint32_t</span>)DAC_BASE + DHR12R2_OFFSET + DAC_Align_12b_L;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> DAC_buff[<span class="number">2</span>][DAC_BUF_LEN]; <span class="comment">//DAC1ã€DAC2è¾“å‡ºç¼“å†²</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private function prototypes -----------------------------------------------*/</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">TIM6_Config</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Private functions ---------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  DACåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">  * @param  none</span></span><br><span class="line"><span class="comment">  * @retval none</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_Config</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">GPIO_InitTypeDef  GPIO_InitStructure;</span><br><span class="line">DAC_InitTypeDef  DAC_InitStructure;</span><br><span class="line"></span><br><span class="line"><span class="built_in">RCC_AHB1PeriphClockCmd</span>(RCC_AHB1Periph_GPIOA, ENABLE);</span><br><span class="line"><span class="built_in">RCC_APB1PeriphClockCmd</span>(RCC_APB1Periph_DAC, ENABLE);</span><br><span class="line"></span><br><span class="line">GPIO_InitStructure.GPIO_Pin = GPIO_Pin_4 | GPIO_Pin_5;</span><br><span class="line"></span><br><span class="line">GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AN;</span><br><span class="line">GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;</span><br><span class="line">GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;</span><br><span class="line">GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;</span><br><span class="line"><span class="built_in">GPIO_Init</span>(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">DAC_InitStructure.DAC_WaveGeneration = DAC_WaveGeneration_None;</span><br><span class="line">DAC_InitStructure.DAC_Trigger = DAC_Trigger_T6_TRGO;</span><br><span class="line">DAC_InitStructure.DAC_OutputBuffer = DAC_OutputBuffer_Enable;</span><br><span class="line"><span class="built_in">DAC_Init</span>(DAC_Channel_1, &amp;DAC_InitStructure);</span><br><span class="line"><span class="built_in">DAC_Init</span>(DAC_Channel_2, &amp;DAC_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®DMA</span></span><br><span class="line">DMA_InitTypeDef DMA_InitStruct;</span><br><span class="line"><span class="built_in">DMA_StructInit</span>(&amp;DMA_InitStruct);</span><br><span class="line"></span><br><span class="line"><span class="built_in">RCC_AHB1PeriphClockCmd</span>(RCC_AHB1Periph_DMA1, ENABLE);</span><br><span class="line"></span><br><span class="line">DMA_InitStruct.DMA_PeripheralBaseAddr = (u32)DAC_DHR12R1_ADDR;</span><br><span class="line">DMA_InitStruct.DMA_Memory0BaseAddr = (u32)&amp;DAC_buff[<span class="number">0</span>];<span class="comment">//DAC1</span></span><br><span class="line">DMA_InitStruct.DMA_DIR = DMA_DIR_MemoryToPeripheral;</span><br><span class="line">DMA_InitStruct.DMA_BufferSize = DAC_BUF_LEN;</span><br><span class="line">DMA_InitStruct.DMA_PeripheralInc = DMA_PeripheralInc_Disable;</span><br><span class="line">DMA_InitStruct.DMA_MemoryInc = DMA_MemoryInc_Enable;</span><br><span class="line">DMA_InitStruct.DMA_PeripheralDataSize = DMA_PeripheralDataSize_HalfWord;</span><br><span class="line">DMA_InitStruct.DMA_MemoryDataSize = DMA_MemoryDataSize_HalfWord;</span><br><span class="line">DMA_InitStruct.DMA_Mode = DMA_Mode_Circular;</span><br><span class="line">DMA_InitStruct.DMA_Priority = DMA_Priority_High;</span><br><span class="line">DMA_InitStruct.DMA_Channel = DMA_Channel_7;</span><br><span class="line">DMA_InitStruct.DMA_FIFOMode = DMA_FIFOMode_Disable;</span><br><span class="line">DMA_InitStruct.DMA_FIFOThreshold = DMA_FIFOThreshold_HalfFull;</span><br><span class="line">  DMA_InitStruct.DMA_MemoryBurst   = DMA_MemoryBurst_Single;</span><br><span class="line">  DMA_InitStruct.DMA_PeripheralBurst = DMA_PeripheralBurst_Single;</span><br><span class="line"></span><br><span class="line"><span class="built_in">DMA_Init</span>(DMA1_Stream5, &amp;DMA_InitStruct);</span><br><span class="line"></span><br><span class="line">DMA_InitStruct.DMA_PeripheralBaseAddr = (u32)DAC_DHR12R2_ADDR;</span><br><span class="line">DMA_InitStruct.DMA_Memory0BaseAddr = (u32)&amp;DAC_buff[<span class="number">1</span>];<span class="comment">//DAC2</span></span><br><span class="line"><span class="built_in">DMA_Init</span>(DMA1_Stream6, &amp;DMA_InitStruct);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯DMAä¼ è¾“å®Œæˆä¸­æ–­</span></span><br><span class="line">NVIC_InitTypeDef NVIC_InitStructure;</span><br><span class="line"></span><br><span class="line">  NVIC_InitStructure.NVIC_IRQChannel = DMA1_Stream6_IRQn;</span><br><span class="line">  NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = <span class="number">0</span>;</span><br><span class="line">  NVIC_InitStructure.NVIC_IRQChannelSubPriority = <span class="number">1</span>;</span><br><span class="line">  NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;</span><br><span class="line">  <span class="built_in">NVIC_Init</span>(&amp;NVIC_InitStructure);</span><br><span class="line"></span><br><span class="line"><span class="built_in">DMA_ClearITPendingBit</span>(DMA1_Stream6, DMA_IT_TCIF6);</span><br><span class="line"><span class="built_in">DMA_ClearITPendingBit</span>(DMA1_Stream6, DMA_IT_HTIF6);</span><br><span class="line"><span class="built_in">DMA_ITConfig</span>(DMA1_Stream6, DMA_IT_TC, ENABLE);</span><br><span class="line"><span class="built_in">DMA_ITConfig</span>(DMA1_Stream6, DMA_IT_HT, ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//DMA_Cmd(DMA1_Stream5, ENABLE);</span></span><br><span class="line"><span class="comment">//DMA_Cmd(DMA1_Stream6, ENABLE);</span></span><br><span class="line"><span class="built_in">DAC_Cmd</span>(DAC_Channel_1, ENABLE);</span><br><span class="line">  <span class="built_in">DAC_Cmd</span>(DAC_Channel_2, ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="built_in">DAC_DMACmd</span>(DAC_Channel_1, ENABLE);</span><br><span class="line"><span class="built_in">DAC_DMACmd</span>(DAC_Channel_2, ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="built_in">TIM6_Config</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®DACé‡‡æ ·ç‡å’ŒDMAæ•°æ®é•¿åº¦ï¼Œå¹¶å¯åŠ¨DMA DAC</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_DMA_Start</span><span class="params">(<span class="type">uint32_t</span> freq, <span class="type">uint16_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//è®¾ç½®DMAç¼“å†²é•¿åº¦éœ€è¦åœæ­¢DMA</span></span><br><span class="line"><span class="built_in">DAC_DMA_Stop</span>();</span><br><span class="line"><span class="comment">//è®¾ç½®DMA DACç¼“å†²é•¿åº¦</span></span><br><span class="line"><span class="built_in">DMA_SetCurrDataCounter</span>(DMA1_Stream5, len);</span><br><span class="line"><span class="built_in">DMA_SetCurrDataCounter</span>(DMA1_Stream6, len);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®å®šæ—¶å™¨</span></span><br><span class="line"><span class="built_in">TIM_SetAutoreload</span>(TIM6, (<span class="type">uint16_t</span>)((CNT_FREQ)/freq));</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨</span></span><br><span class="line"><span class="built_in">DMA_Cmd</span>(DMA1_Stream5, ENABLE);</span><br><span class="line"><span class="built_in">DMA_Cmd</span>(DMA1_Stream6, ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åœæ­¢DMA DAC</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_DMA_Stop</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">DMA_Cmd</span>(DMA1_Stream5, DISABLE);</span><br><span class="line"><span class="built_in">DMA_Cmd</span>(DMA1_Stream6, DISABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šæ—¶å™¨6ç”¨äºè®¾ç½®DACåˆ·æ–°ç‡</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">TIM6_Config</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  TIM_TimeBaseInitTypeDef TIM6_TimeBase;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">RCC_APB1PeriphClockCmd</span>(RCC_APB1Periph_TIM6, ENABLE);</span><br><span class="line">  <span class="built_in">TIM_TimeBaseStructInit</span>(&amp;TIM6_TimeBase);</span><br><span class="line"></span><br><span class="line">  TIM6_TimeBase.TIM_Period        = (<span class="type">uint16_t</span>)((CNT_FREQ)/<span class="number">44100</span>);</span><br><span class="line">  TIM6_TimeBase.TIM_Prescaler     = <span class="number">0</span>;</span><br><span class="line">  TIM6_TimeBase.TIM_ClockDivision = <span class="number">0</span>;</span><br><span class="line">  TIM6_TimeBase.TIM_CounterMode   = TIM_CounterMode_Up;</span><br><span class="line">  <span class="built_in">TIM_TimeBaseInit</span>(TIM6, &amp;TIM6_TimeBase);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">TIM_SelectOutputTrigger</span>(TIM6, TIM_TRGOSource_Update);</span><br><span class="line">  <span class="built_in">TIM_Cmd</span>(TIM6, ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  DAC out1 PA4è¾“å‡ºç”µå‹</span></span><br><span class="line"><span class="comment">  * @param  datï¼šdacæ•°å€¼:ï¼Œ0~4095</span></span><br><span class="line"><span class="comment">  * @retval none</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_Out1</span><span class="params">(<span class="type">uint16_t</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">DAC_SetChannel1Data</span>(DAC_Align_12b_R,  dat);</span><br><span class="line"><span class="built_in">DAC_SoftwareTriggerCmd</span>(DAC_Channel_1, ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  DAC out2 PA5è¾“å‡ºç”µå‹</span></span><br><span class="line"><span class="comment">  * @param  datï¼šdacæ•°å€¼:ï¼Œ0~4095</span></span><br><span class="line"><span class="comment">  * @retval none</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DAC_Out2</span><span class="params">(<span class="type">uint16_t</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">DAC_SetChannel2Data</span>(DAC_Align_12b_R,  dat);</span><br><span class="line"><span class="built_in">DAC_SoftwareTriggerCmd</span>(DAC_Channel_2, ENABLE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************************************* *****END OF FILE****/</span></span><br></pre></td></tr></table></figure><p>æºç ï¼šMP3æ’­æ”¾æµç¨‹ ï¼ˆåŸåˆ›é‡ç«ï¼Œå‚è€ƒäº†é‡ç«çš„ä¾‹ç¨‹ï¼Œæœ¬äººè¿›è¡Œæ•´ç†å’Œä¿®æ”¹ï¼‰</p><p>MP3player.c</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">******************************************************************************</span></span><br><span class="line"><span class="comment">* @file    mp3Player.c</span></span><br><span class="line"><span class="comment">* @author  fire</span></span><br><span class="line"><span class="comment">* @version V1.0</span></span><br><span class="line"><span class="comment">* @date    2023-08-13</span></span><br><span class="line"><span class="comment">* @brief   mp3è§£ç </span></span><br><span class="line"><span class="comment">******************************************************************************</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ff.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mp3Player.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mp3dec.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dac.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;led.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ¨èä½¿ç”¨ä»¥ä¸‹æ ¼å¼mp3æ–‡ä»¶ï¼š</span></span><br><span class="line"><span class="comment"> * é‡‡æ ·ç‡ï¼š44100Hz</span></span><br><span class="line"><span class="comment"> * å£°  é“ï¼š2</span></span><br><span class="line"><span class="comment"> * æ¯”ç‰¹ç‡ï¼š320kbps</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¤„ç†ç«‹ä½“å£°éŸ³é¢‘æ•°æ®æ—¶ï¼Œè¾“å‡ºç¼“å†²åŒºéœ€è¦çš„æœ€å¤§å¤§å°ä¸º2304*16/8å­—èŠ‚(16ä¸ºPCMæ•°æ®ä¸º16ä½)ï¼Œ</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œæˆ‘ä»¬å®šä¹‰MP3BUFFER_SIZEä¸º2304</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MP3BUFFER_SIZE  2304</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INPUTBUF_SIZE   3000</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> HMP3DecoderMp3Decoder;<span class="comment">/* mp3è§£ç å™¨æŒ‡é’ˆ*/</span></span><br><span class="line"><span class="type">static</span> MP3FrameInfoMp3FrameInfo;<span class="comment">/* mP3å¸§ä¿¡æ¯  */</span></span><br><span class="line"><span class="type">static</span> MP3_TYPE mp3player;            <span class="comment">/* mp3æ’­æ”¾è®¾å¤‡ */</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">uint8_t</span> Isread = <span class="number">0</span>;          <span class="comment">/* DMAä¼ è¾“å®Œæˆæ ‡å¿— */</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="type">uint8_t</span> dac_ht = <span class="number">0</span>;          <span class="comment">//DAC dma åŠä¼ è¾“æ ‡å¿—</span></span><br><span class="line"></span><br><span class="line"><span class="type">uint32_t</span> led_delay = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> inputbuf[INPUTBUF_SIZE]=&#123;<span class="number">0</span>&#125;;     <span class="comment">/* è§£ç è¾“å…¥ç¼“å†²åŒºï¼Œ1940å­—èŠ‚ä¸ºæœ€å¤§MP3å¸§å¤§å°  */</span></span><br><span class="line"><span class="type">static</span> <span class="type">short</span> outbuffer[MP3BUFFER_SIZE];  <span class="comment">/* è§£ç è¾“å‡ºç¼“å†²åŒº*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> FIL file;<span class="comment">/* file objects */</span></span><br><span class="line"><span class="type">static</span> UINT bw;       <span class="comment">/* File R/W count */</span></span><br><span class="line">FRESULT result;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»SDå¡è¯»å–MP3æºæ–‡ä»¶è¿›è¡Œè§£ç ï¼Œå¹¶ä¼ å…¥DACç¼“å†²åŒº</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MP3DataDecoder</span><span class="params">(<span class="type">uint8_t</span> **read_ptr, <span class="type">int</span> *bytes_left)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> err = <span class="number">0</span>, i = <span class="number">0</span>, outputSamps = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//bufflagå¼€å§‹è§£ç  å‚æ•°ï¼šmp3è§£ç ç»“æ„ä½“ã€è¾“å…¥æµæŒ‡é’ˆã€è¾“å…¥æµå¤§å°ã€è¾“å‡ºæµæŒ‡é’ˆã€æ•°æ®æ ¼å¼</span></span><br><span class="line">err = <span class="built_in">MP3Decode</span>(Mp3Decoder, read_ptr, bytes_left, outbuffer, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (err != ERR_MP3_NONE)<span class="comment">//é”™è¯¯å¤„ç†</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">switch</span> (err)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> ERR_MP3_INDATA_UNDERFLOW:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ERR_MP3_INDATA_UNDERFLOW\r\n&quot;</span>);</span><br><span class="line">result = <span class="built_in">f_read</span>(&amp;file, inputbuf, INPUTBUF_SIZE, &amp;bw);</span><br><span class="line">*read_ptr = inputbuf;</span><br><span class="line">*bytes_left = bw;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> ERR_MP3_MAINDATA_UNDERFLOW:</span><br><span class="line"><span class="comment">/* do nothing - next call to decode will provide more mainData */</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ERR_MP3_MAINDATA_UNDERFLOW\r\n&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;UNKNOWN ERROR:%d\r\n&quot;</span>, err);</span><br><span class="line"><span class="comment">// è·³è¿‡æ­¤å¸§</span></span><br><span class="line"><span class="keyword">if</span> (*bytes_left &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">(*bytes_left) --;</span><br><span class="line">read_ptr ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">//è§£ç æ— é”™è¯¯ï¼Œå‡†å¤‡æŠŠæ•°æ®è¾“å‡ºåˆ°PCM</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MP3GetLastFrameInfo</span>(Mp3Decoder, &amp;Mp3FrameInfo);<span class="comment">//è·å–è§£ç ä¿¡æ¯</span></span><br><span class="line"><span class="comment">/* è¾“å‡ºåˆ°DAC */</span></span><br><span class="line">outputSamps = Mp3FrameInfo.outputSamps;<span class="comment">//PCMæ•°æ®ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">if</span> (outputSamps &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (Mp3FrameInfo.nChans == <span class="number">1</span>)<span class="comment">//å•å£°é“</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å•å£°é“æ•°æ®éœ€è¦å¤åˆ¶ä¸€ä»½åˆ°å¦ä¸€ä¸ªå£°é“</span></span><br><span class="line"><span class="keyword">for</span> (i = outputSamps - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line">outbuffer[i * <span class="number">2</span>] = outbuffer[i];</span><br><span class="line">outbuffer[i * <span class="number">2</span> + <span class="number">1</span>] = outbuffer[i];</span><br><span class="line">&#125;</span><br><span class="line">outputSamps *= <span class="number">2</span>;</span><br><span class="line">&#125;<span class="comment">//if (Mp3FrameInfo.nChans == 1)//å•å£°é“</span></span><br><span class="line">&#125;<span class="comment">//if (outputSamps &gt; 0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†æ•°æ®ä¼ é€è‡³DMA DACç¼“å†²åŒº</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; outputSamps/<span class="number">2</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(dac_ht == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">DAC_buff[<span class="number">0</span>][i] = outbuffer[<span class="number">2</span>*i] * mp3player.ucVolume /<span class="number">100</span> + <span class="number">32768</span>;</span><br><span class="line">DAC_buff[<span class="number">1</span>][i] = outbuffer[<span class="number">2</span>*i+<span class="number">1</span>] * mp3player.ucVolume /<span class="number">100</span> + <span class="number">32768</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">DAC_buff[<span class="number">0</span>][i+outputSamps/<span class="number">2</span>] = outbuffer[<span class="number">2</span>*i] * mp3player.ucVolume /<span class="number">100</span> + <span class="number">32768</span>;</span><br><span class="line">DAC_buff[<span class="number">1</span>][i+outputSamps/<span class="number">2</span>] = outbuffer[<span class="number">2</span>*i+<span class="number">1</span>] * mp3player.ucVolume /<span class="number">100</span> + <span class="number">32768</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;<span class="comment">//else è§£ç æ­£å¸¸</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯»å–ä¸€æ®µMP3æ•°æ®ï¼Œå¹¶æŠŠè¯»å–çš„æŒ‡é’ˆèµ‹å€¼read_ptrï¼Œé•¿åº¦èµ‹å€¼bytes_left</span></span><br><span class="line"><span class="function"><span class="type">uint8_t</span> <span class="title">read_file</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *mp3file, <span class="type">uint8_t</span> **read_ptr, <span class="type">int</span> *bytes_left)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">result = <span class="built_in">f_read</span>(&amp;file, inputbuf, INPUTBUF_SIZE, &amp;bw);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(result != FR_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;è¯»å–%så¤±è´¥ -&gt; %d\r\n&quot;</span>, mp3file, result);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">*read_ptr = inputbuf;</span><br><span class="line">*bytes_left = bw;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  MP3æ ¼å¼éŸ³é¢‘æ’­æ”¾ä¸»ç¨‹åº</span></span><br><span class="line"><span class="comment">  * @param  mp3file MP3æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="comment">  * @retval æ— </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mp3PlayerDemo</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *mp3file)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">uint8_t</span> *read_ptr = inputbuf;</span><br><span class="line"><span class="type">int</span>read_offset = <span class="number">0</span>;<span class="comment">/* è¯»åç§»æŒ‡é’ˆ */</span></span><br><span class="line"><span class="type">int</span>bytes_left = <span class="number">0</span>;<span class="comment">/* å‰©ä½™å­—èŠ‚æ•° */</span></span><br><span class="line"></span><br><span class="line">mp3player.ucStatus = STA_IDLE;</span><br><span class="line">mp3player.ucVolume = <span class="number">15</span>; <span class="comment">//éŸ³é‡å€¼ï¼Œ100æ»¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è¯•æ‰“å¼€MP3æ–‡ä»¶</span></span><br><span class="line">result = <span class="built_in">f_open</span>(&amp;file, mp3file, FA_READ);</span><br><span class="line"><span class="keyword">if</span>(result != FR_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Open mp3file :%s fail!!!-&gt;%d\r\n&quot;</span>, mp3file, result);</span><br><span class="line">result = <span class="built_in">f_close</span> (&amp;file);</span><br><span class="line"><span class="keyword">return</span>;<span class="comment">/* åœæ­¢æ’­æ”¾ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;å½“å‰æ’­æ”¾æ–‡ä»¶ -&gt; %s\n&quot;</span>, mp3file);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–MP3è§£ç å™¨</span></span><br><span class="line">Mp3Decoder = <span class="built_in">MP3InitDecoder</span>();</span><br><span class="line"><span class="keyword">if</span>(Mp3Decoder == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;åˆå§‹åŒ–helixè§£ç åº“è®¾å¤‡å¤±è´¥ï¼\r\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;<span class="comment">/* åœæ­¢æ’­æ”¾ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;åˆå§‹åŒ–helixè§£ç åº“å®Œæˆ\r\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è¯•è¯»å–ä¸€æ®µMP3æ•°æ®ï¼Œå¹¶æŠŠè¯»å–çš„æŒ‡é’ˆèµ‹å€¼read_ptrï¼Œé•¿åº¦èµ‹å€¼bytes_left</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">read_file</span>(mp3file, &amp;read_ptr, &amp;bytes_left))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MP3FreeDecoder</span>(Mp3Decoder);</span><br><span class="line"><span class="keyword">return</span>;<span class="comment">/* åœæ­¢æ’­æ”¾ */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°è¯•è§£ç æˆåŠŸ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">MP3DataDecoder</span>(&amp;read_ptr, &amp;bytes_left))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//æ‰“å°MP3ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n Bitrate       %dKbps&quot;</span>, Mp3FrameInfo.bitrate/<span class="number">1000</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n Samprate      %dHz&quot;</span>,   Mp3FrameInfo.samprate);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n BitsPerSample %db&quot;</span>,    Mp3FrameInfo.bitsPerSample);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n nChans        %d&quot;</span>,     Mp3FrameInfo.nChans);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n Layer         %d&quot;</span>,     Mp3FrameInfo.layer);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n Version       %d&quot;</span>,     Mp3FrameInfo.version);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot; \r\n OutputSamps   %d&quot;</span>,     Mp3FrameInfo.outputSamps);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯åŠ¨DACï¼Œå¼€å§‹å‘å£°</span></span><br><span class="line"><span class="keyword">if</span> (Mp3FrameInfo.nChans == <span class="number">1</span>)<span class="comment">//å•å£°é“è¦å°†outputSamps*2</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DAC_DMA_Start</span>(Mp3FrameInfo.samprate, <span class="number">2</span> * Mp3FrameInfo.outputSamps);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">//åŒå£°é“ç›´æ¥ç”¨Mp3FrameInfo.outputSamps</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">DAC_DMA_Start</span>(Mp3FrameInfo.samprate, Mp3FrameInfo.outputSamps);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="comment">//è§£ç å¤±è´¥</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">MP3FreeDecoder</span>(Mp3Decoder);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ”¾éŸ³çŠ¶æ€ */</span></span><br><span class="line">mp3player.ucStatus = STA_PLAYING;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¿›å…¥ä¸»ç¨‹åºå¾ªç¯ä½“ */</span></span><br><span class="line"><span class="keyword">while</span>(mp3player.ucStatus == STA_PLAYING)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//å¯»æ‰¾å¸§åŒæ­¥ï¼Œè¿”å›ç¬¬ä¸€ä¸ªåŒæ­¥å­—çš„ä½ç½®</span></span><br><span class="line">read_offset = <span class="built_in">MP3FindSyncWord</span>(read_ptr, bytes_left);</span><br><span class="line"><span class="keyword">if</span>(read_offset &lt; <span class="number">0</span>)<span class="comment">//æ²¡æœ‰æ‰¾åˆ°åŒæ­¥å­—</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">read_file</span>(mp3file, &amp;read_ptr, &amp;bytes_left))<span class="comment">//é‡æ–°è¯»å–ä¸€æ¬¡æ–‡ä»¶å†æ‰¾</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">continue</span>;<span class="comment">//å›åˆ°while(mp3player.ucStatus == STA_PLAYING)åé¢</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span><span class="comment">//æ‰¾åˆ°åŒæ­¥å­—</span></span><br><span class="line">&#123;</span><br><span class="line">read_ptr   += read_offset;<span class="comment">//åç§»è‡³åŒæ­¥å­—çš„ä½ç½®</span></span><br><span class="line">bytes_left -= read_offset;<span class="comment">//åŒæ­¥å­—ä¹‹åçš„æ•°æ®å¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(bytes_left &lt; <span class="number">1024</span>)<span class="comment">//å¦‚æœå‰©ä½™çš„æ•°æ®å°äº1024å­—èŠ‚ï¼Œè¡¥å……æ•°æ®</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* æ³¨æ„è¿™ä¸ªåœ°æ–¹å› ä¸ºé‡‡ç”¨çš„æ˜¯DMAè¯»å–ï¼Œæ‰€ä»¥ä¸€å®šè¦4å­—èŠ‚å¯¹é½  */</span></span><br><span class="line">u16 i = (<span class="type">uint32_t</span>)(bytes_left)&amp;<span class="number">3</span>;<span class="comment">//åˆ¤æ–­å¤šä½™çš„å­—èŠ‚</span></span><br><span class="line"><span class="keyword">if</span>(i) i=<span class="number">4</span>-i;<span class="comment">//éœ€è¦è¡¥å……çš„å­—èŠ‚</span></span><br><span class="line"><span class="built_in">memcpy</span>(inputbuf+i, read_ptr, bytes_left);<span class="comment">//ä»å¯¹é½ä½ç½®å¼€å§‹å¤åˆ¶</span></span><br><span class="line">read_ptr = inputbuf+i;<span class="comment">//æŒ‡å‘æ•°æ®å¯¹é½ä½ç½®</span></span><br><span class="line">result = <span class="built_in">f_read</span>(&amp;file, inputbuf+bytes_left+i, INPUTBUF_SIZE-bytes_left-i, &amp;bw);<span class="comment">//è¡¥å……æ•°æ®</span></span><br><span class="line"><span class="keyword">if</span>(result != FR_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;è¯»å–%så¤±è´¥ -&gt; %d\r\n&quot;</span>,mp3file,result);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">bytes_left += bw;<span class="comment">//æœ‰æ•ˆæ•°æ®æµå¤§å°</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MP3æ•°æ®è§£ç å¹¶é€å…¥DACç¼“å­˜</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">MP3DataDecoder</span>(&amp;read_ptr, &amp;bytes_left))</span><br><span class="line">&#123;<span class="comment">//å¦‚æœæ’­æ”¾å‡ºé”™ï¼ŒIsreadç½®1ï¼Œé¿å…å¡ä½æ­»å¾ªç¯</span></span><br><span class="line">Isread = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//mp3æ–‡ä»¶è¯»å–å®Œæˆï¼Œé€€å‡º</span></span><br><span class="line"><span class="keyword">if</span>(file.fptr == file.fsize)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;å•æ›²æ’­æ”¾å®Œæ¯•\r\n&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç­‰å¾…DACå‘é€ä¸€åŠæˆ–å…¨éƒ¨ä¸­æ–­</span></span><br><span class="line"><span class="keyword">while</span>(Isread == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">led_delay++;</span><br><span class="line"><span class="keyword">if</span>(led_delay == <span class="number">0xffffff</span>)</span><br><span class="line">&#123;</span><br><span class="line">led_delay=<span class="number">0</span>;</span><br><span class="line">LED1_TROG;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Input_scan();//ç­‰å¾…DMAä¼ è¾“å®Œæˆï¼Œæ­¤é—´å¯ä»¥è¿è¡ŒæŒ‰é”®æ‰«æåŠå¤„ç†äº‹ä»¶</span></span><br><span class="line">&#125;</span><br><span class="line">Isread = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿è¡Œåˆ°æ­¤å¤„ï¼Œè¯´æ˜å•æ›²æ’­æ”¾å®Œæˆï¼Œæ”¶å°¾å·¥ä½œ</span></span><br><span class="line"><span class="built_in">DAC_DMA_Stop</span>();<span class="comment">//åœæ­¢å–‚DACæ•°æ®</span></span><br><span class="line">mp3player.ucStatus = STA_IDLE;</span><br><span class="line"><span class="built_in">MP3FreeDecoder</span>(Mp3Decoder);<span class="comment">//æ¸…ç†ç¼“å­˜</span></span><br><span class="line"><span class="built_in">f_close</span>(&amp;file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DMA1_Stream6_IRQHandler</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">DMA_GetITStatus</span>(DMA1_Stream6, DMA_IT_HTIF6) != RESET) <span class="comment">//åŠä¼ è¾“</span></span><br><span class="line">&#123;</span><br><span class="line">dac_ht = <span class="number">1</span>;</span><br><span class="line">Isread=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">DMA_ClearITPendingBit</span>(DMA1_Stream6, DMA_IT_HTIF6);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">DMA_GetITStatus</span>(DMA1_Stream6, DMA_IT_TCIF6) != RESET) <span class="comment">//å…¨ä¼ è¾“</span></span><br><span class="line">&#123;</span><br><span class="line">dac_ht = <span class="number">0</span>;</span><br><span class="line">Isread=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">DMA_ClearITPendingBit</span>(DMA1_Stream6, DMA_IT_TCIF6);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************** (END OF FILE) *********************************/</span></span><br></pre></td></tr></table></figure><p>æºç ï¼šmain.c</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  ******************************************************************************</span></span><br><span class="line"><span class="comment">  * @file    ../User/main.c</span></span><br><span class="line"><span class="comment">  * @author  ZL</span></span><br><span class="line"><span class="comment">  * @version V1.0</span></span><br><span class="line"><span class="comment">  * @date    2015-12-26</span></span><br><span class="line"><span class="comment">  * @brief   Main program body</span></span><br><span class="line"><span class="comment">  ******************************************************************************</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Includes ------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hw_includes.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ff.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;exfuns.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mp3Player.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†ç›®å½•æ–‡ä»¶å¹¶æ‰“å°è¾“å‡º</span></span><br><span class="line"><span class="function">u8 <span class="title">scan_files</span><span class="params">(u8 * path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">FRESULT res;</span><br><span class="line"><span class="type">char</span> buf[<span class="number">512</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="type">char</span> *fn;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _USE_LFN</span></span><br><span class="line"> fileinfo.lfsize = _MAX_LFN * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">fileinfo.lfname = buf;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">res = <span class="built_in">f_opendir</span>(&amp;dir,(<span class="type">const</span> TCHAR*)path);</span><br><span class="line"><span class="keyword">if</span> (res == FR_OK)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line"></span><br><span class="line">res = <span class="built_in">f_readdir</span>(&amp;dir, &amp;fileinfo);</span><br><span class="line"><span class="keyword">if</span> (res != FR_OK || fileinfo.fname[<span class="number">0</span>] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> _USE_LFN</span></span><br><span class="line">fn = *fileinfo.lfname ? fileinfo.lfname : fileinfo.fname;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">fn = fileinfo.fname;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s/&quot;</span>, path);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\r\n&quot;</span>, fn);</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief  Main program</span></span><br><span class="line"><span class="comment">  * @param  None</span></span><br><span class="line"><span class="comment">  * @retval None</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">delay_init</span>(<span class="number">168</span>);</span><br><span class="line"><span class="built_in">usart1_Init</span>(<span class="number">115200</span>);</span><br><span class="line"><span class="built_in">LED_Init</span>();</span><br><span class="line"><span class="built_in">DAC_Config</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">SD_Init</span>())</span><br><span class="line"> &#123;</span><br><span class="line"><span class="built_in">exfuns_init</span>();<span class="comment">//ä¸ºfatfsç›¸å…³å˜é‡ç”³è¯·å†…å­˜</span></span><br><span class="line"><span class="built_in">f_mount</span>(fs[<span class="number">0</span>],<span class="string">&quot;0:&quot;</span>,<span class="number">1</span>); <span class="comment">//æŒ‚è½½SDå¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å°SDç›®å½•å’Œæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">scan_files</span>(<span class="string">&quot;0:&quot;</span>);</span><br><span class="line"></span><br><span class="line">LED0_ON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">mp3PlayerDemo</span>(<span class="string">&quot;0:/æ–­æ¡¥æ®‹é›ª.MP3&quot;</span>);</span><br><span class="line"><span class="built_in">mp3PlayerDemo</span>(<span class="string">&quot;0:/å¼ å›½è£-ç»ç’ƒä¹‹æƒ….MP3&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">delay_ms</span>(<span class="number">50</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºæ–¹ä¾¿è°ƒè¯•æµ‹è¯•ï¼Œä½¿ç”¨usart1æ‰“å°æ•°æ®ã€‚å®æµ‹æ•ˆæœï¼š</p><p><img src="https://img-blog.csdnimg.cn/bad9436c9a4e40de9bbd62abbae67b7c.jpeg"></p><p><img src="https://img-blog.csdnimg.cn/54ff22470d72499bb3e585a487abab46.jpeg"></p><p>ç¨‹åºæºç ä¸åŸç†å›¾ï¼Œæµ‹è¯•éŸ³é¢‘ï¼š</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/10hYXkrqnuBQgs0DWKLUUOA?pwd=iatt">https://pan.baidu.com/s/10hYXkrqnuBQgs0DWKLUUOA?pwd=iatt</a><br>æå–ç ï¼šiatt</p><p>çŸ¥é“è¿™é‡Œä¸‹è½½è¦ç§¯åˆ†ç™»å½•ä»€ä¹ˆçš„éº»çƒ¦å¾—å¾ˆï¼Œæ‰€ä»¥ç¨‹åºæ”¾åˆ°ç™¾åº¦ç½‘ç›˜äº†ï¼Œå‡å¦‚è¿æ¥å¤±æ•ˆï¼Œè®°å¾—åœ¨è¯„è®ºåŒºå–Šæˆ‘æ›´æ–°ï¼</p><p>ç†è®ºä¸ŠSTM32F1æˆ–è€…å…¶ä»–ç³»åˆ—ä¹Ÿèƒ½ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œè¦è‡ªå·±æ”¹æ”¹æµ‹è¯•å–½ï¼Œæœ¬æ–‡æŠŠæ€è·¯åˆ†äº«å‡ºæ¥æŠ›ç –å¼•ç‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€STM32ã€‘HALåº“ STM32CubeMXæ•™ç¨‹åä¸‰---RTCæ—¶é’Ÿ</title>
      <link href="/2024/03/stm32-stm32-%E3%80%90STM32%E3%80%91HAL%E5%BA%93-STM32CubeMX%E6%95%99%E7%A8%8B%E5%8D%81%E4%B8%89-RTC%E6%97%B6%E9%92%9F/"/>
      <url>/2024/03/stm32-stm32-%E3%80%90STM32%E3%80%91HAL%E5%BA%93-STM32CubeMX%E6%95%99%E7%A8%8B%E5%8D%81%E4%B8%89-RTC%E6%97%B6%E9%92%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>å‰è¨€ï¼š</p><p>æœ¬ç³»åˆ—æ•™ç¨‹å°† å¯¹åº”å¤–è®¾åŸç†ï¼ŒHALåº“ä¸STM32CubeMXç»“åˆåœ¨ä¸€èµ·è®²è§£ï¼Œä½¿æ‚¨å¯ä»¥æ›´å¿«é€Ÿçš„å­¦ä¼šå„ä¸ªæ¨¡å—çš„ä½¿ç”¨</p><p>æ‰€ç”¨å·¥å…·ï¼š</p><p>1ã€èŠ¯ç‰‡ï¼š STM32F407ZET6&#x2F; STM32F103ZET6</p><p>2ã€STM32CubeMxè½¯ä»¶</p><p>3ã€IDEï¼š MDK-Keilè½¯ä»¶</p><p>4ã€STM32F1xx&#x2F;STM32F4xxHALåº“</p><p>çŸ¥è¯†æ¦‚æ‹¬ï¼š</p><p>é€šè¿‡æœ¬ç¯‡åšå®¢æ‚¨å°†å­¦åˆ°ï¼š</p><p>RTCæ—¶é’ŸåŸç†</p><p>STM32CubeMXåˆ›å»ºRTCä¾‹ç¨‹</p><p>HALåº“å®šæ—¶å™¨RTCå‡½æ•°åº“</p><p><strong>PS: è¿™é‡Œçš„RTCè®²è§£ï¼Œæˆ‘ä»¬åªå°†åŸç†ï¼Œä¸è®²å¯„å­˜å™¨ï¼Œå¦‚æœè¦çœ‹RTCçš„å¯„å­˜å™¨ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« </strong><br><a href="https://blog.csdn.net/as480133937/article/details/105026033">ã€STM32ã€‘RTCå®æ—¶æ—¶é’Ÿï¼Œæ­¥éª¤è¶…ç»†è¯¦è§£ï¼Œä¸€æ–‡çœ‹æ‡‚RTC</a></p><h3 id="ä»€ä¹ˆæ˜¯RTC"><a href="#ä»€ä¹ˆæ˜¯RTC" class="headerlink" title="ä»€ä¹ˆæ˜¯RTC"></a>ä»€ä¹ˆæ˜¯RTC</h3><p>**RTC (Real Time Clock)**ï¼šå®æ—¶æ—¶é’Ÿ</p><p><strong>RTCæ˜¯ä¸ªç‹¬ç«‹çš„å®šæ—¶å™¨</strong>ã€‚RTCæ¨¡å—æ‹¥æœ‰ä¸€ä¸ªè¿ç»­è®¡æ•°çš„è®¡æ•°å™¨ï¼Œåœ¨ç›¸åº”çš„è½¯ä»¶é…ç½®ä¸‹ï¼Œå¯ä»¥æä¾›æ—¶é’Ÿæ—¥å†çš„åŠŸèƒ½ã€‚ä¿®æ”¹è®¡æ•°å™¨çš„å€¼å¯ä»¥é‡æ–°è®¾ç½®å½“å‰æ—¶é—´å’Œæ—¥æœŸ RTCè¿˜åŒ…å«ç”¨äºç®¡ç†ä½åŠŸè€—æ¨¡å¼çš„è‡ªåŠ¨å”¤é†’å•å…ƒã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200423215123488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p><strong>åœ¨æ–­ç”µæƒ…å†µä¸‹ RTCä»å¯ä»¥ç‹¬ç«‹è¿è¡Œ åªè¦èŠ¯ç‰‡çš„å¤‡ç”¨ç”µæºä¸€ç›´ä¾›ç”µ,RTCä¸Šçš„æ—¶é—´ä¼šä¸€ç›´èµ°ã€‚</strong></p><p>RTCå®è´¨æ˜¯ä¸€ä¸ªæ‰ç”µåè¿˜ç»§ç»­è¿è¡Œçš„å®šæ—¶å™¨,ä»å®šæ—¶å™¨çš„è§’åº¦æ¥çœ‹,ç›¸å¯¹äºé€šç”¨å®šæ—¶å™¨TIMå¤–è®¾,å®ƒçš„åŠŸèƒ½ååˆ†ç®€å•,åªæœ‰è®¡æ—¶åŠŸèƒ½(ä¹Ÿå¯ä»¥è§¦å‘ä¸­æ–­)ã€‚ä½†å…¶é«˜çº§æŒ‡å‡ºä¹Ÿå°±åœ¨äºæ‰ç”µä¹‹åè¿˜å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><p>ä¸¤ä¸ª 32 ä½å¯„å­˜å™¨åŒ…å«äºŒè¿›ç åè¿›æ•°æ ¼å¼ (BCD) çš„ç§’ã€åˆ†é’Ÿã€å°æ—¶ï¼ˆ 12 æˆ– 24 å°æ—¶åˆ¶ï¼‰ã€æ˜ŸæœŸå‡ ã€æ—¥æœŸã€æœˆä»½å’Œå¹´ä»½ã€‚æ­¤å¤–ï¼Œè¿˜å¯æä¾›äºŒè¿›åˆ¶æ ¼å¼çš„äºšç§’å€¼ã€‚ç³»ç»Ÿå¯ä»¥è‡ªåŠ¨å°†æœˆä»½çš„å¤©æ•°è¡¥å¿ä¸º 28ã€29ï¼ˆé—°å¹´ï¼‰ã€30 å’Œ 31 å¤©ã€‚</p><p>ä¸Šç”µå¤ä½åï¼Œæ‰€æœ‰RTCå¯„å­˜å™¨éƒ½ä¼šå—åˆ°ä¿æŠ¤ï¼Œä»¥é˜²æ­¢å¯èƒ½çš„éæ­£å¸¸å†™è®¿é—®ã€‚</p><p>æ— è®ºå™¨ä»¶çŠ¶æ€å¦‚ä½•ï¼ˆè¿è¡Œæ¨¡å¼ã€ä½åŠŸè€—æ¨¡å¼æˆ–å¤„äºå¤ä½çŠ¶æ€ï¼‰ï¼Œåªè¦ç”µæºç”µå‹ä¿æŒåœ¨å·¥ä½œèŒƒå›´å†…ï¼ŒRTCä½¿ä¸ä¼šåœæ­¢å·¥ä½œã€‚</p><h4 id="RCTç‰¹å¾ï¼š"><a href="#RCTç‰¹å¾ï¼š" class="headerlink" title="; RCTç‰¹å¾ï¼š"></a><a name="rct_47">;</a> <strong>RCTç‰¹å¾ï¼š</strong></h4><p>â— <strong>å¯ç¼–ç¨‹çš„é¢„åˆ†é¢‘ç³»æ•°ï¼šåˆ†é¢‘ç³»æ•°é«˜ä¸º220ã€‚</strong><br>â— <strong>32ä½çš„å¯ç¼–ç¨‹è®¡æ•°å™¨ï¼Œå¯ç”¨äºè¾ƒé•¿æ—¶é—´æ®µçš„æµ‹é‡ã€‚</strong><br>â— <strong>2ä¸ªåˆ†ç¦»çš„æ—¶é’Ÿï¼šç”¨äºAPB1æ¥å£çš„PCLK1å’ŒRTCæ—¶é’Ÿ(RTCæ—¶é’Ÿçš„é¢‘ç‡å¿…é¡»å°äºPCLK1æ—¶é’Ÿ é¢‘ç‡çš„å››åˆ†ä¹‹ä¸€ä»¥ä¸Š)ã€‚</strong><br>â— å¯ä»¥é€‰æ‹©ä»¥ä¸‹ <strong>ä¸‰ç§RTCçš„æ—¶é’Ÿæº</strong>ï¼š<br>â— HSEæ—¶é’Ÿé™¤ä»¥128ï¼›<br>â— LSEæŒ¯è¡å™¨æ—¶é’Ÿï¼›<br>â— LSIæŒ¯è¡å™¨æ—¶é’Ÿ</p><p>â— <strong>2ä¸ªç‹¬ç«‹çš„å¤ä½ç±»å‹ï¼š</strong><br>â— APB1æ¥å£ç”±ç³»ç»Ÿå¤ä½ï¼›<br>â— RTCæ ¸å¿ƒ(é¢„åˆ†é¢‘å™¨ã€é—¹é’Ÿã€è®¡æ•°å™¨å’Œåˆ†é¢‘å™¨)åªèƒ½ç”±åå¤‡åŸŸå¤ä½</p><p>â— <strong>3ä¸ªä¸“é—¨çš„å¯å±è”½ä¸­æ–­ï¼š</strong><br>â— 1. <strong>é—¹é’Ÿä¸­æ–­</strong>ï¼Œç”¨æ¥äº§ç”Ÿä¸€ä¸ªè½¯ä»¶å¯ç¼–ç¨‹çš„é—¹é’Ÿä¸­æ–­ã€‚</p><p>â— 2. <strong>ç§’ä¸­æ–­</strong>ï¼Œç”¨æ¥äº§ç”Ÿä¸€ä¸ªå¯ç¼–ç¨‹çš„å‘¨æœŸæ€§ä¸­æ–­ä¿¡å·(é•¿å¯è¾¾1ç§’)ã€‚</p><p>â— 3. <strong>æº¢å‡ºä¸­æ–­</strong>ï¼ŒæŒ‡ç¤ºå†…éƒ¨å¯ç¼–ç¨‹è®¡æ•°å™¨æº¢å‡ºå¹¶å›è½¬ä¸º0çš„çŠ¶æ€ã€‚</p><p><strong>RTCæ—¶é’Ÿæºï¼š</strong><br>ä¸‰ç§ä¸åŒçš„æ—¶é’Ÿæºå¯è¢«ç”¨æ¥é©±åŠ¨ç³»ç»Ÿæ—¶é’Ÿ(SYSCLK)ï¼š</p><p>â— <strong>HSIæŒ¯è¡å™¨æ—¶é’Ÿ</strong><br>â— <strong>HSEæŒ¯è¡å™¨æ—¶é’Ÿ</strong><br>â— <strong>PLLæ—¶é’Ÿ</strong></p><p>è¿™äº›è®¾å¤‡æœ‰ä»¥ä¸‹2ç§äºŒçº§æ—¶é’Ÿæºï¼š</p><p>â— 40kHzä½é€Ÿå†…éƒ¨RCï¼Œå¯ä»¥ç”¨äºé©±åŠ¨ç‹¬ç«‹çœ‹é—¨ç‹—å’Œé€šè¿‡ç¨‹åºé€‰æ‹©é©±åŠ¨RTCã€‚ RTCç”¨äºä»åœæœº&#x2F;å¾…æœºæ¨¡å¼ä¸‹è‡ªåŠ¨å”¤é†’ç³»ç»Ÿã€‚<br>â— 32.768kHzä½é€Ÿå¤–éƒ¨æ™¶ä½“ä¹Ÿå¯ç”¨æ¥é€šè¿‡ç¨‹åºé€‰æ‹©é©±åŠ¨RTC(RTCCLK)ã€‚</p><h4 id="RTCåŸç†æ¡†å›¾"><a href="#RTCåŸç†æ¡†å›¾" class="headerlink" title="RTCåŸç†æ¡†å›¾"></a>RTCåŸç†æ¡†å›¾</h4><p><img src="https://img-blog.csdnimg.cn/20200322144525734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"><br>RTCæ—¶é’Ÿçš„æ¡†å›¾è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠä»–åˆ†æˆ <strong><code>&amp;#x4E24;&amp;#x4E2A;&amp;#x90E8;&amp;#x5206;</code></strong>:</p><p><strong>APB1 æ¥å£</strong>ï¼šç”¨æ¥å’Œ APB1 æ€»çº¿ç›¸è¿ã€‚ æ­¤å•å…ƒè¿˜åŒ…å«ä¸€ç»„ 16 ä½å¯„å­˜å™¨ï¼Œå¯é€šè¿‡ APB1 æ€»çº¿å¯¹å…¶è¿›è¡Œè¯»å†™æ“ä½œã€‚APB1 æ¥å£ç”± APB1 æ€» çº¿æ—¶é’Ÿé©±åŠ¨ï¼Œç”¨æ¥ä¸ APB1 æ€»çº¿è¿æ¥ã€‚</p><p>é€šè¿‡APB1æ¥å£å¯ä»¥è®¿é—®RTCçš„ç›¸å…³å¯„å­˜å™¨ï¼ˆé¢„åˆ†é¢‘å€¼ï¼Œè®¡æ•°å™¨å€¼ï¼Œé—¹é’Ÿå€¼ï¼‰ã€‚</p><p><strong>RTC æ ¸å¿ƒæ¥å£</strong>ï¼šç”±ä¸€ç»„å¯ç¼–ç¨‹è®¡æ•°å™¨ç»„æˆï¼Œåˆ†æˆ ** <code>&amp;#x4E24;&amp;#x4E2A;&amp;#x4E3B;&amp;#x8981;&amp;#x6A21;&amp;#x5757;</code>** ã€‚<br><img src="https://img-blog.csdnimg.cn/20200322223612113.png">g)<br><strong>ç¬¬ä¸€ä¸ªæ¨¡å—æ˜¯ RTC çš„ é¢„åˆ†é¢‘æ¨¡å—</strong>ï¼Œå®ƒå¯ç¼–ç¨‹äº§ç”Ÿ 1 ç§’çš„ RTC æ—¶é—´åŸºå‡† TR_CLKã€‚RTC çš„é¢„åˆ†é¢‘æ¨¡å—åŒ…å«äº†ä¸€ä¸ª 20 ä½çš„å¯ç¼–ç¨‹åˆ†é¢‘å™¨(RTC é¢„åˆ†é¢‘å™¨)ã€‚å¦‚æœåœ¨ RTC_CR å¯„å­˜å™¨ä¸­è®¾ç½®äº†ç›¸åº”çš„å…è®¸ä½ï¼Œåˆ™åœ¨æ¯ä¸ª TR_CLK å‘¨æœŸä¸­ RTC äº§ç”Ÿä¸€ä¸ªä¸­æ–­(ç§’ä¸­æ–­)ã€‚<br><img src="https://img-blog.csdnimg.cn/2020032222362770.png"><br><strong>ç¬¬äºŒä¸ªæ¨¡å—æ˜¯ä¸€ä¸ª 32 ä½çš„å¯ç¼–ç¨‹è®¡æ•°å™¨ ï¼ˆRTC_CNTï¼‰</strong>ï¼Œå¯è¢«åˆå§‹åŒ–ä¸ºå½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œä¸€ä¸ª 32 ä½çš„æ—¶é’Ÿè®¡æ•°å™¨ï¼ŒæŒ‰ç§’é’Ÿè®¡ç®—ï¼Œå¯ä»¥è®° å½• 4294967296 ç§’ï¼Œçº¦åˆ 136 å¹´å·¦å³ï¼Œä½œä¸ºä¸€èˆ¬åº”ç”¨ï¼Œè¿™å·²ç»æ˜¯è¶³å¤Ÿäº†çš„ã€‚</p><h4 id="RTCå…·ä½“æµç¨‹ï¼š"><a href="#RTCå…·ä½“æµç¨‹ï¼š" class="headerlink" title="; RTCå…·ä½“æµç¨‹ï¼š"></a><a name="rtc_107">;</a> <strong>RTCå…·ä½“æµç¨‹ï¼š</strong></h4><p><strong>RTCCLKç»è¿‡RTC_DIVé¢„åˆ†é¢‘ï¼ŒRTC_PRLè®¾ç½®é¢„åˆ†é¢‘ç³»æ•°ï¼Œç„¶åå¾—åˆ°TR_CLKæ—¶é’Ÿä¿¡å·ï¼Œæˆ‘ä»¬ä¸€èˆ¬è®¾ç½®å…¶å‘¨æœŸä¸º1sï¼ŒRTC_CNTè®¡æ•°å™¨è®¡æ•°ï¼Œå‡å¦‚1970è®¾ç½®ä¸ºæ—¶é—´èµ·ç‚¹ä¸º0sï¼Œé€šè¿‡å½“å‰æ—¶é—´çš„ç§’æ•°è®¡ç®—å¾—åˆ°å½“å‰çš„æ—¶é—´ã€‚RTC_ALRæ˜¯è®¾ç½®é—¹é’Ÿæ—¶é—´ï¼ŒRTC_CNTè®¡æ•°åˆ°RTC_ALRå°±ä¼šäº§ç”Ÿè®¡æ•°ä¸­æ–­ï¼Œ</strong></p><ul><li><strong>RTC_Second</strong>ä¸ºç§’ä¸­æ–­ï¼Œç”¨äºåˆ·æ–°æ—¶é—´ï¼Œ</li><li><strong>RTC_Overflow</strong>æ˜¯æº¢å‡ºä¸­æ–­ã€‚</li><li><strong>RTC Alarm</strong> æ§åˆ¶å¼€å…³æœº</li></ul><h4 id="RTCæ—¶é’Ÿé€‰æ‹©"><a href="#RTCæ—¶é’Ÿé€‰æ‹©" class="headerlink" title="RTCæ—¶é’Ÿé€‰æ‹©"></a>RTCæ—¶é’Ÿé€‰æ‹©</h4><p><strong>ä½¿ç”¨HSEåˆ†é¢‘æ—¶é’Ÿæˆ–è€…LSIçš„æ—¶å€™,åœ¨ä¸»ç”µæºVDDæ‰ç”µçš„æƒ…å†µä¸‹,è¿™ä¸¤ä¸ªæ—¶é’Ÿæ¥æºéƒ½ä¼šå—åˆ°å½±å“,å› æ­¤æ²¡æ³•ä¿è¯RTCæ­£å¸¸å·¥ä½œ.æ‰€ä»¥RTCä¸€èˆ¬éƒ½æ—¶é’Ÿä½é€Ÿå¤–éƒ¨æ—¶é’ŸLSE,é¢‘ç‡ä¸ºå®æ—¶æ—¶é’Ÿæ¨¡å—ä¸­å¸¸ç”¨çš„32.768KHz,å› ä¸º32768 &#x3D; 2^15,åˆ†é¢‘å®¹æ˜“å®ç°,æ‰€ä»¥è¢«å¹¿æ³›åº”ç”¨åˆ°RTCæ¨¡å—.(åœ¨ä¸»ç”µæºVDDæœ‰æ•ˆçš„æƒ…å†µä¸‹(å¾…æœº),RTCè¿˜å¯ä»¥é…ç½®é—¹é’Ÿäº‹ä»¶ä½¿STM32é€€å‡ºå¾…æœºæ¨¡å¼).</strong></p><h4 id="RTCå¤ä½è¿‡ç¨‹"><a href="#RTCå¤ä½è¿‡ç¨‹" class="headerlink" title="RTCå¤ä½è¿‡ç¨‹"></a>RTCå¤ä½è¿‡ç¨‹</h4><p>é™¤äº†RTC_PRLã€RTC_ALRã€RTC_CNTå’ŒRTC_DIVå¯„å­˜å™¨å¤–ï¼Œæ‰€æœ‰çš„ç³»ç»Ÿå¯„å­˜å™¨éƒ½ç”±ç³»ç»Ÿå¤ä½æˆ–ç”µæºå¤ä½è¿›è¡Œå¼‚æ­¥å¤ä½ã€‚<br>RTC_PRLã€RTC_ALRã€RTC_CNTå’ŒRTC_DIVå¯„å­˜å™¨ä»…èƒ½é€šè¿‡å¤‡ä»½åŸŸå¤ä½ä¿¡å·å¤ä½ã€‚</p><p><strong>ç³»ç»Ÿå¤ä½å,ç¦æ­¢è®¿é—®åå¤‡å¯„å­˜å™¨å’ŒRCT,é˜²æ­¢å¯¹åå«åŒºåŸŸ(BKP)çš„æ„å¤–å†™æ“ä½œ</strong></p><h4 id="RTCä¸­æ–­"><a href="#RTCä¸­æ–­" class="headerlink" title="RTCä¸­æ–­"></a>RTCä¸­æ–­</h4><p><strong>ç§’ä¸­æ–­ï¼š</strong><br>è¿™é‡Œæ—¶é’Ÿè‡ªå¸¦ä¸€ä¸ªç§’ä¸­æ–­ï¼Œæ¯å½“è®¡æ•°åŠ ä¸€çš„æ—¶å€™å°±ä¼šè§¦å‘ä¸€æ¬¡ç§’ä¸­æ–­ï¼Œã€‚æ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„ç§’ä¸­æ–­å¹¶éä¸€å®šæ˜¯ä¸€ç§’çš„æ—¶é—´ï¼Œå®ƒæ˜¯ç”±RTCæ—¶é’Ÿæºå’Œåˆ†é¢‘å€¼å†³å®šçš„â€ç§’â€çš„æ—¶é—´ï¼Œå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥åšåˆ°1ç§’é’Ÿä¸­æ–­ä¸€æ¬¡ã€‚æˆ‘ä»¬é€šè¿‡å¾€ç§’ä¸­æ–­é‡Œå†™æ›´æ–°æ—¶é—´çš„å‡½æ•°æ¥è¾¾åˆ°æ—¶é—´åŒæ­¥çš„æ•ˆæœ</p><p><strong>é—¹é’Ÿä¸­æ–­ï¼š</strong><br>é—¹é’Ÿä¸­æ–­å°±æ˜¯è®¾ç½®ä¸€ä¸ªé¢„è®¾å®šçš„å€¼ï¼Œè®¡æ•°æ¯è‡ªåŠ å¤šå°‘æ¬¡è§¦å‘ä¸€æ¬¡é—¹é’Ÿä¸­æ–­</p><h3 id="CubeMXé…ç½®RTC"><a href="#CubeMXé…ç½®RTC" class="headerlink" title="CubeMXé…ç½®RTC"></a>CubeMXé…ç½®RTC</h3><h4 id="å·¥ç¨‹åˆ›å»º"><a href="#å·¥ç¨‹åˆ›å»º" class="headerlink" title="å·¥ç¨‹åˆ›å»º"></a>å·¥ç¨‹åˆ›å»º</h4><p><strong>1è®¾ç½®RCC</strong><br><img src="https://img-blog.csdnimg.cn/20200425101549368.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li><strong>è®¾ç½®é«˜é€Ÿå¤–éƒ¨æ—¶é’ŸHSE é€‰æ‹©å¤–éƒ¨æ—¶é’Ÿæº</strong></li><li>*<em>ä½¿èƒ½å¤–éƒ¨æ™¶æŒ¯LSE</em></li></ul><p><strong>RTCè®¾å¤‡å› ä¸ºå…¶ç‹¬ç‰¹çš„è¿è¡Œæ–¹å¼ï¼ˆå³æ‰ç”µä¾æ—§è¿è¡Œï¼‰ä½¿ç”¨HSEåˆ†é¢‘æ—¶é’Ÿæˆ–è€…LSIçš„æ—¶å€™,åœ¨ä¸»ç”µæºVDDæ‰ç”µçš„æƒ…å†µä¸‹,è¿™ä¸¤ä¸ªæ—¶é’Ÿæ¥æºéƒ½ä¼šå—åˆ°å½±å“ï¼Œèµ„æºæ¶ˆè€—å¤ªå¤§ï¼Œå°å°çš„çº½æ‰£ç”µæ± æ ¹æœ¬åƒä¸æ¶ˆã€‚æ²¡æ³•ä¿è¯RTCæ­£å¸¸å·¥ä½œ.æ‰€ä»¥RTCä¸€èˆ¬éƒ½æ—¶é’Ÿä½é€Ÿå¤–éƒ¨æ—¶é’ŸLSE</strong></p><ol start="2"><li><strong>é…ç½®RTC</strong><br><img src="https://img-blog.csdnimg.cn/20200425110730403.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></li></ol><ul><li><strong>Activate Clock Source æ¿€æ´»æ—¶é’Ÿæº</strong></li><li>*<em>Activate calendaræ¿€æ´»æ—¥å†</em></li></ul><p><strong>è¿™ä¸¤ä¸ªéƒ½è¦ç‚¹ï¼Œä½œç”¨ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå…ˆæ˜¯ä½¿èƒ½æ—¶é’Ÿæºï¼Œå†ä½¿èƒ½RTCæ—¥å†</strong></p><ul><li><strong>RTC_OUTï¼š Not RTC_OUT</strong></li><li><strong>Tamperï¼š</strong> *<em>Ã—</em></li></ul><p>ç¬¬ä¸€ä¸ªæ˜¯æ˜¯å¦ä½¿èƒ½ <strong>tamperï¼ˆPC13ï¼‰å¼•è„šä¸Šè¾“å‡ºæ ¡æ­£çš„ç§’è„‰å†²æ—¶é’Ÿï¼Œ</strong></p><p>ç¬¬äºŒä¸ªï¼š <strong>RTCå…¥ä¾µæ£€æµ‹æ ¡éªŒåŠŸèƒ½</strong></p><p><strong>RTCæ ¡éªŒåŠŸèƒ½ï¼Œä½¿èƒ½ä¾µå…¥æ£€æµ‹åŠŸèƒ½ã€‚RTCæ—¶é’Ÿç»64åˆ†é¢‘è¾“å‡ºåˆ°ä¾µå…¥æ£€æµ‹å¼•è„šTAMPERä¸Š<br> å½“ TAMPERå¼•è„šä¸Šçš„ä¿¡å·ä» 0å˜æˆ1æˆ–è€…ä» 1å˜æˆ 0(å–å†³äºå¤‡ä»½æ§åˆ¶å¯„å­˜å™¨BKP_CRçš„ TPALä½)ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªä¾µå…¥æ£€æµ‹äº‹ä»¶ã€‚ä¾µå…¥æ£€æµ‹äº‹ä»¶å°†æ‰€æœ‰æ•°æ®å¤‡ä»½å¯„å­˜å™¨å†…å®¹æ¸…é™¤ã€‚</strong></p><ol><li>ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªæ˜¯ä½¿èƒ½tamperï¼ˆPC13ï¼‰å¼•è„šä½œä¸ºæ—¶é’Ÿè„‰å†²è¾“å‡º</li><li>ç¬¬äºŒä¸ªæ˜¯ä½¿èƒ½tamperï¼ˆPC13ï¼‰å¼•è„šä½œä¸ºå…¥ä¾µæ£€æµ‹åŠŸèƒ½</li></ol><p>ä¸‹é¢æ˜¯ä¸¤ä¸ªRTCçš„ä¸­æ–­ï¼š</p><ul><li><strong>RTCå…¨å±€ä¸­æ–­RTC_IRQHandler()</strong></li><li>*<em>é—¹é’Ÿä¸­æ–­å‡½æ•°RTCAlarm_IRQHandler()</em></li></ul><p><img src="https://img-blog.csdnimg.cn/2020042514381771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p><strong>æ­¤å¤„è®¾ç½®æ—¶é—´ä¸º2020&#x2F;04&#x2F;25 13:30:00</strong></p><ul><li>Data Format: æ—¥æœŸæ ¼å¼</li></ul><p><strong>Binary data format åå…­è¿›åˆ¶<br>BCD data format BCDç è¿›åˆ¶</strong></p><p>ä½¿ç”¨è‡ªåŠ¨é…ç½®ï¼Œåˆå§‹åŒ–æ—¶é—´å¿…é¡»ä½¿ç”¨BCD data formatï¼ŒåŸå› æ˜¯åº“å‡½æ•°å­˜åœ¨bugï¼Œå¦‚æœä½¿ç”¨Binary data formatï¼Œæœˆä»½é…ç½®ä¼šå‡ºé”™ï¼Œæ¯”å¦‚è¯´11æœˆï¼Œé…ç½®æ—¶ä¼šèµ‹å€¼ä¸ºRTC_MONTH_NOVEMBERï¼Œè€Œæ­¤å®å®šä¹‰å€¼ä¸º0x11ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶åè¿›åˆ¶å€¼ä¸º17</p><ul><li><strong>Hoursï¼š å°æ—¶</strong></li><li><strong>Minutesï¼š åˆ†é’Ÿ</strong></li><li><strong>Secondsï¼š ç§’</strong></li><li><strong>Week Dayï¼š æ˜ŸæœŸ</strong></li><li><strong>Month æœˆä»½</strong></li><li><strong>Dateï¼š æ—¥æœŸ</strong></li><li>*<em>Yearï¼š å¹´ä»½</em></li></ul><p><strong>3 ä½¿èƒ½ä¸²å£</strong><br><img src="https://img-blog.csdnimg.cn/20200425143944495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"><br><strong>ä½¿èƒ½ä¸€ä¸‹ä¸²å£ï¼Œå› ä¸ºå‘é€æ—¥æœŸåˆ°ä¸Šä½æœº</strong></p><p><strong>4æ—¶é’Ÿæºè®¾ç½®</strong><br><img src="https://img-blog.csdnimg.cn/20200425144337169.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p>æˆ‘çš„æ˜¯ å¤–éƒ¨æ™¶æŒ¯ä¸º8MHz</p><ul><li>1é€‰æ‹©å¤–éƒ¨æ—¶é’ŸHSE 8MHz</li><li>2PLLé”ç›¸ç¯å€é¢‘9å€</li><li>3ç³»ç»Ÿæ—¶é’Ÿæ¥æºé€‰æ‹©ä¸ºPLL</li><li>4è®¾ç½®APB1åˆ†é¢‘å™¨ä¸º &#x2F;2</li><li>5 ä½¿èƒ½CSSç›‘è§†æ—¶é’Ÿ</li><li>*<em>6 è®¾ç½®RTCæ—¶é’Ÿä¸ºLSE</em></li></ul><p>32çš„æ—¶é’Ÿæ ‘æ¡†å›¾ å¦‚æœä¸æ‡‚çš„è¯è¯·çœ‹<a href="https://blog.csdn.net/as480133937/article/details/98845509">ã€Šã€STM32ã€‘ç³»ç»Ÿæ—¶é’ŸRCCè¯¦è§£(è¶…è¯¦ç»†ï¼Œè¶…å…¨é¢)ã€‹</a></p><p><strong>5é¡¹ç›®æ–‡ä»¶è®¾ç½®</strong><br><img src="https://img-blog.csdnimg.cn/20200425144600886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li>1 è®¾ç½®é¡¹ç›®åç§°</li><li>2 è®¾ç½®å­˜å‚¨è·¯å¾„</li><li>3 é€‰æ‹©æ‰€ç”¨IDE<br><img src="https://img-blog.csdnimg.cn/2020042514462236.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></li></ul><p><strong>6åˆ›å»ºå·¥ç¨‹æ–‡ä»¶</strong></p><p><strong>ç„¶åç‚¹å‡»GENERATE CODE åˆ›å»ºå·¥ç¨‹</strong></p><p><strong>é…ç½®ä¸‹è½½å·¥å…·</strong><br>æ–°å»ºçš„å·¥ç¨‹æ‰€æœ‰é…ç½®éƒ½æ˜¯é»˜è®¤çš„ æˆ‘ä»¬éœ€è¦è‡ªè¡Œé€‰æ‹©ä¸‹è½½æ¨¡å¼ï¼Œå‹¾é€‰ä¸Šä¸‹è½½åå¤ä½è¿è¡Œ</p><p><img src="https://img-blog.csdnimg.cn/202004251446415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><h4 id="RTC-HALåº“å‡½æ•°"><a href="#RTC-HALåº“å‡½æ•°" class="headerlink" title=";  RTC_HALåº“å‡½æ•°"></a><a name="rtc_hal_243">;</a>  RTC_HALåº“å‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetAlarm</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_AlarmTypeDef *sAlarm, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetAlarm_IT</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_AlarmTypeDef *sAlarm, uint32_t Format)</span></span><br><span class="line"></span><br><span class="line">__weak <span class="keyword">void</span> <span class="title function_">HAL_RTC_AlarmAEventCallback</span><span class="params">(RTC_HandleTypeDef *hrtc)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">HAL_RTCEx_BKUPWrite</span><span class="params">(RTC_HandleTypeDef *hrtc, uint32_t BackupRegister, uint32_t Data)</span></span><br><span class="line"></span><br><span class="line">uint32_t <span class="title function_">HAL_RTCEx_BKUPRead</span><span class="params">(RTC_HandleTypeDef *hrtc, uint32_t BackupRegister</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢çš„å››ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯</p><ul><li><strong>è®¾ç½®ç³»ç»Ÿæ—¶é—´ï¼šHAL_RTC_SetTime();</strong></li><li><strong>è¯»å–ç³»ç»Ÿæ—¶é—´: HAL_RTC_GetTime();</strong></li><li><strong>è®¾ç½®ç³»ç»Ÿæ—¥æœŸ: HAL_RTC_SetDate();</strong></li><li>*<em>è¯»å–ç³»ç»Ÿæ—¥æœŸ: HAL_RTC_GetDate();</em></li></ul><p>å› ä¸ºç³»ç»Ÿçš„æ—¶é—´å’Œæ—¥æœŸå¼€å§‹çš„æ—¶å€™å·²ç»è®¾ç½®è¿‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªç”¨ä¸¤ä¸ªè¯»å–å‡½æ•°</p><p><strong>è¯»å–ç³»ç»Ÿæ—¶é—´å‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br></pre></td></tr></table></figure><p>åŠŸèƒ½ï¼š è·å–RTCæ—¶é’Ÿçš„æ—¶é—´</p><p>å‚æ•°ï¼š</p><ul><li>*hrtc RTCç»“æ„ä½“å‚æ•° ä¾‹ï¼š&amp;hi2c2</li><li><strong>RTC_TimeTypeDef</strong> *sTimeï¼š è·å–RTCæ—¶é—´çš„ç»“æ„ä½“ï¼Œ</li><li>Formatï¼š <strong>è·å–æ—¶é—´çš„æ ¼å¼</strong><br>*<em>RTC_FORMAT_BIN ä½¿ç”¨16è¿›åˆ¶<br>RTC_FORMAT_BCD ä½¿ç”¨BCDè¿›åˆ¶</em></li></ul><p><strong>è¯»å–ç³»ç»Ÿæ—¥æœŸå‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br></pre></td></tr></table></figure><p>åŠŸèƒ½ï¼š è·å–RTCæ—¶é’Ÿçš„æ—¥æœŸ</p><p>å‚æ•°ï¼š</p><ul><li>*hrtc RTCç»“æ„ä½“å‚æ•° ä¾‹ï¼š&amp;hi2c2</li><li><strong>RTC_DateTypeDef</strong> *sTimeï¼š è·å–RTCæ—¥æœŸçš„ç»“æ„ä½“ï¼Œ</li><li>Formatï¼š <strong>è·å–æ—¥æœŸçš„æ ¼å¼</strong><br>*<em>RTC_FORMAT_BIN ä½¿ç”¨16è¿›åˆ¶<br>RTC_FORMAT_BCD ä½¿ç”¨BCDè¿›åˆ¶</em></li></ul><p>åœ¨stm32f1xx_hal_rtc.hå¤´æ–‡ä»¶ä¸­ï¼Œå¯ä»¥æ‰¾åˆ° <code>RTC_TimeTypeDef</code>ï¼Œ <code>RTC_DateTypeDef</code>è¿™ä¸¤ä¸ªç»“æ„ä½“çš„æˆå‘˜å˜é‡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">uint8_t</span> Hours;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Minutes;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Seconds;</span><br><span class="line"></span><br><span class="line">&#125; RTC_TimeTypeDef;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">uint8_t</span> WeekDay;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Month;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Date;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint8_t</span> Year;</span><br><span class="line"></span><br><span class="line">&#125; RTC_DateTypeDef;</span><br></pre></td></tr></table></figure><p><strong>ç¨‹åºä»£ç ï¼š</strong></p><p>main.c</p><p><strong>åœ¨main.cä¸­é‡å†™fputcå‡½æ•°ï¼Œä½¿å¾—èƒ½å¤Ÿä½¿ç”¨printfå‡½æ•°</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdio.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">fputc</span><span class="params">(<span class="type">int</span> ch,FILE *f)</span>&#123;</span><br><span class="line"> <span class="type">uint8_t</span> temp[<span class="number">1</span>]=&#123;ch&#125;;</span><br><span class="line"> HAL_UART_Transmit(&amp;huart1,temp,<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"> <span class="keyword">return</span> ch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®šä¹‰ä¸¤ä¸ªç»“æ„ä½“æ¥è·å–æ—¥æœŸå’Œæ—¶é—´ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RTC_DateTypeDef GetData;</span><br><span class="line"></span><br><span class="line">RTC_TimeTypeDef GetTime;</span><br></pre></td></tr></table></figure><p>åœ¨whileå¾ªç¯ä¸­æ·»åŠ ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">HAL_RTC_GetTime(&amp;hrtc, &amp;GetTime, RTC_FORMAT_BIN);</span><br><span class="line"></span><br><span class="line">   HAL_RTC_GetDate(&amp;hrtc, &amp;GetData, RTC_FORMAT_BIN);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%02d/%02d/%02d\r\n&quot;</span>,<span class="number">2000</span> + GetData.Year, GetData.Month, GetData.Date);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%02d:%02d:%02d\r\n&quot;</span>,GetTime.Hours, GetTime.Minutes, GetTime.Seconds);</span><br><span class="line"></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">   HAL_Delay(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p><strong>ç¨‹åºä¸­ä½¿ç”¨HAL_RTC_GetTimeï¼ˆï¼‰,HAL_RTC_GetDate()è¯»å–æ—¶é—´å’Œæ—¥æœŸï¼Œå¹¶ä¿å­˜åˆ°ç»“æ„ä½“å˜é‡ä¸­ï¼Œç„¶åé€šè¿‡ä¸²å£è¾“å‡ºè¯»å–çš„æ—¶é—´å’Œæ—¥æœŸã€‚</strong></p><p><strong>ä¾‹ç¨‹æµ‹è¯•æ­£å¸¸ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20200425153330941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><h4 id="RTCæ‰ç”µé‡ç½®"><a href="#RTCæ‰ç”µé‡ç½®" class="headerlink" title="RTCæ‰ç”µé‡ç½®"></a>RTCæ‰ç”µé‡ç½®</h4><p>ä½†æ˜¯å‘¢ï¼Œåœ¨halåº“ä¸­ç”Ÿæˆçš„ä»£ç ï¼Œ <strong>æ¯æ¬¡æ–­ç”µå°±RTCæ—¶é—´ä¼šé‡ç½®</strong>ï¼Œæ¯æ¬¡ä¸Šç”µéƒ½ä¼šé‡æ–°åˆå§‹åŒ–æ—¶é—´</p><p>å› ä¸ºHALåº“è®¾ç½®äº†ä¸€ä¸ªBKPå¯„å­˜å™¨ä¿å­˜ä¸€ä¸ªæ ‡å¿—ã€‚æ¯æ¬¡å•ç‰‡æœºå¯åŠ¨æ—¶éƒ½è¯»å–è¿™ä¸ªæ ‡å¿—å¹¶åˆ¤æ–­æ˜¯ä¸æ˜¯é¢„å…ˆè®¾å®šçš„å€¼ï¼šå¦‚åº¦æœä¸æ˜¯å°±åˆå§‹åŒ–RTCå¹¶è®¾ç½®æ—¶é—´ï¼Œå†è®¾ç½®æ ‡å¿—ä¸ºé¢„æœŸå€¼ï¼›å¦‚æœæ˜¯é¢„æœŸå€¼å°±è·³è¿‡åˆå§‹åŒ–å’Œæ—¶é—´è®¾ç½®ï¼Œç»§ç»­æ‰§è¡Œåé¢çš„ç¨‹åº</p><p><strong>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ¯æ¬¡ä¸Šç”µæ‰§è¡ŒRTCåˆå§‹åŒ–ä¹‹å‰ï¼Œå°†æ ‡å¿—è®¾ç½®ä¸ºé¢„æœŸå€¼å³å¯</strong></p><p><strong>åœ¨rtc.cä¸­çš„RTC_Initä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹å³å¯</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">void</span> <span class="title function_">MX_RTC_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">RTC_TimeTypeDef time;</span><br><span class="line">RTC_DateTypeDef datebuff;</span><br><span class="line"></span><br><span class="line">  RTC_TimeTypeDef sTime = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  RTC_DateTypeDef DateToUpdate = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">__HAL_RCC_BKP_CLK_ENABLE();</span><br><span class="line">__HAL_RCC_PWR_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">  hrtc.Instance = RTC;</span><br><span class="line">  hrtc.Init.AsynchPrediv = RTC_AUTO_1_SECOND;</span><br><span class="line">  hrtc.Init.OutPut = RTC_OUTPUTSOURCE_NONE;</span><br><span class="line">  <span class="keyword">if</span> (HAL_RTC_Init(&amp;hrtc) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(HAL_RTCEx_BKUPRead(&amp;hrtc,RTC_BKP_DR1)!= <span class="number">0x5051</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  sTime.Hours = <span class="number">0x14</span>;</span><br><span class="line">  sTime.Minutes = <span class="number">0x30</span>;</span><br><span class="line">  sTime.Seconds = <span class="number">0x0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (HAL_RTC_SetTime(&amp;hrtc, &amp;sTime, RTC_FORMAT_BCD) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line">  DateToUpdate.WeekDay = RTC_WEEKDAY_SATURDAY;</span><br><span class="line">  DateToUpdate.Month = RTC_MONTH_APRIL;</span><br><span class="line">  DateToUpdate.Date = <span class="number">0x25</span>;</span><br><span class="line">  DateToUpdate.Year = <span class="number">0x20</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (HAL_RTC_SetDate(&amp;hrtc, &amp;DateToUpdate, RTC_FORMAT_BCD) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">__HAL_RTC_SECOND_ENABLE_IT(&amp;hrtc,RTC_IT_SEC);</span><br><span class="line">datebuff = DateToUpdate;</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR1, <span class="number">0x5051</span>);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR2, (<span class="type">uint16_t</span>)datebuff.Year);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR3, (<span class="type">uint16_t</span>)datebuff.Month);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR4, (<span class="type">uint16_t</span>)datebuff.Date);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR5, (<span class="type">uint16_t</span>)datebuff.WeekDay);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">datebuff.Year    = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR2);</span><br><span class="line">datebuff.Month   = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR3);</span><br><span class="line">datebuff.Date    = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR4);</span><br><span class="line">datebuff.WeekDay = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR5);</span><br><span class="line">DateToUpdate = datebuff;</span><br><span class="line"><span class="keyword">if</span> (HAL_RTC_SetDate(&amp;hrtc, &amp;DateToUpdate, RTC_FORMAT_BIN) != HAL_OK)</span><br><span class="line">&#123;</span><br><span class="line">Error_Handler();</span><br><span class="line">&#125;</span><br><span class="line">__HAL_RTC_SECOND_ENABLE_IT(&amp;hrtc,RTC_IT_SEC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200425165901167.gif"><br><img src="https://img-blog.csdnimg.cn/20200425165904365.gif"></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºSTM32HALåº“ï¼ŒRC522ï¼ˆRFIDï¼‰æ¨¡å—è¯»å†™é©±åŠ¨ï¼Œæ— çº¿ICå¡è¯»å†™</title>
      <link href="/2024/03/stm32-%E5%9F%BA%E4%BA%8ESTM32HAL%E5%BA%93%EF%BC%8CRC522%EF%BC%88RFID%EF%BC%89%E6%A8%A1%E5%9D%97%E8%AF%BB%E5%86%99%E9%A9%B1%E5%8A%A8%EF%BC%8C%E6%97%A0%E7%BA%BFIC%E5%8D%A1%E8%AF%BB%E5%86%99/"/>
      <url>/2024/03/stm32-%E5%9F%BA%E4%BA%8ESTM32HAL%E5%BA%93%EF%BC%8CRC522%EF%BC%88RFID%EF%BC%89%E6%A8%A1%E5%9D%97%E8%AF%BB%E5%86%99%E9%A9%B1%E5%8A%A8%EF%BC%8C%E6%97%A0%E7%BA%BFIC%E5%8D%A1%E8%AF%BB%E5%86%99/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="ä¸€ã€æ¨¡å—ç®€çŸ­ä»‹ç»"><a href="#ä¸€ã€æ¨¡å—ç®€çŸ­ä»‹ç»" class="headerlink" title="ä¸€ã€æ¨¡å—ç®€çŸ­ä»‹ç»"></a>ä¸€ã€æ¨¡å—ç®€çŸ­ä»‹ç»</h2><p>æœ‰å…³RC522æ¨¡å—çš„èƒŒæ™¯çŸ¥è¯†ä»¥åŠå·¥ä½œåŸç†ï¼Œæœ¬æ¬¡å®éªŒæš‚æ—¶ä¸åšåˆ†äº«ï¼Œè¿™é‡Œè´´ä¸Šä¸¤ä½å†™å¾—å¾ˆå¥½çš„åšä¸»ï¼Œå¤§å®¶å¯è‡ªè¡ŒæŸ¥çœ‹ã€‚</p><p><a href="https://blog.csdn.net/m0_51220742/article/details/123683745" title="(5æ¡æ¶ˆæ¯) RC522(RFID)è¯»å†™é©±åŠ¨_æ¡ƒæˆè¹Š2.0çš„åšå®¢-CSDNåšå®¢">(5æ¡æ¶ˆæ¯) RC522(RFID)è¯»å†™é©±åŠ¨_æ¡ƒæˆè¹Š2.0çš„åšå®¢-CSDNåšå®¢<img src="https://csdnimg.cn/release/blog_editor_html/release2.3.6/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=N7T8">https://blog.csdn.net/m0_51220742&#x2F;article&#x2F;details&#x2F;123683745 ;</a> <a href="https://blog.csdn.net/weixin_45771489/article/details/124079134" title="(5æ¡æ¶ˆæ¯) STM32--RFIDæ— çº¿å°„é¢‘æŠ€æœ¯ï¼ˆRC522åˆ·å¡æ¨¡å—ï¼‰_rc522å°„é¢‘æ¨¡å—è¯¦ç»†èµ„æ–™_yé»å¥½å¥½çš„åšå®¢-CSDNåšå®¢">(5æ¡æ¶ˆæ¯) STM32â€“RFIDæ— çº¿å°„é¢‘æŠ€æœ¯ï¼ˆRC522åˆ·å¡æ¨¡å—ï¼‰_rc522å°„é¢‘æ¨¡å—è¯¦ç»†èµ„æ–™_yé»å¥½å¥½çš„åšå®¢-CSDNåšå®¢<img src="https://csdnimg.cn/release/blog_editor_html/release2.3.6/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=N7T8">https://blog.csdn.net/weixin_45771489&#x2F;article&#x2F;details&#x2F;124079134 ;</a></p><p><img src="https://img-blog.csdnimg.cn/b829df1211c843b49139edf393f1aa42.jpeg"></p><p>è¯¥æ¨¡å—ä»·æ ¼æ™®éå®æƒ ï¼Œæ‰€ä»¥æˆ‘ä¹°äº†ä¸€ä¸ªè‡ªå·±ç©ç©ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´çš„æ‘¸çˆ¬æ»šæ‰“ç›®å‰èƒ½å¤Ÿæ­£å¸¸è¯»å†™ï¼Œåç»­ä¼šç»§ç»­å®Œå–„è¯¥æ¨¡å—çš„ä½¿ç”¨ï¼Œå¹¶åŠ å…¥åˆ°å…¶ä»–åµŒå…¥å¼è®¾è®¡ä¸­ã€‚</p><h2 id="äºŒã€å¼€å‘èµ„æ–™çš„ä½¿ç”¨åŠç»éªŒåˆ†äº«"><a href="#äºŒã€å¼€å‘èµ„æ–™çš„ä½¿ç”¨åŠç»éªŒåˆ†äº«" class="headerlink" title="äºŒã€å¼€å‘èµ„æ–™çš„ä½¿ç”¨åŠç»éªŒåˆ†äº«"></a>äºŒã€å¼€å‘èµ„æ–™çš„ä½¿ç”¨åŠç»éªŒåˆ†äº«</h2><p>è¯¥æ¨¡å—çš„APIå‡½æ•°æ·˜å®æœ‰å¾ˆå¤šèµ„æºï¼Œæ•°æ®æ‰‹å†Œä¹Ÿæœ‰ï¼Œä¸è¿‡æ˜¯è‹±æ–‡ç‰ˆçš„ã€‚å»ºè®®å¤§å®¶æœ‰æ—¶é—´è¿˜æ˜¯è¦è¿‡ä¸€æ•°æ®æ‰‹å†Œçš„é‡è¦éƒ¨åˆ†ï¼Œæ¯”å¦‚å¯„å­˜å™¨å’ŒæŒ‡ä»¤é›†ï¼Œé€šä¿¡åè®®ç­‰ï¼Œå¯ä»¥ä½¿ç”¨çŸ¥äº‘æ–‡çŒ®æŸ¥çœ‹ï¼Œæˆ‘ä¹ æƒ¯ç”¨å®ƒæ¥çœ‹è®ºæ–‡ï¼Œé€‚åˆç¿»è¯‘é•¿æ®µå¤§æ®µã€‚ä¹Ÿå¯ä»¥ç”¨WPSçš„ç¿»è¯‘ï¼Œå°éƒ¨åˆ†ç¿»è¯‘ï¼Œçœ‹ä¸ªäººä½¿ç”¨ä¹ æƒ¯ã€‚è¦æ˜¯æœ‰èƒ½åŠ›ç›´æ¥æ’¸åŸæ–‡é‚£å°±æ›´å¥½ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚</p><p><img src="https://img-blog.csdnimg.cn/2e92c08f81ca46af8c0d2361b9d2e130.png"></p><p>æ‰¾è¿‡å¾ˆå¤šèµ„æ–™ï¼Œæä¾›çš„APIæ— éå°±æ˜¯ä¸€å¥—æ²¡æœ‰ç« æ³•ï¼Œæ¯«æ— å¯è¯»æ€§çš„æ‚ä¹±ä»£ç ï¼Œååˆ†å½±å“å­¦ä¹ æ•ˆæœã€‚è¿™é‡Œå»ºè®®å¤§å®¶ä¸è¦å»æ­»ç£•ï¼Œå¯ä»¥çœ‹æœ¬æ¬¡å®éªŒçš„ä»£ç é€»è¾‘å’Œä¸Šæ–‡æåˆ°çš„ä¸¤ä½åšä¸»ï¼Œæ¯ä¸€ä¸ªåº•å±‚å‡½æ•°éƒ½æœ‰æ³¨é‡Šï¼Œåœ¨ä¸€äº›åº•å±‚å‡½æ•°çš„é€»è¾‘ä¸Šå¯ä»¥ç»“åˆè¿™äº›APIå‡½æ•°è¿›è¡Œåæ¨æˆ–è€…æ ¡éªŒï¼Œå¯ä»¥å¸®åŠ©è¯»è€…ç†è§£å®ç°åŸç†ã€‚</p><p>ä¸€å¼€å§‹æ˜¯é€šè¿‡æ•°æ®æ‰‹å†Œï¼Œç¡¬ç€å¤´çš®å•ƒæ— è‰¯åº—é“ºç»™çš„ä»£ç ï¼Œæ²¡æœ‰æ³¨é‡Šï¼Œæ²¡æœ‰é€»è¾‘ï¼Œæ²¡æœ‰ç« æ³•ã€‚è™½ç„¶æ²¡æŠ¥é”™ï¼Œä½†æ˜¯èƒ½ä¸èƒ½ç”¨å®Œå…¨ä¸çŸ¥é“ï¼Œå°±æ˜¯è¿™ä¸€æ­¥å°±èŠ±äº†å¥½å‡ å¤©æ—¶é—´ï¼Œæ‰€ä»¥å»ºè®®å¤§å®¶ä¸è¦åƒæˆ‘ä¸€æ ·åŸ‹å¤´è‹¦è¯»ï¼Œå¯ä»¥å…ˆçœ‹æ¯ä¸€ä¸ªå‡½æ•°çš„ä¸­æ–‡æ³¨é‡Šï¼Œæ•´ç†å‡ºä¸€ä¸ªæ¡†æ¶ã€‚</p><h2 id="ä¸‰ã€æºç è§£æ"><a href="#ä¸‰ã€æºç è§£æ" class="headerlink" title="ä¸‰ã€æºç è§£æ"></a>ä¸‰ã€æºç è§£æ</h2><p>ä»£ç æ€»ä½“é€»è¾‘æ²¡æœ‰å˜åŒ–ï¼Œå‚è€ƒäº†ä¸¤ä½åšä¸»çš„æ€è·¯ï¼Œæˆ‘ç”¨å®˜æ–¹çš„APIå‡½æ•°è¿›è¡Œä¿®æ”¹ã€‚ä¸¤ä½åšä¸»ä¸€ä½ä½¿ç”¨çš„è½¯ä»¶å®ç°SPIåè®®ï¼Œä¸€ä½ä½¿ç”¨æ¿è½½SPIã€‚ä¸¤ç§æ–¹æ³•æˆ‘éƒ½è¯•è¿‡ï¼Œä½†æ˜¯è½¯ä»¶SPIåè®®æ€»æ˜¯é€šä¿¡å¤±è´¥ï¼Œä¸çŸ¥é“æ˜¯æˆ‘åè®®å†™çš„ä¸å¯¹è¿˜æ˜¯é€šä¿¡é€Ÿåº¦å’Œæ¨¡å—ä¸åŒ¹é…ï¼Œæš‚æ—¶è¿˜æœªè§£å†³ã€‚</p><h3 id="è½¯ä»¶æ¨¡æ‹ŸSPI"><a href="#è½¯ä»¶æ¨¡æ‹ŸSPI" class="headerlink" title="è½¯ä»¶æ¨¡æ‹ŸSPI"></a><strong>è½¯ä»¶æ¨¡æ‹ŸSPI</strong></h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSOFT_SPI_RC522_SendByte</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå‘RC522å‘é€1 Byte æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šwrite_datï¼Œè¦å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¿”å›  : RC522è¿”å›çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SOFT_SPI_RC522_SendByte</span>(<span class="params">uint8_t write_dat</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i</span><br></pre></td></tr></table></figure><p>æœ‰å¤§ä½¬å¦‚æœå‘ç°é—®é¢˜ï¼Œè¿˜è¯·ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´é€šä¿¡å¤±è´¥ã€‚</p><h3 id="æ¿è½½SPIé€šä¿¡"><a href="#æ¿è½½SPIé€šä¿¡" class="headerlink" title="æ¿è½½SPIé€šä¿¡"></a><strong>æ¿è½½SPIé€šä¿¡</strong></h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSPI_WriteNBytes</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå‘RC522å‘é€n Byte æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šSPIx : è¦å‘é€æ•°æ®çš„SPI</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šp_TxData : è¦å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šsendDataNum : è¦å‘é€çš„æ•°æ®é‡(Byte)</span></span><br><span class="line"><span class="comment"> * è¿”å›  : 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">int</span> <span class="title">SPI_WriteNBytes</span>(<span class="params">SPI_TypeDef* SPIx, uint8_t *p_TxData,uint32_t sendDataNum</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(sendDataNum--)&#123;</span><br><span class="line"><span class="keyword">while</span>((SPIx-&gt;SR&amp;SPI_FLAG_TXE)==<span class="number">0</span>)<span class="comment">//ç­‰å¾…å‘é€åŒºç©º</span></span><br><span class="line">&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">SPIx-&gt;DR=*p_TxData++;<span class="comment">//å‘é€ä¸€ä¸ªbyte</span></span><br><span class="line">retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>((SPIx-&gt;SR&amp;SPI_FLAG_RXNE)==<span class="number">0</span>)<span class="comment">//ç­‰å¾…æ¥æ”¶å®Œä¸€ä¸ªbyte</span></span><br><span class="line">&#123;</span><br><span class="line">SPIx-&gt;SR = SPIx-&gt;SR;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">SPIx-&gt;DR;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSPI_ReadNBytes</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè¯»å–RC522 n Byte æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šSPIx : è¦è¯»å–æ•°æ®çš„SPI</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šp_RxData : è¦è¯»å–çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šreadDataNum : è¦è¯»å–çš„æ•°æ®é‡(Byte)</span></span><br><span class="line"><span class="comment"> * è¿”å›  : 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">int</span> <span class="title">SPI_ReadNBytes</span>(<span class="params">SPI_TypeDef* SPIx, uint8_t *p_RxData,uint32_t readDataNum</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(readDataNum--)&#123;</span><br><span class="line">SPIx-&gt;DR = <span class="number">0xFF</span>;</span><br><span class="line"><span class="keyword">while</span>(!(SPIx-&gt;SR&amp;SPI_FLAG_TXE))&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">retry = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!(SPIx-&gt;SR&amp;SPI_FLAG_RXNE))&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">*p_RxData++ = SPIx-&gt;DR;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬å®éªŒä½¿ç”¨è¯»å–å¯„å­˜å™¨çŠ¶æ€æ¥å®ŒæˆSPIé€šä¿¡ï¼Œæœªä½¿ç”¨HAL_SPI_TransmitReceiveåº“å‡½æ•°ã€‚</p><h3 id="æºç éƒ¨åˆ†"><a href="#æºç éƒ¨åˆ†" class="headerlink" title="æºç éƒ¨åˆ†"></a>æºç éƒ¨åˆ†</h3><p>ä¸»å‡½æ•°æ¯”è¾ƒç®€ç•¥ï¼Œè°ƒç”¨ä¸€ä¸ªæ“ä½œå‡½æ•°ï¼Œç”¨æŒ‰é”®è§¦å‘çš„æ–¹å¼å¯åŠ¨è¯¥å‡½æ•°å®ç°è¯»å†™ã€‚main.c ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹ä»£ç ï¼š</p><h4 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h4><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   RC522_Init();</span><br><span class="line">uint8_t key;</span><br><span class="line"></span><br><span class="line">   uint8_t Write_Card_Data[<span class="number">16</span>]=&#123;<span class="number">0</span>&#125;;<span class="comment">//è¦å†™å…¥çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">key = key_scan();<span class="comment">//æŒ‰é”®æ‰«æå‡½æ•°ï¼Œè‡ªå·±å®šä¹‰ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">if</span>(key==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">RC522_Start(<span class="number">5</span>,readID,Write_Card_Data);<span class="comment">//readID  è¯»å‘½ä»¤</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(key==<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">RC522_Start(<span class="number">5</span>,writeID,Write_Card_Data);<span class="comment">//writeID  å†™å‘½ä»¤</span></span><br><span class="line">&#125;</span><br><span class="line">delay_ms(<span class="number">100</span>);</span><br><span class="line">LED0=!LED0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RC522éƒ¨åˆ†"><a href="#RC522éƒ¨åˆ†" class="headerlink" title="RC522éƒ¨åˆ†"></a>RC522éƒ¨åˆ†</h4><p><strong>RC522.c</strong></p><p>å…¶ä¸­RC522_Startæ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼Œåªè¦æ“ä½œæµç¨‹æ­£ç¡®ï¼Œå¯è‡ªè¡Œç¼–å†™æƒ³è¦çš„æ“ä½œæ–¹å¼ï¼Œæœ¬å®éªŒåªå®Œæˆç®€å•çš„å•å—è¯»å†™æ“ä½œã€‚è“å¡å’Œç™½å¡çš„å¡å·æ ¹æ®è‡ªå·±çš„ä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡æ‰‹æœºNFCåŠŸèƒ½æŸ¥çœ‹å¡å·ï¼ŒåŒæ—¶ä¹Ÿèƒ½æŸ¥çœ‹æ‰‡åŒºæ•°æ®ï¼ŒAPPå¯ä»¥ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„åšä¸»æ¨èçš„NFC Writerã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include &quot;RC522.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;stdio.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;delay.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;spi.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;oled.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;string.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// M1å¡åˆ†ä¸º16ä¸ªæ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒºç”±å››ä¸ªå—ï¼ˆå—0ã€å—1ã€å—2ã€å—3ï¼‰ç»„æˆ</span></span><br><span class="line"><span class="comment">// å°†16ä¸ªæ‰‡åŒºçš„64ä¸ªå—æŒ‰ç»å¯¹åœ°å€ç¼–å·ä¸ºï¼š0~63,æ¯å—16ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment">// ç¬¬0ä¸ªæ‰‡åŒºçš„å—0ï¼ˆå³ç»å¯¹åœ°å€0å—ï¼‰ï¼Œç”¨äºå­˜æ”¾å‚å•†ä»£ç ï¼Œå·²ç»å›ºåŒ–ä¸å¯æ›´æ”¹</span></span><br><span class="line"><span class="comment">// æ¯ä¸ªæ‰‡åŒºçš„å—0ã€å—1ã€å—2ä¸ºæ•°æ®å—ï¼Œå¯ç”¨äºå­˜æ”¾æ•°æ®</span></span><br><span class="line"><span class="comment">// æ¯ä¸ªæ‰‡åŒºçš„å—3ä¸ºæ§åˆ¶å—ï¼ˆç»å¯¹åœ°å€ä¸º:å—3ã€å—7ã€å—11.....ï¼‰åŒ…æ‹¬å¯†ç Aï¼Œå­˜å–æ§åˆ¶ã€å¯†ç Bç­‰</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">RC522_SPI_GPIO_Init();<span class="comment">//åˆå§‹åŒ–RC522çš„å¤ä½å¼•è„šå’Œç‰‡é€‰å¼•è„š</span></span><br><span class="line"></span><br><span class="line">SPI1_Init();<span class="comment">//åˆå§‹åŒ–SPI</span></span><br><span class="line"></span><br><span class="line">    delay_ms(<span class="number">50</span>);</span><br><span class="line">PcdReset();<span class="comment">//å¤ä½RC522è¯»å¡å™¨</span></span><br><span class="line"></span><br><span class="line">delay_ms(<span class="number">10</span>);</span><br><span class="line">PcdAntennaOff();<span class="comment">//å…³é—­å¤©çº¿å‘å°„</span></span><br><span class="line"></span><br><span class="line">delay_ms(<span class="number">10</span>);</span><br><span class="line">    PcdAntennaOn();<span class="comment">//å¼€å¯å¤©çº¿å‘å°„</span></span><br><span class="line"></span><br><span class="line">printf(<span class="string">&quot;RFID-MFRC522 åˆå§‹åŒ–å®Œæˆ\nPress KEY0 Or KEY1 To Start...\r\n&quot;</span>);  <span class="comment">//åˆå§‹åŒ–å®Œæˆ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uint8_t IC_UID[<span class="number">4</span>]; <span class="comment">//UIDå¡ç‰‡åºåˆ—å·,4å­—èŠ‚</span></span><br><span class="line">uint8_t IC_Type[<span class="number">2</span>];<span class="comment">//å¡ç±»å‹ä»£ç ï¼Œ2å­—èŠ‚,0x0400ï¼ŒMifare_One(S50)</span></span><br><span class="line">uint8_t card_1[<span class="number">4</span>]=&#123;<span class="number">0xC3</span>,<span class="number">0xB2</span>,<span class="number">0x37</span>,<span class="number">0xC5</span>&#125;;<span class="comment">//è“å¡1å¡å·</span></span><br><span class="line">uint8_t card_2[<span class="number">4</span>]=&#123;<span class="number">0xA3</span>,<span class="number">0x09</span>,<span class="number">0x3C</span>,<span class="number">0xFB</span>&#125;;<span class="comment">//ç™½å¡2å¡å·</span></span><br><span class="line">uint8_t ID_num=<span class="number">0</span>;<span class="comment">//å½“å‰æ“ä½œçš„åºå·</span></span><br><span class="line">uint8_t Card_KEY[<span class="number">6</span>]=&#123;<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>&#125;;<span class="comment">//éªŒè¯å¯†ç </span></span><br><span class="line">uint8_t Card_Data[<span class="number">16</span>];<span class="comment">//è¯»å–å‡ºçš„å—æ•°æ®</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šRC522_Start</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  blockï¼šè¦æ“ä½œçš„å—åœ°å€</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  optionï¼šè¯»æ“ä½œæˆ–å†™æ“ä½œ</span></span><br><span class="line"><span class="comment"> *              readID  1//è¯»</span></span><br><span class="line"><span class="comment"> *writeID 2//å†™</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  blockï¼šè¦æ“ä½œçš„å—åœ°å€</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šRC522æ“ä½œä¸»å‡½æ•°ï¼Œå¯å®Œæˆå¯¹å¡çš„è¯»å†™æ“ä½œ</span></span><br><span class="line"><span class="comment"> *  * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = 1ï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Start</span>(<span class="params">uint8_t block,uint8_t option,uint8_t *Write_Card_Data</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(PcdRequest(PICC_REQALL,IC_Type) == MI_OK)<span class="comment">//å¯»å¡</span></span><br><span class="line">&#123;</span><br><span class="line">uint16_t cardType = (IC_Type[<span class="number">0</span>] &lt;&lt; <span class="number">8</span>) | IC_Type[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">switch</span> (cardType)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x4400</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare UltraLight\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x0400</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare One(S50)\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x0200</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare One(S70)\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x0800</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare Pro(X)\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x4403</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare DESFire\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="literal">default</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nUnknown Card\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">if</span>(PcdAnticoll(IC_UID)==MI_OK)<span class="comment">//é˜²å†²æ’</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>((IC_UID[<span class="number">0</span>]==card_1[<span class="number">0</span>])&amp;&amp;(IC_UID[<span class="number">1</span>]==card_1[<span class="number">1</span>])&amp;&amp;(IC_UID[<span class="number">2</span>]==card_1[<span class="number">2</span>])&amp;&amp;(IC_UID[<span class="number">3</span>]==card_1[<span class="number">3</span>]))</span><br><span class="line">            &#123;</span><br><span class="line">                ID_num=<span class="number">1</span>;</span><br><span class="line">                printf(<span class="string">&quot;The User is: %d, Blue card&quot;</span>,ID_num);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>((IC_UID[<span class="number">0</span>]==card_2[<span class="number">0</span>])&amp;&amp;(IC_UID[<span class="number">1</span>]==card_2[<span class="number">1</span>])&amp;&amp;(IC_UID[<span class="number">2</span>]==card_2[<span class="number">2</span>])&amp;&amp;(IC_UID[<span class="number">3</span>]==card_2[<span class="number">3</span>]))</span><br><span class="line">            &#123;</span><br><span class="line">                ID_num=<span class="number">2</span>;</span><br><span class="line">                printf(<span class="string">&quot;The User is: %d, White card&quot;</span>,ID_num);</span><br><span class="line">            &#125;</span><br><span class="line">            printf(<span class="string">&quot;\r\ncard_ID: %02X:%02X:%02X:%02X\r\n&quot;</span>,IC_UID[<span class="number">0</span>],IC_UID[<span class="number">1</span>],IC_UID[<span class="number">2</span>],IC_UID[<span class="number">3</span>]); <span class="comment">//æ‰“å°å¡çš„UIDå·</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(PcdSelect(IC_UID)==MI_OK)<span class="comment">//é€‰å¡</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(PcdAuthState(PICC_AUTHENT1A,block,Card_KEY,IC_UID)==MI_OK)<span class="comment">//éªŒè¯Aå¯†é’¥,å¯¹åº”å—</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//memset(Card_Data,1,16);</span></span><br><span class="line"><span class="keyword">if</span>(option==readID)<span class="comment">//è¯»æ“ä½œ</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(PcdRead(block,Card_Data)==MI_OK)</span><br><span class="line">&#123;</span><br><span class="line">printf(<span class="string">&quot;\nè¯»å–ç»“æœ: \n&quot;</span>);</span><br><span class="line">printf(<span class="string">&quot;block %d date:\r\n&quot;</span>,block);</span><br><span class="line">categories:</span><br><span class="line">    - stm32</span><br><span class="line">    - stm32halåº“å¼€å‘</span><br><span class="line">tags:</span><br><span class="line">    - stm32</span><br><span class="line">    - å¤–è®¾</span><br><span class="line"><span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;iSR&amp;SPI_FLAG_TXE)==<span class="number">0</span>)<span class="comment">//ç­‰å¾…å‘é€åŒºç©º</span></span><br><span class="line">&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">SPIx-&gt;DR=*p_TxData++;<span class="comment">//å‘é€ä¸€ä¸ªbyte</span></span><br><span class="line">retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>((SPIx-&gt;SR&amp;SPI_FLAG_RXNE)==<span class="number">0</span>)<span class="comment">//ç­‰å¾…æ¥æ”¶å®Œä¸€ä¸ªbyte</span></span><br><span class="line">&#123;</span><br><span class="line">SPIx-&gt;SR = SPIx-&gt;SR;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">SPIx-&gt;DR;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSPI_ReadNBytes</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè¯»å–RC522 n Byte æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šSPIx : è¦è¯»å–æ•°æ®çš„SPI</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šp_RxData : è¦è¯»å–çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šreadDataNum : è¦è¯»å–çš„æ•°æ®é‡(Byte)</span></span><br><span class="line"><span class="comment"> * è¿”å›  : 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">int</span> <span class="title">SPI_ReadNBytes</span>(<span class="params">SPI_TypeDef* SPIx, uint8_t *p_RxData,uint32_t readDataNum</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(readDataNum--)&#123;</span><br><span class="line">SPIx-&gt;DR = <span class="number">0xFF</span>;</span><br><span class="line"><span class="keyword">while</span>(!(SPIx-&gt;SR&amp;SPI_FLAG_TXE))&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">retry = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!(SPIx-&gt;SR&amp;SPI_FLAG_RXNE))&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">*p_RxData++ = SPIx-&gt;DR;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdComMF522</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šé€šè¿‡RC522å’ŒISO14443å¡é€šè®¯</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucCommandï¼ŒRC522å‘½ä»¤å­—</span></span><br><span class="line"><span class="comment"> *         pInDataï¼Œé€šè¿‡RC522å‘é€åˆ°å¡ç‰‡çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> *         ucInLenByteï¼Œå‘é€æ•°æ®çš„å­—èŠ‚é•¿åº¦</span></span><br><span class="line"><span class="comment"> *         pOutDataï¼Œæ¥æ”¶åˆ°çš„å¡ç‰‡è¿”å›æ•°æ®</span></span><br><span class="line"><span class="comment"> *         pOutLenBitï¼Œè¿”å›æ•°æ®çš„ä½é•¿åº¦</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨  ï¼šå†…éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdComMF522</span>(<span class="params">uint8_t Command,uint8_t *pInData,uint8_t InLenByte,uint8_t *pOutData,uint32_t *pOutLenBit</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status = MI_ERR;</span><br><span class="line">    uint8_t irqEn = <span class="number">0x00</span>;</span><br><span class="line">    uint8_t waitFor = <span class="number">0x00</span>;</span><br><span class="line">    uint8_t lastBits;</span><br><span class="line">    uint8_t n;</span><br><span class="line">    uint32_t i;</span><br><span class="line">    <span class="keyword">switch</span> (Command)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> PCD_AUTHENT:   <span class="comment">//Mifareè®¤è¯</span></span><br><span class="line">        irqEn = <span class="number">0x12</span>;   <span class="comment">//å…è®¸é”™è¯¯ä¸­æ–­è¯·æ±‚ErrIEn  å…è®¸ç©ºé—²ä¸­æ–­IdleIEn</span></span><br><span class="line">        waitFor = <span class="number">0x10</span>; <span class="comment">//è®¤è¯å¯»å¡ç­‰å¾…æ—¶å€™ æŸ¥è¯¢ç©ºé—²ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> PCD_TRANSCEIVE:<span class="comment">//æ¥æ”¶å‘é€ å‘é€æ¥æ”¶</span></span><br><span class="line">        irqEn = <span class="number">0x77</span>;   <span class="comment">//å…è®¸TxIEn RxIEn IdleIEn LoAlertIEn ErrIEn TimerIEn</span></span><br><span class="line">        waitFor = <span class="number">0x30</span>; <span class="comment">//å¯»å¡ç­‰å¾…æ—¶å€™ æŸ¥è¯¢æ¥æ”¶ä¸­æ–­æ ‡å¿—ä½ä¸ ç©ºé—²ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="literal">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    WriteRawRC(ComIEnReg, irqEn | <span class="number">0x80</span>); <span class="comment">//IRqInvç½®ä½ç®¡è„šIRQä¸Status1Regçš„IRqä½çš„å€¼ç›¸å</span></span><br><span class="line">    ClearBitMask(ComIrqReg, <span class="number">0x80</span>);       <span class="comment">//Set1è¯¥ä½æ¸…é›¶æ—¶ï¼ŒCommIRqRegçš„å±è”½ä½æ¸…é›¶</span></span><br><span class="line">    WriteRawRC(CommandReg, PCD_IDLE);    <span class="comment">//å†™ç©ºé—²å‘½ä»¤</span></span><br><span class="line">    SetBitMask(FIFOLevelReg, <span class="number">0x80</span>);      <span class="comment">//ç½®ä½FlushBufferæ¸…é™¤å†…éƒ¨FIFOçš„è¯»å’Œå†™æŒ‡é’ˆä»¥åŠErrRegçš„BufferOvflæ ‡å¿—ä½è¢«æ¸…é™¤</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; InLenByte; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        WriteRawRC(FIFODataReg, pInData[i]);<span class="comment">//å†™æ•°æ®è¿›FIFOdata</span></span><br><span class="line">    &#125;</span><br><span class="line">    WriteRawRC(CommandReg, Command);<span class="comment">//å†™å‘½ä»¤</span></span><br><span class="line">    <span class="keyword">if</span> (Command == PCD_TRANSCEIVE)</span><br><span class="line">    &#123;</span><br><span class="line">        SetBitMask(BitFramingReg, <span class="number">0x80</span>);<span class="comment">//StartSendç½®ä½å¯åŠ¨æ•°æ®å‘é€ è¯¥ä½ä¸æ”¶å‘å‘½ä»¤ä½¿ç”¨æ—¶æ‰æœ‰æ•ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">800</span>;<span class="comment">//æ ¹æ®æ—¶é’Ÿé¢‘ç‡è°ƒæ•´ï¼Œæ“ä½œM1å¡æœ€å¤§ç­‰å¾…æ—¶é—´25ms</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = ReadRawRC(ComIrqReg);<span class="comment">//æŸ¥è¯¢äº‹ä»¶ä¸­æ–­</span></span><br><span class="line">        i--;</span><br><span class="line">    &#125; <span class="keyword">while</span> ((i != <span class="number">0</span>) &amp;&amp; !(n &amp; <span class="number">0x01</span>) &amp;&amp; !(n &amp; waitFor));<span class="comment">//é€€å‡ºæ¡ä»¶i=0,å®šæ—¶å™¨ä¸­æ–­ï¼Œä¸å†™ç©ºé—²å‘½ä»¤</span></span><br><span class="line">    ClearBitMask(BitFramingReg, <span class="number">0x80</span>);<span class="comment">//æ¸…ç†å…è®¸StartSendä½</span></span><br><span class="line">    <span class="keyword">if</span> (i != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(ReadRawRC(ErrorReg) &amp; <span class="number">0x1B</span>))<span class="comment">//è¯»é”™è¯¯æ ‡å¿—å¯„å­˜å™¨BufferOfI CollErr ParityErr ProtocolErr</span></span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_OK;</span><br><span class="line">            <span class="keyword">if</span> (n &amp; irqEn &amp; <span class="number">0x01</span>)<span class="comment">//æ˜¯å¦å‘ç”Ÿå®šæ—¶å™¨ä¸­æ–­</span></span><br><span class="line">            &#123;</span><br><span class="line">                status = MI_NOTAGERR;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (Command == PCD_TRANSCEIVE)</span><br><span class="line">            &#123;</span><br><span class="line">                n = ReadRawRC(FIFOLevelReg);<span class="comment">//è¯»FIFOä¸­ä¿å­˜çš„å­—èŠ‚æ•°</span></span><br><span class="line">                lastBits = ReadRawRC(ControlReg) &amp; <span class="number">0x07</span>;<span class="comment">//æœ€åæ¥æ”¶åˆ°å¾—å­—èŠ‚çš„æœ‰æ•ˆä½æ•°</span></span><br><span class="line">                <span class="keyword">if</span> (lastBits)</span><br><span class="line">                &#123;</span><br><span class="line">                    *pOutLenBit = (n - <span class="number">1</span>) * <span class="number">8</span> + lastBits;<span class="comment">//Nä¸ªå­—èŠ‚æ•°å‡å»1ï¼ˆæœ€åä¸€ä¸ªå­—èŠ‚ï¼‰+æœ€åä¸€ä½çš„ä½æ•° è¯»å–åˆ°çš„æ•°æ®æ€»ä½æ•°</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    *pOutLenBit = n * <span class="number">8</span>;<span class="comment">//æœ€åæ¥æ”¶åˆ°çš„å­—èŠ‚æ•´ä¸ªå­—èŠ‚æœ‰æ•ˆ</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (n == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    n = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (n &gt; MAXRLEN)</span><br><span class="line">                &#123;</span><br><span class="line">                    n = MAXRLEN;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    pOutData[i] = ReadRawRC(FIFODataReg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_ERR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    SetBitMask(ControlReg, <span class="number">0x80</span>); <span class="comment">// stop timer now</span></span><br><span class="line">    WriteRawRC(CommandReg, PCD_IDLE);</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdRequest</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¯»å¡</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucReq_codeï¼Œå¯»å¡æ–¹å¼</span></span><br><span class="line"><span class="comment"> *                     = 0x52ï¼Œå¯»æ„Ÿåº”åŒºå†…æ‰€æœ‰ç¬¦åˆ14443Aæ ‡å‡†çš„å¡</span></span><br><span class="line"><span class="comment"> *                     = 0x26ï¼Œå¯»æœªè¿›å…¥ä¼‘çœ çŠ¶æ€çš„å¡</span></span><br><span class="line"><span class="comment"> *         pTagTypeï¼Œå¡ç‰‡ç±»å‹ä»£ç </span></span><br><span class="line"><span class="comment"> *                   = 0x4400ï¼ŒMifare_UltraLight</span></span><br><span class="line"><span class="comment"> *                   = 0x0400ï¼ŒMifare_One(S50)</span></span><br><span class="line"><span class="comment"> *                   = 0x0200ï¼ŒMifare_One(S70)</span></span><br><span class="line"><span class="comment"> *                   = 0x0800ï¼ŒMifare_Pro(X))</span></span><br><span class="line"><span class="comment"> *                   = 0x4403ï¼ŒMifare_DESFire</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdRequest</span>(<span class="params">uint8_t req_code, uint8_t *pTagType</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line"></span><br><span class="line">    ClearBitMask(Status2Reg, <span class="number">0x08</span>);  <span class="comment">//æ¸…é™¤RC522å¯„å­˜ä½,æ¸…ç†æŒ‡ç¤ºMIFARECyptolå•å…ƒæ¥é€šä»¥åŠæ‰€æœ‰å¡çš„æ•°æ®é€šä¿¡è¢«åŠ å¯†çš„æƒ…å†µ</span></span><br><span class="line">    WriteRawRC(BitFramingReg, <span class="number">0x07</span>); <span class="comment">//å†™RC522å¯„å­˜å™¨ï¼Œå‘é€çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„ä¸ƒä½</span></span><br><span class="line">    SetBitMask(TxControlReg, <span class="number">0x03</span>);  å†™RC522å¯„å­˜ä½ï¼ŒTX1,TX2ç®¡è„šçš„è¾“å‡ºä¿¡å·ä¼ é€’ç»å‘é€è°ƒåˆ¶çš„<span class="number">13.56</span>çš„èƒ½é‡è½½æ³¢ä¿¡å·</span><br><span class="line"></span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = req_code;<span class="comment">//å­˜å…¥å¯»å¡æ–¹å¼</span></span><br><span class="line"></span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">1</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status == MI_OK) &amp;&amp; (unLen == <span class="number">0x10</span>))<span class="comment">//å¯»å¡æˆåŠŸè¿”å›å¡ç±»å‹</span></span><br><span class="line">    &#123;</span><br><span class="line">        *pTagType = ucComMF522Buf[<span class="number">0</span>];</span><br><span class="line">        *(pTagType + <span class="number">1</span>) = ucComMF522Buf[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdAnticoll</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šé˜²å†²æ’</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼špSnrï¼Œå¡ç‰‡åºåˆ—å·ï¼Œ4å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdAnticoll</span>(<span class="params">uint8_t *pSnr</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint8_t i, snr_check = <span class="number">0</span>;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ClearBitMask(Status2Reg, <span class="number">0x08</span>);<span class="comment">//æ¸…MFCryptol Onä½,åªæœ‰æˆåŠŸæ‰§è¡ŒMFAuthentå‘½ä»¤åï¼Œè¯¥ä½æ‰èƒ½ç½®ä½</span></span><br><span class="line">    WriteRawRC(BitFramingReg, <span class="number">0x00</span>);<span class="comment">//æ¸…ç†å¯„å­˜å™¨,åœæ­¢æ”¶å‘</span></span><br><span class="line">    ClearBitMask(CollReg, <span class="number">0x80</span>);<span class="comment">//æ¸…ValuesAfterCollæ‰€æœ‰æ¥æ”¶çš„ä½åœ¨å†²çªåè¢«æ¸…é™¤</span></span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_ANTICOLL1;<span class="comment">//å¡ç‰‡é˜²å†²çªå‘½ä»¤</span></span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = <span class="number">0x20</span>;</span><br><span class="line"></span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">2</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            *(pSnr + i) = ucComMF522Buf[i];</span><br><span class="line">            snr_check ^= ucComMF522Buf[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (snr_check != ucComMF522Buf[i])</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_ERR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    SetBitMask(CollReg, <span class="number">0x80</span>);</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdSelect</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šé€‰å®šå¡ç‰‡</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼špSnrï¼Œå¡ç‰‡åºåˆ—å·ï¼Œ4å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdSelect</span>(<span class="params">uint8_t *pSnr</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint8_t i;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_ANTICOLL1;<span class="comment">//é˜²å†²æ’</span></span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = <span class="number">0x70</span>;</span><br><span class="line">    ucComMF522Buf[<span class="number">6</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[i + <span class="number">2</span>] = *(pSnr + i);</span><br><span class="line">        ucComMF522Buf[<span class="number">6</span>] ^= *(pSnr + i);</span><br><span class="line">    &#125;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">7</span>, &amp;ucComMF522Buf[<span class="number">7</span>]);</span><br><span class="line">    ClearBitMask(Status2Reg, <span class="number">0x08</span>);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">9</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status == MI_OK) &amp;&amp; (unLen == <span class="number">0x18</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdAuthState</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šéªŒè¯å¡ç‰‡å¯†ç </span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucAuth_modeï¼Œå¯†ç éªŒè¯æ¨¡å¼</span></span><br><span class="line"><span class="comment"> *                     = 0x60ï¼ŒéªŒè¯Aå¯†é’¥</span></span><br><span class="line"><span class="comment"> *                     = 0x61ï¼ŒéªŒè¯Bå¯†é’¥</span></span><br><span class="line"><span class="comment"> *         uint8_t ucAddrï¼Œå—åœ°å€</span></span><br><span class="line"><span class="comment"> *         pKeyï¼Œå¯†ç </span></span><br><span class="line"><span class="comment"> *         pSnrï¼Œå¡ç‰‡åºåˆ—å·ï¼Œ4å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdAuthState</span>(<span class="params">uint8_t auth_mode, uint8_t addr, uint8_t *pKey, uint8_t *pSnr</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t i, ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = auth_mode;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[i + <span class="number">2</span>] = *(pKey + i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[i + <span class="number">8</span>] = *(pSnr + i);</span><br><span class="line">    &#125;</span><br><span class="line">    status = PcdComMF522(PCD_AUTHENT, ucComMF522Buf, <span class="number">12</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (!(ReadRawRC(Status2Reg) &amp; <span class="number">0x08</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdRead</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè¯»å–M1å¡ä¸€å—æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šuint8_t ucAddrï¼Œå—åœ°å€</span></span><br><span class="line"><span class="comment"> *         pDataï¼Œè¯»å‡ºçš„æ•°æ®ï¼Œ16å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨  ï¼šå¤–éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdRead</span>(<span class="params">uint8_t addr, uint8_t *pData</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t i, ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_READ;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status == MI_OK) &amp;&amp; (unLen == <span class="number">0x90</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            *(pData + i) = ucComMF522Buf[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdWrite</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå†™æ•°æ®åˆ°M1å¡ä¸€å—</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šuint8_t ucAddrï¼Œå—åœ°å€</span></span><br><span class="line"><span class="comment"> *         pDataï¼Œå†™å…¥çš„æ•°æ®ï¼Œ16å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨  ï¼šå¤–éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdWrite</span>(<span class="params">uint8_t addr, uint8_t *pData</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t i, ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_WRITE;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            ucComMF522Buf[i] = *(pData + i);</span><br><span class="line">        &#125;</span><br><span class="line">        CalulateCRC(ucComMF522Buf, <span class="number">16</span>, &amp;ucComMF522Buf[<span class="number">16</span>]);</span><br><span class="line"></span><br><span class="line">        status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">18</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">        <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_ERR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdValue</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šæ‰£æ¬¾å’Œå……å€¼</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šdd_mode[IN]ï¼šå‘½ä»¤å­—</span></span><br><span class="line"><span class="comment"> *              0xC0 = æ‰£æ¬¾</span></span><br><span class="line"><span class="comment"> *              0xC1 = å……å€¼</span></span><br><span class="line"><span class="comment"> *         addr[IN]ï¼šé’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment"> *         pValue[IN]ï¼š4å­—èŠ‚å¢(å‡)å€¼ï¼Œä½ä½åœ¨å‰</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdValue</span>(<span class="params">uint8_t dd_mode, uint8_t addr, uint8_t *pValue</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t i, ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = dd_mode;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            ucComMF522Buf[i] = *(pValue + i);</span><br><span class="line">        &#125;</span><br><span class="line">        CalulateCRC(ucComMF522Buf, <span class="number">4</span>, &amp;ucComMF522Buf[<span class="number">4</span>]);</span><br><span class="line">        unLen = <span class="number">0</span>;</span><br><span class="line">        status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">6</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">        <span class="keyword">if</span> (status != MI_ERR)</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_OK;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[<span class="number">0</span>] = PICC_TRANSFER;</span><br><span class="line">        ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">        CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">        status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_ERR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdBakValue</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¤‡ä»½é’±åŒ…</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šsourceaddr[IN]ï¼šæºåœ°å€</span></span><br><span class="line"><span class="comment"> *         goaladdr[IN]ï¼šç›®æ ‡åœ°å€</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdBakValue</span>(<span class="params">uint8_t sourceaddr, uint8_t goaladdr</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_RESTORE;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = sourceaddr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        ucComMF522Buf[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        ucComMF522Buf[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">        ucComMF522Buf[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">        CalulateCRC(ucComMF522Buf, <span class="number">4</span>, &amp;ucComMF522Buf[<span class="number">4</span>]);</span><br><span class="line">        status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">6</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">        <span class="keyword">if</span> (status != MI_ERR)</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_OK;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status != MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_TRANSFER;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = goaladdr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdHalt</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå‘½ä»¤å¡ç‰‡è¿›å…¥ä¼‘çœ çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdHalt</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line"></span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_HALT;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MI_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šCalulateCRC</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šç”¨RC522è®¡ç®—CRC16</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼špIndataï¼Œè®¡ç®—CRC16çš„æ•°ç»„</span></span><br><span class="line"><span class="comment"> *         ucLenï¼Œè®¡ç®—CRC16çš„æ•°ç»„å­—èŠ‚é•¿åº¦</span></span><br><span class="line"><span class="comment"> *         pOutDataï¼Œå­˜æ”¾è®¡ç®—ç»“æœå­˜æ”¾çš„é¦–åœ°å€</span></span><br><span class="line"><span class="comment"> * è¿”å›  : æ— </span></span><br><span class="line"><span class="comment"> * è°ƒç”¨  ï¼šå†…éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CalulateCRC</span>(<span class="params">uint8_t *pIndata, uint8_t len, uint8_t *pOutData</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t i, n;</span><br><span class="line">    ClearBitMask(DivIrqReg, <span class="number">0x04</span>);</span><br><span class="line">    WriteRawRC(CommandReg, PCD_IDLE);</span><br><span class="line">    SetBitMask(FIFOLevelReg, <span class="number">0x80</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        WriteRawRC(FIFODataReg, *(pIndata + i));</span><br><span class="line">    &#125;</span><br><span class="line">    WriteRawRC(CommandReg, PCD_CALCCRC);</span><br><span class="line">    i = <span class="number">0xFF</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = ReadRawRC(DivIrqReg);</span><br><span class="line">        i--;</span><br><span class="line">    &#125; <span class="keyword">while</span> ((i != <span class="number">0</span>) &amp;&amp; !(n &amp; <span class="number">0x04</span>));</span><br><span class="line">    pOutData[<span class="number">0</span>] = ReadRawRC(CRCResultRegL);</span><br><span class="line">    pOutData[<span class="number">1</span>] = ReadRawRC(CRCResultRegM);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdRese</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¤ä½RC522</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdReset</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">RC522_Reset_Disable();</span><br><span class="line">    delay_ms(<span class="number">10</span>);</span><br><span class="line">    RC522_Reset_Enable();</span><br><span class="line">    delay_ms(<span class="number">60</span>);</span><br><span class="line">    RC522_Reset_Disable();</span><br><span class="line">    delay_ms(<span class="number">500</span>);</span><br><span class="line">    WriteRawRC(CommandReg, PCD_RESETPHASE);<span class="comment">//å¤ä½æŒ‡ä»¤</span></span><br><span class="line">    delay_ms(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    WriteRawRC(ModeReg, <span class="number">0x3D</span>);<span class="comment">//å®šä¹‰å‘é€å’Œæ¥æ”¶å¸¸ç”¨æ¨¡å¼,å’ŒMifareå¡é€šè®¯ï¼ŒCRCåˆå§‹å€¼0x6363</span></span><br><span class="line">    WriteRawRC(TReloadRegL, <span class="number">30</span>);<span class="comment">//16ä½å®šæ—¶å™¨ä½ä½</span></span><br><span class="line">    WriteRawRC(TReloadRegH, <span class="number">0</span>);<span class="comment">//16ä½å®šæ—¶å™¨é«˜ä½</span></span><br><span class="line">    WriteRawRC(TModeReg, <span class="number">0x8D</span>);<span class="comment">//å®šä¹‰å†…éƒ¨å®šæ—¶å™¨çš„è®¾ç½®</span></span><br><span class="line">    WriteRawRC(TPrescalerReg, <span class="number">0x3E</span>);<span class="comment">//è®¾ç½®å®šæ—¶å™¨åˆ†é¢‘ç³»æ•°</span></span><br><span class="line">    WriteRawRC(TxAutoReg, <span class="number">0x40</span>);<span class="comment">//è°ƒåˆ¶å‘é€ä¿¡å·ä¸º100%ASK</span></span><br><span class="line"></span><br><span class="line">    ClearBitMask(TestPinEnReg, <span class="number">0x80</span>);</span><br><span class="line">    WriteRawRC(TxAutoReg, <span class="number">0x40</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MI_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šReadRawRC</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè¯»RC522å¯„å­˜å™¨</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucAddressï¼Œå¯„å­˜å™¨åœ°å€</span></span><br><span class="line"><span class="comment"> * è¿”å›  : å¯„å­˜å™¨çš„å½“å‰å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">uint8_t <span class="title">ReadRawRC</span>(<span class="params">uint8_t Address</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t ucAddr;</span><br><span class="line">    uint8_t ucResult = <span class="number">0</span>;</span><br><span class="line">    ucAddr = ((Address &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0x7E</span>) | <span class="number">0x80</span>;<span class="comment">//æœ€é«˜ä½ç½®1ï¼Œè¯»æ“ä½œ;æœ€ä½ä¸ºé»˜è®¤0</span></span><br><span class="line">    delay_ms(<span class="number">1</span>);</span><br><span class="line">    RC522_CS_Enable();</span><br><span class="line">    SPI_WriteNBytes(SPI1_SPI, &amp;ucAddr, <span class="number">1</span>);  <span class="comment">//å‘æ€»çº¿å†™å¤šä¸ªæ•°æ®</span></span><br><span class="line">    SPI_ReadNBytes(SPI1_SPI, &amp;ucResult, <span class="number">1</span>); <span class="comment">//å‘æ€»çº¿è¯»å¤šä¸ªæ•°æ®</span></span><br><span class="line">    RC522_CS_Disable();</span><br><span class="line">    <span class="keyword">return</span> ucResult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šWriteRawRC</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå†™RC522å¯„å­˜å™¨</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucAddressï¼Œå¯„å­˜å™¨åœ°å€</span></span><br><span class="line"><span class="comment"> *         ucValueï¼Œå†™å…¥å¯„å­˜å™¨çš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WriteRawRC</span>(<span class="params">uint8_t Address, uint8_t <span class="keyword">value</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t ucAddr;</span><br><span class="line">    uint8_t write_buffer[<span class="number">2</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    ucAddr = ((Address &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0x7E</span>);<span class="comment">//æœ€é«˜ä½ç½®0ï¼Œå†™æ“ä½œ;æœ€ä½ä¸ºé»˜è®¤0</span></span><br><span class="line">    write_buffer[<span class="number">0</span>] = ucAddr;</span><br><span class="line">    write_buffer[<span class="number">1</span>] = <span class="keyword">value</span>;</span><br><span class="line">    delay_ms(<span class="number">1</span>);</span><br><span class="line">    RC522_CS_Enable();</span><br><span class="line">    SPI_WriteNBytes(SPI1_SPI, write_buffer, <span class="number">2</span>);</span><br><span class="line">    RC522_CS_Disable();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSetBitMask</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¯¹RC522å¯„å­˜å™¨ç½®ä½ï¼Œå¯å¯¹å¤šä¸ªä½åŒæ—¶æ“ä½œ</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucRegï¼Œå¯„å­˜å™¨åœ°å€</span></span><br><span class="line"><span class="comment"> *         ucMaskï¼Œç½®ä½å€¼,ä¾‹0x13ï¼Œ0001 0011</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetBitMask</span>(<span class="params">uint8_t reg, uint8_t mask</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t temp = <span class="number">0x00</span>;</span><br><span class="line"></span><br><span class="line">    temp = ReadRawRC(reg);        <span class="comment">//è¯»å¯„å­˜å™¨</span></span><br><span class="line">    WriteRawRC(reg, temp | mask); <span class="comment">//å°†ç›®æ ‡ä½ç½®1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šClearBitMask</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¯¹RC522å¯„å­˜å™¨æ¸…ä½</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucRegï¼Œå¯„å­˜å™¨åœ°å€</span></span><br><span class="line"><span class="comment"> *         ucMaskï¼Œæ¸…ä½å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClearBitMask</span>(<span class="params">uint8_t reg, uint8_t mask</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t temp = <span class="number">0x00</span>;</span><br><span class="line"></span><br><span class="line">    temp = ReadRawRC(reg);</span><br><span class="line">    WriteRawRC(reg, temp &amp; ~mask);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdAntennaOn</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¼€å¯å¤©çº¿</span></span><br><span class="line"><span class="comment"> * TxControlRegå¯„å­˜å™¨ä½0ç½®1ï¼Œå¼•è„šTX1ä¸Šçš„è¾“å‡ºä¿¡å·å°†ä¼ è¾“ç”±ä¼ è¾“æ•°æ®è°ƒåˆ¶çš„13.56 MHzèƒ½é‡è½½æ³¢ã€‚</span></span><br><span class="line"><span class="comment"> * TxControlRegå¯„å­˜å™¨ä½1ç½®1ï¼Œå¼•è„šTX2ä¸Šçš„è¾“å‡ºä¿¡å·å°†å‘é€ç”±ä¼ è¾“æ•°æ®è°ƒåˆ¶çš„13.56 MHzèƒ½é‡è½½æ³¢ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PcdAntennaOn</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t i;</span><br><span class="line">    i = ReadRawRC(TxControlReg);</span><br><span class="line">    <span class="keyword">if</span> (!(i &amp; <span class="number">0x03</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        SetBitMask(TxControlReg, <span class="number">0x03</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdAntennaOff</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå…³é—­å¤©çº¿</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PcdAntennaOff</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ClearBitMask(TxControlReg, <span class="number">0x03</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šRC522_PcdConfig_Type</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè®¾ç½®RC522çš„å·¥ä½œæ–¹å¼</span></span><br><span class="line"><span class="comment"> * å·¥ä½œæ–¹å¼ISO14443_A</span></span><br><span class="line"><span class="comment"> * å¤ä½ä¸­å·²ç»è®¾ç½®è¿‡ï¼Œè¯¥å‡½æ•°æš‚æ—¶æœªè°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Config</span>(<span class="params">uint8_t Card_Type</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ClearBitMask(Status2Reg, <span class="number">0x08</span>);</span><br><span class="line">    WriteRawRC(ModeReg, <span class="number">0x3D</span>);</span><br><span class="line">    WriteRawRC(RxSelReg, <span class="number">0x86</span>);</span><br><span class="line">    WriteRawRC(RFCfgReg, <span class="number">0x7F</span>);</span><br><span class="line">    WriteRawRC(TReloadRegL, <span class="number">30</span>);</span><br><span class="line">    WriteRawRC(TReloadRegH, <span class="number">0</span>);</span><br><span class="line">    WriteRawRC(TModeReg, <span class="number">0x8D</span>);</span><br><span class="line">    WriteRawRC(TPrescalerReg, <span class="number">0x3E</span>);</span><br><span class="line">    delay_ms(<span class="number">5</span>);</span><br><span class="line">    PcdAntennaOn();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>RC522.h</p><p>å¤´æ–‡ä»¶å†…å®¹ä¸APIå¤§è‡´ç›¸åŒï¼Œå®šä¹‰äº†æŒ‡ä»¤é›†å’Œå¯„å­˜å™¨ã€‚</p><p>è¿™é‡Œçš„sys.hæ˜¯æ­£ç‚¹åŸå­çš„F1ç³»åˆ—å¤´æ–‡ä»¶ã€‚</p><p>åŠ å…¥äº†å¼•è„šå®šä¹‰å’Œè‡ªå®šä¹‰å‡½æ•°ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#ifndef __RC522_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __RC522_H</span></span><br><span class="line"><span class="meta">#include &quot;sys.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************å¼•è„šå®šä¹‰****************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">RC522SPIå¼•è„š,RSTå’ŒCSå¯éšæ„æ›´æ”¹</span></span><br><span class="line"><span class="comment">RST-PC5</span></span><br><span class="line"><span class="comment">CS-PA4</span></span><br><span class="line"><span class="comment">SCK-PA5</span></span><br><span class="line"><span class="comment">MISO-PA6</span></span><br><span class="line"><span class="comment">MOSI-PA7</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reset</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_RST_Pin      GPIO_PIN_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_RST_GPIO_Port     GPIOC</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_GPIO_Reset_CLK_ENABLE() \</span></span><br><span class="line">    <span class="keyword">do</span> &#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125; <span class="keyword">while</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//CSç‰‡é€‰ï¼Œæ¨¡å—SDAå¼•è„šï¼ŒSPIé€šä¿¡æ—¶ç”¨ä½œNSS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_GPIO_CS_PIN      GPIO_PIN_4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_GPIO_CS_PORT     GPIOA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_GPIO_CS_CLK_ENABLE() \</span></span><br><span class="line">    <span class="keyword">do</span> &#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125; <span class="keyword">while</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************RC522 å‡½æ•°å®å®šä¹‰**********************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_Reset_Disable() HAL_GPIO_WritePin(RC522_RST_GPIO_Port, RC522_RST_Pin, GPIO_PIN_SET);</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_Reset_Enable() HAL_GPIO_WritePin(RC522_RST_GPIO_Port, RC522_RST_Pin, GPIO_PIN_RESET);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_CS_Enable() HAL_GPIO_WritePin(RC522_GPIO_CS_PORT, RC522_GPIO_CS_PIN, GPIO_PIN_RESET);</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_CS_Disable() HAL_GPIO_WritePin(RC522_GPIO_CS_PORT, RC522_GPIO_CS_PIN, GPIO_PIN_SET);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> readID  1//è¯»</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> writeID 2//å†™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************è‡ªå®šä¹‰å‡½æ•°****************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Start</span>(<span class="params">uint8_t block,uint8_t option,uint8_t *Write_Card_Data</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_SPI_GPIO_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************RC522æŒ‡ä»¤é›†****************************/</span></span><br><span class="line"><span class="comment">//MF522å‘½ä»¤å­—</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_IDLE              0x00               //å–æ¶ˆå½“å‰å‘½ä»¤</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_AUTHENT           0x0E               //éªŒè¯å¯†é’¥</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_RECEIVE           0x08               //æ¥æ”¶æ•°æ®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_TRANSMIT          0x04               //å‘é€æ•°æ®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_TRANSCEIVE        0x0C               //å‘é€å¹¶æ¥æ”¶æ•°æ®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_RESETPHASE        0x0F               //å¤ä½</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_CALCCRC           0x03               //CRCè®¡ç®—</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Mifare_Oneå¡ç‰‡å‘½ä»¤å­—</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_REQIDL           0x26               //å¯»å¤©çº¿åŒºå†…æœªè¿›å…¥ä¼‘çœ çŠ¶æ€</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_REQALL           0x52               //å¯»å¤©çº¿åŒºå†…å…¨éƒ¨å¡</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_ANTICOLL1        0x93               //é˜²å†²æ’</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_ANTICOLL2        0x95               //é˜²å†²æ’</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_AUTHENT1A        0x60               //éªŒè¯Aå¯†é’¥</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_AUTHENT1B        0x61               //éªŒè¯Bå¯†é’¥</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_READ             0x30               //è¯»å—</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_WRITE            0xA0               //å†™å—</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_DECREMENT        0xC0               //æ‰£æ¬¾</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_INCREMENT        0xC1               //å……å€¼</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_RESTORE          0xC2               //è°ƒå—æ•°æ®åˆ°ç¼“å†²åŒº</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_TRANSFER         0xB0               //ä¿å­˜ç¼“å†²åŒºä¸­æ•°æ®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_HALT             0x50               //ä¼‘çœ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MF522 FIFOé•¿åº¦å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_FIFO_LENGTH       64                 //FIFO size=64byte</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MF522å¯„å­˜å™¨å®šä¹‰</span></span><br><span class="line"><span class="comment">// PAGE 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU00                 0x00</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CommandReg            0x01</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ComIEnReg             0x02</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     DivlEnReg             0x03</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ComIrqReg             0x04</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     DivIrqReg             0x05</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ErrorReg              0x06</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     Status1Reg            0x07</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     Status2Reg            0x08</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     FIFODataReg           0x09</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     FIFOLevelReg          0x0A</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     WaterLevelReg         0x0B</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ControlReg            0x0C</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     BitFramingReg         0x0D</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CollReg               0x0E</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU0F                 0x0F</span></span><br><span class="line"><span class="comment">// PAGE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU10                 0x10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ModeReg               0x11</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TxModeReg             0x12</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RxModeReg             0x13</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TxControlReg          0x14</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TxAutoReg             0x15</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TxSelReg              0x16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RxSelReg              0x17</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RxThresholdReg        0x18</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     DemodReg              0x19</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU1A                 0x1A</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU1B                 0x1B</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     MifareReg             0x1C</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU1D                 0x1D</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU1E                 0x1E</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     SerialSpeedReg        0x1F</span></span><br><span class="line"><span class="comment">// PAGE 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU20                 0x20</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CRCResultRegM         0x21</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CRCResultRegL         0x22</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU23                 0x23</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ModWidthReg           0x24</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU25                 0x25</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFCfgReg              0x26</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     GsNReg                0x27</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CWGsCfgReg            0x28</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ModGsCfgReg           0x29</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TModeReg              0x2A</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TPrescalerReg         0x2B</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TReloadRegH           0x2C</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TReloadRegL           0x2D</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TCounterValueRegH     0x2E</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TCounterValueRegL     0x2F</span></span><br><span class="line"><span class="comment">// PAGE 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU30                 0x30</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestSel1Reg           0x31</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestSel2Reg           0x32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestPinEnReg          0x33</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestPinValueReg       0x34</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestBusReg            0x35</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     AutoTestReg           0x36</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     VersionReg            0x37</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     AnalogTestReg         0x38</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestDAC1Reg           0x39</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestDAC2Reg           0x3A</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestADCReg            0x3B</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU3C                 0x3C</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU3D                 0x3D</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU3E                 0x3E</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU3F  0x3F</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å’ŒMF522é€šè®¯æ—¶è¿”å›çš„é”™è¯¯ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MI_OK                          0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MI_NOTAGERR                    1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MI_ERR                         2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼“å†²æ•°ç»„å¤§å°</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXRLEN                       18</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************å†…éƒ¨è°ƒç”¨å‡½æ•°**************************************/</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdRequest</span>(<span class="params">uint8_t req_code,uint8_t *pTagType</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdAnticoll</span>(<span class="params">uint8_t *pSnr</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdSelect</span>(<span class="params">uint8_t *pSnr</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdAuthState</span>(<span class="params">uint8_t auth_mode,uint8_t addr,uint8_t *pKey,uint8_t *pSnr</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdRead</span>(<span class="params">uint8_t addr,uint8_t *pData</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdWrite</span>(<span class="params">uint8_t addr,uint8_t *pData</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdValue</span>(<span class="params">uint8_t dd_mode,uint8_t addr,uint8_t *pValue</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdBakValue</span>(<span class="params">uint8_t sourceaddr, uint8_t goaladdr</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdHalt</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CalulateCRC</span>(<span class="params">uint8_t *pIndata,uint8_t len,uint8_t *pOutData</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdReset</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function">uint8_t <span class="title">ReadRawRC</span>(<span class="params">uint8_t Address</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WriteRawRC</span>(<span class="params">uint8_t Address, uint8_t <span class="keyword">value</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetBitMask</span>(<span class="params">uint8_t reg,uint8_t mask</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClearBitMask</span>(<span class="params">uint8_t reg,uint8_t mask</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdComMF522</span>(<span class="params">uint8_t Command,uint8_t *pInData,uint8_t InLenByte,uint8_t *pOutData,unsigned <span class="built_in">int</span> *pOutLenBit</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PcdAntennaOn</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PcdAntennaOff</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Config</span>(<span class="params">uint8_t Card_Type</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="SPIå®šä¹‰"><a href="#SPIå®šä¹‰" class="headerlink" title="SPIå®šä¹‰"></a>SPIå®šä¹‰</h4><p>spiçš„åˆå§‹åŒ–é»˜è®¤å³å¯ï¼Œæ³¨æ„ä»¥ä¸‹ä¸¤é¡¹çš„è®¾ç½®ï¼Œæ‰èƒ½ä¿æŒå’Œæ¨¡å—çš„æ­£å¸¸é€šä¿¡ï¼š</p><p><strong>CLKPolarity</strong>&#x3D;SPI_POLARITY_LOW; &#x2F;&#x2F;ä¸²è¡ŒåŒæ­¥æ—¶é’Ÿçš„ç©ºé—²çŠ¶æ€ä¸ºä½ç”µå¹³</p><p><strong>CLKPhase</strong>&#x3D;SPI_PHASE_1EDGE; &#x2F;&#x2F;ä¸²è¡ŒåŒæ­¥æ—¶é’Ÿçš„ç¬¬1ä¸ªè·³å˜æ²¿ï¼ˆä¸Šå‡æˆ–ä¸‹é™ï¼‰æ•°æ®è¢«é‡‡æ ·</p><p>ç‰‡é€‰å¼•è„šæ”¹ä¸ºè½¯ä»¶ç®¡ç†ï¼Œè¿™æ ·æ–¹ä¾¿æ›´æ”¹å¼•è„šï¼Œ</p><p><strong>NSS</strong>&#x3D;SPI_NSS_SOFT; &#x2F;&#x2F;NSSä¿¡å·ç”±ç¡¬ä»¶ï¼ˆNSSç®¡è„šï¼‰è¿˜æ˜¯è½¯ä»¶ï¼ˆä½¿ç”¨SSIä½ï¼‰ç®¡ç†</p><p>SPI.c</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include &quot;spi.h&quot;</span></span><br><span class="line"></span><br><span class="line">SPI_HandleTypeDef SPI1_Handler;  <span class="comment">//SPIå¥æŸ„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹æ˜¯SPIæ¨¡å—çš„åˆå§‹åŒ–ä»£ç ï¼Œé…ç½®æˆä¸»æœºæ¨¡å¼</span></span><br><span class="line"><span class="comment">//SPIå£åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">//è¿™é‡Œé’ˆæ˜¯å¯¹SPI1çš„åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SPI1_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    SPI1_Handler.Instance=SPI1_SPI;                         <span class="comment">//SPI1</span></span><br><span class="line">    SPI1_Handler.Init.Mode=SPI_MODE_MASTER;             <span class="comment">//è®¾ç½®SPIå·¥ä½œæ¨¡å¼ï¼Œè®¾ç½®ä¸ºä¸»æ¨¡å¼</span></span><br><span class="line">    SPI1_Handler.Init.Direction=SPI_DIRECTION_2LINES;   <span class="comment">//è®¾ç½®SPIå•å‘æˆ–è€…åŒå‘çš„æ•°æ®æ¨¡å¼:SPIè®¾ç½®ä¸ºåŒçº¿æ¨¡å¼</span></span><br><span class="line">    SPI1_Handler.Init.DataSize=SPI_DATASIZE_8BIT;       <span class="comment">//è®¾ç½®SPIçš„æ•°æ®å¤§å°:SPIå‘é€æ¥æ”¶8ä½å¸§ç»“æ„</span></span><br><span class="line">    SPI1_Handler.Init.CLKPolarity=SPI_POLARITY_LOW;    <span class="comment">//ä¸²è¡ŒåŒæ­¥æ—¶é’Ÿçš„ç©ºé—²çŠ¶æ€ä¸ºä½ç”µå¹³</span></span><br><span class="line">    SPI1_Handler.Init.CLKPhase=SPI_PHASE_1EDGE;         <span class="comment">//ä¸²è¡ŒåŒæ­¥æ—¶é’Ÿçš„ç¬¬1ä¸ªè·³å˜æ²¿ï¼ˆä¸Šå‡æˆ–ä¸‹é™ï¼‰æ•°æ®è¢«é‡‡æ ·</span></span><br><span class="line">    SPI1_Handler.Init.NSS=SPI_NSS_SOFT;                 <span class="comment">//NSSä¿¡å·ç”±ç¡¬ä»¶ï¼ˆNSSç®¡è„šï¼‰è¿˜æ˜¯è½¯ä»¶ï¼ˆä½¿ç”¨SSIä½ï¼‰ç®¡ç†:å†…éƒ¨NSSä¿¡å·æœ‰SSIä½æ§åˆ¶</span></span><br><span class="line">    SPI1_Handler.Init.BaudRatePrescaler=SPI_BAUDRATEPRESCALER_256;<span class="comment">//å®šä¹‰æ³¢ç‰¹ç‡é¢„åˆ†é¢‘çš„å€¼:æ³¢ç‰¹ç‡é¢„åˆ†é¢‘å€¼ä¸º256</span></span><br><span class="line">    SPI1_Handler.Init.FirstBit=SPI_FIRSTBIT_MSB;        <span class="comment">//æŒ‡å®šæ•°æ®ä¼ è¾“ä»MSBä½è¿˜æ˜¯LSBä½å¼€å§‹:æ•°æ®ä¼ è¾“ä»MSBä½å¼€å§‹</span></span><br><span class="line">    SPI1_Handler.Init.TIMode=SPI_TIMODE_DISABLE;        <span class="comment">//å…³é—­TIæ¨¡å¼</span></span><br><span class="line">    SPI1_Handler.Init.CRCCalculation=SPI_CRCCALCULATION_DISABLE;<span class="comment">//å…³é—­ç¡¬ä»¶CRCæ ¡éªŒ</span></span><br><span class="line">    SPI1_Handler.Init.CRCPolynomial=<span class="number">7</span>;                  <span class="comment">//CRCå€¼è®¡ç®—çš„å¤šé¡¹å¼,é»˜è®¤å€¼ä¸º7</span></span><br><span class="line">    HAL_SPI_Init(&amp;SPI1_Handler);<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">    __HAL_SPI_ENABLE(&amp;SPI1_Handler);                    <span class="comment">//ä½¿èƒ½SPI1</span></span><br><span class="line"></span><br><span class="line">    SPI1_ReadWriteByte(<span class="number">0Xff</span>);                           <span class="comment">//å¯åŠ¨ä¼ è¾“,äº§ç”Ÿ8ä¸ªæ—¶é’Ÿè„‰å†², è¾¾åˆ°æ¸…ç©ºDRçš„ä½œç”¨, éå¿…éœ€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//SPIåº•å±‚é©±åŠ¨ï¼Œæ—¶é’Ÿä½¿èƒ½ï¼Œå¼•è„šé…ç½®</span></span><br><span class="line"><span class="comment">//æ­¤å‡½æ•°ä¼šè¢«HAL_SPI_Init()è°ƒç”¨</span></span><br><span class="line"><span class="comment">//hspi:SPIå¥æŸ„</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_SPI_MspInit</span>(<span class="params">SPI_HandleTypeDef *hspi</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    GPIO_InitTypeDef GPIO_Initure;</span><br><span class="line"></span><br><span class="line">    SPI1_SPI_CLK_ENABLE();</span><br><span class="line">    SPI1_SCK_GPIO_CLK_ENABLE();</span><br><span class="line">    SPI1_MISO_GPIO_CLK_ENABLE();</span><br><span class="line">    SPI1_MOSI_GPIO_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">    GPIO_Initure.Pin=SPI1_SCK_GPIO_PIN;</span><br><span class="line">    GPIO_Initure.Mode=GPIO_MODE_AF_PP;</span><br><span class="line">    GPIO_Initure.Pull=GPIO_PULLDOWN;</span><br><span class="line">    GPIO_Initure.Speed=GPIO_SPEED_FREQ_HIGH;</span><br><span class="line">    HAL_GPIO_Init(SPI1_SCK_GPIO_PORT,&amp;GPIO_Initure);</span><br><span class="line"></span><br><span class="line">    GPIO_Initure.Pin=SPI1_MISO_GPIO_PIN;</span><br><span class="line">    HAL_GPIO_Init(SPI1_MISO_GPIO_PORT,&amp;GPIO_Initure);</span><br><span class="line"></span><br><span class="line">    GPIO_Initure.Pin=SPI1_MOSI_GPIO_PIN;</span><br><span class="line">    HAL_GPIO_Init(SPI1_MOSI_GPIO_PORT,&amp;GPIO_Initure);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SPI.h</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#ifndef __SPI_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __SPI_H</span></span><br><span class="line"><span class="meta">#include &quot;sys.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> SPI_HandleTypeDef SPI1_Handler;  <span class="comment">//SPIå¥æŸ„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* SPI1 å¼•è„š å®šä¹‰ */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SCK_GPIO_PORT              GPIOA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SCK_GPIO_PIN               GPIO_PIN_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SCK_GPIO_CLK_ENABLE()      do&#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MISO_GPIO_PORT             GPIOA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MISO_GPIO_PIN              GPIO_PIN_6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MISO_GPIO_CLK_ENABLE()     do&#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MOSI_GPIO_PORT             GPIOA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MOSI_GPIO_PIN              GPIO_PIN_7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MOSI_GPIO_CLK_ENABLE()     do&#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* SPI1ç›¸å…³å®šä¹‰ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SPI                        SPI1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SPI_CLK_ENABLE()           do&#123; __HAL_RCC_SPI1_CLK_ENABLE(); &#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SPI1_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="å››ã€å®éªŒç»“æœ"><a href="#å››ã€å®éªŒç»“æœ" class="headerlink" title="å››ã€å®éªŒç»“æœ"></a>å››ã€å®éªŒç»“æœ</h2><p><img src="https://img-blog.csdnimg.cn/53941b94abc34bf5a897740cede1942a.png"></p><p>æœ¬å®éªŒåœ¨äºç»éªŒåˆ†äº«å’Œå­¦ä¹ è®°å½•ï¼Œæœ‰ä¸æ­£ç¡®çš„åœ°æ–¹è¯·è¯»è€…æŒ‡æ­£ã€‚</p><h2 id="äº”ã€æ›´æ–°æºç ï¼š"><a href="#äº”ã€æ›´æ–°æºç ï¼š" class="headerlink" title="äº”ã€æ›´æ–°æºç ï¼š"></a>äº”ã€æ›´æ–°æºç ï¼š</h2><p>æºç å·²ä¸Šä¼ è‡³giteeï¼š</p><p><a href="https://gitee.com/lrf1125962926/stm32/tree/RC522_SPI/" title="stm32: ä¸€äº›stm32æ¨¡å—ä½¿ç”¨ç»éªŒè®°å½• - Gitee.com">stm32: ä¸€äº›stm32æ¨¡å—ä½¿ç”¨ç»éªŒè®°å½• - Gitee.com <img src="https://csdnimg.cn/release/blog_editor_html/release2.3.6/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=N7T8">https://gitee.com/lrf1125962926/stm32/tree/RC522_SPI&#x2F;;</a></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºSTM32HALåº“ï¼ŒRC522ï¼ˆRFIDï¼‰æ¨¡å—è¯»å†™é©±åŠ¨ï¼Œæ— çº¿ICå¡è¯»å†™</title>
      <link href="/2024/03/stm32-stm32-%E5%9F%BA%E4%BA%8ESTM32HAL%E5%BA%93%EF%BC%8CRC522%EF%BC%88RFID%EF%BC%89%E6%A8%A1%E5%9D%97%E8%AF%BB%E5%86%99%E9%A9%B1%E5%8A%A8%EF%BC%8C%E6%97%A0%E7%BA%BFIC%E5%8D%A1%E8%AF%BB%E5%86%99/"/>
      <url>/2024/03/stm32-stm32-%E5%9F%BA%E4%BA%8ESTM32HAL%E5%BA%93%EF%BC%8CRC522%EF%BC%88RFID%EF%BC%89%E6%A8%A1%E5%9D%97%E8%AF%BB%E5%86%99%E9%A9%B1%E5%8A%A8%EF%BC%8C%E6%97%A0%E7%BA%BFIC%E5%8D%A1%E8%AF%BB%E5%86%99/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="ä¸€ã€æ¨¡å—ç®€çŸ­ä»‹ç»"><a href="#ä¸€ã€æ¨¡å—ç®€çŸ­ä»‹ç»" class="headerlink" title="ä¸€ã€æ¨¡å—ç®€çŸ­ä»‹ç»"></a>ä¸€ã€æ¨¡å—ç®€çŸ­ä»‹ç»</h2><p>æœ‰å…³RC522æ¨¡å—çš„èƒŒæ™¯çŸ¥è¯†ä»¥åŠå·¥ä½œåŸç†ï¼Œæœ¬æ¬¡å®éªŒæš‚æ—¶ä¸åšåˆ†äº«ï¼Œè¿™é‡Œè´´ä¸Šä¸¤ä½å†™å¾—å¾ˆå¥½çš„åšä¸»ï¼Œå¤§å®¶å¯è‡ªè¡ŒæŸ¥çœ‹ã€‚</p><p><a href="https://blog.csdn.net/m0_51220742/article/details/123683745" title="(5æ¡æ¶ˆæ¯) RC522(RFID)è¯»å†™é©±åŠ¨_æ¡ƒæˆè¹Š2.0çš„åšå®¢-CSDNåšå®¢">(5æ¡æ¶ˆæ¯) RC522(RFID)è¯»å†™é©±åŠ¨_æ¡ƒæˆè¹Š2.0çš„åšå®¢-CSDNåšå®¢<img src="https://csdnimg.cn/release/blog_editor_html/release2.3.6/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=N7T8">https://blog.csdn.net/m0_51220742&#x2F;article&#x2F;details&#x2F;123683745 ;</a> <a href="https://blog.csdn.net/weixin_45771489/article/details/124079134" title="(5æ¡æ¶ˆæ¯) STM32--RFIDæ— çº¿å°„é¢‘æŠ€æœ¯ï¼ˆRC522åˆ·å¡æ¨¡å—ï¼‰_rc522å°„é¢‘æ¨¡å—è¯¦ç»†èµ„æ–™_yé»å¥½å¥½çš„åšå®¢-CSDNåšå®¢">(5æ¡æ¶ˆæ¯) STM32â€“RFIDæ— çº¿å°„é¢‘æŠ€æœ¯ï¼ˆRC522åˆ·å¡æ¨¡å—ï¼‰_rc522å°„é¢‘æ¨¡å—è¯¦ç»†èµ„æ–™_yé»å¥½å¥½çš„åšå®¢-CSDNåšå®¢<img src="https://csdnimg.cn/release/blog_editor_html/release2.3.6/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=N7T8">https://blog.csdn.net/weixin_45771489&#x2F;article&#x2F;details&#x2F;124079134 ;</a></p><p><img src="https://img-blog.csdnimg.cn/b829df1211c843b49139edf393f1aa42.jpeg"></p><p>è¯¥æ¨¡å—ä»·æ ¼æ™®éå®æƒ ï¼Œæ‰€ä»¥æˆ‘ä¹°äº†ä¸€ä¸ªè‡ªå·±ç©ç©ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´çš„æ‘¸çˆ¬æ»šæ‰“ç›®å‰èƒ½å¤Ÿæ­£å¸¸è¯»å†™ï¼Œåç»­ä¼šç»§ç»­å®Œå–„è¯¥æ¨¡å—çš„ä½¿ç”¨ï¼Œå¹¶åŠ å…¥åˆ°å…¶ä»–åµŒå…¥å¼è®¾è®¡ä¸­ã€‚</p><h2 id="äºŒã€å¼€å‘èµ„æ–™çš„ä½¿ç”¨åŠç»éªŒåˆ†äº«"><a href="#äºŒã€å¼€å‘èµ„æ–™çš„ä½¿ç”¨åŠç»éªŒåˆ†äº«" class="headerlink" title="äºŒã€å¼€å‘èµ„æ–™çš„ä½¿ç”¨åŠç»éªŒåˆ†äº«"></a>äºŒã€å¼€å‘èµ„æ–™çš„ä½¿ç”¨åŠç»éªŒåˆ†äº«</h2><p>è¯¥æ¨¡å—çš„APIå‡½æ•°æ·˜å®æœ‰å¾ˆå¤šèµ„æºï¼Œæ•°æ®æ‰‹å†Œä¹Ÿæœ‰ï¼Œä¸è¿‡æ˜¯è‹±æ–‡ç‰ˆçš„ã€‚å»ºè®®å¤§å®¶æœ‰æ—¶é—´è¿˜æ˜¯è¦è¿‡ä¸€æ•°æ®æ‰‹å†Œçš„é‡è¦éƒ¨åˆ†ï¼Œæ¯”å¦‚å¯„å­˜å™¨å’ŒæŒ‡ä»¤é›†ï¼Œé€šä¿¡åè®®ç­‰ï¼Œå¯ä»¥ä½¿ç”¨çŸ¥äº‘æ–‡çŒ®æŸ¥çœ‹ï¼Œæˆ‘ä¹ æƒ¯ç”¨å®ƒæ¥çœ‹è®ºæ–‡ï¼Œé€‚åˆç¿»è¯‘é•¿æ®µå¤§æ®µã€‚ä¹Ÿå¯ä»¥ç”¨WPSçš„ç¿»è¯‘ï¼Œå°éƒ¨åˆ†ç¿»è¯‘ï¼Œçœ‹ä¸ªäººä½¿ç”¨ä¹ æƒ¯ã€‚è¦æ˜¯æœ‰èƒ½åŠ›ç›´æ¥æ’¸åŸæ–‡é‚£å°±æ›´å¥½ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚</p><p><img src="https://img-blog.csdnimg.cn/2e92c08f81ca46af8c0d2361b9d2e130.png"></p><p>æ‰¾è¿‡å¾ˆå¤šèµ„æ–™ï¼Œæä¾›çš„APIæ— éå°±æ˜¯ä¸€å¥—æ²¡æœ‰ç« æ³•ï¼Œæ¯«æ— å¯è¯»æ€§çš„æ‚ä¹±ä»£ç ï¼Œååˆ†å½±å“å­¦ä¹ æ•ˆæœã€‚è¿™é‡Œå»ºè®®å¤§å®¶ä¸è¦å»æ­»ç£•ï¼Œå¯ä»¥çœ‹æœ¬æ¬¡å®éªŒçš„ä»£ç é€»è¾‘å’Œä¸Šæ–‡æåˆ°çš„ä¸¤ä½åšä¸»ï¼Œæ¯ä¸€ä¸ªåº•å±‚å‡½æ•°éƒ½æœ‰æ³¨é‡Šï¼Œåœ¨ä¸€äº›åº•å±‚å‡½æ•°çš„é€»è¾‘ä¸Šå¯ä»¥ç»“åˆè¿™äº›APIå‡½æ•°è¿›è¡Œåæ¨æˆ–è€…æ ¡éªŒï¼Œå¯ä»¥å¸®åŠ©è¯»è€…ç†è§£å®ç°åŸç†ã€‚</p><p>ä¸€å¼€å§‹æ˜¯é€šè¿‡æ•°æ®æ‰‹å†Œï¼Œç¡¬ç€å¤´çš®å•ƒæ— è‰¯åº—é“ºç»™çš„ä»£ç ï¼Œæ²¡æœ‰æ³¨é‡Šï¼Œæ²¡æœ‰é€»è¾‘ï¼Œæ²¡æœ‰ç« æ³•ã€‚è™½ç„¶æ²¡æŠ¥é”™ï¼Œä½†æ˜¯èƒ½ä¸èƒ½ç”¨å®Œå…¨ä¸çŸ¥é“ï¼Œå°±æ˜¯è¿™ä¸€æ­¥å°±èŠ±äº†å¥½å‡ å¤©æ—¶é—´ï¼Œæ‰€ä»¥å»ºè®®å¤§å®¶ä¸è¦åƒæˆ‘ä¸€æ ·åŸ‹å¤´è‹¦è¯»ï¼Œå¯ä»¥å…ˆçœ‹æ¯ä¸€ä¸ªå‡½æ•°çš„ä¸­æ–‡æ³¨é‡Šï¼Œæ•´ç†å‡ºä¸€ä¸ªæ¡†æ¶ã€‚</p><h2 id="ä¸‰ã€æºç è§£æ"><a href="#ä¸‰ã€æºç è§£æ" class="headerlink" title="ä¸‰ã€æºç è§£æ"></a>ä¸‰ã€æºç è§£æ</h2><p>ä»£ç æ€»ä½“é€»è¾‘æ²¡æœ‰å˜åŒ–ï¼Œå‚è€ƒäº†ä¸¤ä½åšä¸»çš„æ€è·¯ï¼Œæˆ‘ç”¨å®˜æ–¹çš„APIå‡½æ•°è¿›è¡Œä¿®æ”¹ã€‚ä¸¤ä½åšä¸»ä¸€ä½ä½¿ç”¨çš„è½¯ä»¶å®ç°SPIåè®®ï¼Œä¸€ä½ä½¿ç”¨æ¿è½½SPIã€‚ä¸¤ç§æ–¹æ³•æˆ‘éƒ½è¯•è¿‡ï¼Œä½†æ˜¯è½¯ä»¶SPIåè®®æ€»æ˜¯é€šä¿¡å¤±è´¥ï¼Œä¸çŸ¥é“æ˜¯æˆ‘åè®®å†™çš„ä¸å¯¹è¿˜æ˜¯é€šä¿¡é€Ÿåº¦å’Œæ¨¡å—ä¸åŒ¹é…ï¼Œæš‚æ—¶è¿˜æœªè§£å†³ã€‚</p><h3 id="è½¯ä»¶æ¨¡æ‹ŸSPI"><a href="#è½¯ä»¶æ¨¡æ‹ŸSPI" class="headerlink" title="è½¯ä»¶æ¨¡æ‹ŸSPI"></a><strong>è½¯ä»¶æ¨¡æ‹ŸSPI</strong></h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSOFT_SPI_RC522_SendByte</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå‘RC522å‘é€1 Byte æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šwrite_datï¼Œè¦å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¿”å›  : RC522è¿”å›çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SOFT_SPI_RC522_SendByte</span>(<span class="params">uint8_t write_dat</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i</span><br></pre></td></tr></table></figure><p>æœ‰å¤§ä½¬å¦‚æœå‘ç°é—®é¢˜ï¼Œè¿˜è¯·ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´é€šä¿¡å¤±è´¥ã€‚</p><h3 id="æ¿è½½SPIé€šä¿¡"><a href="#æ¿è½½SPIé€šä¿¡" class="headerlink" title="æ¿è½½SPIé€šä¿¡"></a><strong>æ¿è½½SPIé€šä¿¡</strong></h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSPI_WriteNBytes</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå‘RC522å‘é€n Byte æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šSPIx : è¦å‘é€æ•°æ®çš„SPI</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šp_TxData : è¦å‘é€çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šsendDataNum : è¦å‘é€çš„æ•°æ®é‡(Byte)</span></span><br><span class="line"><span class="comment"> * è¿”å›  : 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">int</span> <span class="title">SPI_WriteNBytes</span>(<span class="params">SPI_TypeDef* SPIx, uint8_t *p_TxData,uint32_t sendDataNum</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(sendDataNum--)&#123;</span><br><span class="line"><span class="keyword">while</span>((SPIx-&gt;SR&amp;SPI_FLAG_TXE)==<span class="number">0</span>)<span class="comment">//ç­‰å¾…å‘é€åŒºç©º</span></span><br><span class="line">&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">SPIx-&gt;DR=*p_TxData++;<span class="comment">//å‘é€ä¸€ä¸ªbyte</span></span><br><span class="line">retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>((SPIx-&gt;SR&amp;SPI_FLAG_RXNE)==<span class="number">0</span>)<span class="comment">//ç­‰å¾…æ¥æ”¶å®Œä¸€ä¸ªbyte</span></span><br><span class="line">&#123;</span><br><span class="line">SPIx-&gt;SR = SPIx-&gt;SR;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">SPIx-&gt;DR;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSPI_ReadNBytes</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè¯»å–RC522 n Byte æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šSPIx : è¦è¯»å–æ•°æ®çš„SPI</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šp_RxData : è¦è¯»å–çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šreadDataNum : è¦è¯»å–çš„æ•°æ®é‡(Byte)</span></span><br><span class="line"><span class="comment"> * è¿”å›  : 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">int</span> <span class="title">SPI_ReadNBytes</span>(<span class="params">SPI_TypeDef* SPIx, uint8_t *p_RxData,uint32_t readDataNum</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(readDataNum--)&#123;</span><br><span class="line">SPIx-&gt;DR = <span class="number">0xFF</span>;</span><br><span class="line"><span class="keyword">while</span>(!(SPIx-&gt;SR&amp;SPI_FLAG_TXE))&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">retry = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!(SPIx-&gt;SR&amp;SPI_FLAG_RXNE))&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">*p_RxData++ = SPIx-&gt;DR;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬å®éªŒä½¿ç”¨è¯»å–å¯„å­˜å™¨çŠ¶æ€æ¥å®ŒæˆSPIé€šä¿¡ï¼Œæœªä½¿ç”¨HAL_SPI_TransmitReceiveåº“å‡½æ•°ã€‚</p><h3 id="æºç éƒ¨åˆ†"><a href="#æºç éƒ¨åˆ†" class="headerlink" title="æºç éƒ¨åˆ†"></a>æºç éƒ¨åˆ†</h3><p>ä¸»å‡½æ•°æ¯”è¾ƒç®€ç•¥ï¼Œè°ƒç”¨ä¸€ä¸ªæ“ä½œå‡½æ•°ï¼Œç”¨æŒ‰é”®è§¦å‘çš„æ–¹å¼å¯åŠ¨è¯¥å‡½æ•°å®ç°è¯»å†™ã€‚main.c ä¸­ï¼ŒåŠ å…¥ä»¥ä¸‹ä»£ç ï¼š</p><h4 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h4><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   RC522_Init();</span><br><span class="line">uint8_t key;</span><br><span class="line"></span><br><span class="line">   uint8_t Write_Card_Data[<span class="number">16</span>]=&#123;<span class="number">0</span>&#125;;<span class="comment">//è¦å†™å…¥çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">key = key_scan();<span class="comment">//æŒ‰é”®æ‰«æå‡½æ•°ï¼Œè‡ªå·±å®šä¹‰ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">if</span>(key==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">RC522_Start(<span class="number">5</span>,readID,Write_Card_Data);<span class="comment">//readID  è¯»å‘½ä»¤</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(key==<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">RC522_Start(<span class="number">5</span>,writeID,Write_Card_Data);<span class="comment">//writeID  å†™å‘½ä»¤</span></span><br><span class="line">&#125;</span><br><span class="line">delay_ms(<span class="number">100</span>);</span><br><span class="line">LED0=!LED0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RC522éƒ¨åˆ†"><a href="#RC522éƒ¨åˆ†" class="headerlink" title="RC522éƒ¨åˆ†"></a>RC522éƒ¨åˆ†</h4><p><strong>RC522.c</strong></p><p>å…¶ä¸­RC522_Startæ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼Œåªè¦æ“ä½œæµç¨‹æ­£ç¡®ï¼Œå¯è‡ªè¡Œç¼–å†™æƒ³è¦çš„æ“ä½œæ–¹å¼ï¼Œæœ¬å®éªŒåªå®Œæˆç®€å•çš„å•å—è¯»å†™æ“ä½œã€‚è“å¡å’Œç™½å¡çš„å¡å·æ ¹æ®è‡ªå·±çš„ä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡æ‰‹æœºNFCåŠŸèƒ½æŸ¥çœ‹å¡å·ï¼ŒåŒæ—¶ä¹Ÿèƒ½æŸ¥çœ‹æ‰‡åŒºæ•°æ®ï¼ŒAPPå¯ä»¥ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„åšä¸»æ¨èçš„NFC Writerã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include &quot;RC522.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;stdio.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;delay.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;spi.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;oled.h&quot;</span></span><br><span class="line"><span class="meta">#include &quot;string.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// M1å¡åˆ†ä¸º16ä¸ªæ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒºç”±å››ä¸ªå—ï¼ˆå—0ã€å—1ã€å—2ã€å—3ï¼‰ç»„æˆ</span></span><br><span class="line"><span class="comment">// å°†16ä¸ªæ‰‡åŒºçš„64ä¸ªå—æŒ‰ç»å¯¹åœ°å€ç¼–å·ä¸ºï¼š0~63,æ¯å—16ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment">// ç¬¬0ä¸ªæ‰‡åŒºçš„å—0ï¼ˆå³ç»å¯¹åœ°å€0å—ï¼‰ï¼Œç”¨äºå­˜æ”¾å‚å•†ä»£ç ï¼Œå·²ç»å›ºåŒ–ä¸å¯æ›´æ”¹</span></span><br><span class="line"><span class="comment">// æ¯ä¸ªæ‰‡åŒºçš„å—0ã€å—1ã€å—2ä¸ºæ•°æ®å—ï¼Œå¯ç”¨äºå­˜æ”¾æ•°æ®</span></span><br><span class="line"><span class="comment">// æ¯ä¸ªæ‰‡åŒºçš„å—3ä¸ºæ§åˆ¶å—ï¼ˆç»å¯¹åœ°å€ä¸º:å—3ã€å—7ã€å—11.....ï¼‰åŒ…æ‹¬å¯†ç Aï¼Œå­˜å–æ§åˆ¶ã€å¯†ç Bç­‰</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">RC522_SPI_GPIO_Init();<span class="comment">//åˆå§‹åŒ–RC522çš„å¤ä½å¼•è„šå’Œç‰‡é€‰å¼•è„š</span></span><br><span class="line"></span><br><span class="line">SPI1_Init();<span class="comment">//åˆå§‹åŒ–SPI</span></span><br><span class="line"></span><br><span class="line">    delay_ms(<span class="number">50</span>);</span><br><span class="line">PcdReset();<span class="comment">//å¤ä½RC522è¯»å¡å™¨</span></span><br><span class="line"></span><br><span class="line">delay_ms(<span class="number">10</span>);</span><br><span class="line">PcdAntennaOff();<span class="comment">//å…³é—­å¤©çº¿å‘å°„</span></span><br><span class="line"></span><br><span class="line">delay_ms(<span class="number">10</span>);</span><br><span class="line">    PcdAntennaOn();<span class="comment">//å¼€å¯å¤©çº¿å‘å°„</span></span><br><span class="line"></span><br><span class="line">printf(<span class="string">&quot;RFID-MFRC522 åˆå§‹åŒ–å®Œæˆ\nPress KEY0 Or KEY1 To Start...\r\n&quot;</span>);  <span class="comment">//åˆå§‹åŒ–å®Œæˆ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uint8_t IC_UID[<span class="number">4</span>]; <span class="comment">//UIDå¡ç‰‡åºåˆ—å·,4å­—èŠ‚</span></span><br><span class="line">uint8_t IC_Type[<span class="number">2</span>];<span class="comment">//å¡ç±»å‹ä»£ç ï¼Œ2å­—èŠ‚,0x0400ï¼ŒMifare_One(S50)</span></span><br><span class="line">uint8_t card_1[<span class="number">4</span>]=&#123;<span class="number">0xC3</span>,<span class="number">0xB2</span>,<span class="number">0x37</span>,<span class="number">0xC5</span>&#125;;<span class="comment">//è“å¡1å¡å·</span></span><br><span class="line">uint8_t card_2[<span class="number">4</span>]=&#123;<span class="number">0xA3</span>,<span class="number">0x09</span>,<span class="number">0x3C</span>,<span class="number">0xFB</span>&#125;;<span class="comment">//ç™½å¡2å¡å·</span></span><br><span class="line">uint8_t ID_num=<span class="number">0</span>;<span class="comment">//å½“å‰æ“ä½œçš„åºå·</span></span><br><span class="line">uint8_t Card_KEY[<span class="number">6</span>]=&#123;<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>,<span class="number">0xff</span>&#125;;<span class="comment">//éªŒè¯å¯†ç </span></span><br><span class="line">uint8_t Card_Data[<span class="number">16</span>];<span class="comment">//è¯»å–å‡ºçš„å—æ•°æ®</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šRC522_Start</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  blockï¼šè¦æ“ä½œçš„å—åœ°å€</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  optionï¼šè¯»æ“ä½œæˆ–å†™æ“ä½œ</span></span><br><span class="line"><span class="comment"> *              readID  1//è¯»</span></span><br><span class="line"><span class="comment"> *writeID 2//å†™</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  blockï¼šè¦æ“ä½œçš„å—åœ°å€</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šRC522æ“ä½œä¸»å‡½æ•°ï¼Œå¯å®Œæˆå¯¹å¡çš„è¯»å†™æ“ä½œ</span></span><br><span class="line"><span class="comment"> *  * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = 1ï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Start</span>(<span class="params">uint8_t block,uint8_t option,uint8_t *Write_Card_Data</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(PcdRequest(PICC_REQALL,IC_Type) == MI_OK)<span class="comment">//å¯»å¡</span></span><br><span class="line">&#123;</span><br><span class="line">uint16_t cardType = (IC_Type[<span class="number">0</span>] &lt;&lt; <span class="number">8</span>) | IC_Type[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">switch</span> (cardType)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x4400</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare UltraLight\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x0400</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare One(S50)\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x0200</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare One(S70)\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x0800</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare Pro(X)\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0x4403</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nMifare DESFire\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="literal">default</span>:</span><br><span class="line">                printf(<span class="string">&quot;\r\nUnknown Card\r\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">if</span>(PcdAnticoll(IC_UID)==MI_OK)<span class="comment">//é˜²å†²æ’</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>((IC_UID[<span class="number">0</span>]==card_1[<span class="number">0</span>])&amp;&amp;(IC_UID[<span class="number">1</span>]==card_1[<span class="number">1</span>])&amp;&amp;(IC_UID[<span class="number">2</span>]==card_1[<span class="number">2</span>])&amp;&amp;(IC_UID[<span class="number">3</span>]==card_1[<span class="number">3</span>]))</span><br><span class="line">            &#123;</span><br><span class="line">                ID_num=<span class="number">1</span>;</span><br><span class="line">                printf(<span class="string">&quot;The User is: %d, Blue card&quot;</span>,ID_num);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>((IC_UID[<span class="number">0</span>]==card_2[<span class="number">0</span>])&amp;&amp;(IC_UID[<span class="number">1</span>]==card_2[<span class="number">1</span>])&amp;&amp;(IC_UID[<span class="number">2</span>]==card_2[<span class="number">2</span>])&amp;&amp;(IC_UID[<span class="number">3</span>]==card_2[<span class="number">3</span>]))</span><br><span class="line">            &#123;</span><br><span class="line">                ID_num=<span class="number">2</span>;</span><br><span class="line">                printf(<span class="string">&quot;The User is: %d, White card&quot;</span>,ID_num);</span><br><span class="line">            &#125;</span><br><span class="line">            printf(<span class="string">&quot;\r\ncard_ID: %02X:%02X:%02X:%02X\r\n&quot;</span>,IC_UID[<span class="number">0</span>],IC_UID[<span class="number">1</span>],IC_UID[<span class="number">2</span>],IC_UID[<span class="number">3</span>]); <span class="comment">//æ‰“å°å¡çš„UIDå·</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(PcdSelect(IC_UID)==MI_OK)<span class="comment">//é€‰å¡</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(PcdAuthState(PICC_AUTHENT1A,block,Card_KEY,IC_UID)==MI_OK)<span class="comment">//éªŒè¯Aå¯†é’¥,å¯¹åº”å—</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//memset(Card_Data,1,16);</span></span><br><span class="line"><span class="keyword">if</span>(option==readID)<span class="comment">//è¯»æ“ä½œ</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(PcdRead(block,Card_Data)==MI_OK)</span><br><span class="line">&#123;</span><br><span class="line">printf(<span class="string">&quot;\nè¯»å–ç»“æœ: \n&quot;</span>);</span><br><span class="line">printf(<span class="string">&quot;block %d date:\r\n&quot;</span>,block);</span><br><span class="line">categories:</span><br><span class="line">    - stm32</span><br><span class="line">    - stm32halåº“å¼€å‘</span><br><span class="line">tags:</span><br><span class="line">    - stm32</span><br><span class="line">    - å¤–è®¾</span><br><span class="line"><span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;iSR&amp;SPI_FLAG_TXE)==<span class="number">0</span>)<span class="comment">//ç­‰å¾…å‘é€åŒºç©º</span></span><br><span class="line">&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">SPIx-&gt;DR=*p_TxData++;<span class="comment">//å‘é€ä¸€ä¸ªbyte</span></span><br><span class="line">retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>((SPIx-&gt;SR&amp;SPI_FLAG_RXNE)==<span class="number">0</span>)<span class="comment">//ç­‰å¾…æ¥æ”¶å®Œä¸€ä¸ªbyte</span></span><br><span class="line">&#123;</span><br><span class="line">SPIx-&gt;SR = SPIx-&gt;SR;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">SPIx-&gt;DR;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSPI_ReadNBytes</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè¯»å–RC522 n Byte æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šSPIx : è¦è¯»å–æ•°æ®çš„SPI</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šp_RxData : è¦è¯»å–çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šreadDataNum : è¦è¯»å–çš„æ•°æ®é‡(Byte)</span></span><br><span class="line"><span class="comment"> * è¿”å›  : 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">int</span> <span class="title">SPI_ReadNBytes</span>(<span class="params">SPI_TypeDef* SPIx, uint8_t *p_RxData,uint32_t readDataNum</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">int</span> retry=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(readDataNum--)&#123;</span><br><span class="line">SPIx-&gt;DR = <span class="number">0xFF</span>;</span><br><span class="line"><span class="keyword">while</span>(!(SPIx-&gt;SR&amp;SPI_FLAG_TXE))&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">retry = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(!(SPIx-&gt;SR&amp;SPI_FLAG_RXNE))&#123;</span><br><span class="line">retry++;</span><br><span class="line"><span class="keyword">if</span>(retry&gt;<span class="number">20000</span>)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">*p_RxData++ = SPIx-&gt;DR;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdComMF522</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šé€šè¿‡RC522å’ŒISO14443å¡é€šè®¯</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucCommandï¼ŒRC522å‘½ä»¤å­—</span></span><br><span class="line"><span class="comment"> *         pInDataï¼Œé€šè¿‡RC522å‘é€åˆ°å¡ç‰‡çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> *         ucInLenByteï¼Œå‘é€æ•°æ®çš„å­—èŠ‚é•¿åº¦</span></span><br><span class="line"><span class="comment"> *         pOutDataï¼Œæ¥æ”¶åˆ°çš„å¡ç‰‡è¿”å›æ•°æ®</span></span><br><span class="line"><span class="comment"> *         pOutLenBitï¼Œè¿”å›æ•°æ®çš„ä½é•¿åº¦</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨  ï¼šå†…éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdComMF522</span>(<span class="params">uint8_t Command,uint8_t *pInData,uint8_t InLenByte,uint8_t *pOutData,uint32_t *pOutLenBit</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status = MI_ERR;</span><br><span class="line">    uint8_t irqEn = <span class="number">0x00</span>;</span><br><span class="line">    uint8_t waitFor = <span class="number">0x00</span>;</span><br><span class="line">    uint8_t lastBits;</span><br><span class="line">    uint8_t n;</span><br><span class="line">    uint32_t i;</span><br><span class="line">    <span class="keyword">switch</span> (Command)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> PCD_AUTHENT:   <span class="comment">//Mifareè®¤è¯</span></span><br><span class="line">        irqEn = <span class="number">0x12</span>;   <span class="comment">//å…è®¸é”™è¯¯ä¸­æ–­è¯·æ±‚ErrIEn  å…è®¸ç©ºé—²ä¸­æ–­IdleIEn</span></span><br><span class="line">        waitFor = <span class="number">0x10</span>; <span class="comment">//è®¤è¯å¯»å¡ç­‰å¾…æ—¶å€™ æŸ¥è¯¢ç©ºé—²ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> PCD_TRANSCEIVE:<span class="comment">//æ¥æ”¶å‘é€ å‘é€æ¥æ”¶</span></span><br><span class="line">        irqEn = <span class="number">0x77</span>;   <span class="comment">//å…è®¸TxIEn RxIEn IdleIEn LoAlertIEn ErrIEn TimerIEn</span></span><br><span class="line">        waitFor = <span class="number">0x30</span>; <span class="comment">//å¯»å¡ç­‰å¾…æ—¶å€™ æŸ¥è¯¢æ¥æ”¶ä¸­æ–­æ ‡å¿—ä½ä¸ ç©ºé—²ä¸­æ–­æ ‡å¿—ä½</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="literal">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    WriteRawRC(ComIEnReg, irqEn | <span class="number">0x80</span>); <span class="comment">//IRqInvç½®ä½ç®¡è„šIRQä¸Status1Regçš„IRqä½çš„å€¼ç›¸å</span></span><br><span class="line">    ClearBitMask(ComIrqReg, <span class="number">0x80</span>);       <span class="comment">//Set1è¯¥ä½æ¸…é›¶æ—¶ï¼ŒCommIRqRegçš„å±è”½ä½æ¸…é›¶</span></span><br><span class="line">    WriteRawRC(CommandReg, PCD_IDLE);    <span class="comment">//å†™ç©ºé—²å‘½ä»¤</span></span><br><span class="line">    SetBitMask(FIFOLevelReg, <span class="number">0x80</span>);      <span class="comment">//ç½®ä½FlushBufferæ¸…é™¤å†…éƒ¨FIFOçš„è¯»å’Œå†™æŒ‡é’ˆä»¥åŠErrRegçš„BufferOvflæ ‡å¿—ä½è¢«æ¸…é™¤</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; InLenByte; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        WriteRawRC(FIFODataReg, pInData[i]);<span class="comment">//å†™æ•°æ®è¿›FIFOdata</span></span><br><span class="line">    &#125;</span><br><span class="line">    WriteRawRC(CommandReg, Command);<span class="comment">//å†™å‘½ä»¤</span></span><br><span class="line">    <span class="keyword">if</span> (Command == PCD_TRANSCEIVE)</span><br><span class="line">    &#123;</span><br><span class="line">        SetBitMask(BitFramingReg, <span class="number">0x80</span>);<span class="comment">//StartSendç½®ä½å¯åŠ¨æ•°æ®å‘é€ è¯¥ä½ä¸æ”¶å‘å‘½ä»¤ä½¿ç”¨æ—¶æ‰æœ‰æ•ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">800</span>;<span class="comment">//æ ¹æ®æ—¶é’Ÿé¢‘ç‡è°ƒæ•´ï¼Œæ“ä½œM1å¡æœ€å¤§ç­‰å¾…æ—¶é—´25ms</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = ReadRawRC(ComIrqReg);<span class="comment">//æŸ¥è¯¢äº‹ä»¶ä¸­æ–­</span></span><br><span class="line">        i--;</span><br><span class="line">    &#125; <span class="keyword">while</span> ((i != <span class="number">0</span>) &amp;&amp; !(n &amp; <span class="number">0x01</span>) &amp;&amp; !(n &amp; waitFor));<span class="comment">//é€€å‡ºæ¡ä»¶i=0,å®šæ—¶å™¨ä¸­æ–­ï¼Œä¸å†™ç©ºé—²å‘½ä»¤</span></span><br><span class="line">    ClearBitMask(BitFramingReg, <span class="number">0x80</span>);<span class="comment">//æ¸…ç†å…è®¸StartSendä½</span></span><br><span class="line">    <span class="keyword">if</span> (i != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(ReadRawRC(ErrorReg) &amp; <span class="number">0x1B</span>))<span class="comment">//è¯»é”™è¯¯æ ‡å¿—å¯„å­˜å™¨BufferOfI CollErr ParityErr ProtocolErr</span></span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_OK;</span><br><span class="line">            <span class="keyword">if</span> (n &amp; irqEn &amp; <span class="number">0x01</span>)<span class="comment">//æ˜¯å¦å‘ç”Ÿå®šæ—¶å™¨ä¸­æ–­</span></span><br><span class="line">            &#123;</span><br><span class="line">                status = MI_NOTAGERR;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (Command == PCD_TRANSCEIVE)</span><br><span class="line">            &#123;</span><br><span class="line">                n = ReadRawRC(FIFOLevelReg);<span class="comment">//è¯»FIFOä¸­ä¿å­˜çš„å­—èŠ‚æ•°</span></span><br><span class="line">                lastBits = ReadRawRC(ControlReg) &amp; <span class="number">0x07</span>;<span class="comment">//æœ€åæ¥æ”¶åˆ°å¾—å­—èŠ‚çš„æœ‰æ•ˆä½æ•°</span></span><br><span class="line">                <span class="keyword">if</span> (lastBits)</span><br><span class="line">                &#123;</span><br><span class="line">                    *pOutLenBit = (n - <span class="number">1</span>) * <span class="number">8</span> + lastBits;<span class="comment">//Nä¸ªå­—èŠ‚æ•°å‡å»1ï¼ˆæœ€åä¸€ä¸ªå­—èŠ‚ï¼‰+æœ€åä¸€ä½çš„ä½æ•° è¯»å–åˆ°çš„æ•°æ®æ€»ä½æ•°</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    *pOutLenBit = n * <span class="number">8</span>;<span class="comment">//æœ€åæ¥æ”¶åˆ°çš„å­—èŠ‚æ•´ä¸ªå­—èŠ‚æœ‰æ•ˆ</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (n == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    n = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (n &gt; MAXRLEN)</span><br><span class="line">                &#123;</span><br><span class="line">                    n = MAXRLEN;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    pOutData[i] = ReadRawRC(FIFODataReg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_ERR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    SetBitMask(ControlReg, <span class="number">0x80</span>); <span class="comment">// stop timer now</span></span><br><span class="line">    WriteRawRC(CommandReg, PCD_IDLE);</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdRequest</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¯»å¡</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucReq_codeï¼Œå¯»å¡æ–¹å¼</span></span><br><span class="line"><span class="comment"> *                     = 0x52ï¼Œå¯»æ„Ÿåº”åŒºå†…æ‰€æœ‰ç¬¦åˆ14443Aæ ‡å‡†çš„å¡</span></span><br><span class="line"><span class="comment"> *                     = 0x26ï¼Œå¯»æœªè¿›å…¥ä¼‘çœ çŠ¶æ€çš„å¡</span></span><br><span class="line"><span class="comment"> *         pTagTypeï¼Œå¡ç‰‡ç±»å‹ä»£ç </span></span><br><span class="line"><span class="comment"> *                   = 0x4400ï¼ŒMifare_UltraLight</span></span><br><span class="line"><span class="comment"> *                   = 0x0400ï¼ŒMifare_One(S50)</span></span><br><span class="line"><span class="comment"> *                   = 0x0200ï¼ŒMifare_One(S70)</span></span><br><span class="line"><span class="comment"> *                   = 0x0800ï¼ŒMifare_Pro(X))</span></span><br><span class="line"><span class="comment"> *                   = 0x4403ï¼ŒMifare_DESFire</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdRequest</span>(<span class="params">uint8_t req_code, uint8_t *pTagType</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line"></span><br><span class="line">    ClearBitMask(Status2Reg, <span class="number">0x08</span>);  <span class="comment">//æ¸…é™¤RC522å¯„å­˜ä½,æ¸…ç†æŒ‡ç¤ºMIFARECyptolå•å…ƒæ¥é€šä»¥åŠæ‰€æœ‰å¡çš„æ•°æ®é€šä¿¡è¢«åŠ å¯†çš„æƒ…å†µ</span></span><br><span class="line">    WriteRawRC(BitFramingReg, <span class="number">0x07</span>); <span class="comment">//å†™RC522å¯„å­˜å™¨ï¼Œå‘é€çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„ä¸ƒä½</span></span><br><span class="line">    SetBitMask(TxControlReg, <span class="number">0x03</span>);  å†™RC522å¯„å­˜ä½ï¼ŒTX1,TX2ç®¡è„šçš„è¾“å‡ºä¿¡å·ä¼ é€’ç»å‘é€è°ƒåˆ¶çš„<span class="number">13.56</span>çš„èƒ½é‡è½½æ³¢ä¿¡å·</span><br><span class="line"></span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = req_code;<span class="comment">//å­˜å…¥å¯»å¡æ–¹å¼</span></span><br><span class="line"></span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">1</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status == MI_OK) &amp;&amp; (unLen == <span class="number">0x10</span>))<span class="comment">//å¯»å¡æˆåŠŸè¿”å›å¡ç±»å‹</span></span><br><span class="line">    &#123;</span><br><span class="line">        *pTagType = ucComMF522Buf[<span class="number">0</span>];</span><br><span class="line">        *(pTagType + <span class="number">1</span>) = ucComMF522Buf[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdAnticoll</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šé˜²å†²æ’</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼špSnrï¼Œå¡ç‰‡åºåˆ—å·ï¼Œ4å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdAnticoll</span>(<span class="params">uint8_t *pSnr</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint8_t i, snr_check = <span class="number">0</span>;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ClearBitMask(Status2Reg, <span class="number">0x08</span>);<span class="comment">//æ¸…MFCryptol Onä½,åªæœ‰æˆåŠŸæ‰§è¡ŒMFAuthentå‘½ä»¤åï¼Œè¯¥ä½æ‰èƒ½ç½®ä½</span></span><br><span class="line">    WriteRawRC(BitFramingReg, <span class="number">0x00</span>);<span class="comment">//æ¸…ç†å¯„å­˜å™¨,åœæ­¢æ”¶å‘</span></span><br><span class="line">    ClearBitMask(CollReg, <span class="number">0x80</span>);<span class="comment">//æ¸…ValuesAfterCollæ‰€æœ‰æ¥æ”¶çš„ä½åœ¨å†²çªåè¢«æ¸…é™¤</span></span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_ANTICOLL1;<span class="comment">//å¡ç‰‡é˜²å†²çªå‘½ä»¤</span></span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = <span class="number">0x20</span>;</span><br><span class="line"></span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">2</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            *(pSnr + i) = ucComMF522Buf[i];</span><br><span class="line">            snr_check ^= ucComMF522Buf[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (snr_check != ucComMF522Buf[i])</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_ERR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    SetBitMask(CollReg, <span class="number">0x80</span>);</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdSelect</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šé€‰å®šå¡ç‰‡</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼špSnrï¼Œå¡ç‰‡åºåˆ—å·ï¼Œ4å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdSelect</span>(<span class="params">uint8_t *pSnr</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint8_t i;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_ANTICOLL1;<span class="comment">//é˜²å†²æ’</span></span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = <span class="number">0x70</span>;</span><br><span class="line">    ucComMF522Buf[<span class="number">6</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[i + <span class="number">2</span>] = *(pSnr + i);</span><br><span class="line">        ucComMF522Buf[<span class="number">6</span>] ^= *(pSnr + i);</span><br><span class="line">    &#125;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">7</span>, &amp;ucComMF522Buf[<span class="number">7</span>]);</span><br><span class="line">    ClearBitMask(Status2Reg, <span class="number">0x08</span>);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">9</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status == MI_OK) &amp;&amp; (unLen == <span class="number">0x18</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_OK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdAuthState</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šéªŒè¯å¡ç‰‡å¯†ç </span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucAuth_modeï¼Œå¯†ç éªŒè¯æ¨¡å¼</span></span><br><span class="line"><span class="comment"> *                     = 0x60ï¼ŒéªŒè¯Aå¯†é’¥</span></span><br><span class="line"><span class="comment"> *                     = 0x61ï¼ŒéªŒè¯Bå¯†é’¥</span></span><br><span class="line"><span class="comment"> *         uint8_t ucAddrï¼Œå—åœ°å€</span></span><br><span class="line"><span class="comment"> *         pKeyï¼Œå¯†ç </span></span><br><span class="line"><span class="comment"> *         pSnrï¼Œå¡ç‰‡åºåˆ—å·ï¼Œ4å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdAuthState</span>(<span class="params">uint8_t auth_mode, uint8_t addr, uint8_t *pKey, uint8_t *pSnr</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t i, ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = auth_mode;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[i + <span class="number">2</span>] = *(pKey + i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[i + <span class="number">8</span>] = *(pSnr + i);</span><br><span class="line">    &#125;</span><br><span class="line">    status = PcdComMF522(PCD_AUTHENT, ucComMF522Buf, <span class="number">12</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (!(ReadRawRC(Status2Reg) &amp; <span class="number">0x08</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdRead</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè¯»å–M1å¡ä¸€å—æ•°æ®</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šuint8_t ucAddrï¼Œå—åœ°å€</span></span><br><span class="line"><span class="comment"> *         pDataï¼Œè¯»å‡ºçš„æ•°æ®ï¼Œ16å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨  ï¼šå¤–éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdRead</span>(<span class="params">uint8_t addr, uint8_t *pData</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t i, ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_READ;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status == MI_OK) &amp;&amp; (unLen == <span class="number">0x90</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            *(pData + i) = ucComMF522Buf[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdWrite</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå†™æ•°æ®åˆ°M1å¡ä¸€å—</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šuint8_t ucAddrï¼Œå—åœ°å€</span></span><br><span class="line"><span class="comment"> *         pDataï¼Œå†™å…¥çš„æ•°æ®ï¼Œ16å­—èŠ‚</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨  ï¼šå¤–éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdWrite</span>(<span class="params">uint8_t addr, uint8_t *pData</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t i, ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_WRITE;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            ucComMF522Buf[i] = *(pData + i);</span><br><span class="line">        &#125;</span><br><span class="line">        CalulateCRC(ucComMF522Buf, <span class="number">16</span>, &amp;ucComMF522Buf[<span class="number">16</span>]);</span><br><span class="line"></span><br><span class="line">        status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">18</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">        <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_ERR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdValue</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šæ‰£æ¬¾å’Œå……å€¼</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šdd_mode[IN]ï¼šå‘½ä»¤å­—</span></span><br><span class="line"><span class="comment"> *              0xC0 = æ‰£æ¬¾</span></span><br><span class="line"><span class="comment"> *              0xC1 = å……å€¼</span></span><br><span class="line"><span class="comment"> *         addr[IN]ï¼šé’±åŒ…åœ°å€</span></span><br><span class="line"><span class="comment"> *         pValue[IN]ï¼š4å­—èŠ‚å¢(å‡)å€¼ï¼Œä½ä½åœ¨å‰</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdValue</span>(<span class="params">uint8_t dd_mode, uint8_t addr, uint8_t *pValue</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t i, ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = dd_mode;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            ucComMF522Buf[i] = *(pValue + i);</span><br><span class="line">        &#125;</span><br><span class="line">        CalulateCRC(ucComMF522Buf, <span class="number">4</span>, &amp;ucComMF522Buf[<span class="number">4</span>]);</span><br><span class="line">        unLen = <span class="number">0</span>;</span><br><span class="line">        status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">6</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">        <span class="keyword">if</span> (status != MI_ERR)</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_OK;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[<span class="number">0</span>] = PICC_TRANSFER;</span><br><span class="line">        ucComMF522Buf[<span class="number">1</span>] = addr;</span><br><span class="line">        CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">        status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_ERR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdBakValue</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¤‡ä»½é’±åŒ…</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šsourceaddr[IN]ï¼šæºåœ°å€</span></span><br><span class="line"><span class="comment"> *         goaladdr[IN]ï¼šç›®æ ‡åœ°å€</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdBakValue</span>(<span class="params">uint8_t sourceaddr, uint8_t goaladdr</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">char</span> status;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_RESTORE;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = sourceaddr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        ucComMF522Buf[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        ucComMF522Buf[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        ucComMF522Buf[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">        ucComMF522Buf[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">        CalulateCRC(ucComMF522Buf, <span class="number">4</span>, &amp;ucComMF522Buf[<span class="number">4</span>]);</span><br><span class="line">        status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">6</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">        <span class="keyword">if</span> (status != MI_ERR)</span><br><span class="line">        &#123;</span><br><span class="line">            status = MI_OK;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status != MI_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_TRANSFER;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = goaladdr;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line">    status = PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line">    <span class="keyword">if</span> ((status != MI_OK) || (unLen != <span class="number">4</span>) || ((ucComMF522Buf[<span class="number">0</span>] &amp; <span class="number">0x0F</span>) != <span class="number">0x0A</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        status = MI_ERR;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdHalt</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå‘½ä»¤å¡ç‰‡è¿›å…¥ä¼‘çœ çŠ¶æ€</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdHalt</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint32_t unLen;</span><br><span class="line">    uint8_t ucComMF522Buf[MAXRLEN];</span><br><span class="line"></span><br><span class="line">    ucComMF522Buf[<span class="number">0</span>] = PICC_HALT;</span><br><span class="line">    ucComMF522Buf[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    CalulateCRC(ucComMF522Buf, <span class="number">2</span>, &amp;ucComMF522Buf[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    PcdComMF522(PCD_TRANSCEIVE, ucComMF522Buf, <span class="number">4</span>, ucComMF522Buf, &amp;unLen);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MI_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šCalulateCRC</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šç”¨RC522è®¡ç®—CRC16</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼špIndataï¼Œè®¡ç®—CRC16çš„æ•°ç»„</span></span><br><span class="line"><span class="comment"> *         ucLenï¼Œè®¡ç®—CRC16çš„æ•°ç»„å­—èŠ‚é•¿åº¦</span></span><br><span class="line"><span class="comment"> *         pOutDataï¼Œå­˜æ”¾è®¡ç®—ç»“æœå­˜æ”¾çš„é¦–åœ°å€</span></span><br><span class="line"><span class="comment"> * è¿”å›  : æ— </span></span><br><span class="line"><span class="comment"> * è°ƒç”¨  ï¼šå†…éƒ¨è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CalulateCRC</span>(<span class="params">uint8_t *pIndata, uint8_t len, uint8_t *pOutData</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t i, n;</span><br><span class="line">    ClearBitMask(DivIrqReg, <span class="number">0x04</span>);</span><br><span class="line">    WriteRawRC(CommandReg, PCD_IDLE);</span><br><span class="line">    SetBitMask(FIFOLevelReg, <span class="number">0x80</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        WriteRawRC(FIFODataReg, *(pIndata + i));</span><br><span class="line">    &#125;</span><br><span class="line">    WriteRawRC(CommandReg, PCD_CALCCRC);</span><br><span class="line">    i = <span class="number">0xFF</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = ReadRawRC(DivIrqReg);</span><br><span class="line">        i--;</span><br><span class="line">    &#125; <span class="keyword">while</span> ((i != <span class="number">0</span>) &amp;&amp; !(n &amp; <span class="number">0x04</span>));</span><br><span class="line">    pOutData[<span class="number">0</span>] = ReadRawRC(CRCResultRegL);</span><br><span class="line">    pOutData[<span class="number">1</span>] = ReadRawRC(CRCResultRegM);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdRese</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¤ä½RC522</span></span><br><span class="line"><span class="comment"> * è¿”å›  : çŠ¶æ€å€¼</span></span><br><span class="line"><span class="comment"> *         = MI_OKï¼ŒæˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdReset</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">RC522_Reset_Disable();</span><br><span class="line">    delay_ms(<span class="number">10</span>);</span><br><span class="line">    RC522_Reset_Enable();</span><br><span class="line">    delay_ms(<span class="number">60</span>);</span><br><span class="line">    RC522_Reset_Disable();</span><br><span class="line">    delay_ms(<span class="number">500</span>);</span><br><span class="line">    WriteRawRC(CommandReg, PCD_RESETPHASE);<span class="comment">//å¤ä½æŒ‡ä»¤</span></span><br><span class="line">    delay_ms(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    WriteRawRC(ModeReg, <span class="number">0x3D</span>);<span class="comment">//å®šä¹‰å‘é€å’Œæ¥æ”¶å¸¸ç”¨æ¨¡å¼,å’ŒMifareå¡é€šè®¯ï¼ŒCRCåˆå§‹å€¼0x6363</span></span><br><span class="line">    WriteRawRC(TReloadRegL, <span class="number">30</span>);<span class="comment">//16ä½å®šæ—¶å™¨ä½ä½</span></span><br><span class="line">    WriteRawRC(TReloadRegH, <span class="number">0</span>);<span class="comment">//16ä½å®šæ—¶å™¨é«˜ä½</span></span><br><span class="line">    WriteRawRC(TModeReg, <span class="number">0x8D</span>);<span class="comment">//å®šä¹‰å†…éƒ¨å®šæ—¶å™¨çš„è®¾ç½®</span></span><br><span class="line">    WriteRawRC(TPrescalerReg, <span class="number">0x3E</span>);<span class="comment">//è®¾ç½®å®šæ—¶å™¨åˆ†é¢‘ç³»æ•°</span></span><br><span class="line">    WriteRawRC(TxAutoReg, <span class="number">0x40</span>);<span class="comment">//è°ƒåˆ¶å‘é€ä¿¡å·ä¸º100%ASK</span></span><br><span class="line"></span><br><span class="line">    ClearBitMask(TestPinEnReg, <span class="number">0x80</span>);</span><br><span class="line">    WriteRawRC(TxAutoReg, <span class="number">0x40</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> MI_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šReadRawRC</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè¯»RC522å¯„å­˜å™¨</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucAddressï¼Œå¯„å­˜å™¨åœ°å€</span></span><br><span class="line"><span class="comment"> * è¿”å›  : å¯„å­˜å™¨çš„å½“å‰å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">uint8_t <span class="title">ReadRawRC</span>(<span class="params">uint8_t Address</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t ucAddr;</span><br><span class="line">    uint8_t ucResult = <span class="number">0</span>;</span><br><span class="line">    ucAddr = ((Address &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0x7E</span>) | <span class="number">0x80</span>;<span class="comment">//æœ€é«˜ä½ç½®1ï¼Œè¯»æ“ä½œ;æœ€ä½ä¸ºé»˜è®¤0</span></span><br><span class="line">    delay_ms(<span class="number">1</span>);</span><br><span class="line">    RC522_CS_Enable();</span><br><span class="line">    SPI_WriteNBytes(SPI1_SPI, &amp;ucAddr, <span class="number">1</span>);  <span class="comment">//å‘æ€»çº¿å†™å¤šä¸ªæ•°æ®</span></span><br><span class="line">    SPI_ReadNBytes(SPI1_SPI, &amp;ucResult, <span class="number">1</span>); <span class="comment">//å‘æ€»çº¿è¯»å¤šä¸ªæ•°æ®</span></span><br><span class="line">    RC522_CS_Disable();</span><br><span class="line">    <span class="keyword">return</span> ucResult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šWriteRawRC</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå†™RC522å¯„å­˜å™¨</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucAddressï¼Œå¯„å­˜å™¨åœ°å€</span></span><br><span class="line"><span class="comment"> *         ucValueï¼Œå†™å…¥å¯„å­˜å™¨çš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WriteRawRC</span>(<span class="params">uint8_t Address, uint8_t <span class="keyword">value</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t ucAddr;</span><br><span class="line">    uint8_t write_buffer[<span class="number">2</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    ucAddr = ((Address &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0x7E</span>);<span class="comment">//æœ€é«˜ä½ç½®0ï¼Œå†™æ“ä½œ;æœ€ä½ä¸ºé»˜è®¤0</span></span><br><span class="line">    write_buffer[<span class="number">0</span>] = ucAddr;</span><br><span class="line">    write_buffer[<span class="number">1</span>] = <span class="keyword">value</span>;</span><br><span class="line">    delay_ms(<span class="number">1</span>);</span><br><span class="line">    RC522_CS_Enable();</span><br><span class="line">    SPI_WriteNBytes(SPI1_SPI, write_buffer, <span class="number">2</span>);</span><br><span class="line">    RC522_CS_Disable();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šSetBitMask</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¯¹RC522å¯„å­˜å™¨ç½®ä½ï¼Œå¯å¯¹å¤šä¸ªä½åŒæ—¶æ“ä½œ</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucRegï¼Œå¯„å­˜å™¨åœ°å€</span></span><br><span class="line"><span class="comment"> *         ucMaskï¼Œç½®ä½å€¼,ä¾‹0x13ï¼Œ0001 0011</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetBitMask</span>(<span class="params">uint8_t reg, uint8_t mask</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t temp = <span class="number">0x00</span>;</span><br><span class="line"></span><br><span class="line">    temp = ReadRawRC(reg);        <span class="comment">//è¯»å¯„å­˜å™¨</span></span><br><span class="line">    WriteRawRC(reg, temp | mask); <span class="comment">//å°†ç›®æ ‡ä½ç½®1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šClearBitMask</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¯¹RC522å¯„å­˜å™¨æ¸…ä½</span></span><br><span class="line"><span class="comment"> * è¾“å…¥  ï¼šucRegï¼Œå¯„å­˜å™¨åœ°å€</span></span><br><span class="line"><span class="comment"> *         ucMaskï¼Œæ¸…ä½å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClearBitMask</span>(<span class="params">uint8_t reg, uint8_t mask</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t temp = <span class="number">0x00</span>;</span><br><span class="line"></span><br><span class="line">    temp = ReadRawRC(reg);</span><br><span class="line">    WriteRawRC(reg, temp &amp; ~mask);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdAntennaOn</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå¼€å¯å¤©çº¿</span></span><br><span class="line"><span class="comment"> * TxControlRegå¯„å­˜å™¨ä½0ç½®1ï¼Œå¼•è„šTX1ä¸Šçš„è¾“å‡ºä¿¡å·å°†ä¼ è¾“ç”±ä¼ è¾“æ•°æ®è°ƒåˆ¶çš„13.56 MHzèƒ½é‡è½½æ³¢ã€‚</span></span><br><span class="line"><span class="comment"> * TxControlRegå¯„å­˜å™¨ä½1ç½®1ï¼Œå¼•è„šTX2ä¸Šçš„è¾“å‡ºä¿¡å·å°†å‘é€ç”±ä¼ è¾“æ•°æ®è°ƒåˆ¶çš„13.56 MHzèƒ½é‡è½½æ³¢ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PcdAntennaOn</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    uint8_t i;</span><br><span class="line">    i = ReadRawRC(TxControlReg);</span><br><span class="line">    <span class="keyword">if</span> (!(i &amp; <span class="number">0x03</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        SetBitMask(TxControlReg, <span class="number">0x03</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šPcdAntennaOff</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šå…³é—­å¤©çº¿</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PcdAntennaOff</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ClearBitMask(TxControlReg, <span class="number">0x03</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * å‡½æ•°åï¼šRC522_PcdConfig_Type</span></span><br><span class="line"><span class="comment"> * æè¿°  ï¼šè®¾ç½®RC522çš„å·¥ä½œæ–¹å¼</span></span><br><span class="line"><span class="comment"> * å·¥ä½œæ–¹å¼ISO14443_A</span></span><br><span class="line"><span class="comment"> * å¤ä½ä¸­å·²ç»è®¾ç½®è¿‡ï¼Œè¯¥å‡½æ•°æš‚æ—¶æœªè°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Config</span>(<span class="params">uint8_t Card_Type</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ClearBitMask(Status2Reg, <span class="number">0x08</span>);</span><br><span class="line">    WriteRawRC(ModeReg, <span class="number">0x3D</span>);</span><br><span class="line">    WriteRawRC(RxSelReg, <span class="number">0x86</span>);</span><br><span class="line">    WriteRawRC(RFCfgReg, <span class="number">0x7F</span>);</span><br><span class="line">    WriteRawRC(TReloadRegL, <span class="number">30</span>);</span><br><span class="line">    WriteRawRC(TReloadRegH, <span class="number">0</span>);</span><br><span class="line">    WriteRawRC(TModeReg, <span class="number">0x8D</span>);</span><br><span class="line">    WriteRawRC(TPrescalerReg, <span class="number">0x3E</span>);</span><br><span class="line">    delay_ms(<span class="number">5</span>);</span><br><span class="line">    PcdAntennaOn();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>RC522.h</p><p>å¤´æ–‡ä»¶å†…å®¹ä¸APIå¤§è‡´ç›¸åŒï¼Œå®šä¹‰äº†æŒ‡ä»¤é›†å’Œå¯„å­˜å™¨ã€‚</p><p>è¿™é‡Œçš„sys.hæ˜¯æ­£ç‚¹åŸå­çš„F1ç³»åˆ—å¤´æ–‡ä»¶ã€‚</p><p>åŠ å…¥äº†å¼•è„šå®šä¹‰å’Œè‡ªå®šä¹‰å‡½æ•°ã€‚</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#ifndef __RC522_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __RC522_H</span></span><br><span class="line"><span class="meta">#include &quot;sys.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************å¼•è„šå®šä¹‰****************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">RC522SPIå¼•è„š,RSTå’ŒCSå¯éšæ„æ›´æ”¹</span></span><br><span class="line"><span class="comment">RST-PC5</span></span><br><span class="line"><span class="comment">CS-PA4</span></span><br><span class="line"><span class="comment">SCK-PA5</span></span><br><span class="line"><span class="comment">MISO-PA6</span></span><br><span class="line"><span class="comment">MOSI-PA7</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Reset</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_RST_Pin      GPIO_PIN_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_RST_GPIO_Port     GPIOC</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_GPIO_Reset_CLK_ENABLE() \</span></span><br><span class="line">    <span class="keyword">do</span> &#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125; <span class="keyword">while</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//CSç‰‡é€‰ï¼Œæ¨¡å—SDAå¼•è„šï¼ŒSPIé€šä¿¡æ—¶ç”¨ä½œNSS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_GPIO_CS_PIN      GPIO_PIN_4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_GPIO_CS_PORT     GPIOA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_GPIO_CS_CLK_ENABLE() \</span></span><br><span class="line">    <span class="keyword">do</span> &#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125; <span class="keyword">while</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/***********************RC522 å‡½æ•°å®å®šä¹‰**********************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_Reset_Disable() HAL_GPIO_WritePin(RC522_RST_GPIO_Port, RC522_RST_Pin, GPIO_PIN_SET);</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_Reset_Enable() HAL_GPIO_WritePin(RC522_RST_GPIO_Port, RC522_RST_Pin, GPIO_PIN_RESET);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_CS_Enable() HAL_GPIO_WritePin(RC522_GPIO_CS_PORT, RC522_GPIO_CS_PIN, GPIO_PIN_RESET);</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RC522_CS_Disable() HAL_GPIO_WritePin(RC522_GPIO_CS_PORT, RC522_GPIO_CS_PIN, GPIO_PIN_SET);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> readID  1//è¯»</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> writeID 2//å†™</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************è‡ªå®šä¹‰å‡½æ•°****************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Start</span>(<span class="params">uint8_t block,uint8_t option,uint8_t *Write_Card_Data</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_SPI_GPIO_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************RC522æŒ‡ä»¤é›†****************************/</span></span><br><span class="line"><span class="comment">//MF522å‘½ä»¤å­—</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_IDLE              0x00               //å–æ¶ˆå½“å‰å‘½ä»¤</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_AUTHENT           0x0E               //éªŒè¯å¯†é’¥</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_RECEIVE           0x08               //æ¥æ”¶æ•°æ®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_TRANSMIT          0x04               //å‘é€æ•°æ®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_TRANSCEIVE        0x0C               //å‘é€å¹¶æ¥æ”¶æ•°æ®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_RESETPHASE        0x0F               //å¤ä½</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCD_CALCCRC           0x03               //CRCè®¡ç®—</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Mifare_Oneå¡ç‰‡å‘½ä»¤å­—</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_REQIDL           0x26               //å¯»å¤©çº¿åŒºå†…æœªè¿›å…¥ä¼‘çœ çŠ¶æ€</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_REQALL           0x52               //å¯»å¤©çº¿åŒºå†…å…¨éƒ¨å¡</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_ANTICOLL1        0x93               //é˜²å†²æ’</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_ANTICOLL2        0x95               //é˜²å†²æ’</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_AUTHENT1A        0x60               //éªŒè¯Aå¯†é’¥</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_AUTHENT1B        0x61               //éªŒè¯Bå¯†é’¥</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_READ             0x30               //è¯»å—</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_WRITE            0xA0               //å†™å—</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_DECREMENT        0xC0               //æ‰£æ¬¾</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_INCREMENT        0xC1               //å……å€¼</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_RESTORE          0xC2               //è°ƒå—æ•°æ®åˆ°ç¼“å†²åŒº</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_TRANSFER         0xB0               //ä¿å­˜ç¼“å†²åŒºä¸­æ•°æ®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PICC_HALT             0x50               //ä¼‘çœ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MF522 FIFOé•¿åº¦å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_FIFO_LENGTH       64                 //FIFO size=64byte</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MF522å¯„å­˜å™¨å®šä¹‰</span></span><br><span class="line"><span class="comment">// PAGE 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU00                 0x00</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CommandReg            0x01</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ComIEnReg             0x02</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     DivlEnReg             0x03</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ComIrqReg             0x04</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     DivIrqReg             0x05</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ErrorReg              0x06</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     Status1Reg            0x07</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     Status2Reg            0x08</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     FIFODataReg           0x09</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     FIFOLevelReg          0x0A</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     WaterLevelReg         0x0B</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ControlReg            0x0C</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     BitFramingReg         0x0D</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CollReg               0x0E</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU0F                 0x0F</span></span><br><span class="line"><span class="comment">// PAGE 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU10                 0x10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ModeReg               0x11</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TxModeReg             0x12</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RxModeReg             0x13</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TxControlReg          0x14</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TxAutoReg             0x15</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TxSelReg              0x16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RxSelReg              0x17</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RxThresholdReg        0x18</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     DemodReg              0x19</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU1A                 0x1A</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU1B                 0x1B</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     MifareReg             0x1C</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU1D                 0x1D</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU1E                 0x1E</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     SerialSpeedReg        0x1F</span></span><br><span class="line"><span class="comment">// PAGE 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU20                 0x20</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CRCResultRegM         0x21</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CRCResultRegL         0x22</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU23                 0x23</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ModWidthReg           0x24</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU25                 0x25</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFCfgReg              0x26</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     GsNReg                0x27</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     CWGsCfgReg            0x28</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     ModGsCfgReg           0x29</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TModeReg              0x2A</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TPrescalerReg         0x2B</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TReloadRegH           0x2C</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TReloadRegL           0x2D</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TCounterValueRegH     0x2E</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TCounterValueRegL     0x2F</span></span><br><span class="line"><span class="comment">// PAGE 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU30                 0x30</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestSel1Reg           0x31</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestSel2Reg           0x32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestPinEnReg          0x33</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestPinValueReg       0x34</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestBusReg            0x35</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     AutoTestReg           0x36</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     VersionReg            0x37</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     AnalogTestReg         0x38</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestDAC1Reg           0x39</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestDAC2Reg           0x3A</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     TestADCReg            0x3B</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU3C                 0x3C</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU3D                 0x3D</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU3E                 0x3E</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>     RFU3F  0x3F</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å’ŒMF522é€šè®¯æ—¶è¿”å›çš„é”™è¯¯ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MI_OK                          0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MI_NOTAGERR                    1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MI_ERR                         2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼“å†²æ•°ç»„å¤§å°</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXRLEN                       18</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************å†…éƒ¨è°ƒç”¨å‡½æ•°**************************************/</span></span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdRequest</span>(<span class="params">uint8_t req_code,uint8_t *pTagType</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdAnticoll</span>(<span class="params">uint8_t *pSnr</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdSelect</span>(<span class="params">uint8_t *pSnr</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdAuthState</span>(<span class="params">uint8_t auth_mode,uint8_t addr,uint8_t *pKey,uint8_t *pSnr</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdRead</span>(<span class="params">uint8_t addr,uint8_t *pData</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdWrite</span>(<span class="params">uint8_t addr,uint8_t *pData</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdValue</span>(<span class="params">uint8_t dd_mode,uint8_t addr,uint8_t *pValue</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdBakValue</span>(<span class="params">uint8_t sourceaddr, uint8_t goaladdr</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdHalt</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CalulateCRC</span>(<span class="params">uint8_t *pIndata,uint8_t len,uint8_t *pOutData</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdReset</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function">uint8_t <span class="title">ReadRawRC</span>(<span class="params">uint8_t Address</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WriteRawRC</span>(<span class="params">uint8_t Address, uint8_t <span class="keyword">value</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetBitMask</span>(<span class="params">uint8_t reg,uint8_t mask</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ClearBitMask</span>(<span class="params">uint8_t reg,uint8_t mask</span>)</span>;</span><br><span class="line"><span class="function"><span class="built_in">char</span> <span class="title">PcdComMF522</span>(<span class="params">uint8_t Command,uint8_t *pInData,uint8_t InLenByte,uint8_t *pOutData,unsigned <span class="built_in">int</span> *pOutLenBit</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PcdAntennaOn</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PcdAntennaOff</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RC522_Config</span>(<span class="params">uint8_t Card_Type</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="SPIå®šä¹‰"><a href="#SPIå®šä¹‰" class="headerlink" title="SPIå®šä¹‰"></a>SPIå®šä¹‰</h4><p>spiçš„åˆå§‹åŒ–é»˜è®¤å³å¯ï¼Œæ³¨æ„ä»¥ä¸‹ä¸¤é¡¹çš„è®¾ç½®ï¼Œæ‰èƒ½ä¿æŒå’Œæ¨¡å—çš„æ­£å¸¸é€šä¿¡ï¼š</p><p><strong>CLKPolarity</strong>&#x3D;SPI_POLARITY_LOW; &#x2F;&#x2F;ä¸²è¡ŒåŒæ­¥æ—¶é’Ÿçš„ç©ºé—²çŠ¶æ€ä¸ºä½ç”µå¹³</p><p><strong>CLKPhase</strong>&#x3D;SPI_PHASE_1EDGE; &#x2F;&#x2F;ä¸²è¡ŒåŒæ­¥æ—¶é’Ÿçš„ç¬¬1ä¸ªè·³å˜æ²¿ï¼ˆä¸Šå‡æˆ–ä¸‹é™ï¼‰æ•°æ®è¢«é‡‡æ ·</p><p>ç‰‡é€‰å¼•è„šæ”¹ä¸ºè½¯ä»¶ç®¡ç†ï¼Œè¿™æ ·æ–¹ä¾¿æ›´æ”¹å¼•è„šï¼Œ</p><p><strong>NSS</strong>&#x3D;SPI_NSS_SOFT; &#x2F;&#x2F;NSSä¿¡å·ç”±ç¡¬ä»¶ï¼ˆNSSç®¡è„šï¼‰è¿˜æ˜¯è½¯ä»¶ï¼ˆä½¿ç”¨SSIä½ï¼‰ç®¡ç†</p><p>SPI.c</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include &quot;spi.h&quot;</span></span><br><span class="line"></span><br><span class="line">SPI_HandleTypeDef SPI1_Handler;  <span class="comment">//SPIå¥æŸ„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹æ˜¯SPIæ¨¡å—çš„åˆå§‹åŒ–ä»£ç ï¼Œé…ç½®æˆä¸»æœºæ¨¡å¼</span></span><br><span class="line"><span class="comment">//SPIå£åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">//è¿™é‡Œé’ˆæ˜¯å¯¹SPI1çš„åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SPI1_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    SPI1_Handler.Instance=SPI1_SPI;                         <span class="comment">//SPI1</span></span><br><span class="line">    SPI1_Handler.Init.Mode=SPI_MODE_MASTER;             <span class="comment">//è®¾ç½®SPIå·¥ä½œæ¨¡å¼ï¼Œè®¾ç½®ä¸ºä¸»æ¨¡å¼</span></span><br><span class="line">    SPI1_Handler.Init.Direction=SPI_DIRECTION_2LINES;   <span class="comment">//è®¾ç½®SPIå•å‘æˆ–è€…åŒå‘çš„æ•°æ®æ¨¡å¼:SPIè®¾ç½®ä¸ºåŒçº¿æ¨¡å¼</span></span><br><span class="line">    SPI1_Handler.Init.DataSize=SPI_DATASIZE_8BIT;       <span class="comment">//è®¾ç½®SPIçš„æ•°æ®å¤§å°:SPIå‘é€æ¥æ”¶8ä½å¸§ç»“æ„</span></span><br><span class="line">    SPI1_Handler.Init.CLKPolarity=SPI_POLARITY_LOW;    <span class="comment">//ä¸²è¡ŒåŒæ­¥æ—¶é’Ÿçš„ç©ºé—²çŠ¶æ€ä¸ºä½ç”µå¹³</span></span><br><span class="line">    SPI1_Handler.Init.CLKPhase=SPI_PHASE_1EDGE;         <span class="comment">//ä¸²è¡ŒåŒæ­¥æ—¶é’Ÿçš„ç¬¬1ä¸ªè·³å˜æ²¿ï¼ˆä¸Šå‡æˆ–ä¸‹é™ï¼‰æ•°æ®è¢«é‡‡æ ·</span></span><br><span class="line">    SPI1_Handler.Init.NSS=SPI_NSS_SOFT;                 <span class="comment">//NSSä¿¡å·ç”±ç¡¬ä»¶ï¼ˆNSSç®¡è„šï¼‰è¿˜æ˜¯è½¯ä»¶ï¼ˆä½¿ç”¨SSIä½ï¼‰ç®¡ç†:å†…éƒ¨NSSä¿¡å·æœ‰SSIä½æ§åˆ¶</span></span><br><span class="line">    SPI1_Handler.Init.BaudRatePrescaler=SPI_BAUDRATEPRESCALER_256;<span class="comment">//å®šä¹‰æ³¢ç‰¹ç‡é¢„åˆ†é¢‘çš„å€¼:æ³¢ç‰¹ç‡é¢„åˆ†é¢‘å€¼ä¸º256</span></span><br><span class="line">    SPI1_Handler.Init.FirstBit=SPI_FIRSTBIT_MSB;        <span class="comment">//æŒ‡å®šæ•°æ®ä¼ è¾“ä»MSBä½è¿˜æ˜¯LSBä½å¼€å§‹:æ•°æ®ä¼ è¾“ä»MSBä½å¼€å§‹</span></span><br><span class="line">    SPI1_Handler.Init.TIMode=SPI_TIMODE_DISABLE;        <span class="comment">//å…³é—­TIæ¨¡å¼</span></span><br><span class="line">    SPI1_Handler.Init.CRCCalculation=SPI_CRCCALCULATION_DISABLE;<span class="comment">//å…³é—­ç¡¬ä»¶CRCæ ¡éªŒ</span></span><br><span class="line">    SPI1_Handler.Init.CRCPolynomial=<span class="number">7</span>;                  <span class="comment">//CRCå€¼è®¡ç®—çš„å¤šé¡¹å¼,é»˜è®¤å€¼ä¸º7</span></span><br><span class="line">    HAL_SPI_Init(&amp;SPI1_Handler);<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line"></span><br><span class="line">    __HAL_SPI_ENABLE(&amp;SPI1_Handler);                    <span class="comment">//ä½¿èƒ½SPI1</span></span><br><span class="line"></span><br><span class="line">    SPI1_ReadWriteByte(<span class="number">0Xff</span>);                           <span class="comment">//å¯åŠ¨ä¼ è¾“,äº§ç”Ÿ8ä¸ªæ—¶é’Ÿè„‰å†², è¾¾åˆ°æ¸…ç©ºDRçš„ä½œç”¨, éå¿…éœ€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//SPIåº•å±‚é©±åŠ¨ï¼Œæ—¶é’Ÿä½¿èƒ½ï¼Œå¼•è„šé…ç½®</span></span><br><span class="line"><span class="comment">//æ­¤å‡½æ•°ä¼šè¢«HAL_SPI_Init()è°ƒç”¨</span></span><br><span class="line"><span class="comment">//hspi:SPIå¥æŸ„</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_SPI_MspInit</span>(<span class="params">SPI_HandleTypeDef *hspi</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    GPIO_InitTypeDef GPIO_Initure;</span><br><span class="line"></span><br><span class="line">    SPI1_SPI_CLK_ENABLE();</span><br><span class="line">    SPI1_SCK_GPIO_CLK_ENABLE();</span><br><span class="line">    SPI1_MISO_GPIO_CLK_ENABLE();</span><br><span class="line">    SPI1_MOSI_GPIO_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">    GPIO_Initure.Pin=SPI1_SCK_GPIO_PIN;</span><br><span class="line">    GPIO_Initure.Mode=GPIO_MODE_AF_PP;</span><br><span class="line">    GPIO_Initure.Pull=GPIO_PULLDOWN;</span><br><span class="line">    GPIO_Initure.Speed=GPIO_SPEED_FREQ_HIGH;</span><br><span class="line">    HAL_GPIO_Init(SPI1_SCK_GPIO_PORT,&amp;GPIO_Initure);</span><br><span class="line"></span><br><span class="line">    GPIO_Initure.Pin=SPI1_MISO_GPIO_PIN;</span><br><span class="line">    HAL_GPIO_Init(SPI1_MISO_GPIO_PORT,&amp;GPIO_Initure);</span><br><span class="line"></span><br><span class="line">    GPIO_Initure.Pin=SPI1_MOSI_GPIO_PIN;</span><br><span class="line">    HAL_GPIO_Init(SPI1_MOSI_GPIO_PORT,&amp;GPIO_Initure);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SPI.h</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#ifndef __SPI_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __SPI_H</span></span><br><span class="line"><span class="meta">#include &quot;sys.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> SPI_HandleTypeDef SPI1_Handler;  <span class="comment">//SPIå¥æŸ„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* SPI1 å¼•è„š å®šä¹‰ */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SCK_GPIO_PORT              GPIOA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SCK_GPIO_PIN               GPIO_PIN_5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SCK_GPIO_CLK_ENABLE()      do&#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MISO_GPIO_PORT             GPIOA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MISO_GPIO_PIN              GPIO_PIN_6</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MISO_GPIO_CLK_ENABLE()     do&#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MOSI_GPIO_PORT             GPIOA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MOSI_GPIO_PIN              GPIO_PIN_7</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_MOSI_GPIO_CLK_ENABLE()     do&#123; __HAL_RCC_GPIOA_CLK_ENABLE(); &#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* SPI1ç›¸å…³å®šä¹‰ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SPI                        SPI1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SPI1_SPI_CLK_ENABLE()           do&#123; __HAL_RCC_SPI1_CLK_ENABLE(); &#125;while(0)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SPI1_Init</span>(<span class="params"><span class="keyword">void</span></span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h2 id="å››ã€å®éªŒç»“æœ"><a href="#å››ã€å®éªŒç»“æœ" class="headerlink" title="å››ã€å®éªŒç»“æœ"></a>å››ã€å®éªŒç»“æœ</h2><p><img src="https://img-blog.csdnimg.cn/53941b94abc34bf5a897740cede1942a.png"></p><p>æœ¬å®éªŒåœ¨äºç»éªŒåˆ†äº«å’Œå­¦ä¹ è®°å½•ï¼Œæœ‰ä¸æ­£ç¡®çš„åœ°æ–¹è¯·è¯»è€…æŒ‡æ­£ã€‚</p><h2 id="äº”ã€æ›´æ–°æºç ï¼š"><a href="#äº”ã€æ›´æ–°æºç ï¼š" class="headerlink" title="äº”ã€æ›´æ–°æºç ï¼š"></a>äº”ã€æ›´æ–°æºç ï¼š</h2><p>æºç å·²ä¸Šä¼ è‡³giteeï¼š</p><p><a href="https://gitee.com/lrf1125962926/stm32/tree/RC522_SPI/" title="stm32: ä¸€äº›stm32æ¨¡å—ä½¿ç”¨ç»éªŒè®°å½• - Gitee.com">stm32: ä¸€äº›stm32æ¨¡å—ä½¿ç”¨ç»éªŒè®°å½• - Gitee.com <img src="https://csdnimg.cn/release/blog_editor_html/release2.3.6/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=N7T8">https://gitee.com/lrf1125962926/stm32/tree/RC522_SPI&#x2F;;</a></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5.Systickæ»´ç­”å®šæ—¶å™¨åˆå§‹åŒ–ï¼ˆHALåº“ï¼‰&amp;æ— OSå»¶æ—¶å‡½æ•°</title>
      <link href="/2024/03/stm32-5-Systick%E6%BB%B4%E7%AD%94%E5%AE%9A%E6%97%B6%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%88HAL%E5%BA%93%EF%BC%89-%E6%97%A0OS%E5%BB%B6%E6%97%B6%E5%87%BD%E6%95%B0/"/>
      <url>/2024/03/stm32-5-Systick%E6%BB%B4%E7%AD%94%E5%AE%9A%E6%97%B6%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%88HAL%E5%BA%93%EF%BC%89-%E6%97%A0OS%E5%BB%B6%E6%97%B6%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h4 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h4><ul><li><a href="#1systick-1">1.Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹</a></li><li><a href="#2systick-3">2.Systickä¸»è¦å¯„å­˜å™¨</a></li><li><a href="#3systick-9">3.Systickä¸­æ–­ä¼˜å…ˆçº§</a></li><li><a href="#4systick-13">4.Systickåˆå§‹åŒ–æµç¨‹</a></li><li><a href="#5os-108">5.æ— OSå»¶æ—¶å‡½æ•°</a></li></ul><h2 id="1-Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹"><a href="#1-Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹" class="headerlink" title="1.Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹"></a>1.Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹</h2><p>SysTickæ˜¯å±äºCM4å†…æ ¸ä¸­çš„å¤–è®¾ï¼Œå…¶å¯„å­˜å™¨çš„å®šä¹‰å’Œéƒ¨åˆ†åº“å‡½æ•°éƒ½åœ¨core_cm4.hä¸­å®ç°ã€‚Systickæ˜¯ä¸€ä¸ª24bitçš„å‘ä¸‹é€’å‡çš„è®¡æ•°å™¨ï¼Œä¸€èˆ¬è®¾ç½®å…¶æ—¶é’Ÿç­‰äºSYSCLKçš„180Mï¼ˆå¦ä¸€ä¸ªé€‰æ‹©æ˜¯HCLK&#x2F;8ï¼‰ã€‚å½“é‡è£…è½½æ•°å€¼å¯„å­˜å™¨çš„å€¼é€’å‡åˆ°0çš„æ—¶å€™ï¼Œç³»ç»Ÿå®šæ—¶å™¨å°±äº§ç”Ÿä¸€æ¬¡ä¸­æ–­ï¼Œä»¥æ­¤å¾ªç¯å¾€å¤ã€‚åŸºäºCM4å†…æ ¸çš„MCUéƒ½æœ‰è¿™ä¸ªç³»ç»Ÿå®šæ—¶å™¨ï¼Œä½¿å¾—è½¯ä»¶åœ¨CM4 å•ç‰‡æœºä¸­å¯ä»¥å¾ˆå®¹æ˜“çš„ç§»æ¤ã€‚å› æ­¤å®ƒä¸€èˆ¬ç”¨äºRTOSï¼Œç”¨äºäº§ç”Ÿæ—¶åŸºï¼Œç»´æŒæ“ä½œç³»ç»Ÿçš„å¿ƒè·³ã€‚Systickç”¨äºRTOSçš„æ€»ç»“æˆ‘æ‰“ç®—ä»¥åå†™UCOSåšå®¢çš„æ—¶å€™æ€»ç»“ï¼Œè¿™ç¯‡åšå®¢ä¸»è¦ä»‹ç»æ— OSæ—¶ï¼ŒSystickåˆå§‹åŒ–è¿‡ç¨‹å’Œå»¶æ—¶å‡½æ•°ä½¿ç”¨æ–¹æ³•ã€‚</p><h2 id="2-Systickä¸»è¦å¯„å­˜å™¨"><a href="#2-Systickä¸»è¦å¯„å­˜å™¨" class="headerlink" title="2.Systickä¸»è¦å¯„å­˜å™¨"></a>2.Systickä¸»è¦å¯„å­˜å™¨</h2><p><img src="https://img-blog.csdnimg.cn/20200404233234532.png"><br><strong>æ§åˆ¶å¯„å­˜å™¨ï¼š</strong> CLKSOURCEç”¨äºé€‰æ‹©æ—¶é’Ÿæºï¼Œä¸€èˆ¬ä¼šé€‰æ‹©å¤„ç†å™¨æ—¶é’Ÿï¼›ENABLEä½ç”¨äºä½¿èƒ½Systickï¼›TICKINTä½ç½®1ä¼šå¼€å¯Systickä¸­æ–­ã€‚<br><img src="https://img-blog.csdnimg.cn/20200404233348124.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTg5ODgwNA==,size_1,color_FFFFFF,t_1"><br><strong>é‡è£…è½½å€¼å¯„å­˜å™¨ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20200404234149713.png"></p><h2 id="3-Systickä¸­æ–­ä¼˜å…ˆçº§"><a href="#3-Systickä¸­æ–­ä¼˜å…ˆçº§" class="headerlink" title=";  3.Systickä¸­æ–­ä¼˜å…ˆçº§"></a><a name="3systick_9">;</a>  3.Systickä¸­æ–­ä¼˜å…ˆçº§</h2><p>SysTickå±äºå†…æ ¸å¤–è®¾ï¼Œå’Œæ™®é€šå¤–è®¾çš„ä¸­æ–­ä¼˜å…ˆçº§ä¸åŒï¼Œæ²¡æœ‰æŠ¢å ä¼˜å…ˆçº§å’Œå“åº”ä¼˜å…ˆçº§çš„è¯´æ³•ã€‚åœ¨F429 ä¸­ï¼Œå†…æ ¸å¤–è®¾çš„ä¸­æ–­ä¼˜å…ˆçº§ç”±å†…æ ¸SCBçš„å¤–è®¾çš„å¯„å­˜å™¨SHPRxï¼ˆx&#x3D;1.2.3ï¼‰é…ç½®ã€‚SPRH1-SPRH3æ˜¯32ä½çš„å¯„å­˜å™¨ï¼Œåªèƒ½é€šè¿‡å­—èŠ‚è®¿é—®ï¼Œæ¯ 8ä¸ªå­—æ®µæ§åˆ¶ç€ä¸€ä¸ªå†…æ ¸å¤–è®¾çš„ä¸­æ–­ä¼˜å…ˆçº§çš„é…ç½®ã€‚åœ¨F429 ä¸­åªæœ‰ä½ 7:3 è¿™é«˜å››ä½æœ‰æ•ˆï¼Œæ‰€ä»¥å†…æ ¸å¤–è®¾çš„ä¸­æ–­ä¼˜å…ˆçº§å¯ç¼–ç¨‹ä¸ºï¼š0~15ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚<br><img src="https://img-blog.csdnimg.cn/20200405093144981.png"><br><img src="https://img-blog.csdnimg.cn/20200405093414919.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTg5ODgwNA==,size_1,color_FFFFFF,t_1"></p><h2 id="4-Systickåˆå§‹åŒ–æµç¨‹"><a href="#4-Systickåˆå§‹åŒ–æµç¨‹" class="headerlink" title="4.Systickåˆå§‹åŒ–æµç¨‹"></a>4.Systickåˆå§‹åŒ–æµç¨‹</h2><ol><li>HAL_Init()æ˜¯ä¸»å‡½æ•°mainä¸­æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œä¼šè®¾ç½®ä¸­æ–­ä¼˜å…ˆçº§ï¼Œå°†æ—¶é’Ÿæºé€‰ä¸º16Mçš„HSIã€‚æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°å®ƒè¿˜è°ƒç”¨äº†HAL_InitTick()å‡½æ•°ï¼Œå®ƒçš„è¾“å…¥å‚æ•°æ˜¯ä¸­æ–­ä¼˜å…ˆçº§ï¼Œå‡½æ•°ä½œç”¨æ˜¯åˆå§‹åŒ–Systickå¹¶é…ç½®1msä¸­æ–­ä¸€æ¬¡ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (INSTRUCTION_CACHE_ENABLE != 0)</span></span><br><span class="line">   __HAL_FLASH_INSTRUCTION_CACHE_ENABLE();</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (DATA_CACHE_ENABLE != 0)</span></span><br><span class="line">   __HAL_FLASH_DATA_CACHE_ENABLE();&lt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5.Systickæ»´ç­”å®šæ—¶å™¨åˆå§‹åŒ–ï¼ˆHALåº“ï¼‰&amp;æ— OSå»¶æ—¶å‡½æ•°</title>
      <link href="/2024/03/stm32-stm32-5-Systick%E6%BB%B4%E7%AD%94%E5%AE%9A%E6%97%B6%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%88HAL%E5%BA%93%EF%BC%89-%E6%97%A0OS%E5%BB%B6%E6%97%B6%E5%87%BD%E6%95%B0/"/>
      <url>/2024/03/stm32-stm32-5-Systick%E6%BB%B4%E7%AD%94%E5%AE%9A%E6%97%B6%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%88HAL%E5%BA%93%EF%BC%89-%E6%97%A0OS%E5%BB%B6%E6%97%B6%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h4 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h4><ul><li><a href="#1systick-1">1.Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹</a></li><li><a href="#2systick-3">2.Systickä¸»è¦å¯„å­˜å™¨</a></li><li><a href="#3systick-9">3.Systickä¸­æ–­ä¼˜å…ˆçº§</a></li><li><a href="#4systick-13">4.Systickåˆå§‹åŒ–æµç¨‹</a></li><li><a href="#5os-108">5.æ— OSå»¶æ—¶å‡½æ•°</a></li></ul><h2 id="1-Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹"><a href="#1-Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹" class="headerlink" title="1.Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹"></a>1.Systickæ»´ç­”å®šæ—¶å™¨ç®€ä»‹</h2><p>SysTickæ˜¯å±äºCM4å†…æ ¸ä¸­çš„å¤–è®¾ï¼Œå…¶å¯„å­˜å™¨çš„å®šä¹‰å’Œéƒ¨åˆ†åº“å‡½æ•°éƒ½åœ¨core_cm4.hä¸­å®ç°ã€‚Systickæ˜¯ä¸€ä¸ª24bitçš„å‘ä¸‹é€’å‡çš„è®¡æ•°å™¨ï¼Œä¸€èˆ¬è®¾ç½®å…¶æ—¶é’Ÿç­‰äºSYSCLKçš„180Mï¼ˆå¦ä¸€ä¸ªé€‰æ‹©æ˜¯HCLK&#x2F;8ï¼‰ã€‚å½“é‡è£…è½½æ•°å€¼å¯„å­˜å™¨çš„å€¼é€’å‡åˆ°0çš„æ—¶å€™ï¼Œç³»ç»Ÿå®šæ—¶å™¨å°±äº§ç”Ÿä¸€æ¬¡ä¸­æ–­ï¼Œä»¥æ­¤å¾ªç¯å¾€å¤ã€‚åŸºäºCM4å†…æ ¸çš„MCUéƒ½æœ‰è¿™ä¸ªç³»ç»Ÿå®šæ—¶å™¨ï¼Œä½¿å¾—è½¯ä»¶åœ¨CM4 å•ç‰‡æœºä¸­å¯ä»¥å¾ˆå®¹æ˜“çš„ç§»æ¤ã€‚å› æ­¤å®ƒä¸€èˆ¬ç”¨äºRTOSï¼Œç”¨äºäº§ç”Ÿæ—¶åŸºï¼Œç»´æŒæ“ä½œç³»ç»Ÿçš„å¿ƒè·³ã€‚Systickç”¨äºRTOSçš„æ€»ç»“æˆ‘æ‰“ç®—ä»¥åå†™UCOSåšå®¢çš„æ—¶å€™æ€»ç»“ï¼Œè¿™ç¯‡åšå®¢ä¸»è¦ä»‹ç»æ— OSæ—¶ï¼ŒSystickåˆå§‹åŒ–è¿‡ç¨‹å’Œå»¶æ—¶å‡½æ•°ä½¿ç”¨æ–¹æ³•ã€‚</p><h2 id="2-Systickä¸»è¦å¯„å­˜å™¨"><a href="#2-Systickä¸»è¦å¯„å­˜å™¨" class="headerlink" title="2.Systickä¸»è¦å¯„å­˜å™¨"></a>2.Systickä¸»è¦å¯„å­˜å™¨</h2><p><img src="https://img-blog.csdnimg.cn/20200404233234532.png"><br><strong>æ§åˆ¶å¯„å­˜å™¨ï¼š</strong> CLKSOURCEç”¨äºé€‰æ‹©æ—¶é’Ÿæºï¼Œä¸€èˆ¬ä¼šé€‰æ‹©å¤„ç†å™¨æ—¶é’Ÿï¼›ENABLEä½ç”¨äºä½¿èƒ½Systickï¼›TICKINTä½ç½®1ä¼šå¼€å¯Systickä¸­æ–­ã€‚<br><img src="https://img-blog.csdnimg.cn/20200404233348124.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTg5ODgwNA==,size_1,color_FFFFFF,t_1"><br><strong>é‡è£…è½½å€¼å¯„å­˜å™¨ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20200404234149713.png"></p><h2 id="3-Systickä¸­æ–­ä¼˜å…ˆçº§"><a href="#3-Systickä¸­æ–­ä¼˜å…ˆçº§" class="headerlink" title=";  3.Systickä¸­æ–­ä¼˜å…ˆçº§"></a><a name="3systick_9">;</a>  3.Systickä¸­æ–­ä¼˜å…ˆçº§</h2><p>SysTickå±äºå†…æ ¸å¤–è®¾ï¼Œå’Œæ™®é€šå¤–è®¾çš„ä¸­æ–­ä¼˜å…ˆçº§ä¸åŒï¼Œæ²¡æœ‰æŠ¢å ä¼˜å…ˆçº§å’Œå“åº”ä¼˜å…ˆçº§çš„è¯´æ³•ã€‚åœ¨F429 ä¸­ï¼Œå†…æ ¸å¤–è®¾çš„ä¸­æ–­ä¼˜å…ˆçº§ç”±å†…æ ¸SCBçš„å¤–è®¾çš„å¯„å­˜å™¨SHPRxï¼ˆx&#x3D;1.2.3ï¼‰é…ç½®ã€‚SPRH1-SPRH3æ˜¯32ä½çš„å¯„å­˜å™¨ï¼Œåªèƒ½é€šè¿‡å­—èŠ‚è®¿é—®ï¼Œæ¯ 8ä¸ªå­—æ®µæ§åˆ¶ç€ä¸€ä¸ªå†…æ ¸å¤–è®¾çš„ä¸­æ–­ä¼˜å…ˆçº§çš„é…ç½®ã€‚åœ¨F429 ä¸­åªæœ‰ä½ 7:3 è¿™é«˜å››ä½æœ‰æ•ˆï¼Œæ‰€ä»¥å†…æ ¸å¤–è®¾çš„ä¸­æ–­ä¼˜å…ˆçº§å¯ç¼–ç¨‹ä¸ºï¼š0~15ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚<br><img src="https://img-blog.csdnimg.cn/20200405093144981.png"><br><img src="https://img-blog.csdnimg.cn/20200405093414919.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTg5ODgwNA==,size_1,color_FFFFFF,t_1"></p><h2 id="4-Systickåˆå§‹åŒ–æµç¨‹"><a href="#4-Systickåˆå§‹åŒ–æµç¨‹" class="headerlink" title="4.Systickåˆå§‹åŒ–æµç¨‹"></a>4.Systickåˆå§‹åŒ–æµç¨‹</h2><ol><li>HAL_Init()æ˜¯ä¸»å‡½æ•°mainä¸­æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œä¼šè®¾ç½®ä¸­æ–­ä¼˜å…ˆçº§ï¼Œå°†æ—¶é’Ÿæºé€‰ä¸º16Mçš„HSIã€‚æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°å®ƒè¿˜è°ƒç”¨äº†HAL_InitTick()å‡½æ•°ï¼Œå®ƒçš„è¾“å…¥å‚æ•°æ˜¯ä¸­æ–­ä¼˜å…ˆçº§ï¼Œå‡½æ•°ä½œç”¨æ˜¯åˆå§‹åŒ–Systickå¹¶é…ç½®1msä¸­æ–­ä¸€æ¬¡ã€‚</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (INSTRUCTION_CACHE_ENABLE != 0)</span></span><br><span class="line">   __HAL_FLASH_INSTRUCTION_CACHE_ENABLE();</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (DATA_CACHE_ENABLE != 0)</span></span><br><span class="line">   __HAL_FLASH_DATA_CACHE_ENABLE();&lt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32camç³»åˆ—æ•™ç¨‹002ï¼šESP32camé€šè¿‡MQTTåè®®ä¸Šä¼ å›¾ç‰‡æ•°æ®åˆ°é˜¿é‡Œäº‘IOTå¹³å° - å·§é‡äººç”Ÿ - åšå®¢å›­</title>
      <link href="/2024/03/ESP32-ESP32cam%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B002%EF%BC%9AESP32cam%E9%80%9A%E8%BF%87MQTT%E5%8D%8F%E8%AE%AE%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91IOT%E5%B9%B3%E5%8F%B0-%E5%B7%A7%E9%81%87%E4%BA%BA%E7%94%9F-%E5%8D%9A%E5%AE%A2%E5%9B%AD/"/>
      <url>/2024/03/ESP32-ESP32cam%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B002%EF%BC%9AESP32cam%E9%80%9A%E8%BF%87MQTT%E5%8D%8F%E8%AE%AE%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91IOT%E5%B9%B3%E5%8F%B0-%E5%B7%A7%E9%81%87%E4%BA%BA%E7%94%9F-%E5%8D%9A%E5%AE%A2%E5%9B%AD/</url>
      
        <content type="html"><![CDATA[<p>@</p><ul><li><a href="#1-esp32cam%E9%80%9A%E8%BF%87mqtt%E5%8D%8F%E8%AE%AE%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E5%B9%B3%E5%8F%B0">1. ESP32camé€šè¿‡MQTTåè®®ä¸Šä¼ å›¾ç‰‡æ•°æ®åˆ°é˜¿é‡Œäº‘å¹³å°</a><ul><li><a href="#11-%E9%98%BF%E9%87%8C%E4%BA%91%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE">1.1 é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®</a></li><li><a href="#12-esp32cam-%E9%80%9A%E8%BF%87-mqtt-%E5%8D%8F%E8%AE%AE%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91iot%E5%B9%B3%E5%8F%B0">1.2 esp32cam é€šè¿‡ mqtt åè®®ä¸Šä¼ å›¾ç‰‡åˆ°é˜¿é‡Œäº‘IOTå¹³å°</a></li></ul></li><li><a href="#2-%E4%BB%8E%E9%98%BF%E9%87%8C%E4%BA%91iot%E5%B9%B3%E5%8F%B0%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E5%B9%B6%E4%BF%9D%E5%AD%98%E5%88%B0%E6%9C%AC%E5%9C%B0">2. ä»é˜¿é‡Œäº‘IOTå¹³å°è·å–å›¾ç‰‡æ•°æ®å¹¶ä¿å­˜åˆ°æœ¬åœ°</a><ul><li><a href="#21-%E9%98%BF%E9%87%8C%E4%BA%91%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE">2.1 é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®</a></li><li><a href="#22-%E5%B0%86%E9%98%BF%E9%87%8C%E4%BA%91%E5%B9%B3%E5%8F%B0%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E9%80%9A%E8%BF%87amqp%E5%AE%9E%E6%97%B6%E6%8B%89%E5%8F%96%E5%88%B0%E6%9C%AC%E5%9C%B0">2.2 å°†é˜¿é‡Œäº‘å¹³å°ä¸­çš„æ•°æ®é€šè¿‡AMQPå®æ—¶æ‹‰å–åˆ°æœ¬åœ°</a><ul><li><a href="#221-nodejs-%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E4%BA%91%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE">2.2.1 Node.js è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®</a></li><li><a href="#222-python-%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E4%BA%91%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E4%BB%85%E4%BE%9B%E5%8F%82%E8%80%83">2.2.2 Python è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®ï¼ˆä»…ä¾›å‚è€ƒï¼‰</a></li></ul></li></ul></li></ul><h1 id="1-ESP32camé€šè¿‡MQTTåè®®ä¸Šä¼ å›¾ç‰‡æ•°æ®åˆ°é˜¿é‡Œäº‘å¹³å°"><a href="#1-ESP32camé€šè¿‡MQTTåè®®ä¸Šä¼ å›¾ç‰‡æ•°æ®åˆ°é˜¿é‡Œäº‘å¹³å°" class="headerlink" title="1. ESP32camé€šè¿‡MQTTåè®®ä¸Šä¼ å›¾ç‰‡æ•°æ®åˆ°é˜¿é‡Œäº‘å¹³å°"></a>1. ESP32camé€šè¿‡MQTTåè®®ä¸Šä¼ å›¾ç‰‡æ•°æ®åˆ°é˜¿é‡Œäº‘å¹³å°</h1><h2 id="1-1-é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®"><a href="#1-1-é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®" class="headerlink" title="1.1 é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®"></a>1.1 é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®</h2><ol><li>è¿›å…¥é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°åˆ›å»ºå…¬å…±å®ä¾‹<br>é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç½‘å€ï¼š<a href="https://iot.console.aliyun.com/">https://iot.console.aliyun.com/</a></li></ol><p><img src="https://img-blog.csdnimg.cn/img_convert/6c412b90a973e23d4fe84014f18203b7.png"></p><p>é€‰æ‹© åä¸œ2ï¼ˆä¸Šæµ·ï¼‰èŠ‚ç‚¹ï¼Œå¼€é€šå…¬å…±å®ä¾‹ã€‚</p><ol><li>åˆ›å»ºäº§å“ä¸è®¾å¤‡</li></ol><ul><li>åˆ›å»ºäº§å“ï¼š<br><img src="https://img-blog.csdnimg.cn/img_convert/d12514d43501488585c89df33d1ffffc.png"></li><li>åœ¨äº§å“ä¸­çš„åŠŸèƒ½å®šä¹‰ä¸­åˆ›å»ºåŠŸèƒ½æ¨¡å—ç”¨æ¥å­˜å‚¨å›¾ç‰‡æ–‡æœ¬ï¼š<br><img src="https://img-blog.csdnimg.cn/img_convert/68123aa0e93845935f1ee43a9b6fa3b0.png"></li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/0611112fedaff4c705362d581788f27d.png"></p><ul><li>åˆ›å»ºè®¾å¤‡ï¼š<br><img src="https://img-blog.csdnimg.cn/img_convert/4d36e491d54471368ace116dfddffa55.png"></li><li>åœ¨è®¾å¤‡çš„ç‰©æ¨¡å‹æ•°æ®ä¸­å°±æœ‰ img çš„æ¨¡å—ï¼š<br><img src="https://img-blog.csdnimg.cn/img_convert/778ae787e98b8a5c4b8d91e67f6423f6.png"></li></ul><p>è‡ªæ­¤ï¼Œé˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°çš„å‡†å¤‡å·¥ä½œå°±å·²å…¨éƒ¨å®Œæˆã€‚</p><h2 id="1-2-esp32cam-é€šè¿‡-mqtt-åè®®ä¸Šä¼ å›¾ç‰‡åˆ°é˜¿é‡Œäº‘IOTå¹³å°"><a href="#1-2-esp32cam-é€šè¿‡-mqtt-åè®®ä¸Šä¼ å›¾ç‰‡åˆ°é˜¿é‡Œäº‘IOTå¹³å°" class="headerlink" title="1.2 esp32cam é€šè¿‡ mqtt åè®®ä¸Šä¼ å›¾ç‰‡åˆ°é˜¿é‡Œäº‘IOTå¹³å°"></a>1.2 esp32cam é€šè¿‡ mqtt åè®®ä¸Šä¼ å›¾ç‰‡åˆ°é˜¿é‡Œäº‘IOTå¹³å°</h2><blockquote><p>æ³¨ï¼šæœ¬äººä½¿ç”¨ Arduino IDE å¼€å‘ ESP32cam ç¨‹åºï¼Œå¦‚ä½•ä½¿ç”¨ Arduino IDE å¼€å‘ ESP32 ç¨‹åºè¯·å‚è€ƒæœ¬äººå…¶ä»–åšå®¢ã€‚<a href="https://blog.gitnote.cn/post/esp32cam_001/">åšå®¢ï¼šArduino é…ç½® ESP32 å¼€å‘ç¯å¢ƒ</a></p></blockquote><p>åœ¨ Arduino IDE ä¸­æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œéœ€è¦æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><ul><li>send_img_aliyun.ino</li><li>aliyunmqtt.cpp</li><li>aliyunmqtt.h<br>å…¶ä¸­ <code>send_img_aliyun.ino</code> ä¸ºä¸Šä¼ å›¾ç‰‡æ•°æ®åˆ°é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°çš„ä¸»ç¨‹åºï¼Œ <code>aliyunmqtt.cpp</code> ä¸ <code>aliyunmqtt.h</code> æ˜¯è¿æ¥é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°çš„æ ¡éªŒç¨‹åºã€‚</li></ul><p>ä»…éœ€ä¿®æ”¹ <code>send_img_aliyun.ino</code> ä¸­ WIFI è´¦å·ä¸å¯†ç  å’Œ é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ä¸‰å…ƒç»„ï¼ˆè§ä¸‹å›¾ï¼‰å³å¯ï¼Œ <code>aliyunmqtt.cpp</code> ä¸ <code>aliyunmqtt.h</code> æ–‡ä»¶æ— éœ€ä¿®æ”¹ä»»ä½•å†…å®¹ã€‚ç”±äº ESP32cam æ€§èƒ½é—®é¢˜ï¼Œ <code>send_img_aliyun.ino</code> ä¸­å°†ä¸€ä¸ªå›¾ç‰‡åˆ†ä¸ºå¤šæ®µè¿›è¡Œä¼ è¾“ï¼Œæ¯æ®µä¸º 800ï¼Œè¯¦è§ä»£ç ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/7e39e1cc37cca0312f027a75fcca6166.png"></p><p>è¿™é‡Œç›´æ¥ç»™å‡ºä»£ç ï¼š</p><blockquote><p><code>send_img_aliyun.ino</code> :</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// send_img_aliyun.ino</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #include &quot;aliyun_mqtt.h&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;aliyunmqtt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_camera.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;FS.h&quot;</span>                <span class="comment">// SD Card ESP32</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;SD_MMC.h&quot;</span>            <span class="comment">// SD Card ESP32</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;soc/soc.h&quot;</span>           <span class="comment">// Disable brownour problems</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;soc/rtc_cntl_reg.h&quot;</span>  <span class="comment">// Disable brownour problems</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;driver/rtc_io.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…å­˜å­˜å‚¨ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EEPROM_SIZE 1</span></span><br><span class="line"><span class="type">int</span> pictureNumber = <span class="number">0</span>;</span><br><span class="line">String msg;</span><br><span class="line"><span class="type">int</span> buttonState = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> btnHold = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// #define SENSOR_PIN 10</span></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¿¡æ¯éœ€è¦è‡ªå·±ä¿®æ”¹</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIFI_SSID <span class="string">&quot;TP-LINK_1760&quot;</span>  <span class="comment">//æ›¿æ¢è‡ªå·±çš„WIFI</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> WIFI_PASSWD <span class="string">&quot;987654321&quot;</span>   <span class="comment">//æ›¿æ¢è‡ªå·±çš„WIFIå¯†ç </span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é˜¿é‡Œäº‘ç‰©è”ç½‘ ä¸‰å…ƒç»„</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRODUCT_KEY <span class="string">&quot;k0xxxxxIM&quot;</span>                         <span class="comment">//æ›¿æ¢è‡ªå·±çš„PRODUCT_KEY</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEVICE_NAME <span class="string">&quot;esp001_001&quot;</span>                       <span class="comment">//æ›¿æ¢è‡ªå·±çš„DEVICE_NAME</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEVICE_SECRET <span class="string">&quot;589xxxxxxxxxxxxxxxxxxxe0f&quot;</span>  <span class="comment">//æ›¿æ¢è‡ªå·±çš„DEVICE_SECRET \</span></span></span><br><span class="line"><span class="comment"><span class="meta"></span></span></span><br><span class="line"><span class="comment">//ä»¥ä¸‹ä¸éœ€ä¿®æ”¹</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALINK_BODY_FORMAT <span class="string">&quot;&#123;\&quot;id\&quot;:\&quot;123\&quot;,\&quot;version\&quot;:\&quot;1.0\&quot;,\&quot;method\&quot;:\&quot;%s\&quot;,\&quot;params\&quot;:%s&#125;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALINK_TOPIC_PROP_POST <span class="string">&quot;/sys/&quot;</span> PRODUCT_KEY <span class="string">&quot;/&quot;</span> DEVICE_NAME <span class="string">&quot;/thing/event/property/post&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALINK_TOPIC_PROP_POSTRSP <span class="string">&quot;/sys/&quot;</span> PRODUCT_KEY <span class="string">&quot;/&quot;</span> DEVICE_NAME <span class="string">&quot;/thing/event/property/post_reply&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALINK_TOPIC_PROP_SET <span class="string">&quot;/sys/&quot;</span> PRODUCT_KEY <span class="string">&quot;/&quot;</span> DEVICE_NAME <span class="string">&quot;/thing/service/property/set&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALINK_METHOD_PROP_POST <span class="string">&quot;thing.event.property.post&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALINK_TOPIC_DEV_INFO <span class="string">&quot;/ota/device/inform/&quot;</span> PRODUCT_KEY <span class="string">&quot;/&quot;</span> DEVICE_NAME <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ALINK_VERSION_FROMA <span class="string">&quot;&#123;\&quot;id\&quot;: 123,\&quot;params\&quot;: &#123;\&quot;version\&quot;: \&quot;%s\&quot;&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> lastMs = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// æµ‹è¯• åˆå§‹æ¸©åº¦</span></span><br><span class="line"><span class="type">int</span> i = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line">WiFiClient espClient;</span><br><span class="line"><span class="function">PubSubClient <span class="title">mqttClient</span><span class="params">(espClient)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//CAMERA_MODEL_AI_THINKERç±»å‹æ‘„åƒå¤´çš„å¼•è„šå®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PWDN_GPIO_NUM 32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RESET_GPIO_NUM -1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> XCLK_GPIO_NUM 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SIOD_GPIO_NUM 26</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SIOC_GPIO_NUM 27</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Y9_GPIO_NUM 35</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Y8_GPIO_NUM 34</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Y7_GPIO_NUM 39</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Y6_GPIO_NUM 36</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Y5_GPIO_NUM 21</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Y4_GPIO_NUM 19</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Y3_GPIO_NUM 18</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Y2_GPIO_NUM 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VSYNC_GPIO_NUM 25</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HREF_GPIO_NUM 23</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCLK_GPIO_NUM 22</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">camera_config_t</span> camera_config = &#123;</span><br><span class="line">  .pin_pwdn = PWDN_GPIO_NUM,</span><br><span class="line">  .pin_reset = RESET_GPIO_NUM,</span><br><span class="line">  .pin_xclk = XCLK_GPIO_NUM,</span><br><span class="line">  .pin_sscb_sda = SIOD_GPIO_NUM,</span><br><span class="line">  .pin_sscb_scl = SIOC_GPIO_NUM,</span><br><span class="line"></span><br><span class="line">  .pin_d7 = Y9_GPIO_NUM,</span><br><span class="line">  .pin_d6 = Y8_GPIO_NUM,</span><br><span class="line">  .pin_d5 = Y7_GPIO_NUM,</span><br><span class="line">  .pin_d4 = Y6_GPIO_NUM,</span><br><span class="line">  .pin_d3 = Y5_GPIO_NUM,</span><br><span class="line">  .pin_d2 = Y4_GPIO_NUM,</span><br><span class="line">  .pin_d1 = Y3_GPIO_NUM,</span><br><span class="line">  .pin_d0 = Y2_GPIO_NUM,</span><br><span class="line">  .pin_vsync = VSYNC_GPIO_NUM,</span><br><span class="line">  .pin_href = HREF_GPIO_NUM,</span><br><span class="line">  .pin_pclk = PCLK_GPIO_NUM,</span><br><span class="line"></span><br><span class="line">  .xclk_freq_hz = <span class="number">20000000</span>,</span><br><span class="line">  .ledc_timer = LEDC_TIMER_0,</span><br><span class="line">  .ledc_channel = LEDC_CHANNEL_0,</span><br><span class="line"></span><br><span class="line">  .pixel_format = PIXFORMAT_JPEG,</span><br><span class="line">  <span class="comment">// .frame_size = FRAMESIZE_VGA,</span></span><br><span class="line">  <span class="comment">// FRAMESIZE_UXGA (1600 x 1200)</span></span><br><span class="line">  <span class="comment">// FRAMESIZE_QVGA (320 x 240)</span></span><br><span class="line">  <span class="comment">// FRAMESIZE_CIF (352 x 288)</span></span><br><span class="line">  <span class="comment">// FRAMESIZE_VGA (640 x 480)</span></span><br><span class="line">  <span class="comment">// FRAMESIZE_SVGA (800 x 600)</span></span><br><span class="line">  <span class="comment">// FRAMESIZE_XGA (1024 x 768)</span></span><br><span class="line">  <span class="comment">// FRAMESIZE_SXGA (1280 x 1024)</span></span><br><span class="line">  .frame_size = FRAMESIZE_QVGA,</span><br><span class="line">  .jpeg_quality = <span class="number">10</span>,</span><br><span class="line">  <span class="comment">// å›¾åƒè´¨é‡ï¼ˆjpeg_quality) å¯ä»¥æ˜¯ 0 åˆ° 63 ä¹‹é—´çš„æ•°å­—ã€‚æ•°å­—è¶Šå°æ„å‘³ç€è´¨é‡è¶Šé«˜</span></span><br><span class="line">  .fb_count = <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init_wifi</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *ssid, <span class="type">const</span> <span class="type">char</span> *password)</span> </span>&#123;</span><br><span class="line">  WiFi.<span class="built_in">mode</span>(WIFI_STA);</span><br><span class="line">  WiFi.<span class="built_in">begin</span>(ssid, password);</span><br><span class="line">  <span class="keyword">while</span> (WiFi.<span class="built_in">status</span>() != WL_CONNECTED) &#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;WiFi does not connect, try again ...&quot;</span>);</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;Wifi is connected.&quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">println</span>(WiFi.<span class="built_in">localIP</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mqtt_callback</span><span class="params">(<span class="type">char</span> *topic, byte *payload, <span class="type">unsigned</span> <span class="type">int</span> length)</span> </span>&#123;</span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;Message arrived [&quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">print</span>(topic);</span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;] &quot;</span>);</span><br><span class="line">  payload[length] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">  Serial.<span class="built_in">println</span>((<span class="type">char</span> *)payload);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strstr</span>(topic, ALINK_TOPIC_PROP_SET)) &#123;</span><br><span class="line">    StaticJsonBuffer jsonBuffer;</span><br><span class="line">    JsonObject &amp;root = jsonBuffer.<span class="built_in">parseObject</span>(payload);</span><br><span class="line">    <span class="keyword">if</span> (!root.<span class="built_in">success</span>()) &#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;parseObject() failed&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mqtt_check_connect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (!mqttClient.<span class="built_in">connected</span>())  <span class="comment">//</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">connect_aliyun_mqtt</span>(mqttClient, PRODUCT_KEY, DEVICE_NAME, DEVICE_SECRET)) &#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;MQTT connect succeed!&quot;</span>);</span><br><span class="line">      <span class="comment">//client.subscribe(ALINK_TOPIC_PROP_POSTRSP);</span></span><br><span class="line">      mqttClient.<span class="built_in">subscribe</span>(ALINK_TOPIC_PROP_SET);</span><br><span class="line"></span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;subscribe done&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mqtt_interval_post</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//  static int i=0;</span></span><br><span class="line">  <span class="type">char</span> param[<span class="number">512</span>];</span><br><span class="line">  <span class="type">char</span> jsonBuf[<span class="number">1024</span>];</span><br><span class="line">  <span class="built_in">sprintf</span>(jsonBuf, <span class="string">&quot;&#123;\&quot;id\&quot;:\&quot;1189401707\&quot;,\&quot;version\&quot;:\&quot;1.0.0\&quot;,\&quot;method\&quot;:\&quot;%s\&quot;,\&quot;params\&quot;:&#123;\&quot;img\&quot;:\&quot;END\&quot;&#125;&#125;&quot;</span>);</span><br><span class="line">  Serial.<span class="built_in">println</span>(jsonBuf);</span><br><span class="line">  mqttClient.<span class="built_in">publish</span>(ALINK_TOPIC_PROP_POST, jsonBuf);</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;å‘é€ç»“æŸç¬¦&quot;</span>);</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‘„åƒå¤´ã€SDå¡ä¸ SPIFFS åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="type">esp_err_t</span> <span class="title">camera_init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//initialize the camera</span></span><br><span class="line">  <span class="type">esp_err_t</span> err = <span class="built_in">esp_camera_init</span>(&amp;camera_config);</span><br><span class="line">  <span class="keyword">if</span> (err != ESP_OK) &#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Camera Init Failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">sensor_t</span> *s = <span class="built_in">esp_camera_sensor_get</span>();</span><br><span class="line">  <span class="comment">//initial sensors are flipped vertically and colors are a bit saturated</span></span><br><span class="line">  <span class="keyword">if</span> (s-&gt;id.PID == OV2640_PID) &#123;</span><br><span class="line">    <span class="comment">//        s-&gt;set_vflip(s, 1);//flip it back</span></span><br><span class="line">    <span class="comment">//        s-&gt;set_brightness(s, 1);//up the blightness just a bit</span></span><br><span class="line">    <span class="comment">//        s-&gt;set_contrast(s, 1);</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;Camera Init OK!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> ESP_OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sd_init</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//SD card init</span></span><br><span class="line">  <span class="keyword">if</span> (!SD_MMC.<span class="built_in">begin</span>()) &#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;Card Mount Failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">uint8_t</span> cardType = SD_MMC.<span class="built_in">cardType</span>();</span><br><span class="line">  <span class="keyword">if</span> (cardType == CARD_NONE) &#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;No SD_MMC card attached&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SPIFFS_init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//åˆå§‹åŒ–SPIFFS</span></span><br><span class="line">  <span class="keyword">if</span> (!SPIFFS.<span class="built_in">begin</span>(<span class="literal">true</span>)) &#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;An Error has occurred while mounting SPIFFS&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;SPIFFS mounted successfully&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//Turn-off the &#x27;brownout detector&#x27;</span></span><br><span class="line">  <span class="built_in">WRITE_PERI_REG</span>(RTC_CNTL_BROWN_OUT_REG, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‘„åƒå¤´ã€SDå¡ä¸ SPIFFS åˆå§‹åŒ– end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;ç¨‹åº Start&quot;</span>);</span><br><span class="line">  <span class="built_in">init_wifi</span>(WIFI_SSID, WIFI_PASSWD);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">camera_init</span>();</span><br><span class="line">  <span class="built_in">sd_init</span>();</span><br><span class="line">  <span class="built_in">SPIFFS_init</span>();</span><br><span class="line"></span><br><span class="line">  mqttClient.<span class="built_in">setCallback</span>(mqtt_callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the loop function runs over and over again forever</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¨‹åºå¼€å§‹æ‹ç…§å¹¶ä¿å­˜</span></span><br><span class="line">  Serial.<span class="built_in">print</span>(<span class="string">&quot;è¿›è¡Œæ‹ç…§\n&quot;</span>);</span><br><span class="line">  <span class="type">camera_fb_t</span> *fb = <span class="built_in">esp_camera_fb_get</span>();</span><br><span class="line">  <span class="keyword">if</span> (!fb) &#123;</span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;Camera capture failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    EEPROM.<span class="built_in">begin</span>(EEPROM_SIZE);</span><br><span class="line">    pictureNumber = EEPROM.<span class="built_in">read</span>(<span class="number">0</span>) + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// Path where new picture will be saved in SD Card</span></span><br><span class="line">    String path = <span class="string">&quot;/picture&quot;</span> + <span class="built_in">String</span>(pictureNumber) + <span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">    fs::FS &amp;fs = SD_MMC;</span><br><span class="line">    Serial.<span class="built_in">printf</span>(<span class="string">&quot;æ–‡ä»¶åå­—: %s\n&quot;</span>, path.<span class="built_in">c_str</span>());</span><br><span class="line">    File file = fs.<span class="built_in">open</span>(path.<span class="built_in">c_str</span>(), FILE_WRITE);</span><br><span class="line">    <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">      Serial.<span class="built_in">println</span>(<span class="string">&quot;Failed to open file in writing mode&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      file.<span class="built_in">write</span>(fb-&gt;buf, fb-&gt;len);  <span class="comment">// payload (image), payload length</span></span><br><span class="line">      Serial.<span class="built_in">println</span>(fb-&gt;len);</span><br><span class="line">      Serial.<span class="built_in">print</span>(<span class="string">&quot;æŠ“æ‹æˆåŠŸå¹¶ä¿å­˜\n&quot;</span>);</span><br><span class="line">      Serial.<span class="built_in">printf</span>(<span class="string">&quot;ä¿å­˜è·¯å¾„: %s\n\n&quot;</span>, path.<span class="built_in">c_str</span>());</span><br><span class="line">      EEPROM.<span class="built_in">write</span>(<span class="number">0</span>, pictureNumber);</span><br><span class="line">      EEPROM.<span class="built_in">commit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String a1 = <span class="string">&quot;&#123;\&quot;id\&quot;:\&quot;1189401707\&quot;,\&quot;version\&quot;:\&quot;1.0.0\&quot;,\&quot;method\&quot;:\&quot;123\&quot;,\&quot;params\&quot;:&#123;\&quot;img\&quot;:\&quot;&quot;</span>;</span><br><span class="line">    String a2;</span><br><span class="line">    String a3 = <span class="string">&quot;\&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">    <span class="type">char</span> data[<span class="number">4104</span>];</span><br><span class="line">    <span class="comment">// å°†å›¾ç‰‡åˆ†ä¸ºä¸è¶…è¿‡ 800 é€šè¿‡ MQTT å‘é€å‡ºå»</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; fb-&gt;len; i++) &#123;</span><br><span class="line">      <span class="built_in">sprintf</span>(data, <span class="string">&quot;%02X&quot;</span>, *(fb-&gt;buf + i));</span><br><span class="line">      a2 += data;</span><br><span class="line">      <span class="keyword">if</span> (a2.<span class="built_in">length</span>() == <span class="number">800</span>) &#123;</span><br><span class="line">        String a4 = a1 + a2;</span><br><span class="line">        String a = a4 + a3;</span><br><span class="line">        <span class="type">char</span> jsonBuf[a.<span class="built_in">length</span>() + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">length</span>(); i++)</span><br><span class="line">          jsonBuf[i] = a[i];</span><br><span class="line">        jsonBuf[a.<span class="built_in">length</span>()] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        Serial.<span class="built_in">println</span>(jsonBuf);</span><br><span class="line">        mqttClient.<span class="built_in">publish</span>(ALINK_TOPIC_PROP_POST, jsonBuf);</span><br><span class="line">        a2 = <span class="string">&quot;&quot;</span>, a = <span class="string">&quot;&quot;</span>, a4 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">// ms</span></span><br><span class="line">        <span class="built_in">delay</span>(<span class="number">200</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (a2.<span class="built_in">length</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      String a4 = a1 + a2;</span><br><span class="line">      String a = a4 + a3;</span><br><span class="line">      <span class="type">char</span> jsonBuf[a.<span class="built_in">length</span>() + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">length</span>(); i++)</span><br><span class="line">        jsonBuf[i] = a[i];</span><br><span class="line">      jsonBuf[a.<span class="built_in">length</span>()] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">      Serial.<span class="built_in">println</span>(jsonBuf);</span><br><span class="line">      mqttClient.<span class="built_in">publish</span>(ALINK_TOPIC_PROP_POST, jsonBuf);</span><br><span class="line">      a2 = <span class="string">&quot;&quot;</span>, a = <span class="string">&quot;&quot;</span>, a4 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">// å°†å›¾ç‰‡åˆ†ä¸ºä¸è¶…è¿‡ 800 é€šè¿‡ MQTT å‘é€å‡ºå»  end</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="type">char</span> endBuf[<span class="number">100</span>];</span><br><span class="line">    <span class="built_in">sprintf</span>(endBuf, <span class="string">&quot;&#123;\&quot;id\&quot;:\&quot;1189401707\&quot;,\&quot;version\&quot;:\&quot;1.0.0\&quot;,\&quot;method\&quot;:\&quot;123\&quot;,\&quot;params\&quot;:&#123;\&quot;img\&quot;:\&quot;END\&quot;&#125;&#125;&quot;</span>);</span><br><span class="line">    Serial.<span class="built_in">println</span>(endBuf);</span><br><span class="line">    mqttClient.<span class="built_in">publish</span>(ALINK_TOPIC_PROP_POST, endBuf);</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;å‘é€ç»“æŸç¬¦&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;å›¾ç‰‡å‘é€å®Œæˆäº†......&quot;</span>);</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">  <span class="comment">// å›¾ç‰‡å‘é€ç»“æŸåå‘é€ END</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">millis</span>() - lastMs &gt;= <span class="number">10000</span>) &#123;</span><br><span class="line">    lastMs = <span class="built_in">millis</span>();</span><br><span class="line">    <span class="built_in">mqtt_check_connect</span>();</span><br><span class="line">    <span class="comment">// Post  interval é—´éš”</span></span><br><span class="line">    <span class="comment">// mqtt_interval_post();</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mqttClient.<span class="built_in">loop</span>();</span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> WAIT_MS = <span class="number">2000</span>;</span><br><span class="line">  <span class="built_in">delay</span>(WAIT_MS);  <span class="comment">// ms</span></span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="built_in">millis</span>() / WAIT_MS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>aliyunmqtt.h</code> :</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// aliyunmqtt.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  Aliyun_mqtt.h - Library for connect to Aliyun MQTT server with authentication by</span></span><br><span class="line"><span class="comment">  product key, device name and device secret.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  https://www.alibabacloud.com/help/product/30520.htm</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _ALIYUN_MATT_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _ALIYUN_MATT_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Arduino.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Connect to Alibaba Cloud MQTT server. In connection process, it will try several times for</span></span><br><span class="line"><span class="comment"> * possible network failure. For authentication issue, it will return false at once.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param mqttClient: Caller provide a valid PubSubClient object (initialized with network client).</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * @param productKey: Product Key, get from Alibaba Cloud Link Platform.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * @param deviceName: Device Name, get from Alibaba Cloud Link Platform.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * @param deviceSecret: Device Secret, get from Alibaba Cloud Link Platform.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param region: Optional region, use &quot;cn-shanghai&quot; as default. It can be &quot;us-west-1&quot;,</span></span><br><span class="line"><span class="comment"> *                &quot;ap-southeast-1&quot; etc. Refer to Alibaba Cloud Link Platform.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return true if connect succeed, otherwise false.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">bool</span> <span class="title">connect_aliyun_mqtt</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    PubSubClient &amp;mqttClient,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *productKey,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *deviceName,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *deviceSecret,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *region = <span class="string">&quot;cn-shanghai&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Two new added APIs are designed for devices with limited resource like Arduino UNO.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * Since it is hard to calculate HMAC256 on such devices, the calculation can be done externally.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * These two APIs should be used together with external HMAC256 calculation tools, e.g.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * http://tool.oschina.net/encrypt?type=2</span></span><br><span class="line"><span class="comment"> * They can be used together to replace connectAliyunMQTT on resource-limited devices.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This API should be called in setup() phase to init all MQTT parameters. Since HMAC256</span></span><br><span class="line"><span class="comment"> * calculation is executed extenrally, a fixed timestamp string should be provided, such</span></span><br><span class="line"><span class="comment"> * as &quot;23668&quot; etc. The same timestamp string is also used to calculate HMAC256 result.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Other params are similar to them in connectAliyunMQTT.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">mqtt_prepare</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *timestamp,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *productKey,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *deviceName,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *deviceSecret,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *region = <span class="string">&quot;cn-shanghai&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Use tools here to calculate HMAC256: http://tool.oschina.net/encrypt?type=2</span></span><br><span class="line"><span class="comment"> * The calculated result should be defined as constants and passed when call this function.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">bool</span> <span class="title">connect_aliyun_mqtt_With_password</span><span class="params">(PubSubClient &amp;mqttClient, <span class="type">const</span> <span class="type">char</span> *password)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><blockquote><p><code>aliyunmqtt.cpp</code></p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// aliyunmqtt.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  Aliyun_mqtt.h - Library for connect to Aliyun MQTT server.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #include &quot;aliyun_mqtt.h&quot;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;aliyunmqtt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MQTT_PORT 1883</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHA256HMAC_SIZE 32</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify tool: http://tool.oschina.net/encrypt?type=2</span></span><br><span class="line"><span class="function"><span class="type">static</span> String <span class="title">hmac256</span><span class="params">(<span class="type">const</span> String &amp;signcontent, <span class="type">const</span> String &amp;ds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  byte hashCode[SHA256HMAC_SIZE];</span><br><span class="line">  SHA256 sha256;</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *key = ds.<span class="built_in">c_str</span>();</span><br><span class="line">  <span class="type">size_t</span> keySize = ds.<span class="built_in">length</span>();</span><br><span class="line"></span><br><span class="line">  sha256.<span class="built_in">resetHMAC</span>(key, keySize);</span><br><span class="line">  sha256.<span class="built_in">update</span>((<span class="type">const</span> byte *)signcontent.<span class="built_in">c_str</span>(), signcontent.<span class="built_in">length</span>());</span><br><span class="line">  sha256.<span class="built_in">finalizeHMAC</span>(key, keySize, hashCode, <span class="built_in">sizeof</span>(hashCode));</span><br><span class="line"></span><br><span class="line">  String sign = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (byte i = <span class="number">0</span>; i &lt; SHA256HMAC_SIZE; ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    sign += <span class="string">&quot;0123456789ABCDEF&quot;</span>[hashCode[i] &gt;&gt; <span class="number">4</span>];</span><br><span class="line">    sign += <span class="string">&quot;0123456789ABCDEF&quot;</span>[hashCode[i] &amp; <span class="number">0xf</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> sign;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> String mqttBroker;</span><br><span class="line"><span class="type">static</span> String mqttClientID;</span><br><span class="line"><span class="type">static</span> String mqttUserName;</span><br><span class="line"><span class="type">static</span> String mqttPassword;</span><br><span class="line"></span><br><span class="line"><span class="comment">// call this function once</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mqtt_prepare</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *timestamp,<span class="type">const</span> <span class="type">char</span> *productKey, <span class="type">const</span> <span class="type">char</span> *deviceName,<span class="type">const</span> <span class="type">char</span> *deviceSecret,<span class="type">const</span> <span class="type">char</span> *region)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  mqttBroker = productKey;</span><br><span class="line">  mqttBroker += <span class="string">&quot;.iot-as-mqtt.&quot;</span>;</span><br><span class="line">  mqttBroker += <span class="built_in">String</span>(region);</span><br><span class="line">  mqttBroker += <span class="string">&quot;.aliyuncs.com&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Serial.println(mqttBroker);</span></span><br><span class="line"></span><br><span class="line">  mqttUserName = deviceName;</span><br><span class="line">  mqttUserName += <span class="string">&#x27;&amp;&#x27;</span>;</span><br><span class="line">  mqttUserName += productKey;</span><br><span class="line">   <span class="comment">//Serial.println(mqttUserName);</span></span><br><span class="line"></span><br><span class="line">  mqttClientID = deviceName; <span class="comment">// device name used as client ID</span></span><br><span class="line">  mqttClientID += <span class="string">&quot;|securemode=3,signmethod=hmacsha256,timestamp=&quot;</span>;</span><br><span class="line">  mqttClientID += timestamp;</span><br><span class="line">  mqttClientID += <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">   <span class="comment">//Serial.println(mqttClientID);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">connect_aliyun_mqtt_With_password</span><span class="params">(PubSubClient &amp;mqttClient, <span class="type">const</span> <span class="type">char</span> *password)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  mqttClient.<span class="built_in">setServer</span>(mqttBroker.<span class="built_in">c_str</span>(), MQTT_PORT);</span><br><span class="line"></span><br><span class="line">  byte mqttConnectTryCnt = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">while</span> (!mqttClient.<span class="built_in">connected</span>() &amp;&amp; mqttConnectTryCnt &gt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//Serial.println(&quot;Connecting to MQTT Server ...&quot;);</span></span><br><span class="line">    <span class="keyword">if</span> (mqttClient.<span class="built_in">connect</span>(mqttClientID.<span class="built_in">c_str</span>(), mqttUserName.<span class="built_in">c_str</span>(), password))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Serial.println(&quot;MQTT Connected!&quot;);</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      byte errCode = mqttClient.<span class="built_in">state</span>();</span><br><span class="line">      <span class="comment">//Serial.print(&quot;MQTT connect failed, error code:&quot;);</span></span><br><span class="line">      <span class="comment">//Serial.println(errCode);</span></span><br><span class="line">      <span class="keyword">if</span> (errCode == MQTT_CONNECT_BAD_PROTOCOL || errCode == MQTT_CONNECT_BAD_CLIENT_ID || errCode == MQTT_CONNECT_BAD_CREDENTIALS || errCode == MQTT_CONNECT_UNAUTHORIZED)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">//Serial.println(&quot;No need to try again.&quot;);</span></span><br><span class="line">        <span class="keyword">break</span>; <span class="comment">// No need to try again for these situation</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">delay</span>(<span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    mqttConnectTryCnt -= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">connect_aliyun_mqtt</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    PubSubClient &amp;mqttClient,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *productKey,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *deviceName,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *deviceSecret,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">char</span> *region)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  String timestamp = <span class="built_in">String</span>(<span class="built_in">millis</span>());</span><br><span class="line">  <span class="built_in">mqtt_prepare</span>(timestamp.<span class="built_in">c_str</span>(), productKey, deviceName, deviceSecret, region);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate MQTT Password, use deviceName as clientID</span></span><br><span class="line">  String signcontent = <span class="string">&quot;clientId&quot;</span>;</span><br><span class="line">  signcontent += deviceName;</span><br><span class="line">  signcontent += <span class="string">&quot;deviceName&quot;</span>;</span><br><span class="line">  signcontent += deviceName;</span><br><span class="line">  signcontent += <span class="string">&quot;productKey&quot;</span>;</span><br><span class="line">  signcontent += productKey;</span><br><span class="line">  signcontent += <span class="string">&quot;timestamp&quot;</span>;</span><br><span class="line">  signcontent += timestamp;</span><br><span class="line"></span><br><span class="line">  String mqttPassword = <span class="built_in">hmac256</span>(signcontent, deviceSecret);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//Serial.print(&quot;HMAC256 data: &quot;);</span></span><br><span class="line">   <span class="comment">//Serial.println(signcontent);</span></span><br><span class="line">   <span class="comment">//Serial.print(&quot;HMAC256 key: &quot;);</span></span><br><span class="line">  <span class="comment">// Serial.println(deviceSecret);</span></span><br><span class="line">  <span class="comment">// Serial.println(mqttPassword);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">connect_aliyun_mqtt_With_password</span>(mqttClient, mqttPassword.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºçƒ§å½•è¿è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š</p><ol><li>æœ¬åœ° Arduino IDE ä¸²å£æ˜¾ç¤ºå›¾ï¼š<br><img src="https://img-blog.csdnimg.cn/img_convert/7d29321b38f90d320016cac13767c44d.png"></li><li>ç‰©è”ç½‘å¹³å°ç‰©æ¨¡å‹å·²è·å–æ•°æ®ï¼š<br><img src="https://img-blog.csdnimg.cn/img_convert/2d2b188ef1cffc95ece51b5e01b8f642.png"></li></ol><blockquote><p>æ³¨æ„ï¼šè‹¥Arduino IDE ä¸²å£æ˜¾ç¤ºæ­£å¸¸ï¼Œè€Œç‰©è”ç½‘å¹³å°ä¸­æ²¡æœ‰è·å–åˆ°æ•°æ®ï¼Œè¯·æŸ¥çœ‹ é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å·¦ä¾§&gt;ç›‘æ§è¿ç»´&gt;æ—¥å¿—æœåŠ¡ï¼Œè‹¥æ—¥å¿—ä¸­å‡ºç°çŠ¶æ€ 460 é”™è¯¯ï¼Œè¯·è°ƒæ•´æœ¬åœ° Arduino IDE ä¸­å¼•ç”¨çš„ <code>PubSubClient.h</code> ä¸­çš„ä¸¤ä¸ªå‚æ•°ï¼š <code>MQTT_MAX_PACKET_SIZE</code> å’Œ <code>MQTT_KEEPLIVE</code> ,åˆ†åˆ«è°ƒæ•´ä¸ºå¤§äº <code>1024</code> å’Œå¤§äº <code>65</code> ï¼Œç„¶åé‡æ–°çƒ§å½• ESP32cam å³å¯è§£å†³ã€‚</p></blockquote><p>è‡ªæ­¤ï¼ŒESP32cam è·å–å›¾ç‰‡æ•°æ®å­˜æœ¬åœ°å†…å­˜å¡å¹¶é€šè¿‡ MQTT åè®®ä¸Šä¼ é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å·²å…¨éƒ¨å®Œæˆã€‚</p><h1 id="2-ä»é˜¿é‡Œäº‘IOTå¹³å°è·å–å›¾ç‰‡æ•°æ®å¹¶ä¿å­˜åˆ°æœ¬åœ°"><a href="#2-ä»é˜¿é‡Œäº‘IOTå¹³å°è·å–å›¾ç‰‡æ•°æ®å¹¶ä¿å­˜åˆ°æœ¬åœ°" class="headerlink" title="2. ä»é˜¿é‡Œäº‘IOTå¹³å°è·å–å›¾ç‰‡æ•°æ®å¹¶ä¿å­˜åˆ°æœ¬åœ°"></a>2. ä»é˜¿é‡Œäº‘IOTå¹³å°è·å–å›¾ç‰‡æ•°æ®å¹¶ä¿å­˜åˆ°æœ¬åœ°</h1><p>è™½ç„¶å›¾ç‰‡æ•°æ®å·²ç»ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ä¸­å­˜å‚¨ï¼Œä½†å¹³å°ä¸­å­˜å‚¨çš„åªæ˜¯å›¾ç‰‡çš„æ•°æ®ï¼Œè€Œéå›¾ç‰‡ï¼Œéœ€è¦å°†å›¾ç‰‡æ•°æ®è½¬æ¢æˆå›¾ç‰‡å¹¶åœ¨å…¶ä»–åœ°æ–¹å±•ç¤ºå‡ºæ¥ã€‚<br>äºæ˜¯éœ€è¦è¿›è¡Œä¸‹é¢æ“ä½œã€‚</p><h2 id="2-1-é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®"><a href="#2-1-é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®" class="headerlink" title="2.1 é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®"></a>2.1 é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ç›¸å…³é…ç½®</h2><p>éœ€è¦é…ç½® æ¶ˆæ¯è½¬å‘&gt;æœåŠ¡ç«¯è®¢é˜…ï¼š</p><p><img src="https://img-blog.csdnimg.cn/img_convert/0e76be033dd790934f7e5aad790b5d84.png"></p><p>æœ¬æ“ä½œå°±æ˜¯å°† ESP32cam ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°ä¸­çš„æ•°æ®è½¬å‘ä¸€ä»½åˆ°å¤„ç†ç«¯ï¼Œå¤„ç†ç«¯é€šè¿‡ AMQP è·å–æ•°æ®å¹¶è§£æè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</p><h2 id="2-2-å°†é˜¿é‡Œäº‘å¹³å°ä¸­çš„æ•°æ®é€šè¿‡AMQPå®æ—¶æ‹‰å–åˆ°æœ¬åœ°"><a href="#2-2-å°†é˜¿é‡Œäº‘å¹³å°ä¸­çš„æ•°æ®é€šè¿‡AMQPå®æ—¶æ‹‰å–åˆ°æœ¬åœ°" class="headerlink" title="2.2 å°†é˜¿é‡Œäº‘å¹³å°ä¸­çš„æ•°æ®é€šè¿‡AMQPå®æ—¶æ‹‰å–åˆ°æœ¬åœ°"></a>2.2 å°†é˜¿é‡Œäº‘å¹³å°ä¸­çš„æ•°æ®é€šè¿‡AMQPå®æ—¶æ‹‰å–åˆ°æœ¬åœ°</h2><p>å°†å›¾ç‰‡æ‹‰å–åˆ°æœ¬åœ°ä½¿ç”¨ Nodejs å’Œ Python ä¸¤ç§æ–¹å¼ã€‚</p><ol><li>Node.js ç¨‹åºè¾ƒä¸ºå®Œæ•´ï¼Œå¯å°†å›¾ç‰‡æ•°æ®è·å–åˆ°å¹¶è½¬åŒ–ä¸ºå›¾ç‰‡å­˜åˆ°æœ¬åœ°</li><li>Python ç¨‹åºä»…ä»…è·å–åˆ°æ•°æ®å¹¶æ‰“å°å‡ºæ¥ï¼Œä»…ä¾›å‚è€ƒã€‚</li></ol><h3 id="2-2-1-Node-js-è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®"><a href="#2-2-1-Node-js-è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®" class="headerlink" title="2.2.1 Node.js è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®"></a>2.2.1 Node.js è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®</h3><p>åœ¨æœ¬åœ°è¿è¡Œ Nodejs ç¨‹åºï¼Œé€šè¿‡ AMQP å®æ—¶è·å– ESP32cam ä¸Šä¼ åˆ°é˜¿é‡Œäº‘çš„å›¾ç‰‡æ•°æ®ç»„åˆæˆå›¾ç‰‡å¹¶ä¿å­˜åˆ°æœ¬åœ°ä¸­ã€‚<br>å…¶ä¸­éƒ¨åˆ†å‚æ•°é…ç½®å‚è€ƒï¼š</p><ol><li><a href="https://help.aliyun.com/zh/iot/developer-reference/connect-an-amqp-client-to-iot-platform">é˜¿é‡Œäº‘AMQPå®¢æˆ·ç«¯æ¥å…¥è¯´æ˜</a></li><li><a href="https://help.aliyun.com/zh/iot/developer-reference/connect-a-client-to-iot-platform-by-using-the-sdk-for-node-js">Nodejså®¢æˆ·ç«¯SDKæ¥å…¥å®ä¾‹</a></li><li><a href="https://help.aliyun.com/zh/iot/developer-reference/connect-a-client-to-iot-platform-by-using-the-sdk-for-python">pythonå®¢æˆ·ç«¯SDKæ¥å…¥å®ä¾‹</a></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container = <span class="built_in">require</span>(<span class="string">&#x27;rhea&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ä¸‹é¢çš„å‚æ•°</span></span><br><span class="line"><span class="comment">// hostï¼Œåœ¨ç‰©è”ç½‘å¹³å°é¦–é¡µï¼ŒæŸ¥çœ‹å¼€å‘é…ç½®ä¸­æŸ¥çœ‹</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">YourHost</span>=<span class="string">&quot;iot-06z00xxxxt6xc.amqp.iothub.aliyuncs.com&quot;</span></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯IDï¼Œå¯è‡ªå®šä¹‰ï¼Œé•¿åº¦ä¸å¯è¶…è¿‡64ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">YourClientId</span>=<span class="string">&quot;esp32_001&quot;</span></span><br><span class="line"><span class="comment">// è´¦å·çš„ AccessKeyã€‚å°†é¼ æ ‡ç§»è‡³è´¦å·å¤´åƒä¸Šï¼Œç„¶åå•å‡»AccessKeyç®¡ç†ï¼Œè·å–AccessKey IDå’ŒAccessKey Secretã€‚</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">YourAccessKeyId</span>=<span class="string">&quot;LTAI5tXXXXXXXXXXxLEMGYL2&quot;</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">YourAccessKeySecret</span>=<span class="string">&quot;6vi2Txxxw9xxxrwig&quot;</span></span><br><span class="line"><span class="comment">// åœ¨å¯¹åº”å®ä¾‹çš„æ¶ˆæ¯è½¬å‘ &gt; æœåŠ¡ç«¯è®¢é˜… &gt; æ¶ˆè´¹ç»„åˆ—è¡¨æŸ¥çœ‹æ‚¨çš„æ¶ˆè´¹ç»„IDã€‚</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">YourConsumerGroupId</span>=<span class="string">&quot;DEFAULT_GROUP&quot;</span></span><br><span class="line"><span class="comment">// ç‰©è”ç½‘å¹³å°é¦–é¡µå®ä¾‹ ID</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">YourIotInstanceId</span>=<span class="string">&quot;iot-0600uxtxxsx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜æ”¾å®Œæ•´çš„å›¾ç‰‡å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">var</span> imgStr = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 16è¿›åˆ¶å›¾ç‰‡è½¬base64</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">to_base64</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> digits = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> base64_rep = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> bit_arr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> bit_num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; str.<span class="property">length</span>; ++n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (str[n] &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; str[n] = <span class="string">&#x27;a&#x27;</span> &amp;&amp; str[n] = <span class="number">6</span>) &#123;</span><br><span class="line">            bit_num -= <span class="number">6</span>;</span><br><span class="line">            base64_rep += digits[bit_arr &gt;&gt;&gt; bit_num];</span><br><span class="line">            bit_arr &amp;= ~(-<span class="number">1</span> &lt;&lt; bit_num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (bit_num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        bit_arr &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; <span class="number">4</span> - padding; ++n) &#123;</span><br><span class="line">            base64_rep += <span class="string">&quot;=&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> base64_rep;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºConnectionã€‚</span></span><br><span class="line"><span class="keyword">var</span> connection = container.<span class="title function_">connect</span>(&#123;</span><br><span class="line">    <span class="comment">//æ¥å…¥åŸŸåï¼Œè¯·å‚è§AMQPå®¢æˆ·ç«¯æ¥å…¥è¯´æ˜æ–‡æ¡£ã€‚</span></span><br><span class="line">    <span class="string">&#x27;host&#x27;</span>: <span class="title class_">YourHost</span>,</span><br><span class="line">    <span class="string">&#x27;port&#x27;</span>: <span class="number">5671</span>,</span><br><span class="line">    <span class="string">&#x27;transport&#x27;</span>:<span class="string">&#x27;tls&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;reconnect&#x27;</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;idle_time_out&#x27;</span>:<span class="number">60000</span>,</span><br><span class="line">    <span class="comment">//userNameç»„è£…æ–¹æ³•ï¼Œè¯·å‚è§AMQPå®¢æˆ·ç«¯æ¥å…¥è¯´æ˜æ–‡æ¡£ã€‚</span></span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>:<span class="title class_">YourClientId</span>+<span class="string">&#x27;|authMode=aksign,signMethod=hmacsha1,timestamp=1573489088171,authId=&#x27;</span>+<span class="title class_">YourAccessKeyId</span>+<span class="string">&#x27;,iotInstanceId=&#x27;</span>+<span class="title class_">YourIotInstanceId</span>+<span class="string">&#x27;,consumerGroupId=&#x27;</span>+<span class="title class_">YourConsumerGroupId</span>+<span class="string">&#x27;|&#x27;</span>,</span><br><span class="line">    <span class="comment">//è®¡ç®—ç­¾åï¼Œpasswordç»„è£…æ–¹æ³•ï¼Œè¯·å‚è§AMQPå®¢æˆ·ç«¯æ¥å…¥è¯´æ˜æ–‡æ¡£ã€‚</span></span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="title function_">hmacSha1</span>(<span class="title class_">YourAccessKeySecret</span>, <span class="string">&#x27;authId=&#x27;</span>+<span class="title class_">YourAccessKeyId</span>+<span class="string">&#x27;Ã—tamp=1573489088171&#x27;</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºReceiver Link</span></span><br><span class="line"><span class="keyword">var</span> receiver = connection.<span class="title function_">open_receiver</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¥æ”¶äº‘ç«¯æ¨é€æ¶ˆæ¯çš„å›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line">container.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> msg = context.<span class="property">message</span>;</span><br><span class="line">    <span class="keyword">var</span> messageId = msg.<span class="property">message_id</span>;</span><br><span class="line">    <span class="keyword">var</span> topic = msg.<span class="property">application_properties</span>.<span class="property">topic</span>;</span><br><span class="line">    <span class="keyword">var</span> content = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(msg.<span class="property">body</span>.<span class="property">content</span>).<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºå†…å®¹ã€‚</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(content);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æ¥æ”¶åˆ°çš„mqttæ¶ˆæ¯ä¸­å†…å®¹è½¬ä¸ºjson</span></span><br><span class="line">    <span class="keyword">var</span> imgBody = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(content).<span class="property">items</span>.<span class="property">img</span>.<span class="property">value</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;-------&#x27;</span>)</span><br><span class="line">    <span class="comment">// å¦‚æœå›¾ç‰‡æ²¡æœ‰ä¼ è¾“å®Œæ¯•ï¼Œåˆ™æ‹¼æ¥å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">if</span> (imgBody != <span class="string">&#x27;END&#x27;</span>) &#123;</span><br><span class="line">        imgStr += imgBody</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå›¾ç‰‡ä¼ è¾“å®Œæ¯•ï¼Œåˆ™å°†å›¾ç‰‡è½¬ä¸ºbase64</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;imgStr:&#x27;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">to_base64</span>(imgStr))</span><br><span class="line">        <span class="comment">// é…ç½®å›¾ç‰‡ä¿å­˜è·¯å¾„</span></span><br><span class="line">        <span class="keyword">var</span> path = <span class="string">&#x27;./img/&#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() + <span class="string">&#x27;.jpg&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> dataBuffer = <span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="title function_">to_base64</span>(imgStr), <span class="string">&#x27;base64&#x27;</span>); <span class="comment">//æŠŠbase64ç è½¬æˆbufferå¯¹è±¡ï¼Œ</span></span><br><span class="line">        <span class="comment">//ç”¨fså°†å›¾ç‰‡å†™å…¥æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">        fs.<span class="title function_">writeFile</span>(path, dataBuffer, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å†™å…¥æˆåŠŸï¼&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// å›¾ç‰‡è½¬æ¢å®Œæ¯•åï¼Œæ¸…ç©ºimgStrï¼Œå‡†å¤‡æ¥å—ä¸‹ä¸€å¼ å›¾ç‰‡</span></span><br><span class="line">        imgStr = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å‘é€ACKï¼Œæ³¨æ„ä¸è¦åœ¨å›è°ƒå‡½æ•°æœ‰è€—æ—¶é€»è¾‘ã€‚</span></span><br><span class="line">    context.<span class="property">delivery</span>.<span class="title function_">accept</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¡ç®—passwordç­¾åã€‚</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hmacSha1</span>(<span class="params">key, context</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Buffer</span>.<span class="title function_">from</span>(crypto.<span class="title function_">createHmac</span>(<span class="string">&#x27;sha1&#x27;</span>, key).<span class="title function_">update</span>(context).<span class="title function_">digest</span>())</span><br><span class="line">        .<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Nodejs æœ¬åœ°è¿è¡Œå›¾ï¼š<br><img src="https://img-blog.csdnimg.cn/img_convert/e7ddc2f1e9ea29fd820650785c658f6e.png"></p><h3 id="2-2-2-Python-è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®ï¼ˆä»…ä¾›å‚è€ƒï¼‰"><a href="#2-2-2-Python-è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®ï¼ˆä»…ä¾›å‚è€ƒï¼‰" class="headerlink" title="2.2.2 Python è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®ï¼ˆä»…ä¾›å‚è€ƒï¼‰"></a>2.2.2 Python è·å–é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°å›¾ç‰‡æ•°æ®ï¼ˆä»…ä¾›å‚è€ƒï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> stomp</span><br><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">import</span> schedule</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å…¥jsonæ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 16è¿›åˆ¶è½¬å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">imgStr=<span class="string">&quot;&quot;</span></span><br><span class="line">i=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connect_and_subscribe</span>(<span class="params">conn</span>):</span><br><span class="line">    accessKey = <span class="string">&quot;LTAxxxxxExxxL2&quot;</span></span><br><span class="line">    accessSecret = <span class="string">&quot;AsJWxxxxxxxxxxxxxR0xxxxxB&quot;</span></span><br><span class="line">    consumerGroupId = <span class="string">&quot;DEFAULT_GROUP&quot;</span></span><br><span class="line">    <span class="comment"># iotInstanceIdï¼šå®ä¾‹IDã€‚</span></span><br><span class="line">    iotInstanceId = <span class="string">&quot;iot-06z0xxxxxx6xc&quot;</span></span><br><span class="line">    clientId = <span class="string">&quot;esp32_001&quot;</span></span><br><span class="line">    <span class="comment"># ç­¾åæ–¹æ³•ï¼šæ”¯æŒhmacmd5ï¼Œhmacsha1å’Œhmacsha256ã€‚</span></span><br><span class="line">    signMethod = <span class="string">&quot;hmacsha1&quot;</span></span><br><span class="line">    timestamp = current_time_millis()</span><br><span class="line">    <span class="comment"># userNameç»„è£…æ–¹æ³•ï¼Œè¯·å‚è§AMQPå®¢æˆ·ç«¯æ¥å…¥è¯´æ˜æ–‡æ¡£ã€‚</span></span><br><span class="line">    <span class="comment"># è‹¥ä½¿ç”¨äºŒè¿›åˆ¶ä¼ è¾“ï¼Œåˆ™userNameéœ€è¦æ·»åŠ encode=base64å‚æ•°ï¼ŒæœåŠ¡ç«¯ä¼šå°†æ¶ˆæ¯ä½“base64ç¼–ç åå†æ¨é€ã€‚å…·ä½“æ·»åŠ æ–¹æ³•è¯·å‚è§ä¸‹ä¸€ç« èŠ‚&quot;äºŒè¿›åˆ¶æ¶ˆæ¯ä½“è¯´æ˜&quot;ã€‚</span></span><br><span class="line">    username = clientId + <span class="string">&quot;|authMode=aksign&quot;</span> + <span class="string">&quot;,signMethod=&quot;</span> + signMethod \</span><br><span class="line">                    + <span class="string">&quot;,timestamp=&quot;</span> + timestamp + <span class="string">&quot;,authId=&quot;</span> + accessKey \</span><br><span class="line">                    + <span class="string">&quot;,iotInstanceId=&quot;</span> + iotInstanceId \</span><br><span class="line">                    + <span class="string">&quot;,consumerGroupId=&quot;</span> + consumerGroupId + <span class="string">&quot;|&quot;</span></span><br><span class="line">    signContent = <span class="string">&quot;authId=&quot;</span> + accessKey + <span class="string">&quot;Ã—tamp=&quot;</span> + timestamp</span><br><span class="line">    <span class="comment"># è®¡ç®—ç­¾åï¼Œpasswordç»„è£…æ–¹æ³•ï¼Œè¯·å‚è§AMQPå®¢æˆ·ç«¯æ¥å…¥è¯´æ˜æ–‡æ¡£ã€‚</span></span><br><span class="line">    password = do_sign(accessSecret.encode(<span class="string">&quot;utf-8&quot;</span>), signContent.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"></span><br><span class="line">    conn.set_listener(<span class="string">&#x27;&#x27;</span>, MyListener(conn))</span><br><span class="line">    conn.connect(username, password, wait=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># æ¸…é™¤å†å²è¿æ¥æ£€æŸ¥ä»»åŠ¡ï¼Œæ–°å»ºè¿æ¥æ£€æŸ¥ä»»åŠ¡</span></span><br><span class="line">    schedule.clear(<span class="string">&#x27;conn-check&#x27;</span>)</span><br><span class="line">    schedule.every(<span class="number">1</span>).seconds.do(do_check,conn).tag(<span class="string">&#x27;conn-check&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyListener</span>(stomp.ConnectionListener):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, conn</span>):</span><br><span class="line">        self.conn = conn</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_error</span>(<span class="params">self, frame</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;received an error &quot;%s&quot;&#x27;</span> % frame.body)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">self, frame</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;received a message &quot;%s&quot;&#x27;</span> % frame.body)</span><br><span class="line">        <span class="comment"># print(&#x27;received a message :&#x27; + json.loads(frame.body).items)</span></span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_heartbeat_timeout</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;on_heartbeat_timeout&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_connected</span>(<span class="params">self, headers</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;successfully connected&quot;</span>)</span><br><span class="line">        conn.subscribe(destination=<span class="string">&#x27;/topic/#&#x27;</span>, <span class="built_in">id</span>=<span class="number">1</span>, ack=<span class="string">&#x27;auto&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;successfully subscribe&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_disconnected</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;disconnected&#x27;</span>)</span><br><span class="line">        connect_and_subscribe(self.conn)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">current_time_millis</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">round</span>(time.time() * <span class="number">1000</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_sign</span>(<span class="params">secret, sign_content</span>):</span><br><span class="line">    m = hmac.new(secret, sign_content, digestmod=hashlib.sha1)</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(m.digest()).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥è¿æ¥ï¼Œå¦‚æœæœªè¿æ¥åˆ™é‡æ–°å»ºè¿</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_check</span>(<span class="params">conn</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;check connection, is_connected: %s&#x27;</span>, conn.is_connected())</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> conn.is_connected()):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            connect_and_subscribe(conn)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;disconnected, &#x27;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šæ—¶ä»»åŠ¡æ–¹æ³•ï¼Œæ£€æŸ¥è¿æ¥çŠ¶æ€</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connection_check_timer</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        schedule.run_pending()</span><br><span class="line">        time.sleep(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#  æ¥å…¥åŸŸåï¼Œè¯·å‚è§AMQPå®¢æˆ·ç«¯æ¥å…¥è¯´æ˜æ–‡æ¡£ã€‚è¿™é‡Œç›´æ¥å¡«å…¥åŸŸåï¼Œä¸éœ€è¦å¸¦amqps://å‰ç¼€</span></span><br><span class="line">conn = stomp.Connection([(<span class="string">&#x27;iot-06xxxxxc.amqp.iothub.aliyuncs.com&#x27;</span>, <span class="number">61614</span>)], heartbeats=(<span class="number">0</span>,<span class="number">300</span>))</span><br><span class="line">conn.set_ssl(for_hosts=[(<span class="string">&#x27;iot-06xxxxxc.amqp.iothub.aliyuncs.com&#x27;</span>, <span class="number">61614</span>)], ssl_version=ssl.PROTOCOL_TLS)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    connect_and_subscribe(conn)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;connecting failed&#x27;</span>)</span><br><span class="line">    <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼‚æ­¥çº¿ç¨‹è¿è¡Œå®šæ—¶ä»»åŠ¡ï¼Œæ£€æŸ¥è¿æ¥çŠ¶æ€</span></span><br><span class="line">thread = threading.Thread(target=connection_check_timer)</span><br><span class="line">thread.start()</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ Python ä¸­çš„å‚æ•°é…ç½®åŒ Nodejsã€‚<br>å‚è€ƒï¼š</p><ol><li><a href="https://help.aliyun.com/zh/iot/developer-reference/connect-an-amqp-client-to-iot-platform">é˜¿é‡Œäº‘AMQPå®¢æˆ·ç«¯æ¥å…¥è¯´æ˜</a></li><li><a href="https://help.aliyun.com/zh/iot/developer-reference/connect-a-client-to-iot-platform-by-using-the-sdk-for-node-js">Nodejså®¢æˆ·ç«¯SDKæ¥å…¥å®ä¾‹</a></li><li><a href="https://help.aliyun.com/zh/iot/developer-reference/connect-a-client-to-iot-platform-by-using-the-sdk-for-python">pythonå®¢æˆ·ç«¯SDKæ¥å…¥å®ä¾‹</a></li></ol><p>Python è·å–å›¾ç‰‡æ•°æ®è¿è¡Œå›¾å¦‚ä¸‹ï¼š<br><img src="https://img-blog.csdnimg.cn/img_convert/aac729c92ca8b9aca59aa7d2f19a64a3.png"></p><p>è‡³æ­¤ï¼Œä»é˜¿é‡Œäº‘IOTå¹³å°è·å–å›¾ç‰‡æ•°æ®å¹¶ä¿å­˜åˆ°æœ¬åœ°çš„ç¨‹åºå·²å…¨éƒ¨å®Œæˆï¼Œç¨‹åºç›®å‰è¾ƒä¸ºç®€é™‹ï¼Œä»…ä¾›å‚è€ƒä½¿ç”¨ã€‚</p><p>ç›¸å…³å‚è€ƒå†…å®¹ï¼š</p><ol><li><a href="https://blog.csdn.net/isoface/article/details/125349106">CSDN:ESP32CAMçš„å›¾ç‰‡ç”¨MQTTä¹Ÿèƒ½ä¼ ï¼Ÿ</a></li><li><a href="https://blog.csdn.net/haote216/article/details/105762808">CSDN:ESP32CAMè¿æ¥é˜¿é‡Œäº‘ç‰©è”ç½‘å¹³å°</a></li><li><a href="https://blog.csdn.net/weixin_46323814/article/details/128116095">CSDN:ESP32-S2ä½¿ç”¨Arduinoè¿æ¥é˜¿é‡Œäº‘</a></li><li><a href="https://blog.csdn.net/qq_39592312/article/details/108931427">CSDN:è¿æ¥é˜¿é‡Œäº‘å¤±è´¥MQTT connect failed</a></li><li><a href="https://blog.gitnote.cn/post/esp32cam_001/">Gitnote:ESP32camç³»åˆ—æ•™ç¨‹001</a></li></ol><p>æœ¬æ–‡é¦–å‘äºæœ¬äººåšå®¢ï¼š<a href="https://blog.gitnote.cn/post/esp32cam_mqtt_aliyun_iot">https://blog.gitnote.cn/post/esp32cam_mqtt_aliyun_iot</a></p><p>ç‰ˆæƒä¿¡æ¯: CC BY-NC-SA 4.0 (è‡ªç”±è½¬è½½-éå•†ç”¨-ç›¸åŒæ–¹å¼å…±äº«-ä¿æŒç½²å)</p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
            <tag> å¤–è®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pythonçš„requestsåœ¨ç½‘ç»œè¯·æ±‚ä¸­æ·»åŠ cookieså‚æ•°</title>
      <link href="/2024/03/python-python-python%E7%9A%84requests%E5%9C%A8%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%AD%E6%B7%BB%E5%8A%A0cookies%E5%8F%82%E6%95%B0/"/>
      <url>/2024/03/python-python-python%E7%9A%84requests%E5%9C%A8%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%AD%E6%B7%BB%E5%8A%A0cookies%E5%8F%82%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>å“ï¼Œå¥½ä¹…æ²¡æœ‰å­¦ä¹ çˆ¬è™«äº†ï¼Œç°åœ¨æƒ³è¦é‡æ–°æ‹¾èµ·æ¥ã€‚å‘ç°ä¹‹å‰å­¦ä¹ çˆ¬è™«æœ‰äº›ç²—ç³™ï¼Œç«Ÿç„¶è¿requestsä¸­æ·»åŠ cookieséƒ½æ²¡æœ‰æŒæ¡ï¼Œæƒ­æ„§ã€‚åºŸè¯ä¸å®œå¤šï¼Œç›´æ¥ä¸Šå†…å®¹ã€‚</p><p>æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨requestsè·å–ç½‘ç»œå†…å®¹å¾ˆç®€å•ï¼Œå‡ è¡Œä»£ç æå®šäº†ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">res=requests.get(<span class="string">&quot;https://cloud.flyme.cn/browser/index.jsp&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> res.content</span><br></pre></td></tr></table></figure><p>ä½ æ²¡æœ‰çœ‹é”™ï¼ŒçœŸçš„åªæœ‰ä¸‰è¡Œä»£ç ã€‚ä½†æ˜¯ç®€å•å½’ç®€å•ï¼Œé—®é¢˜è¿˜æ˜¯ä¸å°‘çš„ã€‚</p><p>é¦–å…ˆï¼Œè¿™é‡Œçš„è¯·æ±‚åªæ˜¯getæ–¹æ³•ï¼Œå¹¶ä¸”æ²¡æœ‰è§£å†³cookiesçš„é—®é¢˜ã€‚</p><p>ç„¶åå°±æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰è§£å†³ä¹±ç çš„é—®é¢˜ã€‚ï¼ˆä¹±ç æ˜¯pythonä¸­çš„å˜æ€ç‚¹ï¼‰</p><p>å…¶å®ï¼Œåœ¨requestsçš„getæ–¹æ³•ä¸­æ·»åŠ cookiesçš„æ–¹æ³•ä¸éš¾ å¯ä»¥è¿™æ ·å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res=requests.get(<span class="string">&quot;https://cloud.flyme.cn/browser/index.jsp&quot;</span>,cookies=cookies)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰€é¢ä¸´çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•æ„é€ è¿™é‡Œçš„cookiesã€‚</p><p>è¿™é‡Œçš„cookiesæ˜¯ä¸€ä¸ªå­—å…¸æ ¼å¼çš„æ•°æ®ã€‚</p><p>å¹³æ—¶æˆ‘ä»¬æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼Œåœ¨å®¡æŸ¥å…ƒç´ ä¸­å¯ä»¥æŸ¥çœ‹åˆ°æ‰€è®¿é—®ç½‘é¡µçš„cookieså†…å®¹ï¼Œå¤§éƒ½æ˜¯è¿™æ ·å­çš„ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sn_openNetBySms=%23810EBMA3TE53; sn_map=810EBMA3TE53; DSESSIONID=f1987887-3d1d-4a85-ad75-c6270e588290; JSESSIONID=; _uid=; _keyLogin=; _rmtk=; _uticket=ns_0393027c2f9f686e3499e8ebb8d1d622; _ckk=ns_397a592791064029bf1336eff1cf516e; ucuid=8a135520affa423584307f6e2c210f02; _domain=cloud.flyme.cn; _islogin=true; lang=zh_CN; JSESSIONID=1gmfzynp0ns6s1u6a92xkqgi6q</span><br></pre></td></tr></table></figure><p>å¤©é‚£ï¼Œè¿™æ˜¯äººçœ‹çš„å—ï¼Ÿä¸æ˜¯ã€‚è¿™æ˜¯ç»è¿‡åŠ å¯†å¤„ç†åçš„æ•°æ®ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŠ å¯†åçš„æ•°æ®ä¼ é€’åˆ°getæ–¹æ³•çš„cookieså‚æ•°ä¸­ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†åŠ å¯†åçš„æ•°æ®è¿›è¡Œè§£å¯†ï¼Œå†æ£€æŸ¥æ•°æ®çš„æ­£ç¡®æ€§ã€‚</p><p>è‡³äºï¼Œå¦‚ä½•æŸ¥çœ‹æ‰€è®¿é—®ç½‘é¡µçš„cookieså†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨æµè§ˆå™¨çš„å®¡æŸ¥åŠŸèƒ½ï¼ŒF12æˆ–è€…å³å‡»å®¡æŸ¥ï¼ˆChromeï¼‰æ‰“å¼€ã€‚åœ¨networkä¸­æŸ¥çœ‹é“¾æ¥çš„Headerså†…å®¹ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è½¯ä»¶æŠ“åŒ…æŸ¥çœ‹ï¼Œå¦‚Fiddler web Debuggerã€‚</p><p>è¿™é‡Œå‡è®¾è·å–åˆ°äº†cookiesçš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä¿å­˜åˆ°æœ¬åœ°TXTæ–‡ä»¶ä¸­ï¼ˆç›´æ¥æŠŠcookiesçš„å†…å®¹ç²˜è´´è¿›å»å³å¯ï¼‰ï¼Œä¾‹å¦‚test.txtæ–‡ä»¶ã€‚</p><p>ç„¶åï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f=<span class="built_in">open</span>(<span class="string">r&#x27;test.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)<span class="comment">#æ‰“å¼€æ‰€ä¿å­˜çš„cookieså†…å®¹æ–‡ä»¶</span></span><br><span class="line">cookies=&#123;&#125;<span class="comment">#åˆå§‹åŒ–cookieså­—å…¸å˜é‡</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.read().split(<span class="string">&#x27;;&#x27;</span>):   <span class="comment">#æŒ‰ç…§å­—ç¬¦ï¼šè¿›è¡Œåˆ’åˆ†è¯»å–</span></span><br><span class="line">    <span class="comment">#å…¶è®¾ç½®ä¸º1å°±ä¼šæŠŠå­—ç¬¦ä¸²æ‹†åˆ†æˆ2ä»½</span></span><br><span class="line">    name,value=line.strip().split(<span class="string">&#x27;=&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">    cookies[name]=value  <span class="comment">#ä¸ºå­—å…¸cookiesæ·»åŠ å†…å®¹</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æˆ‘ä»¬å°†cookiesæ·»åŠ åˆ°getæ–¹æ³•ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res=requests.get(<span class="string">&quot;https://cloud.flyme.cn/browser/index.jsp&quot;</span>,cookies=cookies)</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™è·å–åˆ°çš„res.contentä¸­å°±æ˜¯æˆ‘ä»¬å°†cookiesä¿¡æ¯æ·»åŠ åˆ°getä¸­åè®¿é—®ç½‘é¡µæ‰€è·å–çš„å†…å®¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨pythonæ­ç§˜CSDNçƒ­é—¨ä»˜è´¹ä¸“æ æƒŠäººçœŸç›¸</title>
      <link href="/2024/03/python-python-%E4%BD%BF%E7%94%A8python%E6%8F%AD%E7%A7%98CSDN%E7%83%AD%E9%97%A8%E4%BB%98%E8%B4%B9%E4%B8%93%E6%A0%8F%E6%83%8A%E4%BA%BA%E7%9C%9F%E7%9B%B8/"/>
      <url>/2024/03/python-python-%E4%BD%BF%E7%94%A8python%E6%8F%AD%E7%A7%98CSDN%E7%83%AD%E9%97%A8%E4%BB%98%E8%B4%B9%E4%B8%93%E6%A0%8F%E6%83%8A%E4%BA%BA%E7%9C%9F%E7%9B%B8/</url>
      
        <content type="html"><![CDATA[<h4 id="æ–‡ç« ç›®å½•"><a href="#æ–‡ç« ç›®å½•" class="headerlink" title="æ–‡ç« ç›®å½•"></a>æ–‡ç« ç›®å½•</h4><ul><li><a href="#1csdn-3">1.csdnä»˜è´¹ä¸“æ è¯äº‘</a></li><li><a href="#2-18">2.æµè§ˆå™¨æŠ“åŒ…åˆ†æ</a></li><li><a href="#3api-40">3.APIæ¥å£æµ‹è¯•</a></li><li><a href="#4python-50">4.éœ€è¦ä½¿ç”¨çš„pythonåº“</a></li><li><a href="#5-68">5.çˆ¬è™«ä¸æ•°æ®åˆ†æè®¾è®¡</a></li><li><a href="#6--185">6. å®Œæ•´ä»£ç </a></li><li><a href="#7-316">7.æœ€ç»ˆçš„æˆæœ</a></li><li><a href="#8-337">8.æƒŠäººçœŸç›¸åœ¨è¿™é‡Œ</a></li></ul><h2 id="1-csdnä»˜è´¹ä¸“æ è¯äº‘"><a href="#1-csdnä»˜è´¹ä¸“æ è¯äº‘" class="headerlink" title="1.csdnä»˜è´¹ä¸“æ è¯äº‘"></a>1.csdnä»˜è´¹ä¸“æ è¯äº‘</h2><blockquote><p>æˆ‘ä»¬å¦‚ä½•åˆ†æcsdnçƒ­é—¨ä»˜è´¹ä¸“æ å‘¢ï¼Ÿ</p></blockquote><p><img src="https://img-blog.csdnimg.cn/direct/4931ba9c431441f7a3c8eacf9dbdb573.jpeg"></p><p><strong>çƒ­é—¨ä¸“æ æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çˆ¬å–çš„æ•°æ®æ˜¯ä¸€ç›´å˜åŒ–çš„ï¼</strong></p><p>é€šè¿‡æˆ‘çš„åˆ†æå¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼Œçƒ­é—¨ä»˜è´¹çš„é¢†åŸŸï¼š</p><ul><li>ç›®æ ‡æ£€æµ‹ä¸è®¡ç®—æœºè§†è§‰ï¼šåˆ©ç”¨æ·±åº¦å­¦ä¹ å’Œå›¾åƒå¤„ç†æŠ€æœ¯ï¼Œå®ç°è‡ªåŠ¨è¯†åˆ«å’Œå®šä½ç›®æ ‡ç‰©ä½“çš„é¢†åŸŸã€‚</li><li>ç³»ç»Ÿå¼€å‘ä¸åµŒå…¥å¼ï¼šæ¶‰åŠè®¾è®¡ã€å¼€å‘å’Œä¼˜åŒ–åµŒå…¥å¼ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç¡¬ä»¶å’Œè½¯ä»¶çš„é›†æˆã€‚</li><li>æ•°æ®ç§‘å­¦ä¸æœºå™¨å­¦ä¹ ï¼šé€šè¿‡åˆ†æå’Œè§£é‡Šå¤§é‡æ•°æ®ï¼Œåˆ©ç”¨æœºå™¨å­¦ä¹ ç®—æ³•æ„å»ºæ¨¡å‹ï¼Œä»ä¸­è·å–æ´å¯Ÿå’Œé¢„æµ‹ã€‚</li><li>ç‰©è”ç½‘ä¸äººå·¥æ™ºèƒ½ï¼šå°†ä¼ æ„Ÿå™¨ã€è®¾å¤‡å’Œç½‘ç»œè¿æ¥èµ·æ¥ï¼Œé€šè¿‡äººå·¥æ™ºèƒ½æŠ€æœ¯å®ç°æ™ºèƒ½åŒ–çš„äº’è”ç½‘åº”ç”¨ã€‚</li><li>MATLABåº”ç”¨ï¼šä½¿ç”¨MATLABç¼–ç¨‹è¯­è¨€å’Œå·¥å…·è¿›è¡Œç§‘å­¦è®¡ç®—ã€æ•°æ®åˆ†æã€å›¾åƒå¤„ç†å’Œæ¨¡å‹å¼€å‘ç­‰åº”ç”¨ã€‚</li></ul><h2 id="2-æµè§ˆå™¨æŠ“åŒ…åˆ†æ"><a href="#2-æµè§ˆå™¨æŠ“åŒ…åˆ†æ" class="headerlink" title=";  2.æµè§ˆå™¨æŠ“åŒ…åˆ†æ"></a><a name="2_18">;</a>  2.æµè§ˆå™¨æŠ“åŒ…åˆ†æ</h2><ul><li>1.æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°CSDNæ’è¡Œæ¦œé¡µé¢</li></ul><blockquote><p><a href="https://blog.csdn.net/rank/list/total">https://blog.csdn.net/rank/list/total</a><br>æµè§ˆå™¨æ‰“å¼€F12ï¼Œç‚¹å‡»ç½‘ç»œ</p></blockquote><p><img src="https://img-blog.csdnimg.cn/direct/762deb6bacfc42f58ec7ed91df021718.png"></p><ul><li>æˆ‘ä»¬åœé æ”¾ä¸Šæ”¹ä¸ºä¸Šä¸‹ç»“æ„ï¼Œå¦‚æˆ‘ä¸Šå›¾</li></ul><p><img src="https://img-blog.csdnimg.cn/direct/d50f89818bb6412c9a0bf4868157ae0b.png"></p><ul><li>ç‚¹å‡»å¦‚ä¸‹å›¾</li></ul><blockquote><p>é¦–å…ˆæˆ‘ä»¬ç‚¹å‡»çƒ­é—¨ä¸“æ ï¼Œç„¶åæˆ‘ä»¬ç‚¹å‡»Fetch&#x2F;XHR,æŸ¥çœ‹æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚<br>é€šè¿‡åˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“<br><img src="https://img-blog.csdnimg.cn/direct/33a3cddde73543c6b9a0109b7a5fa397.png"></p></blockquote><ul><li>åˆ†æç»“æœå¦‚ä¸‹</li></ul><blockquote><p><a href="https://blog.csdn.net/phoenix/web/blog/pay-column-rank?page=0&pageSize=20">https://blog.csdn.net/phoenix/web/blog/pay-column-rank?page=0&amp;pageSize=20</a></p></blockquote><p><img src="https://img-blog.csdnimg.cn/direct/380cffeb94c44bdb81a7424ac74a7f21.png"><br><img src="https://img-blog.csdnimg.cn/direct/f86acb209663470d961489f914df34e7.png"></p><h2 id="3-APIæ¥å£æµ‹è¯•"><a href="#3-APIæ¥å£æµ‹è¯•" class="headerlink" title=";  3.APIæ¥å£æµ‹è¯•"></a><a name="3api_40">;</a>  3.APIæ¥å£æµ‹è¯•</h2><p>æˆ‘æµ‹è¯•äº†</p><ul><li><a href="https://blog.csdn.net/phoenix/web/blog/pay-column-rank?page=0&pageSize=20">https://blog.csdn.net/phoenix/web/blog/pay-column-rank?page=0&amp;pageSize=20</a></li><li><a href="https://blog.csdn.net/phoenix/web/blog/pay-column-rank?page=0&pageSize=100">https://blog.csdn.net/phoenix/web/blog/pay-column-rank?page=0&amp;pageSize=100</a></li><li><a href="https://blog.csdn.net/phoenix/web/blog/pay-column-rank?page=0&pageSize=200">https://blog.csdn.net/phoenix/web/blog/pay-column-rank?page=0&amp;pageSize=200</a><br>é€šè¿‡æµ‹è¯•å‘ç°ï¼Œæœ€å¤šåªèƒ½ç»™åˆ°100ä¸ªçƒ­é—¨ä»˜è´¹ä¸“æ æ•°æ®</li></ul><p><img src="https://img-blog.csdnimg.cn/direct/14ab57ec02f34bf0b6b741798da0fa03.png"></p><h2 id="4-éœ€è¦ä½¿ç”¨çš„pythonåº“"><a href="#4-éœ€è¦ä½¿ç”¨çš„pythonåº“" class="headerlink" title="4.éœ€è¦ä½¿ç”¨çš„pythonåº“"></a>4.éœ€è¦ä½¿ç”¨çš„pythonåº“</h2><ul><li>requests: ç”¨äºå‘é€HTTPè¯·æ±‚å’Œå¤„ç†å“åº”çš„åº“ã€‚å®ƒå¯ä»¥ç”¨äºä¸WebæœåŠ¡è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚è·å–ç½‘é¡µå†…å®¹æˆ–å‘é€APIè¯·æ±‚ã€‚</li><li>pandas: æä¾›äº†ç”¨äºæ•°æ®æ“ä½œå’Œåˆ†æçš„æ•°æ®ç»“æ„å’Œå‡½æ•°ã€‚å®ƒæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åº“ï¼Œç”¨äºå¤„ç†å’Œåˆ†æç»“æ„åŒ–æ•°æ®ï¼Œä¾‹å¦‚è¡¨æ ¼æ•°æ®ã€‚</li><li>wordcloud: ç”¨äºç”Ÿæˆè¯äº‘å›¾çš„åº“ã€‚è¯äº‘å›¾æ˜¯ä¸€ç§å¯è§†åŒ–å½¢å¼ï¼Œé€šè¿‡å±•ç¤ºæ–‡æœ¬ä¸­å‡ºç°é¢‘ç‡è¾ƒé«˜çš„å•è¯ï¼Œä»¥å›¾å½¢åŒ–çš„æ–¹å¼å‘ˆç°æ–‡æœ¬æ•°æ®ã€‚</li><li>matplotlib:<br>ç”¨äºåˆ›å»ºé™æ€ã€åŠ¨æ€å’Œäº¤äº’å¼çš„å¯è§†åŒ–å›¾è¡¨çš„åº“ã€‚å®ƒæä¾›äº†å„ç§ç»˜å›¾é€‰é¡¹ï¼Œå¯ä»¥ç”¨äºåˆ›å»ºçº¿å›¾ã€æ•£ç‚¹å›¾ã€æ¡å½¢å›¾ã€é¥¼å›¾ç­‰å„ç§ç±»å‹çš„å›¾è¡¨ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br><span class="line">pip install pandas</span><br><span class="line">pip install wordcloud</span><br><span class="line">pip install matplotlib</span><br></pre></td></tr></table></figure><h2 id="5-çˆ¬è™«ä¸æ•°æ®åˆ†æè®¾è®¡"><a href="#5-çˆ¬è™«ä¸æ•°æ®åˆ†æè®¾è®¡" class="headerlink" title="5.çˆ¬è™«ä¸æ•°æ®åˆ†æè®¾è®¡"></a>5.çˆ¬è™«ä¸æ•°æ®åˆ†æè®¾è®¡</h2><ul><li>é¦–å…ˆæˆ‘ä»¬éœ€è¦åšä¸ªçˆ¬è™«ï¼Œçˆ¬å–APIè·å–å‡ºçš„ç½‘ç»œæ’è¡Œæ¦œ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">API_RANK = &quot;https://blog.csdn.net/phoenix/web/blog/pay-column-rank&quot;</span><br><span class="line"></span><br><span class="line"># Http&amp;#x4EE3;&amp;#x7406;&amp;#x5934;</span><br><span class="line">HTTP_headers = &#123;</span><br><span class="line">    &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">params = &#123;&#x27;page&#x27;: &#x27;0&#x27;,</span><br><span class="line">            &#x27;pageSize&#x27;: 100&#125;</span><br><span class="line">response = requests.get(API_RANK, params=params, headers=HTTP_headers)</span><br><span class="line">print(&quot;http:&quot;, response.url)</span><br><span class="line">print(&quot;Status Code:&quot;, response.status_code)</span><br><span class="line">print(&quot;Response Text:&quot;, response.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>æˆ‘å°è¯•æŠŠæˆ‘ä»¬æŠ“å–åˆ°çš„æ•°æ®å†™åˆ°excelä¸­ï¼Œæˆ‘ä»¬æ¥è¿›è¡Œåˆ†æ</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import pandas as pd</span><br><span class="line"></span><br><span class="line">API_RANK = &quot;https://blog.csdn.net/phoenix/web/blog/pay-column-rank&quot;</span><br><span class="line"></span><br><span class="line"># Http&amp;#x4EE3;&amp;#x7406;&amp;#x5934;</span><br><span class="line">HTTP_headers = &#123;</span><br><span class="line">    &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">params = &#123;&#x27;page&#x27;: &#x27;0&#x27;,</span><br><span class="line">            &#x27;pageSize&#x27;: 100&#125;</span><br><span class="line">response = requests.get(API_RANK, params=params, headers=HTTP_headers)</span><br><span class="line">data = response.json()</span><br><span class="line">print(&quot;http:&quot;, response.url)</span><br><span class="line">print(&quot;Status Code:&quot;, response.status_code)</span><br><span class="line">print(&quot;Response Text:&quot;, response.text)</span><br><span class="line"></span><br><span class="line">def save_data_to_excel(data):</span><br><span class="line">    df = pd.DataFrame(data)</span><br><span class="line">    df.to_excel(&#x27;data.xlsx&#x27;, index=False)</span><br><span class="line">    print(&quot;&amp;#x6570;&amp;#x636E;&amp;#x5DF2;&amp;#x6210;&amp;#x529F;&amp;#x4FDD;&amp;#x5B58;&amp;#x5230; data.xlsx &amp;#x6587;&amp;#x4EF6;&quot;)</span><br><span class="line">save_data_to_excel(data[&#x27;data&#x27;][&quot;payColumnRankListItemList&quot;])</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/direct/a1ff07ec14d748b085b16846b8f41c0f.png"></p><ul><li>æˆ‘ä»¬è¦åˆ†æé«˜é¢‘è¯æ±‡<ul><li>1.ä¸å¯ä»¥åˆ†æé«˜é¢‘è¯æ±‡çš„æ—¶å€™æ‹†åˆ†ï¼ˆC++ï¼ŒC#ï¼ŒODç­‰å­—æ ·ï¼‰</li><li>2.æ ¹æ®é«˜é¢‘è¯æ±‡çš„å‡ºç°æ•°é‡æ¥æ’å</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">def extract_top_keywords(,titles, fixed_words=None, min_count=2):</span><br><span class="line">        fixed_words = &#123;&quot;OD&quot;, &quot;C#&quot;, &quot;JAVA&quot;, &quot;C++&quot;, &quot;&amp;#x534E;&amp;#x4E3A;&quot;, &quot;Python&quot;&#125;</span><br><span class="line">        # &amp;#x521B;&amp;#x5EFA;&amp;#x81EA;&amp;#x5B9A;&amp;#x4E49;&amp;#x8BCD;&amp;#x6C47;&amp;#x8868;</span><br><span class="line">        custom_vocab = set(fixed_words) if fixed_words else set()</span><br><span class="line"></span><br><span class="line">        # &amp;#x5206;&amp;#x8BCD;&amp;#x548C;&amp;#x6E05;&amp;#x6D17;&amp;#x6807;&amp;#x9898;</span><br><span class="line">        words = []</span><br><span class="line">        for title in titles:</span><br><span class="line">            # &amp;#x4F7F;&amp;#x7528;&amp;#x6B63;&amp;#x5219;&amp;#x8868;&amp;#x8FBE;&amp;#x5F0F;&amp;#x63D0;&amp;#x53D6;&amp;#x5355;&amp;#x8BCD;&amp;#x548C;&amp;#x6570;&amp;#x5B57;</span><br><span class="line">            tokens = re.findall(r&#x27;\w+&#x27;, title)</span><br><span class="line">            # &amp;#x5C06;&amp;#x5355;&amp;#x8BCD;&amp;#x8F6C;&amp;#x6362;&amp;#x4E3A;&amp;#x5C0F;&amp;#x5199;</span><br><span class="line">            tokens = [token.lower() for token in tokens]</span><br><span class="line"></span><br><span class="line">            # &amp;#x5C06;&amp;#x56FA;&amp;#x5B9A;&amp;#x8BCD;&amp;#x6C47;&amp;#x4F5C;&amp;#x4E3A;&amp;#x6574;&amp;#x4F53;&amp;#x6DFB;&amp;#x52A0;&amp;#x5230;&amp;#x8BCD;&amp;#x6C47;&amp;#x8868;&amp;#x4E2D;</span><br><span class="line">            for word in fixed_words:</span><br><span class="line">                if word.lower() in title.lower():</span><br><span class="line">                    tokens.append(word.lower())</span><br><span class="line"></span><br><span class="line">            words.extend(tokens)</span><br><span class="line"></span><br><span class="line">        # &amp;#x7EDF;&amp;#x8BA1;&amp;#x8BCD;&amp;#x9891;</span><br><span class="line">        word_counts = Counter(words)</span><br><span class="line"></span><br><span class="line">        # &amp;#x6839;&amp;#x636E;&amp;#x8BCD;&amp;#x9891;&amp;#x6392;&amp;#x5E8F;</span><br><span class="line">        sorted_words = sorted(word_counts.items(), key=lambda x: x[1], reverse=True)</span><br><span class="line"></span><br><span class="line">        # &amp;#x83B7;&amp;#x53D6;&amp;#x9AD8;&amp;#x9891;&amp;#x5173;&amp;#x952E;&amp;#x5B57;&amp;#x548C;&amp;#x8BCD;&amp;#x6C47;</span><br><span class="line">        top_keywords = [word for word, count in sorted_words if count &gt;= min_count]</span><br><span class="line"></span><br><span class="line">        return top_keywords</span><br><span class="line"></span><br><span class="line">    def writePng(pic, title_list):</span><br><span class="line">        # &amp;#x5C06;&amp;#x6807;&amp;#x9898;&amp;#x5217;&amp;#x8868;&amp;#x8F6C;&amp;#x6362;&amp;#x4E3A;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;</span><br><span class="line">        text = &#x27; &#x27;.join(title_list)</span><br><span class="line"></span><br><span class="line">        # &amp;#x8BBE;&amp;#x7F6E;&amp;#x4E2D;&amp;#x6587;&amp;#x5B57;&amp;#x4F53;&amp;#x8DEF;&amp;#x5F84;</span><br><span class="line">        font_path = &#x27;C:\\Windows\\Fonts\\simsun.ttc&#x27;  # &amp;#x66FF;&amp;#x6362;&amp;#x4E3A;&amp;#x4F60;&amp;#x7684;&amp;#x4E2D;&amp;#x6587;&amp;#x5B57;&amp;#x4F53;&amp;#x8DEF;&amp;#x5F84;</span><br><span class="line"></span><br><span class="line">        # &amp;#x521B;&amp;#x5EFA;&amp;#x8BCD;&amp;#x4E91;&amp;#x5BF9;&amp;#x8C61;&amp;#x5E76;&amp;#x8BBE;&amp;#x7F6E;&amp;#x53C2;&amp;#x6570;</span><br><span class="line">        wc = WordCloud(font_path=font_path, background_color=&#x27;white&#x27;, width=800, height=600)</span><br><span class="line"></span><br><span class="line">        # &amp;#x751F;&amp;#x6210;&amp;#x8BCD;&amp;#x4E91;</span><br><span class="line">        wc.generate(text)</span><br><span class="line"></span><br><span class="line">        # &amp;#x663E;&amp;#x793A;&amp;#x8BCD;&amp;#x4E91;</span><br><span class="line">        plt.imshow(wc, interpolation=&#x27;bilinear&#x27;)</span><br><span class="line">        plt.axis(&#x27;off&#x27;)</span><br><span class="line">        plt.show()</span><br><span class="line"></span><br><span class="line">        # &amp;#x4FDD;&amp;#x5B58;&amp;#x8BCD;&amp;#x4E91;&amp;#x6587;&amp;#x4EF6;</span><br><span class="line">        wc.to_file(pic)</span><br></pre></td></tr></table></figure><h2 id="6-å®Œæ•´ä»£ç "><a href="#6-å®Œæ•´ä»£ç " class="headerlink" title="6. å®Œæ•´ä»£ç "></a>6. å®Œæ•´ä»£ç </h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import pandas as pd</span><br><span class="line">import re</span><br><span class="line">from collections import Counter</span><br><span class="line">from wordcloud import WordCloud</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">API_RANK = &quot;https://blog.csdn.net/phoenix/web/blog/pay-column-rank&quot;</span><br><span class="line"></span><br><span class="line"># Http&amp;#x4EE3;&amp;#x7406;&amp;#x5934;</span><br><span class="line">HTTP_headers = &#123;</span><br><span class="line">    &#x27;User-Agent&#x27;: &#x27;Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># http get &amp;#x5C01;&amp;#x88C5;</span><br><span class="line">class HttpRequest:</span><br><span class="line">    header = None</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    def request(self, URL, PARAMS):</span><br><span class="line">        response = requests.get(URL, params=PARAMS, headers=HTTP_headers)</span><br><span class="line">        print(&quot;http:&quot;, response.url)</span><br><span class="line">        print(&quot;Status Code:&quot;, response.status_code)</span><br><span class="line">        print(&quot;Response Text:&quot;, response.text)</span><br><span class="line">        try:</span><br><span class="line">            data = response.json()</span><br><span class="line">            return data</span><br><span class="line">        except json.JSONDecodeError:</span><br><span class="line">            print(&quot;Error: The response is not in JSON format.&quot;)</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">class CSDNDataFetcher:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    def setHttpRequest(self, request):</span><br><span class="line">        self.csdnGeter = request</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    # &amp;#x83B7;&amp;#x53D6;&amp;#x6392;&amp;#x884C;&amp;#x699C;</span><br><span class="line">    def getRank(self, size):</span><br><span class="line">        params = &#123;</span><br><span class="line">            &#x27;page&#x27;: &#x27;0&#x27;,</span><br><span class="line">            &#x27;pageSize&#x27;: size&#125;</span><br><span class="line">        data = self.csdnGeter.request(API_RANK, params)</span><br><span class="line">        return data</span><br><span class="line"></span><br><span class="line">    # &amp;#x4FDD;&amp;#x5B58;&amp;#x5230;excel&amp;#x4E2D;</span><br><span class="line">    def save_data_to_excel(self, data):</span><br><span class="line">        df = pd.DataFrame(data)</span><br><span class="line">        df.to_excel(&#x27;data.xlsx&#x27;, index=False)</span><br><span class="line">        print(&quot;&amp;#x6570;&amp;#x636E;&amp;#x5DF2;&amp;#x6210;&amp;#x529F;&amp;#x4FDD;&amp;#x5B58;&amp;#x5230; data.xlsx &amp;#x6587;&amp;#x4EF6;&quot;)</span><br><span class="line"></span><br><span class="line">    def read_column_from_excel(self, file_path, sheet_name, column_name):</span><br><span class="line">        df = pd.read_excel(file_path, sheet_name=sheet_name)</span><br><span class="line">        column_data = df[column_name].tolist()</span><br><span class="line">        return column_data</span><br><span class="line"></span><br><span class="line">    def extract_top_keywords(self, titles, fixed_words=None, min_count=2):</span><br><span class="line">        fixed_words = &#123;&quot;OD&quot;, &quot;C#&quot;, &quot;JAVA&quot;, &quot;C++&quot;, &quot;&amp;#x534E;&amp;#x4E3A;&quot;, &quot;Python&quot;,&quot;Matlab&quot;,&quot;Qt&quot;&#125;</span><br><span class="line">        # &amp;#x521B;&amp;#x5EFA;&amp;#x81EA;&amp;#x5B9A;&amp;#x4E49;&amp;#x8BCD;&amp;#x6C47;&amp;#x8868;</span><br><span class="line">        custom_vocab = set(fixed_words) if fixed_words else set()</span><br><span class="line"></span><br><span class="line">        # &amp;#x5206;&amp;#x8BCD;&amp;#x548C;&amp;#x6E05;&amp;#x6D17;&amp;#x6807;&amp;#x9898;</span><br><span class="line">        words = []</span><br><span class="line">        for title in titles:</span><br><span class="line">            # &amp;#x4F7F;&amp;#x7528;&amp;#x6B63;&amp;#x5219;&amp;#x8868;&amp;#x8FBE;&amp;#x5F0F;&amp;#x63D0;&amp;#x53D6;&amp;#x5355;&amp;#x8BCD;&amp;#x548C;&amp;#x6570;&amp;#x5B57;</span><br><span class="line">            tokens = re.findall(r&#x27;\w+&#x27;, title)</span><br><span class="line">            # &amp;#x5C06;&amp;#x5355;&amp;#x8BCD;&amp;#x8F6C;&amp;#x6362;&amp;#x4E3A;&amp;#x5C0F;&amp;#x5199;</span><br><span class="line">            tokens = [token.lower() for token in tokens]</span><br><span class="line"></span><br><span class="line">            # &amp;#x5C06;&amp;#x56FA;&amp;#x5B9A;&amp;#x8BCD;&amp;#x6C47;&amp;#x4F5C;&amp;#x4E3A;&amp;#x6574;&amp;#x4F53;&amp;#x6DFB;&amp;#x52A0;&amp;#x5230;&amp;#x8BCD;&amp;#x6C47;&amp;#x8868;&amp;#x4E2D;</span><br><span class="line">            for word in fixed_words:</span><br><span class="line">                if word.lower() in title.lower():</span><br><span class="line">                    tokens.append(word.lower())</span><br><span class="line"></span><br><span class="line">            words.extend(tokens)</span><br><span class="line"></span><br><span class="line">        # &amp;#x7EDF;&amp;#x8BA1;&amp;#x8BCD;&amp;#x9891;</span><br><span class="line">        word_counts = Counter(words)</span><br><span class="line"></span><br><span class="line">        # &amp;#x6839;&amp;#x636E;&amp;#x8BCD;&amp;#x9891;&amp;#x6392;&amp;#x5E8F;</span><br><span class="line">        sorted_words = sorted(word_counts.items(), key=lambda x: x[1], reverse=True)</span><br><span class="line"></span><br><span class="line">        # &amp;#x83B7;&amp;#x53D6;&amp;#x9AD8;&amp;#x9891;&amp;#x5173;&amp;#x952E;&amp;#x5B57;&amp;#x548C;&amp;#x8BCD;&amp;#x6C47;</span><br><span class="line">        top_keywords = [word for word, count in sorted_words if count &gt;= min_count]</span><br><span class="line"></span><br><span class="line">        return top_keywords</span><br><span class="line"></span><br><span class="line">    def writePng(self, pic, title_list):</span><br><span class="line">        # &amp;#x5C06;&amp;#x6807;&amp;#x9898;&amp;#x5217;&amp;#x8868;&amp;#x8F6C;&amp;#x6362;&amp;#x4E3A;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;</span><br><span class="line">        text = &#x27; &#x27;.join(title_list)</span><br><span class="line"></span><br><span class="line">        # &amp;#x8BBE;&amp;#x7F6E;&amp;#x4E2D;&amp;#x6587;&amp;#x5B57;&amp;#x4F53;&amp;#x8DEF;&amp;#x5F84;</span><br><span class="line">        font_path = &#x27;C:\\Windows\\Fonts\\simsun.ttc&#x27;  # &amp;#x66FF;&amp;#x6362;&amp;#x4E3A;&amp;#x4F60;&amp;#x7684;&amp;#x4E2D;&amp;#x6587;&amp;#x5B57;&amp;#x4F53;&amp;#x8DEF;&amp;#x5F84;</span><br><span class="line"></span><br><span class="line">        # &amp;#x521B;&amp;#x5EFA;&amp;#x8BCD;&amp;#x4E91;&amp;#x5BF9;&amp;#x8C61;&amp;#x5E76;&amp;#x8BBE;&amp;#x7F6E;&amp;#x53C2;&amp;#x6570;</span><br><span class="line">        wc = WordCloud(font_path=font_path, background_color=&#x27;white&#x27;, width=800, height=600)</span><br><span class="line"></span><br><span class="line">        # &amp;#x751F;&amp;#x6210;&amp;#x8BCD;&amp;#x4E91;</span><br><span class="line">        wc.generate(text)</span><br><span class="line"></span><br><span class="line">        # &amp;#x663E;&amp;#x793A;&amp;#x8BCD;&amp;#x4E91;</span><br><span class="line">        plt.imshow(wc, interpolation=&#x27;bilinear&#x27;)</span><br><span class="line">        plt.axis(&#x27;off&#x27;)</span><br><span class="line">        plt.show()</span><br><span class="line"></span><br><span class="line">        # &amp;#x4FDD;&amp;#x5B58;&amp;#x8BCD;&amp;#x4E91;&amp;#x6587;&amp;#x4EF6;</span><br><span class="line">        wc.to_file(pic)</span><br><span class="line"></span><br><span class="line">#&amp;#x521B;&amp;#x5EFA;</span><br><span class="line">r = HttpRequest()</span><br><span class="line">obj = CSDNDataFetcher()</span><br><span class="line">obj.setHttpRequest(r)</span><br><span class="line"></span><br><span class="line">data = obj.getRank(100)</span><br><span class="line">obj.save_data_to_excel(data[&#x27;data&#x27;][&quot;payColumnRankListItemList&quot;])</span><br><span class="line"></span><br><span class="line">text = obj.read_column_from_excel(&quot;data.xlsx&quot;, &quot;Sheet1&quot;, &quot;columnName&quot;)</span><br><span class="line">tiles = obj.extract_top_keywords(text)</span><br><span class="line">obj.writePng(&quot;test.jpg&quot;, tiles)</span><br></pre></td></tr></table></figure><h2 id="7-æœ€ç»ˆçš„æˆæœ"><a href="#7-æœ€ç»ˆçš„æˆæœ" class="headerlink" title="7.æœ€ç»ˆçš„æˆæœ"></a>7.æœ€ç»ˆçš„æˆæœ</h2><blockquote><p>ä½ ä»¬çœŸçš„å¥½å·!!!</p></blockquote><p>ä¸ºäº†èµ„æœ¬å·!!!</p><p>ä¸ºäº†æŠ€æœ¯å·!!!</p><p>å¹´åº•åˆ†å¤šå°‘é’±!!!</p><p>ä»Šå¹´åŠ å¤šå°‘ç­!!!</p><p>ç»©æ•ˆæ€ä¹ˆæ ·!!!</p><p>æ²‰æ·€æ²‰æ·€å§ï¼Œæœ‰äº›äº‹æˆ‘éƒ½ä¸çŸ¥é“æ€ä¹ˆè¯´ã€‚</p><p><img src="https://img-blog.csdnimg.cn/direct/4931ba9c431441f7a3c8eacf9dbdb573.jpeg">)</p><ul><li>ç›®æ ‡æ£€æµ‹ä¸è®¡ç®—æœºè§†è§‰ï¼šYOLOv8ã€YOLOv5ã€YOLOv8-segæ˜¯ç›®æ ‡æ£€æµ‹ç®—æ³•çš„ä¸åŒç‰ˆæœ¬ï¼ŒèŠ’æœæ”¹è¿›YOLOè¿›é˜¶æŒ‡å—å’ŒYOLOv8æ”¹è¿›å®æˆ˜ä¸“æ æä¾›äº†å…³äºç›®æ ‡æ£€æµ‹ç®—æ³•çš„æ”¹è¿›å’Œå®è·µç»éªŒã€‚æ­¤å¤–ï¼Œæ·±åº¦å­¦ä¹ ã€ç‚¹äº‘å¤„ç†ã€è®¡ç®—æœºè§†è§‰ç­‰ä¹Ÿæ˜¯ä¸ç›®æ ‡æ£€æµ‹ç›¸å…³çš„çƒ­é—¨é¢†åŸŸã€‚</li><li>ç³»ç»Ÿå¼€å‘ä¸åµŒå…¥å¼ï¼šåä¸ºODæœºè¯•ä¸“æ ã€Androidå¼€å‘ã€Autosarã€FPGAã€å•ç‰‡æœºã€ARMå¼€å‘ç­‰ä¸“æ æ¶‰åŠäº†ç³»ç»Ÿå¼€å‘ã€åµŒå…¥å¼å¼€å‘ã€åº•å±‚ç¼–ç¨‹ç­‰æ–¹é¢çš„å†…å®¹ï¼Œé€‚åˆå¯¹ç³»ç»Ÿå¼€å‘å’ŒåµŒå…¥å¼æŠ€æœ¯æ„Ÿå…´è¶£çš„äººã€‚</li><li>æ•°æ®ç§‘å­¦ä¸æœºå™¨å­¦ä¹ ï¼šåŒ…æ‹¬Pythonã€Rè¯­è¨€ã€XGBoostã€BPç¥ç»ç½‘ç»œã€æ—¶é—´åºåˆ—åˆ†æï¼ˆARIMAå’ŒGARCHï¼‰ç­‰ä¸“æ ï¼Œæ¶µç›–äº†æ•°æ®ç§‘å­¦ã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ç­‰é¢†åŸŸçš„å†…å®¹ï¼Œé€‚åˆå¯¹æ•°æ®åˆ†æå’Œæœºå™¨å­¦ä¹ ç®—æ³•æ„Ÿå…´è¶£çš„äººã€‚</li><li>ç‰©è”ç½‘ä¸äººå·¥æ™ºèƒ½ï¼šæ™ºèƒ½å®¶å±…ä¸ç‰©è”ç½‘é¡¹ç›®å®æˆ˜ã€ç‰©è”ç½‘AIOTã€ESP8266&#x2F;ESP32ç­‰ä¸“æ å…³æ³¨ç‰©è”ç½‘åº”ç”¨å’Œç‰©è”ç½‘è®¾å¤‡çš„å¼€å‘ï¼ŒåŒæ—¶æ¶‰åŠåˆ°ä¸äººå·¥æ™ºèƒ½ç›¸å…³çš„æŠ€æœ¯ã€‚</li><li>MATLABåº”ç”¨ï¼šMATLABä¸“æ æä¾›äº†å„ç±»MATLABä»£ç å’Œå·¥å…·çš„ä½¿ç”¨ï¼Œé€‚åˆå¯¹MATLABç¼–ç¨‹å’Œåº”ç”¨æ„Ÿå…´è¶£çš„äººã€‚</li></ul><h2 id="8-æƒŠäººçœŸç›¸åœ¨è¿™é‡Œ"><a href="#8-æƒŠäººçœŸç›¸åœ¨è¿™é‡Œ" class="headerlink" title=";  8.æƒŠäººçœŸç›¸åœ¨è¿™é‡Œ"></a><a name="8_337">;</a>  8.æƒŠäººçœŸç›¸åœ¨è¿™é‡Œ</h2><p><strong>ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³</strong><br>ä½ ä»¬å¥½å·ï¼Œå†è§ï¼</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>pythonçš„requestsåœ¨ç½‘ç»œè¯·æ±‚ä¸­æ·»åŠ cookieså‚æ•°</title>
      <link href="/2024/03/python-python%E7%9A%84requests%E5%9C%A8%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%AD%E6%B7%BB%E5%8A%A0cookies%E5%8F%82%E6%95%B0/"/>
      <url>/2024/03/python-python%E7%9A%84requests%E5%9C%A8%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%AD%E6%B7%BB%E5%8A%A0cookies%E5%8F%82%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p>å“ï¼Œå¥½ä¹…æ²¡æœ‰å­¦ä¹ çˆ¬è™«äº†ï¼Œç°åœ¨æƒ³è¦é‡æ–°æ‹¾èµ·æ¥ã€‚å‘ç°ä¹‹å‰å­¦ä¹ çˆ¬è™«æœ‰äº›ç²—ç³™ï¼Œç«Ÿç„¶è¿requestsä¸­æ·»åŠ cookieséƒ½æ²¡æœ‰æŒæ¡ï¼Œæƒ­æ„§ã€‚åºŸè¯ä¸å®œå¤šï¼Œç›´æ¥ä¸Šå†…å®¹ã€‚</p><p>æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨requestsè·å–ç½‘ç»œå†…å®¹å¾ˆç®€å•ï¼Œå‡ è¡Œä»£ç æå®šäº†ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">res=requests.get(<span class="string">&quot;https://cloud.flyme.cn/browser/index.jsp&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> res.content</span><br></pre></td></tr></table></figure><p>ä½ æ²¡æœ‰çœ‹é”™ï¼ŒçœŸçš„åªæœ‰ä¸‰è¡Œä»£ç ã€‚ä½†æ˜¯ç®€å•å½’ç®€å•ï¼Œé—®é¢˜è¿˜æ˜¯ä¸å°‘çš„ã€‚</p><p>é¦–å…ˆï¼Œè¿™é‡Œçš„è¯·æ±‚åªæ˜¯getæ–¹æ³•ï¼Œå¹¶ä¸”æ²¡æœ‰è§£å†³cookiesçš„é—®é¢˜ã€‚</p><p>ç„¶åå°±æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰è§£å†³ä¹±ç çš„é—®é¢˜ã€‚ï¼ˆä¹±ç æ˜¯pythonä¸­çš„å˜æ€ç‚¹ï¼‰</p><p>å…¶å®ï¼Œåœ¨requestsçš„getæ–¹æ³•ä¸­æ·»åŠ cookiesçš„æ–¹æ³•ä¸éš¾ å¯ä»¥è¿™æ ·å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res=requests.get(<span class="string">&quot;https://cloud.flyme.cn/browser/index.jsp&quot;</span>,cookies=cookies)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰€é¢ä¸´çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•æ„é€ è¿™é‡Œçš„cookiesã€‚</p><p>è¿™é‡Œçš„cookiesæ˜¯ä¸€ä¸ªå­—å…¸æ ¼å¼çš„æ•°æ®ã€‚</p><p>å¹³æ—¶æˆ‘ä»¬æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼Œåœ¨å®¡æŸ¥å…ƒç´ ä¸­å¯ä»¥æŸ¥çœ‹åˆ°æ‰€è®¿é—®ç½‘é¡µçš„cookieså†…å®¹ï¼Œå¤§éƒ½æ˜¯è¿™æ ·å­çš„ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sn_openNetBySms=%23810EBMA3TE53; sn_map=810EBMA3TE53; DSESSIONID=f1987887-3d1d-4a85-ad75-c6270e588290; JSESSIONID=; _uid=; _keyLogin=; _rmtk=; _uticket=ns_0393027c2f9f686e3499e8ebb8d1d622; _ckk=ns_397a592791064029bf1336eff1cf516e; ucuid=8a135520affa423584307f6e2c210f02; _domain=cloud.flyme.cn; _islogin=true; lang=zh_CN; JSESSIONID=1gmfzynp0ns6s1u6a92xkqgi6q</span><br></pre></td></tr></table></figure><p>å¤©é‚£ï¼Œè¿™æ˜¯äººçœ‹çš„å—ï¼Ÿä¸æ˜¯ã€‚è¿™æ˜¯ç»è¿‡åŠ å¯†å¤„ç†åçš„æ•°æ®ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŠ å¯†åçš„æ•°æ®ä¼ é€’åˆ°getæ–¹æ³•çš„cookieså‚æ•°ä¸­ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†åŠ å¯†åçš„æ•°æ®è¿›è¡Œè§£å¯†ï¼Œå†æ£€æŸ¥æ•°æ®çš„æ­£ç¡®æ€§ã€‚</p><p>è‡³äºï¼Œå¦‚ä½•æŸ¥çœ‹æ‰€è®¿é—®ç½‘é¡µçš„cookieså†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨æµè§ˆå™¨çš„å®¡æŸ¥åŠŸèƒ½ï¼ŒF12æˆ–è€…å³å‡»å®¡æŸ¥ï¼ˆChromeï¼‰æ‰“å¼€ã€‚åœ¨networkä¸­æŸ¥çœ‹é“¾æ¥çš„Headerså†…å®¹ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è½¯ä»¶æŠ“åŒ…æŸ¥çœ‹ï¼Œå¦‚Fiddler web Debuggerã€‚</p><p>è¿™é‡Œå‡è®¾è·å–åˆ°äº†cookiesçš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä¿å­˜åˆ°æœ¬åœ°TXTæ–‡ä»¶ä¸­ï¼ˆç›´æ¥æŠŠcookiesçš„å†…å®¹ç²˜è´´è¿›å»å³å¯ï¼‰ï¼Œä¾‹å¦‚test.txtæ–‡ä»¶ã€‚</p><p>ç„¶åï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f=<span class="built_in">open</span>(<span class="string">r&#x27;test.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)<span class="comment">#æ‰“å¼€æ‰€ä¿å­˜çš„cookieså†…å®¹æ–‡ä»¶</span></span><br><span class="line">cookies=&#123;&#125;<span class="comment">#åˆå§‹åŒ–cookieså­—å…¸å˜é‡</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.read().split(<span class="string">&#x27;;&#x27;</span>):   <span class="comment">#æŒ‰ç…§å­—ç¬¦ï¼šè¿›è¡Œåˆ’åˆ†è¯»å–</span></span><br><span class="line">    <span class="comment">#å…¶è®¾ç½®ä¸º1å°±ä¼šæŠŠå­—ç¬¦ä¸²æ‹†åˆ†æˆ2ä»½</span></span><br><span class="line">    name,value=line.strip().split(<span class="string">&#x27;=&#x27;</span>,<span class="number">1</span>)</span><br><span class="line">    cookies[name]=value  <span class="comment">#ä¸ºå­—å…¸cookiesæ·»åŠ å†…å®¹</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æˆ‘ä»¬å°†cookiesæ·»åŠ åˆ°getæ–¹æ³•ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res=requests.get(<span class="string">&quot;https://cloud.flyme.cn/browser/index.jsp&quot;</span>,cookies=cookies)</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™è·å–åˆ°çš„res.contentä¸­å°±æ˜¯æˆ‘ä»¬å°†cookiesä¿¡æ¯æ·»åŠ åˆ°getä¸­åè®¿é—®ç½‘é¡µæ‰€è·å–çš„å†…å®¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
          <category> requests </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€STM32ã€‘HALåº“_STM32CubeMXæ•™ç¨‹åä¸‰---RTCæ—¶é’Ÿ</title>
      <link href="/2024/03/stm32-%E3%80%90STM32%E3%80%91HAL%E5%BA%93-STM32CubeMX%E6%95%99%E7%A8%8B%E5%8D%81%E4%B8%89-RTC%E6%97%B6%E9%92%9F/"/>
      <url>/2024/03/stm32-%E3%80%90STM32%E3%80%91HAL%E5%BA%93-STM32CubeMX%E6%95%99%E7%A8%8B%E5%8D%81%E4%B8%89-RTC%E6%97%B6%E9%92%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>å‰è¨€ï¼š</p><p>æœ¬ç³»åˆ—æ•™ç¨‹å°† å¯¹åº”å¤–è®¾åŸç†ï¼ŒHALåº“ä¸STM32CubeMXç»“åˆåœ¨ä¸€èµ·è®²è§£ï¼Œä½¿æ‚¨å¯ä»¥æ›´å¿«é€Ÿçš„å­¦ä¼šå„ä¸ªæ¨¡å—çš„ä½¿ç”¨</p><p>æ‰€ç”¨å·¥å…·ï¼š</p><p>1ã€èŠ¯ç‰‡ï¼š STM32F407ZET6&#x2F; STM32F103ZET6</p><p>2ã€STM32CubeMxè½¯ä»¶</p><p>3ã€IDEï¼š MDK-Keilè½¯ä»¶</p><p>4ã€STM32F1xx&#x2F;STM32F4xxHALåº“</p><p>çŸ¥è¯†æ¦‚æ‹¬ï¼š</p><p>é€šè¿‡æœ¬ç¯‡åšå®¢æ‚¨å°†å­¦åˆ°ï¼š</p><p>RTCæ—¶é’ŸåŸç†</p><p>STM32CubeMXåˆ›å»ºRTCä¾‹ç¨‹</p><p>HALåº“å®šæ—¶å™¨RTCå‡½æ•°åº“</p><p><strong>PS: è¿™é‡Œçš„RTCè®²è§£ï¼Œæˆ‘ä»¬åªå°†åŸç†ï¼Œä¸è®²å¯„å­˜å™¨ï¼Œå¦‚æœè¦çœ‹RTCçš„å¯„å­˜å™¨ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« </strong> <a href="https://blog.csdn.net/as480133937/article/details/105026033">ã€STM32ã€‘RTCå®æ—¶æ—¶é’Ÿï¼Œæ­¥éª¤è¶…ç»†è¯¦è§£ï¼Œä¸€æ–‡çœ‹æ‡‚RTC</a></p><h3 id="ä»€ä¹ˆæ˜¯RTC"><a href="#ä»€ä¹ˆæ˜¯RTC" class="headerlink" title="ä»€ä¹ˆæ˜¯RTC"></a>ä»€ä¹ˆæ˜¯RTC</h3><p>**RTC (Real Time Clock)**ï¼šå®æ—¶æ—¶é’Ÿ</p><p><strong>RTCæ˜¯ä¸ªç‹¬ç«‹çš„å®šæ—¶å™¨</strong>ã€‚RTCæ¨¡å—æ‹¥æœ‰ä¸€ä¸ªè¿ç»­è®¡æ•°çš„è®¡æ•°å™¨ï¼Œåœ¨ç›¸åº”çš„è½¯ä»¶é…ç½®ä¸‹ï¼Œå¯ä»¥æä¾›æ—¶é’Ÿæ—¥å†çš„åŠŸèƒ½ã€‚ä¿®æ”¹è®¡æ•°å™¨çš„å€¼å¯ä»¥é‡æ–°è®¾ç½®å½“å‰æ—¶é—´å’Œæ—¥æœŸ RTCè¿˜åŒ…å«ç”¨äºç®¡ç†ä½åŠŸè€—æ¨¡å¼çš„è‡ªåŠ¨å”¤é†’å•å…ƒã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200423215123488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200423215123488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p><strong>åœ¨æ–­ç”µæƒ…å†µä¸‹ RTCä»å¯ä»¥ç‹¬ç«‹è¿è¡Œ åªè¦èŠ¯ç‰‡çš„å¤‡ç”¨ç”µæºä¸€ç›´ä¾›ç”µ,RTCä¸Šçš„æ—¶é—´ä¼šä¸€ç›´èµ°ã€‚</strong></p><p>RTCå®è´¨æ˜¯ä¸€ä¸ªæ‰ç”µåè¿˜ç»§ç»­è¿è¡Œçš„å®šæ—¶å™¨,ä»å®šæ—¶å™¨çš„è§’åº¦æ¥çœ‹,ç›¸å¯¹äºé€šç”¨å®šæ—¶å™¨TIMå¤–è®¾,å®ƒçš„åŠŸèƒ½ååˆ†ç®€å•,åªæœ‰è®¡æ—¶åŠŸèƒ½(ä¹Ÿå¯ä»¥è§¦å‘ä¸­æ–­)ã€‚ä½†å…¶é«˜çº§æŒ‡å‡ºä¹Ÿå°±åœ¨äºæ‰ç”µä¹‹åè¿˜å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><p>ä¸¤ä¸ª 32 ä½å¯„å­˜å™¨åŒ…å«äºŒè¿›ç åè¿›æ•°æ ¼å¼ (BCD) çš„ç§’ã€åˆ†é’Ÿã€å°æ—¶ï¼ˆ 12 æˆ– 24 å°æ—¶åˆ¶ï¼‰ã€æ˜ŸæœŸå‡ ã€æ—¥æœŸã€æœˆä»½å’Œå¹´ä»½ã€‚æ­¤å¤–ï¼Œè¿˜å¯æä¾›äºŒè¿›åˆ¶æ ¼å¼çš„äºšç§’å€¼ã€‚ç³»ç»Ÿå¯ä»¥è‡ªåŠ¨å°†æœˆä»½çš„å¤©æ•°è¡¥å¿ä¸º 28ã€29ï¼ˆé—°å¹´ï¼‰ã€30 å’Œ 31 å¤©ã€‚</p><p>ä¸Šç”µå¤ä½åï¼Œæ‰€æœ‰RTCå¯„å­˜å™¨éƒ½ä¼šå—åˆ°ä¿æŠ¤ï¼Œä»¥é˜²æ­¢å¯èƒ½çš„éæ­£å¸¸å†™è®¿é—®ã€‚</p><p>æ— è®ºå™¨ä»¶çŠ¶æ€å¦‚ä½•ï¼ˆè¿è¡Œæ¨¡å¼ã€ä½åŠŸè€—æ¨¡å¼æˆ–å¤„äºå¤ä½çŠ¶æ€ï¼‰ï¼Œåªè¦ç”µæºç”µå‹ä¿æŒåœ¨å·¥ä½œèŒƒå›´å†…ï¼ŒRTCä½¿ä¸ä¼šåœæ­¢å·¥ä½œã€‚</p><h4 id="RCTç‰¹å¾ï¼š"><a href="#RCTç‰¹å¾ï¼š" class="headerlink" title="RCTç‰¹å¾ï¼š"></a><strong>RCTç‰¹å¾ï¼š</strong></h4><p>â— <strong>å¯ç¼–ç¨‹çš„é¢„åˆ†é¢‘ç³»æ•°ï¼šåˆ†é¢‘ç³»æ•°é«˜ä¸º220ã€‚</strong> â— <strong>32ä½çš„å¯ç¼–ç¨‹è®¡æ•°å™¨ï¼Œå¯ç”¨äºè¾ƒé•¿æ—¶é—´æ®µçš„æµ‹é‡ã€‚</strong> â— <strong>2ä¸ªåˆ†ç¦»çš„æ—¶é’Ÿï¼šç”¨äºAPB1æ¥å£çš„PCLK1å’ŒRTCæ—¶é’Ÿ(RTCæ—¶é’Ÿçš„é¢‘ç‡å¿…é¡»å°äºPCLK1æ—¶é’Ÿ é¢‘ç‡çš„å››åˆ†ä¹‹ä¸€ä»¥ä¸Š)ã€‚</strong> â— å¯ä»¥é€‰æ‹©ä»¥ä¸‹<strong>ä¸‰ç§RTCçš„æ—¶é’Ÿæº</strong>ï¼š Â Â Â Â  â— HSEæ—¶é’Ÿé™¤ä»¥128ï¼› Â Â Â Â  â— LSEæŒ¯è¡å™¨æ—¶é’Ÿï¼› Â Â Â Â  â— LSIæŒ¯è¡å™¨æ—¶é’Ÿ</p><p>â— <strong>2ä¸ªç‹¬ç«‹çš„å¤ä½ç±»å‹ï¼š</strong> Â Â Â Â  â— APB1æ¥å£ç”±ç³»ç»Ÿå¤ä½ï¼› Â Â Â Â  â— RTCæ ¸å¿ƒ(é¢„åˆ†é¢‘å™¨ã€é—¹é’Ÿã€è®¡æ•°å™¨å’Œåˆ†é¢‘å™¨)åªèƒ½ç”±åå¤‡åŸŸå¤ä½</p><p>â— <strong>3ä¸ªä¸“é—¨çš„å¯å±è”½ä¸­æ–­ï¼š</strong> Â Â Â Â  â— 1.<strong>é—¹é’Ÿä¸­æ–­</strong>ï¼Œç”¨æ¥äº§ç”Ÿä¸€ä¸ªè½¯ä»¶å¯ç¼–ç¨‹çš„é—¹é’Ÿä¸­æ–­ã€‚</p><p>Â Â Â Â  â— 2.<strong>ç§’ä¸­æ–­</strong>ï¼Œç”¨æ¥äº§ç”Ÿä¸€ä¸ªå¯ç¼–ç¨‹çš„å‘¨æœŸæ€§ä¸­æ–­ä¿¡å·(é•¿å¯è¾¾1ç§’)ã€‚</p><p>Â Â Â Â  â— 3.<strong>æº¢å‡ºä¸­æ–­</strong>ï¼ŒæŒ‡ç¤ºå†…éƒ¨å¯ç¼–ç¨‹è®¡æ•°å™¨æº¢å‡ºå¹¶å›è½¬ä¸º0çš„çŠ¶æ€ã€‚</p><p><strong>RTCæ—¶é’Ÿæºï¼š</strong> ä¸‰ç§ä¸åŒçš„æ—¶é’Ÿæºå¯è¢«ç”¨æ¥é©±åŠ¨ç³»ç»Ÿæ—¶é’Ÿ(SYSCLK)ï¼š</p><p>â— <strong>HSIæŒ¯è¡å™¨æ—¶é’Ÿ</strong> â— <strong>HSEæŒ¯è¡å™¨æ—¶é’Ÿ</strong> â— <strong>PLLæ—¶é’Ÿ</strong></p><p>è¿™äº›è®¾å¤‡æœ‰ä»¥ä¸‹2ç§äºŒçº§æ—¶é’Ÿæºï¼š</p><p>â— 40kHzä½é€Ÿå†…éƒ¨RCï¼Œå¯ä»¥ç”¨äºé©±åŠ¨ç‹¬ç«‹çœ‹é—¨ç‹—å’Œé€šè¿‡ç¨‹åºé€‰æ‹©é©±åŠ¨RTCã€‚ RTCç”¨äºä»åœæœº&#x2F;å¾…æœºæ¨¡å¼ä¸‹è‡ªåŠ¨å”¤é†’ç³»ç»Ÿã€‚ â— 32.768kHzä½é€Ÿå¤–éƒ¨æ™¶ä½“ä¹Ÿå¯ç”¨æ¥é€šè¿‡ç¨‹åºé€‰æ‹©é©±åŠ¨RTC(RTCCLK)ã€‚</p><h4 id="RTCåŸç†æ¡†å›¾"><a href="#RTCåŸç†æ¡†å›¾" class="headerlink" title="RTCåŸç†æ¡†å›¾"></a>RTCåŸç†æ¡†å›¾</h4><p><img src="https://img-blog.csdnimg.cn/20200322144525734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200322144525734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"><br> RTCæ—¶é’Ÿçš„æ¡†å›¾è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠä»–åˆ†æˆ <strong><code>ä¸¤ä¸ªéƒ¨åˆ†</code></strong>:</p><p><strong>APB1 æ¥å£</strong>ï¼šç”¨æ¥å’Œ APB1 æ€»çº¿ç›¸è¿ã€‚ æ­¤å•å…ƒè¿˜åŒ…å«ä¸€ç»„ 16 ä½å¯„å­˜å™¨ï¼Œå¯é€šè¿‡ APB1 æ€»çº¿å¯¹å…¶è¿›è¡Œè¯»å†™æ“ä½œã€‚APB1 æ¥å£ç”± APB1 æ€» çº¿æ—¶é’Ÿé©±åŠ¨ï¼Œç”¨æ¥ä¸ APB1 æ€»çº¿è¿æ¥ã€‚</p><p>é€šè¿‡APB1æ¥å£å¯ä»¥è®¿é—®RTCçš„ç›¸å…³å¯„å­˜å™¨ï¼ˆé¢„åˆ†é¢‘å€¼ï¼Œè®¡æ•°å™¨å€¼ï¼Œé—¹é’Ÿå€¼ï¼‰ã€‚</p><p><strong>RTC æ ¸å¿ƒæ¥å£</strong>ï¼šç”±ä¸€ç»„å¯ç¼–ç¨‹è®¡æ•°å™¨ç»„æˆï¼Œåˆ†æˆ <strong><code>ä¸¤ä¸ªä¸»è¦æ¨¡å—</code></strong> ã€‚<br><img src="https://img-blog.csdnimg.cn/20200322223612113.png" alt="https://img-blog.csdnimg.cn/20200322223612113.png"><br>g) <strong>ç¬¬ä¸€ä¸ªæ¨¡å—æ˜¯ RTC çš„ é¢„åˆ†é¢‘æ¨¡å—</strong>ï¼Œå®ƒå¯ç¼–ç¨‹äº§ç”Ÿ 1 ç§’çš„ RTC æ—¶é—´åŸºå‡† TR_CLKã€‚RTC çš„é¢„åˆ†é¢‘æ¨¡å—åŒ…å«äº†ä¸€ä¸ª 20 ä½çš„å¯ç¼–ç¨‹åˆ†é¢‘å™¨(RTC é¢„åˆ†é¢‘å™¨)ã€‚å¦‚æœåœ¨ RTC_CR å¯„å­˜å™¨ä¸­è®¾ç½®äº†ç›¸åº”çš„å…è®¸ä½ï¼Œåˆ™åœ¨æ¯ä¸ª TR_CLK å‘¨æœŸä¸­ RTC äº§ç”Ÿä¸€ä¸ªä¸­æ–­(ç§’ä¸­æ–­)ã€‚<br><img src="https://img-blog.csdnimg.cn/2020032222362770.png" alt="https://img-blog.csdnimg.cn/2020032222362770.png"><br> <strong>ç¬¬äºŒä¸ªæ¨¡å—æ˜¯ä¸€ä¸ª 32 ä½çš„å¯ç¼–ç¨‹è®¡æ•°å™¨ ï¼ˆRTC_CNTï¼‰</strong>ï¼Œå¯è¢«åˆå§‹åŒ–ä¸ºå½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œä¸€ä¸ª 32 ä½çš„æ—¶é’Ÿè®¡æ•°å™¨ï¼ŒæŒ‰ç§’é’Ÿè®¡ç®—ï¼Œå¯ä»¥è®° å½• 4294967296 ç§’ï¼Œçº¦åˆ 136 å¹´å·¦å³ï¼Œä½œä¸ºä¸€èˆ¬åº”ç”¨ï¼Œè¿™å·²ç»æ˜¯è¶³å¤Ÿäº†çš„ã€‚</p><h4 id="RTCå…·ä½“æµç¨‹ï¼š"><a href="#RTCå…·ä½“æµç¨‹ï¼š" class="headerlink" title="RTCå…·ä½“æµç¨‹ï¼š"></a><strong>RTCå…·ä½“æµç¨‹ï¼š</strong></h4><p><strong>RTCCLKç»è¿‡RTC_DIVé¢„åˆ†é¢‘ï¼ŒRTC_PRLè®¾ç½®é¢„åˆ†é¢‘ç³»æ•°ï¼Œç„¶åå¾—åˆ°TR_CLKæ—¶é’Ÿä¿¡å·ï¼Œæˆ‘ä»¬ä¸€èˆ¬è®¾ç½®å…¶å‘¨æœŸä¸º1sï¼ŒRTC_CNTè®¡æ•°å™¨è®¡æ•°ï¼Œå‡å¦‚1970è®¾ç½®ä¸ºæ—¶é—´èµ·ç‚¹ä¸º0sï¼Œé€šè¿‡å½“å‰æ—¶é—´çš„ç§’æ•°è®¡ç®—å¾—åˆ°å½“å‰çš„æ—¶é—´ã€‚RTC_ALRæ˜¯è®¾ç½®é—¹é’Ÿæ—¶é—´ï¼ŒRTC_CNTè®¡æ•°åˆ°RTC_ALRå°±ä¼šäº§ç”Ÿè®¡æ•°ä¸­æ–­ï¼Œ</strong></p><ul><li><strong>RTC_Second</strong>ä¸ºç§’ä¸­æ–­ï¼Œç”¨äºåˆ·æ–°æ—¶é—´ï¼Œ+ <strong>RTC_Overflow</strong>æ˜¯æº¢å‡ºä¸­æ–­ã€‚+ <strong>RTC Alarm</strong> æ§åˆ¶å¼€å…³æœº</li></ul><h4 id="RTCæ—¶é’Ÿé€‰æ‹©"><a href="#RTCæ—¶é’Ÿé€‰æ‹©" class="headerlink" title="RTCæ—¶é’Ÿé€‰æ‹©"></a>RTCæ—¶é’Ÿé€‰æ‹©</h4><p><strong>ä½¿ç”¨HSEåˆ†é¢‘æ—¶é’Ÿæˆ–è€…LSIçš„æ—¶å€™,åœ¨ä¸»ç”µæºVDDæ‰ç”µçš„æƒ…å†µä¸‹,è¿™ä¸¤ä¸ªæ—¶é’Ÿæ¥æºéƒ½ä¼šå—åˆ°å½±å“,å› æ­¤æ²¡æ³•ä¿è¯RTCæ­£å¸¸å·¥ä½œ.æ‰€ä»¥RTCä¸€èˆ¬éƒ½æ—¶é’Ÿä½é€Ÿå¤–éƒ¨æ—¶é’ŸLSE,é¢‘ç‡ä¸ºå®æ—¶æ—¶é’Ÿæ¨¡å—ä¸­å¸¸ç”¨çš„32.768KHz,å› ä¸º32768 &#x3D; 2^15,åˆ†é¢‘å®¹æ˜“å®ç°,æ‰€ä»¥è¢«å¹¿æ³›åº”ç”¨åˆ°RTCæ¨¡å—.(åœ¨ä¸»ç”µæºVDDæœ‰æ•ˆçš„æƒ…å†µä¸‹(å¾…æœº),RTCè¿˜å¯ä»¥é…ç½®é—¹é’Ÿäº‹ä»¶ä½¿STM32é€€å‡ºå¾…æœºæ¨¡å¼).</strong></p><h4 id="RTCå¤ä½è¿‡ç¨‹"><a href="#RTCå¤ä½è¿‡ç¨‹" class="headerlink" title="RTCå¤ä½è¿‡ç¨‹"></a>RTCå¤ä½è¿‡ç¨‹</h4><p>é™¤äº†RTC_PRLã€RTC_ALRã€RTC_CNTå’ŒRTC_DIVå¯„å­˜å™¨å¤–ï¼Œæ‰€æœ‰çš„ç³»ç»Ÿå¯„å­˜å™¨éƒ½ç”±ç³»ç»Ÿå¤ä½æˆ–ç”µæºå¤ä½è¿›è¡Œå¼‚æ­¥å¤ä½ã€‚ RTC_PRLã€RTC_ALRã€RTC_CNTå’ŒRTC_DIVå¯„å­˜å™¨ä»…èƒ½é€šè¿‡å¤‡ä»½åŸŸå¤ä½ä¿¡å·å¤ä½ã€‚</p><p><strong>ç³»ç»Ÿå¤ä½å,ç¦æ­¢è®¿é—®åå¤‡å¯„å­˜å™¨å’ŒRCT,é˜²æ­¢å¯¹åå«åŒºåŸŸ(BKP)çš„æ„å¤–å†™æ“ä½œ</strong></p><h4 id="RTCä¸­æ–­"><a href="#RTCä¸­æ–­" class="headerlink" title="RTCä¸­æ–­"></a>RTCä¸­æ–­</h4><p><strong>ç§’ä¸­æ–­ï¼š</strong> è¿™é‡Œæ—¶é’Ÿè‡ªå¸¦ä¸€ä¸ªç§’ä¸­æ–­ï¼Œæ¯å½“è®¡æ•°åŠ ä¸€çš„æ—¶å€™å°±ä¼šè§¦å‘ä¸€æ¬¡ç§’ä¸­æ–­ï¼Œã€‚æ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„ç§’ä¸­æ–­å¹¶éä¸€å®šæ˜¯ä¸€ç§’çš„æ—¶é—´ï¼Œå®ƒæ˜¯ç”±RTCæ—¶é’Ÿæºå’Œåˆ†é¢‘å€¼å†³å®šçš„â€œç§’â€çš„æ—¶é—´ï¼Œå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥åšåˆ°1ç§’é’Ÿä¸­æ–­ä¸€æ¬¡ã€‚æˆ‘ä»¬é€šè¿‡å¾€ç§’ä¸­æ–­é‡Œå†™æ›´æ–°æ—¶é—´çš„å‡½æ•°æ¥è¾¾åˆ°æ—¶é—´åŒæ­¥çš„æ•ˆæœ</p><p><strong>é—¹é’Ÿä¸­æ–­ï¼š</strong> é—¹é’Ÿä¸­æ–­å°±æ˜¯è®¾ç½®ä¸€ä¸ªé¢„è®¾å®šçš„å€¼ï¼Œè®¡æ•°æ¯è‡ªåŠ å¤šå°‘æ¬¡è§¦å‘ä¸€æ¬¡é—¹é’Ÿä¸­æ–­</p><h3 id="CubeMXé…ç½®RTC"><a href="#CubeMXé…ç½®RTC" class="headerlink" title="CubeMXé…ç½®RTC"></a>CubeMXé…ç½®RTC</h3><h4 id="å·¥ç¨‹åˆ›å»º"><a href="#å·¥ç¨‹åˆ›å»º" class="headerlink" title="å·¥ç¨‹åˆ›å»º"></a>å·¥ç¨‹åˆ›å»º</h4><p><strong>1è®¾ç½®RCC</strong><br><img src="https://img-blog.csdnimg.cn/20200425101549368.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425101549368.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li><strong>è®¾ç½®é«˜é€Ÿå¤–éƒ¨æ—¶é’ŸHSE é€‰æ‹©å¤–éƒ¨æ—¶é’Ÿæº</strong>+ <strong>ä½¿èƒ½å¤–éƒ¨æ™¶æŒ¯LSE</strong></li></ul><p><strong>RTCè®¾å¤‡å› ä¸ºå…¶ç‹¬ç‰¹çš„è¿è¡Œæ–¹å¼ï¼ˆå³æ‰ç”µä¾æ—§è¿è¡Œï¼‰ä½¿ç”¨HSEåˆ†é¢‘æ—¶é’Ÿæˆ–è€…LSIçš„æ—¶å€™,åœ¨ä¸»ç”µæºVDDæ‰ç”µçš„æƒ…å†µä¸‹,è¿™ä¸¤ä¸ªæ—¶é’Ÿæ¥æºéƒ½ä¼šå—åˆ°å½±å“ï¼Œèµ„æºæ¶ˆè€—å¤ªå¤§ï¼Œå°å°çš„çº½æ‰£ç”µæ± æ ¹æœ¬åƒä¸æ¶ˆã€‚æ²¡æ³•ä¿è¯RTCæ­£å¸¸å·¥ä½œ.æ‰€ä»¥RTCä¸€èˆ¬éƒ½æ—¶é’Ÿä½é€Ÿå¤–éƒ¨æ—¶é’ŸLSE</strong></p><p>2.<strong>é…ç½®RTC</strong><br><img src="https://img-blog.csdnimg.cn/20200425110730403.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425110730403.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li><strong>Activate Clock Source æ¿€æ´»æ—¶é’Ÿæº</strong>+ <strong>Activate calendaræ¿€æ´»æ—¥å†</strong></li></ul><p><strong>è¿™ä¸¤ä¸ªéƒ½è¦ç‚¹ï¼Œä½œç”¨ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå…ˆæ˜¯ä½¿èƒ½æ—¶é’Ÿæºï¼Œå†ä½¿èƒ½RTCæ—¥å†</strong></p><ul><li><strong>RTC_OUTï¼š Not RTC_OUT</strong>+ <strong>Tamperï¼š</strong> <strong>Ã—</strong></li></ul><p>ç¬¬ä¸€ä¸ªæ˜¯æ˜¯å¦ä½¿èƒ½ <strong>tamperï¼ˆPC13ï¼‰å¼•è„šä¸Šè¾“å‡ºæ ¡æ­£çš„ç§’è„‰å†²æ—¶é’Ÿï¼Œ</strong></p><p>ç¬¬äºŒä¸ªï¼š <strong>RTCå…¥ä¾µæ£€æµ‹æ ¡éªŒåŠŸèƒ½</strong></p><p><strong>RTCæ ¡éªŒåŠŸèƒ½ï¼Œä½¿èƒ½ä¾µå…¥æ£€æµ‹åŠŸèƒ½ã€‚RTCæ—¶é’Ÿç»64åˆ†é¢‘è¾“å‡ºåˆ°ä¾µå…¥æ£€æµ‹å¼•è„šTAMPERä¸Š å½“ TAMPERå¼•è„šä¸Šçš„ä¿¡å·ä» 0å˜æˆ1æˆ–è€…ä» 1å˜æˆ 0(å–å†³äºå¤‡ä»½æ§åˆ¶å¯„å­˜å™¨BKP_CRçš„ TPALä½)ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªä¾µå…¥æ£€æµ‹äº‹ä»¶ã€‚ä¾µå…¥æ£€æµ‹äº‹ä»¶å°†æ‰€æœ‰æ•°æ®å¤‡ä»½å¯„å­˜å™¨å†…å®¹æ¸…é™¤ã€‚</strong></p><ul><li>ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªæ˜¯ä½¿èƒ½tamperï¼ˆPC13ï¼‰å¼•è„šä½œä¸ºæ—¶é’Ÿè„‰å†²è¾“å‡º+ ç¬¬äºŒä¸ªæ˜¯ä½¿èƒ½tamperï¼ˆPC13ï¼‰å¼•è„šä½œä¸ºå…¥ä¾µæ£€æµ‹åŠŸèƒ½</li></ul><p>ä¸‹é¢æ˜¯ä¸¤ä¸ªRTCçš„ä¸­æ–­ï¼š</p><ul><li><strong>RTCå…¨å±€ä¸­æ–­RTC_IRQHandler()</strong>+ <strong>é—¹é’Ÿä¸­æ–­å‡½æ•°RTCAlarm_IRQHandler()</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/2020042514381771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/2020042514381771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p><strong>æ­¤å¤„è®¾ç½®æ—¶é—´ä¸º2020&#x2F;04&#x2F;25 13:30:00</strong></p><ul><li>Data Format: æ—¥æœŸæ ¼å¼</li></ul><p><strong>Binary data format åå…­è¿›åˆ¶ BCD data format BCDç è¿›åˆ¶</strong></p><p>ä½¿ç”¨è‡ªåŠ¨é…ç½®ï¼Œåˆå§‹åŒ–æ—¶é—´å¿…é¡»ä½¿ç”¨BCD data formatï¼ŒåŸå› æ˜¯åº“å‡½æ•°å­˜åœ¨bugï¼Œå¦‚æœä½¿ç”¨Binary data formatï¼Œæœˆä»½é…ç½®ä¼šå‡ºé”™ï¼Œæ¯”å¦‚è¯´11æœˆï¼Œé…ç½®æ—¶ä¼šèµ‹å€¼ä¸ºRTC_MONTH_NOVEMBERï¼Œè€Œæ­¤å®å®šä¹‰å€¼ä¸º0x11ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶åè¿›åˆ¶å€¼ä¸º17</p><ul><li><strong>Hoursï¼š å°æ—¶</strong> +  <strong>Minutesï¼š åˆ†é’Ÿ</strong> +  <strong>Secondsï¼š ç§’</strong> +  <strong>Week Dayï¼š æ˜ŸæœŸ</strong> +  <strong>Month æœˆä»½</strong> +  <strong>Dateï¼š æ—¥æœŸ</strong> +  <strong>Yearï¼š å¹´ä»½</strong></li></ul><p><strong>3 ä½¿èƒ½ä¸²å£</strong><br><img src="https://img-blog.csdnimg.cn/20200425143944495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425143944495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"><br> <strong>ä½¿èƒ½ä¸€ä¸‹ä¸²å£ï¼Œå› ä¸ºå‘é€æ—¥æœŸåˆ°ä¸Šä½æœº</strong></p><p><strong>4æ—¶é’Ÿæºè®¾ç½®</strong><br><img src="https://img-blog.csdnimg.cn/20200425144337169.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425144337169.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p>æˆ‘çš„æ˜¯ å¤–éƒ¨æ™¶æŒ¯ä¸º8MHz</p><ul><li>1é€‰æ‹©å¤–éƒ¨æ—¶é’ŸHSE 8MHz+ 2PLLé”ç›¸ç¯å€é¢‘9å€+ 3ç³»ç»Ÿæ—¶é’Ÿæ¥æºé€‰æ‹©ä¸ºPLL+ 4è®¾ç½®APB1åˆ†é¢‘å™¨ä¸º &#x2F;2+ 5 ä½¿èƒ½CSSç›‘è§†æ—¶é’Ÿ+ <strong>6 è®¾ç½®RTCæ—¶é’Ÿä¸ºLSE</strong></li></ul><p>32çš„æ—¶é’Ÿæ ‘æ¡†å›¾ å¦‚æœä¸æ‡‚çš„è¯è¯·çœ‹<a href="https://blog.csdn.net/as480133937/article/details/98845509">ã€Šã€STM32ã€‘ç³»ç»Ÿæ—¶é’ŸRCCè¯¦è§£(è¶…è¯¦ç»†ï¼Œè¶…å…¨é¢)ã€‹</a></p><p><strong>5é¡¹ç›®æ–‡ä»¶è®¾ç½®</strong><br><img src="https://img-blog.csdnimg.cn/20200425144600886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425144600886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li>1 è®¾ç½®é¡¹ç›®åç§°+ 2 è®¾ç½®å­˜å‚¨è·¯å¾„+ 3 é€‰æ‹©æ‰€ç”¨IDE<br><img src="https://img-blog.csdnimg.cn/2020042514462236.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/2020042514462236.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></li></ul><p><strong>6åˆ›å»ºå·¥ç¨‹æ–‡ä»¶</strong></p><p><strong>ç„¶åç‚¹å‡»GENERATE CODE åˆ›å»ºå·¥ç¨‹</strong></p><p><strong>é…ç½®ä¸‹è½½å·¥å…·</strong> æ–°å»ºçš„å·¥ç¨‹æ‰€æœ‰é…ç½®éƒ½æ˜¯é»˜è®¤çš„ æˆ‘ä»¬éœ€è¦è‡ªè¡Œé€‰æ‹©ä¸‹è½½æ¨¡å¼ï¼Œå‹¾é€‰ä¸Šä¸‹è½½åå¤ä½è¿è¡Œ</p><p><img src="https://img-blog.csdnimg.cn/202004251446415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/202004251446415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><h4 id="RTC-HALåº“å‡½æ•°"><a href="#RTC-HALåº“å‡½æ•°" class="headerlink" title="RTC_HALåº“å‡½æ•°"></a>RTC_HALåº“å‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*è®¾ç½®ç³»ç»Ÿæ—¶é—´*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span> </span><br><span class="line"><span class="comment">/*è¯»å–ç³»ç»Ÿæ—¶é—´*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*è®¾ç½®ç³»ç»Ÿæ—¥æœŸ*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*è¯»å–ç³»ç»Ÿæ—¥æœŸ*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*å¯åŠ¨æŠ¥è­¦åŠŸèƒ½*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetAlarm</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_AlarmTypeDef *sAlarm, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*è®¾ç½®æŠ¥è­¦ä¸­æ–­*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetAlarm_IT</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_AlarmTypeDef *sAlarm, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*æŠ¥è­¦æ—¶é—´å›è°ƒå‡½æ•°*/</span></span><br><span class="line">__weak <span class="keyword">void</span> <span class="title function_">HAL_RTC_AlarmAEventCallback</span><span class="params">(RTC_HandleTypeDef *hrtc)</span></span><br><span class="line"><span class="comment">/*å†™å…¥åå¤‡å‚¨å­˜å™¨*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">HAL_RTCEx_BKUPWrite</span><span class="params">(RTC_HandleTypeDef *hrtc, uint32_t BackupRegister, uint32_t Data)</span></span><br><span class="line"><span class="comment">/*è¯»å–åå¤‡å‚¨å­˜å™¨*/</span></span><br><span class="line">uint32_t <span class="title function_">HAL_RTCEx_BKUPRead</span><span class="params">(RTC_HandleTypeDef *hrtc, uint32_t BackupRegister  </span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢çš„å››ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯</p><ul><li><strong>è®¾ç½®ç³»ç»Ÿæ—¶é—´ï¼šHAL_RTC_SetTime();</strong>+ <strong>è¯»å–ç³»ç»Ÿæ—¶é—´: HAL_RTC_GetTime();</strong>+ <strong>è®¾ç½®ç³»ç»Ÿæ—¥æœŸ: HAL_RTC_SetDate();</strong>+ <strong>è¯»å–ç³»ç»Ÿæ—¥æœŸ: HAL_RTC_GetDate();</strong></li></ul><p>å› ä¸ºç³»ç»Ÿçš„æ—¶é—´å’Œæ—¥æœŸå¼€å§‹çš„æ—¶å€™å·²ç»è®¾ç½®è¿‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªç”¨ä¸¤ä¸ªè¯»å–å‡½æ•°</p><p> <strong>è¯»å–ç³»ç»Ÿæ—¶é—´å‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*è¯»å–ç³»ç»Ÿæ—¶é—´*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br></pre></td></tr></table></figure><p>åŠŸèƒ½ï¼š è·å–RTCæ—¶é’Ÿçš„æ—¶é—´</p><p>å‚æ•°ï¼š</p><ul><li>*hrtc RTCç»“æ„ä½“å‚æ•° ä¾‹ï¼š&amp;hi2c2 +  <strong>RTC_TimeTypeDef</strong> *sTimeï¼š è·å–RTCæ—¶é—´çš„ç»“æ„ä½“ï¼Œ +  Formatï¼š <strong>è·å–æ—¶é—´çš„æ ¼å¼</strong> <strong>RTC_FORMAT_BIN ä½¿ç”¨16è¿›åˆ¶ RTC_FORMAT_BCD ä½¿ç”¨BCDè¿›åˆ¶</strong></li></ul><p> <strong>è¯»å–ç³»ç»Ÿæ—¥æœŸå‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*è¯»å–ç³»ç»Ÿæ—¥æœŸ*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br></pre></td></tr></table></figure><p>åŠŸèƒ½ï¼š è·å–RTCæ—¶é’Ÿçš„æ—¥æœŸ</p><p>å‚æ•°ï¼š</p><ul><li>*hrtc RTCç»“æ„ä½“å‚æ•° ä¾‹ï¼š&amp;hi2c2 +  <strong>RTC_DateTypeDef</strong> *sTimeï¼š è·å–RTCæ—¥æœŸçš„ç»“æ„ä½“ï¼Œ +  Formatï¼š <strong>è·å–æ—¥æœŸçš„æ ¼å¼</strong> <strong>RTC_FORMAT_BIN ä½¿ç”¨16è¿›åˆ¶ RTC_FORMAT_BCD ä½¿ç”¨BCDè¿›åˆ¶</strong></li></ul><p>åœ¨stm32f1xx_hal_rtc.hå¤´æ–‡ä»¶ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°<code>RTC_TimeTypeDef</code>ï¼Œ<code>RTC_DateTypeDef</code>è¿™ä¸¤ä¸ªç»“æ„ä½“çš„æˆå‘˜å˜é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  * @brief  RTC Time structure definition</span><br><span class="line">  */</span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  uint8_t Hours;            /*!&lt; Specifies the RTC Time Hour.</span><br><span class="line">                                 This parameter must be a number between Min_Data = 0 and Max_Data = 23 */</span><br><span class="line"></span><br><span class="line">  uint8_t Minutes;          /*!&lt; Specifies the RTC Time Minutes.</span><br><span class="line">                                 This parameter must be a number between Min_Data = 0 and Max_Data = 59 */</span><br><span class="line"></span><br><span class="line">  uint8_t Seconds;          /*!&lt; Specifies the RTC Time Seconds.</span><br><span class="line">                                 This parameter must be a number between Min_Data = 0 and Max_Data = 59 */</span><br><span class="line"></span><br><span class="line">&#125; RTC_TimeTypeDef;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  * @brief  RTC Date structure definition</span><br><span class="line">  */</span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  uint8_t WeekDay;  /*!&lt; Specifies the RTC Date WeekDay (not necessary for HAL_RTC_SetDate).</span><br><span class="line">                         This parameter can be a value of @ref RTC_WeekDay_Definitions */</span><br><span class="line"></span><br><span class="line">  uint8_t Month;    /*!&lt; Specifies the RTC Date Month (in BCD format).</span><br><span class="line">                         This parameter can be a value of @ref RTC_Month_Date_Definitions */</span><br><span class="line"></span><br><span class="line">  uint8_t Date;     /*!&lt; Specifies the RTC Date.</span><br><span class="line">                         This parameter must be a number between Min_Data = 1 and Max_Data = 31 */</span><br><span class="line"></span><br><span class="line">  uint8_t Year;     /*!&lt; Specifies the RTC Date Year.</span><br><span class="line">                         This parameter must be a number between Min_Data = 0 and Max_Data = 99 */</span><br><span class="line"></span><br><span class="line">&#125; RTC_DateTypeDef;</span><br></pre></td></tr></table></figure><p><strong>ç¨‹åºä»£ç ï¼š</strong></p><p>main.c</p><p><strong>åœ¨main.cä¸­é‡å†™fputcå‡½æ•°ï¼Œä½¿å¾—èƒ½å¤Ÿä½¿ç”¨printfå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int fputc(int ch,FILE *f)&#123;</span><br><span class="line"> uint8_t temp[1]=&#123;ch&#125;;</span><br><span class="line"> HAL_UART_Transmit(&amp;huart1,temp,1,2);</span><br><span class="line"> return ch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®šä¹‰ä¸¤ä¸ªç»“æ„ä½“æ¥è·å–æ—¥æœŸå’Œæ—¶é—´ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RTC_DateTypeDef GetData;  //è·å–æ—¥æœŸç»“æ„ä½“</span><br><span class="line"></span><br><span class="line">RTC_TimeTypeDef GetTime;   //è·å–æ—¶é—´ç»“æ„ä½“</span><br></pre></td></tr></table></figure><p>åœ¨whileå¾ªç¯ä¸­æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/* Get the RTC current Time */</span><br><span class="line">HAL_RTC_GetTime(&amp;hrtc, &amp;GetTime, RTC_FORMAT_BIN);</span><br><span class="line">   /* Get the RTC current Date */</span><br><span class="line">   HAL_RTC_GetDate(&amp;hrtc, &amp;GetData, RTC_FORMAT_BIN);</span><br><span class="line"></span><br><span class="line">   /* Display date Format : yy/mm/dd */</span><br><span class="line">   printf(&quot;%02d/%02d/%02d\r\n&quot;,2000 + GetData.Year, GetData.Month, GetData.Date);</span><br><span class="line">   /* Display time Format : hh:mm:ss */</span><br><span class="line">   printf(&quot;%02d:%02d:%02d\r\n&quot;,GetTime.Hours, GetTime.Minutes, GetTime.Seconds);</span><br><span class="line"></span><br><span class="line">   printf(&quot;\r\n&quot;);</span><br><span class="line"></span><br><span class="line">   HAL_Delay(1000);</span><br></pre></td></tr></table></figure><p><strong>ç¨‹åºä¸­ä½¿ç”¨HAL_RTC_GetTimeï¼ˆï¼‰,HAL_RTC_GetDate()è¯»å–æ—¶é—´å’Œæ—¥æœŸï¼Œå¹¶ä¿å­˜åˆ°ç»“æ„ä½“å˜é‡ä¸­ï¼Œç„¶åé€šè¿‡ä¸²å£è¾“å‡ºè¯»å–çš„æ—¶é—´å’Œæ—¥æœŸã€‚</strong></p><p><strong>ä¾‹ç¨‹æµ‹è¯•æ­£å¸¸ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20200425153330941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425153330941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><h4 id="RTCæ‰ç”µé‡ç½®"><a href="#RTCæ‰ç”µé‡ç½®" class="headerlink" title="RTCæ‰ç”µé‡ç½®"></a>RTCæ‰ç”µé‡ç½®</h4><p>ä½†æ˜¯å‘¢ï¼Œåœ¨halåº“ä¸­ç”Ÿæˆçš„ä»£ç ï¼Œ<strong>æ¯æ¬¡æ–­ç”µå°±RTCæ—¶é—´ä¼šé‡ç½®</strong>ï¼Œæ¯æ¬¡ä¸Šç”µéƒ½ä¼šé‡æ–°åˆå§‹åŒ–æ—¶é—´</p><p>å› ä¸ºHALåº“è®¾ç½®äº†ä¸€ä¸ªBKPå¯„å­˜å™¨ä¿å­˜ä¸€ä¸ªæ ‡å¿—ã€‚æ¯æ¬¡å•ç‰‡æœºå¯åŠ¨æ—¶éƒ½è¯»å–è¿™ä¸ªæ ‡å¿—å¹¶åˆ¤æ–­æ˜¯ä¸æ˜¯é¢„å…ˆè®¾å®šçš„å€¼ï¼šå¦‚åº¦æœä¸æ˜¯å°±åˆå§‹åŒ–RTCå¹¶è®¾ç½®æ—¶é—´ï¼Œå†è®¾ç½®æ ‡å¿—ä¸ºé¢„æœŸå€¼ï¼›å¦‚æœæ˜¯é¢„æœŸå€¼å°±è·³è¿‡åˆå§‹åŒ–å’Œæ—¶é—´è®¾ç½®ï¼Œç»§ç»­æ‰§è¡Œåé¢çš„ç¨‹åº</p><p><strong>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ¯æ¬¡ä¸Šç”µæ‰§è¡ŒRTCåˆå§‹åŒ–ä¹‹å‰ï¼Œå°†æ ‡å¿—è®¾ç½®ä¸ºé¢„æœŸå€¼å³å¯</strong></p><p><strong>åœ¨rtc.cä¸­çš„RTC_Initä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹å³å¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"> void MX_RTC_Init(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN RTC_Init 0 */</span><br><span class="line">RTC_TimeTypeDef time;   //æ—¶é—´ç»“æ„ä½“å‚æ•°</span><br><span class="line">RTC_DateTypeDef datebuff;   //æ—¥æœŸç»“æ„ä½“å‚æ•°</span><br><span class="line">  /* USER CODE END RTC_Init 0 */</span><br><span class="line"></span><br><span class="line">  RTC_TimeTypeDef sTime = &#123;0&#125;;</span><br><span class="line">  RTC_DateTypeDef DateToUpdate = &#123;0&#125;;</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN RTC_Init 1 */</span><br><span class="line">__HAL_RCC_BKP_CLK_ENABLE();       //å¼€å¯åå¤‡åŒºåŸŸæ—¶é’Ÿ</span><br><span class="line">__HAL_RCC_PWR_CLK_ENABLE();  //å¼€å¯ç”µæºæ—¶é’Ÿ</span><br><span class="line">  /* USER CODE END RTC_Init 1 */</span><br><span class="line">  /**Initialize RTC Only </span><br><span class="line">  */</span><br><span class="line">  hrtc.Instance = RTC;</span><br><span class="line">  hrtc.Init.AsynchPrediv = RTC_AUTO_1_SECOND;</span><br><span class="line">  hrtc.Init.OutPut = RTC_OUTPUTSOURCE_NONE;</span><br><span class="line">  if (HAL_RTC_Init(&amp;hrtc) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN Check_RTC_BKUP */</span><br><span class="line">if(HAL_RTCEx_BKUPRead(&amp;hrtc,RTC_BKP_DR1)!= 0x5051)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  /* USER CODE END Check_RTC_BKUP */</span><br><span class="line"></span><br><span class="line">  /**Initialize RTC and set the Time and Date </span><br><span class="line">  */</span><br><span class="line">  sTime.Hours = 0x14;</span><br><span class="line">  sTime.Minutes = 0x30;</span><br><span class="line">  sTime.Seconds = 0x0;</span><br><span class="line"></span><br><span class="line">  if (HAL_RTC_SetTime(&amp;hrtc, &amp;sTime, RTC_FORMAT_BCD) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line">  DateToUpdate.WeekDay = RTC_WEEKDAY_SATURDAY;</span><br><span class="line">  DateToUpdate.Month = RTC_MONTH_APRIL;</span><br><span class="line">  DateToUpdate.Date = 0x25;</span><br><span class="line">  DateToUpdate.Year = 0x20;</span><br><span class="line"></span><br><span class="line">  if (HAL_RTC_SetDate(&amp;hrtc, &amp;DateToUpdate, RTC_FORMAT_BCD) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line">  /* USER CODE BEGIN RTC_Init 2 */</span><br><span class="line"></span><br><span class="line">__HAL_RTC_SECOND_ENABLE_IT(&amp;hrtc,RTC_IT_SEC); //å¼€å¯RTCæ—¶é’Ÿç§’ä¸­æ–­</span><br><span class="line">datebuff = DateToUpdate;  //æŠŠæ—¥æœŸæ•°æ®æ‹·è´åˆ°è‡ªå·±å®šä¹‰çš„dataä¸­</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR1, 0x5051);//å‘æŒ‡å®šçš„åå¤‡åŒºåŸŸå¯„å­˜å™¨å†™å…¥æ•°æ®</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR2, (uint16_t)datebuff.Year);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR3, (uint16_t)datebuff.Month);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR4, (uint16_t)datebuff.Date);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR5, (uint16_t)datebuff.WeekDay);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">datebuff.Year    = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR2);</span><br><span class="line">datebuff.Month   = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR3);</span><br><span class="line">datebuff.Date    = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR4);</span><br><span class="line">datebuff.WeekDay = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR5);</span><br><span class="line">DateToUpdate = datebuff;</span><br><span class="line">if (HAL_RTC_SetDate(&amp;hrtc, &amp;DateToUpdate, RTC_FORMAT_BIN) != HAL_OK)</span><br><span class="line">&#123;</span><br><span class="line">Error_Handler();</span><br><span class="line">&#125;</span><br><span class="line">__HAL_RTC_SECOND_ENABLE_IT(&amp;hrtc,RTC_IT_SEC); //å¼€å¯RTCæ—¶é’Ÿç§’ä¸­æ–­</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200425165901167.gif" alt="https://img-blog.csdnimg.cn/20200425165901167.gif"></p><p><img src="https://img-blog.csdnimg.cn/20200425165904365.gif" alt="https://img-blog.csdnimg.cn/20200425165904365.gif"></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32 halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32_HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº</title>
      <link href="/2024/03/stm32-STM32-HAL%E5%BA%93%E9%A9%B1%E5%8A%A8DHT11%E8%AF%BB%E5%8F%96%E6%B8%A9%E6%B9%BF%E5%BA%A6%E7%A8%8B%E5%BA%8F/"/>
      <url>/2024/03/stm32-STM32-HAL%E5%BA%93%E9%A9%B1%E5%8A%A8DHT11%E8%AF%BB%E5%8F%96%E6%B8%A9%E6%B9%BF%E5%BA%A6%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº"><a href="#STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº" class="headerlink" title="STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº"></a>STM32ä½¿ç”¨HALåº“é©±åŠ¨DHT11è¯»å–æ¸©æ¹¿åº¦ç¨‹åº</h2><p><strong>é©±åŠ¨DHT11ã€DHT22ã€DS18BB20ç­‰æ¸©æ¹¿åº¦æ¨¡å—æ—¶åºæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå…³é”®åœ¨äºæ§åˆ¶å¥½æ—¶åºçš„<code>å»¶æ—¶æ—¶é—´</code>ï¼ŒHALåº“çš„å»¶æ—¶å‡½æ•°HAL_Delayæ˜¯æ¯«ç§’çº§åˆ«å»¶æ—¶å‡½æ•°ï¼Œæ‰€å…³é”®ç‚¹å°±æ˜¯å®ç°å¾®ç§’çº§åˆ«çš„å»¶æ—¶å‡½æ•°ã€‚</strong></p><p><strong>å¾®ç§’çº§åˆ«å»¶æ—¶å‡½æ•°å®ç°è§æˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š<a href="https://blog.csdn.net/qq153471503/article/details/102930097">https://blog.csdn.net/qq153471503/article/details/102930097</a></strong></p><p><strong>æ‰«æä»¥ä¸‹äºŒç»´ç ï¼Œå…³æ³¨å…¬ä¼—å·<code>é›æ­£ä¸ç§ƒå¤´</code>è·å–æ›´å¤šSTM32èµ„æºåŠå¹²è´§ï¼</strong><br><img src="https://img-blog.csdnimg.cn/20210126155428872.png" alt="https://img-blog.csdnimg.cn/20210126155428872.png"></p><h3 id="sys-h"><a href="#sys-h" class="headerlink" title="sys.h"></a>sys.h</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#ifndef _SYS_H_</span><br><span class="line">#define _SYS_H_</span><br><span class="line"></span><br><span class="line">#include &quot;main.h&quot;</span><br><span class="line"></span><br><span class="line">#define BITBAND(addr, bitnum) ((addr &amp; 0xF0000000)+0x2000000+((addr &amp;0xFFFFF)&lt;&lt;5)+(bitnum&lt;&lt;2))</span><br><span class="line">#define MEM_ADDR(addr)  *((volatile unsigned long  *)(addr))</span><br><span class="line">#define BIT_ADDR(addr, bitnum)   MEM_ADDR(BITBAND(addr, bitnum))</span><br><span class="line"></span><br><span class="line">#define GPIOA_ODR_Addr    (GPIOA_BASE+12) //0x4001080C </span><br><span class="line">#define GPIOB_ODR_Addr    (GPIOB_BASE+12) //0x40010C0C </span><br><span class="line">#define GPIOC_ODR_Addr    (GPIOC_BASE+12) //0x4001100C </span><br><span class="line">#define GPIOD_ODR_Addr    (GPIOD_BASE+12) //0x4001140C </span><br><span class="line">#define GPIOE_ODR_Addr    (GPIOE_BASE+12) //0x4001180C </span><br><span class="line">#define GPIOF_ODR_Addr    (GPIOF_BASE+12) //0x40011A0C    </span><br><span class="line">#define GPIOG_ODR_Addr    (GPIOG_BASE+12) //0x40011E0C    </span><br><span class="line"></span><br><span class="line">#define GPIOA_IDR_Addr    (GPIOA_BASE+8) //0x40010808 </span><br><span class="line">#define GPIOB_IDR_Addr    (GPIOB_BASE+8) //0x40010C08 </span><br><span class="line">#define GPIOC_IDR_Addr    (GPIOC_BASE+8) //0x40011008 </span><br><span class="line">#define GPIOD_IDR_Addr    (GPIOD_BASE+8) //0x40011408 </span><br><span class="line">#define GPIOE_IDR_Addr    (GPIOE_BASE+8) //0x40011808 </span><br><span class="line">#define GPIOF_IDR_Addr    (GPIOF_BASE+8) //0x40011A08 </span><br><span class="line">#define GPIOG_IDR_Addr    (GPIOG_BASE+8) //0x40011E08 </span><br><span class="line"></span><br><span class="line">#define PAout(n)   BIT_ADDR(GPIOA_ODR_Addr,n)  //</span><br><span class="line">#define PAin(n)    BIT_ADDR(GPIOA_IDR_Addr,n)  //</span><br><span class="line"></span><br><span class="line">#define PBout(n)   BIT_ADDR(GPIOB_ODR_Addr,n)  //</span><br><span class="line">#define PBin(n)    BIT_ADDR(GPIOB_IDR_Addr,n)  //</span><br><span class="line"></span><br><span class="line">#define PCout(n)   BIT_ADDR(GPIOC_ODR_Addr,n)  //</span><br><span class="line">#define PCin(n)    BIT_ADDR(GPIOC_IDR_Addr,n)  //</span><br><span class="line"></span><br><span class="line">#define PDout(n)   BIT_ADDR(GPIOD_ODR_Addr,n)  //</span><br><span class="line">#define PDin(n)    BIT_ADDR(GPIOD_IDR_Addr,n)  //</span><br><span class="line"></span><br><span class="line">#define PEout(n)   BIT_ADDR(GPIOE_ODR_Addr,n)  //</span><br><span class="line">#define PEin(n)    BIT_ADDR(GPIOE_IDR_Addr,n)  //</span><br><span class="line"></span><br><span class="line">#define PFout(n)   BIT_ADDR(GPIOF_ODR_Addr,n)  //</span><br><span class="line">#define PFin(n)    BIT_ADDR(GPIOF_IDR_Addr,n)  //</span><br><span class="line"></span><br><span class="line">#define PGout(n)   BIT_ADDR(GPIOG_ODR_Addr,n)  //</span><br><span class="line">#define PGin(n)    BIT_ADDR(GPIOG_IDR_Addr,n)  //</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="dht11-h"><a href="#dht11-h" class="headerlink" title="dht11.h"></a>dht11.h</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#ifndef __DHT11_H</span><br><span class="line">#define __DHT11_H</span><br><span class="line"></span><br><span class="line">#include &quot;main.h&quot;</span><br><span class="line">#include &quot;sys.h&quot;</span><br><span class="line"></span><br><span class="line">typedef uint8_t u8;</span><br><span class="line">typedef uint16_t u16;</span><br><span class="line">typedef uint32_t u32;</span><br><span class="line"></span><br><span class="line">//IOæ–¹å‘è®¾ç½®</span><br><span class="line">#define DHT11_IO_IN()  &#123;IODHT22_GPIO_Port-&gt;CRH &amp;= 0xFFFFF0FF;IODHT22_GPIO_Port-&gt;CRH |= 8 &lt;&lt; 8;&#125;// PC10 IN  MODE</span><br><span class="line">#define DHT11_IO_OUT() &#123;IODHT22_GPIO_Port-&gt;CRH &amp;= 0xFFFFF0FF;IODHT22_GPIO_Port-&gt;CRH |= 3 &lt;&lt; 8;&#125;// PC10 OUT MODE</span><br><span class="line"></span><br><span class="line">IOæ“ä½œå‡½æ•°</span><br><span class="line">#defineDHT11_DQ_OUT PCout(10) //æ•°æ®ç«¯å£PC10</span><br><span class="line">#defineDHT11_DQ_IN  PCin(10)  //æ•°æ®ç«¯å£PC10</span><br><span class="line"></span><br><span class="line">u8 DHT11_Init(void);//åˆå§‹åŒ–DHT11</span><br><span class="line">u8 DHT11_Read_Data(u8 *temp, u8 *humi); //è¯»å–æ¸©æ¹¿åº¦</span><br><span class="line">u8 DHT11_Read_Byte(void);//è¯»å‡ºä¸€ä¸ªå­—èŠ‚</span><br><span class="line">u8 DHT11_Read_Bit(void);//è¯»å‡ºä¸€ä¸ªä½</span><br><span class="line">u8 DHT11_Check(void);//æ£€æµ‹æ˜¯å¦å­˜åœ¨DHT11</span><br><span class="line">void DHT11_Rst(void);//å¤ä½DHT11</span><br><span class="line">u8 DHT11_Read_Data_Float(float *temp,float *humi);</span><br><span class="line"></span><br><span class="line">#endif</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="dht11-c"><a href="#dht11-c" class="headerlink" title="dht11.c"></a>dht11.c</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;dht11.h&quot;</span><br><span class="line"></span><br><span class="line">//å¤ä½DHT11</span><br><span class="line">void DHT11_Rst(void)</span><br><span class="line">&#123;</span><br><span class="line">    DHT11_IO_OUT(); //SET OUTPUT</span><br><span class="line">    DHT11_DQ_OUT=0; //æ‹‰ä½DQ</span><br><span class="line">    delay_ms(20);    //æ‹‰ä½è‡³å°‘18ms,(DHT22 500us)</span><br><span class="line">    DHT11_DQ_OUT=1; //DQ=1</span><br><span class="line">    delay_us(30);     //ä¸»æœºæ‹‰é«˜20~40us</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ç­‰å¾…DHT11çš„å›åº”</span><br><span class="line">//è¿”å›1:æœªæ£€æµ‹åˆ°DHT11çš„å­˜åœ¨</span><br><span class="line">//è¿”å›0:å­˜åœ¨</span><br><span class="line">u8 DHT11_Check(void)</span><br><span class="line">&#123;</span><br><span class="line">    u8 retry=0;</span><br><span class="line">    DHT11_IO_IN();//SET INPUT</span><br><span class="line">    while (DHT11_DQ_IN&amp;&amp;retry&lt;100)//DHT11ä¼šæ‹‰ä½40~80us</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(1);</span><br><span class="line">    &#125;;</span><br><span class="line">    if(retry&gt;=100)return 1;</span><br><span class="line">    else retry=0;</span><br><span class="line">    while (!DHT11_DQ_IN&amp;&amp;retry&lt;100)//DHT11æ‹‰ä½åä¼šå†æ¬¡æ‹‰é«˜40~80us</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(1);</span><br><span class="line">    &#125;;</span><br><span class="line">    if(retry&gt;=100)return 1;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ä»DHT11è¯»å–ä¸€ä¸ªä½</span><br><span class="line">//è¿”å›å€¼ï¼š1/0</span><br><span class="line">u8 DHT11_Read_Bit(void)</span><br><span class="line">&#123;</span><br><span class="line">    u8 retry=0;</span><br><span class="line">    while(DHT11_DQ_IN&amp;&amp;retry&lt;100)//ç­‰å¾…å˜ä¸ºä½ç”µå¹³</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(1);</span><br><span class="line">    &#125;</span><br><span class="line">    retry=0;</span><br><span class="line">    while(!DHT11_DQ_IN&amp;&amp;retry&lt;100)//ç­‰å¾…å˜é«˜ç”µå¹³</span><br><span class="line">    &#123;</span><br><span class="line">        retry++;</span><br><span class="line">        delay_us(1);</span><br><span class="line">    &#125;</span><br><span class="line">    delay_us(40);//ç­‰å¾…40us</span><br><span class="line">    if(DHT11_DQ_IN)return 1;</span><br><span class="line">    else return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ä»DHT11è¯»å–ä¸€ä¸ªå­—èŠ‚</span><br><span class="line">//è¿”å›å€¼ï¼šè¯»åˆ°çš„æ•°æ®</span><br><span class="line">u8 DHT11_Read_Byte(void)</span><br><span class="line">&#123;</span><br><span class="line">    u8 i,dat;</span><br><span class="line">    dat=0;</span><br><span class="line">    for (i=0; i&lt;8; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        dat&lt;&lt;=1;</span><br><span class="line">        dat|=DHT11_Read_Bit();</span><br><span class="line">    &#125;</span><br><span class="line">    return dat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//ä»DHT11è¯»å–ä¸€æ¬¡æ•°æ®</span><br><span class="line">//temp:æ¸©åº¦å€¼(èŒƒå›´:0~50Â°)</span><br><span class="line">//humi:æ¹¿åº¦å€¼(èŒƒå›´:20%~90%)</span><br><span class="line">//è¿”å›å€¼ï¼š0,æ­£å¸¸;1,è¯»å–å¤±è´¥</span><br><span class="line">u8 DHT11_Read_Data(u8 *temp,u8 *humi)</span><br><span class="line">&#123;</span><br><span class="line">    u8 buf[5];</span><br><span class="line">    u8 i;</span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    if(DHT11_Check()==0)</span><br><span class="line">    &#123;</span><br><span class="line">        for(i=0; i&lt;5; i++) //è¯»å–40ä½æ•°æ®</span><br><span class="line">        &#123;</span><br><span class="line">            buf[i]=DHT11_Read_Byte();</span><br><span class="line">        &#125;</span><br><span class="line">        if((buf[0]+buf[1]+buf[2]+buf[3])==buf[4])</span><br><span class="line">        &#123;</span><br><span class="line">            *humi=buf[0];</span><br><span class="line">            *temp=buf[2];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else return 1;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">u8 DHT11_Read_Data_Float(float *temp,float *humi)</span><br><span class="line">&#123;</span><br><span class="line">    u8 buf[5];</span><br><span class="line">    u8 i;</span><br><span class="line">    DHT11_Rst();</span><br><span class="line">    if(DHT11_Check()==0)</span><br><span class="line">    &#123;</span><br><span class="line">        for(i=0; i&lt;5; i++) //è¯»å–40ä½æ•°æ®</span><br><span class="line">        &#123;</span><br><span class="line">            buf[i]=DHT11_Read_Byte();</span><br><span class="line">        &#125;</span><br><span class="line">        if((buf[0]+buf[1]+buf[2]+buf[3])==buf[4])</span><br><span class="line">        &#123;</span><br><span class="line">*humi=((buf[0] &lt;&lt; 8) + buf[1]) / 10.0;</span><br><span class="line">*temp=((buf[2] &lt;&lt; 8) + buf[3]) / 10.0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else return 1;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//åˆå§‹åŒ–DHT11çš„IOå£ DQ åŒæ—¶æ£€æµ‹DHT11çš„å­˜åœ¨</span><br><span class="line">//è¿”å›1:ä¸å­˜åœ¨</span><br><span class="line">//è¿”å›0:å­˜åœ¨</span><br><span class="line">u8 DHT11_Init(void)</span><br><span class="line">&#123;</span><br><span class="line">    u8 ret = 1;</span><br><span class="line">    DHT11_Rst();  //å¤ä½DHT11</span><br><span class="line">    ret = DHT11_Check();</span><br><span class="line">    printf(&quot;dht11 init %s. \r\n&quot;, ret == 0 ? &quot;ok&quot; : &quot;failed&quot;);</span><br><span class="line">    return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32 halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32CubeMX_|_HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦</title>
      <link href="/2024/03/stm32-STM32CubeMX-HAL%E5%BA%93%E7%9A%84ADC%E5%A4%9A%E9%80%9A%E9%81%93%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%EF%BC%88%E8%BD%AE%E8%AE%AD%E3%80%81DMA%E3%80%81DMA-TIM-%E3%80%81%E8%AF%BB%E5%8F%96%E5%86%85%E9%83%A8%E4%BC%A0%E6%84%9F%E5%99%A8%E6%B8%A9%E5%BA%A6/"/>
      <url>/2024/03/stm32-STM32CubeMX-HAL%E5%BA%93%E7%9A%84ADC%E5%A4%9A%E9%80%9A%E9%81%93%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%EF%BC%88%E8%BD%AE%E8%AE%AD%E3%80%81DMA%E3%80%81DMA-TIM-%E3%80%81%E8%AF%BB%E5%8F%96%E5%86%85%E9%83%A8%E4%BC%A0%E6%84%9F%E5%99%A8%E6%B8%A9%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="STM32CubeMX-HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA-TIM-ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦"><a href="#STM32CubeMX-HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA-TIM-ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦" class="headerlink" title="STM32CubeMX | HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦"></a>STM32CubeMX | HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦</h2><h4 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h4><ul><li><p><a href="#STM32CubeMX__HALADCDMADMATIM_0">STM32CubeMX | HALåº“çš„ADCå¤šé€šé“æ•°æ®é‡‡é›†ï¼ˆè½®è®­ã€DMAã€DMA+TIM)ã€è¯»å–å†…éƒ¨ä¼ æ„Ÿå™¨æ¸©åº¦</a>+ </p></li><li></li><li><p><a href="#1ADC_11">1ã€ADCç®€ä»‹</a>+ </p></li><li><p><a href="#11__13">1.1 é‡‡æ ·å®šç†</a>+ <a href="#12__15">1.2 æ¨¡å¼ä»‹ç»</a>+ <a href="#13__24">1.3 é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—</a></p></li><li><p><a href="#2_56">2ã€è½®è®­æ–¹å¼çš„å¤šé€šé“é‡‡é›†</a>+ </p></li><li><p><a href="#21__57">2.1 æ–¹å¼ä¸€ï¼šé—´æ–­æ¨¡å¼+æ‰«ææ¨¡å¼</a>+ <a href="#22__72">2.2 æ–¹å¼äºŒï¼šå®Œå…¨è½®è®­</a></p></li><li><p><a href="#3DMA_108">3ã€DMAå®ç°å¤šé€šé“é‡‡é›†</a>+ <a href="#4TIMDMA_136">4ã€TIM+DMAå®ç°å¤šé€šé“é‡‡é›†</a>+ <a href="#5ADC_179">5ã€è¡¥å……ï¼šå†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ADCé€šé“</a></p></li></ul><p><em>æ³¨ï¼šæœ¬ç‰‡æ–‡ç« ä»¥STM32F103ç³»åˆ—ä¸ºä¾‹ï¼Œå…¶ä»–ç³»åˆ—å¯èƒ½ç¨æœ‰ä¸åŒã€‚</em></p><h4 id="1ã€ADCç®€ä»‹"><a href="#1ã€ADCç®€ä»‹" class="headerlink" title="1ã€ADCç®€ä»‹"></a>1ã€ADCç®€ä»‹</h4><h5 id="1-1-é‡‡æ ·å®šç†"><a href="#1-1-é‡‡æ ·å®šç†" class="headerlink" title="1.1 é‡‡æ ·å®šç†"></a>1.1 é‡‡æ ·å®šç†</h5><h5 id="1-2-æ¨¡å¼ä»‹ç»"><a href="#1-2-æ¨¡å¼ä»‹ç»" class="headerlink" title="1.2 æ¨¡å¼ä»‹ç»"></a>1.2 æ¨¡å¼ä»‹ç»</h5><ul><li><strong>æ‰«ææ¨¡å¼ï¼š</strong> ä½¿ç”¨STM32CUBEMXé…ç½®äº†å¤šé€šé“åï¼Œè¿™ä¸€é¡¹é»˜è®¤å¼€å¯ä¸”æ— æ³•è®¾ç½®æˆå…³é—­ã€‚è¿™ä¸ªæ¨¡å¼å°±æ˜¯è‡ªåŠ¨æ‰«æä½ å¼€å¯çš„æ‰€æœ‰é€šé“è¿›è¡Œè½¬æ¢ï¼Œç›´è‡³è½¬æ¢å®Œã€‚ä¾‹å¦‚ä½ å¼€å¯äº†CH0ã€CH1ã€CH2ã€CH3è¿™å››ä¸ªé€šé“ï¼Œå¯åŠ¨è½¬æ¢åADCä¼šè‡ªåŠ¨å°†è¿™4ä¸ªé€šé“å…¨éƒ¨è½¬æ¢å®Œï¼Œä½†æ˜¯è¿™ç§è¿ç»­æ€§æ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œæ‰€ä»¥å°±å¼•å‡ºäº†é—´æ–­æ¨¡å¼ã€‚ +  <strong>è¿ç»­æ¨¡å¼ï¼š</strong> åœ¨CUBEä¸­é€‰ä¸­ENABLEå°±æ˜¯è¿ç»­æ¨¡å¼ï¼ŒDISABLEå°±æ˜¯å•æ¬¡æ¨¡å¼ã€‚å¼€å¯è¿ç»­æ¨¡å¼åï¼ŒADCçš„è½¬æ¢ä¸ç”±å…¶ä»–æ§åˆ¶ã€‚ä¾‹å¦‚å°†ADCè®¾ç½®ä¸ºäº†å®šæ—¶å™¨çš„TGROè§¦å‘é‡‡æ ·ï¼Œå¦‚æœå¼€å¯è¿ç»­æ¨¡å¼ï¼ŒADCå°†å¿½ç•¥å®šæ—¶å™¨çš„è§¦å‘é‡‡æ ·ã€‚ï¼ˆè¿ç»­è½¬æ¢æ¨¡å¼å¼€å¯åå…¶å®å°±æ˜¯æ»¡é¢‘ç‡çš„é‡‡æ ·ï¼‰ã€‚ +  <strong>é—´æ–­æ¨¡å¼ï¼š</strong> å¯ä»¥å°†å¤šä¸ªé€šé“è¿›è¡Œ<strong>åˆ†ç»„é‡‡é›†</strong>ï¼Œä¾‹å¦‚ä½ å¼€å¯äº†CH0~3è¿™4ä¸ªé€šé“ï¼Œå‡å¦‚ä½ è®¾ç½®äº†é—´æ–­æ¬¡æ•°ä¸º4ï¼Œå°±ç›¸å½“äºå°†4ä¸ªé€šé“åˆ†æˆäº†4ç»„ï¼Œæ¯ç»„1ä¸ªé€šé“ï¼Œé‚£ä¹ˆè¦æƒ³é‡‡é›†å®Œè¿™4ä¸ªé€šé“å°±éœ€è¦æ‰‹åŠ¨è§¦å‘4æ¬¡ADCé‡‡é›†ï¼›å¦‚æœè®¾ç½®äº†é—´æ–­æ¬¡æ•°ä¸º2ï¼Œé‚£ä¹ˆé‡‡é›†å®Œ4ä¸ªé€šé“å°±éœ€è¦æ‰‹åŠ¨è§¦å‘2æ¬¡ADCé‡‡é›†ã€‚</li></ul><h5 id="1-3-é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—"><a href="#1-3-é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—" class="headerlink" title="1.3 é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—"></a>1.3 é‡‡æ ·æ—¶é—´å’Œé‡‡æ ·é¢‘ç‡çš„è®¡ç®—</h5><p><strong>ADCé‡‡æ ·ä¸¤ç‚¹é—´éš”çš„æ—¶é—´ä¸€å®šè¦å¤§äºADCçš„é‡‡æ ·æ—¶é—´ï¼</strong> é‡‡æ ·æ—¶é—´æ€ä¹ˆç®—ï¼Œä¸‹é¢å°±ç»†è¯´ä¸€ä¸‹ã€‚</p><p>STM32F103ä¸€èˆ¬å°†æ—¶é’Ÿé…ç½®ä¸»é¢‘ä¸º72Mã€APB2ä¸º72Mã€‚ADCæŒ‚åœ¨APB2æ—¶é’Ÿæ€»çº¿ä¸Šï¼Œä¸”ADCçš„æ—¶é’Ÿä¸èƒ½è¶…è¿‡14Mã€‚æ‰€ä»¥ä¸€èˆ¬å°†ADCçš„åˆ†é¢‘è®¾ç½®ä¸º6ï¼ŒADCçš„æ—¶é’Ÿä¸»é¢‘å°±ä¸º72&#x2F;6&#x3D;12MHzã€‚é‚£ä¹ˆä¸€ä¸ªå‘¨æœŸå°±æ˜¯ï¼š1&#x2F;12MHz&#x3D;0.0833usã€‚</p><p>ä»¥ä¸‹æˆªå›¾ä¸ºSTM32F1å‚è€ƒæ‰‹å†Œï¼ˆæ‰‹å†Œç¼–å·RM0008ï¼Œå¯åœ¨STå®˜ç½‘ç›´æ¥æœç´¢ä¸‹è½½ï¼‰ï¼š</p><p><img src="https://img-blog.csdnimg.cn/84ca12cd9d40459eb3e03c54889e9df3.png" alt="https://img-blog.csdnimg.cn/84ca12cd9d40459eb3e03c54889e9df3.png"></p><p>ä¸Šå›¾çš„æ„æ€æ˜¯ï¼šADCå¯¹è¾“å…¥ç”µå‹é‡‡æ ·è‹¥å¹²ä¸ªADC_CLKå‘¨æœŸï¼Œè¿™äº›å‘¨æœŸå¯é€šè¿‡ADC_SMPR1å’ŒADC_SMPR2å¯„å­˜å™¨ä¸­çš„SMP[2:0]ä½è¿›è¡Œä¿®æ”¹ã€‚æ¯ä¸ªé€šé“éƒ½å¯ä»¥ç”¨ä¸åŒçš„é‡‡æ ·æ—¶é—´è¿›è¡Œé‡‡æ ·ã€‚</p><p><strong>ADCè½¬æ¢æ—¶é—´ &#x3D; é‡‡æ ·æ—¶é—´ + 12.5ä¸ªå‘¨æœŸ</strong></p><p>ç¤ºä¾‹ï¼š $~~~~~~~~$å½“ADCæ—¶é’Ÿä¸»é¢‘ä¸º14MHzå¹¶ä¸”é‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªå‘¨æœŸæ—¶ï¼šé‡‡æ ·æ—¶é—´ &#x3D; 1.5 + 12.5 &#x3D; 14ä¸ªå‘¨æœŸï¼›ä¸€ä¸ªå‘¨æœŸçš„æ—¶é—´ä¸º1&#x2F;14MHzï¼Œä¸€å…±14ä¸ªå‘¨æœŸï¼Œ<strong>1 &#x2F; 14MHz * 14ä¸ªå‘¨æœŸ &#x3D; 1us</strong>ï¼Œé‚£ä¹ˆæ­¤æ—¶ADCçš„é‡‡æ ·é¢‘ç‡å°±æ˜¯1&#x2F;1us&#x3D;1000KHz&#x3D;1MHzï¼Œè¿™ä¹Ÿæ˜¯ç†è®ºä¸ŠADCçš„æœ€å¤§é‡‡æ ·é¢‘ç‡ã€‚</p><p>STM32F1ç³»åˆ—çš„æ—¶é’Ÿä¸»é¢‘ä¸€èˆ¬è®¾ç½®ä¸ºäº†12Mï¼Œé‡‡æ ·æ—¶é—´çš„è®¾ç½®æ‰€å¯¹åº”é‡‡æ ·é¢‘ç‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img-blog.csdnimg.cn/de1135452e21490a94b671995f48824f.png" alt="https://img-blog.csdnimg.cn/de1135452e21490a94b671995f48824f.png"></p><p>çŸ¥é“äº†æœ€çŸ­æ—¶é—´åï¼Œå½“ADCæ—¶é’Ÿä¸»é¢‘ä¸º12Må¹¶ä¸”é‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªå‘¨æœŸæ—¶ï¼ŒADCé‡‡æ ·ä¸¤ç‚¹çš„æ—¶é—´å¿…é¡»å¤§äº1.17usã€‚</p><p>è€ŒSTM32F031ç³»åˆ—çš„ADCæ—¶é’Ÿä¸»é¢‘ä¸º14MHzï¼Œé‡‡æ ·æ—¶é—´çš„è®¾ç½®æ‰€å¯¹åº”é‡‡æ ·é¢‘ç‡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img-blog.csdnimg.cn/4616052a159b4c6da44230ee81f9a4a0.png" alt="https://img-blog.csdnimg.cn/4616052a159b4c6da44230ee81f9a4a0.png"></p><p>å½“ADCæ—¶é’Ÿä¸»é¢‘ä¸º14Må¹¶ä¸”é‡‡æ ·æ—¶é—´ä¸º1.5ä¸ªå‘¨æœŸæ—¶ï¼ŒADCé‡‡æ ·ä¸¤ç‚¹çš„æ—¶é—´å¿…é¡»å¤§äº1usã€‚</p><h4 id="2ã€è½®è®­æ–¹å¼çš„å¤šé€šé“é‡‡é›†"><a href="#2ã€è½®è®­æ–¹å¼çš„å¤šé€šé“é‡‡é›†" class="headerlink" title="2ã€è½®è®­æ–¹å¼çš„å¤šé€šé“é‡‡é›†"></a>2ã€è½®è®­æ–¹å¼çš„å¤šé€šé“é‡‡é›†</h4><h5 id="2-1-æ–¹å¼ä¸€ï¼šé—´æ–­æ¨¡å¼-æ‰«ææ¨¡å¼"><a href="#2-1-æ–¹å¼ä¸€ï¼šé—´æ–­æ¨¡å¼-æ‰«ææ¨¡å¼" class="headerlink" title="2.1 æ–¹å¼ä¸€ï¼šé—´æ–­æ¨¡å¼+æ‰«ææ¨¡å¼"></a>2.1 æ–¹å¼ä¸€ï¼šé—´æ–­æ¨¡å¼+æ‰«ææ¨¡å¼</h5><p>æˆ‘å¼€å¯äº†é€šé“0ã€1ã€2ä»¥åŠå†…éƒ¨æ¸©åº¦è¯»å–é€šé“ä¸€å…±å››ä¸ªé€šé“ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20200820144708671.png#pic_center" alt="https://img-blog.csdnimg.cn/20200820144708671.png#pic_center"></p><p><img src="https://img-blog.csdnimg.cn/20200820144717271.png#pic_center" alt="https://img-blog.csdnimg.cn/20200820144717271.png#pic_center"><br> å¦‚æœæƒ³ä½¿ç”¨è½®è®­æ–¹å¼å¹¶ä¸”ä¸ä½¿ç”¨DMAçš„å¤šé€šé“é‡‡é›†ï¼Œé‚£ä¹ˆå°±è¦é…ç½®ä¸º <strong>ã€å•æ¬¡æ¨¡å¼+é—´æ–­æ¨¡å¼ã€‘</strong>ï¼Œå¹¶ä¸”å°†Number Of Discontinuous Conversionsä¸º1ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªé€šé“åˆ†æˆäº†ä¸€ä¸ªç»„ï¼Œé…ç½®å¦‚ä¸‹å›¾ï¼š<br><img src="https://img-blog.csdnimg.cn/20200820145205371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center" alt="https://img-blog.csdnimg.cn/20200820145205371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center"></p><p>ç”±äºæˆ‘è¿™é‡Œè®¾ç½®é—´æ–­æ•°ä¸º1ï¼Œä¹Ÿå°±æ˜¯å°†4ä¸ªé€šé“åˆ†æˆäº†4ç»„ï¼Œé‚£ä¹ˆæˆ‘æ¯æ¬¡é‡‡é›†çš„æ—¶å€™éƒ½éœ€è¦æ‰‹åŠ¨å»è§¦å‘ADCé‡‡é›†ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä¸€æ¬¡HAL_ADC_Startå‡½æ•°ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/2020082014582133.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center" alt="https://img-blog.csdnimg.cn/2020082014582133.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center"><br> æˆ‘å°†é€šé“0åˆ†åˆ«æ¥åˆ°3.3Vå’ŒGNDä¸Šï¼Œ4é€šé“é‡‡é›†è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20200820150008132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center" alt="https://img-blog.csdnimg.cn/20200820150008132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center"></p><h5 id="2-2-æ–¹å¼äºŒï¼šå®Œå…¨è½®è®­"><a href="#2-2-æ–¹å¼äºŒï¼šå®Œå…¨è½®è®­" class="headerlink" title="2.2 æ–¹å¼äºŒï¼šå®Œå…¨è½®è®­"></a>2.2 æ–¹å¼äºŒï¼šå®Œå…¨è½®è®­</h5><p>å®Œå…¨ä½¿ç”¨è½®è®­çš„æ–¹å¼ä¸èƒ½ä½¿ç”¨<strong>æ‰«ææ¨¡å¼</strong>ï¼ˆç†è®ºä¸Šæ¥è¯´å¤šé€šé“éœ€è¦ä½¿ç”¨æ‰«ææ¨¡å¼ï¼Œè€Œä¸æ˜¯å®Œå…¨è½®è®­ï¼‰ï¼Œä½†æ˜¯ä½¿ç”¨STM32CUBEMXé…ç½®å¤šé€šé“æ‰«ææ¨¡å¼ä¸æ— æ³•è¢«å…³é—­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç”¨STM32CUBEMXé…ç½®æˆä¸€ä¸ªé€šé“ï¼š<br><img src="https://img-blog.csdnimg.cn/0b4c62f299d54bcf89ba61ea0aee0eca.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAeS16aGVuZw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="https://img-blog.csdnimg.cn/0b4c62f299d54bcf89ba61ea0aee0eca.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAeS16aGVuZw==,size_20,color_FFFFFF,t_70,g_se,x_16"></p><p>ç„¶åè¯»å–ADCé‡‡é›†æ•°å€¼çš„å‡½æ•°æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">uint16_t ADC_Read(uint32_t Channel)</span><br><span class="line">&#123;</span><br><span class="line">ADC_ChannelConfTypeDef sConfig = &#123;0&#125;;</span><br><span class="line">sConfig.Channel = Channel;                                         /* é€šé“ */</span><br><span class="line">sConfig.Rank = ADC_REGULAR_RANK_1;                              </span><br><span class="line">sConfig.SamplingTime = ADC_SAMPLETIME_55CYCLES_5;                  /* é‡‡æ ·æ—¶é—´ */</span><br><span class="line">if (HAL_ADC_ConfigChannel(&amp;hadc1, &amp;sConfig) != HAL_OK)             </span><br><span class="line">&#123;</span><br><span class="line">Error_Handler();</span><br><span class="line">&#125;</span><br><span class="line">HAL_ADC_Start(&amp;hadc1);</span><br><span class="line">HAL_ADC_PollForConversion(&amp;hadc1, HAL_MAX_DELAY);</span><br><span class="line">return (uint16_t)HAL_ADC_GetValue(&amp;hadc1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">uint16_t ADC_Value[5];</span><br><span class="line"></span><br><span class="line">ADC_Value[0] = ADC_Read(ADC_CHANNEL_1);  // é‡‡é›†å¹¶è¯»å–é€šé“1</span><br><span class="line">ADC_Value[1] = ADC_Read(ADC_CHANNEL_4);</span><br><span class="line">ADC_Value[2] = ADC_Read(ADC_CHANNEL_5);</span><br><span class="line">ADC_Value[3] = ADC_Read(ADC_CHANNEL_6);</span><br><span class="line">ADC_Value[4] = ADC_Read(ADC_CHANNEL_7);</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h4 id="3ã€DMAå®ç°å¤šé€šé“é‡‡é›†"><a href="#3ã€DMAå®ç°å¤šé€šé“é‡‡é›†" class="headerlink" title="3ã€DMAå®ç°å¤šé€šé“é‡‡é›†"></a>3ã€DMAå®ç°å¤šé€šé“é‡‡é›†</h4><p>é€šè¿‡DMAå®ç°å¤šé€šé“æ•°æ®é‡‡é›†ï¼Œ<strong>è¦å°†è¿ç»­æ¨¡å¼å’Œé—´æ–­æ¨¡å¼å…³é—­ï¼</strong></p><p>å¦‚æœè¿ç»­æ¨¡å¼å¼€å¯ï¼Œé‚£ä¹ˆé€šè¿‡DMAä¼ è¾“åˆ°çš„æ•°ç»„ä¸­ï¼Œæ¯ä¸ªé€šé“æ‰€é‡‡é›†åˆ°çš„å€¼å¯¹åº”æ•°ç»„ä¸­çš„ä¸€ä¸ªä½ç½®å°±æ˜¯ä¸å›ºå®šçš„ã€‚</p><p>ä¾‹å¦‚ä½ å¼€å¯äº†IN0~IN3è¿™å››ä¸ªé€šé“ï¼Œå¹¶é€šè¿‡DMAå°†è¿™å››ä¸ªé€šé“çš„æ•°æ®æ”¾åˆ°ADC_Valueè¿™ä¸ªå¤§å°ä¸º4çš„u16ç±»å‹æ•°ç»„ï¼Œ</p><p>ä½ åœ¨ç¬¬ä¸€æ¬¡é‡‡é›†çš„æ—¶å€™IN0é€šé“çš„æ•°å€¼é€šè¿‡DMAè¢«æ”¾åœ¨ADC_Value[0]ï¼Œ</p><p>ç¬¬äºŒæ¬¡é‡‡é›†çš„æ—¶å€™IN0é‡‡é›†åˆ°çš„æ•°å€¼å°±å¯èƒ½è¢«æ”¾åˆ°äº†ADC_Value[1]ï¼Œ</p><p>è¿™æ ·çš„è¯å°±æä¸æ–¹ä¾¿æˆ‘ä»¬å¯¹æ¯ä¸ªé€šé“çš„æ•°æ®è¿›è¡Œåˆ†æå’Œæå–ã€‚</p><p>é…ç½®å¦‚ä¸‹ï¼Œå°†è¿ç»­è½¬æ¢æ¨¡å¼å’Œé—´æ–­è½¬æ¢æ¨¡å¼å…³é—­ï¼Œå¹¶å¼€å¯ADCçš„DMAé€šé“ï¼Œå°†DMAçš„æ¨¡å¼é…ç½®ä¸ºå‘¨æœŸæ¨¡å¼ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20200820152200735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center" alt="https://img-blog.csdnimg.cn/20200820152200735.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70#pic_center"></p><p><img src="https://img-blog.csdnimg.cn/ddd590ed84b44942863728c7b84ff639.png" alt="https://img-blog.csdnimg.cn/ddd590ed84b44942863728c7b84ff639.png"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/c457e847f73847ceb3a35f112f66667e.png" alt="https://img-blog.csdnimg.cn/c457e847f73847ceb3a35f112f66667e.png"><br> 4ä¸ªé€šé“é‡‡é›†è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20200820152427227.png#pic_center" alt="https://img-blog.csdnimg.cn/20200820152427227.png#pic_center"></p><h4 id="4ã€TIM-DMAå®ç°å¤šé€šé“é‡‡é›†"><a href="#4ã€TIM-DMAå®ç°å¤šé€šé“é‡‡é›†" class="headerlink" title="4ã€TIM+DMAå®ç°å¤šé€šé“é‡‡é›†"></a>4ã€TIM+DMAå®ç°å¤šé€šé“é‡‡é›†</h4><p>åœ¨ä¸ä½¿ç”¨DMAçš„æƒ…å†µä¸‹ï¼Œå®šæ—¶å™¨æ§åˆ¶ADCè¿›è¡Œæ•°æ®é‡‡é›†åªèƒ½æ˜¯å•é€šé“ï¼å¦‚æœå¼€å¯äº†å¤šé€šé“ï¼Œè¯»å–åˆ°çš„ADCé‡‡é›†å€¼åªä¼šæ˜¯æœ€åä¸€ä¸ªé€šé“çš„å€¼ï¼</p><p>æ‰€ä»¥ï¼Œè¦æƒ³ä½¿ç”¨å®šæ—¶å™¨æ§åˆ¶ADCé‡‡é›†<strong>å¤šé€šé“</strong>ï¼Œå¿…é¡»ä½¿ç”¨DMAï¼</p><p>CubeMXé…ç½®å¦‚ä¸‹ï¼Œä½¿èƒ½ADCçš„DMAï¼š</p><p><img src="https://img-blog.csdnimg.cn/42aa3e7658df4d89ac32b7f2a1ebc643.png" alt="https://img-blog.csdnimg.cn/42aa3e7658df4d89ac32b7f2a1ebc643.png"></p><p>ADCçš„è§¦å‘æ–¹å¼è®¾ç½®ä¸ºå®šæ—¶å™¨3çš„è§¦å‘äº‹ä»¶ï¼š</p><p><img src="https://img-blog.csdnimg.cn/c4ff90b3330b44fda0a609316e2370db.png" alt="https://img-blog.csdnimg.cn/c4ff90b3330b44fda0a609316e2370db.png"></p><p>é‡‡æ ·æ—¶é—´è®¾ç½®ä¸ºäº†55.5ä¸ªå‘¨æœŸï¼Œå¯¹åº”é‡‡æ ·é¢‘ç‡ä¸º176.47KHzï¼Œæ‰€ä»¥å®šæ—¶å™¨3çš„é¢‘ç‡è®¾ç½®è¦ä½äº176.47KHzã€‚</p><p>è®¾ç½®å®šæ—¶å™¨3åˆ†é¢‘ç³»æ•°ä¸º72ï¼Œé‡è½½å€¼ä¸º10ï¼Œå¾—åˆ°<code>72MHz / 72åˆ†é¢‘ / 10 = 100KHz</code>çš„å®šæ—¶å™¨3ï¼š</p><p><img src="https://img-blog.csdnimg.cn/a50e71979339457e90f451449ec69d86.png" alt="https://img-blog.csdnimg.cn/a50e71979339457e90f451449ec69d86.png"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/c418cbe4d5b340a2ae94438927728da5.png" alt="https://img-blog.csdnimg.cn/c418cbe4d5b340a2ae94438927728da5.png"></p><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/534899ff62e24bcb9909ffaff4b29065.png" alt="https://img-blog.csdnimg.cn/534899ff62e24bcb9909ffaff4b29065.png"></p><p>å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©è¿›è¡Œä¸€ç»„æ•°æ®ï¼Œä¾‹å¦‚å°†32ä¸ªç‚¹ä¸ºä¸€ç»„æ•°æ®è¿›è¡Œé‡‡é›†ï¼Œè®¾ç½®å¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/a08aa8f0ae7c4cd8bfd70d40a980b3e1.png" alt="https://img-blog.csdnimg.cn/a08aa8f0ae7c4cd8bfd70d40a980b3e1.png"></p><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/eb3feca6e37140eeb65f794634e86da3.png" alt="https://img-blog.csdnimg.cn/eb3feca6e37140eeb65f794634e86da3.png"></p><h4 id="5ã€è¡¥å……ï¼šå†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ADCé€šé“"><a href="#5ã€è¡¥å……ï¼šå†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ADCé€šé“" class="headerlink" title="5ã€è¡¥å……ï¼šå†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ADCé€šé“"></a>5ã€è¡¥å……ï¼šå†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨ADCé€šé“</h4><p><img src="https://img-blog.csdnimg.cn/87fe51b0eb7b447798ade02be31b4329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/87fe51b0eb7b447798ade02be31b4329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70"><br> ä¸Šé¢å›¾ç‰‡æ˜¯æˆªå–åœ¨STM32F103RCçš„datasheetä¸­çš„ï¼Œä¸­æ–‡æ„æ€å°±æ˜¯ï¼šæ¸©åº¦ä¼ æ„Ÿå™¨å¿…é¡»äº§ç”Ÿéšæ¸©åº¦çº¿æ€§å˜åŒ–çš„ç”µå‹ã€‚è½¬æ¢èŒƒå›´åœ¨2v &lt; VDDA &lt; 3.6 Vä¹‹é—´ã€‚æ¸©åº¦ä¼ æ„Ÿå™¨å†…éƒ¨è¿æ¥ADC1_IN16è¾“å…¥é€šé“ï¼Œç”¨äºå°†ä¼ æ„Ÿå™¨è¾“å‡ºç”µå‹è½¬æ¢ä¸ºæ•°å­—å€¼ã€‚</p><p>å†…éƒ¨æ¸©åº¦è®¡ç®—å…¬å¼ï¼š</p><p>ã€Temperature &#x3D; {(V25 - VSENSE) &#x2F; Avg_Slope} + 25ã€‘</p><p>å­—æ®µè¯´æ˜ï¼š</p><ul><li><strong>V25ï¼š</strong> æœ€å°1.34Vï¼Œæœ€å¤§1.52Vï¼Œå…¸å‹å€¼1.43V+ <strong>Avg_Slopeï¼š</strong> æœ€å°4.0ï¼Œæœ€å¤§4.6ï¼Œå…¸å‹å€¼4.3mv&#x2F;â„ƒ+ <strong>VSENSEï¼š</strong> ADCé‡‡é›†åˆ°çš„ç”µå‹<br><img src="https://img-blog.csdnimg.cn/da0745b68e874c41b42573887a74e20e.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/da0745b68e874c41b42573887a74e20e.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxMTUzNDcxNTAz,size_16,color_FFFFFF,t_70"></li></ul><p>ADCå€¼è½¬ç”µå‹å€¼è®¡ç®—å…¬å¼ï¼šã€ç”µå‹ &#x3D; ADCé‡‡é›†åˆ°çš„å€¼ * 3.3 &#x2F; 4096ã€‘</p><p>çœ‹ä¸Šå›¾æˆ‘é‡‡é›†åˆ°çš„å€¼ä¸º1703ï¼Œå…ˆè½¬æ¢ä¸ºç”µå‹å€¼ï¼š1703*3.3&#x2F;4096â‰ˆ1.37</p><p><strong>ï¼ˆ1.43 - 1.37ï¼‰&#x2F; 0.0043 + 25 â‰ˆ 38.95â„ƒ</strong></p><p>endsâ€¦</p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32 halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>module</title>
      <link href="/2024/03/daily/"/>
      <url>/2024/03/daily/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/03/C%E8%AF%AD%E8%A8%80-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"/>
      <url>/2024/03/C%E8%AF%AD%E8%A8%80-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="Cè¯­è¨€åŸºæœ¬æ¦‚å¿µ"><a href="#Cè¯­è¨€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="Cè¯­è¨€åŸºæœ¬æ¦‚å¿µ"></a>Cè¯­è¨€åŸºæœ¬æ¦‚å¿µ</h1><h2 id="1-æ ‡è¯†ç¬¦"><a href="#1-æ ‡è¯†ç¬¦" class="headerlink" title="1.æ ‡è¯†ç¬¦"></a>1.æ ‡è¯†ç¬¦</h2><p>&emsp;&emsp;æ ‡è¯†ç¬¦æ˜¯æˆ‘ä»¬åœ¨ç¼–ç¨‹æ—¶ä½¿ç”¨çš„åå­—ï¼Œæ¯”å¦‚æŒ‡å®šæŸä¸ªä¸œè¥¿ã€äººï¼Œéƒ½è¦ç”¨åˆ°å®ƒï¼Œä»–æˆ–å¥¹çš„åå­—ã€‚åœ¨ç”µè„‘è¯­è¨€ä¸­ï¼Œå¯¹äºå˜é‡ï¼Œå¸¸é‡ï¼Œå‡½æ•°ï¼Œè¯­å¥å—ä¹Ÿæœ‰åå­—ï¼Œç»Ÿç»Ÿç§°ä¸ºæ ‡è¯†ç¬¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ ‡è¯†ç¬¦åªèƒ½ç”±ä¸‰ç§å­—ç¬¦ç»„æˆï¼Œ<font color="red">å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿</font>ä¸”ç¬¬ä¸€ä¸ªå­—ç¬¦å¿…é¡»æ˜¯å­—æ¯æˆ–ä¸‹åˆ’çº¿ã€‚</p><h2 id="2-å…³é”®å­—"><a href="#2-å…³é”®å­—" class="headerlink" title="2.å…³é”®å­—"></a>2.å…³é”®å­—</h2><p>&emsp;&emsp;Cè¯­è¨€çš„å…³é”®å­—å…±æœ‰32ä¸ªï¼Œæ ¹æ®å…³é”®å­—çš„ä½œç”¨ï¼Œå¯åˆ†å…¶ä¸ºæ•°æ®ç±»å‹å…³é”®å­—ã€æ§åˆ¶è¯­å¥å…³é”®å­—ã€å­˜å‚¨ç±»å‹å…³é”®å­—å’Œå…¶å®ƒå…³é”®å­—å››ç±»ã€‚</p><h3 id="1ã€æ•°æ®ç±»å‹å…³é”®å­—ï¼ˆ12ä¸ªï¼‰ï¼š"><a href="#1ã€æ•°æ®ç±»å‹å…³é”®å­—ï¼ˆ12ä¸ªï¼‰ï¼š" class="headerlink" title="1ã€æ•°æ®ç±»å‹å…³é”®å­—ï¼ˆ12ä¸ªï¼‰ï¼š"></a>1ã€æ•°æ®ç±»å‹å…³é”®å­—ï¼ˆ12ä¸ªï¼‰ï¼š</h3><pre><code>(1) char ï¼šå£°æ˜å­—ç¬¦å‹å˜é‡æˆ–å‡½æ•°(2) double ï¼šå£°æ˜åŒç²¾åº¦å˜é‡æˆ–å‡½æ•°(3) enum ï¼šå£°æ˜æšä¸¾ç±»å‹(4) floatï¼šå£°æ˜æµ®ç‚¹å‹å˜é‡æˆ–å‡½æ•°(5) intï¼š å£°æ˜æ•´å‹å˜é‡æˆ–å‡½æ•°(6) long ï¼šå£°æ˜é•¿æ•´å‹å˜é‡æˆ–å‡½æ•°(7) short ï¼šå£°æ˜çŸ­æ•´å‹å˜é‡æˆ–å‡½æ•°(8) signedï¼šå£°æ˜æœ‰ç¬¦å·ç±»å‹å˜é‡æˆ–å‡½æ•°(9) structï¼šå£°æ˜ç»“æ„ä½“å˜é‡æˆ–å‡½æ•°(10) unionï¼šå£°æ˜è”åˆæ•°æ®ç±»å‹(11) unsignedï¼šå£°æ˜æ— ç¬¦å·ç±»å‹å˜é‡æˆ–å‡½æ•°(12) void ï¼šå£°æ˜å‡½æ•°æ— è¿”å›å€¼æˆ–æ— å‚æ•°ï¼Œå£°æ˜æ— ç±»å‹æŒ‡é’ˆï¼ˆåŸºæœ¬ä¸Šå°±è¿™ä¸‰ä¸ªä½œç”¨ï¼‰</code></pre><p><font color="red">&emsp;&emsp;éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCè¯­è¨€æ²¡æœ‰å­—ç¬¦ä¸²ç±»å‹ã€‚</font></p><h3 id="2ã€æ§åˆ¶è¯­å¥å…³é”®å­—ï¼ˆ12ä¸ªï¼‰ï¼š"><a href="#2ã€æ§åˆ¶è¯­å¥å…³é”®å­—ï¼ˆ12ä¸ªï¼‰ï¼š" class="headerlink" title="2ã€æ§åˆ¶è¯­å¥å…³é”®å­—ï¼ˆ12ä¸ªï¼‰ï¼š"></a>2ã€æ§åˆ¶è¯­å¥å…³é”®å­—ï¼ˆ12ä¸ªï¼‰ï¼š</h3><p>Aã€å¾ªç¯è¯­å¥ ï¼š</p><pre><code>(1) forï¼šä¸€ç§å¾ªç¯è¯­å¥(å¯æ„ä¼šä¸å¯è¨€ä¼ ï¼‰ (2) do ï¼šå¾ªç¯è¯­å¥çš„å¾ªç¯ä½“ (3) while ï¼šå¾ªç¯è¯­å¥çš„å¾ªç¯æ¡ä»¶ (4) breakï¼šè·³å‡ºå½“å‰å¾ªç¯ (5) continueï¼šç»“æŸå½“å‰å¾ªç¯ï¼Œå¼€å§‹ä¸‹ä¸€è½®å¾ªç¯</code></pre><p>Bã€æ¡ä»¶è¯­å¥ï¼š</p><pre><code>(1)if: æ¡ä»¶è¯­å¥ (2)else ï¼šæ¡ä»¶è¯­å¥å¦å®šåˆ†æ”¯ï¼ˆä¸ if è¿ç”¨ï¼‰ (3)gotoï¼šæ— æ¡ä»¶è·³è½¬è¯­å¥</code></pre><p>Cã€å¼€å…³è¯­å¥ï¼š </p><pre><code>(1)switch :ç”¨äºå¼€å…³è¯­å¥ (2)caseï¼šå¼€å…³è¯­å¥åˆ†æ”¯ (3)defaultï¼šå¼€å…³è¯­å¥ä¸­çš„â€œå…¶ä»–â€åˆ†æ”¯</code></pre><p>Dã€ç¨‹åºè¿”å›è¯­å¥ï¼š</p><pre><code>return ï¼šå­ç¨‹åºè¿”å›è¯­å¥ï¼ˆå¯ä»¥å¸¦å‚æ•°ï¼Œä¹Ÿçœ‹ä¸å¸¦å‚æ•°ï¼‰</code></pre><h3 id="3ã€é¢„å®šä¹‰æ ‡è¯†ç¬¦"><a href="#3ã€é¢„å®šä¹‰æ ‡è¯†ç¬¦" class="headerlink" title="3ã€é¢„å®šä¹‰æ ‡è¯†ç¬¦"></a>3ã€é¢„å®šä¹‰æ ‡è¯†ç¬¦</h3><pre><code>(1)auto ï¼šå£°æ˜è‡ªåŠ¨å˜é‡ ä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œä½¿ç”¨æ•°æ®ç±»å‹å…³é”®è¯å£°æ˜å˜é‡ï¼Œé»˜è®¤å³ä¸ºauto(2)externï¼šå£°æ˜å˜é‡æ˜¯åœ¨å…¶ä»–æ–‡ä»¶æ­£å£°æ˜ï¼ˆä¹Ÿå¯ä»¥çœ‹åšæ˜¯å¼•ç”¨å˜é‡ï¼‰(3)registerï¼šå£°æ˜ç§¯å­˜å™¨å˜é‡(4)static ï¼šå£°æ˜é™æ€å˜é‡</code></pre><h3 id="4ã€-å…¶å®ƒå…³é”®å­—ï¼ˆ4ä¸ªï¼‰ï¼š"><a href="#4ã€-å…¶å®ƒå…³é”®å­—ï¼ˆ4ä¸ªï¼‰ï¼š" class="headerlink" title="4ã€ å…¶å®ƒå…³é”®å­—ï¼ˆ4ä¸ªï¼‰ï¼š"></a>4ã€ å…¶å®ƒå…³é”®å­—ï¼ˆ4ä¸ªï¼‰ï¼š</h3><pre><code>(1)const ï¼šå£°æ˜åªè¯»å˜é‡(2)sizeofï¼šè®¡ç®—æ•°æ®ç±»å‹é•¿åº¦(3)typedefï¼šç”¨ä»¥ç»™æ•°æ®ç±»å‹å–åˆ«åï¼ˆå½“ç„¶è¿˜æœ‰å…¶ä»–ä½œç”¨(4)volatileï¼šè¯´æ˜å˜é‡åœ¨ç¨‹åºæ‰§è¡Œä¸­å¯è¢«éšå«åœ°æ”¹å˜ã€‚ä½¿ç”¨æ­¤å…³é”®å­—å£°æ˜å˜é‡å¯ä»¥é¿å…å˜é‡å› ä¸ºè¢«ä¼˜åŒ–è€Œå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚</code></pre><h2 id="3-å˜é‡"><a href="#3-å˜é‡" class="headerlink" title="3.å˜é‡"></a>3.å˜é‡</h2><pre><code>    å¯¹ä¸å˜çš„å€¼ï¼ŒCè¯­è¨€ä¸­ç”¨å¸¸é‡æ¦‚å¿µæ¥è¡¨ç¤ºï¼Œå¯å˜çš„å€¼ï¼ŒCè¯­è¨€ä¸­ä½¿ç”¨å˜é‡çš„æ¦‚å¿µæ¥è¡¨ç¤ºã€‚å¯¹Cè¯­è¨€ç¼–è¯‘å™¨æ¥è¯´ï¼Œå¸¸é‡çš„ä¸€èˆ¬å½¢å¼ä¸ºï¼š1.æ•°å­—ï¼š1, 2, 3, 4...2.å­—ç¬¦ï¼š&#39;a&#39;, &#39;b&#39;, &#39;c&#39;...3.å­—ç¬¦ä¸²: &quot;hello&quot;, &quot;world&quot;...4 constä¿®é¥°çš„å¸¸å˜é‡5 #defineå®šä¹‰çš„æ ‡è¯†ç¬¦å¸¸é‡6 æšä¸¾å¸¸é‡    å‰ä¸‰ç±»å¯ä»¥ç»Ÿç§°ä¸ºå­—é¢å¸¸é‡ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒCç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå°†é™¤äº†ä¿ç•™å…³é”®å­—æ‰€æœ‰çš„å­—ç¬¦ä¸²è®¤ä¸ºæ˜¯å˜é‡ã€‚å¦‚æœå˜é‡æ²¡æœ‰å®šä¹‰å´ä½¿ç”¨äº†å°±ä¼šæŠ¥é”™ã€‚</code></pre><h3 id="1-å®šä¹‰ä¸€ä¸ªå˜é‡"><a href="#1-å®šä¹‰ä¸€ä¸ªå˜é‡" class="headerlink" title="1.å®šä¹‰ä¸€ä¸ªå˜é‡"></a>1.å®šä¹‰ä¸€ä¸ªå˜é‡</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> age = <span class="number">150</span>;#å®šä¹‰ä¸€ä¸ªæ•´å½¢å˜é‡</span><br><span class="line"><span class="type">float</span> weight = <span class="number">45.5f</span>;<span class="comment">//è¿™é‡Œåé¢å¿…é¡»åŠ ä¸Šf,å¦åˆ™ç¼–è¯‘å™¨ä¼šè®¤ä¸ºæ˜¯åŒç²¾åº¦</span></span><br><span class="line"><span class="type">char</span> ch = <span class="string">&#x27;w&#x27;</span>;#å®šä¹‰ä¸€ä¸ªå­—ç¬¦å‹å˜é‡</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;æ­¤å¤–ï¼Œä¸Šæ–‡æ›¾ç»è¯´è¿‡å˜é‡çš„å‘½ååªèƒ½ç”±å­—æ¯ï¼ˆåŒ…æ‹¬å¤§å†™å’Œå°å†™ï¼‰ã€æ•°å­—å’Œä¸‹åˆ’çº¿_ç»„æˆï¼Œä¸”ä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼Œé•¿åº¦ä¸èƒ½è¶…è¿‡63ä¸ªå­—ç¬¦ï¼Œå˜é‡ä¸­åŒºåˆ†å¤§å°å†™ï¼Œå˜é‡åä¸èƒ½ä½¿ç”¨å…³é”®å­—ã€‚</p><h3 id="2-å°†å˜é‡å€¼æ‰“å°å‡ºæ¥"><a href="#2-å°†å˜é‡å€¼æ‰“å°å‡ºæ¥" class="headerlink" title="2.å°†å˜é‡å€¼æ‰“å°å‡ºæ¥"></a>2.å°†å˜é‡å€¼æ‰“å°å‡ºæ¥</h3><p>&emsp;&emsp;æ‰“å°å˜é‡ä¸€èˆ¬ä½¿ç”¨printf()å‡½æ•°,ä¸¾ä¾‹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> b = <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;value of a is %d\r\n&quot;</span>, a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;value of b is %d\r\n&quot;</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è¿˜æ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ è¿‡Cè¯­è¨€æˆ–å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼Œé‚£ä¹ˆç°åœ¨ä½ å¯èƒ½å¯¹ä¸Šé¢çš„ä»£ç ä¸€å¤´é›¾æ°´ï¼Œä½†è¯·ä¸è¦é€€ç¼©ï¼Œåœ¨ä¸‹é¢æˆ‘ä»¬ä¼šè¯¦ç»†çš„è§£é‡Šä¸Šè¿°ä»£ç ã€‚ä»–å¹¶æ²¡æœ‰ä½ æƒ³è±¡çš„é‚£ä¹ˆæ™¦æ¶©éš¾æ‡‚ã€‚</p><h3 id="3-å˜é‡çš„åˆ†ç±»"><a href="#3-å˜é‡çš„åˆ†ç±»" class="headerlink" title="3.å˜é‡çš„åˆ†ç±»"></a>3.å˜é‡çš„åˆ†ç±»</h3><p>&emsp;&emsp;å˜é‡åˆ†ä¸ºå±€éƒ¨å˜é‡ä¸å…¨å±€å˜é‡ï¼Œå½“é‡åçš„æ—¶å€™ï¼Œå±€éƒ¨å˜é‡ä¼˜å…ˆä½¿ç”¨ï¼ˆå°±è¿‘åŸåˆ™ï¼‰ï¼Œä½†æ˜¯è¿˜è¯·å°½é‡é¿å…å‡ºç°å…¨å±€å˜é‡ä¸å±€éƒ¨å˜é‡é‡åçš„æƒ…å†µï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¹²æ‰°åˆ°æˆ‘ä»¬æ€è€ƒç¨‹åºé€»è¾‘ã€‚</p><h3 id="4-å˜é‡çš„ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸ"><a href="#4-å˜é‡çš„ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="4. å˜é‡çš„ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸ"></a>4. å˜é‡çš„ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸ</h3><p>&emsp;&emsp;ä½œç”¨åŸŸï¼ˆscopeï¼‰æ˜¯ç¨‹åºè®¾è®¡æ¦‚å¿µï¼Œé€šå¸¸æ¥è¯´ï¼Œä¸€æ®µç¨‹åºä»£ç ä¸­æ‰€ç”¨åˆ°çš„åå­—å¹¶ä¸æ€»æ˜¯æœ‰æ•ˆ&#x2F;å¯ç”¨çš„è€Œé™å®šè¿™ä¸ªåå­—çš„å¯ç”¨æ€§çš„ä»£ç èŒƒå›´å°±æ˜¯è¿™ä¸ªåå­—çš„ä½œç”¨åŸŸã€‚</p><pre><code>1.å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸæ˜¯å˜é‡æ‰€åœ¨çš„å±€éƒ¨èŒƒå›´2.å…¨å±€å˜é‡çš„ä½œç”¨åŸŸæ˜¯æ•´ä¸ªå·¥ç¨‹</code></pre><p>&emsp;&emsp;å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯å˜é‡çš„åˆ›å»ºåˆ°å˜é‡çš„é”€æ¯ä¹‹é—´çš„ä¸€ä¸ªæ—¶é—´æ®µ</p><pre><code>1.å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼šè¿›å…¥ä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼Œå‡ºä½œç”¨åŸŸç”Ÿå‘½å‘¨æœŸç»“æŸ2.å…¨å±€å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼šæ•´ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸ</code></pre><h3 id="5-å¸¸é‡"><a href="#5-å¸¸é‡" class="headerlink" title="5.å¸¸é‡"></a>5.å¸¸é‡</h3><p>&emsp;&emsp;Cè¯­è¨€çš„å¸¸é‡åˆ†ä¸ºä»¥ä¸‹å‡ ç§</p><pre><code>â€¢ å­—é¢å¸¸é‡â€¢ constä¿®é¥°çš„å¸¸å˜é‡â€¢ #defineå®šä¹‰çš„æ ‡è¯†ç¬¦å¸¸é‡â€¢ æšä¸¾å¸¸é‡</code></pre><h2 id="4-å­—ç¬¦ä¸²ã€è½¬ä¹‰å­—ç¬¦ä¸æ³¨é‡Š"><a href="#4-å­—ç¬¦ä¸²ã€è½¬ä¹‰å­—ç¬¦ä¸æ³¨é‡Š" class="headerlink" title="4. å­—ç¬¦ä¸²ã€è½¬ä¹‰å­—ç¬¦ä¸æ³¨é‡Š"></a>4. å­—ç¬¦ä¸²ã€è½¬ä¹‰å­—ç¬¦ä¸æ³¨é‡Š</h2><h3 id="4-1-å­—ç¬¦ä¸²"><a href="#4-1-å­—ç¬¦ä¸²" class="headerlink" title="4.1 å­—ç¬¦ä¸²"></a>4.1 å­—ç¬¦ä¸²</h3><p>&emsp;&emsp;ç”±åŒå¼•å·å¼•èµ·æ¥çš„ä¸€ä¸²å­—ç¬¦æˆä¸ºå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œæˆ–è€…ç®€ç§°å­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²çš„ç»“æŸæ ‡å¿—æ˜¯ä¸€ä¸ªâ€™\0â€™çš„è½¬ä¹‰å­—ç¬¦ï¼Œåœ¨è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦çš„æ—¶å€™\0æ˜¯ç»“æŸæ ‡å¿—ï¼Œä¸ç®—ä½œå­—ç¬¦ä¸²çš„å†…å®¹ã€‚</p><h3 id="4-2-è½¬ä¹‰å­—ç¬¦ï¼š"><a href="#4-2-è½¬ä¹‰å­—ç¬¦ï¼š" class="headerlink" title="4.2 è½¬ä¹‰å­—ç¬¦ï¼š"></a>4.2 è½¬ä¹‰å­—ç¬¦ï¼š</h3><p>å¸¸ç”¨çš„è½¬ä¹‰å­—ç¬¦ï¼š</p><table><thead><tr><th>è½¬ä¹‰å­—ç¬¦</th><th>é‡Šä¹‰</th></tr></thead><tbody><tr><td><code>?</code></td><td>åœ¨ä¹¦å†™è¿ç»­å¤šä¸ªé—®å·æ˜¯ä½¿ç”¨ï¼Œé˜²æ­¢è¢«è§£ææˆä¸‰å­—æ¯ç¬¦</td></tr><tr><td><code>&#39;</code></td><td>ç”¨äºè¡¨ç¤ºå­—ç¬¦å¸¸é‡çš„å•å¼•å·</td></tr><tr><td><code>&quot;</code></td><td>ç”¨äºè¡¨ç¤ºå­—ç¬¦ä¸²å†…éƒ¨çš„åŒå¼•å·</td></tr><tr><td><code>|</code></td><td>ç”¨äºè¡¨ç¤ºä¸€ä¸ªåæ–œæ ï¼Œé˜²æ­¢è§£ææˆä¸€ä¸ªè½¬ä¹‰åºåˆ—ç¬¦</td></tr><tr><td><code>\a</code></td><td>è­¦å‘Šå­—ç¬¦ï¼Œèœ‚é¸£</td></tr><tr><td><code>\b</code></td><td>é€€æ ¼ç¬¦</td></tr><tr><td><code>\f</code></td><td>è¿›çº¸ç¬¦</td></tr><tr><td><code>\n</code></td><td>æ¢è¡Œ</td></tr><tr><td><code>\r</code></td><td>å›è½¦</td></tr><tr><td><code>\t</code></td><td>æ°´å¹³åˆ¶è¡¨ç¬¦</td></tr><tr><td><code>\v</code></td><td>å‚ç›´åˆ¶è¡¨ç¬¦</td></tr><tr><td><code>\ddd</code></td><td>dddè¡¨ç¤º1-3ä¸ª8è¿›åˆ¶çš„æ•°å­—</td></tr><tr><td><code>\xdd</code></td><td>ddè¡¨ç¤º1-2ä¸ª8è¿›åˆ¶çš„æ•°å­—</td></tr></tbody></table><h3 id="4-3-æ³¨é‡Š"><a href="#4-3-æ³¨é‡Š" class="headerlink" title="4.3 æ³¨é‡Š"></a>4.3 æ³¨é‡Š</h3><p>æ³¨é‡Šæœ‰ä¸¤ç§é£æ ¼ï¼š</p><p>&emsp;&emsp;1.Cè¯­è¨€é£æ ¼çš„æ³¨é‡Š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æˆ‘ä¸ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span></span><br><span class="line"><span class="comment">æˆ‘ä¹Ÿä¸ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™ç§æ³¨é‡Šé£æ ¼æœ‰ä¸€ä¸ªç¼ºé™·ï¼šä¸èƒ½åµŒå¥—æ³¨é‡Š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æˆ‘ä¸ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æˆ‘ä¸ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span></span><br><span class="line"><span class="comment">æˆ‘ä¹Ÿä¸ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">æˆ‘ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°ï¼Œè€Œä¸”ä¸‹æ–¹æ¨ªæ ä¹Ÿä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;2.C++é£æ ¼çš„æ³¨é‡Š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä¸ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span></span><br><span class="line">æˆ‘ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span><br><span class="line"><span class="comment">//æˆ‘ä¸ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span></span><br><span class="line"><span class="comment">//æˆ‘ä¸ä¼šè¢«ç¼–è¯‘å™¨çœ‹åˆ°</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Cè¯­è¨€ </category>
          
          <category> å…¥é—¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cè¯­è¨€ </tag>
            
            <tag> å…¥é—¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€STM32ã€‘HALåº“_STM32CubeMXæ•™ç¨‹åä¸‰---RTCæ—¶é’Ÿ</title>
      <link href="/2024/03/%E3%80%90STM32%E3%80%91HAL%E5%BA%93_STM32CubeMX%E6%95%99%E7%A8%8B%E5%8D%81%E4%B8%89---RTC%E6%97%B6%E9%92%9F/"/>
      <url>/2024/03/%E3%80%90STM32%E3%80%91HAL%E5%BA%93_STM32CubeMX%E6%95%99%E7%A8%8B%E5%8D%81%E4%B8%89---RTC%E6%97%B6%E9%92%9F/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>å‰è¨€ï¼š</p><p>æœ¬ç³»åˆ—æ•™ç¨‹å°† å¯¹åº”å¤–è®¾åŸç†ï¼ŒHALåº“ä¸STM32CubeMXç»“åˆåœ¨ä¸€èµ·è®²è§£ï¼Œä½¿æ‚¨å¯ä»¥æ›´å¿«é€Ÿçš„å­¦ä¼šå„ä¸ªæ¨¡å—çš„ä½¿ç”¨</p><p>æ‰€ç”¨å·¥å…·ï¼š</p><p>1ã€èŠ¯ç‰‡ï¼š STM32F407ZET6&#x2F; STM32F103ZET6</p><p>2ã€STM32CubeMxè½¯ä»¶</p><p>3ã€IDEï¼š MDK-Keilè½¯ä»¶</p><p>4ã€STM32F1xx&#x2F;STM32F4xxHALåº“</p><p>çŸ¥è¯†æ¦‚æ‹¬ï¼š</p><p>é€šè¿‡æœ¬ç¯‡åšå®¢æ‚¨å°†å­¦åˆ°ï¼š</p><p>RTCæ—¶é’ŸåŸç†</p><p>STM32CubeMXåˆ›å»ºRTCä¾‹ç¨‹</p><p>HALåº“å®šæ—¶å™¨RTCå‡½æ•°åº“</p><p><strong>PS: è¿™é‡Œçš„RTCè®²è§£ï¼Œæˆ‘ä»¬åªå°†åŸç†ï¼Œä¸è®²å¯„å­˜å™¨ï¼Œå¦‚æœè¦çœ‹RTCçš„å¯„å­˜å™¨ï¼Œè¯·çœ‹è¿™ç¯‡æ–‡ç« </strong> <a href="https://blog.csdn.net/as480133937/article/details/105026033">ã€STM32ã€‘RTCå®æ—¶æ—¶é’Ÿï¼Œæ­¥éª¤è¶…ç»†è¯¦è§£ï¼Œä¸€æ–‡çœ‹æ‡‚RTC</a></p><h3 id="ä»€ä¹ˆæ˜¯RTC"><a href="#ä»€ä¹ˆæ˜¯RTC" class="headerlink" title="ä»€ä¹ˆæ˜¯RTC"></a>ä»€ä¹ˆæ˜¯RTC</h3><p>**RTC (Real Time Clock)**ï¼šå®æ—¶æ—¶é’Ÿ</p><p><strong>RTCæ˜¯ä¸ªç‹¬ç«‹çš„å®šæ—¶å™¨</strong>ã€‚RTCæ¨¡å—æ‹¥æœ‰ä¸€ä¸ªè¿ç»­è®¡æ•°çš„è®¡æ•°å™¨ï¼Œåœ¨ç›¸åº”çš„è½¯ä»¶é…ç½®ä¸‹ï¼Œå¯ä»¥æä¾›æ—¶é’Ÿæ—¥å†çš„åŠŸèƒ½ã€‚ä¿®æ”¹è®¡æ•°å™¨çš„å€¼å¯ä»¥é‡æ–°è®¾ç½®å½“å‰æ—¶é—´å’Œæ—¥æœŸ RTCè¿˜åŒ…å«ç”¨äºç®¡ç†ä½åŠŸè€—æ¨¡å¼çš„è‡ªåŠ¨å”¤é†’å•å…ƒã€‚</p><p><img src="https://img-blog.csdnimg.cn/20200423215123488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200423215123488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p><strong>åœ¨æ–­ç”µæƒ…å†µä¸‹ RTCä»å¯ä»¥ç‹¬ç«‹è¿è¡Œ åªè¦èŠ¯ç‰‡çš„å¤‡ç”¨ç”µæºä¸€ç›´ä¾›ç”µ,RTCä¸Šçš„æ—¶é—´ä¼šä¸€ç›´èµ°ã€‚</strong></p><p>RTCå®è´¨æ˜¯ä¸€ä¸ªæ‰ç”µåè¿˜ç»§ç»­è¿è¡Œçš„å®šæ—¶å™¨,ä»å®šæ—¶å™¨çš„è§’åº¦æ¥çœ‹,ç›¸å¯¹äºé€šç”¨å®šæ—¶å™¨TIMå¤–è®¾,å®ƒçš„åŠŸèƒ½ååˆ†ç®€å•,åªæœ‰è®¡æ—¶åŠŸèƒ½(ä¹Ÿå¯ä»¥è§¦å‘ä¸­æ–­)ã€‚ä½†å…¶é«˜çº§æŒ‡å‡ºä¹Ÿå°±åœ¨äºæ‰ç”µä¹‹åè¿˜å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p><p>ä¸¤ä¸ª 32 ä½å¯„å­˜å™¨åŒ…å«äºŒè¿›ç åè¿›æ•°æ ¼å¼ (BCD) çš„ç§’ã€åˆ†é’Ÿã€å°æ—¶ï¼ˆ 12 æˆ– 24 å°æ—¶åˆ¶ï¼‰ã€æ˜ŸæœŸå‡ ã€æ—¥æœŸã€æœˆä»½å’Œå¹´ä»½ã€‚æ­¤å¤–ï¼Œè¿˜å¯æä¾›äºŒè¿›åˆ¶æ ¼å¼çš„äºšç§’å€¼ã€‚ç³»ç»Ÿå¯ä»¥è‡ªåŠ¨å°†æœˆä»½çš„å¤©æ•°è¡¥å¿ä¸º 28ã€29ï¼ˆé—°å¹´ï¼‰ã€30 å’Œ 31 å¤©ã€‚</p><p>ä¸Šç”µå¤ä½åï¼Œæ‰€æœ‰RTCå¯„å­˜å™¨éƒ½ä¼šå—åˆ°ä¿æŠ¤ï¼Œä»¥é˜²æ­¢å¯èƒ½çš„éæ­£å¸¸å†™è®¿é—®ã€‚</p><p>æ— è®ºå™¨ä»¶çŠ¶æ€å¦‚ä½•ï¼ˆè¿è¡Œæ¨¡å¼ã€ä½åŠŸè€—æ¨¡å¼æˆ–å¤„äºå¤ä½çŠ¶æ€ï¼‰ï¼Œåªè¦ç”µæºç”µå‹ä¿æŒåœ¨å·¥ä½œèŒƒå›´å†…ï¼ŒRTCä½¿ä¸ä¼šåœæ­¢å·¥ä½œã€‚</p><h4 id="RCTç‰¹å¾ï¼š"><a href="#RCTç‰¹å¾ï¼š" class="headerlink" title="RCTç‰¹å¾ï¼š"></a><strong>RCTç‰¹å¾ï¼š</strong></h4><p>â— <strong>å¯ç¼–ç¨‹çš„é¢„åˆ†é¢‘ç³»æ•°ï¼šåˆ†é¢‘ç³»æ•°é«˜ä¸º220ã€‚</strong> â— <strong>32ä½çš„å¯ç¼–ç¨‹è®¡æ•°å™¨ï¼Œå¯ç”¨äºè¾ƒé•¿æ—¶é—´æ®µçš„æµ‹é‡ã€‚</strong> â— <strong>2ä¸ªåˆ†ç¦»çš„æ—¶é’Ÿï¼šç”¨äºAPB1æ¥å£çš„PCLK1å’ŒRTCæ—¶é’Ÿ(RTCæ—¶é’Ÿçš„é¢‘ç‡å¿…é¡»å°äºPCLK1æ—¶é’Ÿ é¢‘ç‡çš„å››åˆ†ä¹‹ä¸€ä»¥ä¸Š)ã€‚</strong> â— å¯ä»¥é€‰æ‹©ä»¥ä¸‹<strong>ä¸‰ç§RTCçš„æ—¶é’Ÿæº</strong>ï¼š Â Â Â Â  â— HSEæ—¶é’Ÿé™¤ä»¥128ï¼› Â Â Â Â  â— LSEæŒ¯è¡å™¨æ—¶é’Ÿï¼› Â Â Â Â  â— LSIæŒ¯è¡å™¨æ—¶é’Ÿ</p><p>â— <strong>2ä¸ªç‹¬ç«‹çš„å¤ä½ç±»å‹ï¼š</strong> Â Â Â Â  â— APB1æ¥å£ç”±ç³»ç»Ÿå¤ä½ï¼› Â Â Â Â  â— RTCæ ¸å¿ƒ(é¢„åˆ†é¢‘å™¨ã€é—¹é’Ÿã€è®¡æ•°å™¨å’Œåˆ†é¢‘å™¨)åªèƒ½ç”±åå¤‡åŸŸå¤ä½</p><p>â— <strong>3ä¸ªä¸“é—¨çš„å¯å±è”½ä¸­æ–­ï¼š</strong> Â Â Â Â  â— 1.<strong>é—¹é’Ÿä¸­æ–­</strong>ï¼Œç”¨æ¥äº§ç”Ÿä¸€ä¸ªè½¯ä»¶å¯ç¼–ç¨‹çš„é—¹é’Ÿä¸­æ–­ã€‚</p><p>Â Â Â Â  â— 2.<strong>ç§’ä¸­æ–­</strong>ï¼Œç”¨æ¥äº§ç”Ÿä¸€ä¸ªå¯ç¼–ç¨‹çš„å‘¨æœŸæ€§ä¸­æ–­ä¿¡å·(é•¿å¯è¾¾1ç§’)ã€‚</p><p>Â Â Â Â  â— 3.<strong>æº¢å‡ºä¸­æ–­</strong>ï¼ŒæŒ‡ç¤ºå†…éƒ¨å¯ç¼–ç¨‹è®¡æ•°å™¨æº¢å‡ºå¹¶å›è½¬ä¸º0çš„çŠ¶æ€ã€‚</p><p><strong>RTCæ—¶é’Ÿæºï¼š</strong> ä¸‰ç§ä¸åŒçš„æ—¶é’Ÿæºå¯è¢«ç”¨æ¥é©±åŠ¨ç³»ç»Ÿæ—¶é’Ÿ(SYSCLK)ï¼š</p><p>â— <strong>HSIæŒ¯è¡å™¨æ—¶é’Ÿ</strong> â— <strong>HSEæŒ¯è¡å™¨æ—¶é’Ÿ</strong> â— <strong>PLLæ—¶é’Ÿ</strong></p><p>è¿™äº›è®¾å¤‡æœ‰ä»¥ä¸‹2ç§äºŒçº§æ—¶é’Ÿæºï¼š</p><p>â— 40kHzä½é€Ÿå†…éƒ¨RCï¼Œå¯ä»¥ç”¨äºé©±åŠ¨ç‹¬ç«‹çœ‹é—¨ç‹—å’Œé€šè¿‡ç¨‹åºé€‰æ‹©é©±åŠ¨RTCã€‚ RTCç”¨äºä»åœæœº&#x2F;å¾…æœºæ¨¡å¼ä¸‹è‡ªåŠ¨å”¤é†’ç³»ç»Ÿã€‚ â— 32.768kHzä½é€Ÿå¤–éƒ¨æ™¶ä½“ä¹Ÿå¯ç”¨æ¥é€šè¿‡ç¨‹åºé€‰æ‹©é©±åŠ¨RTC(RTCCLK)ã€‚</p><h4 id="RTCåŸç†æ¡†å›¾"><a href="#RTCåŸç†æ¡†å›¾" class="headerlink" title="RTCåŸç†æ¡†å›¾"></a>RTCåŸç†æ¡†å›¾</h4><p><img src="https://img-blog.csdnimg.cn/20200322144525734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200322144525734.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"><br> RTCæ—¶é’Ÿçš„æ¡†å›¾è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠä»–åˆ†æˆ <strong><code>ä¸¤ä¸ªéƒ¨åˆ†</code></strong>:</p><p><strong>APB1 æ¥å£</strong>ï¼šç”¨æ¥å’Œ APB1 æ€»çº¿ç›¸è¿ã€‚ æ­¤å•å…ƒè¿˜åŒ…å«ä¸€ç»„ 16 ä½å¯„å­˜å™¨ï¼Œå¯é€šè¿‡ APB1 æ€»çº¿å¯¹å…¶è¿›è¡Œè¯»å†™æ“ä½œã€‚APB1 æ¥å£ç”± APB1 æ€» çº¿æ—¶é’Ÿé©±åŠ¨ï¼Œç”¨æ¥ä¸ APB1 æ€»çº¿è¿æ¥ã€‚</p><p>é€šè¿‡APB1æ¥å£å¯ä»¥è®¿é—®RTCçš„ç›¸å…³å¯„å­˜å™¨ï¼ˆé¢„åˆ†é¢‘å€¼ï¼Œè®¡æ•°å™¨å€¼ï¼Œé—¹é’Ÿå€¼ï¼‰ã€‚</p><p><strong>RTC æ ¸å¿ƒæ¥å£</strong>ï¼šç”±ä¸€ç»„å¯ç¼–ç¨‹è®¡æ•°å™¨ç»„æˆï¼Œåˆ†æˆ <strong><code>ä¸¤ä¸ªä¸»è¦æ¨¡å—</code></strong> ã€‚<br><img src="https://img-blog.csdnimg.cn/20200322223612113.png" alt="https://img-blog.csdnimg.cn/20200322223612113.png"><br>g) <strong>ç¬¬ä¸€ä¸ªæ¨¡å—æ˜¯ RTC çš„ é¢„åˆ†é¢‘æ¨¡å—</strong>ï¼Œå®ƒå¯ç¼–ç¨‹äº§ç”Ÿ 1 ç§’çš„ RTC æ—¶é—´åŸºå‡† TR_CLKã€‚RTC çš„é¢„åˆ†é¢‘æ¨¡å—åŒ…å«äº†ä¸€ä¸ª 20 ä½çš„å¯ç¼–ç¨‹åˆ†é¢‘å™¨(RTC é¢„åˆ†é¢‘å™¨)ã€‚å¦‚æœåœ¨ RTC_CR å¯„å­˜å™¨ä¸­è®¾ç½®äº†ç›¸åº”çš„å…è®¸ä½ï¼Œåˆ™åœ¨æ¯ä¸ª TR_CLK å‘¨æœŸä¸­ RTC äº§ç”Ÿä¸€ä¸ªä¸­æ–­(ç§’ä¸­æ–­)ã€‚<br><img src="https://img-blog.csdnimg.cn/2020032222362770.png" alt="https://img-blog.csdnimg.cn/2020032222362770.png"><br> <strong>ç¬¬äºŒä¸ªæ¨¡å—æ˜¯ä¸€ä¸ª 32 ä½çš„å¯ç¼–ç¨‹è®¡æ•°å™¨ ï¼ˆRTC_CNTï¼‰</strong>ï¼Œå¯è¢«åˆå§‹åŒ–ä¸ºå½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œä¸€ä¸ª 32 ä½çš„æ—¶é’Ÿè®¡æ•°å™¨ï¼ŒæŒ‰ç§’é’Ÿè®¡ç®—ï¼Œå¯ä»¥è®° å½• 4294967296 ç§’ï¼Œçº¦åˆ 136 å¹´å·¦å³ï¼Œä½œä¸ºä¸€èˆ¬åº”ç”¨ï¼Œè¿™å·²ç»æ˜¯è¶³å¤Ÿäº†çš„ã€‚</p><h4 id="RTCå…·ä½“æµç¨‹ï¼š"><a href="#RTCå…·ä½“æµç¨‹ï¼š" class="headerlink" title="RTCå…·ä½“æµç¨‹ï¼š"></a><strong>RTCå…·ä½“æµç¨‹ï¼š</strong></h4><p><strong>RTCCLKç»è¿‡RTC_DIVé¢„åˆ†é¢‘ï¼ŒRTC_PRLè®¾ç½®é¢„åˆ†é¢‘ç³»æ•°ï¼Œç„¶åå¾—åˆ°TR_CLKæ—¶é’Ÿä¿¡å·ï¼Œæˆ‘ä»¬ä¸€èˆ¬è®¾ç½®å…¶å‘¨æœŸä¸º1sï¼ŒRTC_CNTè®¡æ•°å™¨è®¡æ•°ï¼Œå‡å¦‚1970è®¾ç½®ä¸ºæ—¶é—´èµ·ç‚¹ä¸º0sï¼Œé€šè¿‡å½“å‰æ—¶é—´çš„ç§’æ•°è®¡ç®—å¾—åˆ°å½“å‰çš„æ—¶é—´ã€‚RTC_ALRæ˜¯è®¾ç½®é—¹é’Ÿæ—¶é—´ï¼ŒRTC_CNTè®¡æ•°åˆ°RTC_ALRå°±ä¼šäº§ç”Ÿè®¡æ•°ä¸­æ–­ï¼Œ</strong></p><ul><li><strong>RTC_Second</strong>ä¸ºç§’ä¸­æ–­ï¼Œç”¨äºåˆ·æ–°æ—¶é—´ï¼Œ+ <strong>RTC_Overflow</strong>æ˜¯æº¢å‡ºä¸­æ–­ã€‚+ <strong>RTC Alarm</strong> æ§åˆ¶å¼€å…³æœº</li></ul><h4 id="RTCæ—¶é’Ÿé€‰æ‹©"><a href="#RTCæ—¶é’Ÿé€‰æ‹©" class="headerlink" title="RTCæ—¶é’Ÿé€‰æ‹©"></a>RTCæ—¶é’Ÿé€‰æ‹©</h4><p><strong>ä½¿ç”¨HSEåˆ†é¢‘æ—¶é’Ÿæˆ–è€…LSIçš„æ—¶å€™,åœ¨ä¸»ç”µæºVDDæ‰ç”µçš„æƒ…å†µä¸‹,è¿™ä¸¤ä¸ªæ—¶é’Ÿæ¥æºéƒ½ä¼šå—åˆ°å½±å“,å› æ­¤æ²¡æ³•ä¿è¯RTCæ­£å¸¸å·¥ä½œ.æ‰€ä»¥RTCä¸€èˆ¬éƒ½æ—¶é’Ÿä½é€Ÿå¤–éƒ¨æ—¶é’ŸLSE,é¢‘ç‡ä¸ºå®æ—¶æ—¶é’Ÿæ¨¡å—ä¸­å¸¸ç”¨çš„32.768KHz,å› ä¸º32768 &#x3D; 2^15,åˆ†é¢‘å®¹æ˜“å®ç°,æ‰€ä»¥è¢«å¹¿æ³›åº”ç”¨åˆ°RTCæ¨¡å—.(åœ¨ä¸»ç”µæºVDDæœ‰æ•ˆçš„æƒ…å†µä¸‹(å¾…æœº),RTCè¿˜å¯ä»¥é…ç½®é—¹é’Ÿäº‹ä»¶ä½¿STM32é€€å‡ºå¾…æœºæ¨¡å¼).</strong></p><h4 id="RTCå¤ä½è¿‡ç¨‹"><a href="#RTCå¤ä½è¿‡ç¨‹" class="headerlink" title="RTCå¤ä½è¿‡ç¨‹"></a>RTCå¤ä½è¿‡ç¨‹</h4><p>é™¤äº†RTC_PRLã€RTC_ALRã€RTC_CNTå’ŒRTC_DIVå¯„å­˜å™¨å¤–ï¼Œæ‰€æœ‰çš„ç³»ç»Ÿå¯„å­˜å™¨éƒ½ç”±ç³»ç»Ÿå¤ä½æˆ–ç”µæºå¤ä½è¿›è¡Œå¼‚æ­¥å¤ä½ã€‚ RTC_PRLã€RTC_ALRã€RTC_CNTå’ŒRTC_DIVå¯„å­˜å™¨ä»…èƒ½é€šè¿‡å¤‡ä»½åŸŸå¤ä½ä¿¡å·å¤ä½ã€‚</p><p><strong>ç³»ç»Ÿå¤ä½å,ç¦æ­¢è®¿é—®åå¤‡å¯„å­˜å™¨å’ŒRCT,é˜²æ­¢å¯¹åå«åŒºåŸŸ(BKP)çš„æ„å¤–å†™æ“ä½œ</strong></p><h4 id="RTCä¸­æ–­"><a href="#RTCä¸­æ–­" class="headerlink" title="RTCä¸­æ–­"></a>RTCä¸­æ–­</h4><p><strong>ç§’ä¸­æ–­ï¼š</strong> è¿™é‡Œæ—¶é’Ÿè‡ªå¸¦ä¸€ä¸ªç§’ä¸­æ–­ï¼Œæ¯å½“è®¡æ•°åŠ ä¸€çš„æ—¶å€™å°±ä¼šè§¦å‘ä¸€æ¬¡ç§’ä¸­æ–­ï¼Œã€‚æ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„ç§’ä¸­æ–­å¹¶éä¸€å®šæ˜¯ä¸€ç§’çš„æ—¶é—´ï¼Œå®ƒæ˜¯ç”±RTCæ—¶é’Ÿæºå’Œåˆ†é¢‘å€¼å†³å®šçš„â€œç§’â€çš„æ—¶é—´ï¼Œå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥åšåˆ°1ç§’é’Ÿä¸­æ–­ä¸€æ¬¡ã€‚æˆ‘ä»¬é€šè¿‡å¾€ç§’ä¸­æ–­é‡Œå†™æ›´æ–°æ—¶é—´çš„å‡½æ•°æ¥è¾¾åˆ°æ—¶é—´åŒæ­¥çš„æ•ˆæœ</p><p><strong>é—¹é’Ÿä¸­æ–­ï¼š</strong> é—¹é’Ÿä¸­æ–­å°±æ˜¯è®¾ç½®ä¸€ä¸ªé¢„è®¾å®šçš„å€¼ï¼Œè®¡æ•°æ¯è‡ªåŠ å¤šå°‘æ¬¡è§¦å‘ä¸€æ¬¡é—¹é’Ÿä¸­æ–­</p><h3 id="CubeMXé…ç½®RTC"><a href="#CubeMXé…ç½®RTC" class="headerlink" title="CubeMXé…ç½®RTC"></a>CubeMXé…ç½®RTC</h3><h4 id="å·¥ç¨‹åˆ›å»º"><a href="#å·¥ç¨‹åˆ›å»º" class="headerlink" title="å·¥ç¨‹åˆ›å»º"></a>å·¥ç¨‹åˆ›å»º</h4><p><strong>1è®¾ç½®RCC</strong><br><img src="https://img-blog.csdnimg.cn/20200425101549368.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425101549368.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li><strong>è®¾ç½®é«˜é€Ÿå¤–éƒ¨æ—¶é’ŸHSE é€‰æ‹©å¤–éƒ¨æ—¶é’Ÿæº</strong>+ <strong>ä½¿èƒ½å¤–éƒ¨æ™¶æŒ¯LSE</strong></li></ul><p><strong>RTCè®¾å¤‡å› ä¸ºå…¶ç‹¬ç‰¹çš„è¿è¡Œæ–¹å¼ï¼ˆå³æ‰ç”µä¾æ—§è¿è¡Œï¼‰ä½¿ç”¨HSEåˆ†é¢‘æ—¶é’Ÿæˆ–è€…LSIçš„æ—¶å€™,åœ¨ä¸»ç”µæºVDDæ‰ç”µçš„æƒ…å†µä¸‹,è¿™ä¸¤ä¸ªæ—¶é’Ÿæ¥æºéƒ½ä¼šå—åˆ°å½±å“ï¼Œèµ„æºæ¶ˆè€—å¤ªå¤§ï¼Œå°å°çš„çº½æ‰£ç”µæ± æ ¹æœ¬åƒä¸æ¶ˆã€‚æ²¡æ³•ä¿è¯RTCæ­£å¸¸å·¥ä½œ.æ‰€ä»¥RTCä¸€èˆ¬éƒ½æ—¶é’Ÿä½é€Ÿå¤–éƒ¨æ—¶é’ŸLSE</strong></p><p>2.<strong>é…ç½®RTC</strong><br><img src="https://img-blog.csdnimg.cn/20200425110730403.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425110730403.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li><strong>Activate Clock Source æ¿€æ´»æ—¶é’Ÿæº</strong>+ <strong>Activate calendaræ¿€æ´»æ—¥å†</strong></li></ul><p><strong>è¿™ä¸¤ä¸ªéƒ½è¦ç‚¹ï¼Œä½œç”¨ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå…ˆæ˜¯ä½¿èƒ½æ—¶é’Ÿæºï¼Œå†ä½¿èƒ½RTCæ—¥å†</strong></p><ul><li><strong>RTC_OUTï¼š Not RTC_OUT</strong>+ <strong>Tamperï¼š</strong> <strong>Ã—</strong></li></ul><p>ç¬¬ä¸€ä¸ªæ˜¯æ˜¯å¦ä½¿èƒ½ <strong>tamperï¼ˆPC13ï¼‰å¼•è„šä¸Šè¾“å‡ºæ ¡æ­£çš„ç§’è„‰å†²æ—¶é’Ÿï¼Œ</strong></p><p>ç¬¬äºŒä¸ªï¼š <strong>RTCå…¥ä¾µæ£€æµ‹æ ¡éªŒåŠŸèƒ½</strong></p><p><strong>RTCæ ¡éªŒåŠŸèƒ½ï¼Œä½¿èƒ½ä¾µå…¥æ£€æµ‹åŠŸèƒ½ã€‚RTCæ—¶é’Ÿç»64åˆ†é¢‘è¾“å‡ºåˆ°ä¾µå…¥æ£€æµ‹å¼•è„šTAMPERä¸Š å½“ TAMPERå¼•è„šä¸Šçš„ä¿¡å·ä» 0å˜æˆ1æˆ–è€…ä» 1å˜æˆ 0(å–å†³äºå¤‡ä»½æ§åˆ¶å¯„å­˜å™¨BKP_CRçš„ TPALä½)ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªä¾µå…¥æ£€æµ‹äº‹ä»¶ã€‚ä¾µå…¥æ£€æµ‹äº‹ä»¶å°†æ‰€æœ‰æ•°æ®å¤‡ä»½å¯„å­˜å™¨å†…å®¹æ¸…é™¤ã€‚</strong></p><ul><li>ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªæ˜¯ä½¿èƒ½tamperï¼ˆPC13ï¼‰å¼•è„šä½œä¸ºæ—¶é’Ÿè„‰å†²è¾“å‡º+ ç¬¬äºŒä¸ªæ˜¯ä½¿èƒ½tamperï¼ˆPC13ï¼‰å¼•è„šä½œä¸ºå…¥ä¾µæ£€æµ‹åŠŸèƒ½</li></ul><p>ä¸‹é¢æ˜¯ä¸¤ä¸ªRTCçš„ä¸­æ–­ï¼š</p><ul><li><strong>RTCå…¨å±€ä¸­æ–­RTC_IRQHandler()</strong>+ <strong>é—¹é’Ÿä¸­æ–­å‡½æ•°RTCAlarm_IRQHandler()</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/2020042514381771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/2020042514381771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p><strong>æ­¤å¤„è®¾ç½®æ—¶é—´ä¸º2020&#x2F;04&#x2F;25 13:30:00</strong></p><ul><li>Data Format: æ—¥æœŸæ ¼å¼</li></ul><p><strong>Binary data format åå…­è¿›åˆ¶ BCD data format BCDç è¿›åˆ¶</strong></p><p>ä½¿ç”¨è‡ªåŠ¨é…ç½®ï¼Œåˆå§‹åŒ–æ—¶é—´å¿…é¡»ä½¿ç”¨BCD data formatï¼ŒåŸå› æ˜¯åº“å‡½æ•°å­˜åœ¨bugï¼Œå¦‚æœä½¿ç”¨Binary data formatï¼Œæœˆä»½é…ç½®ä¼šå‡ºé”™ï¼Œæ¯”å¦‚è¯´11æœˆï¼Œé…ç½®æ—¶ä¼šèµ‹å€¼ä¸ºRTC_MONTH_NOVEMBERï¼Œè€Œæ­¤å®å®šä¹‰å€¼ä¸º0x11ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶åè¿›åˆ¶å€¼ä¸º17</p><ul><li><strong>Hoursï¼š å°æ—¶</strong> +  <strong>Minutesï¼š åˆ†é’Ÿ</strong> +  <strong>Secondsï¼š ç§’</strong> +  <strong>Week Dayï¼š æ˜ŸæœŸ</strong> +  <strong>Month æœˆä»½</strong> +  <strong>Dateï¼š æ—¥æœŸ</strong> +  <strong>Yearï¼š å¹´ä»½</strong></li></ul><p><strong>3 ä½¿èƒ½ä¸²å£</strong><br><img src="https://img-blog.csdnimg.cn/20200425143944495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425143944495.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"><br> <strong>ä½¿èƒ½ä¸€ä¸‹ä¸²å£ï¼Œå› ä¸ºå‘é€æ—¥æœŸåˆ°ä¸Šä½æœº</strong></p><p><strong>4æ—¶é’Ÿæºè®¾ç½®</strong><br><img src="https://img-blog.csdnimg.cn/20200425144337169.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425144337169.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><p>æˆ‘çš„æ˜¯ å¤–éƒ¨æ™¶æŒ¯ä¸º8MHz</p><ul><li>1é€‰æ‹©å¤–éƒ¨æ—¶é’ŸHSE 8MHz+ 2PLLé”ç›¸ç¯å€é¢‘9å€+ 3ç³»ç»Ÿæ—¶é’Ÿæ¥æºé€‰æ‹©ä¸ºPLL+ 4è®¾ç½®APB1åˆ†é¢‘å™¨ä¸º &#x2F;2+ 5 ä½¿èƒ½CSSç›‘è§†æ—¶é’Ÿ+ <strong>6 è®¾ç½®RTCæ—¶é’Ÿä¸ºLSE</strong></li></ul><p>32çš„æ—¶é’Ÿæ ‘æ¡†å›¾ å¦‚æœä¸æ‡‚çš„è¯è¯·çœ‹<a href="https://blog.csdn.net/as480133937/article/details/98845509">ã€Šã€STM32ã€‘ç³»ç»Ÿæ—¶é’ŸRCCè¯¦è§£(è¶…è¯¦ç»†ï¼Œè¶…å…¨é¢)ã€‹</a></p><p><strong>5é¡¹ç›®æ–‡ä»¶è®¾ç½®</strong><br><img src="https://img-blog.csdnimg.cn/20200425144600886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425144600886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><ul><li>1 è®¾ç½®é¡¹ç›®åç§°+ 2 è®¾ç½®å­˜å‚¨è·¯å¾„+ 3 é€‰æ‹©æ‰€ç”¨IDE<br><img src="https://img-blog.csdnimg.cn/2020042514462236.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/2020042514462236.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></li></ul><p><strong>6åˆ›å»ºå·¥ç¨‹æ–‡ä»¶</strong></p><p><strong>ç„¶åç‚¹å‡»GENERATE CODE åˆ›å»ºå·¥ç¨‹</strong></p><p><strong>é…ç½®ä¸‹è½½å·¥å…·</strong> æ–°å»ºçš„å·¥ç¨‹æ‰€æœ‰é…ç½®éƒ½æ˜¯é»˜è®¤çš„ æˆ‘ä»¬éœ€è¦è‡ªè¡Œé€‰æ‹©ä¸‹è½½æ¨¡å¼ï¼Œå‹¾é€‰ä¸Šä¸‹è½½åå¤ä½è¿è¡Œ</p><p><img src="https://img-blog.csdnimg.cn/202004251446415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/202004251446415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><h4 id="RTC-HALåº“å‡½æ•°"><a href="#RTC-HALåº“å‡½æ•°" class="headerlink" title="RTC_HALåº“å‡½æ•°"></a>RTC_HALåº“å‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*è®¾ç½®ç³»ç»Ÿæ—¶é—´*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span> </span><br><span class="line"><span class="comment">/*è¯»å–ç³»ç»Ÿæ—¶é—´*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*è®¾ç½®ç³»ç»Ÿæ—¥æœŸ*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*è¯»å–ç³»ç»Ÿæ—¥æœŸ*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*å¯åŠ¨æŠ¥è­¦åŠŸèƒ½*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetAlarm</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_AlarmTypeDef *sAlarm, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*è®¾ç½®æŠ¥è­¦ä¸­æ–­*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_SetAlarm_IT</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_AlarmTypeDef *sAlarm, uint32_t Format)</span></span><br><span class="line"><span class="comment">/*æŠ¥è­¦æ—¶é—´å›è°ƒå‡½æ•°*/</span></span><br><span class="line">__weak <span class="keyword">void</span> <span class="title function_">HAL_RTC_AlarmAEventCallback</span><span class="params">(RTC_HandleTypeDef *hrtc)</span></span><br><span class="line"><span class="comment">/*å†™å…¥åå¤‡å‚¨å­˜å™¨*/</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">HAL_RTCEx_BKUPWrite</span><span class="params">(RTC_HandleTypeDef *hrtc, uint32_t BackupRegister, uint32_t Data)</span></span><br><span class="line"><span class="comment">/*è¯»å–åå¤‡å‚¨å­˜å™¨*/</span></span><br><span class="line">uint32_t <span class="title function_">HAL_RTCEx_BKUPRead</span><span class="params">(RTC_HandleTypeDef *hrtc, uint32_t BackupRegister  </span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢çš„å››ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯</p><ul><li><strong>è®¾ç½®ç³»ç»Ÿæ—¶é—´ï¼šHAL_RTC_SetTime();</strong>+ <strong>è¯»å–ç³»ç»Ÿæ—¶é—´: HAL_RTC_GetTime();</strong>+ <strong>è®¾ç½®ç³»ç»Ÿæ—¥æœŸ: HAL_RTC_SetDate();</strong>+ <strong>è¯»å–ç³»ç»Ÿæ—¥æœŸ: HAL_RTC_GetDate();</strong></li></ul><p>å› ä¸ºç³»ç»Ÿçš„æ—¶é—´å’Œæ—¥æœŸå¼€å§‹çš„æ—¶å€™å·²ç»è®¾ç½®è¿‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªç”¨ä¸¤ä¸ªè¯»å–å‡½æ•°</p><p> <strong>è¯»å–ç³»ç»Ÿæ—¶é—´å‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*è¯»å–ç³»ç»Ÿæ—¶é—´*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetTime</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_TimeTypeDef *sTime, uint32_t Format)</span></span><br></pre></td></tr></table></figure><p>åŠŸèƒ½ï¼š è·å–RTCæ—¶é’Ÿçš„æ—¶é—´</p><p>å‚æ•°ï¼š</p><ul><li>*hrtc RTCç»“æ„ä½“å‚æ•° ä¾‹ï¼š&amp;hi2c2 +  <strong>RTC_TimeTypeDef</strong> *sTimeï¼š è·å–RTCæ—¶é—´çš„ç»“æ„ä½“ï¼Œ +  Formatï¼š <strong>è·å–æ—¶é—´çš„æ ¼å¼</strong> <strong>RTC_FORMAT_BIN ä½¿ç”¨16è¿›åˆ¶ RTC_FORMAT_BCD ä½¿ç”¨BCDè¿›åˆ¶</strong></li></ul><p> <strong>è¯»å–ç³»ç»Ÿæ—¥æœŸå‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*è¯»å–ç³»ç»Ÿæ—¥æœŸ*/</span></span><br><span class="line">HAL_StatusTypeDef <span class="title function_">HAL_RTC_GetDate</span><span class="params">(RTC_HandleTypeDef *hrtc, RTC_DateTypeDef *sDate, uint32_t Format)</span></span><br></pre></td></tr></table></figure><p>åŠŸèƒ½ï¼š è·å–RTCæ—¶é’Ÿçš„æ—¥æœŸ</p><p>å‚æ•°ï¼š</p><ul><li>*hrtc RTCç»“æ„ä½“å‚æ•° ä¾‹ï¼š&amp;hi2c2 +  <strong>RTC_DateTypeDef</strong> *sTimeï¼š è·å–RTCæ—¥æœŸçš„ç»“æ„ä½“ï¼Œ +  Formatï¼š <strong>è·å–æ—¥æœŸçš„æ ¼å¼</strong> <strong>RTC_FORMAT_BIN ä½¿ç”¨16è¿›åˆ¶ RTC_FORMAT_BCD ä½¿ç”¨BCDè¿›åˆ¶</strong></li></ul><p>åœ¨stm32f1xx_hal_rtc.hå¤´æ–‡ä»¶ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°<code>RTC_TimeTypeDef</code>ï¼Œ<code>RTC_DateTypeDef</code>è¿™ä¸¤ä¸ªç»“æ„ä½“çš„æˆå‘˜å˜é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  * @brief  RTC Time structure definition</span><br><span class="line">  */</span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  uint8_t Hours;            /*!&lt; Specifies the RTC Time Hour.</span><br><span class="line">                                 This parameter must be a number between Min_Data = 0 and Max_Data = 23 */</span><br><span class="line"></span><br><span class="line">  uint8_t Minutes;          /*!&lt; Specifies the RTC Time Minutes.</span><br><span class="line">                                 This parameter must be a number between Min_Data = 0 and Max_Data = 59 */</span><br><span class="line"></span><br><span class="line">  uint8_t Seconds;          /*!&lt; Specifies the RTC Time Seconds.</span><br><span class="line">                                 This parameter must be a number between Min_Data = 0 and Max_Data = 59 */</span><br><span class="line"></span><br><span class="line">&#125; RTC_TimeTypeDef;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  * @brief  RTC Date structure definition</span><br><span class="line">  */</span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  uint8_t WeekDay;  /*!&lt; Specifies the RTC Date WeekDay (not necessary for HAL_RTC_SetDate).</span><br><span class="line">                         This parameter can be a value of @ref RTC_WeekDay_Definitions */</span><br><span class="line"></span><br><span class="line">  uint8_t Month;    /*!&lt; Specifies the RTC Date Month (in BCD format).</span><br><span class="line">                         This parameter can be a value of @ref RTC_Month_Date_Definitions */</span><br><span class="line"></span><br><span class="line">  uint8_t Date;     /*!&lt; Specifies the RTC Date.</span><br><span class="line">                         This parameter must be a number between Min_Data = 1 and Max_Data = 31 */</span><br><span class="line"></span><br><span class="line">  uint8_t Year;     /*!&lt; Specifies the RTC Date Year.</span><br><span class="line">                         This parameter must be a number between Min_Data = 0 and Max_Data = 99 */</span><br><span class="line"></span><br><span class="line">&#125; RTC_DateTypeDef;</span><br></pre></td></tr></table></figure><p><strong>ç¨‹åºä»£ç ï¼š</strong></p><p>main.c</p><p><strong>åœ¨main.cä¸­é‡å†™fputcå‡½æ•°ï¼Œä½¿å¾—èƒ½å¤Ÿä½¿ç”¨printfå‡½æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdio.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int fputc(int ch,FILE *f)&#123;</span><br><span class="line"> uint8_t temp[1]=&#123;ch&#125;;</span><br><span class="line"> HAL_UART_Transmit(&amp;huart1,temp,1,2);</span><br><span class="line"> return ch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®šä¹‰ä¸¤ä¸ªç»“æ„ä½“æ¥è·å–æ—¥æœŸå’Œæ—¶é—´ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RTC_DateTypeDef GetData;  //è·å–æ—¥æœŸç»“æ„ä½“</span><br><span class="line"></span><br><span class="line">RTC_TimeTypeDef GetTime;   //è·å–æ—¶é—´ç»“æ„ä½“</span><br></pre></td></tr></table></figure><p>åœ¨whileå¾ªç¯ä¸­æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/* Get the RTC current Time */</span><br><span class="line">HAL_RTC_GetTime(&amp;hrtc, &amp;GetTime, RTC_FORMAT_BIN);</span><br><span class="line">   /* Get the RTC current Date */</span><br><span class="line">   HAL_RTC_GetDate(&amp;hrtc, &amp;GetData, RTC_FORMAT_BIN);</span><br><span class="line"></span><br><span class="line">   /* Display date Format : yy/mm/dd */</span><br><span class="line">   printf(&quot;%02d/%02d/%02d\r\n&quot;,2000 + GetData.Year, GetData.Month, GetData.Date);</span><br><span class="line">   /* Display time Format : hh:mm:ss */</span><br><span class="line">   printf(&quot;%02d:%02d:%02d\r\n&quot;,GetTime.Hours, GetTime.Minutes, GetTime.Seconds);</span><br><span class="line"></span><br><span class="line">   printf(&quot;\r\n&quot;);</span><br><span class="line"></span><br><span class="line">   HAL_Delay(1000);</span><br></pre></td></tr></table></figure><p><strong>ç¨‹åºä¸­ä½¿ç”¨HAL_RTC_GetTimeï¼ˆï¼‰,HAL_RTC_GetDate()è¯»å–æ—¶é—´å’Œæ—¥æœŸï¼Œå¹¶ä¿å­˜åˆ°ç»“æ„ä½“å˜é‡ä¸­ï¼Œç„¶åé€šè¿‡ä¸²å£è¾“å‡ºè¯»å–çš„æ—¶é—´å’Œæ—¥æœŸã€‚</strong></p><p><strong>ä¾‹ç¨‹æµ‹è¯•æ­£å¸¸ï¼š</strong><br><img src="https://img-blog.csdnimg.cn/20200425153330941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70" alt="https://img-blog.csdnimg.cn/20200425153330941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FzNDgwMTMzOTM3,size_16,color_FFFFFF,t_70"></p><h4 id="RTCæ‰ç”µé‡ç½®"><a href="#RTCæ‰ç”µé‡ç½®" class="headerlink" title="RTCæ‰ç”µé‡ç½®"></a>RTCæ‰ç”µé‡ç½®</h4><p>ä½†æ˜¯å‘¢ï¼Œåœ¨halåº“ä¸­ç”Ÿæˆçš„ä»£ç ï¼Œ<strong>æ¯æ¬¡æ–­ç”µå°±RTCæ—¶é—´ä¼šé‡ç½®</strong>ï¼Œæ¯æ¬¡ä¸Šç”µéƒ½ä¼šé‡æ–°åˆå§‹åŒ–æ—¶é—´</p><p>å› ä¸ºHALåº“è®¾ç½®äº†ä¸€ä¸ªBKPå¯„å­˜å™¨ä¿å­˜ä¸€ä¸ªæ ‡å¿—ã€‚æ¯æ¬¡å•ç‰‡æœºå¯åŠ¨æ—¶éƒ½è¯»å–è¿™ä¸ªæ ‡å¿—å¹¶åˆ¤æ–­æ˜¯ä¸æ˜¯é¢„å…ˆè®¾å®šçš„å€¼ï¼šå¦‚åº¦æœä¸æ˜¯å°±åˆå§‹åŒ–RTCå¹¶è®¾ç½®æ—¶é—´ï¼Œå†è®¾ç½®æ ‡å¿—ä¸ºé¢„æœŸå€¼ï¼›å¦‚æœæ˜¯é¢„æœŸå€¼å°±è·³è¿‡åˆå§‹åŒ–å’Œæ—¶é—´è®¾ç½®ï¼Œç»§ç»­æ‰§è¡Œåé¢çš„ç¨‹åº</p><p><strong>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ¯æ¬¡ä¸Šç”µæ‰§è¡ŒRTCåˆå§‹åŒ–ä¹‹å‰ï¼Œå°†æ ‡å¿—è®¾ç½®ä¸ºé¢„æœŸå€¼å³å¯</strong></p><p><strong>åœ¨rtc.cä¸­çš„RTC_Initä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹å³å¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"> void MX_RTC_Init(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN RTC_Init 0 */</span><br><span class="line">RTC_TimeTypeDef time;   //æ—¶é—´ç»“æ„ä½“å‚æ•°</span><br><span class="line">RTC_DateTypeDef datebuff;   //æ—¥æœŸç»“æ„ä½“å‚æ•°</span><br><span class="line">  /* USER CODE END RTC_Init 0 */</span><br><span class="line"></span><br><span class="line">  RTC_TimeTypeDef sTime = &#123;0&#125;;</span><br><span class="line">  RTC_DateTypeDef DateToUpdate = &#123;0&#125;;</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN RTC_Init 1 */</span><br><span class="line">__HAL_RCC_BKP_CLK_ENABLE();       //å¼€å¯åå¤‡åŒºåŸŸæ—¶é’Ÿ</span><br><span class="line">__HAL_RCC_PWR_CLK_ENABLE();  //å¼€å¯ç”µæºæ—¶é’Ÿ</span><br><span class="line">  /* USER CODE END RTC_Init 1 */</span><br><span class="line">  /**Initialize RTC Only </span><br><span class="line">  */</span><br><span class="line">  hrtc.Instance = RTC;</span><br><span class="line">  hrtc.Init.AsynchPrediv = RTC_AUTO_1_SECOND;</span><br><span class="line">  hrtc.Init.OutPut = RTC_OUTPUTSOURCE_NONE;</span><br><span class="line">  if (HAL_RTC_Init(&amp;hrtc) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /* USER CODE BEGIN Check_RTC_BKUP */</span><br><span class="line">if(HAL_RTCEx_BKUPRead(&amp;hrtc,RTC_BKP_DR1)!= 0x5051)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  /* USER CODE END Check_RTC_BKUP */</span><br><span class="line"></span><br><span class="line">  /**Initialize RTC and set the Time and Date </span><br><span class="line">  */</span><br><span class="line">  sTime.Hours = 0x14;</span><br><span class="line">  sTime.Minutes = 0x30;</span><br><span class="line">  sTime.Seconds = 0x0;</span><br><span class="line"></span><br><span class="line">  if (HAL_RTC_SetTime(&amp;hrtc, &amp;sTime, RTC_FORMAT_BCD) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line">  DateToUpdate.WeekDay = RTC_WEEKDAY_SATURDAY;</span><br><span class="line">  DateToUpdate.Month = RTC_MONTH_APRIL;</span><br><span class="line">  DateToUpdate.Date = 0x25;</span><br><span class="line">  DateToUpdate.Year = 0x20;</span><br><span class="line"></span><br><span class="line">  if (HAL_RTC_SetDate(&amp;hrtc, &amp;DateToUpdate, RTC_FORMAT_BCD) != HAL_OK)</span><br><span class="line">  &#123;</span><br><span class="line">    Error_Handler();</span><br><span class="line">  &#125;</span><br><span class="line">  /* USER CODE BEGIN RTC_Init 2 */</span><br><span class="line"></span><br><span class="line">__HAL_RTC_SECOND_ENABLE_IT(&amp;hrtc,RTC_IT_SEC); //å¼€å¯RTCæ—¶é’Ÿç§’ä¸­æ–­</span><br><span class="line">datebuff = DateToUpdate;  //æŠŠæ—¥æœŸæ•°æ®æ‹·è´åˆ°è‡ªå·±å®šä¹‰çš„dataä¸­</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR1, 0x5051);//å‘æŒ‡å®šçš„åå¤‡åŒºåŸŸå¯„å­˜å™¨å†™å…¥æ•°æ®</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR2, (uint16_t)datebuff.Year);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR3, (uint16_t)datebuff.Month);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR4, (uint16_t)datebuff.Date);</span><br><span class="line">HAL_RTCEx_BKUPWrite(&amp;hrtc, RTC_BKP_DR5, (uint16_t)datebuff.WeekDay);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">datebuff.Year    = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR2);</span><br><span class="line">datebuff.Month   = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR3);</span><br><span class="line">datebuff.Date    = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR4);</span><br><span class="line">datebuff.WeekDay = HAL_RTCEx_BKUPRead(&amp;hrtc, RTC_BKP_DR5);</span><br><span class="line">DateToUpdate = datebuff;</span><br><span class="line">if (HAL_RTC_SetDate(&amp;hrtc, &amp;DateToUpdate, RTC_FORMAT_BIN) != HAL_OK)</span><br><span class="line">&#123;</span><br><span class="line">Error_Handler();</span><br><span class="line">&#125;</span><br><span class="line">__HAL_RTC_SECOND_ENABLE_IT(&amp;hrtc,RTC_IT_SEC); //å¼€å¯RTCæ—¶é’Ÿç§’ä¸­æ–­</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200425165901167.gif" alt="https://img-blog.csdnimg.cn/20200425165901167.gif"></p><p><img src="https://img-blog.csdnimg.cn/20200425165904365.gif" alt="https://img-blog.csdnimg.cn/20200425165904365.gif"></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32 halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32 HAL GPIOè¯¦ç»†ç¯‡</title>
      <link href="/2024/03/stm32-STM32HAL%E5%BA%93%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94GPIO/"/>
      <url>/2024/03/stm32-STM32HAL%E5%BA%93%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94GPIO/</url>
      
        <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="ä¸€ã€åŸºç¡€çŸ¥è¯†"><a href="#ä¸€ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸€ã€åŸºç¡€çŸ¥è¯†"></a>ä¸€ã€åŸºç¡€çŸ¥è¯†</h2><p>GPIOå…¨åä¸ºGeneral Purpose Input Outputï¼Œå³é€šç”¨è¾“å…¥è¾“å‡ºã€‚æœ‰æ—¶å€™ç®€ç§°ä¸ºâ€œIOå£â€ã€‚é€šç”¨ï¼Œè¯´æ˜å®ƒæ˜¯å¸¸è§çš„ã€‚è¾“å…¥è¾“å‡ºï¼Œå°±æ˜¯è¯´æ—¢èƒ½å½“è¾“å…¥å£ä½¿ç”¨ï¼Œåˆèƒ½å½“è¾“å‡ºå£ä½¿ç”¨ã€‚ç«¯å£ï¼Œå°±æ˜¯å…ƒå™¨ä»¶ä¸Šçš„ä¸€ä¸ªå¼•è„šã€‚</p><p>è¾“å…¥æ¨¡å¼å’Œè¾“å‡ºæ¨¡å¼æ˜¯GPIOçš„åŸºæœ¬ç‰¹æ€§ï¼Œå½“ç„¶GPIOè¿˜æœ‰å…¶å®ƒæ¨¡å¼å¯é€‰ã€‚</p><p><img src="https://img-blog.csdnimg.cn/4b4a4a4a754c42a686395c54851dac7f.png" alt="./figures/4b4a4a4a754c42a686395c54851dac7f.png"></p><h3 id="IOè€å‹é—®é¢˜"><a href="#IOè€å‹é—®é¢˜" class="headerlink" title="IOè€å‹é—®é¢˜"></a>IOè€å‹é—®é¢˜</h3><p>STM32æ˜¯ä¸€æ¬¾3.3Vç”µå‹çš„èŠ¯ç‰‡ï¼ŒIOè¾“å‡ºæ˜¯3.3V,ä½†IOå¤§éƒ¨åˆ†éƒ½æ˜¯å¯ä»¥å®¹å¿5Vç”µå‹è¾“å…¥ã€‚ä¸€èˆ¬åœ¨èŠ¯ç‰‡æ‰‹å†Œçš„â€œå¼•è„šå®šä¹‰â€ç« èŠ‚å¯ä»¥æŸ¥çœ‹åˆ°æœ‰FTæ ‡è¯†è¡¨ç¤ºè¯¥IOå¯ä»¥å®¹å¿5Vç”µå‹è¾“å…¥ã€‚</p><p><img src="https://img-blog.csdnimg.cn/417fa39b882b42de99526837d5af45b2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5bCP56W655qE5a6d5a6d,size_20,color_FFFFFF,t_70,g_se,x_16" alt="./figures/417fa39b882b42de99526837d5af45b2.png"></p><h2 id="äºŒã€åœ¨HALåº“ä¸­çš„GPIOçš„æ¨¡å¼"><a href="#äºŒã€åœ¨HALåº“ä¸­çš„GPIOçš„æ¨¡å¼" class="headerlink" title="äºŒã€åœ¨HALåº“ä¸­çš„GPIOçš„æ¨¡å¼"></a>äºŒã€åœ¨HALåº“ä¸­çš„GPIOçš„æ¨¡å¼</h2><h2 id="ï¼‘ã€è¾“å…¥æ¨¡å¼GPIOï¼¿Input"><a href="#ï¼‘ã€è¾“å…¥æ¨¡å¼GPIOï¼¿Input" class="headerlink" title="ï¼‘ã€è¾“å…¥æ¨¡å¼GPIOï¼¿Input"></a>ï¼‘ã€è¾“å…¥æ¨¡å¼GPIOï¼¿Input</h2><h4 id="ä¸Šæ‹‰æˆ–ä¸‹æ‹‰è¾“å…¥ï¼ˆGPIO-Pull-upï¼Pull-downï¼‰ï¼š"><a href="#ä¸Šæ‹‰æˆ–ä¸‹æ‹‰è¾“å…¥ï¼ˆGPIO-Pull-upï¼Pull-downï¼‰ï¼š" class="headerlink" title="ä¸Šæ‹‰æˆ–ä¸‹æ‹‰è¾“å…¥ï¼ˆGPIOã€€Pull-upï¼Pull-downï¼‰ï¼š"></a>ä¸Šæ‹‰æˆ–ä¸‹æ‹‰è¾“å…¥ï¼ˆGPIOã€€Pull-upï¼Pull-downï¼‰ï¼š</h4><p>Â Â Â Â Â Â Â Â ï½œæµ®ç©ºè¾“å…¥ï¼ˆNoã€€pullï¼upã€€andã€€noã€€pullï¼downï¼‰ï¼šå¼•è„šç”µå¹³æ˜¯çœŸå®çš„å¤–éƒ¨è¿æ¥å™¨ä»¶ç”µå‹ï¼Œç”µå¹³æœ‰ä¸ç¡®å®šæ€§</p><p>Â Â Â Â Â Â Â Â ï½œä¸Šæ‹‰è¾“å…¥ï¼ˆPullï¼upï¼‰ï¼šé»˜è®¤é€šè¿‡ç”µé˜»ä¸Šæ‹‰åˆ°VCC,ä¸æ¥å¤–éƒ¨å™¨ä»¶æ—¶å¯ä»¥è¯»å‡ºé«˜ç”µå¹³</p><p>Â Â Â Â Â Â Â Â ï½œä¸‹æ‹‰è¾“å…¥ï¼ˆPull-downï¼‰ï¼šé»˜è®¤é€šè¿‡ç”µé˜»ä¸‹æ‹‰åˆ°GND,ä¸æ¥å¤–éƒ¨å™¨ä»¶æ—¶å¯ä»¥è¯»å‡ºä½ç”µå¹³</p><h3 id="ï¼’ã€è¾“å‡ºæ¨¡å¼GPIO-Out"><a href="#ï¼’ã€è¾“å‡ºæ¨¡å¼GPIO-Out" class="headerlink" title="ï¼’ã€è¾“å‡ºæ¨¡å¼GPIO_Out"></a>ï¼’ã€è¾“å‡ºæ¨¡å¼GPIO_Out</h3><h4 id="é»˜è®¤è¾“å‡ºç”µå¹³ï¼ˆGPIO-output-levelï¼‰ï¼š"><a href="#é»˜è®¤è¾“å‡ºç”µå¹³ï¼ˆGPIO-output-levelï¼‰ï¼š" class="headerlink" title="é»˜è®¤è¾“å‡ºç”µå¹³ï¼ˆGPIOã€€outputã€€levelï¼‰ï¼š"></a>é»˜è®¤è¾“å‡ºç”µå¹³ï¼ˆGPIOã€€outputã€€levelï¼‰ï¼š</h4><p>Â  Â  Â  Â  ï½œä½ç”µå¹³ï¼ˆLowï¼‰ï¼šé»˜è®¤è¾“å‡ºä½ç”µå¹³</p><p>Â  Â  Â  Â  ï½œé«˜ç”µå¹³ï¼ˆHighï¼‰ï¼šé»˜è®¤è¾“å‡ºé«˜ç”µå¹³</p><h4 id="è¾“å‡ºç±»å‹ï¼ˆGPIO-Modeï¼‰ï¼š"><a href="#è¾“å‡ºç±»å‹ï¼ˆGPIO-Modeï¼‰ï¼š" class="headerlink" title="è¾“å‡ºç±»å‹ï¼ˆGPIOã€€Modeï¼‰ï¼š"></a>è¾“å‡ºç±»å‹ï¼ˆGPIOã€€Modeï¼‰ï¼š</h4><p>Â  Â  Â  Â  ï½œæ¨æŒ½è¾“å‡ºï¼ˆOutputã€€Pushã€€Pullï¼‰ï¼šä¸€ç§ä½¿ç”¨ä¸€å¯¹é€‰æ‹©æ€§åœ°ä»ç›¸è¿è´Ÿè½½çŒç”µæµæˆ–è€…æ‹‰ç”µæµçš„å™¨ä»¶çš„ç”µè·¯ã€‚</p><p>Â  Â  Â  Â  ï½œå¼€æ¼è¾“å‡ºï¼ˆOutputã€€Openã€€Drainï¼‰ï¼šé«˜ç”µå¹³æ—¶æ²¡æœ‰é©±åŠ¨èƒ½åŠ›ï¼Œéœ€è¦å€ŸåŠ©å¤–éƒ¨ä¸Šæ‹‰ç”µé˜»å®Œæˆå¯¹å¤–é©±åŠ¨ã€‚</p><h4 id="ä¸Šæ‹‰æˆ–ä¸‹æ‹‰è¾“å‡ºï¼ˆGPIO-Pull-upï¼Pull-downï¼‰ï¼š"><a href="#ä¸Šæ‹‰æˆ–ä¸‹æ‹‰è¾“å‡ºï¼ˆGPIO-Pull-upï¼Pull-downï¼‰ï¼š" class="headerlink" title="ä¸Šæ‹‰æˆ–ä¸‹æ‹‰è¾“å‡ºï¼ˆGPIOã€€Pull-upï¼Pull-downï¼‰ï¼š"></a>ä¸Šæ‹‰æˆ–ä¸‹æ‹‰è¾“å‡ºï¼ˆGPIOã€€Pull-upï¼Pull-downï¼‰ï¼š</h4><p>Â Â Â Â Â Â Â Â ï½œæµ®ç©ºè¾“å‡ºï¼ˆNoã€€pullï¼upã€€andã€€noã€€pullï¼downï¼‰ï¼šå¼•è„šç”µå¹³æ˜¯çœŸå®çš„å¤–éƒ¨è¿æ¥å™¨ä»¶ç”µå‹ï¼Œç”µå¹³æœ‰ä¸ç¡®å®šæ€§</p><p>Â Â Â Â Â Â Â Â ï½œä¸Šæ‹‰è¾“å‡ºï¼ˆPullï¼upï¼‰ï¼šé»˜è®¤é€šè¿‡ç”µé˜»ä¸Šæ‹‰åˆ°VCC,ä¸æ¥å¤–éƒ¨å™¨ä»¶æ—¶å¯ä»¥è¾“å‡ºé«˜ç”µå¹³</p><p>Â Â Â Â Â Â Â Â ï½œä¸‹æ‹‰è¾“å‡ºï¼ˆPull-downï¼‰ï¼šé»˜è®¤é€šè¿‡ç”µé˜»ä¸‹æ‹‰åˆ°GND,ä¸æ¥å¤–éƒ¨å™¨ä»¶æ—¶å¯ä»¥è¾“å‡ºä½ç”µå¹³Â </p><h4 id="è¾“å‡ºé¢‘ç‡ï¼ˆMaximum-output-speedï¼‰ï¼š"><a href="#è¾“å‡ºé¢‘ç‡ï¼ˆMaximum-output-speedï¼‰ï¼š" class="headerlink" title="è¾“å‡ºé¢‘ç‡ï¼ˆMaximumã€€outputã€€speedï¼‰ï¼š"></a>è¾“å‡ºé¢‘ç‡ï¼ˆMaximumã€€outputã€€speedï¼‰ï¼š</h4><p>Â  Â  Â  Â  ï½œä½é¢‘ç‡è¾“å‡ºï¼ˆLOWï¼‰</p><p>Â  Â  Â  Â  ï½œä¸­é¢‘ç‡è¾“å‡ºï¼ˆMediumï¼‰</p><p>Â  Â  Â  Â  ï½œé«˜é¢‘ç‡è¾“å‡ºï¼ˆHighï¼‰</p><p>Â  Â  Â  Â  ï½œæé«˜é¢‘ç‡è¾“å‡ºï¼ˆVeryã€€Highï¼‰</p><h2 id="ä¸‰ã€åœ¨CubeMXä¸­ä¿®æ”¹å¼•è„šåç§°"><a href="#ä¸‰ã€åœ¨CubeMXä¸­ä¿®æ”¹å¼•è„šåç§°" class="headerlink" title="ä¸‰ã€åœ¨CubeMXä¸­ä¿®æ”¹å¼•è„šåç§°"></a>ä¸‰ã€åœ¨CubeMXä¸­ä¿®æ”¹å¼•è„šåç§°</h2><p>Â Â Â Â Â Â Â Â 1.åœ¨å·¦ä¾§æ‰¾åˆ°System Core-&gt;GPIOï¼›</p><p>Â Â Â Â Â Â Â Â 2.æ‰¾åˆ°åº”å¯¹çš„GPIOï¼Œä¾‹å¦‚PH10ï¼›</p><p>Â Â Â Â Â Â Â Â 3.åœ¨ä¸‹æ–¹çš„é…ç½®å•ä¸­User Label å¡«å†™å‘½åï¼Œå¡«å¥½åä¼šåœ¨èŠ¯ç‰‡ç¼©ç•¥å›¾ä¸­æ›´æ–°</p><p>Â Â Â Â Â Â Â Â 4.ç‚¹å‡» GENERATE CODE ç”Ÿæˆä»£ç </p><h2 id="å››ã€å¸¸ç”¨å¼•è„šè¾“å…¥å‡½æ•°"><a href="#å››ã€å¸¸ç”¨å¼•è„šè¾“å…¥å‡½æ•°" class="headerlink" title="å››ã€å¸¸ç”¨å¼•è„šè¾“å…¥å‡½æ•°"></a>å››ã€å¸¸ç”¨å¼•è„šè¾“å…¥å‡½æ•°</h2><p>Â Â Â Â Â Â Â Â å‡½æ•°åï¼šHAL_GPIO_ReadPin(å‚æ•°1,å‚æ•°2)</p><p>Â Â Â Â Â Â Â Â å‡½æ•°ä½œç”¨ï¼šè¯»å–å¯¹åº”çš„å¼•è„šç”µå¹³</p><p>Â  Â  Â  Â  è¿”å›å€¼ï¼šè‹¥è¯»å–åˆ°é«˜ç”µå¹³ï¼Œåˆ™è¿”å›GPIO_PIN_SETï¼›åä¹‹ï¼Œè¯»å–åˆ°ä½ç”µå¹³ï¼Œåˆ™è¿”å›GPIO_PIN_RESETÂ  Â  Â Â </p><p>Â Â Â Â Â Â Â Â å‚æ•°1ï¼šGPIOx Â Â Â Â Â å¯¹åº”GPIOæ€»çº¿ï¼Œå…¶ä¸­xå¯ä»¥æ˜¯Aâ€¦Iï¼Œä¾‹å¦‚PH10ï¼Œåˆ™è¾“å…¥GPIOH</p><p>Â Â Â Â Â Â Â Â å‚æ•°2ï¼šGPIO_Pin Â Â å¯¹åº”å¼•è„šæ•°ï¼Œå¯ä»¥æ˜¯1â€¦15ï¼Œä¾‹å¦‚PH10ï¼Œåˆ™è¾“å…¥GPIO_PIN_10</p><h2 id="äº”ã€å¸¸ç”¨å¼•è„šè¾“å‡ºå‡½æ•°"><a href="#äº”ã€å¸¸ç”¨å¼•è„šè¾“å‡ºå‡½æ•°" class="headerlink" title="äº”ã€å¸¸ç”¨å¼•è„šè¾“å‡ºå‡½æ•°"></a>äº”ã€å¸¸ç”¨å¼•è„šè¾“å‡ºå‡½æ•°</h2><p>Â Â Â Â Â Â Â Â å‡½æ•°åï¼šHAL_GPIO_WritePin(å‚æ•°1,å‚æ•°2,å‚æ•°3)</p><p>Â Â Â Â Â Â Â Â å‡½æ•°ä½œç”¨ï¼šä½¿å¯¹åº”çš„å¼•è„šè¾“å‡ºé«˜ç”µå¹³æˆ–è€…ä½ç”µå¹³</p><p>Â Â Â Â Â Â Â Â è¿”å›å€¼ï¼šviod</p><p>Â Â Â Â Â Â Â Â å‚æ•°1ï¼šGPIOx Â Â Â Â Â å¯¹åº”GPIOæ€»çº¿ï¼Œå…¶ä¸­xå¯ä»¥æ˜¯Aâ€¦Iï¼Œä¾‹å¦‚PH10ï¼Œåˆ™è¾“å…¥GPIOH</p><p>Â Â Â Â Â Â Â Â å‚æ•°2ï¼šGPIO_Pin Â Â å¯¹åº”å¼•è„šæ•°ï¼Œå¯ä»¥æ˜¯1â€¦15ï¼Œä¾‹å¦‚PH10ï¼Œåˆ™è¾“å…¥GPIO_PIN_10</p><p>Â Â Â Â Â Â Â Â å‚æ•°3ï¼šPinState Â Â Â GPIO_PIN_RESETï¼Œè¾“å‡ºä½ç”µå¹³ï¼›GPIO_PIN_SETï¼Œè¾“å‡ºé«˜ç”µå¹³</p><p>ï¼ˆè‹¥ä¿®æ”¹å¯¹åº”å¼•è„šçš„åå­—ï¼Œä¾‹å¦‚PH10ä¿®æ”¹ä¸ºLEDï¼Œåˆ™è¾“å…¥ HAL_GPIO_WritePin(LED_GPIO_Port,LED_Pin,å‚æ•°3)ï¼‰</p><h2 id="å…­ã€å…¶ä»–å¸¸ç”¨å‡½æ•°"><a href="#å…­ã€å…¶ä»–å¸¸ç”¨å‡½æ•°" class="headerlink" title="å…­ã€å…¶ä»–å¸¸ç”¨å‡½æ•°"></a>å…­ã€å…¶ä»–å¸¸ç”¨å‡½æ•°</h2><p>Â Â Â Â Â Â Â Â å‡½æ•°åï¼šHAL_GPIO_ToglePin(å‚æ•°1,å‚æ•°2)</p><p>Â Â Â Â Â Â Â Â å‡½æ•°ä½œç”¨ï¼šç¿»è½¬å¯¹åº”å¼•è„šçš„ç”µå¹³</p><p>Â Â Â Â Â Â Â Â è¿”å›å€¼ï¼šviod</p><p>Â Â Â Â Â Â Â Â å‚æ•°1ï¼šGPIOx Â Â Â Â Â å¯¹åº”GPIOæ€»çº¿ï¼Œå…¶ä¸­xå¯ä»¥æ˜¯Aâ€¦Iï¼Œä¾‹å¦‚PH10ï¼Œåˆ™è¾“å…¥GPIOH</p><p>Â Â Â Â Â Â Â Â å‚æ•°2ï¼šGPIO_Pin Â Â å¯¹åº”å¼•è„šæ•°ï¼Œå¯ä»¥æ˜¯1â€¦15ï¼Œä¾‹å¦‚PH10ï¼Œåˆ™è¾“å…¥GPIO_PIN_10</p><p>Â Â Â Â Â Â Â Â </p><p>Â Â Â Â Â Â Â Â å‡½æ•°åï¼šHAL_Delay(å‚æ•°1)</p><p>Â Â Â Â Â Â Â Â å‡½æ•°ä½œç”¨ï¼šå»¶æ—¶</p><p>Â Â Â Â Â Â Â Â è¿”å›å€¼ï¼švoid</p><p>Â Â Â Â Â Â Â Â å‚æ•°1ï¼šå¸¸æ•°ï¼Œå•ä½ms</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/dongxiaodong/p/14128088.html">STM32 GPIOè¯¦ç»†ç¯‡ï¼ˆåŸºäºHALåº“ï¼‰</a></p>]]></content>
      
      
      <categories>
          
          <category> stm32 </category>
          
          <category> stm32 halåº“å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> stm32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoä½¿ç”¨æ•™ç¨‹</title>
      <link href="/2024/03/usageOfHexo/"/>
      <url>/2024/03/usageOfHexo/</url>
      
        <content type="html"><![CDATA[<h1 id="hexoä½¿ç”¨æ•™ç¨‹"><a href="#hexoä½¿ç”¨æ•™ç¨‹" class="headerlink" title="hexoä½¿ç”¨æ•™ç¨‹"></a>hexoä½¿ç”¨æ•™ç¨‹</h1><h2 id="1-å‘å¸ƒæ–‡ç« "><a href="#1-å‘å¸ƒæ–‡ç« " class="headerlink" title="1. å‘å¸ƒæ–‡ç« "></a>1. å‘å¸ƒæ–‡ç« </h2><p>1.æ–°å»ºæ–‡ç« <br>&emsp;&emsp;ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥æ–°å»ºæ–‡ç« ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new [layout] \&lt;title\&gt; </span><br></pre></td></tr></table></figure><p>&ensp;&ensp;&ensp;&ensp;å…¶ä¸­layoutæ˜¯æ–‡ç« çš„å¸ƒå±€ï¼Œé»˜è®¤ä¸ºpostï¼Œå¯ä»¥å…ˆä¸å†™ã€‚title æ˜¯æ–‡ç« çš„æ ‡é¢˜ï¼Œä¹Ÿæ˜¯æ–‡ä»¶çš„åå­—ï¼Œå­˜å‚¨åœ¨source&#x2F;_postsä¸‹ã€‚åœ¨ç¼–å†™æ–‡ç« çš„shiâ€™hshih ï¼Œæœ‰æ—¶å€™ä¼šé‡è§æ— æ³•ç¼©è¿›çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å­—ç¬¦è¿›è¡Œç¼©è¿›ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸æ¢è¡Œç©ºæ ¼: \&amp;nbsp;æˆ–\&amp;#160;</span><br><span class="line">åŠè§’ç©ºæ ¼: \&amp;ensp;æˆ–\&amp;#8194;</span><br><span class="line">å…¨è§’ç©ºæ ¼: \&amp;emsp;æˆ–\&amp;#8195;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å†™å¥½æ–‡ç« åï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå‘å¸ƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxå¸¸ç”¨å‘½ä»¤</title>
      <link href="/2024/03/linux-common-cmd/"/>
      <url>/2024/03/linux-common-cmd/</url>
      
        <content type="html"><![CDATA[<h1 id="linuxå¸¸ç”¨å‘½ä»¤"><a href="#linuxå¸¸ç”¨å‘½ä»¤" class="headerlink" title="linuxå¸¸ç”¨å‘½ä»¤"></a>linuxå¸¸ç”¨å‘½ä»¤</h1><h2 id="1-tmux"><a href="#1-tmux" class="headerlink" title="1. tmux"></a>1. tmux</h2><p>1.æš‚æ—¶é€€å‡ºçª—å£</p><blockquote><p>ctrl + b , d</p></blockquote><p>2.æŸ¥çœ‹tmuxå†å²log</p><blockquote><p>ctrl + b , [<br>æ­¤å‘½ä»¤ä¼šè¿›å…¥åˆ°å¤åˆ¶æ¨¡å¼ï¼Œå¯ä»¥æŸ¥çœ‹tmuxå½“å‰çª—å£çš„å†å²logï¼Œä½¿ç”¨qé”®å¯ä»¥é€€å‡ºæ­¤æ¨¡å¼</p></blockquote><p>3.æŸ¥çœ‹å½“å‰å¼€äº†å“ªäº›tmuxçª—å£</p><blockquote><p>tmux list-windows</p></blockquote><p>4.é‡å‘½åå½“å‰çª—å£çš„åå­—ï¼š</p><blockquote><p>Ctrl + b, ,<br>ç¡®ä¿å½“å‰å¤„äºè¦é‡å‘½åçš„çª—å£ä¸­ã€‚æŒ‰ä¸‹å¿«æ·é”® Ctrl + b, , (é€—å·é”®)ã€‚è¿™ä¼šä½¿å½“å‰çª—å£çš„åç§°è¿›å…¥ç¼–è¾‘çŠ¶æ€ã€‚</p></blockquote><p>5.åˆ‡æ¢åˆ°åˆ«çš„çª—å£ï¼š</p><blockquote><p>tmux switch-client -t 2:0<br>å…¶ä¸­2ä¸ºä½œä¸šå·ï¼Œ0ä¸ºçª—å£å·<br>tmux attach-session -t 10<br>æ­¤å¤„10ä¸ºä½œä¸šå·</p></blockquote><h2 id="2-ipå‘½ä»¤"><a href="#2-ipå‘½ä»¤" class="headerlink" title="2. ipå‘½ä»¤"></a>2. ipå‘½ä»¤</h2><h2 id="2-1-ç½‘ç»œæ¥å£ç®¡ç†"><a href="#2-1-ç½‘ç»œæ¥å£ç®¡ç†" class="headerlink" title="2.1 ç½‘ç»œæ¥å£ç®¡ç†"></a>2.1 ç½‘ç»œæ¥å£ç®¡ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> show <span class="comment">#æ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£ä¿¡æ¯</span></span><br><span class="line">ip <span class="built_in">link</span> show dev eth0 <span class="comment">#æ˜¾ç¤ºæŒ‡å®šç½‘ç»œæ¥å£ä¿¡æ¯</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev eth0 up <span class="comment"># å¯ç”¨æŒ‡å®šç½‘ç»œæ¥å£</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev eth0 down <span class="comment"># ç¦ç”¨æŒ‡å®šç½‘ç»œæ¥å£</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> dev eth0 address 00:11:22:33:44:55 <span class="comment">#è®¾ç½®æŒ‡å®šç½‘ç»œæ¥å£çš„macåœ°å€</span></span><br><span class="line">ip addr add 192.168.1.2/24 dev eth0 <span class="comment">#é…ç½®ipåœ°å€</span></span><br><span class="line">ip addr del 192.168.1.2/24 dev eth0 <span class="comment">#åˆ é™¤ipåœ°å€</span></span><br></pre></td></tr></table></figure><h2 id="2-2-è·¯ç”±ç®¡ç†"><a href="#2-2-è·¯ç”±ç®¡ç†" class="headerlink" title="2.2 è·¯ç”±ç®¡ç†"></a>2.2 è·¯ç”±ç®¡ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip route show <span class="comment">#æ˜¾ç¤ºè·¯ç”±è¡¨</span></span><br><span class="line">ip route add 192.168.2.0/24 via 192.168.1.1 dev eth0 <span class="comment">#æ·»åŠ é™æ€è·¯ç”±</span></span><br><span class="line">ip route del 192.168.2.0/24 <span class="comment">#åˆ é™¤è·¯ç”±</span></span><br></pre></td></tr></table></figure><h2 id="2-3-arpç®¡ç†"><a href="#2-3-arpç®¡ç†" class="headerlink" title="2.3 arpç®¡ç†"></a>2.3 arpç®¡ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ip neigh show<span class="comment">#æ˜¾ç¤ºarpç¼“å­˜</span></span><br><span class="line">ip neigh add 192.168.1.1 lladdr 00:11:22:33:44:55 dev eth0 <span class="comment">#æ·»åŠ é™æ€arp</span></span><br><span class="line">ip neigh del 192.168.1.1 dev eth0<span class="comment">#åˆ é™¤arpæ¡ç›®</span></span><br></pre></td></tr></table></figure><h2 id="2-4-å…¶ä»–"><a href="#2-4-å…¶ä»–" class="headerlink" title="2.4 å…¶ä»–"></a>2.4 å…¶ä»–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.ip_forward=1 <span class="comment">#å¯ç”¨ipè½¬å‘</span></span><br><span class="line">ip neigh show <span class="comment">#æ˜¾ç¤ºé‚»å±…ç¼“å­˜</span></span><br><span class="line">ip -s <span class="built_in">link</span> iå¸Œçº³æ˜¯ç»Ÿè®¡ä¿¡æ¯</span><br></pre></td></tr></table></figure><h2 id="3-brctl"><a href="#3-brctl" class="headerlink" title="3. brctl"></a>3. brctl</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">brctl show <span class="comment"># æ˜¾ç¤ºç½‘ç»œæ¡¥æ¥ä¿¡æ¯</span></span><br><span class="line">brctl addbr mybridge <span class="comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œæ¡¥æ¥</span></span><br><span class="line">brctl addif mybridge eth0 <span class="comment"># å°†ç½‘ç»œæ¥å£æ·»åŠ åˆ°æ¡¥æ¥</span></span><br><span class="line">brctl delif mybridge eth0 <span class="comment"># ä»æ¡¥æ¥ä¸­ç§»é™¤ç½‘ç»œæ¥å£</span></span><br><span class="line">brctl delbr mybridge<span class="comment"># åˆ é™¤ç½‘ç»œæ¡¥æ¥</span></span><br></pre></td></tr></table></figure><h2 id="4-du"><a href="#4-du" class="headerlink" title="4. du"></a>4. du</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> -sh <span class="comment">#æŸ¥çœ‹å½“å‰ç›®å½•çš„ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="built_in">du</span> -h --max-depth=1<span class="comment">#é€çº§æ˜¾ç¤ºå­ç›®å½•çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="built_in">du</span> -h --max-depth=1 * <span class="comment">#æ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶å’Œç›®å½•çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="built_in">du</span> -h --max-depth=1 | <span class="built_in">sort</span> -h <span class="comment">#æŒ‰å¤§å°æ’åºæ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•</span></span><br></pre></td></tr></table></figure><h2 id="5-sortæ’åºå‘½ä»¤"><a href="#5-sortæ’åºå‘½ä»¤" class="headerlink" title="5. sortæ’åºå‘½ä»¤"></a>5. sortæ’åºå‘½ä»¤</h2><p>5.1 ç»å…¸ç”¨æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span> filename <span class="comment">#å¯¹æ–‡ä»¶çš„æ¯ä¸€è¡Œä¿¡æ¯æŒ‰ç…§å­—å…¸é¡ºåºæ’åºï¼Œå¹¶è¾“å‡ºåˆ°å½“å‰ç›®å½•</span></span><br><span class="line"><span class="built_in">sort</span> -n filename <span class="comment">#å¯¹æ–‡ä»¶çš„æ¯ä¸€è¡Œä¿¡æ¯æŒ‰ç…§æ•°å­—é¡ºåºæ’åºï¼Œå¹¶è¾“å‡ºåˆ°å½“å‰ç›®å½•</span></span><br><span class="line"><span class="built_in">sort</span> -r filename <span class="comment">#å¯¹æ–‡ä»¶çš„æ¯ä¸€è¡Œä¿¡æ¯æŒ‰ç…§å­—å…¸å€’åºæ’åºï¼Œå¹¶è¾“å‡ºåˆ°å½“å‰ç›®å½•</span></span><br><span class="line"><span class="built_in">sort</span> -u filename <span class="comment">#å¯¹æ–‡ä»¶çš„æ¯ä¸€è¡Œä¿¡æ¯æŒ‰ç…§å­—å…¸é¡ºåºå¹¶ä¸”å»é‡æ’åºï¼Œå¹¶è¾“å‡ºåˆ°å½“å‰ç›®å½•</span></span><br><span class="line"><span class="built_in">sort</span> -k&lt;åˆ—æ•°&gt; filename <span class="comment">#æŒ‰åˆ—æ’åº</span></span><br><span class="line"><span class="built_in">sort</span> -n -k&lt;åˆ—æ•°&gt; filename <span class="comment">#æŒ‰æ•°å­—å­—æ®µæ’åº</span></span><br><span class="line"><span class="built_in">sort</span> -t<span class="string">&#x27;:&#x27;</span> -k2 filename <span class="comment">#è‡ªå®šä¹‰åˆ†éš”ç¬¦ä½¿ç”¨ -t é€‰é¡¹æŒ‡å®šå­—æ®µåˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ :ï¼Œç„¶åä½¿ç”¨ -k é€‰é¡¹æŒ‰ç…§æŒ‡å®šåˆ—æ’åº</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;b\na\nc&quot;</span> | <span class="built_in">sort</span> <span class="comment">#ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®å¹¶æ’åº</span></span><br></pre></td></tr></table></figure><h2 id="6-i2ctools"><a href="#6-i2ctools" class="headerlink" title="6. i2ctools"></a>6. i2ctools</h2><p>6.1 i2csetå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i2cset -f -y 0x1 0x48 0x03 0x0020 w</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å…¶ä¸­,-y æŒ‡å®šäº†i2cæ§åˆ¶å™¨ä¸ºi2c1ï¼Œ0x48ä¸ºi2cè®¾å¤‡çš„åœ°å€ï¼Œ0x03ä¸ºå¯„å­˜å™¨åç§»é‡ï¼Œä»–è¡¨ç¤ºäº†å¯„å­˜å™¨åœ°å€ï¼Œ0x0020ä¸ºè¦å†™å…¥çš„æ•°æ®ã€‚wè¡¨ç¤ºä»¥å­—ï¼ˆ16 ä½ï¼‰ä¸ºå•ä½è¯»å†™ï¼Œè¿˜å¯ä»¥é€‰æ‹©å…¶ä»–è¯»å†™å•ä½ï¼šbï¼Œä»¥å­—èŠ‚ï¼ˆ8 ä½ï¼‰ä¸ºå•ä½è¯»å–ï¼›cï¼Œ ä»¥å­—ç¬¦ï¼ˆASCIIï¼‰ä¸ºå•ä½è¯»å–ã€‚</p><p>6.2 i2cgetå‘½ä»¤</p><p>&emsp;&emsp;use example:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i2cget -y 1 0x48 0x03 w <span class="comment">#ä»¥å­—ä¸ºå•ä½ï¼Œè¯»å–i2cåœ°å€ä¸º0x48ï¼Œå¯„å­˜å™¨0x03çš„æ•°æ®</span></span><br></pre></td></tr></table></figure><h2 id="7-dd"><a href="#7-dd" class="headerlink" title="7.dd"></a>7.dd</h2><p>&emsp;&emsp;å‘½ä»¤åŸºæœ¬å½¢å¼ï¼š</p><pre><code>    dd if=input_file of=output_file bs=block_size options</code></pre><p>examples:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/mmcblk0gp0 bs=512 count=1024 seek=3072</span><br><span class="line"><span class="comment"># æŒ‡å®šå—å¤§å°ä¸º512ï¼Œå¤åˆ¶å—æ•°ä¸º1024ï¼Œè·³è¿‡è¾“å‡ºæ–‡ä»¶çš„å‰3072å—ã€‚ï¼ˆä¹Ÿå°±æ˜¯ä»è¾“å‡ºæ–‡ä»¶çš„ç¬¬3072*512å¤„å¼€å§‹ï¼Œå°†è¾“å…¥æ–‡ä»¶çš„æ•°æ®å¤åˆ¶è¿›å»ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/mmcblk0gp0 bs=512 count=1024 skip=3072</span><br><span class="line"><span class="comment"># æŒ‡å®šå—å¤§å°ä¸º512ï¼Œå¤åˆ¶å—æ•°ä¸º1024ï¼Œè·³è¿‡è¾“å…¥æ–‡ä»¶çš„å‰3072å—ã€‚ï¼ˆä¹Ÿå°±æ˜¯ä»è¾“å…¥æ–‡ä»¶çš„ç¬¬3072*512å¤„å¼€å§‹ï¼Œå°†å¾€åçš„512*1024å—æ•°æ®å¤åˆ¶è¿›è¾“å‡ºæ–‡ä»¶ã€‚ï¼ˆä»è¾“å‡ºæ–‡ä»¶çš„0x00åœ°å€å¼€å§‹ï¼‰ï¼‰</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ddå‘½ä»¤è¿˜æœ‰ä¸€äº›å…¶ä»–çš„å¯é€‰å‘½ä»¤é€‰é¡¹ï¼Œå…·ä½“ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â€¢ bs=1024ï¼šè®¾ç½®å—å¤§å°ä¸º1024å­—èŠ‚ï¼Œå³1KBã€‚è¿™æ˜¯<span class="built_in">dd</span>æ¯æ¬¡è¯»å–å’Œå†™å…¥çš„æ•°æ®å—å¤§å°ã€‚</span><br><span class="line">â€¢ countï¼šæŒ‡å®šè¦å¤åˆ¶çš„å—æ•°æˆ–æ•°æ®å—çš„æ•°é‡ã€‚</span><br><span class="line">â€¢ skip åœ¨å¤åˆ¶ä¹‹å‰è·³è¿‡è¾“å…¥æ–‡ä»¶çš„å—æ•°æˆ–å­—èŠ‚æ•°ã€‚ç”¨äºè®¾ç½®è¾“å…¥æ–‡ä»¶çš„èµ·å§‹ä½ç½®ï¼Œå³åœ¨è¾“å…¥æ–‡ä»¶ä¸­è·³è¿‡ä¸€å®šæ•°é‡çš„å—</span><br><span class="line">â€¢ seekï¼šåœ¨å†™å…¥ä¹‹å‰è·³è¿‡è¾“å‡ºæ–‡ä»¶çš„å—æ•°æˆ–å­—èŠ‚æ•°ã€‚ç”¨äºè®¾ç½®è¾“å‡ºæ–‡ä»¶çš„èµ·å§‹ä½ç½®ï¼Œå³åœ¨è¾“å‡ºæ–‡ä»¶ä¸­è·³è¿‡ä¸€å®šæ•°é‡çš„å—</span><br><span class="line">â€¢ iflagï¼šè®¾ç½®è¾“å…¥é€‰é¡¹ï¼Œä¾‹å¦‚iflag=directè¡¨ç¤ºç›´æ¥è®¿é—®è¾“å…¥æ–‡ä»¶è€Œä¸è¿›è¡Œç¼“å­˜ã€‚</span><br><span class="line">â€¢ oflagï¼šè®¾ç½®è¾“å‡ºé€‰é¡¹ï¼Œä¾‹å¦‚oflag=directè¡¨ç¤ºç›´æ¥å†™å…¥è¾“å‡ºæ–‡ä»¶è€Œä¸è¿›è¡Œç¼“å­˜ã€‚</span><br><span class="line">â€¢ status=progressï¼šæ˜¾ç¤ºå¤åˆ¶è¿›åº¦ä¿¡æ¯</span><br></pre></td></tr></table></figure><h2 id="8-sttyå‘½ä»¤"><a href="#8-sttyå‘½ä»¤" class="headerlink" title="8.sttyå‘½ä»¤"></a>8.sttyå‘½ä»¤</h2><p>&emsp;&emsp;sttyå‘½ä»¤å¯ä»¥ä¿®æ”¹ç»ˆç«¯é©±åŠ¨ç¨‹åºé‡Œçš„è®¾ç½®ï¼Œå¯ä»¥ç”¨æ¥æ˜¾ç¤ºå’Œä¿®æ”¹ç»ˆç«¯å‘½ä»¤ã€‚ä¸‹é¢æ˜¯å®ƒçš„å¸¸è§ç”¨æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stty</span> size;<span class="comment">#æ˜¾ç¤ºç»ˆç«¯çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¡Œæ•°å’Œåˆ—æ•°ï¼ŒåŠ ä¸Š-aå¯ä»¥æ˜¾ç¤ºçš„æ›´åŠ è¯¦ç»†ã€‚</span></span><br><span class="line"><span class="comment">#æ­¤å¤–ï¼Œæœ‰çš„æ—¶å€™åœ¨ç»ˆç«¯è¯¯æŒ‰ctrl+så¯¼è‡´ç»ˆç«¯åƒµæ­»ï¼Œæ­¤æ—¶æŒ‰ä¸‹ctrl+qä¾¿å¯ä»¥ä½¿ç»ˆç«¯å›å¤ï¼›</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">stty</span> -F /dev/tty0 115200; <span class="comment">#è®¾ç½®ä¸²å£æ³¢ç‰¹ç‡ä¸º115200</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">stty</span> -a -F /dev/tty2; <span class="comment">#æ£€æŸ¥å½“å‰ä¸²å£2çš„è®¾ç½®</span></span><br></pre></td></tr></table></figure><h2 id="9-ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œç®€å•çš„ä¸²å£é€šä¿¡"><a href="#9-ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œç®€å•çš„ä¸²å£é€šä¿¡" class="headerlink" title="9.ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œç®€å•çš„ä¸²å£é€šä¿¡"></a>9.ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œç®€å•çš„ä¸²å£é€šä¿¡</h2><ol><li>é¦–å…ˆä½¿ç”¨sttyè®¾ç½®ä¸²å£æ³¢ç‰¹ç‡<blockquote><p>stty -F &#x2F;dev&#x2F;ttyAMA1 115200</p></blockquote></li><li>ä½¿ç”¨echoå‘ä¸²å£å‘é€ä¿¡æ¯<blockquote><p>echo â€œHello worldâ€ &gt; &#x2F;dev&#x2F;ttyAMA1 </p></blockquote></li><li>ä½¿ç”¨catæ‰“å°å½“å‰ä¸²å£è¿”å›çš„ä¿¡æ¯<blockquote><p>cat &#x2F;dev&#x2F;ttyAMA1</p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> linuxå¸¸ç”¨å‘½ä»¤ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo åŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pages å¹¶å®ç°å…¨ç«™ HTTPS</title>
      <link href="/2022/11/hexo-Hexo-%E5%8F%8C%E7%BA%BF%E9%83%A8%E7%BD%B2%E5%88%B0-Coding-Pages-%E5%92%8C-GitHub-Pages-%E5%B9%B6%E5%AE%9E%E7%8E%B0%E5%85%A8%E7%AB%99-HTTPS/"/>
      <url>/2022/11/hexo-Hexo-%E5%8F%8C%E7%BA%BF%E9%83%A8%E7%BD%B2%E5%88%B0-Coding-Pages-%E5%92%8C-GitHub-Pages-%E5%B9%B6%E5%AE%9E%E7%8E%B0%E5%85%A8%E7%AB%99-HTTPS/</url>
      
        <content type="html"><![CDATA[<p><strong>2022-01-25 æ›´æ–°ï¼šåšå®¢æ–°åœ°å€ï¼š<a href="https://www.itbob.cn/">https://www.itbob.cn/</a> ï¼Œæ–‡ç« è·ä¸Šæ¬¡ç¼–è¾‘æ—¶é—´è¾ƒè¿œï¼Œéƒ¨åˆ†å†…å®¹å¯èƒ½å·²ç»è¿‡æ—¶ï¼</strong></p><p>æˆ‘çš„åšå®¢åœ°å€ï¼š<a href="https://www.itrhx.com/">https://www.itrhx.com/</a></p><p>éƒ¨ç½²åˆ° Coding Pages çš„å¥½å¤„ï¼šå›½å†…è®¿é—®é€Ÿåº¦æ›´å¿«ï¼Œå¯ä»¥æäº¤ç™¾åº¦æ”¶å½•ï¼ˆGitHub ç¦æ­¢äº†ç™¾åº¦çš„çˆ¬å–ï¼‰</p><p>éƒ¨ç½²åˆ° Coding Pages çš„åå¤„ï¼šå°±ä»Šå¹´æ¥è¯´ï¼ŒCoding ä¸å¤ªç¨³å®šï¼Œéšæ—¶æœ‰å®•æœºçš„å¯èƒ½ï¼Œç¾¤é‡Œçš„æœ‹å‹å·²ç»ç»å†è¿‡å‡ æ¬¡äº†ï¼Œä¸è¿‡ç›¸ä¿¡ä»¥åä¼šè¶Šæ¥è¶Šç¨³å®šçš„</p><p>éƒ¨ç½²è¿‡ç¨‹ä¸­å¸¸è§çš„é—®é¢˜ï¼šæ— æ³•å®ç°å…¨ç«™ HTTPSï¼ŒCoding ç”³è¯· SSL è¯ä¹¦å¤±è´¥ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šæç¤ºä¸æ˜¯å®‰å…¨é“¾æ¥</p><p>æœ¬æ–‡å‰æï¼šä½ å·²ç»å°† Hexo æˆåŠŸéƒ¨ç½²åˆ°äº† GitHub Pagesï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œè¯·å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_36759224/article/details/82121420">ã€Šä½¿ç”¨Github Pageså’ŒHexoæ­å»ºè‡ªå·±çš„ç‹¬ç«‹åšå®¢ã€è¶…çº§è¯¦ç»†çš„å°ç™½æ•™ç¨‹ã€‘ã€‹</a></p><p>æœ¬æ–‡å°†å…¨é¢è®²è¿°å¦‚ä½•æˆåŠŸåŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pages å¹¶å®ç°å…¨ç«™ HPPTSï¼ŒåŒæ—¶è§£å†³ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼</p><h2 id="Coding-å·²æ›´æ–°ï¼Œæ–°ç‰ˆé¡µé¢åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™é€‰æ‹©-ã€DevOps-é¡¹ç›®ã€‘ï¼Œå…¶ä»–æ­¥éª¤ä¸€æ ·ï¼Œç„¶åè¿›å»é¡¹ç›®é‡Œé¢ï¼Œåœ¨å·¦ä¾§ä¾æ¬¡é€‰æ‹©ã€æŒç»­éƒ¨ç½²ã€‘ã€ã€é™æ€ç½‘ç«™ã€‘ï¼Œå°±å¯ä»¥å¼€å¯-pages-æœåŠ¡äº†ï¼"><a href="#Coding-å·²æ›´æ–°ï¼Œæ–°ç‰ˆé¡µé¢åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™é€‰æ‹©-ã€DevOps-é¡¹ç›®ã€‘ï¼Œå…¶ä»–æ­¥éª¤ä¸€æ ·ï¼Œç„¶åè¿›å»é¡¹ç›®é‡Œé¢ï¼Œåœ¨å·¦ä¾§ä¾æ¬¡é€‰æ‹©ã€æŒç»­éƒ¨ç½²ã€‘ã€ã€é™æ€ç½‘ç«™ã€‘ï¼Œå°±å¯ä»¥å¼€å¯-pages-æœåŠ¡äº†ï¼" class="headerlink" title="Coding å·²æ›´æ–°ï¼Œæ–°ç‰ˆé¡µé¢åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™é€‰æ‹© ã€DevOps é¡¹ç›®ã€‘ï¼Œå…¶ä»–æ­¥éª¤ä¸€æ ·ï¼Œç„¶åè¿›å»é¡¹ç›®é‡Œé¢ï¼Œåœ¨å·¦ä¾§ä¾æ¬¡é€‰æ‹©ã€æŒç»­éƒ¨ç½²ã€‘ã€ã€é™æ€ç½‘ç«™ã€‘ï¼Œå°±å¯ä»¥å¼€å¯ pages æœåŠ¡äº†ï¼"></a>Coding å·²æ›´æ–°ï¼Œæ–°ç‰ˆé¡µé¢åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™é€‰æ‹© ã€DevOps é¡¹ç›®ã€‘ï¼Œå…¶ä»–æ­¥éª¤ä¸€æ ·ï¼Œç„¶åè¿›å»é¡¹ç›®é‡Œé¢ï¼Œåœ¨å·¦ä¾§ä¾æ¬¡é€‰æ‹©ã€æŒç»­éƒ¨ç½²ã€‘ã€ã€é™æ€ç½‘ç«™ã€‘ï¼Œå°±å¯ä»¥å¼€å¯ pages æœåŠ¡äº†ï¼</h2><h2 id="1-åˆ›å»ºé¡¹ç›®"><a href="#1-åˆ›å»ºé¡¹ç›®" class="headerlink" title="1.åˆ›å»ºé¡¹ç›®"></a>1.åˆ›å»ºé¡¹ç›®</h2><p>è¿›å…¥ <a href="https://coding.net/">Coding å®˜ç½‘</a>ï¼Œç‚¹å‡»ä¸ªäººç‰ˆç™»é™†ï¼Œæ²¡æœ‰è´¦å·å°±æ³¨å†Œä¸€ä¸ªå¹¶ç™»å½•ï¼Œç”±äº Coding å·²ç»è¢«è…¾è®¯æ”¶è´­äº†ï¼Œæ‰€ä»¥ç™»å½•å°±ä¼šæ¥åˆ°è…¾è®¯äº‘å¼€å‘è€…å¹³å°ï¼Œç‚¹å‡»åˆ›å»ºé¡¹ç›®<br><img src="https://img-blog.csdnimg.cn/20190916103158338.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"><br>é¡¹ç›®åç§°å»ºè®®å’Œä½ çš„ç”¨æˆ·åä¸€è‡´ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šåˆ°æ—¶å€™å¯ä»¥ç›´æ¥é€šè¿‡ <code>user_name.coding.me</code> è®¿é—®ä½ çš„åšå®¢ï¼Œå¦‚æœé¡¹ç›®åä¸ç”¨æˆ·åä¸ä¸€è‡´ï¼Œåˆ™éœ€è¦é€šè¿‡ <code>user_name.coding.me/project_name</code> æ‰èƒ½è®¿é—®ï¼Œé¡¹ç›®æè¿°å¯ä»¥éšä¾¿å†™<br><img src="https://img-blog.csdnimg.cn/20190916103926753.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"></p><h2 id="2-é…ç½®å…¬é’¥"><a href="#2-é…ç½®å…¬é’¥" class="headerlink" title=";  2.é…ç½®å…¬é’¥"></a><a name="font_colorff00002font_30">;</a>  2.é…ç½®å…¬é’¥</h2><p>é…ç½® SSH å…¬é’¥æ–¹æ³•ä¸ GitHub Pages çš„æ–¹å¼å·®ä¸å¤šï¼Œç‚¹å‡»ä½ çš„å¤´åƒï¼Œä¾æ¬¡é€‰æ‹©ã€ä¸ªäººè®¾ç½®ã€‘-ã€SSHå…¬é’¥ã€‘-ã€æ–°å¢å…¬é’¥ã€‘<img src="https://img-blog.csdnimg.cn/20190916105353837.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"></p><p>å‰é¢éƒ¨ç½²åˆ° GitHub Pages çš„æ—¶å€™å°±å·²ç»æœ‰äº†ä¸€å¯¹å…¬é’¥ï¼Œæˆ‘ä»¬ç›´æ¥å°†è¯¥å…¬é’¥ç²˜è´´è¿›å»å°±è¡Œï¼Œå…¬é’¥åç§°å¯ä»¥éšä¾¿å†™ï¼Œé€‰ä¸­æ°¸ä¹…æœ‰æ•ˆé€‰é¡¹</p><p>PSï¼šå…¬é’¥å‚¨å­˜ä½ç½®ä¸€èˆ¬åœ¨ C:\Users\ç”¨æˆ·å.ssh ç›®å½•ä¸‹çš„ id_rsa.pub æ–‡ä»¶é‡Œï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€å¤åˆ¶å…¶å†…å®¹å³å¯</p><p><img src="https://img-blog.csdnimg.cn/20190916110214603.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"><br>æ·»åŠ å…¬é’¥åï¼Œæˆ‘ä»¬å¯ä»¥å³é”® <code>Get Bash</code>ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@e.coding.net</span><br></pre></td></tr></table></figure><p>è‹¥å‡ºç°ä»¥ä¸‹æç¤ºï¼Œåˆ™è¯æ˜é…ç½®æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Coding æç¤º: Hello XXX, You<span class="string">&#x27;ve connected to Coding.net via SSH. This is a personal key.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">XXXï¼Œä½ å¥½ï¼Œä½ å·²ç»é€šè¿‡ SSH åè®®è®¤è¯ Coding.net æœåŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ªäººå…¬é’¥</span></span><br></pre></td></tr></table></figure><h2 id="3-é…ç½®-config-yml"><a href="#3-é…ç½®-config-yml" class="headerlink" title="3.é…ç½® _config.yml"></a>3.é…ç½® _config.yml</h2><p>è¿›å…¥ä½ çš„é¡¹ç›®ï¼Œåœ¨å³ä¸‹è§’æœ‰é€‰æ‹©è¿æ¥æ–¹å¼ï¼Œé€‰æ‹© SSH æ–¹å¼ï¼ˆHTTPS æ–¹å¼ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æœ‰æ—¶å€™å¯èƒ½è¿æ¥ä¸ä¸Šï¼ŒSSH è¿æ¥ä¸å®¹æ˜“å‡ºé—®é¢˜ï¼‰ï¼Œä¸€é”®å¤åˆ¶ï¼Œç„¶åæ‰“å¼€ä½ æœ¬åœ°åšå®¢æ ¹ç›®å½•çš„ <code>_config.yml</code> æ–‡ä»¶ï¼Œæ‰¾åˆ° <code>deploy</code> å…³é”®å­—ï¼Œæ·»åŠ  coding åœ°å€ï¼š <code>coding: git@git.dev.tencent.com:user_name/user_name.git </code>ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšå¤åˆ¶çš„ SSH åœ°å€ã€‚</p><p><strong>ã€2020.04.06 æ›´æ–°ã€‘coding åœ°å€æ ¼å¼ç°åœ¨æœ‰æ‰€æ”¹å˜ï¼Œç±»ä¼¼äº <code>git@e.coding.net:TRHX/TRHX.git</code> ï¼Œè®°ä½å»ä»“åº“å¤åˆ¶ä½ è‡ªå·±çš„å³å¯ã€‚</strong><br><img src="https://img-blog.csdnimg.cn/20190916111108720.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"><br><img src="https://img-blog.csdnimg.cn/20190916120353840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"></p><p>æ·»åŠ å®Œæˆåå…ˆæ‰§è¡Œå‘½ä»¤ <code>hexo clean</code> æ¸…ç†ä¸€ä¸‹ç¼“å­˜ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ <code>hexo g -d</code> å°†åšå®¢åŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pagesï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºè¡¨ç¤ºéƒ¨ç½²æˆåŠŸï¼š<br><img src="https://img-blog.csdnimg.cn/20190916144513473.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"></p><h2 id="4-å¼€å¯-Coding-Pages"><a href="#4-å¼€å¯-Coding-Pages" class="headerlink" title=";  4.å¼€å¯ Coding Pages"></a><a name="font_colorff00004_coding_pagesfont_63">;</a>  4.å¼€å¯ Coding Pages</h2><p>è¿›å…¥ä½ çš„é¡¹ç›®ï¼Œåœ¨ä»£ç æ ä¸‹é€‰æ‹© Pages æœåŠ¡ï¼Œä¸€é”®å¼€å¯ Coding Pagesï¼Œç­‰å¾…å‡ ç§’ååˆ·æ–°ç½‘é¡µå³å¯çœ‹åˆ°å·²ç»å¼€å¯çš„ Coding Pagesï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å°±å¯ä»¥é€šè¿‡ xxxx.coding.meï¼ˆæ¯”å¦‚æˆ‘çš„æ˜¯ trhx.coding.meï¼‰è®¿é—®ä½ çš„ Coding Pages é¡µé¢äº†</p><p><strong>ã€2020.04.06 æ›´æ–°ã€‘coding åˆ†é…çš„åŸŸåç°åœ¨æœ‰æ‰€æ”¹å˜ï¼Œç±»ä¼¼äº <code>https://p51l67.coding-pages.com</code></strong></p><p><img src="https://img-blog.csdnimg.cn/20190916110721794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"><br><img src="https://img-blog.csdnimg.cn/20190916124340990.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"></p><h2 id="5-ç»‘å®šåŸŸåå¹¶å¼€å¯-HPPTS"><a href="#5-ç»‘å®šåŸŸåå¹¶å¼€å¯-HPPTS" class="headerlink" title="5.ç»‘å®šåŸŸåå¹¶å¼€å¯ HPPTS"></a>5.ç»‘å®šåŸŸåå¹¶å¼€å¯ HPPTS</h2><p>é¦–å…ˆåœ¨ä½ çš„åŸŸå DNS è®¾ç½®ä¸­æ·»åŠ ä¸€æ¡ <code>CNAME</code> è®°å½•æŒ‡å‘ <code>xxxx.coding.me</code>ï¼Œè§£æè·¯çº¿é€‰æ‹© <code>&amp;#x9ED8;&amp;#x8BA4;</code>ï¼Œå°† GitHub çš„è§£æè·¯çº¿æ”¹ä¸º <code>&amp;#x5883;&amp;#x5916;</code>ï¼Œè¿™æ ·å¢ƒå¤–è®¿é—®å°±ä¼šèµ° GitHubï¼Œå¢ƒå†…å°±ä¼šèµ° Codingï¼Œä¹Ÿæœ‰äººè¯´é˜¿é‡Œäº‘æ˜¯æ™ºèƒ½è§£æï¼Œè‡ªåŠ¨åˆ†é…è·¯çº¿ï¼Œå¦‚æœè§£æè·¯çº¿éƒ½æ˜¯é»˜è®¤ï¼Œå¢ƒå¤–è®¿é—®åŒæ ·ä¼šæ™ºèƒ½é€‰æ‹©èµ° GitHubï¼Œå¢ƒå†…èµ° Codingï¼Œæˆ‘æ²¡æœ‰éªŒè¯è¿‡ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±è¯•è¯•ï¼Œæˆ‘çš„è§£æå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><strong>ã€2020.04.06 æ›´æ–°ã€‘coding åˆ†é…çš„åŸŸåç°åœ¨æœ‰æ‰€æ”¹å˜ï¼Œç±»ä¼¼äº <code>https://p51l67.coding-pages.com</code> ï¼Œè¯·æ³¨æ„è§£æå½“ä¸­è®°å½•å€¼çš„å¡«å†™ã€‚</strong></p><p><img src="https://img-blog.csdnimg.cn/20190916132146484.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"><br>ç„¶åç‚¹å‡»é™æ€ Pages åº”ç”¨å³ä¸Šè§’çš„è®¾ç½®ï¼Œè¿›å…¥è®¾ç½®é¡µé¢ï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œå¦‚æœä½ ä¹‹å‰å·²ç»éƒ¨ç½²åˆ°äº† GitHub Pages å¹¶å¼€å¯äº† HTTPSï¼Œé‚£ä¹ˆç›´æ¥åœ¨è®¾ç½®é¡µé¢ç»‘å®šä½ è‡ªå·±çš„åŸŸåï¼ŒSSL&#x2F;TLS å®‰å…¨è¯ä¹¦å°±ä¼šæ˜¾ç¤ºç”³è¯·é”™è¯¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ²¡æœ‰ç”³è¯·åˆ° SSL è¯ä¹¦ï¼Œå½“ä½ è®¿é—®ä½ çš„ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šæç¤ºä¸æ˜¯å®‰å…¨è¿æ¥<br><img src="https://img-blog.csdnimg.cn/20190916125313300.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"><br>ç”³è¯·é”™è¯¯åŸå› æ˜¯ï¼šåœ¨éªŒè¯åŸŸåæ‰€æœ‰æƒæ—¶ä¼šå®šä½åˆ° Github Pages çš„ä¸»æœºä¸Šå¯¼è‡´ SSL è¯ä¹¦ç”³è¯·å¤±è´¥</p><p>æ­£ç¡®çš„åšæ³•æ˜¯ï¼šå…ˆå»åŸŸå DNS æŠŠ GitHub çš„è§£ææš‚åœæ‰ï¼Œç„¶åå†é‡æ–°ç”³è¯· SSL è¯ä¹¦ï¼Œå¤§çº¦åç§’å·¦å³å°±èƒ½ç”³è¯·æˆåŠŸï¼Œç„¶åå¼€å¯å¼ºåˆ¶ HTTPS è®¿é—®</p><p>è¿™é‡Œä¹Ÿå»ºè®®åŒæ—¶ç»‘å®šæœ‰ www å‰ç¼€å’Œæ²¡æœ‰ www å‰ç¼€çš„ï¼Œå¦‚æœè¦ç»‘å®šæ²¡æœ‰ www å‰ç¼€çš„ï¼Œé¦–å…ˆè¦å»åŸŸå DNS æ·»åŠ ä¸€ä¸ª <code>A</code> è®°å½•ï¼Œä¸»æœºè®°å½•ä¸º <code>@</code>ï¼Œè®°å½•å€¼ä¸ºä½ åšå®¢ IP åœ°å€ï¼ŒIP åœ°å€å¯ä»¥åœ¨ cmd å‘½ä»¤è¡Œ ping ä¸€ä¸‹å¾—åˆ°ï¼Œç„¶ååœ¨ Coding Pages ä¸­è®¾ç½®å…¶ä¸­ä¸€ä¸ªä¸ºã€é¦–é€‰ã€‘ï¼Œå¦ä¸€ä¸ªè®¾ç½®ã€è·³è½¬è‡³é¦–é€‰ã€‘ï¼Œè¿™æ ·ä¸ç®¡ç”¨æˆ·æ˜¯å¦è¾“å…¥ www å‰ç¼€éƒ½ä¼šè·³åˆ°æœ‰ www å‰ç¼€çš„äº†</p><p>åœ¨åšå®¢èµ„æºå¼•ç”¨çš„æ—¶å€™ä¹Ÿè¦æ³¨æ„æ‰€æœ‰èµ„æºçš„ URL å¿…é¡»æ˜¯ä»¥ https:&#x2F;&#x2F; å¼€å¤´ï¼Œä¸ç„¶æµè§ˆå™¨ä¾æ—§ä¼šæç¤ºä¸å®‰å…¨ï¼<br><img src="https://img-blog.csdnimg.cn/20191207135619989.png"><img src="https://img-blog.csdnimg.cn/20191126004255465.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9pdHJoeC5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70"><br>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ Hexo åšå®¢å°±æˆåŠŸåŒçº¿éƒ¨ç½²åˆ° Coding Pages å’Œ GitHub Pages äº†ï¼Œå¹¶ä¸”ä¹Ÿå®ç°äº†å…¨ç«™ HPPTSï¼Œæœ€åæ¥ä¸€å¼  GitHub Pages å’Œ Coding Pages åœ¨å›½å†…çš„é€Ÿåº¦å¯¹æ¯”å›¾ï¼Œå¯ä»¥æ˜æ˜¾çœ‹åˆ°é€Ÿåº¦çš„æå‡<br><img src="https://img-blog.csdnimg.cn/20190916134128463.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzU5MjI0,size_16,color_FFFFFF,t_70"></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
